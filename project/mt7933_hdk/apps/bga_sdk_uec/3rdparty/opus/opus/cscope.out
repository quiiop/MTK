cscope 15 $HOME/icb/aia/aia-demo/afr1106/vendors/mediatek/sdk.mt7933/project/mt7933_hdk/apps/iot_sdk_demo/3rdparty/opus/opus               0001718472
	@celt/_kiss_fft_guts.h

26 #i‚de‡
KISS_FFT_GUTS_H


27 
	#KISS_FFT_GUTS_H


	)

29 
	#MIN
(
a
,
b
Ë(◊)<(bË? (a):(b))

	)

30 
	#MAX
(
a
,
b
Ë(◊)>(bË? (a):(b))

	)

36 
	~"kiss_f·.h
"

47 #ifde‡
FIXED_POINT


48 
	~"¨ch.h
"

51 
	#SAMP_MAX
 2147483647

	)

52 
	#TWID_MAX
 32767

	)

53 
	#TRIG_UPSCALE
 1

	)

55 
	#SAMP_MIN
 -
SAMP_MAX


	)

58 
	#S_MUL
(
a
,
b
Ë
	`MULT16_32_Q15
(b,á)

	)

60 
	#C_MUL
(
m
,
a
,
b
) \

61 do{ (
m
).
r
 = 
	`SUB32_ovÊw
(
	`S_MUL
((
a
).r,(
b
).rË, S_MUL(◊).
i
,(b).i)); \

62 (
m
).
i
 = 
	`ADD32_ovÊw
(
	`S_MUL
((
a
).
r
,(
b
).iË, S_MUL(◊).i,(b).r)); }0)

	)

64 
	#C_MULC
(
m
,
a
,
b
) \

65 do{ (
m
).
r
 = 
	`ADD32_ovÊw
(
	`S_MUL
((
a
).r,(
b
).rË, S_MUL(◊).
i
,(b).i)); \

66 (
m
).
i
 = 
	`SUB32_ovÊw
(
	`S_MUL
((
a
).i,(
b
).
r
Ë, S_MUL(◊).r,(b).i)); }0)

	)

68 
	#C_MULBYSCALAR
–
c
, 
s
 ) \

69 do{ (
c
).
r
 = 
	`S_MUL
–(c).∏, 
s
 ) ;\

70 (
c
).
i
 = 
	`S_MUL
–(c).ò, 
s
 ) ; }0)

	)

72 
	#DIVSCALAR
(
x
,
k
) \

73 (
x
Ë
	`S_MUL
–x, (
TWID_MAX
-((
k
)>>1))/(k)+1 )

	)

75 
	#C_FIXDIV
(
c
,
div
) \

76 dÿ{ 
	`DIVSCALAR
–(
c
).
r
 , 
div
); \

77 
	`DIVSCALAR
–(
c
).
i
 , 
div
); }0)

	)

79 
	#C_ADD
–
ªs
, 
a
,
b
)\

80 dÿ{(
ªs
).
r
=
	`ADD32_ovÊw
((
a
).r,(
b
).r); (ªs).
i
=ADD32_ovflw((a).i,(b).i); \

81 }0)

	)

82 
	#C_SUB
–
ªs
, 
a
,
b
)\

83 dÿ{(
ªs
).
r
=
	`SUB32_ovÊw
((
a
).r,(
b
).r); (ªs).
i
=SUB32_ovflw((a).i,(b).i); \

84 }0)

	)

85 
	#C_ADDTO
–
ªs
 , 
a
)\

86 dÿ{(
ªs
).
r
 = 
	`ADD32_ovÊw
(‘es).r, (
a
).r); (ªs).
i
 = ADD32_ovflw((res).i,(a).i);\

87 }0)

	)

89 
	#C_SUBFROM
–
ªs
 , 
a
)\

90 dÿ{(
ªs
).
r
 = 
	`ADD32_ovÊw
(‘es).r,(
a
).r); (ªs).
i
 = 
	`SUB32_ovÊw
((res).i,(a).i); \

91 }0)

	)

93 #i‡
deföed
(
OPUS_ARM_INLINE_ASM
)

94 
	~"¨m/kiss_f·_¨mv4.h
"

97 #i‡
deföed
(
OPUS_ARM_INLINE_EDSP
)

98 
	~"¨m/kiss_f·_¨mv5e.h
"

100 #i‡
deföed
(
MIPSr1_ASM
)

101 
	~"mùs/kiss_f·_mù§1.h
"

106 
	#S_MUL
(
a
,
b
Ë–◊)*(bË)

	)

107 
	#C_MUL
(
m
,
a
,
b
) \

108 do{ (
m
).
r
 = (
a
).r*(
b
).∏- (a).
i
*(b).i;\

109 (
m
).
i
 = (
a
).
r
*(
b
).ò+ (a).i*(b).r; }0)

	)

110 
	#C_MULC
(
m
,
a
,
b
) \

111 do{ (
m
).
r
 = (
a
).r*(
b
).∏+ (a).
i
*(b).i;\

112 (
m
).
i
 = (
a
).i*(
b
).
r
 - (a).r*(b).i; }0)

	)

114 
	#C_MUL4
(
m
,
a
,
b
Ë
	`C_MUL
(m,a,b)

	)

116 
	#C_FIXDIV
(
c
,
div
Ë

	)

117 
	#C_MULBYSCALAR
–
c
, 
s
 ) \

118 do{ (
c
).
r
 *(
s
);\

119 (
c
).
i
 *(
s
); }0)

	)

122 #i‚de‡
CHECK_OVERFLOW_OP


123 
	#CHECK_OVERFLOW_OP
(
a
,
›
,
b
Ë

	)

126 #i‚de‡
C_ADD


127 
	#C_ADD
–
ªs
, 
a
,
b
)\

129 
	`CHECK_OVERFLOW_OP
((
a
).
r
,+,(
b
).r)\

130 
	`CHECK_OVERFLOW_OP
((
a
).
i
,+,(
b
).i)\

131 (
ªs
).
r
=(
a
).r+(
b
).r; (ªs).
i
=(a).i+(b).i; \

132 }0)

	)

133 
	#C_SUB
–
ªs
, 
a
,
b
)\

135 
	`CHECK_OVERFLOW_OP
((
a
).
r
,-,(
b
).r)\

136 
	`CHECK_OVERFLOW_OP
((
a
).
i
,-,(
b
).i)\

137 (
ªs
).
r
=(
a
).r-(
b
).r; (ªs).
i
=(a).i-(b).i; \

138 }0)

	)

139 
	#C_ADDTO
–
ªs
 , 
a
)\

141 
	`CHECK_OVERFLOW_OP
((
ªs
).
r
,+,(
a
).r)\

142 
	`CHECK_OVERFLOW_OP
((
ªs
).
i
,+,(
a
).i)\

143 (
ªs
).
r
 +(
a
).r; (ªs).
i
 += (a).i;\

144 }0)

	)

146 
	#C_SUBFROM
–
ªs
 , 
a
)\

148 
	`CHECK_OVERFLOW_OP
((
ªs
).
r
,-,(
a
).r)\

149 
	`CHECK_OVERFLOW_OP
((
ªs
).
i
,-,(
a
).i)\

150 (
ªs
).
r
 -(
a
).r; (ªs).
i
 -= (a).i; \

151 }0)

	)

154 #ifde‡
FIXED_POINT


157 
	#KISS_FFT_COS
(
pha£
Ë
	`Êo‹
(.5+
TWID_MAX
*
	`cos
 (pha£))

	)

158 
	#KISS_FFT_SIN
(
pha£
Ë
	`Êo‹
(.5+
TWID_MAX
*
	`sö
 (pha£))

	)

159 
	#HALF_OF
(
x
Ë((x)>>1)

	)

160 #ñi‡
deföed
(
USE_SIMD
)

161 
	#KISS_FFT_COS
(
pha£
Ë
	`_mm_£t1_ps
–
	`cos
’ha£Ë)

	)

162 
	#KISS_FFT_SIN
(
pha£
Ë
	`_mm_£t1_ps
–
	`sö
’ha£Ë)

	)

163 
	#HALF_OF
(
x
Ë((x)*
	`_mm_£t1_ps
(.5f))

	)

165 
	#KISS_FFT_COS
(
pha£
Ë(
kiss_f·_sˇœr
Ë
	`cos
’ha£)

	)

166 
	#KISS_FFT_SIN
(
pha£
Ë(
kiss_f·_sˇœr
Ë
	`sö
’ha£)

	)

167 
	#HALF_OF
(
x
Ë((x)*.5f)

	)

170 
	#kf_˚xp
(
x
,
pha£
) \

172 (
x
)->
r
 = 
	`KISS_FFT_COS
(
pha£
);\

173 (
x
)->
i
 = 
	`KISS_FFT_SIN
(
pha£
);\

174 }0)

	)

176 
	#kf_˚xp2
(
x
,
pha£
) \

178 (
x
)->
r
 = 
TRIG_UPSCALE
*
	`˚…_cos_n‹m
((
pha£
));\

179 (
x
)->
i
 = 
TRIG_UPSCALE
*
	`˚…_cos_n‹m
((
pha£
)-32768);\

180 }0)

	)

	@celt/arch.h

34 #i‚de‡
ARCH_H


35 
	#ARCH_H


	)

37 
	~"›us_ty≥s.h
"

38 
	~"›us_deföes.h
"

40 #i‡!
deföed
(
__GNUC_PREREQ
)

41 #i‡
deföed
(
__GNUC__
)&&deföed(
__GNUC_MINOR__
)

42 
	#__GNUC_PREREQ
(
_maj
,
_mö
) \

43 ((
__GNUC__
<<16)+
__GNUC_MINOR__
>=((
_maj
)<<16)+(
_mö
))

	)

45 
	#__GNUC_PREREQ
(
_maj
,
_mö
Ë0

	)

49 #i‡
OPUS_GNUC_PREREQ
(3, 0)

50 
	#›us_likñy
(
x
Ë(
	`__buûtö_ex≥˘
(!!(x), 1))

	)

51 
	#›us_u∆ikñy
(
x
Ë(
	`__buûtö_ex≥˘
(!!(x), 0))

	)

53 
	#›us_likñy
(
x
Ë(!!(x))

	)

54 
	#›us_u∆ikñy
(
x
Ë(!!(x))

	)

57 
	#CELT_SIG_SCALE
 32768.f

	)

59 
	#CELT_FATAL
(
°r
Ë
	`˚…_Áèl
(°r, 
__FILE__
, 
__LINE__
);

	)

61 #i‡
deföed
(
ENABLE_ASSERTIONS
Ë|| deföed(
ENABLE_HARDENING
)

62 #ifde‡
__GNUC__


63 
__©åibuã__
((
n‹ëu∫
))

65 
˚…_Áèl
(c⁄° *
°r
, c⁄° *
fûe
, 
löe
);

67 #i‡
deföed
(
CELT_C
Ë&& !deföed(
OVERRIDE_˚…_Áèl
)

68 
	~<°dio.h
>

69 
	~<°dlib.h
>

70 #ifde‡
__GNUC__


71 
__©åibuã__
((
n‹ëu∫
))

73 
	$˚…_Áèl
(c⁄° *
°r
, c⁄° *
fûe
, 
löe
)

75 
	`Ârötf
 (
°dîr
, "F©Æ (öã∫ÆËîr‹ i¿%s,Üöê%d: %s\n", 
fûe
, 
löe
, 
°r
);

76 
	`ab‹t
();

77 
	}
}

80 
	#˚…_as£π
(
c⁄d
Ë{i‡(!(c⁄d)Ë{
	`CELT_FATAL
("as£πi⁄ faûed: " #c⁄d);}}

	)

81 
	#˚…_as£π2
(
c⁄d
, 
mesßge
Ë{i‡(!(c⁄d)Ë{
	`CELT_FATAL
("as£πi⁄ faûed: " #c⁄d "\n" mesßge);}}

	)

82 
	#MUST_SUCCEED
(
ˇŒ
Ë
	`˚…_as£π
((ˇŒË=
OPUS_OK
)

	)

84 
	#˚…_as£π
(
c⁄d
)

	)

85 
	#˚…_as£π2
(
c⁄d
, 
mesßge
)

	)

86 
	#MUST_SUCCEED
(
ˇŒ
Ëdÿ{if((ˇŒË!
OPUS_OK
Ë{
RESTORE_STACK
;  
OPUS_INTERNAL_ERROR
;} } 0)

	)

89 #i‡
deföed
(
ENABLE_ASSERTIONS
)

90 
	#˚…_sig_as£π
(
c⁄d
Ë{i‡(!(c⁄d)Ë{
	`CELT_FATAL
("sig«»as£πi⁄ faûed: " #c⁄d);}}

	)

92 
	#˚…_sig_as£π
(
c⁄d
)

	)

95 
	#IMUL32
(
a
,
b
Ë(◊)*(b))

	)

97 
	#MIN16
(
a
,
b
Ë(◊Ë< (bË? (aË: (b)Ë

	)

98 
	#MAX16
(
a
,
b
Ë(◊Ë> (bË? (aË: (b)Ë

	)

99 
	#MIN32
(
a
,
b
Ë(◊Ë< (bË? (aË: (b)Ë

	)

100 
	#MAX32
(
a
,
b
Ë(◊Ë> (bË? (aË: (b)Ë

	)

101 
	#IMIN
(
a
,
b
Ë(◊Ë< (bË? (aË: (b)Ë

	)

102 
	#IMAX
(
a
,
b
Ë(◊Ë> (bË? (aË: (b)Ë

	)

103 
	#UADD32
(
a
,
b
Ë(◊)+(b))

	)

104 
	#USUB32
(
a
,
b
Ë(◊)-(b))

	)

109 #i‡
deföed
(
__x86_64__
Ë|| deföed(
__LP64__
Ë|| deföed(
_WIN64
)

110 
	#OPUS_FAST_INT64
 1

	)

112 
	#OPUS_FAST_INT64
 0

	)

115 
	#PRINT_MIPS
(
fûe
)

	)

117 #ifde‡
FIXED_POINT


119 
›us_öt16
 
	t›us_vÆ16
;

120 
›us_öt32
 
	t›us_vÆ32
;

121 
›us_öt64
 
	t›us_vÆ64
;

123 
›us_vÆ32
 
	t˚…_sig
;

124 
›us_vÆ16
 
	t˚…_n‹m
;

125 
›us_vÆ32
 
	t˚…_íî
;

127 
	#˚…_i¢™
(
x
Ë0

	)

129 
	#Q15ONE
 32767

	)

131 
	#SIG_SHIFT
 12

	)

134 
	#SIG_SAT
 (300000000)

	)

136 
	#NORM_SCALING
 16384

	)

138 
	#DB_SHIFT
 10

	)

140 
	#EPSILON
 1

	)

141 
	#VERY_SMALL
 0

	)

142 
	#VERY_LARGE16
 ((
›us_vÆ16
)32767)

	)

143 
	#Q15_ONE
 ((
›us_vÆ16
)32767)

	)

145 
	#SCALEIN
(
a
Ë◊)

	)

146 
	#SCALEOUT
(
a
Ë◊)

	)

148 
	#ABS16
(
x
Ë((xË< 0 ? (-(x)Ë: (x))

	)

149 
	#ABS32
(
x
Ë((xË< 0 ? (-(x)Ë: (x))

	)

151 
OPUS_INLINE
 
›us_öt16
 
	$SAT16
(
›us_öt32
 
x
) {

152  
x
 > 32767 ? 32767 : x < -32768 ? -32768 : (
›us_öt16
)x;

153 
	}
}

155 #ifde‡
FIXED_DEBUG


156 
	~"fixed_debug.h
"

159 
	~"fixed_gíîic.h
"

161 #ifde‡
OPUS_ARM_PRESUME_AARCH64_NEON_INTR


162 
	~"¨m/fixed_¨m64.h
"

163 #ñi‡
deföed
 (
OPUS_ARM_INLINE_EDSP
)

164 
	~"¨m/fixed_¨mv5e.h
"

165 #ñi‡
deföed
 (
OPUS_ARM_INLINE_ASM
)

166 
	~"¨m/fixed_¨mv4.h
"

167 #ñi‡
deföed
 (
BFIN_ASM
)

168 
	~"fixed_bfö.h
"

169 #ñi‡
deföed
 (
TI_C5X_ASM
)

170 
	~"fixed_c5x.h
"

171 #ñi‡
deföed
 (
TI_C6X_ASM
)

172 
	~"fixed_c6x.h
"

179 
	t›us_vÆ16
;

180 
	t›us_vÆ32
;

181 
	t›us_vÆ64
;

183 
	t˚…_sig
;

184 
	t˚…_n‹m
;

185 
	t˚…_íî
;

187 #ifde‡
FLOAT_APPROX


190 
OPUS_INLINE
 
	$˚…_i¢™
(
x
)

192 uni⁄ {
f
; 
›us_uöt32
 
i
;} 
ö
;

193 
ö
.
f
 = 
x
;

194  ((
ö
.
i
>>23)&0xFF)==0xFF && (in.i&0x007FFFFF)!=0;

195 
	}
}

197 #ifde‡
__FAST_MATH__


198 #îr‹ 
C™nŸ
 
buûd
 
lib›us
 
wôh
 -
fÁ°
-
m©h
 
u∆ess
 
FLOAT_APPROX
 
is
 
deföed
. 
This
 
could
 
ªsu…
 
ö
 
¸ashes
 
⁄
 
exåeme
 (
e
.
g
. 
NaN
Ë
öput


200 
	#˚…_i¢™
(
x
Ë((x)!=(x))

	)

203 
	#Q15ONE
 1.0f

	)

205 
	#NORM_SCALING
 1.f

	)

207 
	#EPSILON
 1e-15f

	)

208 
	#VERY_SMALL
 1e-30f

	)

209 
	#VERY_LARGE16
 1e15f

	)

210 
	#Q15_ONE
 ((
›us_vÆ16
)1.f)

	)

213 
	#ABS16
(
x
Ë(()
	`Ábs
(x))

	)

214 
	#ABS32
(
x
Ë(()
	`Ábs
(x))

	)

216 
	#QCONST16
(
x
,
bôs
Ë(x)

	)

217 
	#QCONST32
(
x
,
bôs
Ë(x)

	)

219 
	#NEG16
(
x
Ë(-(x))

	)

220 
	#NEG32
(
x
Ë(-(x))

	)

221 
	#NEG32_ovÊw
(
x
Ë(-(x))

	)

222 
	#EXTRACT16
(
x
Ë(x)

	)

223 
	#EXTEND32
(
x
Ë(x)

	)

224 
	#SHR16
(
a
,
shi·
Ë◊)

	)

225 
	#SHL16
(
a
,
shi·
Ë◊)

	)

226 
	#SHR32
(
a
,
shi·
Ë◊)

	)

227 
	#SHL32
(
a
,
shi·
Ë◊)

	)

228 
	#PSHR32
(
a
,
shi·
Ë◊)

	)

229 
	#VSHR32
(
a
,
shi·
Ë◊)

	)

231 
	#PSHR
(
a
,
shi·
Ë◊)

	)

232 
	#SHR
(
a
,
shi·
Ë◊)

	)

233 
	#SHL
(
a
,
shi·
Ë◊)

	)

234 
	#SATURATE
(
x
,
a
Ë(x)

	)

235 
	#SATURATE16
(
x
Ë(x)

	)

237 
	#ROUND16
(
a
,
shi·
Ë◊)

	)

238 
	#SROUND16
(
a
,
shi·
Ë◊)

	)

239 
	#HALF16
(
x
Ë(.5f*(x))

	)

240 
	#HALF32
(
x
Ë(.5f*(x))

	)

242 
	#ADD16
(
a
,
b
Ë(◊)+(b))

	)

243 
	#SUB16
(
a
,
b
Ë(◊)-(b))

	)

244 
	#ADD32
(
a
,
b
Ë(◊)+(b))

	)

245 
	#SUB32
(
a
,
b
Ë(◊)-(b))

	)

246 
	#ADD32_ovÊw
(
a
,
b
Ë(◊)+(b))

	)

247 
	#SUB32_ovÊw
(
a
,
b
Ë(◊)-(b))

	)

248 
	#MULT16_16_16
(
a
,
b
Ë(◊)*(b))

	)

249 
	#MULT16_16
(
a
,
b
Ë((
›us_vÆ32
)◊)*(›us_vÆ32)(b))

	)

250 
	#MAC16_16
(
c
,
a
,
b
Ë((c)+(
›us_vÆ32
)◊)*(›us_vÆ32)(b))

	)

252 
	#MULT16_32_Q15
(
a
,
b
Ë(◊)*(b))

	)

253 
	#MULT16_32_Q16
(
a
,
b
Ë(◊)*(b))

	)

255 
	#MULT32_32_Q31
(
a
,
b
Ë(◊)*(b))

	)

257 
	#MAC16_32_Q15
(
c
,
a
,
b
Ë((c)+◊)*(b))

	)

258 
	#MAC16_32_Q16
(
c
,
a
,
b
Ë((c)+◊)*(b))

	)

260 
	#MULT16_16_Q11_32
(
a
,
b
Ë(◊)*(b))

	)

261 
	#MULT16_16_Q11
(
a
,
b
Ë(◊)*(b))

	)

262 
	#MULT16_16_Q13
(
a
,
b
Ë(◊)*(b))

	)

263 
	#MULT16_16_Q14
(
a
,
b
Ë(◊)*(b))

	)

264 
	#MULT16_16_Q15
(
a
,
b
Ë(◊)*(b))

	)

265 
	#MULT16_16_P15
(
a
,
b
Ë(◊)*(b))

	)

266 
	#MULT16_16_P13
(
a
,
b
Ë(◊)*(b))

	)

267 
	#MULT16_16_P14
(
a
,
b
Ë(◊)*(b))

	)

268 
	#MULT16_32_P16
(
a
,
b
Ë(◊)*(b))

	)

270 
	#DIV32_16
(
a
,
b
Ë(((
›us_vÆ32
)◊))/(
›us_vÆ16
)(b))

	)

271 
	#DIV32
(
a
,
b
Ë(((
›us_vÆ32
)◊))/(›us_vÆ32)(b))

	)

273 
	#SCALEIN
(
a
Ë(◊)*
CELT_SIG_SCALE
)

	)

274 
	#SCALEOUT
(
a
Ë(◊)*(1/
CELT_SIG_SCALE
))

	)

276 
	#SIG2WORD16
(
x
Ë(x)

	)

280 #i‚de‡
GLOBAL_STACK_SIZE


281 #ifde‡
FIXED_POINT


282 
	#GLOBAL_STACK_SIZE
 120000

	)

284 
	#GLOBAL_STACK_SIZE
 120000

	)

	@celt/arm/arm_celt_map.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"pôch.h
"

33 
	~"kiss_f·.h
"

34 
	~"md˘.h
"

36 #i‡
deföed
(
OPUS_HAVE_RTCD
)

38 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
)

39 
›us_vÆ32
 (*c⁄° 
CELT_INNER_PROD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *
	gx
, c⁄° opus_vÆ16 *
	gy
, 
	gN
) = {

40 
˚…_ö√r_¥od_c
,

41 
˚…_ö√r_¥od_c
,

42 
˚…_ö√r_¥od_c
,

43 
˚…_ö√r_¥od_√⁄


46 (*c⁄° 
	gDUAL_INNER_PROD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *
	gx
, c⁄° opus_vÆ16 *
	gy01
, c⁄° opus_vÆ16 *
	gy02
,

47 
	gN
, 
›us_vÆ32
 *
	gxy1
, opus_vÆ32 *
	gxy2
) = {

48 
duÆ_ö√r_¥od_c
,

49 
duÆ_ö√r_¥od_c
,

50 
duÆ_ö√r_¥od_c
,

51 
duÆ_ö√r_¥od_√⁄


55 #i‡
deföed
(
FIXED_POINT
)

56 #i‡((
deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON
)) || \

57 (
deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
Ë&& !deföed(
OPUS_ARM_PRESUME_MEDIA
)) || \

58 (
deföed
(
OPUS_ARM_MAY_HAVE_EDSP
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_EDSP
)))

59 
	`›us_vÆ32
 (*c⁄° 
CELT_PITCH_XCORR_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *,

60 c⁄° 
›us_vÆ16
 *, 
›us_vÆ32
 *, , , ) = {

61 
˚…_pôch_xc‹r_c
,

62 
	`MAY_HAVE_EDSP
(
˚…_pôch_xc‹r
),

63 
	`MAY_HAVE_MEDIA
(
˚…_pôch_xc‹r
),

64 
	`MAY_HAVE_NEON
(
˚…_pôch_xc‹r
)

65 
	}
};

69 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
)

70 (*c⁄° 
	gCELT_PITCH_XCORR_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
	g›us_vÆ16
 *,

71 c⁄° 
	g›us_vÆ16
 *, 
	g›us_vÆ32
 *, , , ) = {

72 
˚…_pôch_xc‹r_c
,

73 
˚…_pôch_xc‹r_c
,

74 
˚…_pôch_xc‹r_c
,

75 
˚…_pôch_xc‹r_Êﬂt_√⁄


80 #i‡
deföed
(
FIXED_POINT
Ë&& deföed(
OPUS_HAVE_RTCD
) && \

81 
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

83 (*c⁄° 
XCORR_KERNEL_IMPL
[
OPUS_ARCHMASK
 + 1])(

84 c⁄° 
›us_vÆ16
 *
x
,

85 c⁄° 
›us_vÆ16
 *
y
,

86 
›us_vÆ32
 
sum
[4],

87 
Àn


89 
xc‹r_kî√l_c
,

90 
xc‹r_kî√l_c
,

91 
xc‹r_kî√l_c
,

92 
xc‹r_kî√l_√⁄_fixed
,

93 
	}
};

97 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

98 #i‡
deföed
(
HAVE_ARM_NE10
)

99 #i‡
deföed
(
CUSTOM_MODES
)

100 (*c⁄° 
	gOPUS_FFT_ALLOC_ARCH_IMPL
[
OPUS_ARCHMASK
+1])(
kiss_f·_°©e
 *
	g°
) = {

101 
›us_f·_Æloc_¨ch_c
,

102 
›us_f·_Æloc_¨ch_c
,

103 
›us_f·_Æloc_¨ch_c
,

104 
›us_f·_Æloc_¨m_√⁄


107 (*c⁄° 
	gOPUS_FFT_FREE_ARCH_IMPL
[
OPUS_ARCHMASK
+1])(
kiss_f·_°©e
 *
	g°
) = {

108 
›us_f·_‰ì_¨ch_c
,

109 
›us_f·_‰ì_¨ch_c
,

110 
›us_f·_‰ì_¨ch_c
,

111 
›us_f·_‰ì_¨m_√⁄


115 (*c⁄° 
	gOPUS_FFT
[
OPUS_ARCHMASK
+1])(c⁄° 
kiss_f·_°©e
 *
	gcfg
,

116 c⁄° 
kiss_f·_˝x
 *
	gfö
,

117 
kiss_f·_˝x
 *
	gfout
) = {

118 
›us_f·_c
,

119 
›us_f·_c
,

120 
›us_f·_c
,

121 
›us_f·_√⁄


124 (*c⁄° 
	gOPUS_IFFT
[
OPUS_ARCHMASK
+1])(c⁄° 
kiss_f·_°©e
 *
	gcfg
,

125 c⁄° 
kiss_f·_˝x
 *
	gfö
,

126 
kiss_f·_˝x
 *
	gfout
) = {

127 
›us_if·_c
,

128 
›us_if·_c
,

129 
›us_if·_c
,

130 
›us_if·_√⁄


133 (*c⁄° 
	gCLT_MDCT_FORWARD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
md˘_lookup
 *
	gl
,

134 
kiss_f·_sˇœr
 *
	gö
,

135 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
	gout
,

136 c⁄° 
›us_vÆ16
 *
	gwödow
,

137 
	govîœp
, 
	gshi·
,

138 
	g°ride
, 
	g¨ch
) = {

139 
˛t_md˘_f‹w¨d_c
,

140 
˛t_md˘_f‹w¨d_c
,

141 
˛t_md˘_f‹w¨d_c
,

142 
˛t_md˘_f‹w¨d_√⁄


145 (*c⁄° 
	gCLT_MDCT_BACKWARD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
md˘_lookup
 *
	gl
,

146 
kiss_f·_sˇœr
 *
	gö
,

147 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
	gout
,

148 c⁄° 
›us_vÆ16
 *
	gwödow
,

149 
	govîœp
, 
	gshi·
,

150 
	g°ride
, 
	g¨ch
) = {

151 
˛t_md˘_backw¨d_c
,

152 
˛t_md˘_backw¨d_c
,

153 
˛t_md˘_backw¨d_c
,

154 
˛t_md˘_backw¨d_√⁄


	@celt/arm/armcpu.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 #ifde‡
OPUS_HAVE_RTCD


36 
	~"¨m˝u.h
"

37 
	~"˝u_suµ‹t.h
"

38 
	~"os_suµ‹t.h
"

39 
	~"›us_ty≥s.h
"

40 
	~"¨ch.h
"

42 
	#OPUS_CPU_ARM_V4_FLAG
 (1<<
OPUS_ARCH_ARM_V4
)

	)

43 
	#OPUS_CPU_ARM_EDSP_FLAG
 (1<<
OPUS_ARCH_ARM_EDSP
)

	)

44 
	#OPUS_CPU_ARM_MEDIA_FLAG
 (1<<
OPUS_ARCH_ARM_MEDIA
)

	)

45 
	#OPUS_CPU_ARM_NEON_FLAG
 (1<<
OPUS_ARCH_ARM_NEON
)

	)

47 #i‡
deföed
(
_MSC_VER
)

49 
	#WIN32_LEAN_AND_MEAN


	)

50 
	#WIN32_EXTRA_LEAN


	)

51 
	~<wödows.h
>

53 
OPUS_INLINE
 
›us_uöt32
 
	$›us_˝u_ˇ∑bûôõs
(){

54 
›us_uöt32
 
Êags
;

55 
Êags
=0;

59 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_EDSP
Ë|| deföed(
OPUS_ARM_MAY_HAVE_MEDIA
) \

60 || 
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

61 
__åy
{

63 
	`__emô
(0xF5DDF000);

64 
Êags
|=
OPUS_CPU_ARM_EDSP_FLAG
;

66 
	`__ex˚±
(
	`GëEx˚±i⁄Code
()==
EXCEPTION_ILLEGAL_INSTRUCTION
){

69 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
) \

70 || 
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

71 
__åy
{

73 
	`__emô
(0xE6333F93);

74 
Êags
|=
OPUS_CPU_ARM_MEDIA_FLAG
;

76 
	`__ex˚±
(
	`GëEx˚±i⁄Code
()==
EXCEPTION_ILLEGAL_INSTRUCTION
){

79 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

80 
__åy
{

82 
	`__emô
(0xF2200150);

83 
Êags
|=
OPUS_CPU_ARM_NEON_FLAG
;

85 
	`__ex˚±
(
	`GëEx˚±i⁄Code
()==
EXCEPTION_ILLEGAL_INSTRUCTION
){

91  
Êags
;

92 
	}
}

94 #ñi‡
deföed
(
__löux__
)

96 
›us_uöt32
 
	$›us_˝u_ˇ∑bûôõs
()

98 
›us_uöt32
 
Êags
 = 0;

99 
FILE
 *
˝uöfo
;

103 
˝uöfo
 = 
	`f›í
("/proc/cpuinfo", "r");

105 if(
˝uöfo
 !
NULL
)

109 
buf
[512];

111 
	`fgës
(
buf
, 512, 
˝uöfo
Ë!
NULL
)

113 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_EDSP
Ë|| deföed(
OPUS_ARM_MAY_HAVE_MEDIA
) \

114 || 
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

116 if(
	`memcmp
(
buf
, "Features", 8) == 0)

118 *
p
;

119 
p
 = 
	`°r°r
(
buf
, "Édsp");

120 if(
p
 !
NULL
 && (p[5] == ' ' ||Ö[5] == '\n'))

121 
Êags
 |
OPUS_CPU_ARM_EDSP_FLAG
;

123 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

124 
p
 = 
	`°r°r
(
buf
, "Çeon");

125 if(
p
 !
NULL
 && (p[5] == ' ' ||Ö[5] == '\n'))

126 
Êags
 |
OPUS_CPU_ARM_NEON_FLAG
;

131 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
) \

132 || 
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

134 if(
	`memcmp
(
buf
, "CPUárchitecture:", 17) == 0)

136 
vîsi⁄
;

137 
vîsi⁄
 = 
	`©oi
(
buf
+17);

139 if(
vîsi⁄
 >= 6)

140 
Êags
 |
OPUS_CPU_ARM_MEDIA_FLAG
;

145 
	`f˛o£
(
˝uöfo
);

147  
Êags
;

148 
	}
}

157 
	$›us_£À˘_¨ch
()

159 
›us_uöt32
 
Êags
 = 
	`›us_˝u_ˇ∑bûôõs
();

160 
¨ch
 = 0;

162 if(!(
Êags
 & 
OPUS_CPU_ARM_EDSP_FLAG
)) {

164 
	`˚…_as£π
(
¨ch
 =
OPUS_ARCH_ARM_V4
);

165  
¨ch
;

167 
¨ch
++;

169 if(!(
Êags
 & 
OPUS_CPU_ARM_MEDIA_FLAG
)) {

170 
	`˚…_as£π
(
¨ch
 =
OPUS_ARCH_ARM_EDSP
);

171  
¨ch
;

173 
¨ch
++;

175 if(!(
Êags
 & 
OPUS_CPU_ARM_NEON_FLAG
)) {

176 
	`˚…_as£π
(
¨ch
 =
OPUS_ARCH_ARM_MEDIA
);

177  
¨ch
;

179 
¨ch
++;

181 
	`˚…_as£π
(
¨ch
 =
OPUS_ARCH_ARM_NEON
);

182  
¨ch
;

183 
	}
}

	@celt/arm/armcpu.h

28 #i‡!
deföed
(
ARMCPU_H
)

29 
	#ARMCPU_H


	)

31 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_EDSP
)

32 
	#MAY_HAVE_EDSP
(
«me
Ë«mê## 
_ed•


	)

34 
	#MAY_HAVE_EDSP
(
«me
Ë«mê## 
_c


	)

37 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
)

38 
	#MAY_HAVE_MEDIA
(
«me
Ë«mê## 
_medü


	)

40 
	#MAY_HAVE_MEDIA
(
«me
Ë
	`MAY_HAVE_EDSP
“ame)

	)

43 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON
)

44 
	#MAY_HAVE_NEON
(
«me
Ë«mê## 
_√⁄


	)

46 
	#MAY_HAVE_NEON
(
«me
Ë
	`MAY_HAVE_MEDIA
“ame)

	)

49 #i‡
deföed
(
OPUS_ARM_PRESUME_EDSP
)

50 
	#PRESUME_EDSP
(
«me
Ë«mê## 
_ed•


	)

52 
	#PRESUME_EDSP
(
«me
Ë«mê## 
_c


	)

55 #i‡
deföed
(
OPUS_ARM_PRESUME_MEDIA
)

56 
	#PRESUME_MEDIA
(
«me
Ë«mê## 
_medü


	)

58 
	#PRESUME_MEDIA
(
«me
Ë
	`PRESUME_EDSP
“ame)

	)

61 #i‡
deföed
(
OPUS_ARM_PRESUME_NEON
)

62 
	#PRESUME_NEON
(
«me
Ë«mê## 
_√⁄


	)

64 
	#PRESUME_NEON
(
«me
Ë
	`PRESUME_MEDIA
“ame)

	)

67 #i‡
deföed
(
OPUS_HAVE_RTCD
)

68 
›us_£À˘_¨ch
();

70 
	#OPUS_ARCH_ARM_V4
 (0)

	)

71 
	#OPUS_ARCH_ARM_EDSP
 (1)

	)

72 
	#OPUS_ARCH_ARM_MEDIA
 (2)

	)

73 
	#OPUS_ARCH_ARM_NEON
 (3)

	)

	@celt/arm/celt_fft_ne10.c

33 #i‚de‡
SKIP_CONFIG_H


34 #ifde‡
HAVE_CONFIG_H


35 
	~"c⁄fig.h
"

39 
	~<NE10_d•.h
>

40 
	~"os_suµ‹t.h
"

41 
	~"kiss_f·.h
"

42 
	~"°ack_Æloc.h
"

44 #i‡!
deföed
(
FIXED_POINT
)

45 
	#NE10_FFT_ALLOC_C2C_TYPE_NEON
 
√10_f·_Æloc_c2c_Êﬂt32_√⁄


	)

46 
	#NE10_FFT_CFG_TYPE_T
 
√10_f·_cfg_Êﬂt32_t


	)

47 
	#NE10_FFT_STATE_TYPE_T
 
√10_f·_°©e_Êﬂt32_t


	)

48 
	#NE10_FFT_DESTROY_C2C_TYPE
 
√10_f·_de°roy_c2c_Êﬂt32


	)

49 
	#NE10_FFT_CPX_TYPE_T
 
√10_f·_˝x_Êﬂt32_t


	)

50 
	#NE10_FFT_C2C_1D_TYPE_NEON
 
√10_f·_c2c_1d_Êﬂt32_√⁄


	)

52 
	#NE10_FFT_ALLOC_C2C_TYPE_NEON
(
nf·
Ë
	`√10_f·_Æloc_c2c_öt32_√⁄
“f·)

	)

53 
	#NE10_FFT_CFG_TYPE_T
 
√10_f·_cfg_öt32_t


	)

54 
	#NE10_FFT_STATE_TYPE_T
 
√10_f·_°©e_öt32_t


	)

55 
	#NE10_FFT_DESTROY_C2C_TYPE
 
√10_f·_de°roy_c2c_öt32


	)

56 
	#NE10_FFT_DESTROY_C2C_TYPE
 
√10_f·_de°roy_c2c_öt32


	)

57 
	#NE10_FFT_CPX_TYPE_T
 
√10_f·_˝x_öt32_t


	)

58 
	#NE10_FFT_C2C_1D_TYPE_NEON
 
√10_f·_c2c_1d_öt32_√⁄


	)

61 #i‡
deföed
(
CUSTOM_MODES
)

64 
	#NE10_FFTSCALED_SUPPORT_MAX
 4

	)

65 c⁄° 
	g√10_f·_sˇÀd_suµ‹t
[
NE10_FFTSCALED_SUPPORT_MAX
] = {

69 
	$›us_f·_Æloc_¨m_√⁄
(
kiss_f·_°©e
 *
°
)

71 
i
;

72 
size_t
 
mem√eded
 = (
¨ch_f·_°©e
);

74 
°
->
¨ch_f·
 = (
¨ch_f·_°©e
 *)
	`›us_Æloc
(
mem√eded
);

75 i‡(!
°
->
¨ch_f·
)

78 
i
 = 0; i < 
NE10_FFTSCALED_SUPPORT_MAX
; i++) {

79 if(
°
->
nf·
 =
√10_f·_sˇÀd_suµ‹t
[
i
])

82 i‡(
i
 =
NE10_FFTSCALED_SUPPORT_MAX
) {

84 
°
->
¨ch_f·
->
is_suµ‹ãd
 = 0;

85 
°
->
¨ch_f·
->
¥iv
 = 
NULL
;

88 
°
->
¨ch_f·
->
is_suµ‹ãd
 = 1;

89 
°
->
¨ch_f·
->
¥iv
 = (*)
	`NE10_FFT_ALLOC_C2C_TYPE_NEON
(°->
nf·
);

90 i‡(
°
->
¨ch_f·
->
¥iv
 =
NULL
) {

95 
	}
}

97 
	$›us_f·_‰ì_¨m_√⁄
(
kiss_f·_°©e
 *
°
)

99 
NE10_FFT_CFG_TYPE_T
 
cfg
;

101 i‡(!
°
->
¨ch_f·
)

104 
cfg
 = (
NE10_FFT_CFG_TYPE_T
)
°
->
¨ch_f·
->
¥iv
;

105 i‡(
cfg
)

106 
	`NE10_FFT_DESTROY_C2C_TYPE
(
cfg
);

107 
	`›us_‰ì
(
°
->
¨ch_f·
);

108 
	}
}

111 
	$›us_f·_√⁄
(c⁄° 
kiss_f·_°©e
 *
°
,

112 c⁄° 
kiss_f·_˝x
 *
fö
,

113 
kiss_f·_˝x
 *
fout
)

115 
NE10_FFT_STATE_TYPE_T
 
°©e
;

116 
NE10_FFT_CFG_TYPE_T
 
cfg
 = &
°©e
;

117 
	`VARDECL
(
NE10_FFT_CPX_TYPE_T
, 
buf„r
);

118 
SAVE_STACK
;

119 
	`ALLOC
(
buf„r
, 
°
->
nf·
, 
NE10_FFT_CPX_TYPE_T
);

121 i‡(!
°
->
¨ch_f·
->
is_suµ‹ãd
) {

123 
	`›us_f·_c
(
°
, 
fö
, 
fout
);

126 
	`mem˝y
((*)
cfg
, 
°
->
¨ch_f·
->
¥iv
, (
NE10_FFT_STATE_TYPE_T
));

127 
°©e
.
buf„r
 = (
NE10_FFT_CPX_TYPE_T
 *)&buffer[0];

128 #i‡!
	`deföed
(
FIXED_POINT
)

129 
°©e
.
is_f‹w¨d_sˇÀd
 = 1;

131 
	`NE10_FFT_C2C_1D_TYPE_NEON
((
NE10_FFT_CPX_TYPE_T
 *)
fout
,

132 (
NE10_FFT_CPX_TYPE_T
 *)
fö
,

133 
cfg
, 0);

135 
	`NE10_FFT_C2C_1D_TYPE_NEON
((
NE10_FFT_CPX_TYPE_T
 *)
fout
,

136 (
NE10_FFT_CPX_TYPE_T
 *)
fö
,

137 
cfg
, 0, 1);

140 
RESTORE_STACK
;

141 
	}
}

143 
	$›us_if·_√⁄
(c⁄° 
kiss_f·_°©e
 *
°
,

144 c⁄° 
kiss_f·_˝x
 *
fö
,

145 
kiss_f·_˝x
 *
fout
)

147 
NE10_FFT_STATE_TYPE_T
 
°©e
;

148 
NE10_FFT_CFG_TYPE_T
 
cfg
 = &
°©e
;

149 
	`VARDECL
(
NE10_FFT_CPX_TYPE_T
, 
buf„r
);

150 
SAVE_STACK
;

151 
	`ALLOC
(
buf„r
, 
°
->
nf·
, 
NE10_FFT_CPX_TYPE_T
);

153 i‡(!
°
->
¨ch_f·
->
is_suµ‹ãd
) {

155 
	`›us_if·_c
(
°
, 
fö
, 
fout
);

158 
	`mem˝y
((*)
cfg
, 
°
->
¨ch_f·
->
¥iv
, (
NE10_FFT_STATE_TYPE_T
));

159 
°©e
.
buf„r
 = (
NE10_FFT_CPX_TYPE_T
 *)&buffer[0];

160 #i‡!
	`deföed
(
FIXED_POINT
)

161 
°©e
.
is_backw¨d_sˇÀd
 = 0;

163 
	`NE10_FFT_C2C_1D_TYPE_NEON
((
NE10_FFT_CPX_TYPE_T
 *)
fout
,

164 (
NE10_FFT_CPX_TYPE_T
 *)
fö
,

165 
cfg
, 1);

167 
	`NE10_FFT_C2C_1D_TYPE_NEON
((
NE10_FFT_CPX_TYPE_T
 *)
fout
,

168 (
NE10_FFT_CPX_TYPE_T
 *)
fö
,

169 
cfg
, 1, 0);

172 
RESTORE_STACK
;

173 
	}
}

	@celt/arm/celt_mdct_ne10.c

33 #i‚de‡
SKIP_CONFIG_H


34 #ifde‡
HAVE_CONFIG_H


35 
	~"c⁄fig.h
"

39 
	~"kiss_f·.h
"

40 
	~"_kiss_f·_guts.h
"

41 
	~"md˘.h
"

42 
	~"°ack_Æloc.h
"

44 
	$˛t_md˘_f‹w¨d_√⁄
(c⁄° 
md˘_lookup
 *
l
,

45 
kiss_f·_sˇœr
 *
ö
,

46 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

47 c⁄° 
›us_vÆ16
 *
wödow
,

48 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

50 
i
;

51 
N
, 
N2
, 
N4
;

52 
	`VARDECL
(
kiss_f·_sˇœr
, 
f
);

53 
	`VARDECL
(
kiss_f·_˝x
, 
f2
);

54 c⁄° 
kiss_f·_°©e
 *
°
 = 
l
->
kf·
[
shi·
];

55 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

57 
SAVE_STACK
;

59 
N
 = 
l
->
n
;

60 
åig
 = 
l
->trig;

61 
i
=0;i<
shi·
;i++)

63 
N
 >>= 1;

64 
åig
 +
N
;

66 
N2
 = 
N
>>1;

67 
N4
 = 
N
>>2;

69 
	`ALLOC
(
f
, 
N2
, 
kiss_f·_sˇœr
);

70 
	`ALLOC
(
f2
, 
N4
, 
kiss_f·_˝x
);

76 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
+(
ovîœp
>>1);

77 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
N2
-1+(
ovîœp
>>1);

78 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

79 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
+(
ovîœp
>>1);

80 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+(
ovîœp
>>1)-1;

81 
i
=0;i<((
ovîœp
+3)>>2);i++)

84 *
yp
++ = 
	`MULT16_32_Q15
(*
wp2
, 
xp1
[
N2
]Ë+ MULT16_32_Q15(*
wp1
,*
xp2
);

85 *
yp
++ = 
	`MULT16_32_Q15
(*
wp1
, *
xp1
Ë- MULT16_32_Q15(*
wp2
, 
xp2
[-
N2
]);

86 
xp1
+=2;

87 
xp2
-=2;

88 
wp1
+=2;

89 
wp2
-=2;

91 
wp1
 = 
wödow
;

92 
wp2
 = 
wödow
+
ovîœp
-1;

93 ;
i
<
N4
-((
ovîœp
+3)>>2);i++)

96 *
yp
++ = *
xp2
;

97 *
yp
++ = *
xp1
;

98 
xp1
+=2;

99 
xp2
-=2;

101 ;
i
<
N4
;i++)

104 *
yp
++ = -
	`MULT16_32_Q15
(*
wp1
, 
xp1
[-
N2
]Ë+ MULT16_32_Q15(*
wp2
, *
xp2
);

105 *
yp
++ = 
	`MULT16_32_Q15
(*
wp2
, *
xp1
Ë+ MULT16_32_Q15(*
wp1
, 
xp2
[
N2
]);

106 
xp1
+=2;

107 
xp2
-=2;

108 
wp1
+=2;

109 
wp2
-=2;

114 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

115 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

116 
i
=0;i<
N4
;i++)

118 
kiss_f·_˝x
 
yc
;

119 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

120 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

121 
t0
 = 
t
[
i
];

122 
t1
 = 
t
[
N4
+
i
];

123 
ª
 = *
yp
++;

124 
im
 = *
yp
++;

125 
yr
 = 
	`S_MUL
(
ª
,
t0
Ë- S_MUL(
im
,
t1
);

126 
yi
 = 
	`S_MUL
(
im
,
t0
Ë+ S_MUL(
ª
,
t1
);

127 
yc
.
r
 = 
yr
;

128 
yc
.
i
 = 
yi
;

129 
f2
[
i
] = 
yc
;

133 
	`›us_f·
(
°
, 
f2
, (
kiss_f·_˝x
 *)
f
, 
¨ch
);

138 c⁄° 
kiss_f·_˝x
 * 
OPUS_RESTRICT
 
Â
 = (kiss_f·_˝x *)
f
;

139 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

140 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp2
 = 
out
+
°ride
*(
N2
-1);

141 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

143 
i
=0;i<
N4
;i++)

145 
kiss_f·_sˇœr
 
yr
, 
yi
;

146 
yr
 = 
	`S_MUL
(
Â
->
i
,
t
[
N4
+i]Ë- S_MUL(Â->
r
,t[i]);

147 
yi
 = 
	`S_MUL
(
Â
->
r
,
t
[
N4
+
i
]) + S_MUL(fp->i,t[i]);

148 *
yp1
 = 
yr
;

149 *
yp2
 = 
yi
;

150 
Â
++;

151 
yp1
 +2*
°ride
;

152 
yp2
 -2*
°ride
;

155 
RESTORE_STACK
;

156 
	}
}

158 
	$˛t_md˘_backw¨d_√⁄
(c⁄° 
md˘_lookup
 *
l
,

159 
kiss_f·_sˇœr
 *
ö
,

160 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

161 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wödow
,

162 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

164 
i
;

165 
N
, 
N2
, 
N4
;

166 
	`VARDECL
(
kiss_f·_sˇœr
, 
f
);

167 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

168 c⁄° 
kiss_f·_°©e
 *
°
 = 
l
->
kf·
[
shi·
];

170 
N
 = 
l
->
n
;

171 
åig
 = 
l
->trig;

172 
i
=0;i<
shi·
;i++)

174 
N
 >>= 1;

175 
åig
 +
N
;

177 
N2
 = 
N
>>1;

178 
N4
 = 
N
>>2;

180 
	`ALLOC
(
f
, 
N2
, 
kiss_f·_sˇœr
);

185 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
;

186 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
°ride
*(
N2
-1);

187 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

188 c⁄° 
kiss_twiddÀ_sˇœr
 * 
OPUS_RESTRICT
 
t
 = &
åig
[0];

189 
i
=0;i<
N4
;i++)

191 
kiss_f·_sˇœr
 
yr
, 
yi
;

192 
yr
 = 
	`S_MUL
(*
xp2
, 
t
[
i
]Ë+ S_MUL(*
xp1
,Å[
N4
+i]);

193 
yi
 = 
	`S_MUL
(*
xp1
, 
t
[
i
]Ë- S_MUL(*
xp2
,Å[
N4
+i]);

194 
yp
[2*
i
] = 
yr
;

195 
yp
[2*
i
+1] = 
yi
;

196 
xp1
+=2*
°ride
;

197 
xp2
-=2*
°ride
;

201 
	`›us_if·
(
°
, (
kiss_f·_˝x
 *)
f
, (kiss_f·_˝x*)(
out
+(
ovîœp
>>1)), 
¨ch
);

206 
kiss_f·_sˇœr
 * 
yp0
 = 
out
+(
ovîœp
>>1);

207 
kiss_f·_sˇœr
 * 
yp1
 = 
out
+(
ovîœp
>>1)+
N2
-2;

208 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

211 
i
=0;i<(
N4
+1)>>1;i++)

213 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

214 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

215 
ª
 = 
yp0
[0];

216 
im
 = 
yp0
[1];

217 
t0
 = 
t
[
i
];

218 
t1
 = 
t
[
N4
+
i
];

220 
yr
 = 
	`S_MUL
(
ª
,
t0
Ë+ S_MUL(
im
,
t1
);

221 
yi
 = 
	`S_MUL
(
ª
,
t1
Ë- S_MUL(
im
,
t0
);

222 
ª
 = 
yp1
[0];

223 
im
 = 
yp1
[1];

224 
yp0
[0] = 
yr
;

225 
yp1
[1] = 
yi
;

227 
t0
 = 
t
[(
N4
-
i
-1)];

228 
t1
 = 
t
[(
N2
-
i
-1)];

230 
yr
 = 
	`S_MUL
(
ª
,
t0
Ë+ S_MUL(
im
,
t1
);

231 
yi
 = 
	`S_MUL
(
ª
,
t1
Ë- S_MUL(
im
,
t0
);

232 
yp1
[0] = 
yr
;

233 
yp0
[1] = 
yi
;

234 
yp0
 += 2;

235 
yp1
 -= 2;

241 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
out
+
ovîœp
-1;

242 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

243 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
;

244 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+
ovîœp
-1;

246 
i
 = 0; i < 
ovîœp
/2; i++)

248 
kiss_f·_sˇœr
 
x1
, 
x2
;

249 
x1
 = *
xp1
;

250 
x2
 = *
yp1
;

251 *
yp1
++ = 
	`MULT16_32_Q15
(*
wp2
, 
x2
Ë- MULT16_32_Q15(*
wp1
, 
x1
);

252 *
xp1
-- = 
	`MULT16_32_Q15
(*
wp1
, 
x2
Ë+ MULT16_32_Q15(*
wp2
, 
x1
);

253 
wp1
++;

254 
wp2
--;

257 
RESTORE_STACK
;

258 
	}
}

	@celt/arm/celt_neon_intr.c

33 #ifde‡
HAVE_CONFIG_H


34 
	~"c⁄fig.h
"

37 
	~<¨m_√⁄.h
>

38 
	~"../pôch.h
"

40 #i‡
deföed
(
FIXED_POINT
)

41 
	$xc‹r_kî√l_√⁄_fixed
(c⁄° 
›us_vÆ16
 * 
x
, c⁄° opus_vÆ16 * 
y
, 
›us_vÆ32
 
sum
[4], 
Àn
)

43 
j
;

44 
öt32x4_t
 
a
 = 
	`vld1q_s32
(
sum
);

47 
öt16x4_t
 
y0
 = 
	`vld1_s16
(
y
);

48 
y
 += 4;

50 
j
 = 0; j + 8 <
Àn
; j += 8)

53 
öt16x8_t
 
xx
 = 
	`vld1q_s16
(
x
);

54 
öt16x4_t
 
x0
 = 
	`vgë_low_s16
(
xx
);

55 
öt16x4_t
 
x4
 = 
	`vgë_high_s16
(
xx
);

57 
öt16x8_t
 
yy
 = 
	`vld1q_s16
(
y
);

58 
öt16x4_t
 
y4
 = 
	`vgë_low_s16
(
yy
);

59 
öt16x4_t
 
y8
 = 
	`vgë_high_s16
(
yy
);

60 
öt32x4_t
 
a0
 = 
	`vmœl_œ√_s16
(
a
, 
y0
, 
x0
, 0);

61 
öt32x4_t
 
a1
 = 
	`vmœl_œ√_s16
(
a0
, 
y4
, 
x4
, 0);

63 
öt16x4_t
 
y1
 = 
	`vext_s16
(
y0
, 
y4
, 1);

64 
öt16x4_t
 
y5
 = 
	`vext_s16
(
y4
, 
y8
, 1);

65 
öt32x4_t
 
a2
 = 
	`vmœl_œ√_s16
(
a1
, 
y1
, 
x0
, 1);

66 
öt32x4_t
 
a3
 = 
	`vmœl_œ√_s16
(
a2
, 
y5
, 
x4
, 1);

68 
öt16x4_t
 
y2
 = 
	`vext_s16
(
y0
, 
y4
, 2);

69 
öt16x4_t
 
y6
 = 
	`vext_s16
(
y4
, 
y8
, 2);

70 
öt32x4_t
 
a4
 = 
	`vmœl_œ√_s16
(
a3
, 
y2
, 
x0
, 2);

71 
öt32x4_t
 
a5
 = 
	`vmœl_œ√_s16
(
a4
, 
y6
, 
x4
, 2);

73 
öt16x4_t
 
y3
 = 
	`vext_s16
(
y0
, 
y4
, 3);

74 
öt16x4_t
 
y7
 = 
	`vext_s16
(
y4
, 
y8
, 3);

75 
öt32x4_t
 
a6
 = 
	`vmœl_œ√_s16
(
a5
, 
y3
, 
x0
, 3);

76 
öt32x4_t
 
a7
 = 
	`vmœl_œ√_s16
(
a6
, 
y7
, 
x4
, 3);

78 
y0
 = 
y8
;

79 
a
 = 
a7
;

80 
x
 += 8;

81 
y
 += 8;

84 ; 
j
 < 
Àn
; j++)

86 
öt16x4_t
 
x0
 = 
	`vld1_dup_s16
(
x
);

87 
öt32x4_t
 
a0
 = 
	`vmœl_s16
(
a
, 
y0
, 
x0
);

89 
öt16x4_t
 
y4
 = 
	`vld1_dup_s16
(
y
);

90 
y0
 = 
	`vext_s16
(y0, 
y4
, 1);

91 
a
 = 
a0
;

92 
x
++;

93 
y
++;

96 
	`v°1q_s32
(
sum
, 
a
);

97 
	}
}

105 
	$xc‹r_kî√l_√⁄_Êﬂt
(c⁄° 
Êﬂt32_t
 *
x
, c⁄° flﬂt32_à*
y
,

106 
Êﬂt32_t
 
sum
[4], 
Àn
) {

107 
Êﬂt32x4_t
 
YY
[3];

108 
Êﬂt32x4_t
 
YEXT
[3];

109 
Êﬂt32x4_t
 
XX
[2];

110 
Êﬂt32x2_t
 
XX_2
;

111 
Êﬂt32x4_t
 
SUMM
;

112 c⁄° 
Êﬂt32_t
 *
xi
 = 
x
;

113 c⁄° 
Êﬂt32_t
 *
yi
 = 
y
;

115 
	`˚…_as£π
(
Àn
>0);

117 
YY
[0] = 
	`vld1q_f32
(
yi
);

118 
SUMM
 = 
	`vdupq_n_f32
(0);

126 
Àn
 > 8) {

127 
yi
 += 4;

128 
YY
[1] = 
	`vld1q_f32
(
yi
);

129 
yi
 += 4;

130 
YY
[2] = 
	`vld1q_f32
(
yi
);

132 
XX
[0] = 
	`vld1q_f32
(
xi
);

133 
xi
 += 4;

134 
XX
[1] = 
	`vld1q_f32
(
xi
);

135 
xi
 += 4;

137 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YY
[0], 
	`vgë_low_f32
(
XX
[0]), 0);

138 
YEXT
[0] = 
	`vextq_f32
(
YY
[0], YY[1], 1);

139 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[0], 
	`vgë_low_f32
(
XX
[0]), 1);

140 
YEXT
[1] = 
	`vextq_f32
(
YY
[0], YY[1], 2);

141 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[1], 
	`vgë_high_f32
(
XX
[0]), 0);

142 
YEXT
[2] = 
	`vextq_f32
(
YY
[0], YY[1], 3);

143 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[2], 
	`vgë_high_f32
(
XX
[0]), 1);

145 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YY
[1], 
	`vgë_low_f32
(
XX
[1]), 0);

146 
YEXT
[0] = 
	`vextq_f32
(
YY
[1], YY[2], 1);

147 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[0], 
	`vgë_low_f32
(
XX
[1]), 1);

148 
YEXT
[1] = 
	`vextq_f32
(
YY
[1], YY[2], 2);

149 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[1], 
	`vgë_high_f32
(
XX
[1]), 0);

150 
YEXT
[2] = 
	`vextq_f32
(
YY
[1], YY[2], 3);

151 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[2], 
	`vgë_high_f32
(
XX
[1]), 1);

153 
YY
[0] = YY[2];

154 
Àn
 -= 8;

163 i‡(
Àn
 > 4) {

164 
yi
 += 4;

165 
YY
[1] = 
	`vld1q_f32
(
yi
);

167 
XX
[0] = 
	`vld1q_f32
(
xi
);

168 
xi
 += 4;

170 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YY
[0], 
	`vgë_low_f32
(
XX
[0]), 0);

171 
YEXT
[0] = 
	`vextq_f32
(
YY
[0], YY[1], 1);

172 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[0], 
	`vgë_low_f32
(
XX
[0]), 1);

173 
YEXT
[1] = 
	`vextq_f32
(
YY
[0], YY[1], 2);

174 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[1], 
	`vgë_high_f32
(
XX
[0]), 0);

175 
YEXT
[2] = 
	`vextq_f32
(
YY
[0], YY[1], 3);

176 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YEXT
[2], 
	`vgë_high_f32
(
XX
[0]), 1);

178 
YY
[0] = YY[1];

179 
Àn
 -= 4;

182 --
Àn
 > 0) {

183 
XX_2
 = 
	`vld1_dup_f32
(
xi
++);

184 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YY
[0], 
XX_2
, 0);

185 
YY
[0]
	`vld1q_f32
(++
yi
);

188 
XX_2
 = 
	`vld1_dup_f32
(
xi
);

189 
SUMM
 = 
	`vmœq_œ√_f32
(SUMM, 
YY
[0], 
XX_2
, 0);

191 
	`v°1q_f32
(
sum
, 
SUMM
);

192 
	}
}

194 
	$˚…_pôch_xc‹r_Êﬂt_√⁄
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

195 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
) {

196 
i
;

197 ()
¨ch
;

198 
	`˚…_as£π
(
max_pôch
 > 0);

199 
	`˚…_sig_as£π
((((*)
_x
-(*)
NULL
)&3)==0);

201 
i
 = 0; i < (
max_pôch
-3); i += 4) {

202 
	`xc‹r_kî√l_√⁄_Êﬂt
((c⁄° 
Êﬂt32_t
 *)
_x
, (c⁄° flﬂt32_à*)
_y
+
i
,

203 (
Êﬂt32_t
 *)
xc‹r
+
i
, 
Àn
);

207 ; 
i
 < 
max_pôch
; i++) {

208 
xc‹r
[
i
] = 
	`˚…_ö√r_¥od_√⁄
(
_x
, 
_y
+i, 
Àn
);

210 
	}
}

	@celt/arm/celt_pitch_xcorr_arm.s

1 ; 
C›yright
 (
c
Ë2007-2008 
	gCSIRO


2 ; 
C›yright
 (
c
Ë2007-2009 
	gXùh
.
Org
 
	gFound©i⁄


3 ; 
C›yright
 (
c
Ë2013 
	gP¨rŸ


4 ; 
Wrôãn
 
by
 
	gAur
√©
lõn
 
	gZ™ñli


6 ; 
Redi°ributi⁄
 
™d
 
u£
 
ö
 
sour˚
ánd 
bö¨y
 
	gf‹ms
, 
wôh
 
‹
 
	gwôhout


7 ; 
	gmodifiˇti⁄
, 
¨e
 
≥rmôãd
 
¥ovided
 
th©
 
the
 
fﬁlowög
 
	gc⁄dôi⁄s


8 ; 
¨e
 
	gmë
:

10 ; - 
Redi°ributi⁄s
 
of
 
sour˚
 
code
 
mu°
 
ªèö
 
the
 
above
 
	gc›yright


11 ; 
	gnŸi˚
, 
this
 
li°
 
of
 
c⁄dôi⁄s
 
™d
 
the
 
fﬁlowög
 
	gdis˛aimî
.

13 ; - 
Redi°ributi⁄s
 
ö
 
bö¨y
 
f‹m
 
mu°
 
ª¥odu˚
 
the
 
above
 
	gc›yright


14 ; 
	gnŸi˚
, 
this
 
li°
 
of
 
c⁄dôi⁄s
 
™d
 
the
 
fﬁlowög
 
dis˛aimî
 
ö
 
	gthe


15 ; 
documíèti⁄
 
	g™d
/
‹
 
Ÿhî
 
m©îüls
 
¥ovided
 
wôh
 
the
 
	gdi°ributi⁄
.

17 ; 
THIS
 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
	gCONTRIBUTORS


18 ; ``
AS
 
	gIS
'' 
AND
 
ANY
 
EXPRESS
 
OR
 
IMPLIED
 
	gWARRANTIES
, 
	gINCLUDING
, 
BUT
 
	gNOT


19 ; 
LIMITED
 
	gTO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
	gFOR


20 ; 
A
 
PARTICULAR
 
PURPOSE
 
ARE
 
	gDISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT
 
	gOWNER


21 ; 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
	gDIRECT
, 
	gINDIRECT
, 
	gINCIDENTAL
, 
	gSPECIAL
,

22 ; 
	gEXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT
 
LIMITED
 
TO
,

23 ; 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
, 
DATA
, OR

24 ; 
PROFITS
; 
OR
 
BUSINESS
 
INTERRUPTION
Ë
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY
 
THEORY
 
	gOF


25 ; 
	gLIABILITY
, 
WHETHER
 
IN
 
	gCONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT
 (
INCLUDING


26 ; 
NEGLIGENCE
 
OR
 
OTHERWISE
Ë
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE
 OF 
	gTHIS


27 ; 
	gSOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
	gDAMAGE
.

29 
	gAREA
 |.
	gãxt
|, 
	gCODE
, 
READONLY


31 
GET
 
	g˚…
/
	g¨m
/
	g¨m›ts
.
s


33 
IF
 
OPUS_ARM_MAY_HAVE_EDSP


34 
EXPORT
 
˚…_pôch_xc‹r_ed•


35 
ENDIF


37 
IF
 
OPUS_ARM_MAY_HAVE_NEON


38 
EXPORT
 
˚…_pôch_xc‹r_√⁄


39 
ENDIF


41 
IF
 
	gOPUS_ARM_MAY_HAVE_NEON


43 ; 
Compuã
 
	gsum
[
k
]=
sum
(
x
[
j
]*
y
[j+k],j=0...À
n
-1), 
	gk
=0...3

44 
xc‹r_kî√l_√⁄
 
PROC


45 
xc‹r_kî√l_√⁄_°¨t


46 ; 
	göput
:

47 ; 
	gr3
 = 
Àn


48 ; 
	gr4
 = 
›us_vÆ16
 *
x


49 ; 
	gr5
 = 
›us_vÆ16
 *
y


50 ; 
	gq0
 = 
›us_vÆ32
 
sum
[4]

51 ; 
	gouçut
:

52 ; 
	gq0
 = 
›us_vÆ32
 
sum
[4]

53 ; 
	g¥e£rved
: 
r0
-
r3
, 
	gr6
-
	gr11
, 
	gd2
, 
	gq4
-
	gq7
, 
	gq9
-
	gq15


54 ; 
öã∫Æ
 
	gußge
:

55 ; 
	gr12
 = 
j


56 ; 
	gd3
 = 
y_3
|
y_2
|
y_1
|
y_0


57 ; 
	gq2
 = 
y_B
|
y_A
|
y_9
|
y_8
|
y_7
|
y_6
|
y_5
|
y_4


58 ; 
	gq3
 = 
x_7
|
x_6
|
x_5
|
x_4
|
x_3
|
x_2
|
x_1
|
x_0


59 ; 
	gq8
 = 
s¸©ch


61 ; 
Lﬂd
 
	gy
[0...3]

62 ; 
This
 
ªquúes
 
	gÀn
>0 
to
 
Æways
 
be
 
vÆid
 (
which
 
we
 
as£π
 
ö
 
the
 
C
 
code
).

63 
	gVLD1
.16 {
	gd5
}, [
r5
]!

64 
SUBS
 
	gr12
, 
	gr3
, #8

65 
BLE
 
	gxc‹r_kî√l_√⁄_¥o˚ss4


66 ; 
	gPro˚ss
 8 
ßm∂es
 
©
 
a
 
	gtime
.

67 ; 
This
 
lo›
 
lﬂds
 
⁄e
 
y
 
vÆue
 
m‹e
 
th™
 
we
 
a˘uÆly
 
	g√ed
. 
Thîef‹e
 wê
have
 
	gto


68 ; 
°›
 
as
 
so⁄
á†
thîe
 
	g¨e
 8 
‹
 
„wî
 
ßm∂es
 
À·
 (
ö°ód
 
of
 7), 
to
 
	gavoid


69 ; 
ªadög
 
∑°
 
the
 
íd
 
of
Åhê
	g¨øy
.

70 
	gxc‹r_kî√l_√⁄_¥o˚ss8


71 ; 
This
 
lo›
 
	ghas
 19 
tŸÆ
 
ö°ru˘i⁄s
 (10 
cy˛es
 
to
 
issue
, 
möimum
), 
	gwôh


72 ; - 2 
cy˛es
 
of
 
ARM
 
	gö§tu˘i⁄s
,

73 ; - 10 
cy˛es
 
of
 
	glﬂd
/
	g°‹e
/
byã
 
≥rmuã
 
	gö°ru˘i⁄s
, 
	g™d


74 ; - 9 
cy˛es
 
of
 
d©a
 
¥o˚ssög
 
	gö°ru˘i⁄s
.

75 ; 
On
 
a
 
C‹ãx
 
	gA8
, 
we
 
	gduÆ
-
issue
 
the
 
maximum
 
	$amou¡
 (9 
cy˛es
Ë
bëwìn
 
the


76 ; 
œâî
 
two
 
ˇãg‹õs
, 
mónög
 
the
 
whﬁe
 
lo›
 
should
 
run
 
ö
 10 
cy˛es
 
≥r


77 ; 
ôî©i⁄
, 
b¨rög
 
ˇche
 
mis£s
.

79 ; 
Lﬂd
 
x
[0...7]

80 
VLD1
.16 {
d6
, 
d7
}, [r4]!

81 ; 
U∆ike
 
	gVMOV
, 
VAND
 
is
 
a
 
d©a
 
¥o˚sssög
 
ö°ru˘i⁄
 (
™d
 
d€¢
't get

82 ; 
as£mbÀd
 
to
 
VMOV
, 
like
 
VORR
 
would
), 
so
 
ô
 
	gduÆ
-
issues
 
wôh
 
the
 
¥i‹
 
	gVLD1
.

83 
VAND
 
	gd3
, 
	gd5
, 
d5


84 
SUBS
 
	gr12
,Ñ12, #8

85 ; 
Lﬂd
 
	gy
[4...11]

86 
	gVLD1
.16 {
	gd4
, 
	gd5
}, [
r5
]!

87 
	gVMLAL
.
S16
 
	gq0
, 
	gd3
, 
	gd6
[0]

88 
	gVEXT
.16 
	gd16
, 
	gd3
, 
	gd4
, #1

89 
	gVMLAL
.
S16
 
	gq0
, 
	gd4
, 
	gd7
[0]

90 
	gVEXT
.16 
	gd17
, 
	gd4
, 
	gd5
, #1

91 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[1]

92 
	gVEXT
.16 
	gd16
, 
	gd3
, 
	gd4
, #2

93 
	gVMLAL
.
S16
 
	gq0
, 
	gd17
, 
	gd7
[1]

94 
	gVEXT
.16 
	gd17
, 
	gd4
, 
	gd5
, #2

95 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[2]

96 
	gVEXT
.16 
	gd16
, 
	gd3
, 
	gd4
, #3

97 
	gVMLAL
.
S16
 
	gq0
, 
	gd17
, 
	gd7
[2]

98 
	gVEXT
.16 
	gd17
, 
	gd4
, 
	gd5
, #3

99 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[3]

100 
	gVMLAL
.
S16
 
	gq0
, 
	gd17
, 
	gd7
[3]

101 
BGT
 
	gxc‹r_kî√l_√⁄_¥o˚ss8


102 ; 
	gPro˚ss
 4 
ßm∂es
 
hîe
 
we
 
	ghave
 > 4 
À·
 (
°ûl
 
ªadög
 
⁄e
 
exåa
 
y
 
vÆue
).

103 
xc‹r_kî√l_√⁄_¥o˚ss4


104 
ADDS
 
	gr12
,Ñ12, #4

105 
BLE
 
	gxc‹r_kî√l_√⁄_¥o˚ss2


106 ; 
Lﬂd
 
	gx
[0...3]

107 
	gVLD1
.16 
	gd6
, [
r4
]!

108 ; 
U£
 
VAND
 
sö˚
 
	gô
'sá dataÖrocessing instructionágain.

109 
VAND
 
	gd4
, 
	gd5
, 
d5


110 
SUB
 
	gr12
,Ñ12, #4

111 ; 
Lﬂd
 
	gy
[4...7]

112 
	gVLD1
.16 
	gd5
, [
r5
]!

113 
	gVMLAL
.
S16
 
	gq0
, 
	gd4
, 
	gd6
[0]

114 
	gVEXT
.16 
	gd16
, 
	gd4
, 
	gd5
, #1

115 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[1]

116 
	gVEXT
.16 
	gd16
, 
	gd4
, 
	gd5
, #2

117 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[2]

118 
	gVEXT
.16 
	gd16
, 
	gd4
, 
	gd5
, #3

119 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd6
[3]

120 ; 
	gPro˚ss
 2 
ßm∂es
 
hîe
 
we
 
	ghave
 > 2 
À·
 (
°ûl
 
ªadög
 
⁄e
 
exåa
 
y
 
vÆue
).

121 
xc‹r_kî√l_√⁄_¥o˚ss2


122 
ADDS
 
	gr12
,Ñ12, #2

123 
BLE
 
	gxc‹r_kî√l_√⁄_¥o˚ss1


124 ; 
Lﬂd
 
	gx
[0...1]

125 
	gVLD2
.16 {
	gd6
[],
	gd7
[]}, [
r4
]!

126 ; 
U£
 
VAND
 
sö˚
 
	gô
'sá dataÖrocessing instructionágain.

127 
VAND
 
	gd4
, 
	gd5
, 
d5


128 
SUB
 
	gr12
,Ñ12, #2

129 ; 
Lﬂd
 
	gy
[4...5]

130 
	gVLD1
.32 {
	gd5
[]}, [
r5
]!

131 
	gVMLAL
.
S16
 
	gq0
, 
	gd4
, 
d6


132 
	gVEXT
.16 
	gd16
, 
	gd4
, 
	gd5
, #1

133 ; 
Rïœ˚
 
bŸtom
 
c›y
 
	gof
 {
	gy5
,
	gy4
} 
ö
 
d5
 
	gwôh
 {
	gy3
,
	gy2
} 
‰om
 
	gd4
, 
usög
 
	gVSRI


134 ; 
ö°ód
 
of
 
	gVEXT
, 
sö˚
 
	gô
'sá data-processing instruction.

135 
	gVSRI
.64 
	gd5
, 
	gd4
, #32

136 
	gVMLAL
.
S16
 
	gq0
, 
	gd16
, 
	gd7


137 ; 
	gPro˚ss
 1 
ßm∂e
 
usög
 
the
 
exåa
 
y
 
vÆue
 
we
 
lﬂded
 
	gabove
.

138 
	gxc‹r_kî√l_√⁄_¥o˚ss1


139 ; 
Lﬂd
 
√xt
 *
x


140 
	gVLD1
.16 {
	gd6
[]}, [
r4
]!

141 
ADDS
 
	gr12
,Ñ12, #1

142 ; 
	gy
[0...3] 
¨e
 
À·
 
ö
 
d5
 
‰om
 
¥i‹
 
	$ôî©i⁄
(
s
Ë(
™y
)

143 
VMLAL
.
S16
 
q0
, 
d5
, 
d6


144 
MOVLE
 
pc
, 
Ã


145 ; 
Now
 
¥o˚ss
 1 
œ°
 
ßm∂e
, 
nŸ
 
ªadög
 
ahód
.

146 ; 
Lﬂd
 
œ°
 *
y


147 
VLD1
.16 {
d4
[]
	}
}, [
r5
]!

148 
	gVSRI
.64 
	gd4
, 
	gd5
, #16

149 ; 
Lﬂd
 
œ°
 *
x


150 
	gVLD1
.16 {
	gd6
[]}, [
r4
]!

151 
	gVMLAL
.
S16
 
	gq0
, 
	gd4
, 
d6


152 
MOV
 
	gpc
, 
Ã


153 
	gENDP


155 ; 
›us_vÆ32
 
˚…_pôch_xc‹r_√⁄
(
›us_vÆ16
 *
_x
, opus_vÆ16 *
_y
,

156 ; 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
)

157 
˚…_pôch_xc‹r_√⁄
 
	gPROC


158 ; 
	göput
:

159 ; 
	gr0
 = 
›us_vÆ16
 *
_x


160 ; 
	gr1
 = 
›us_vÆ16
 *
_y


161 ; 
	gr2
 = 
›us_vÆ32
 *
xc‹r


162 ; 
	gr3
 = 
Àn


163 ; 
	gouçut
:

164 ; 
	gr0
 = 
maxc‹r


165 ; 
öã∫Æ
 
	gußge
:

166 ; 
	gr4
 = 
›us_vÆ16
 *
x
 (
xc‹r_kî√l_√⁄
())

167 ; 
	gr5
 = 
›us_vÆ16
 *
y
 (
xc‹r_kî√l_√⁄
())

168 ; 
	gr6
 = 
max_pôch


169 ; 
	gr12
 = 
j


170 ; 
	gq15
 = 
maxc‹r
[4] (
q15
 
is
 
nŸ
 
u£d
 
by
 
xc‹r_kî√l_√⁄
())

171 ; 
	gign‹ed
:

172 ; 
¨ch


173 
STMFD
 
	g•
!, {
	gr4
-
	gr6
, 
	gÃ
}

174 
LDR
 
	gr6
, [
•
, #16]

175 
	gVMOV
.
S32
 
	gq15
, #1

176 ; i‡(
	gmax_pôch
 < 4Ë
˚…_pôch_xc‹r_√⁄_¥o˚ss4_d⁄e


177 
SUBS
 
	gr6
,Ñ6, #4

178 
BLT
 
˚…_pôch_xc‹r_√⁄_¥o˚ss4_d⁄e


179 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss4


180 ; 
xc‹r_kî√l_√⁄
 
	g∑ømëîs
:

181 ; 
	gr3
 = 
Àn
, 
	gr4
 = 
_x
, 
	gr5
 = 
_y
, 
	gq0
 = {0, 0, 0, 0}

182 
MOV
 
r4
, 
r0


183 
MOV
 
	gr5
, 
r1


184 
VEOR
 
	gq0
, q0, q0

185 ; 
xc‹r_kî√l_√⁄
 
⁄ly
 
modifõs
 
	gr4
, 
	gr5
, 
	gr12
, 
™d
 
	gq0
...
	gq3
.

186 ; 
So
 
we
 
	gd⁄
't save/restoreány otherÑegisters.

187 
BL
 
xc‹r_kî√l_√⁄_°¨t


188 
SUBS
 
	gr6
,Ñ6, #4

189 
	gVST1
.32 {
	gq0
}, [
r2
]!

190 ; 
	g_y
 += 4

191 
ADD
 
r1
, 
	gr1
, #8

192 
	gVMAX
.
S32
 
	gq15
, q15, 
	gq0


193 ; i‡(
	gmax_pôch
 < 4Ë
˚…_pôch_xc‹r_√⁄_¥o˚ss4_d⁄e


194 
BGE
 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss4


195 ; 
We
 
have
 
Àss
 
	gth™
 4 
sums
 
À·
 
to
 
	gcompuã
.

196 
˚…_pôch_xc‹r_√⁄_¥o˚ss4_d⁄e


197 
ADDS
 
	gr6
,Ñ6, #4

198 ; 
Redu˚
 
maxc‹r
 
to
 
a
 
sögÀ
 
vÆue


199 
	gVMAX
.
S32
 
	gd30
, d30, 
d31


200 
	gVPMAX
.
S32
 
	gd30
, d30, d30

201 ; i‡(
	gmax_pôch
 <0Ë
˚…_pôch_xc‹r_√⁄_d⁄e


202 
BLE
 
˚…_pôch_xc‹r_√⁄_d⁄e


203 ; 
Now
 
compuã
 
óch
 
ªmaöög
 
sum
 
⁄e
 
©
 
a
 
	gtime
.

204 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög


205 
MOV
 
	gr4
, 
r0


206 
MOV
 
	gr5
, 
r1


207 
	gVMOV
.
I32
 
	gq0
, #0

208 
SUBS
 
	gr12
, 
	gr3
, #8

209 
BLT
 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög4


210 ; 
Sum
 
	gãrms
 8 
©
 
a
 
	gtime
.

211 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›8


212 ; 
Lﬂd
 
	gx
[0...7]

213 
	gVLD1
.16 {
	gq1
}, [
r4
]!

214 ; 
Lﬂd
 
	gy
[0...7]

215 
	gVLD1
.16 {
	gq2
}, [
r5
]!

216 
SUBS
 
	gr12
,Ñ12, #8

217 
	gVMLAL
.
S16
 
	gq0
, 
	gd4
, 
d2


218 
	gVMLAL
.
S16
 
	gq0
, 
	gd5
, 
d3


219 
BGE
 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›8


220 ; 
Sum
 
	gãrms
 4 
©
 
a
 
	gtime
.

221 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög4


222 
ADDS
 
	gr12
,Ñ12, #4

223 
BLT
 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög4_d⁄e


224 ; 
Lﬂd
 
	gx
[0...3]

225 
	gVLD1
.16 {
	gd2
}, [
r4
]!

226 ; 
Lﬂd
 
	gy
[0...3]

227 
	gVLD1
.16 {
	gd3
}, [
r5
]!

228 
SUB
 
	gr12
,Ñ12, #4

229 
	gVMLAL
.
S16
 
	gq0
, 
	gd3
, 
d2


230 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög4_d⁄e


231 ; 
Redu˚
 
the
 
sum
 
to
 
a
 
sögÀ
 
	gvÆue
.

232 
	gVADD
.
S32
 
	gd0
, d0, 
d1


233 
	gVPADDL
.
S32
 
	gd0
, 
d0


234 
ADDS
 
	gr12
,Ñ12, #4

235 
BLE
 
	g˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›_d⁄e


236 ; 
Sum
 
	gãrms
 1 
©
 
a
 
	gtime
.

237 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›1


238 
	gVLD1
.16 {
	gd2
[]}, [
r4
]!

239 
	gVLD1
.16 {
	gd3
[]}, [
r5
]!

240 
SUBS
 
	gr12
,Ñ12, #1

241 
	gVMLAL
.
S16
 
	gq0
, 
	gd2
, 
d3


242 
BGT
 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›1


243 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög_lo›_d⁄e


244 
	gVST1
.32 {
	gd0
[0]}, [
r2
]!

245 
	gVMAX
.
S32
 
	gd30
, d30, 
d0


246 
SUBS
 
	gr6
,Ñ6, #1

247 ; 
	g_y
++

248 
ADD
 
	gr1
,Ñ1, #2

249 ; i‡(--
	gmax_pôch
 > 0Ë
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög


250 
BGT
 
˚…_pôch_xc‹r_√⁄_¥o˚ss_ªmaöög


251 
˚…_pôch_xc‹r_√⁄_d⁄e


252 
	gVMOV
.32 
	gr0
, 
	gd30
[0]

253 
LDMFD
 
	g•
!, {
	gr4
-
	gr6
, 
	gpc
}

254 
ENDP


256 
ENDIF


258 
IF
 
	gOPUS_ARM_MAY_HAVE_EDSP


260 ; 
This
 
wûl
 
gë
 
u£d
 
⁄
 
ARMv7
 
devi˚s
 
wôhout
 
	gNEON
, 
so
 
ô
 
has
 
bìn
 
	g›timized


261 ; 
to
 
èke
 
adv™ège
 
of
 
	gduÆ
-
issuög
 
whîe
 
	gpossibÀ
.

262 
xc‹r_kî√l_ed•
 
PROC


263 
	gxc‹r_kî√l_ed•_°¨t


264 ; 
	göput
:

265 ; 
	gr3
 = 
Àn


266 ; 
	gr4
 = 
›us_vÆ16
 *
_x
 (
mu°
 
be
 32-
bô
 
Æig√d
)

267 ; 
	gr5
 = 
›us_vÆ16
 *
_y
 (
mu°
 
be
 32-
bô
 
Æig√d
)

268 ; 
	gr6
...
	gr9
 = 
›us_vÆ32
 
sum
[4]

269 ; 
	gouçut
:

270 ; 
	gr6
...
	gr9
 = 
›us_vÆ32
 
sum
[4]

271 ; 
	g¥e£rved
: 
r0
-
r5


272 ; 
öã∫Æ
 
	gußge


273 ; 
	gr2
 = 
j


274 ; 
	gr12
,
	gr14
 = 
›us_vÆ16
 
x
[4]

275 ; 
	gr10
,
	gr11
 = 
›us_vÆ16
 
y
[4]

276 
STMFD
 
•
!, {
	gr2
,
	gr4
,
	gr5
,
	gÃ
}

277 
LDR
 
	gr10
, [
r5
], #4 ; 
Lﬂd
 
	gy
[0...1]

278 
SUBS
 
	gr2
, 
	gr3
, #4 ; 
	gj
 = 
Àn
-4

279 
LDR
 
r11
, [
r5
], #4 ; 
Lﬂd
 
	gy
[2...3]

280 
BLE
 
xc‹r_kî√l_ed•_¥o˚ss4_d⁄e


281 
LDR
 
	gr12
, [
r4
], #4 ; 
Lﬂd
 
	gx
[0...1]

282 ; 
SèŒ


283 
	gxc‹r_kî√l_ed•_¥o˚ss4


284 ; 
The
 
mu…ùlõs
 
mu°
 
issue
 
‰om
 
	gpùñöe
 0, 
™d
 
	gˇn
't dual-issue withÉach

285 ; 
	gŸhî
. 
Evîy
 
Ÿhî
 
ö°ru˘i⁄
 
hîe
 
	gduÆ
-
issues
 
wôh
 
a
 
	gmu…ùly
, 
™d
 
	gis


286 ; 
	gthus
 "‰ì". 
Thîe
 
should
 
be
 
no
 
°Æls
 
ö
 
the
 
body
 
of
Åhê
	glo›
.

287 
SMLABB
 
	gr6
, 
	gr12
, 
	gr10
,Ñ6 ; 
	gsum
[0] = 
	$MAC16_16
(
sum
[0],
x_0
,
y_0
)

288 
LDR
 
r14
, [
r4
], #4 ; 
Lﬂd
 
x
[2...3]

289 
SMLABT
 
r7
, 
r12
, 
r10
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x_0
,
y_1
)

290 
SUBS
 
r2
,Ñ2, #4 ; 
j
-=4

291 
SMLABB
 
r8
, 
r12
, 
r11
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x_0
,
y_2
)

292 
SMLABT
 
r9
, 
r12
, 
r11
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x_0
,
y_3
)

293 
SMLATT
 
r6
, 
r12
, 
r10
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
x_1
,
y_1
)

294 
LDR
 
r10
, [
r5
], #4 ; 
Lﬂd
 
y
[4...5]

295 
SMLATB
 
r7
, 
r12
, 
r11
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x_1
,
y_2
)

296 
SMLATT
 
r8
, 
r12
, 
r11
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x_1
,
y_3
)

297 
SMLATB
 
r9
, 
r12
, 
r10
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x_1
,
y_4
)

298 
LDRGT
 
r12
, [
r4
], #4 ; 
Lﬂd
 
x
[0...1]

299 
SMLABB
 
r6
, 
r14
, 
r11
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
x_2
,
y_2
)

300 
SMLABT
 
r7
, 
r14
, 
r11
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x_2
,
y_3
)

301 
SMLABB
 
r8
, 
r14
, 
r10
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x_2
,
y_4
)

302 
SMLABT
 
r9
, 
r14
, 
r10
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x_2
,
y_5
)

303 
SMLATT
 
r6
, 
r14
, 
r11
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
x_3
,
y_3
)

304 
LDR
 
r11
, [
r5
], #4 ; 
Lﬂd
 
y
[6...7]

305 
SMLATB
 
r7
, 
r14
, 
r10
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x_3
,
y_4
)

306 
SMLATT
 
r8
, 
r14
, 
r10
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x_3
,
y_5
)

307 
SMLATB
 
r9
, 
r14
, 
r11
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x_3
,
y_6
)

308 
BGT
 
xc‹r_kî√l_ed•_¥o˚ss4


309 
xc‹r_kî√l_ed•_¥o˚ss4_d⁄e


310 
ADDS
 
r2
,Ñ2, #4

311 
BLE
 
xc‹r_kî√l_ed•_d⁄e


312 
LDRH
 
r12
, [
r4
], #2 ;Ñ12 = *
x
++

313 
SUBS
 
r2
,Ñ2, #1 ; 
j
--

314 ; 
SèŒ


315 
SMLABB
 
r6
, 
r12
, 
r10
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
x
,
y_0
)

316 
LDRHGT
 
r14
, [
r4
], #2 ;Ñ14 = *
x
++

317 
SMLABT
 
r7
, 
r12
, 
r10
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x
,
y_1
)

318 
SMLABB
 
r8
, 
r12
, 
r11
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x
,
y_2
)

319 
SMLABT
 
r9
, 
r12
, 
r11
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x
,
y_3
)

320 
BLE
 
xc‹r_kî√l_ed•_d⁄e


321 
SMLABT
 
r6
, 
r14
, 
r10
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
x
,
y_1
)

322 
SUBS
 
r2
,Ñ2, #1 ; 
j
--

323 
SMLABB
 
r7
, 
r14
, 
r11
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
x
,
y_2
)

324 
LDRH
 
r10
, [
r5
], #2 ;Ñ10 = 
y_4
 = *
y
++

325 
SMLABT
 
r8
, 
r14
, 
r11
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
x
,
y_3
)

326 
LDRHGT
 
r12
, [
r4
], #2 ;Ñ12 = *
x
++

327 
SMLABB
 
r9
, 
r14
, 
r10
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
x
,
y_4
)

328 
BLE
 
xc‹r_kî√l_ed•_d⁄e


329 
SMLABB
 
r6
, 
r12
, 
r11
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
tmp
,
y_2
)

330 
CMP
 
r2
, #1 ; 
j
--

331 
SMLABT
 
r7
, 
r12
, 
r11
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
tmp
,
y_3
)

332 
LDRH
 
r2
, [
r5
], #2 ;Ñ2 = 
y_5
 = *
y
++

333 
SMLABB
 
r8
, 
r12
, 
r10
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
tmp
,
y_4
)

334 
LDRHGT
 
r14
, [
r4
] ;Ñ14 = *
x


335 
SMLABB
 
r9
, 
r12
, 
r2
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
tmp
,
y_5
)

336 
BLE
 
xc‹r_kî√l_ed•_d⁄e


337 
SMLABT
 
r6
, 
r14
, 
r11
,Ñ6 ; 
sum
[0] = 
	$MAC16_16
(
sum
[0],
tmp
,
y_3
)

338 
LDRH
 
r11
, [
r5
] ;Ñ11 = 
y_6
 = *
y


339 
SMLABB
 
r7
, 
r14
, 
r10
,Ñ7 ; 
sum
[1] = 
	$MAC16_16
(
sum
[1],
tmp
,
y_4
)

340 
SMLABB
 
r8
, 
r14
, 
r2
,Ñ8 ; 
sum
[2] = 
	$MAC16_16
(
sum
[2],
tmp
,
y_5
)

341 
SMLABB
 
r9
, 
r14
, 
r11
,Ñ9 ; 
sum
[3] = 
	$MAC16_16
(
sum
[3],
tmp
,
y_6
)

342 
xc‹r_kî√l_ed•_d⁄e


343 
LDMFD
 
•
!, {
r2
,
r4
,
r5
,
pc
}

344 
ENDP


346 
˚…_pôch_xc‹r_ed•
 
	gPROC


347 ; 
	göput
:

348 ; 
	gr0
 = 
›us_vÆ16
 *
_x
 (
mu°
 
be
 32-
bô
 
Æig√d
)

349 ; 
	gr1
 = 
›us_vÆ16
 *
_y
 (
⁄ly
 
√eds
 
to
 
be
 16-
bô
 
Æig√d
)

350 ; 
	gr2
 = 
›us_vÆ32
 *
xc‹r


351 ; 
	gr3
 = 
Àn


352 ; 
	gouçut
:

353 ; 
	gr0
 = 
maxc‹r


354 ; 
öã∫Æ
 
	gußge


355 ; 
	gr4
 = 
›us_vÆ16
 *
x


356 ; 
	gr5
 = 
›us_vÆ16
 *
y


357 ; 
	gr6
 = 
›us_vÆ32
 
sum0


358 ; 
	gr7
 = 
›us_vÆ32
 
sum1


359 ; 
	gr8
 = 
›us_vÆ32
 
sum2


360 ; 
	gr9
 = 
›us_vÆ32
 
sum3


361 ; 
	gr1
 = 
max_pôch


362 ; 
	gr12
 = 
j


363 ; 
	gign‹ed
:

364 ; 
¨ch


365 
STMFD
 
	g•
!, {
	gr4
-
	gr11
, 
	gÃ
}

366 
MOV
 
	gr5
, 
r1


367 
LDR
 
	gr1
, [
•
, #36]

368 
MOV
 
	gr4
, 
r0


369 
TST
 
	gr5
, #3

370 ; 
	gmaxc‹r
 = 1

371 
MOV
 
r0
, #1

372 
BEQ
 
	g˚…_pôch_xc‹r_ed•_¥o˚ss1u_d⁄e


373 ; 
Compuã
 
⁄e
 
sum
 
©
 
the
 
°¨t
 
to
 
make
 
	gy
 32-
bô
 
	gÆig√d
.

374 
SUBS
 
	gr12
, 
	gr3
, #4

375 ; 
	gr14
 = 
sum
 = 0

376 
MOV
 
r14
, #0

377 
LDRH
 
	gr8
, [
r5
], #2

378 
BLE
 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›4_d⁄e


379 
LDR
 
	gr6
, [
r4
], #4

380 
MOV
 
	gr8
,Ñ8, 
	gLSL
 #16

381 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›4


382 
LDR
 
	gr9
, [
r5
], #4

383 
SMLABT
 
	gr14
, 
	gr6
, 
	gr8
,Ñ14 ; 
	gsum
 = 
	$MAC16_16
(
sum
, 
x_0
, 
y_0
)

384 
LDR
 
r7
, [
r4
], #4

385 
SMLATB
 
r14
, 
r6
, 
r9
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_1
, 
y_1
)

386 
LDR
 
r8
, [
r5
], #4

387 
SMLABT
 
r14
, 
r7
, 
r9
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_2
, 
y_2
)

388 
SUBS
 
r12
,Ñ12, #4 ; 
j
-=4

389 
SMLATB
 
r14
, 
r7
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_3
, 
y_3
)

390 
LDRGT
 
r6
, [
r4
], #4

391 
BGT
 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›4


392 
MOV
 
r8
,Ñ8, 
LSR
 #16

393 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›4_d⁄e


394 
ADDS
 
r12
,Ñ12, #4

395 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›1


396 
LDRHGE
 
r6
, [
r4
], #2

397 ; 
SèŒ


398 
SMLABBGE
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, *
x
, *
y
)

399 
SUBSGE
 
r12
,Ñ12, #1

400 
LDRHGT
 
r8
, [
r5
], #2

401 
BGT
 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_lo›1


402 ; 
Re°‹e
 
_x


403 
SUB
 
r4
,Ñ4, 
r3
, 
LSL
 #1

404 ; 
Re°‹e
 
™d
 
adv™˚
 
_y


405 
SUB
 
r5
,Ñ5, 
r3
, 
LSL
 #1

406 ; 
maxc‹r
 = 
	$max
(
maxc‹r
, 
sum
)

407 
CMP
 
r0
, 
r14


408 
ADD
 
r5
,Ñ5, #2

409 
MOVLT
 
r0
, 
r14


410 
SUBS
 
r1
,Ñ1, #1

411 ; 
xc‹r
[
i
] = 
sum


412 
STR
 
r14
, [
r2
], #4

413 
BLE
 
˚…_pôch_xc‹r_ed•_d⁄e


414 
˚…_pôch_xc‹r_ed•_¥o˚ss1u_d⁄e


415 ; i‡(
max_pôch
 < 4Ë
˚…_pôch_xc‹r_ed•_¥o˚ss2


416 
SUBS
 
r1
,Ñ1, #4

417 
BLT
 
˚…_pôch_xc‹r_ed•_¥o˚ss2


418 
˚…_pôch_xc‹r_ed•_¥o˚ss4


419 ; 
xc‹r_kî√l_ed•
 
∑ømëîs
:

420 ; 
r3
 = 
Àn
, 
r4
 = 
_x
, 
r5
 = 
_y
, 
r6
...
r9
 = 
sum
[4] = {0, 0, 0, 0
	}
}

421 
MOV
 
r6
, #0

422 
MOV
 
	gr7
, #0

423 
MOV
 
	gr8
, #0

424 
MOV
 
	gr9
, #0

425 
BL
 
	gxc‹r_kî√l_ed•_°¨t
 ; 
xc‹r_kî√l_ed•
(
_x
, 
_y
+
i
, 
xc‹r
+i, 
Àn
)

426 ; 
	gmaxc‹r
 = 
	$max
(
maxc‹r
, 
sum0
, 
sum1
, 
sum2
, 
sum3
)

427 
CMP
 
r0
, 
r6


428 ; 
_y
+=4

429 
ADD
 
r5
,Ñ5, #8

430 
MOVLT
 
r0
, 
r6


431 
CMP
 
r0
, 
r7


432 
MOVLT
 
r0
, 
r7


433 
CMP
 
r0
, 
r8


434 
MOVLT
 
r0
, 
r8


435 
CMP
 
r0
, 
r9


436 
MOVLT
 
r0
, 
r9


437 
STMIA
 
r2
!, {
r6
-
r9
}

438 
SUBS
 
	gr1
,Ñ1, #4

439 
BGE
 
˚…_pôch_xc‹r_ed•_¥o˚ss4


440 
˚…_pôch_xc‹r_ed•_¥o˚ss2


441 
ADDS
 
	gr1
,Ñ1, #2

442 
BLT
 
˚…_pôch_xc‹r_ed•_¥o˚ss1a


443 
SUBS
 
	gr12
, 
	gr3
, #4

444 ; {
	gr10
, 
	gr11
} = {
sum0
, 
sum1
} = {0, 0}

445 
MOV
 
r10
, #0

446 
MOV
 
	gr11
, #0

447 
LDR
 
	gr8
, [
r5
], #4

448 
BLE
 
˚…_pôch_xc‹r_ed•_¥o˚ss2_lo›_d⁄e


449 
LDR
 
	gr6
, [
r4
], #4

450 
LDR
 
	gr9
, [
r5
], #4

451 
˚…_pôch_xc‹r_ed•_¥o˚ss2_lo›4


452 
SMLABB
 
	gr10
, 
	gr6
, 
	gr8
,Ñ10 ; 
	gsum0
 = 
	$MAC16_16
(
sum0
, 
x_0
, 
y_0
)

453 
LDR
 
r7
, [
r4
], #4

454 
SMLABT
 
r11
, 
r6
, 
r8
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_0
, 
y_1
)

455 
SUBS
 
r12
,Ñ12, #4 ; 
j
-=4

456 
SMLATT
 
r10
, 
r6
, 
r8
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_1
, 
y_1
)

457 
LDR
 
r8
, [
r5
], #4

458 
SMLATB
 
r11
, 
r6
, 
r9
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_1
, 
y_2
)

459 
LDRGT
 
r6
, [
r4
], #4

460 
SMLABB
 
r10
, 
r7
, 
r9
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_2
, 
y_2
)

461 
SMLABT
 
r11
, 
r7
, 
r9
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_2
, 
y_3
)

462 
SMLATT
 
r10
, 
r7
, 
r9
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_3
, 
y_3
)

463 
LDRGT
 
r9
, [
r5
], #4

464 
SMLATB
 
r11
, 
r7
, 
r8
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_3
, 
y_4
)

465 
BGT
 
˚…_pôch_xc‹r_ed•_¥o˚ss2_lo›4


466 
˚…_pôch_xc‹r_ed•_¥o˚ss2_lo›_d⁄e


467 
ADDS
 
r12
,Ñ12, #2

468 
BLE
 
˚…_pôch_xc‹r_ed•_¥o˚ss2_1


469 
LDR
 
r6
, [
r4
], #4

470 ; 
SèŒ


471 
SMLABB
 
r10
, 
r6
, 
r8
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_0
, 
y_0
)

472 
LDR
 
r9
, [
r5
], #4

473 
SMLABT
 
r11
, 
r6
, 
r8
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_0
, 
y_1
)

474 
SUB
 
r12
,Ñ12, #2

475 
SMLATT
 
r10
, 
r6
, 
r8
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_1
, 
y_1
)

476 
MOV
 
r8
, 
r9


477 
SMLATB
 
r11
, 
r6
, 
r9
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_1
, 
y_2
)

478 
˚…_pôch_xc‹r_ed•_¥o˚ss2_1


479 
LDRH
 
r6
, [
r4
], #2

480 
ADDS
 
r12
,Ñ12, #1

481 ; 
SèŒ


482 
SMLABB
 
r10
, 
r6
, 
r8
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_0
, 
y_0
)

483 
LDRHGT
 
r7
, [
r4
], #2

484 
SMLABT
 
r11
, 
r6
, 
r8
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_0
, 
y_1
)

485 
BLE
 
˚…_pôch_xc‹r_ed•_¥o˚ss2_d⁄e


486 
LDRH
 
r9
, [
r5
], #2

487 
SMLABT
 
r10
, 
r7
, 
r8
,Ñ10 ; 
sum0
 = 
	$MAC16_16
(
sum0
, 
x_0
, 
y_1
)

488 
SMLABB
 
r11
, 
r7
, 
r9
,Ñ11 ; 
sum1
 = 
	$MAC16_16
(
sum1
, 
x_0
, 
y_2
)

489 
˚…_pôch_xc‹r_ed•_¥o˚ss2_d⁄e


490 ; 
Re°‹e
 
_x


491 
SUB
 
r4
,Ñ4, 
r3
, 
LSL
 #1

492 ; 
Re°‹e
 
™d
 
adv™˚
 
_y


493 
SUB
 
r5
,Ñ5, 
r3
, 
LSL
 #1

494 ; 
maxc‹r
 = 
	$max
(
maxc‹r
, 
sum0
)

495 
CMP
 
r0
, 
r10


496 
ADD
 
r5
,Ñ5, #2

497 
MOVLT
 
r0
, 
r10


498 
SUB
 
r1
,Ñ1, #2

499 ; 
maxc‹r
 = 
	$max
(
maxc‹r
, 
sum1
)

500 
CMP
 
r0
, 
r11


501 ; 
xc‹r
[
i
] = 
sum


502 
STR
 
r10
, [
r2
], #4

503 
MOVLT
 
r0
, 
r11


504 
STR
 
r11
, [
r2
], #4

505 
˚…_pôch_xc‹r_ed•_¥o˚ss1a


506 
ADDS
 
r1
,Ñ1, #1

507 
BLT
 
˚…_pôch_xc‹r_ed•_d⁄e


508 
SUBS
 
r12
, 
r3
, #4

509 ; 
r14
 = 
sum
 = 0

510 
MOV
 
r14
, #0

511 
BLT
 
˚…_pôch_xc‹r_ed•_¥o˚ss1a_lo›_d⁄e


512 
LDR
 
r6
, [
r4
], #4

513 
LDR
 
r8
, [
r5
], #4

514 
LDR
 
r7
, [
r4
], #4

515 
LDR
 
r9
, [
r5
], #4

516 
˚…_pôch_xc‹r_ed•_¥o˚ss1a_lo›4


517 
SMLABB
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_0
, 
y_0
)

518 
SUBS
 
r12
,Ñ12, #4 ; 
j
-=4

519 
SMLATT
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_1
, 
y_1
)

520 
LDRGE
 
r6
, [
r4
], #4

521 
SMLABB
 
r14
, 
r7
, 
r9
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_2
, 
y_2
)

522 
LDRGE
 
r8
, [
r5
], #4

523 
SMLATT
 
r14
, 
r7
, 
r9
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_3
, 
y_3
)

524 
LDRGE
 
r7
, [
r4
], #4

525 
LDRGE
 
r9
, [
r5
], #4

526 
BGE
 
˚…_pôch_xc‹r_ed•_¥o˚ss1a_lo›4


527 
˚…_pôch_xc‹r_ed•_¥o˚ss1a_lo›_d⁄e


528 
ADDS
 
r12
,Ñ12, #2

529 
LDRGE
 
r6
, [
r4
], #4

530 
LDRGE
 
r8
, [
r5
], #4

531 ; 
SèŒ


532 
SMLABBGE
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_0
, 
y_0
)

533 
SUBGE
 
r12
,Ñ12, #2

534 
SMLATTGE
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	$MAC16_16
(
sum
, 
x_1
, 
y_1
)

535 
ADDS
 
r12
,Ñ12, #1

536 
LDRHGE
 
r6
, [
r4
], #2

537 
LDRHGE
 
r8
, [
r5
], #2

538 ; 
SèŒ


539 
SMLABBGE
 
r14
, 
r6
, 
r8
,Ñ14 ; 
sum
 = 
	`MAC16_16
(sum, *
x
, *
y
)

540 ; 
maxc‹r
 = 
	$max
(
maxc‹r
, 
sum
)

541 
CMP
 
r0
, 
r14


542 ; 
xc‹r
[
i
] = 
sum


543 
STR
 
r14
, [
r2
], #4

544 
MOVLT
 
r0
, 
r14


545 
˚…_pôch_xc‹r_ed•_d⁄e


546 
LDMFD
 
•
!, {
r4
-
r11
, 
pc
}

547 
ENDP


549 
ENDIF


551 
	gEND


	@celt/arm/fft_arm.h

34 #i‡!
deföed
(
FFT_ARM_H
)

35 
	#FFT_ARM_H


	)

37 
	~"kiss_f·.h
"

39 #i‡
deföed
(
HAVE_ARM_NE10
)

41 
›us_f·_Æloc_¨m_√⁄
(
kiss_f·_°©e
 *
°
);

42 
›us_f·_‰ì_¨m_√⁄
(
kiss_f·_°©e
 *
°
);

44 
›us_f·_√⁄
(c⁄° 
kiss_f·_°©e
 *
°
,

45 c⁄° 
kiss_f·_˝x
 *
fö
,

46 
kiss_f·_˝x
 *
fout
);

48 
›us_if·_√⁄
(c⁄° 
kiss_f·_°©e
 *
°
,

49 c⁄° 
kiss_f·_˝x
 *
fö
,

50 
kiss_f·_˝x
 *
fout
);

52 #i‡!
deföed
(
OPUS_HAVE_RTCD
)

53 
	#OVERRIDE_OPUS_FFT
 (1)

	)

55 
	#›us_f·_Æloc_¨ch
(
_°
, 
¨ch
) \

56 (()(
¨ch
), 
	`›us_f·_Æloc_¨m_√⁄
(
_°
))

	)

58 
	#›us_f·_‰ì_¨ch
(
_°
, 
¨ch
) \

59 (()(
¨ch
), 
	`›us_f·_‰ì_¨m_√⁄
(
_°
))

	)

61 
	#›us_f·
(
_°
, 
_fö
, 
_fout
, 
¨ch
) \

62 (()(
¨ch
), 
	`›us_f·_√⁄
(
_°
, 
_fö
, 
_fout
))

	)

64 
	#›us_if·
(
_°
, 
_fö
, 
_fout
, 
¨ch
) \

65 (()(
¨ch
), 
	`›us_if·_√⁄
(
_°
, 
_fö
, 
_fout
))

	)

	@celt/arm/fixed_arm64.h

27 #i‚de‡
FIXED_ARM64_H


28 
	#FIXED_ARM64_H


	)

30 
	~<¨m_√⁄.h
>

32 #unde‡
SIG2WORD16


33 
	#SIG2WORD16
(
x
Ë(
	`vqmovns_s32
(
	`PSHR32
((x), 
SIG_SHIFT
)))

	)

	@celt/arm/fixed_armv4.h

27 #i‚de‡
FIXED_ARMv4_H


28 
	#FIXED_ARMv4_H


	)

31 #unde‡
MULT16_32_Q16


32 
OPUS_INLINE
 
›us_vÆ32
 
	$MULT16_32_Q16_¨mv4
(
›us_vÆ16
 
a
, 
›us_vÆ32
 
b
)

34 
rd_lo
;

35 
rd_hi
;

36 
	`__asm__
(

39 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

40 : "%r"(
b
),"r"(
	`SHL32
(
a
,16))

42  
rd_hi
;

43 
	}
}

44 
	#MULT16_32_Q16
(
a
, 
b
Ë(
	`MULT16_32_Q16_¨mv4
◊, b))

	)

48 #unde‡
MULT16_32_Q15


49 
OPUS_INLINE
 
›us_vÆ32
 
	$MULT16_32_Q15_¨mv4
(
›us_vÆ16
 
a
, 
›us_vÆ32
 
b
)

51 
rd_lo
;

52 
rd_hi
;

53 
	`__asm__
(

56 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

57 : "%r"(
b
), "r"(
	`SHL32
(
a
,16))

60  
	`SHL32
(
rd_hi
,1);

61 
	}
}

62 
	#MULT16_32_Q15
(
a
, 
b
Ë(
	`MULT16_32_Q15_¨mv4
◊, b))

	)

68 #unde‡
MAC16_32_Q15


69 
	#MAC16_32_Q15
(
c
, 
a
, 
b
Ë
	`ADD32
(c, 
	`MULT16_32_Q15
◊, b))

	)

73 #unde‡
MAC16_32_Q16


74 
	#MAC16_32_Q16
(
c
, 
a
, 
b
Ë
	`ADD32
(c, 
	`MULT16_32_Q16
◊, b))

	)

77 #unde‡
MULT32_32_Q31


78 
	#MULT32_32_Q31
(
a
,
b
Ë(
›us_vÆ32
)((((
›us_öt64
)◊)Ë* ((›us_öt64)(b)))>>31)

	)

	@celt/arm/fixed_armv5e.h

30 #i‚de‡
FIXED_ARMv5E_H


31 
	#FIXED_ARMv5E_H


	)

33 
	~"fixed_¨mv4.h
"

36 #unde‡
MULT16_32_Q16


37 
OPUS_INLINE
 
›us_vÆ32
 
	$MULT16_32_Q16_¨mv5e
(
›us_vÆ16
 
a
, 
›us_vÆ32
 
b
)

39 
ªs
;

40 
	`__asm__
(

43 : "Ù"(
ªs
)

44 : "r"(
b
),"r"(
a
)

46  
ªs
;

47 
	}
}

48 
	#MULT16_32_Q16
(
a
, 
b
Ë(
	`MULT16_32_Q16_¨mv5e
◊, b))

	)

52 #unde‡
MULT16_32_Q15


53 
OPUS_INLINE
 
›us_vÆ32
 
	$MULT16_32_Q15_¨mv5e
(
›us_vÆ16
 
a
, 
›us_vÆ32
 
b
)

55 
ªs
;

56 
	`__asm__
(

59 : "Ù"(
ªs
)

60 : "r"(
b
), "r"(
a
)

62  
	`SHL32
(
ªs
,1);

63 
	}
}

64 
	#MULT16_32_Q15
(
a
, 
b
Ë(
	`MULT16_32_Q15_¨mv5e
◊, b))

	)

70 #unde‡
MAC16_32_Q15


71 
OPUS_INLINE
 
›us_vÆ32
 
	$MAC16_32_Q15_¨mv5e
(
›us_vÆ32
 
c
, 
›us_vÆ16
 
a
,

72 
›us_vÆ32
 
b
)

74 
ªs
;

75 
	`__asm__
(

78 : "Ù"(
ªs
)

79 : "r"(
	`SHL32
(
b
,1)), "r"(
a
), "r"(
c
)

81  
ªs
;

82 
	}
}

83 
	#MAC16_32_Q15
(
c
, 
a
, 
b
Ë(
	`MAC16_32_Q15_¨mv5e
(c,á, b))

	)

87 #unde‡
MAC16_32_Q16


88 
OPUS_INLINE
 
›us_vÆ32
 
	$MAC16_32_Q16_¨mv5e
(
›us_vÆ32
 
c
, 
›us_vÆ16
 
a
,

89 
›us_vÆ32
 
b
)

91 
ªs
;

92 
	`__asm__
(

95 : "Ù"(
ªs
)

96 : "r"(
b
), "r"(
a
), "r"(
c
)

98  
ªs
;

99 
	}
}

100 
	#MAC16_32_Q16
(
c
, 
a
, 
b
Ë(
	`MAC16_32_Q16_¨mv5e
(c,á, b))

	)

103 #unde‡
MAC16_16


104 
OPUS_INLINE
 
›us_vÆ32
 
	$MAC16_16_¨mv5e
(
›us_vÆ32
 
c
, 
›us_vÆ16
 
a
,

105 
›us_vÆ16
 
b
)

107 
ªs
;

108 
	`__asm__
(

111 : "Ù"(
ªs
)

112 : "r"(
a
), "r"(
b
), "r"(
c
)

114  
ªs
;

115 
	}
}

116 
	#MAC16_16
(
c
, 
a
, 
b
Ë(
	`MAC16_16_¨mv5e
(c,á, b))

	)

119 #unde‡
MULT16_16


120 
OPUS_INLINE
 
›us_vÆ32
 
	$MULT16_16_¨mv5e
(
›us_vÆ16
 
a
, opus_vÆ16 
b
)

122 
ªs
;

123 
	`__asm__
(

126 : "Ù"(
ªs
)

127 : "r"(
a
), "r"(
b
)

129  
ªs
;

130 
	}
}

131 
	#MULT16_16
(
a
, 
b
Ë(
	`MULT16_16_¨mv5e
◊, b))

	)

133 #ifde‡
OPUS_ARM_INLINE_MEDIA


135 #unde‡
SIG2WORD16


136 
OPUS_INLINE
 
›us_vÆ16
 
	$SIG2WORD16_¨mv6
(
›us_vÆ32
 
x
)

138 
˚…_sig
 
ªs
;

139 
	`__asm__
(

142 : "Ù"(
ªs
)

143 : "r"(
x
+2048)

145  
	`EXTRACT16
(
ªs
);

146 
	}
}

147 
	#SIG2WORD16
(
x
Ë(
	`SIG2WORD16_¨mv6
(x))

	)

	@celt/arm/kiss_fft_armv4.h

26 #i‚de‡
KISS_FFT_ARMv4_H


27 
	#KISS_FFT_ARMv4_H


	)

29 #i‡!
deföed
(
KISS_FFT_GUTS_H
)

33 #ifde‡
FIXED_POINT


35 #unde‡
C_MUL


36 
	#C_MUL
(
m
,
a
,
b
) \

38 
br__
; \

39 
bi__
; \

40 
â__
; \

41 
__asm__
 
	`__vﬁ©ûe__
( \

55 : [
mr
]"Ù"((
m
).
r
), [
mi
]"Ù"((m).
i
), \

56 [
br
]"=&r"(
br__
), [
bi
]"Ù"(
bi__
), [
â
]"Ù"(
â__
) \

57 : [
≠
]"r"(&(
a
)), [
bp
]"r"(&(
b
)) \

61 0)

	)

63 #unde‡
C_MUL4


64 
	#C_MUL4
(
m
,
a
,
b
) \

66 
br__
; \

67 
bi__
; \

68 
â__
; \

69 
__asm__
 
	`__vﬁ©ûe__
( \

83 : [
mr
]"Ù"((
m
).
r
), [
mi
]"Ù"((m).
i
), \

84 [
br
]"=&r"(
br__
), [
bi
]"Ù"(
bi__
), [
â
]"Ù"(
â__
) \

85 : [
≠
]"r"(&(
a
)), [
bp
]"r"(&(
b
)) \

89 0)

	)

91 #unde‡
C_MULC


92 
	#C_MULC
(
m
,
a
,
b
) \

94 
br__
; \

95 
bi__
; \

96 
â__
; \

97 
__asm__
 
	`__vﬁ©ûe__
( \

111 : [
mr
]"Ù"((
m
).
r
), [
mi
]"Ù"((m).
i
), \

112 [
br
]"=&r"(
br__
), [
bi
]"Ù"(
bi__
), [
â
]"Ù"(
â__
) \

113 : [
≠
]"r"(&(
a
)), [
bp
]"r"(&(
b
)) \

117 0)

	)

	@celt/arm/kiss_fft_armv5e.h

26 #i‚de‡
KISS_FFT_ARMv5E_H


27 
	#KISS_FFT_ARMv5E_H


	)

29 #i‡!
deföed
(
KISS_FFT_GUTS_H
)

33 #ifde‡
FIXED_POINT


35 #i‡
deföed
(
__thumb__
)||deföed(
__thumb2__
)

36 
	#LDRD_CONS
 "Q"

	)

38 
	#LDRD_CONS
 "Uq"

	)

41 #unde‡
C_MUL


42 
	#C_MUL
(
m
,
a
,
b
) \

44 
mr1__
; \

45 
mr2__
; \

46 
mi__
; \

47 
avÆ__
; \

48 
bvÆ__
; \

49 
	`__asm__
( \

57 : [
mr1
]"Ù"(
mr1__
), [
mr2
]"Ù"(
mr2__
), [
mi
]"Ù"(
mi__
), \

58 [
avÆ
]"=&r"(
avÆ__
), [
bvÆ
]"Ù"(
bvÆ__
) \

59 : [
≠
]
	`LDRD_CONS
(
a
), [
bp
]"m"(
b
) \

61 (
m
).
r
 = 
	`SHL32
(
	`SUB32
(
mr1__
, 
mr2__
), 1); \

62 (
m
).
i
 = 
	`SHL32
(
mi__
, 1); \

64 0)

	)

66 #unde‡
C_MUL4


67 
	#C_MUL4
(
m
,
a
,
b
) \

69 
mr1__
; \

70 
mr2__
; \

71 
mi__
; \

72 
avÆ__
; \

73 
bvÆ__
; \

74 
	`__asm__
( \

82 : [
mr1
]"Ù"(
mr1__
), [
mr2
]"Ù"(
mr2__
), [
mi
]"Ù"(
mi__
), \

83 [
avÆ
]"=&r"(
avÆ__
), [
bvÆ
]"Ù"(
bvÆ__
) \

84 : [
≠
]
	`LDRD_CONS
(
a
), [
bp
]"m"(
b
) \

86 (
m
).
r
 = 
	`SHR32
(
	`SUB32
(
mr1__
, 
mr2__
), 1); \

87 (
m
).
i
 = 
	`SHR32
(
mi__
, 1); \

89 0)

	)

91 #unde‡
C_MULC


92 
	#C_MULC
(
m
,
a
,
b
) \

94 
mr__
; \

95 
mi1__
; \

96 
mi2__
; \

97 
avÆ__
; \

98 
bvÆ__
; \

99 
	`__asm__
( \

107 : [
mr
]"Ù"(
mr__
), [
mi1
]"Ù"(
mi1__
), [
mi2
]"Ù"(
mi2__
), \

108 [
avÆ
]"=&r"(
avÆ__
), [
bvÆ
]"Ù"(
bvÆ__
) \

109 : [
≠
]
	`LDRD_CONS
(
a
), [
bp
]"m"(
b
) \

111 (
m
).
r
 = 
	`SHL32
(
mr__
, 1); \

112 (
m
).
i
 = 
	`SHL32
(
	`SUB32
(
mi1__
, 
mi2__
), 1); \

114 0)

	)

	@celt/arm/mdct_arm.h

33 #i‡!
deföed
(
MDCT_ARM_H
)

34 
	#MDCT_ARM_H


	)

36 
	~"md˘.h
"

38 #i‡
deföed
(
HAVE_ARM_NE10
)

40 
˛t_md˘_f‹w¨d_√⁄
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

41 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

42 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
,

43 
shi·
, 
°ride
, 
¨ch
);

45 
˛t_md˘_backw¨d_√⁄
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

46 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

47 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
,

48 
shi·
, 
°ride
, 
¨ch
);

50 #i‡!
deföed
(
OPUS_HAVE_RTCD
)

51 
	#OVERRIDE_OPUS_MDCT
 (1)

	)

52 
	#˛t_md˘_f‹w¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_öt
, 
_shi·
, 
_°ride
, 
_¨ch
) \

53 
	`˛t_md˘_f‹w¨d_√⁄
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_öt
, 
_shi·
, 
_°ride
, 
_¨ch
)

	)

54 
	#˛t_md˘_backw¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_öt
, 
_shi·
, 
_°ride
, 
_¨ch
) \

55 
	`˛t_md˘_backw¨d_√⁄
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_öt
, 
_shi·
, 
_°ride
, 
_¨ch
)

	)

	@celt/arm/pitch_arm.h

28 #i‡!
deföed
(
PITCH_ARM_H
)

29 
	#PITCH_ARM_H


	)

31 
	~"¨m˝u.h
"

33 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

34 
›us_vÆ32
 
˚…_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
N
);

35 
duÆ_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
,

36 c⁄° 
›us_vÆ16
 *
y02
, 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
);

38 #i‡!
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_PRESUME_NEON
)

39 
	#OVERRIDE_CELT_INNER_PROD
 (1)

	)

40 
	#OVERRIDE_DUAL_INNER_PROD
 (1)

	)

41 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
Ë(()◊rch), 
	`PRESUME_NEON
(
˚…_ö√r_¥od
)(x, y, N))

	)

42 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
Ë(()◊rch), 
	`PRESUME_NEON
(
duÆ_ö√r_¥od
)(x, y01, y02, N, xy1, xy2))

	)

46 #i‡!
deföed
(
OVERRIDE_CELT_INNER_PROD
)

47 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
))

48 
›us_vÆ32
 (*c⁄° 
CELT_INNER_PROD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
N
);

49 
	#OVERRIDE_CELT_INNER_PROD
 (1)

	)

50 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
Ë((*
CELT_INNER_PROD_IMPL
[◊rch)&
OPUS_ARCHMASK
])(x, y, N))

	)

51 #ñi‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

52 
	#OVERRIDE_CELT_INNER_PROD
 (1)

	)

53 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
Ë(()◊rch), 
	`˚…_ö√r_¥od_√⁄
(x, y, N))

	)

57 #i‡!
deföed
(
OVERRIDE_DUAL_INNER_PROD
)

58 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
))

59 (*c⁄° 
DUAL_INNER_PROD_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *
x
,

60 c⁄° 
›us_vÆ16
 *
y01
, c⁄° opus_vÆ16 *
y02
, 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
);

61 
	#OVERRIDE_DUAL_INNER_PROD
 (1)

	)

62 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
Ë((*
DUAL_INNER_PROD_IMPL
[◊rch)&
OPUS_ARCHMASK
])(x, y01, y02, N, xy1, xy2))

	)

63 #ñi‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

64 
	#OVERRIDE_DUAL_INNER_PROD
 (1)

	)

65 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
Ë(()◊rch), 
	`duÆ_ö√r_¥od_√⁄
(x, y01, y02, N, xy1, xy2))

	)

69 #i‡
deföed
(
FIXED_POINT
)

71 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON
)

72 
›us_vÆ32
 
˚…_pôch_xc‹r_√⁄
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

73 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
);

76 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
)

77 
	#˚…_pôch_xc‹r_medü
 
	`MAY_HAVE_EDSP
(
˚…_pôch_xc‹r
)

	)

80 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_EDSP
)

81 
›us_vÆ32
 
˚…_pôch_xc‹r_ed•
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

82 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
);

85 #i‡
deföed
(
OPUS_HAVE_RTCD
) && \

86 ((
deföed
(
OPUS_ARM_MAY_HAVE_NEON
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON
)) || \

87 (
deföed
(
OPUS_ARM_MAY_HAVE_MEDIA
Ë&& !deföed(
OPUS_ARM_PRESUME_MEDIA
)) || \

88 (
deföed
(
OPUS_ARM_MAY_HAVE_EDSP
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_EDSP
)))

89 
›us_vÆ32


90 (*c⁄° 
CELT_PITCH_XCORR_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *,

91 c⁄° 
›us_vÆ16
 *, 
›us_vÆ32
 *, , , );

92 
	#OVERRIDE_PITCH_XCORR
 (1)

	)

93 
	#˚…_pôch_xc‹r
(
_x
, 
_y
, 
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
) \

94 ((*
CELT_PITCH_XCORR_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_x
, 
_y
, \

95 
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
))

	)

97 #ñi‡
	`deföed
(
OPUS_ARM_PRESUME_EDSP
) || \

98 
	`deföed
(
OPUS_ARM_PRESUME_MEDIA
) || \

99 
	$deföed
(
OPUS_ARM_PRESUME_NEON
)

100 
	#OVERRIDE_PITCH_XCORR
 (1)

	)

101 
	#˚…_pôch_xc‹r
 (
	`PRESUME_NEON
(
˚…_pôch_xc‹r
))

	)

105 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

106 
	`xc‹r_kî√l_√⁄_fixed
(

107 c⁄° 
›us_vÆ16
 *
x
,

108 c⁄° 
›us_vÆ16
 *
y
,

109 
›us_vÆ32
 
sum
[4],

110 
Àn
);

113 #i‡
	`deföed
(
OPUS_HAVE_RTCD
) && \

114 (
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
))

116 (*c⁄° 
XCORR_KERNEL_IMPL
[
OPUS_ARCHMASK
 + 1])(

117 c⁄° 
›us_vÆ16
 *
x
,

118 c⁄° 
›us_vÆ16
 *
y
,

119 
›us_vÆ32
 
sum
[4],

120 
Àn
);

122 
	#OVERRIDE_XCORR_KERNEL
 (1)

	)

123 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

124 ((*
XCORR_KERNEL_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
x
, 
y
, 
sum
, 
Àn
))

	)

126 #ñi‡
	`deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

127 
	#OVERRIDE_XCORR_KERNEL
 (1)

	)

128 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

129 (()
¨ch
, 
	`xc‹r_kî√l_√⁄_fixed
(
x
, 
y
, 
sum
, 
Àn
))

	)

135 #i‡
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

136 
	`˚…_pôch_xc‹r_Êﬂt_√⁄
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

137 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
);

140 #i‡
	`deföed
(
OPUS_HAVE_RTCD
) && \

141 (
	`deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
))

143 (*c⁄° 
CELT_PITCH_XCORR_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_vÆ16
 *,

144 c⁄° 
›us_vÆ16
 *, 
›us_vÆ32
 *, , , );

146 
	#OVERRIDE_PITCH_XCORR
 (1)

	)

147 
	#˚…_pôch_xc‹r
(
_x
, 
_y
, 
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
) \

148 ((*
CELT_PITCH_XCORR_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_x
, 
_y
, \

149 
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
))

	)

151 #ñi‡
	`deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

153 
	#OVERRIDE_PITCH_XCORR
 (1)

	)

154 
	#˚…_pôch_xc‹r
 
˚…_pôch_xc‹r_Êﬂt_√⁄


	)

	@celt/arm/pitch_neon_intr.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<¨m_√⁄.h
>

33 
	~"pôch.h
"

35 #ifde‡
FIXED_POINT


37 
›us_vÆ32
 
	$˚…_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
N
)

39 
i
;

40 
›us_vÆ32
 
xy
;

41 
öt16x8_t
 
x_s16x8
, 
y_s16x8
;

42 
öt32x4_t
 
xy_s32x4
 = 
	`vdupq_n_s32
(0);

43 
öt64x2_t
 
xy_s64x2
;

44 
öt64x1_t
 
xy_s64x1
;

46 
i
 = 0; i < 
N
 - 7; i += 8) {

47 
x_s16x8
 = 
	`vld1q_s16
(&
x
[
i
]);

48 
y_s16x8
 = 
	`vld1q_s16
(&
y
[
i
]);

49 
xy_s32x4
 = 
	`vmœl_s16
(xy_s32x4, 
	`vgë_low_s16
 (
x_s16x8
), vgë_low_s16 (
y_s16x8
));

50 
xy_s32x4
 = 
	`vmœl_s16
(xy_s32x4, 
	`vgë_high_s16
(
x_s16x8
), vgë_high_s16(
y_s16x8
));

53 i‡(
N
 - 
i
 >= 4) {

54 c⁄° 
öt16x4_t
 
x_s16x4
 = 
	`vld1_s16
(&
x
[
i
]);

55 c⁄° 
öt16x4_t
 
y_s16x4
 = 
	`vld1_s16
(&
y
[
i
]);

56 
xy_s32x4
 = 
	`vmœl_s16
(xy_s32x4, 
x_s16x4
, 
y_s16x4
);

57 
i
 += 4;

60 
xy_s64x2
 = 
	`v∑ddlq_s32
(
xy_s32x4
);

61 
xy_s64x1
 = 
	`vadd_s64
(
	`vgë_low_s64
(
xy_s64x2
), 
	`vgë_high_s64
(xy_s64x2));

62 
xy
 = 
	`vgë_œ√_s32
(
	`vªöãΩªt_s32_s64
(
xy_s64x1
), 0);

64 ; 
i
 < 
N
; i++) {

65 
xy
 = 
	`MAC16_16
(xy, 
x
[
i
], 
y
[i]);

68 #ifde‡
OPUS_CHECK_ASM


69 
	`˚…_as£π
(
	`˚…_ö√r_¥od_c
(
x
, 
y
, 
N
Ë=
xy
);

72  
xy
;

73 
	}
}

75 
	$duÆ_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

76 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
)

78 
i
;

79 
›us_vÆ32
 
xy01
, 
xy02
;

80 
öt16x8_t
 
x_s16x8
, 
y01_s16x8
, 
y02_s16x8
;

81 
öt32x4_t
 
xy01_s32x4
 = 
	`vdupq_n_s32
(0);

82 
öt32x4_t
 
xy02_s32x4
 = 
	`vdupq_n_s32
(0);

83 
öt64x2_t
 
xy01_s64x2
, 
xy02_s64x2
;

84 
öt64x1_t
 
xy01_s64x1
, 
xy02_s64x1
;

86 
i
 = 0; i < 
N
 - 7; i += 8) {

87 
x_s16x8
 = 
	`vld1q_s16
(&
x
[
i
]);

88 
y01_s16x8
 = 
	`vld1q_s16
(&
y01
[
i
]);

89 
y02_s16x8
 = 
	`vld1q_s16
(&
y02
[
i
]);

90 
xy01_s32x4
 = 
	`vmœl_s16
(xy01_s32x4, 
	`vgë_low_s16
 (
x_s16x8
), vgë_low_s16 (
y01_s16x8
));

91 
xy02_s32x4
 = 
	`vmœl_s16
(xy02_s32x4, 
	`vgë_low_s16
 (
x_s16x8
), vgë_low_s16 (
y02_s16x8
));

92 
xy01_s32x4
 = 
	`vmœl_s16
(xy01_s32x4, 
	`vgë_high_s16
(
x_s16x8
), vgë_high_s16(
y01_s16x8
));

93 
xy02_s32x4
 = 
	`vmœl_s16
(xy02_s32x4, 
	`vgë_high_s16
(
x_s16x8
), vgë_high_s16(
y02_s16x8
));

96 i‡(
N
 - 
i
 >= 4) {

97 c⁄° 
öt16x4_t
 
x_s16x4
 = 
	`vld1_s16
(&
x
[
i
]);

98 c⁄° 
öt16x4_t
 
y01_s16x4
 = 
	`vld1_s16
(&
y01
[
i
]);

99 c⁄° 
öt16x4_t
 
y02_s16x4
 = 
	`vld1_s16
(&
y02
[
i
]);

100 
xy01_s32x4
 = 
	`vmœl_s16
(xy01_s32x4, 
x_s16x4
, 
y01_s16x4
);

101 
xy02_s32x4
 = 
	`vmœl_s16
(xy02_s32x4, 
x_s16x4
, 
y02_s16x4
);

102 
i
 += 4;

105 
xy01_s64x2
 = 
	`v∑ddlq_s32
(
xy01_s32x4
);

106 
xy02_s64x2
 = 
	`v∑ddlq_s32
(
xy02_s32x4
);

107 
xy01_s64x1
 = 
	`vadd_s64
(
	`vgë_low_s64
(
xy01_s64x2
), 
	`vgë_high_s64
(xy01_s64x2));

108 
xy02_s64x1
 = 
	`vadd_s64
(
	`vgë_low_s64
(
xy02_s64x2
), 
	`vgë_high_s64
(xy02_s64x2));

109 
xy01
 = 
	`vgë_œ√_s32
(
	`vªöãΩªt_s32_s64
(
xy01_s64x1
), 0);

110 
xy02
 = 
	`vgë_œ√_s32
(
	`vªöãΩªt_s32_s64
(
xy02_s64x1
), 0);

112 ; 
i
 < 
N
; i++) {

113 
xy01
 = 
	`MAC16_16
(xy01, 
x
[
i
], 
y01
[i]);

114 
xy02
 = 
	`MAC16_16
(xy02, 
x
[
i
], 
y02
[i]);

116 *
xy1
 = 
xy01
;

117 *
xy2
 = 
xy02
;

119 #ifde‡
OPUS_CHECK_ASM


121 
›us_vÆ32
 
xy1_c
, 
xy2_c
;

122 
	`duÆ_ö√r_¥od_c
(
x
, 
y01
, 
y02
, 
N
, &
xy1_c
, &
xy2_c
);

123 
	`˚…_as£π
(
xy1_c
 =*
xy1
);

124 
	`˚…_as£π
(
xy2_c
 =*
xy2
);

127 
	}
}

133 #ifde‡
OPUS_CHECK_ASM


140 
›us_vÆ32
 
	$˚…_ö√r_¥od_√⁄_Êﬂt_c_simuœti⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
N
)

142 
i
;

143 
›us_vÆ32
 
xy
, 
xy0
 = 0, 
xy1
 = 0, 
xy2
 = 0, 
xy3
 = 0;

144 
i
 = 0; i < 
N
 - 3; i += 4) {

145 
xy0
 = 
	`MAC16_16
(xy0, 
x
[
i
 + 0], 
y
[i + 0]);

146 
xy1
 = 
	`MAC16_16
(xy1, 
x
[
i
 + 1], 
y
[i + 1]);

147 
xy2
 = 
	`MAC16_16
(xy2, 
x
[
i
 + 2], 
y
[i + 2]);

148 
xy3
 = 
	`MAC16_16
(xy3, 
x
[
i
 + 3], 
y
[i + 3]);

150 
xy0
 +
xy2
;

151 
xy1
 +
xy3
;

152 
xy
 = 
xy0
 + 
xy1
;

153 ; 
i
 < 
N
; i++) {

154 
xy
 = 
	`MAC16_16
(xy, 
x
[
i
], 
y
[i]);

156  
xy
;

157 
	}
}

162 
	$duÆ_ö√r_¥od_√⁄_Êﬂt_c_simuœti⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

163 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
)

165 
i
;

166 
›us_vÆ32
 
xy01
, 
xy02
, 
xy01_0
 = 0, 
xy01_1
 = 0, 
xy01_2
 = 0, 
xy01_3
 = 0, 
xy02_0
 = 0, 
xy02_1
 = 0, 
xy02_2
 = 0, 
xy02_3
 = 0;

167 
i
 = 0; i < 
N
 - 3; i += 4) {

168 
xy01_0
 = 
	`MAC16_16
(xy01_0, 
x
[
i
 + 0], 
y01
[i + 0]);

169 
xy01_1
 = 
	`MAC16_16
(xy01_1, 
x
[
i
 + 1], 
y01
[i + 1]);

170 
xy01_2
 = 
	`MAC16_16
(xy01_2, 
x
[
i
 + 2], 
y01
[i + 2]);

171 
xy01_3
 = 
	`MAC16_16
(xy01_3, 
x
[
i
 + 3], 
y01
[i + 3]);

172 
xy02_0
 = 
	`MAC16_16
(xy02_0, 
x
[
i
 + 0], 
y02
[i + 0]);

173 
xy02_1
 = 
	`MAC16_16
(xy02_1, 
x
[
i
 + 1], 
y02
[i + 1]);

174 
xy02_2
 = 
	`MAC16_16
(xy02_2, 
x
[
i
 + 2], 
y02
[i + 2]);

175 
xy02_3
 = 
	`MAC16_16
(xy02_3, 
x
[
i
 + 3], 
y02
[i + 3]);

177 
xy01_0
 +
xy01_2
;

178 
xy02_0
 +
xy02_2
;

179 
xy01_1
 +
xy01_3
;

180 
xy02_1
 +
xy02_3
;

181 
xy01
 = 
xy01_0
 + 
xy01_1
;

182 
xy02
 = 
xy02_0
 + 
xy02_1
;

183 ; 
i
 < 
N
; i++) {

184 
xy01
 = 
	`MAC16_16
(xy01, 
x
[
i
], 
y01
[i]);

185 
xy02
 = 
	`MAC16_16
(xy02, 
x
[
i
], 
y02
[i]);

187 *
xy1
 = 
xy01
;

188 *
xy2
 = 
xy02
;

189 
	}
}

195 
›us_vÆ32
 
	$˚…_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
N
)

197 
i
;

198 
›us_vÆ32
 
xy
;

199 
Êﬂt32x4_t
 
xy_f32x4
 = 
	`vdupq_n_f32
(0);

200 
Êﬂt32x2_t
 
xy_f32x2
;

202 
i
 = 0; i < 
N
 - 7; i += 8) {

203 
Êﬂt32x4_t
 
x_f32x4
, 
y_f32x4
;

204 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
]);

205 
y_f32x4
 = 
	`vld1q_f32
(&
y
[
i
]);

206 
xy_f32x4
 = 
	`vmœq_f32
(xy_f32x4, 
x_f32x4
, 
y_f32x4
);

207 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
 + 4]);

208 
y_f32x4
 = 
	`vld1q_f32
(&
y
[
i
 + 4]);

209 
xy_f32x4
 = 
	`vmœq_f32
(xy_f32x4, 
x_f32x4
, 
y_f32x4
);

212 i‡(
N
 - 
i
 >= 4) {

213 c⁄° 
Êﬂt32x4_t
 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
]);

214 c⁄° 
Êﬂt32x4_t
 
y_f32x4
 = 
	`vld1q_f32
(&
y
[
i
]);

215 
xy_f32x4
 = 
	`vmœq_f32
(xy_f32x4, 
x_f32x4
, 
y_f32x4
);

216 
i
 += 4;

219 
xy_f32x2
 = 
	`vadd_f32
(
	`vgë_low_f32
(
xy_f32x4
), 
	`vgë_high_f32
(xy_f32x4));

220 
xy_f32x2
 = 
	`v∑dd_f32
(xy_f32x2, xy_f32x2);

221 
xy
 = 
	`vgë_œ√_f32
(
xy_f32x2
, 0);

223 ; 
i
 < 
N
; i++) {

224 
xy
 = 
	`MAC16_16
(xy, 
x
[
i
], 
y
[i]);

227 #ifde‡
OPUS_CHECK_ASM


228 
	`˚…_as£π
(
	`ABS32
(
	`˚…_ö√r_¥od_√⁄_Êﬂt_c_simuœti⁄
(
x
, 
y
, 
N
Ë- 
xy
Ë<
VERY_SMALL
);

231  
xy
;

232 
	}
}

234 
	$duÆ_ö√r_¥od_√⁄
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

235 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
)

237 
i
;

238 
›us_vÆ32
 
xy01
, 
xy02
;

239 
Êﬂt32x4_t
 
xy01_f32x4
 = 
	`vdupq_n_f32
(0);

240 
Êﬂt32x4_t
 
xy02_f32x4
 = 
	`vdupq_n_f32
(0);

241 
Êﬂt32x2_t
 
xy01_f32x2
, 
xy02_f32x2
;

243 
i
 = 0; i < 
N
 - 7; i += 8) {

244 
Êﬂt32x4_t
 
x_f32x4
, 
y01_f32x4
, 
y02_f32x4
;

245 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
]);

246 
y01_f32x4
 = 
	`vld1q_f32
(&
y01
[
i
]);

247 
y02_f32x4
 = 
	`vld1q_f32
(&
y02
[
i
]);

248 
xy01_f32x4
 = 
	`vmœq_f32
(xy01_f32x4, 
x_f32x4
, 
y01_f32x4
);

249 
xy02_f32x4
 = 
	`vmœq_f32
(xy02_f32x4, 
x_f32x4
, 
y02_f32x4
);

250 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
 + 4]);

251 
y01_f32x4
 = 
	`vld1q_f32
(&
y01
[
i
 + 4]);

252 
y02_f32x4
 = 
	`vld1q_f32
(&
y02
[
i
 + 4]);

253 
xy01_f32x4
 = 
	`vmœq_f32
(xy01_f32x4, 
x_f32x4
, 
y01_f32x4
);

254 
xy02_f32x4
 = 
	`vmœq_f32
(xy02_f32x4, 
x_f32x4
, 
y02_f32x4
);

257 i‡(
N
 - 
i
 >= 4) {

258 c⁄° 
Êﬂt32x4_t
 
x_f32x4
 = 
	`vld1q_f32
(&
x
[
i
]);

259 c⁄° 
Êﬂt32x4_t
 
y01_f32x4
 = 
	`vld1q_f32
(&
y01
[
i
]);

260 c⁄° 
Êﬂt32x4_t
 
y02_f32x4
 = 
	`vld1q_f32
(&
y02
[
i
]);

261 
xy01_f32x4
 = 
	`vmœq_f32
(xy01_f32x4, 
x_f32x4
, 
y01_f32x4
);

262 
xy02_f32x4
 = 
	`vmœq_f32
(xy02_f32x4, 
x_f32x4
, 
y02_f32x4
);

263 
i
 += 4;

266 
xy01_f32x2
 = 
	`vadd_f32
(
	`vgë_low_f32
(
xy01_f32x4
), 
	`vgë_high_f32
(xy01_f32x4));

267 
xy02_f32x2
 = 
	`vadd_f32
(
	`vgë_low_f32
(
xy02_f32x4
), 
	`vgë_high_f32
(xy02_f32x4));

268 
xy01_f32x2
 = 
	`v∑dd_f32
(xy01_f32x2, xy01_f32x2);

269 
xy02_f32x2
 = 
	`v∑dd_f32
(xy02_f32x2, xy02_f32x2);

270 
xy01
 = 
	`vgë_œ√_f32
(
xy01_f32x2
, 0);

271 
xy02
 = 
	`vgë_œ√_f32
(
xy02_f32x2
, 0);

273 ; 
i
 < 
N
; i++) {

274 
xy01
 = 
	`MAC16_16
(xy01, 
x
[
i
], 
y01
[i]);

275 
xy02
 = 
	`MAC16_16
(xy02, 
x
[
i
], 
y02
[i]);

277 *
xy1
 = 
xy01
;

278 *
xy2
 = 
xy02
;

280 #ifde‡
OPUS_CHECK_ASM


282 
›us_vÆ32
 
xy1_c
, 
xy2_c
;

283 
	`duÆ_ö√r_¥od_√⁄_Êﬂt_c_simuœti⁄
(
x
, 
y01
, 
y02
, 
N
, &
xy1_c
, &
xy2_c
);

284 
	`˚…_as£π
(
	`ABS32
(
xy1_c
 - *
xy1
Ë<
VERY_SMALL
);

285 
	`˚…_as£π
(
	`ABS32
(
xy2_c
 - *
xy2
Ë<
VERY_SMALL
);

288 
	}
}

	@celt/bands.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	~<m©h.h
>

35 
	~"b™ds.h
"

36 
	~"modes.h
"

37 
	~"vq.h
"

38 
	~"cwrs.h
"

39 
	~"°ack_Æloc.h
"

40 
	~"os_suµ‹t.h
"

41 
	~"m©h›s.h
"

42 
	~"øã.h
"

43 
	~"qu™t_b™ds.h
"

44 
	~"pôch.h
"

46 
	$hy°îesis_decisi⁄
(
›us_vÆ16
 
vÆ
, c⁄° opus_vÆ16 *
thªshﬁds
, c⁄° opus_vÆ16 *
hy°îesis
, 
N
, 
¥ev
)

48 
i
;

49 
i
=0;i<
N
;i++)

51 i‡(
vÆ
 < 
thªshﬁds
[
i
])

54 i‡(
i
>
¥ev
 && 
vÆ
 < 
thªshﬁds
[¥ev]+
hy°îesis
[prev])

55 
i
=
¥ev
;

56 i‡(
i
<
¥ev
 && 
vÆ
 > 
thªshﬁds
[¥ev-1]-
hy°îesis
[prev-1])

57 
i
=
¥ev
;

58  
i
;

59 
	}
}

61 
›us_uöt32
 
	$˚…_lcg_ønd
(
›us_uöt32
 
£ed
)

63  1664525 * 
£ed
 + 1013904223;

64 
	}
}

68 
›us_öt16
 
	$bôexa˘_cos
(
›us_öt16
 
x
)

70 
›us_öt32
 
tmp
;

71 
›us_öt16
 
x2
;

72 
tmp
 = (4096+((
›us_öt32
)(
x
)*(x)))>>13;

73 
	`˚…_sig_as£π
(
tmp
<=32767);

74 
x2
 = 
tmp
;

75 
x2
 = (32767-x2Ë+ 
	`FRAC_MUL16
(x2, (-7651 + FRAC_MUL16(x2, (8277 + FRAC_MUL16(-626, x2)))));

76 
	`˚…_sig_as£π
(
x2
<=32766);

77  1+
x2
;

78 
	}
}

80 
	$bôexa˘_log2èn
(
isö
,
icos
)

82 
lc
;

83 
ls
;

84 
lc
=
	`EC_ILOG
(
icos
);

85 
ls
=
	`EC_ILOG
(
isö
);

86 
icos
<<=15-
lc
;

87 
isö
<<=15-
ls
;

88  (
ls
-
lc
)*(1<<11)

89 +
	`FRAC_MUL16
(
isö
, FRAC_MUL16(isin, -2597) + 7932)

90 -
	`FRAC_MUL16
(
icos
, FRAC_MUL16(icos, -2597) + 7932);

91 
	}
}

93 #ifde‡
FIXED_POINT


95 
	$compuã_b™d_íîgõs
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 *
X
, 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
LM
, 
¨ch
)

97 
i
, 
c
, 
N
;

98 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

99 ()
¨ch
;

100 
N
 = 
m
->
sh‹tMd˘Size
<<
LM
;

101 
c
=0; do {

102 
i
=0;i<
íd
;i++)

104 
j
;

105 
›us_vÆ32
 
maxvÆ
=0;

106 
›us_vÆ32
 
sum
 = 0;

108 
maxvÆ
 = 
	`˚…_maxabs32
(&
X
[
c
*
N
+(
eB™ds
[
i
]<<
LM
)], (eBands[i+1]-eBands[i])<<LM);

109 i‡(
maxvÆ
 > 0)

111 
shi·
 = 
	`˚…_ûog2
(
maxvÆ
Ë- 14 + (((
m
->
logN
[
i
]>>
BITRES
)+
LM
+1)>>1);

112 
j
=
eB™ds
[
i
]<<
LM
;

113 i‡(
shi·
>0)

116 
sum
 = 
	`MAC16_16
(sum, 
	`EXTRACT16
(
	`SHR32
(
X
[
j
+
c
*
N
],
shi·
)),

117 
	`EXTRACT16
(
	`SHR32
(
X
[
j
+
c
*
N
],
shi·
)));

118 } ++
j
<
eB™ds
[
i
+1]<<
LM
);

121 
sum
 = 
	`MAC16_16
(sum, 
	`EXTRACT16
(
	`SHL32
(
X
[
j
+
c
*
N
],-
shi·
)),

122 
	`EXTRACT16
(
	`SHL32
(
X
[
j
+
c
*
N
],-
shi·
)));

123 } ++
j
<
eB™ds
[
i
+1]<<
LM
);

126 
b™dE
[
i
+
c
*
m
->
nbEB™ds
] = 
EPSILON
+
	`VSHR32
(
	`EXTEND32
(
	`˚…_sqπ
(
sum
)),-
shi·
);

128 
b™dE
[
i
+
c
*
m
->
nbEB™ds
] = 
EPSILON
;

132 } ++
c
<
C
);

134 
	}
}

137 
	$n‹mÆi£_b™ds
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 * 
OPUS_RESTRICT
 
‰eq
, 
˚…_n‹m
 * OPUS_RESTRICT 
X
, c⁄° 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
M
)

139 
i
, 
c
, 
N
;

140 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

141 
N
 = 
M
*
m
->
sh‹tMd˘Size
;

142 
c
=0; do {

143 
i
=0; do {

144 
›us_vÆ16
 
g
;

145 
j
,
shi·
;

146 
›us_vÆ16
 
E
;

147 
shi·
 = 
	`˚…_zlog2
(
b™dE
[
i
+
c
*
m
->
nbEB™ds
])-13;

148 
E
 = 
	`VSHR32
(
b™dE
[
i
+
c
*
m
->
nbEB™ds
], 
shi·
);

149 
g
 = 
	`EXTRACT16
(
	`˚…_r˝
(
	`SHL32
(
E
,3)));

150 
j
=
M
*
eB™ds
[
i
]; do {

151 
X
[
j
+
c
*
N
] = 
	`MULT16_16_Q15
(
	`VSHR32
(
‰eq
[j+c*N],
shi·
-1),
g
);

152 } ++
j
<
M
*
eB™ds
[
i
+1]);

153 } ++
i
<
íd
);

154 } ++
c
<
C
);

155 
	}
}

159 
	$compuã_b™d_íîgõs
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 *
X
, 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
LM
, 
¨ch
)

161 
i
, 
c
, 
N
;

162 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

163 
N
 = 
m
->
sh‹tMd˘Size
<<
LM
;

164 
c
=0; do {

165 
i
=0;i<
íd
;i++)

167 
›us_vÆ32
 
sum
;

168 
sum
 = 1e-27‡+ 
	`˚…_ö√r_¥od
(&
X
[
c
*
N
+(
eB™ds
[
i
]<<
LM
)], &X[c*N+”B™ds[i]<<LM)], (eB™ds[i+1]-eB™ds[i])<<LM, 
¨ch
);

169 
b™dE
[
i
+
c
*
m
->
nbEB™ds
] = 
	`˚…_sqπ
(
sum
);

172 } ++
c
<
C
);

174 
	}
}

177 
	$n‹mÆi£_b™ds
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 * 
OPUS_RESTRICT
 
‰eq
, 
˚…_n‹m
 * OPUS_RESTRICT 
X
, c⁄° 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
M
)

179 
i
, 
c
, 
N
;

180 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

181 
N
 = 
M
*
m
->
sh‹tMd˘Size
;

182 
c
=0; do {

183 
i
=0;i<
íd
;i++)

185 
j
;

186 
›us_vÆ16
 
g
 = 1.f/(1e-27f+
b™dE
[
i
+
c
*
m
->
nbEB™ds
]);

187 
j
=
M
*
eB™ds
[
i
];j<M*eBands[i+1];j++)

188 
X
[
j
+
c
*
N
] = 
‰eq
[j+c*N]*
g
;

190 } ++
c
<
C
);

191 
	}
}

196 
	$dí‹mÆi£_b™ds
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
,

197 
˚…_sig
 * 
OPUS_RESTRICT
 
‰eq
, c⁄° 
›us_vÆ16
 *
b™dLogE
, 
°¨t
,

198 
íd
, 
M
, 
downßm∂e
, 
sûí˚
)

200 
i
, 
N
;

201 
bound
;

202 
˚…_sig
 * 
OPUS_RESTRICT
 
f
;

203 c⁄° 
˚…_n‹m
 * 
OPUS_RESTRICT
 
x
;

204 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

205 
N
 = 
M
*
m
->
sh‹tMd˘Size
;

206 
bound
 = 
M
*
eB™ds
[
íd
];

207 i‡(
downßm∂e
!=1)

208 
bound
 = 
	`IMIN
(bound, 
N
/
downßm∂e
);

209 i‡(
sûí˚
)

211 
bound
 = 0;

212 
°¨t
 = 
íd
 = 0;

214 
f
 = 
‰eq
;

215 
x
 = 
X
+
M
*
eB™ds
[
°¨t
];

216 
i
=0;i<
M
*
eB™ds
[
°¨t
];i++)

217 *
f
++ = 0;

218 
i
=
°¨t
;i<
íd
;i++)

220 
j
, 
b™d_íd
;

221 
›us_vÆ16
 
g
;

222 
›us_vÆ16
 
lg
;

223 #ifde‡
FIXED_POINT


224 
shi·
;

226 
j
=
M
*
eB™ds
[
i
];

227 
b™d_íd
 = 
M
*
eB™ds
[
i
+1];

228 
lg
 = 
	`SATURATE16
(
	`ADD32
(
b™dLogE
[
i
], 
	`SHL32
((
›us_vÆ32
)
eMóns
[i],6)));

229 #i‚de‡
FIXED_POINT


230 
g
 = 
	`˚…_exp2
(
	`MIN32
(32.f, 
lg
));

233 
shi·
 = 16-(
lg
>>
DB_SHIFT
);

234 i‡(
shi·
>31)

236 
shi·
=0;

237 
g
=0;

240 
g
 = 
	`˚…_exp2_‰ac
(
lg
&((1<<
DB_SHIFT
)-1));

243 i‡(
shi·
<0)

248 i‡(
shi·
 <= -2)

250 
g
 = 16384;

251 
shi·
 = -2;

254 *
f
++ = 
	`SHL32
(
	`MULT16_16
(*
x
++, 
g
), -
shi·
);

255 } ++
j
<
b™d_íd
);

260 *
f
++ = 
	`SHR32
(
	`MULT16_16
(*
x
++, 
g
), 
shi·
);

261 } ++
j
<
b™d_íd
);

263 
	`˚…_as£π
(
°¨t
 <
íd
);

264 
	`OPUS_CLEAR
(&
‰eq
[
bound
], 
N
-bound);

265 
	}
}

268 
	$™ti_cﬁœp£
(c⁄° 
CELTMode
 *
m
, 
˚…_n‹m
 *
X_
, *
cﬁœp£_masks
, 
LM
, 
C
, 
size
,

269 
°¨t
, 
íd
, c⁄° 
›us_vÆ16
 *
logE
, c⁄° opus_vÆ16 *
¥ev1logE
,

270 c⁄° 
›us_vÆ16
 *
¥ev2logE
, c⁄° *
pul£s
, 
›us_uöt32
 
£ed
, 
¨ch
)

272 
c
, 
i
, 
j
, 
k
;

273 
i
=
°¨t
;i<
íd
;i++)

275 
N0
;

276 
›us_vÆ16
 
thªsh
, 
sqπ_1
;

277 
dïth
;

278 #ifde‡
FIXED_POINT


279 
shi·
;

280 
›us_vÆ32
 
thªsh32
;

283 
N0
 = 
m
->
eB™ds
[
i
+1]-m->eBands[i];

285 
	`˚…_sig_as£π
(
pul£s
[
i
]>=0);

286 
dïth
 = 
	`˚…_udiv
(1+
pul£s
[
i
], (
m
->
eB™ds
[i+1]-m->eB™ds[i]))>>
LM
;

288 #ifde‡
FIXED_POINT


289 
thªsh32
 = 
	`SHR32
(
	`˚…_exp2
(-
	`SHL16
(
dïth
, 10-
BITRES
)),1);

290 
thªsh
 = 
	`MULT16_32_Q15
(
	`QCONST16
(0.5f, 15), 
	`MIN32
(32767,
thªsh32
));

292 
›us_vÆ32
 
t
;

293 
t
 = 
N0
<<
LM
;

294 
shi·
 = 
	`˚…_ûog2
(
t
)>>1;

295 
t
 = 
	`SHL32
—, (7-
shi·
)<<1);

296 
sqπ_1
 = 
	`˚…_rsqπ_n‹m
(
t
);

299 
thªsh
 = .5f*
	`˚…_exp2
(-.125f*
dïth
);

300 
sqπ_1
 = 
	`˚…_rsqπ
(
N0
<<
LM
);

303 
c
=0; do

305 
˚…_n‹m
 *
X
;

306 
›us_vÆ16
 
¥ev1
;

307 
›us_vÆ16
 
¥ev2
;

308 
›us_vÆ32
 
Ediff
;

309 
›us_vÆ16
 
r
;

310 
ªn‹mÆize
=0;

311 
¥ev1
 = 
¥ev1logE
[
c
*
m
->
nbEB™ds
+
i
];

312 
¥ev2
 = 
¥ev2logE
[
c
*
m
->
nbEB™ds
+
i
];

313 i‡(
C
==1)

315 
¥ev1
 = 
	`MAX16
’ªv1,
¥ev1logE
[
m
->
nbEB™ds
+
i
]);

316 
¥ev2
 = 
	`MAX16
’ªv2,
¥ev2logE
[
m
->
nbEB™ds
+
i
]);

318 
Ediff
 = 
	`EXTEND32
(
logE
[
c
*
m
->
nbEB™ds
+
i
])-EXTEND32(
	`MIN16
(
¥ev1
,
¥ev2
));

319 
Ediff
 = 
	`MAX32
(0, Ediff);

321 #ifde‡
FIXED_POINT


322 i‡(
Ediff
 < 16384)

324 
›us_vÆ32
 
r32
 = 
	`SHR32
(
	`˚…_exp2
(-
	`EXTRACT16
(
Ediff
)),1);

325 
r
 = 2*
	`MIN16
(16383,
r32
);

327 
r
 = 0;

329 i‡(
LM
==3)

330 
r
 = 
	`MULT16_16_Q14
(23170, 
	`MIN32
(23169,Ñ));

331 
r
 = 
	`SHR16
(
	`MIN16
(
thªsh
,Ñ),1);

332 
r
 = 
	`SHR32
(
	`MULT16_16_Q15
(
sqπ_1
,Ñ),
shi·
);

336 
r
 = 2.f*
	`˚…_exp2
(-
Ediff
);

337 i‡(
LM
==3)

338 
r
 *= 1.41421356f;

339 
r
 = 
	`MIN16
(
thªsh
,Ñ);

340 
r
 =Ñ*
sqπ_1
;

342 
X
 = 
X_
+
c
*
size
+(
m
->
eB™ds
[
i
]<<
LM
);

343 
k
=0;k<1<<
LM
;k++)

346 i‡(!(
cﬁœp£_masks
[
i
*
C
+
c
]&1<<
k
))

349 
j
=0;j<
N0
;j++)

351 
£ed
 = 
	`˚…_lcg_ønd
(seed);

352 
X
[(
j
<<
LM
)+
k
] = (
£ed
&0x8000 ? 
r
 : -r);

354 
ªn‹mÆize
 = 1;

358 i‡(
ªn‹mÆize
)

359 
	`ªn‹mÆi£_ve˘‹
(
X
, 
N0
<<
LM
, 
Q15ONE
, 
¨ch
);

360 } ++
c
<
C
);

362 
	}
}

371 
	$compuã_ch™√l_weights
(
˚…_íî
 
Ex
, cñt_íî 
Ey
, 
›us_vÆ16
 
w
[2])

373 
˚…_íî
 
möE
;

374 #ifde‡
FIXED_POINT


375 
shi·
;

377 
möE
 = 
	`MIN32
(
Ex
, 
Ey
);

379 
Ex
 = 
	`ADD32
(Ex, 
möE
/3);

380 
Ey
 = 
	`ADD32
(Ey, 
möE
/3);

381 #ifde‡
FIXED_POINT


382 
shi·
 = 
	`˚…_ûog2
(
EPSILON
+
	`MAX32
(
Ex
, 
Ey
))-14;

384 
w
[0] = 
	`VSHR32
(
Ex
, 
shi·
);

385 
w
[1] = 
	`VSHR32
(
Ey
, 
shi·
);

386 
	}
}

388 
	$öãnsôy_°îeo
(c⁄° 
CELTMode
 *
m
, 
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
, c⁄° cñt_n‹m * OPUS_RESTRICT 
Y
, c⁄° 
˚…_íî
 *
b™dE
, 
b™dID
, 
N
)

390 
i
 = 
b™dID
;

391 
j
;

392 
›us_vÆ16
 
a1
, 
a2
;

393 
›us_vÆ16
 
À·
, 
right
;

394 
›us_vÆ16
 
n‹m
;

395 #ifde‡
FIXED_POINT


396 
shi·
 = 
	`˚…_zlog2
(
	`MAX32
(
b™dE
[
i
], b™dE[i+
m
->
nbEB™ds
]))-13;

398 
À·
 = 
	`VSHR32
(
b™dE
[
i
],
shi·
);

399 
right
 = 
	`VSHR32
(
b™dE
[
i
+
m
->
nbEB™ds
],
shi·
);

400 
n‹m
 = 
EPSILON
 + 
	`˚…_sqπ
(EPSILON+
	`MULT16_16
(
À·
,À·)+MULT16_16(
right
,right));

401 
a1
 = 
	`DIV32_16
(
	`SHL32
(
	`EXTEND32
(
À·
),14),
n‹m
);

402 
a2
 = 
	`DIV32_16
(
	`SHL32
(
	`EXTEND32
(
right
),14),
n‹m
);

403 
j
=0;j<
N
;j++)

405 
˚…_n‹m
 
r
, 
l
;

406 
l
 = 
X
[
j
];

407 
r
 = 
Y
[
j
];

408 
X
[
j
] = 
	`EXTRACT16
(
	`SHR32
(
	`MAC16_16
(
	`MULT16_16
(
a1
, 
l
), 
a2
, 
r
), 14));

411 
	}
}

413 
	$°îeo_•lô
(
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
, cñt_n‹m * OPUS_RESTRICT 
Y
, 
N
)

415 
j
;

416 
j
=0;j<
N
;j++)

418 
›us_vÆ32
 
r
, 
l
;

419 
l
 = 
	`MULT16_16
(
	`QCONST16
(.70710678f, 15), 
X
[
j
]);

420 
r
 = 
	`MULT16_16
(
	`QCONST16
(.70710678f, 15), 
Y
[
j
]);

421 
X
[
j
] = 
	`EXTRACT16
(
	`SHR32
(
	`ADD32
(
l
, 
r
), 15));

422 
Y
[
j
] = 
	`EXTRACT16
(
	`SHR32
(
	`SUB32
(
r
, 
l
), 15));

424 
	}
}

426 
	$°îeo_mîge
(
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
, cñt_n‹m * OPUS_RESTRICT 
Y
, 
›us_vÆ16
 
mid
, 
N
, 
¨ch
)

428 
j
;

429 
›us_vÆ32
 
xp
=0, 
side
=0;

430 
›us_vÆ32
 
El
, 
Er
;

431 
›us_vÆ16
 
mid2
;

432 #ifde‡
FIXED_POINT


433 
kl
, 
kr
;

435 
›us_vÆ32
 
t
, 
lgaö
, 
rgaö
;

438 
	`duÆ_ö√r_¥od
(
Y
, 
X
, Y, 
N
, &
xp
, &
side
, 
¨ch
);

440 
xp
 = 
	`MULT16_32_Q15
(
mid
, xp);

442 
mid2
 = 
	`SHR16
(
mid
, 1);

443 
El
 = 
	`MULT16_16
(
mid2
, mid2Ë+ 
side
 - 2*
xp
;

444 
Er
 = 
	`MULT16_16
(
mid2
, mid2Ë+ 
side
 + 2*
xp
;

445 i‡(
Er
 < 
	`QCONST32
(6e-4f, 28Ë|| 
El
 < QCONST32(6e-4f, 28))

447 
	`OPUS_COPY
(
Y
, 
X
, 
N
);

451 #ifde‡
FIXED_POINT


452 
kl
 = 
	`˚…_ûog2
(
El
)>>1;

453 
kr
 = 
	`˚…_ûog2
(
Er
)>>1;

455 
t
 = 
	`VSHR32
(
El
, (
kl
-7)<<1);

456 
lgaö
 = 
	`˚…_rsqπ_n‹m
(
t
);

457 
t
 = 
	`VSHR32
(
Er
, (
kr
-7)<<1);

458 
rgaö
 = 
	`˚…_rsqπ_n‹m
(
t
);

460 #ifde‡
FIXED_POINT


461 i‡(
kl
 < 7)

462 
kl
 = 7;

463 i‡(
kr
 < 7)

464 
kr
 = 7;

467 
j
=0;j<
N
;j++)

469 
˚…_n‹m
 
r
, 
l
;

471 
l
 = 
	`MULT16_16_P15
(
mid
, 
X
[
j
]);

472 
r
 = 
Y
[
j
];

473 
X
[
j
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MULT16_16
(
lgaö
, 
	`SUB16
(
l
,
r
)), 
kl
+1));

474 
Y
[
j
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MULT16_16
(
rgaö
, 
	`ADD16
(
l
,
r
)), 
kr
+1));

476 
	}
}

479 
	$•ªadög_decisi⁄
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 *
X
, *
avîage
,

480 
œ°_decisi⁄
, *
hf_avîage
, *
èp£t_decisi⁄
, 
upd©e_hf
,

481 
íd
, 
C
, 
M
, c⁄° *
•ªad_weight
)

483 
i
, 
c
, 
N0
;

484 
sum
 = 0, 
nbB™ds
=0;

485 c⁄° 
›us_öt16
 * 
OPUS_RESTRICT
 
eB™ds
 = 
m
->eBands;

486 
decisi⁄
;

487 
hf_sum
=0;

489 
	`˚…_as£π
(
íd
>0);

491 
N0
 = 
M
*
m
->
sh‹tMd˘Size
;

493 i‡(
M
*(
eB™ds
[
íd
]-eBands[end-1]) <= 8)

494  
SPREAD_NONE
;

495 
c
=0; do {

496 
i
=0;i<
íd
;i++)

498 
j
, 
N
, 
tmp
=0;

499 
tcou¡
[3] = {0,0,0};

500 c⁄° 
˚…_n‹m
 * 
OPUS_RESTRICT
 
x
 = 
X
+
M
*
eB™ds
[
i
]+
c
*
N0
;

501 
N
 = 
M
*(
eB™ds
[
i
+1]-eBands[i]);

502 i‡(
N
<=8)

505 
j
=0;j<
N
;j++)

507 
›us_vÆ32
 
x2N
;

509 
x2N
 = 
	`MULT16_16
(
	`MULT16_16_Q15
(
x
[
j
], x[j]), 
N
);

510 i‡(
x2N
 < 
	`QCONST16
(0.25f,13))

511 
tcou¡
[0]++;

512 i‡(
x2N
 < 
	`QCONST16
(0.0625f,13))

513 
tcou¡
[1]++;

514 i‡(
x2N
 < 
	`QCONST16
(0.015625f,13))

515 
tcou¡
[2]++;

519 i‡(
i
>
m
->
nbEB™ds
-4)

520 
hf_sum
 +
	`˚…_udiv
(32*(
tcou¡
[1]+tcou¡[0]), 
N
);

521 
tmp
 = (2*
tcou¡
[2] >
N
) + (2*tcount[1] >= N) + (2*tcount[0] >= N);

522 
sum
 +
tmp
*
•ªad_weight
[
i
];

523 
nbB™ds
+=
•ªad_weight
[
i
];

525 } ++
c
<
C
);

527 i‡(
upd©e_hf
)

529 i‡(
hf_sum
)

530 
hf_sum
 = 
	`˚…_udiv
(hf_sum, 
C
*(4-
m
->
nbEB™ds
+
íd
));

531 *
hf_avîage
 = (*hf_avîage+
hf_sum
)>>1;

532 
hf_sum
 = *
hf_avîage
;

533 i‡(*
èp£t_decisi⁄
==2)

534 
hf_sum
 += 4;

535 i‡(*
èp£t_decisi⁄
==0)

536 
hf_sum
 -= 4;

537 i‡(
hf_sum
 > 22)

538 *
èp£t_decisi⁄
=2;

539 i‡(
hf_sum
 > 18)

540 *
èp£t_decisi⁄
=1;

542 *
èp£t_decisi⁄
=0;

545 
	`˚…_as£π
(
nbB™ds
>0);

546 
	`˚…_as£π
(
sum
>=0);

547 
sum
 = 
	`˚…_udiv
((
›us_öt32
)sum<<8, 
nbB™ds
);

549 
sum
 = (sum+*
avîage
)>>1;

550 *
avîage
 = 
sum
;

552 
sum
 = (3*sum + (((3-
œ°_decisi⁄
)<<7) + 64) + 2)>>2;

553 i‡(
sum
 < 80)

555 
decisi⁄
 = 
SPREAD_AGGRESSIVE
;

556 } i‡(
sum
 < 256)

558 
decisi⁄
 = 
SPREAD_NORMAL
;

559 } i‡(
sum
 < 384)

561 
decisi⁄
 = 
SPREAD_LIGHT
;

563 
decisi⁄
 = 
SPREAD_NONE
;

565 #ifde‡
FUZZING


566 
decisi⁄
 = 
	`ønd
()&0x3;

567 *
èp£t_decisi⁄
=
	`ønd
()%3;

569  
decisi⁄
;

570 
	}
}

576 c⁄° 
	g‹dîy_èbÀ
[] = {

583 
	$deöãæóve_hadam¨d
(
˚…_n‹m
 *
X
, 
N0
, 
°ride
, 
hadam¨d
)

585 
i
,
j
;

586 
	`VARDECL
(
˚…_n‹m
, 
tmp
);

587 
N
;

588 
SAVE_STACK
;

589 
N
 = 
N0
*
°ride
;

590 
	`ALLOC
(
tmp
, 
N
, 
˚…_n‹m
);

591 
	`˚…_as£π
(
°ride
>0);

592 i‡(
hadam¨d
)

594 c⁄° *
‹dîy
 = 
‹dîy_èbÀ
+
°ride
-2;

595 
i
=0;i<
°ride
;i++)

597 
j
=0;j<
N0
;j++)

598 
tmp
[
‹dîy
[
i
]*
N0
+
j
] = 
X
[j*
°ride
+i];

601 
i
=0;i<
°ride
;i++)

602 
j
=0;j<
N0
;j++)

603 
tmp
[
i
*
N0
+
j
] = 
X
[j*
°ride
+i];

605 
	`OPUS_COPY
(
X
, 
tmp
, 
N
);

606 
RESTORE_STACK
;

607 
	}
}

609 
	$öãæóve_hadam¨d
(
˚…_n‹m
 *
X
, 
N0
, 
°ride
, 
hadam¨d
)

611 
i
,
j
;

612 
	`VARDECL
(
˚…_n‹m
, 
tmp
);

613 
N
;

614 
SAVE_STACK
;

615 
N
 = 
N0
*
°ride
;

616 
	`ALLOC
(
tmp
, 
N
, 
˚…_n‹m
);

617 i‡(
hadam¨d
)

619 c⁄° *
‹dîy
 = 
‹dîy_èbÀ
+
°ride
-2;

620 
i
=0;i<
°ride
;i++)

621 
j
=0;j<
N0
;j++)

622 
tmp
[
j
*
°ride
+
i
] = 
X
[
‹dîy
[i]*
N0
+j];

624 
i
=0;i<
°ride
;i++)

625 
j
=0;j<
N0
;j++)

626 
tmp
[
j
*
°ride
+
i
] = 
X
[i*
N0
+j];

628 
	`OPUS_COPY
(
X
, 
tmp
, 
N
);

629 
RESTORE_STACK
;

630 
	}
}

632 
	$hØr1
(
˚…_n‹m
 *
X
, 
N0
, 
°ride
)

634 
i
, 
j
;

635 
N0
 >>= 1;

636 
i
=0;i<
°ride
;i++)

637 
j
=0;j<
N0
;j++)

639 
›us_vÆ32
 
tmp1
, 
tmp2
;

640 
tmp1
 = 
	`MULT16_16
(
	`QCONST16
(.70710678f,15), 
X
[
°ride
*2*
j
+
i
]);

641 
tmp2
 = 
	`MULT16_16
(
	`QCONST16
(.70710678f,15), 
X
[
°ride
*(2*
j
+1)+
i
]);

642 
X
[
°ride
*2*
j
+
i
] = 
	`EXTRACT16
(
	`PSHR32
(
	`ADD32
(
tmp1
, 
tmp2
), 15));

643 
X
[
°ride
*(2*
j
+1)+
i
] = 
	`EXTRACT16
(
	`PSHR32
(
	`SUB32
(
tmp1
, 
tmp2
), 15));

645 
	}
}

647 
	$compuã_qn
(
N
, 
b
, 
off£t
, 
pul£_ˇp
, 
°îeo
)

649 c⁄° 
›us_öt16
 
exp2_èbÀ8
[8] =

651 
qn
, 
qb
;

652 
N2
 = 2*
N
-1;

653 i‡(
°îeo
 && 
N
==2)

654 
N2
--;

658 
qb
 = 
	`˚…_sudiv
(
b
+
N2
*
off£t
, N2);

659 
qb
 = 
	`IMIN
(
b
-
pul£_ˇp
-(4<<
BITRES
), qb);

661 
qb
 = 
	`IMIN
(8<<
BITRES
, qb);

663 i‡(
qb
<(1<<
BITRES
>>1)) {

664 
qn
 = 1;

666 
qn
 = 
exp2_èbÀ8
[
qb
&0x7]>>(14-(qb>>
BITRES
));

667 
qn
 = (qn+1)>>1<<1;

669 
	`˚…_as£π
(
qn
 <= 256);

670  
qn
;

671 
	}
}

673 
	sb™d_˘x
 {

674 
	mícode
;

675 
	mªsy¡h
;

676 c⁄° 
CELTMode
 *
	mm
;

677 
	mi
;

678 
	möãnsôy
;

679 
	m•ªad
;

680 
	mtf_ch™ge
;

681 
ec_˘x
 *
	mec
;

682 
›us_öt32
 
	mªmaöög_bôs
;

683 c⁄° 
˚…_íî
 *
	mb™dE
;

684 
›us_uöt32
 
	m£ed
;

685 
	m¨ch
;

686 
	mthëa_round
;

687 
	mdißbÀ_öv
;

688 
	mavoid_•lô_noi£
;

691 
	s•lô_˘x
 {

692 
	möv
;

693 
	mimid
;

694 
	miside
;

695 
	mdñè
;

696 
	môhëa
;

697 
	mqÆloc
;

700 
	$compuã_thëa
(
b™d_˘x
 *
˘x
, 
•lô_˘x
 *
s˘x
,

701 
˚…_n‹m
 *
X
, cñt_n‹m *
Y
, 
N
, *
b
, 
B
, 
B0
,

702 
LM
,

703 
°îeo
, *
fûl
)

705 
qn
;

706 
ôhëa
=0;

707 
dñè
;

708 
imid
, 
iside
;

709 
qÆloc
;

710 
pul£_ˇp
;

711 
off£t
;

712 
›us_öt32
 
ãŒ
;

713 
öv
=0;

714 
ícode
;

715 c⁄° 
CELTMode
 *
m
;

716 
i
;

717 
öãnsôy
;

718 
ec_˘x
 *
ec
;

719 c⁄° 
˚…_íî
 *
b™dE
;

721 
ícode
 = 
˘x
->encode;

722 
m
 = 
˘x
->m;

723 
i
 = 
˘x
->i;

724 
öãnsôy
 = 
˘x
->intensity;

725 
ec
 = 
˘x
->ec;

726 
b™dE
 = 
˘x
->bandE;

729 
pul£_ˇp
 = 
m
->
logN
[
i
]+
LM
*(1<<
BITRES
);

730 
off£t
 = (
pul£_ˇp
>>1Ë- (
°îeo
&&
N
==2 ? 
QTHETA_OFFSET_TWOPHASE
 : 
QTHETA_OFFSET
);

731 
qn
 = 
	`compuã_qn
(
N
, *
b
, 
off£t
, 
pul£_ˇp
, 
°îeo
);

732 i‡(
°îeo
 && 
i
>=
öãnsôy
)

733 
qn
 = 1;

734 i‡(
ícode
)

740 
ôhëa
 = 
	`°îeo_ôhëa
(
X
, 
Y
, 
°îeo
, 
N
, 
˘x
->
¨ch
);

742 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
ec
);

743 i‡(
qn
!=1)

745 i‡(
ícode
)

747 i‡(!
°îeo
 || 
˘x
->
thëa_round
 == 0)

749 
ôhëa
 = (ôhëa*(
›us_öt32
)
qn
+8192)>>14;

750 i‡(!
°îeo
 && 
˘x
->
avoid_•lô_noi£
 && 
ôhëa
 > 0 && ithë®< 
qn
)

755 
unqu™tized
 = 
	`˚…_udiv
((
›us_öt32
)
ôhëa
*16384, 
qn
);

756 
imid
 = 
	`bôexa˘_cos
((
›us_öt16
)
unqu™tized
);

757 
iside
 = 
	`bôexa˘_cos
((
›us_öt16
)(16384-
unqu™tized
));

758 
dñè
 = 
	`FRAC_MUL16
((
N
-1)<<7,
	`bôexa˘_log2èn
(
iside
,
imid
));

759 i‡(
dñè
 > *
b
)

760 
ôhëa
 = 
qn
;

761 i‡(
dñè
 < -*
b
)

762 
ôhëa
 = 0;

765 
down
;

767 
büs
 = 
ôhëa
 > 8192 ? 32767/
qn
 : -32767/qn;

768 
down
 = 
	`IMIN
(
qn
-1, 
	`IMAX
(0, (
ôhëa
*(
›us_öt32
)q¿+ 
büs
)>>14));

769 i‡(
˘x
->
thëa_round
 < 0)

770 
ôhëa
 = 
down
;

772 
ôhëa
 = 
down
+1;

777 i‡(
°îeo
 && 
N
>2)

779 
p0
 = 3;

780 
x
 = 
ôhëa
;

781 
x0
 = 
qn
/2;

782 
·
 = 
p0
*(
x0
+1) + x0;

784 i‡(
ícode
)

786 
	`ec_ícode
(
ec
,
x
<=
x0
?
p0
*x:(x-1-x0)+(x0+1)*p0,x<=x0?p0*(x+1):(x-x0)+(x0+1)*p0,
·
);

788 
fs
;

789 
fs
=
	`ec_decode
(
ec
,
·
);

790 i‡(
fs
<(
x0
+1)*
p0
)

791 
x
=
fs
/
p0
;

793 
x
=
x0
+1+(
fs
-(x0+1)*
p0
);

794 
	`ec_dec_upd©e
(
ec
,
x
<=
x0
?
p0
*x:(x-1-x0)+(x0+1)*p0,x<=x0?p0*(x+1):(x-x0)+(x0+1)*p0,
·
);

795 
ôhëa
 = 
x
;

797 } i‡(
B0
>1 || 
°îeo
) {

799 i‡(
ícode
)

800 
	`ec_íc_uöt
(
ec
, 
ôhëa
, 
qn
+1);

802 
ôhëa
 = 
	`ec_dec_uöt
(
ec
, 
qn
+1);

804 
fs
=1, 
·
;

805 
·
 = ((
qn
>>1)+1)*((qn>>1)+1);

806 i‡(
ícode
)

808 
Ê
;

810 
fs
 = 
ôhëa
 <(
qn
>>1) ? itheta + 1 : qn + 1 - itheta;

811 
Ê
 = 
ôhëa
 <(
qn
>>1) ? itheta*(itheta + 1)>>1 :

812 
·
 - ((
qn
 + 1 - 
ôhëa
)*(qn + 2 - itheta)>>1);

814 
	`ec_ícode
(
ec
, 
Ê
, fl+
fs
, 
·
);

817 
Ê
=0;

818 
fm
;

819 
fm
 = 
	`ec_decode
(
ec
, 
·
);

821 i‡(
fm
 < ((
qn
>>1)*((qn>>1) + 1)>>1))

823 
ôhëa
 = (
	`isqπ32
(8*(
›us_uöt32
)
fm
 + 1) - 1)>>1;

824 
fs
 = 
ôhëa
 + 1;

825 
Ê
 = 
ôhëa
*(itheta + 1)>>1;

829 
ôhëa
 = (2*(
qn
 + 1)

830 - 
	`isqπ32
(8*(
›us_uöt32
)(
·
 - 
fm
 - 1) + 1))>>1;

831 
fs
 = 
qn
 + 1 - 
ôhëa
;

832 
Ê
 = 
·
 - ((
qn
 + 1 - 
ôhëa
)*(qn + 2 - itheta)>>1);

835 
	`ec_dec_upd©e
(
ec
, 
Ê
, fl+
fs
, 
·
);

838 
	`˚…_as£π
(
ôhëa
>=0);

839 
ôhëa
 = 
	`˚…_udiv
((
›us_öt32
)ôhëa*16384, 
qn
);

840 i‡(
ícode
 && 
°îeo
)

842 i‡(
ôhëa
==0)

843 
	`öãnsôy_°îeo
(
m
, 
X
, 
Y
, 
b™dE
, 
i
, 
N
);

845 
	`°îeo_•lô
(
X
, 
Y
, 
N
);

849 } i‡(
°îeo
) {

850 i‡(
ícode
)

852 
öv
 = 
ôhëa
 > 8192 && !
˘x
->
dißbÀ_öv
;

853 i‡(
öv
)

855 
j
;

856 
j
=0;j<
N
;j++)

857 
Y
[
j
] = -Y[j];

859 
	`öãnsôy_°îeo
(
m
, 
X
, 
Y
, 
b™dE
, 
i
, 
N
);

861 i‡(*
b
>2<<
BITRES
 && 
˘x
->
ªmaöög_bôs
 > 2<<BITRES)

863 i‡(
ícode
)

864 
	`ec_íc_bô_logp
(
ec
, 
öv
, 2);

866 
öv
 = 
	`ec_dec_bô_logp
(
ec
, 2);

868 
öv
 = 0;

870 i‡(
˘x
->
dißbÀ_öv
)

871 
öv
 = 0;

872 
ôhëa
 = 0;

874 
qÆloc
 = 
	`ec_ãŒ_‰ac
(
ec
Ë- 
ãŒ
;

875 *
b
 -
qÆloc
;

877 i‡(
ôhëa
 == 0)

879 
imid
 = 32767;

880 
iside
 = 0;

881 *
fûl
 &(1<<
B
)-1;

882 
dñè
 = -16384;

883 } i‡(
ôhëa
 == 16384)

885 
imid
 = 0;

886 
iside
 = 32767;

887 *
fûl
 &((1<<
B
)-1)<<B;

888 
dñè
 = 16384;

890 
imid
 = 
	`bôexa˘_cos
((
›us_öt16
)
ôhëa
);

891 
iside
 = 
	`bôexa˘_cos
((
›us_öt16
)(16384-
ôhëa
));

894 
dñè
 = 
	`FRAC_MUL16
((
N
-1)<<7,
	`bôexa˘_log2èn
(
iside
,
imid
));

897 
s˘x
->
öv
 = inv;

898 
s˘x
->
imid
 = imid;

899 
s˘x
->
iside
 = iside;

900 
s˘x
->
dñè
 = delta;

901 
s˘x
->
ôhëa
 = itheta;

902 
s˘x
->
qÆloc
 = qalloc;

903 
	}
}

904 
	$qu™t_b™d_n1
(
b™d_˘x
 *
˘x
, 
˚…_n‹m
 *
X
, cñt_n‹m *
Y
, 
b
,

905 
˚…_n‹m
 *
lowb™d_out
)

907 
c
;

908 
°îeo
;

909 
˚…_n‹m
 *
x
 = 
X
;

910 
ícode
;

911 
ec_˘x
 *
ec
;

913 
ícode
 = 
˘x
->encode;

914 
ec
 = 
˘x
->ec;

916 
°îeo
 = 
Y
 !
NULL
;

917 
c
=0; do {

918 
sign
=0;

919 i‡(
˘x
->
ªmaöög_bôs
>=1<<
BITRES
)

921 i‡(
ícode
)

923 
sign
 = 
x
[0]<0;

924 
	`ec_íc_bôs
(
ec
, 
sign
, 1);

926 
sign
 = 
	`ec_dec_bôs
(
ec
, 1);

928 
˘x
->
ªmaöög_bôs
 -1<<
BITRES
;

929 
b
-=1<<
BITRES
;

931 i‡(
˘x
->
ªsy¡h
)

932 
x
[0] = 
sign
 ? -
NORM_SCALING
 : NORM_SCALING;

933 
x
 = 
Y
;

934 } ++
c
<1+
°îeo
);

935 i‡(
lowb™d_out
)

936 
lowb™d_out
[0] = 
	`SHR16
(
X
[0],4);

938 
	}
}

944 
	$qu™t_∑πôi⁄
(
b™d_˘x
 *
˘x
, 
˚…_n‹m
 *
X
,

945 
N
, 
b
, 
B
, 
˚…_n‹m
 *
lowb™d
,

946 
LM
,

947 
›us_vÆ16
 
gaö
, 
fûl
)

949 c⁄° *
ˇche
;

950 
q
;

951 
cuº_bôs
;

952 
imid
=0, 
iside
=0;

953 
B0
=
B
;

954 
›us_vÆ16
 
mid
=0, 
side
=0;

955 
cm
=0;

956 
˚…_n‹m
 *
Y
=
NULL
;

957 
ícode
;

958 c⁄° 
CELTMode
 *
m
;

959 
i
;

960 
•ªad
;

961 
ec_˘x
 *
ec
;

963 
ícode
 = 
˘x
->encode;

964 
m
 = 
˘x
->m;

965 
i
 = 
˘x
->i;

966 
•ªad
 = 
˘x
->spread;

967 
ec
 = 
˘x
->ec;

970 
ˇche
 = 
m
->ˇche.
bôs
 + m->ˇche.
ödex
[(
LM
+1)*m->
nbEB™ds
+
i
];

971 i‡(
LM
 !-1 && 
b
 > 
ˇche
[ˇche[0]]+12 && 
N
>2)

973 
mbôs
, 
sbôs
, 
dñè
;

974 
ôhëa
;

975 
qÆloc
;

976 
•lô_˘x
 
s˘x
;

977 
˚…_n‹m
 *
√xt_lowb™d2
=
NULL
;

978 
›us_öt32
 
ªbÆ™˚
;

980 
N
 >>= 1;

981 
Y
 = 
X
+
N
;

982 
LM
 -= 1;

983 i‡(
B
==1)

984 
fûl
 = (fill&1)|(fill<<1);

985 
B
 = (B+1)>>1;

987 
	`compuã_thëa
(
˘x
, &
s˘x
, 
X
, 
Y
, 
N
, &
b
, 
B
, 
B0
, 
LM
, 0, &
fûl
);

988 
imid
 = 
s˘x
.imid;

989 
iside
 = 
s˘x
.iside;

990 
dñè
 = 
s˘x
.delta;

991 
ôhëa
 = 
s˘x
.itheta;

992 
qÆloc
 = 
s˘x
.qalloc;

993 #ifde‡
FIXED_POINT


994 
mid
 = 
imid
;

995 
side
 = 
iside
;

997 
mid
 = (1.f/32768)*
imid
;

998 
side
 = (1.f/32768)*
iside
;

1002 i‡(
B0
>1 && (
ôhëa
&0x3fff))

1004 i‡(
ôhëa
 > 8192)

1006 
dñè
 -dñè>>(4-
LM
);

1009 
dñè
 = 
	`IMIN
(0, dñè + (
N
<<
BITRES
>>(5-
LM
)));

1011 
mbôs
 = 
	`IMAX
(0, 
	`IMIN
(
b
, (b-
dñè
)/2));

1012 
sbôs
 = 
b
-
mbôs
;

1013 
˘x
->
ªmaöög_bôs
 -
qÆloc
;

1015 i‡(
lowb™d
)

1016 
√xt_lowb™d2
 = 
lowb™d
+
N
;

1018 
ªbÆ™˚
 = 
˘x
->
ªmaöög_bôs
;

1019 i‡(
mbôs
 >
sbôs
)

1021 
cm
 = 
	`qu™t_∑πôi⁄
(
˘x
, 
X
, 
N
, 
mbôs
, 
B
, 
lowb™d
, 
LM
,

1022 
	`MULT16_16_P15
(
gaö
,
mid
), 
fûl
);

1023 
ªbÆ™˚
 = 
mbôs
 - (ªbÆ™˚-
˘x
->
ªmaöög_bôs
);

1024 i‡(
ªbÆ™˚
 > 3<<
BITRES
 && 
ôhëa
!=0)

1025 
sbôs
 +
ªbÆ™˚
 - (3<<
BITRES
);

1026 
cm
 |
	`qu™t_∑πôi⁄
(
˘x
, 
Y
, 
N
, 
sbôs
, 
B
, 
√xt_lowb™d2
, 
LM
,

1027 
	`MULT16_16_P15
(
gaö
,
side
), 
fûl
>>
B
)<<(
B0
>>1);

1029 
cm
 = 
	`qu™t_∑πôi⁄
(
˘x
, 
Y
, 
N
, 
sbôs
, 
B
, 
√xt_lowb™d2
, 
LM
,

1030 
	`MULT16_16_P15
(
gaö
,
side
), 
fûl
>>
B
)<<(
B0
>>1);

1031 
ªbÆ™˚
 = 
sbôs
 - (ªbÆ™˚-
˘x
->
ªmaöög_bôs
);

1032 i‡(
ªbÆ™˚
 > 3<<
BITRES
 && 
ôhëa
!=16384)

1033 
mbôs
 +
ªbÆ™˚
 - (3<<
BITRES
);

1034 
cm
 |
	`qu™t_∑πôi⁄
(
˘x
, 
X
, 
N
, 
mbôs
, 
B
, 
lowb™d
, 
LM
,

1035 
	`MULT16_16_P15
(
gaö
,
mid
), 
fûl
);

1039 
q
 = 
	`bôs2pul£s
(
m
, 
i
, 
LM
, 
b
);

1040 
cuº_bôs
 = 
	`pul£s2bôs
(
m
, 
i
, 
LM
, 
q
);

1041 
˘x
->
ªmaöög_bôs
 -
cuº_bôs
;

1044 
˘x
->
ªmaöög_bôs
 < 0 && 
q
 > 0)

1046 
˘x
->
ªmaöög_bôs
 +
cuº_bôs
;

1047 
q
--;

1048 
cuº_bôs
 = 
	`pul£s2bôs
(
m
, 
i
, 
LM
, 
q
);

1049 
˘x
->
ªmaöög_bôs
 -
cuº_bôs
;

1052 i‡(
q
!=0)

1054 
K
 = 
	`gë_pul£s
(
q
);

1057 i‡(
ícode
)

1059 
cm
 = 
	`Æg_qu™t
(
X
, 
N
, 
K
, 
•ªad
, 
B
, 
ec
, 
gaö
, 
˘x
->
ªsy¡h
, ctx->
¨ch
);

1061 
cm
 = 
	`Æg_unqu™t
(
X
, 
N
, 
K
, 
•ªad
, 
B
, 
ec
, 
gaö
);

1065 
j
;

1066 i‡(
˘x
->
ªsy¡h
)

1068 
cm_mask
;

1071 
cm_mask
 = ()(1UL<<
B
)-1;

1072 
fûl
 &
cm_mask
;

1073 i‡(!
fûl
)

1075 
	`OPUS_CLEAR
(
X
, 
N
);

1077 i‡(
lowb™d
 =
NULL
)

1080 
j
=0;j<
N
;j++)

1082 
˘x
->
£ed
 = 
	`˚…_lcg_ønd
(ctx->seed);

1083 
X
[
j
] = (
˚…_n‹m
)((
›us_öt32
)
˘x
->
£ed
>>20);

1085 
cm
 = 
cm_mask
;

1088 
j
=0;j<
N
;j++)

1090 
›us_vÆ16
 
tmp
;

1091 
˘x
->
£ed
 = 
	`˚…_lcg_ønd
(ctx->seed);

1093 
tmp
 = 
	`QCONST16
(1.0f/256, 10);

1094 
tmp
 = (
˘x
->
£ed
)&0x8000 ?Åmp : -tmp;

1095 
X
[
j
] = 
lowb™d
[j]+
tmp
;

1097 
cm
 = 
fûl
;

1099 
	`ªn‹mÆi£_ve˘‹
(
X
, 
N
, 
gaö
, 
˘x
->
¨ch
);

1105  
cm
;

1106 
	}
}

1110 
	$qu™t_b™d
(
b™d_˘x
 *
˘x
, 
˚…_n‹m
 *
X
,

1111 
N
, 
b
, 
B
, 
˚…_n‹m
 *
lowb™d
,

1112 
LM
, 
˚…_n‹m
 *
lowb™d_out
,

1113 
›us_vÆ16
 
gaö
, 
˚…_n‹m
 *
lowb™d_s¸©ch
, 
fûl
)

1115 
N0
=
N
;

1116 
N_B
=
N
;

1117 
N_B0
;

1118 
B0
=
B
;

1119 
time_divide
=0;

1120 
ªcomböe
=0;

1121 
l⁄gBlocks
;

1122 
cm
=0;

1123 
k
;

1124 
ícode
;

1125 
tf_ch™ge
;

1127 
ícode
 = 
˘x
->encode;

1128 
tf_ch™ge
 = 
˘x
->tf_change;

1130 
l⁄gBlocks
 = 
B0
==1;

1132 
N_B
 = 
	`˚…_udiv
(N_B, 
B
);

1135 i‡(
N
==1)

1137  
	`qu™t_b™d_n1
(
˘x
, 
X
, 
NULL
, 
b
, 
lowb™d_out
);

1140 i‡(
tf_ch™ge
>0)

1141 
ªcomböe
 = 
tf_ch™ge
;

1144 i‡(
lowb™d_s¸©ch
 && 
lowb™d
 && (
ªcomböe
 || ((
N_B
&1Ë=0 && 
tf_ch™ge
<0Ë|| 
B0
>1))

1146 
	`OPUS_COPY
(
lowb™d_s¸©ch
, 
lowb™d
, 
N
);

1147 
lowb™d
 = 
lowb™d_s¸©ch
;

1150 
k
=0;k<
ªcomböe
;k++)

1152 c⁄° 
bô_öãæóve_èbÀ
[16]={

1155 i‡(
ícode
)

1156 
	`hØr1
(
X
, 
N
>>
k
, 1<<k);

1157 i‡(
lowb™d
)

1158 
	`hØr1
(
lowb™d
, 
N
>>
k
, 1<<k);

1159 
fûl
 = 
bô_öãæóve_èbÀ
[fill&0xF]|bit_interleave_table[fill>>4]<<2;

1161 
B
>>=
ªcomböe
;

1162 
N_B
<<=
ªcomböe
;

1165 (
N_B
&1Ë=0 && 
tf_ch™ge
<0)

1167 i‡(
ícode
)

1168 
	`hØr1
(
X
, 
N_B
, 
B
);

1169 i‡(
lowb™d
)

1170 
	`hØr1
(
lowb™d
, 
N_B
, 
B
);

1171 
fûl
 |fûl<<
B
;

1172 
B
 <<= 1;

1173 
N_B
 >>= 1;

1174 
time_divide
++;

1175 
tf_ch™ge
++;

1177 
B0
=
B
;

1178 
N_B0
 = 
N_B
;

1181 i‡(
B0
>1)

1183 i‡(
ícode
)

1184 
	`deöãæóve_hadam¨d
(
X
, 
N_B
>>
ªcomböe
, 
B0
<<ªcomböe, 
l⁄gBlocks
);

1185 i‡(
lowb™d
)

1186 
	`deöãæóve_hadam¨d
(
lowb™d
, 
N_B
>>
ªcomböe
, 
B0
<<ªcomböe, 
l⁄gBlocks
);

1189 
cm
 = 
	`qu™t_∑πôi⁄
(
˘x
, 
X
, 
N
, 
b
, 
B
, 
lowb™d
, 
LM
, 
gaö
, 
fûl
);

1192 i‡(
˘x
->
ªsy¡h
)

1195 i‡(
B0
>1)

1196 
	`öãæóve_hadam¨d
(
X
, 
N_B
>>
ªcomböe
, 
B0
<<ªcomböe, 
l⁄gBlocks
);

1199 
N_B
 = 
N_B0
;

1200 
B
 = 
B0
;

1201 
k
=0;k<
time_divide
;k++)

1203 
B
 >>= 1;

1204 
N_B
 <<= 1;

1205 
cm
 |cm>>
B
;

1206 
	`hØr1
(
X
, 
N_B
, 
B
);

1209 
k
=0;k<
ªcomböe
;k++)

1211 c⁄° 
bô_deöãæóve_èbÀ
[16]={

1215 
cm
 = 
bô_deöãæóve_èbÀ
[cm];

1216 
	`hØr1
(
X
, 
N0
>>
k
, 1<<k);

1218 
B
<<=
ªcomböe
;

1221 i‡(
lowb™d_out
)

1223 
j
;

1224 
›us_vÆ16
 
n
;

1225 
n
 = 
	`˚…_sqπ
(
	`SHL32
(
	`EXTEND32
(
N0
),22));

1226 
j
=0;j<
N0
;j++)

1227 
lowb™d_out
[
j
] = 
	`MULT16_16_Q15
(
n
,
X
[j]);

1229 
cm
 &(1<<
B
)-1;

1231  
cm
;

1232 
	}
}

1236 
	$qu™t_b™d_°îeo
(
b™d_˘x
 *
˘x
, 
˚…_n‹m
 *
X
, cñt_n‹m *
Y
,

1237 
N
, 
b
, 
B
, 
˚…_n‹m
 *
lowb™d
,

1238 
LM
, 
˚…_n‹m
 *
lowb™d_out
,

1239 
˚…_n‹m
 *
lowb™d_s¸©ch
, 
fûl
)

1241 
imid
=0, 
iside
=0;

1242 
öv
 = 0;

1243 
›us_vÆ16
 
mid
=0, 
side
=0;

1244 
cm
=0;

1245 
mbôs
, 
sbôs
, 
dñè
;

1246 
ôhëa
;

1247 
qÆloc
;

1248 
•lô_˘x
 
s˘x
;

1249 
‹ig_fûl
;

1250 
ícode
;

1251 
ec_˘x
 *
ec
;

1253 
ícode
 = 
˘x
->encode;

1254 
ec
 = 
˘x
->ec;

1257 i‡(
N
==1)

1259  
	`qu™t_b™d_n1
(
˘x
, 
X
, 
Y
, 
b
, 
lowb™d_out
);

1262 
‹ig_fûl
 = 
fûl
;

1264 
	`compuã_thëa
(
˘x
, &
s˘x
, 
X
, 
Y
, 
N
, &
b
, 
B
, B, 
LM
, 1, &
fûl
);

1265 
öv
 = 
s˘x
.inv;

1266 
imid
 = 
s˘x
.imid;

1267 
iside
 = 
s˘x
.iside;

1268 
dñè
 = 
s˘x
.delta;

1269 
ôhëa
 = 
s˘x
.itheta;

1270 
qÆloc
 = 
s˘x
.qalloc;

1271 #ifde‡
FIXED_POINT


1272 
mid
 = 
imid
;

1273 
side
 = 
iside
;

1275 
mid
 = (1.f/32768)*
imid
;

1276 
side
 = (1.f/32768)*
iside
;

1282 i‡(
N
==2)

1284 
c
;

1285 
sign
=0;

1286 
˚…_n‹m
 *
x2
, *
y2
;

1287 
mbôs
 = 
b
;

1288 
sbôs
 = 0;

1290 i‡(
ôhëa
 != 0 && itheta != 16384)

1291 
sbôs
 = 1<<
BITRES
;

1292 
mbôs
 -
sbôs
;

1293 
c
 = 
ôhëa
 > 8192;

1294 
˘x
->
ªmaöög_bôs
 -
qÆloc
+
sbôs
;

1296 
x2
 = 
c
 ? 
Y
 : 
X
;

1297 
y2
 = 
c
 ? 
X
 : 
Y
;

1298 i‡(
sbôs
)

1300 i‡(
ícode
)

1303 
sign
 = 
x2
[0]*
y2
[1] - x2[1]*y2[0] < 0;

1304 
	`ec_íc_bôs
(
ec
, 
sign
, 1);

1306 
sign
 = 
	`ec_dec_bôs
(
ec
, 1);

1309 
sign
 = 1-2*sign;

1312 
cm
 = 
	`qu™t_b™d
(
˘x
, 
x2
, 
N
, 
mbôs
, 
B
, 
lowb™d
, 
LM
, 
lowb™d_out
, 
Q15ONE
,

1313 
lowb™d_s¸©ch
, 
‹ig_fûl
);

1316 
y2
[0] = -
sign
*
x2
[1];

1317 
y2
[1] = 
sign
*
x2
[0];

1318 i‡(
˘x
->
ªsy¡h
)

1320 
˚…_n‹m
 
tmp
;

1321 
X
[0] = 
	`MULT16_16_Q15
(
mid
, X[0]);

1322 
X
[1] = 
	`MULT16_16_Q15
(
mid
, X[1]);

1323 
Y
[0] = 
	`MULT16_16_Q15
(
side
, Y[0]);

1324 
Y
[1] = 
	`MULT16_16_Q15
(
side
, Y[1]);

1325 
tmp
 = 
X
[0];

1326 
X
[0] = 
	`SUB16
(
tmp
,
Y
[0]);

1327 
Y
[0] = 
	`ADD16
(
tmp
,Y[0]);

1328 
tmp
 = 
X
[1];

1329 
X
[1] = 
	`SUB16
(
tmp
,
Y
[1]);

1330 
Y
[1] = 
	`ADD16
(
tmp
,Y[1]);

1334 
›us_öt32
 
ªbÆ™˚
;

1336 
mbôs
 = 
	`IMAX
(0, 
	`IMIN
(
b
, (b-
dñè
)/2));

1337 
sbôs
 = 
b
-
mbôs
;

1338 
˘x
->
ªmaöög_bôs
 -
qÆloc
;

1340 
ªbÆ™˚
 = 
˘x
->
ªmaöög_bôs
;

1341 i‡(
mbôs
 >
sbôs
)

1345 
cm
 = 
	`qu™t_b™d
(
˘x
, 
X
, 
N
, 
mbôs
, 
B
, 
lowb™d
, 
LM
, 
lowb™d_out
, 
Q15ONE
,

1346 
lowb™d_s¸©ch
, 
fûl
);

1347 
ªbÆ™˚
 = 
mbôs
 - (ªbÆ™˚-
˘x
->
ªmaöög_bôs
);

1348 i‡(
ªbÆ™˚
 > 3<<
BITRES
 && 
ôhëa
!=0)

1349 
sbôs
 +
ªbÆ™˚
 - (3<<
BITRES
);

1353 
cm
 |
	`qu™t_b™d
(
˘x
, 
Y
, 
N
, 
sbôs
, 
B
, 
NULL
, 
LM
, NULL, 
side
, NULL, 
fûl
>>B);

1357 
cm
 = 
	`qu™t_b™d
(
˘x
, 
Y
, 
N
, 
sbôs
, 
B
, 
NULL
, 
LM
, NULL, 
side
, NULL, 
fûl
>>B);

1358 
ªbÆ™˚
 = 
sbôs
 - (ªbÆ™˚-
˘x
->
ªmaöög_bôs
);

1359 i‡(
ªbÆ™˚
 > 3<<
BITRES
 && 
ôhëa
!=16384)

1360 
mbôs
 +
ªbÆ™˚
 - (3<<
BITRES
);

1363 
cm
 |
	`qu™t_b™d
(
˘x
, 
X
, 
N
, 
mbôs
, 
B
, 
lowb™d
, 
LM
, 
lowb™d_out
, 
Q15ONE
,

1364 
lowb™d_s¸©ch
, 
fûl
);

1370 i‡(
˘x
->
ªsy¡h
)

1372 i‡(
N
!=2)

1373 
	`°îeo_mîge
(
X
, 
Y
, 
mid
, 
N
, 
˘x
->
¨ch
);

1374 i‡(
öv
)

1376 
j
;

1377 
j
=0;j<
N
;j++)

1378 
Y
[
j
] = -Y[j];

1381  
cm
;

1382 
	}
}

1384 
	$•ecül_hybrid_fﬁdög
(c⁄° 
CELTMode
 *
m
, 
˚…_n‹m
 *
n‹m
, cñt_n‹m *
n‹m2
, 
°¨t
, 
M
, 
duÆ_°îeo
)

1386 
n1
, 
n2
;

1387 c⁄° 
›us_öt16
 * 
OPUS_RESTRICT
 
eB™ds
 = 
m
->eBands;

1388 
n1
 = 
M
*(
eB™ds
[
°¨t
+1]-eBands[start]);

1389 
n2
 = 
M
*(
eB™ds
[
°¨t
+2]-eBands[start+1]);

1392 
	`OPUS_COPY
(&
n‹m
[
n1
], &n‹m[2*n1 - 
n2
],Ç2-n1);

1393 i‡(
duÆ_°îeo
)

1394 
	`OPUS_COPY
(&
n‹m2
[
n1
], &n‹m2[2*n1 - 
n2
],Ç2-n1);

1395 
	}
}

1397 
	$qu™t_Æl_b™ds
(
ícode
, c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
,

1398 
˚…_n‹m
 *
X_
, cñt_n‹m *
Y_
, *
cﬁœp£_masks
,

1399 c⁄° 
˚…_íî
 *
b™dE
, *
pul£s
, 
sh‹tBlocks
, 
•ªad
,

1400 
duÆ_°îeo
, 
öãnsôy
, *
tf_ªs
, 
›us_öt32
 
tŸÆ_bôs
,

1401 
›us_öt32
 
bÆ™˚
, 
ec_˘x
 *
ec
, 
LM
, 
codedB™ds
,

1402 
›us_uöt32
 *
£ed
, 
com∂exôy
, 
¨ch
, 
dißbÀ_öv
)

1404 
i
;

1405 
›us_öt32
 
ªmaöög_bôs
;

1406 c⁄° 
›us_öt16
 * 
OPUS_RESTRICT
 
eB™ds
 = 
m
->eBands;

1407 
˚…_n‹m
 * 
OPUS_RESTRICT
 
n‹m
, * OPUS_RESTRICT 
n‹m2
;

1408 
	`VARDECL
(
˚…_n‹m
, 
_n‹m
);

1409 
	`VARDECL
(
˚…_n‹m
, 
_lowb™d_s¸©ch
);

1410 
	`VARDECL
(
˚…_n‹m
, 
X_ßve
);

1411 
	`VARDECL
(
˚…_n‹m
, 
Y_ßve
);

1412 
	`VARDECL
(
˚…_n‹m
, 
X_ßve2
);

1413 
	`VARDECL
(
˚…_n‹m
, 
Y_ßve2
);

1414 
	`VARDECL
(
˚…_n‹m
, 
n‹m_ßve2
);

1415 
ªsy¡h_Æloc
;

1416 
˚…_n‹m
 *
lowb™d_s¸©ch
;

1417 
B
;

1418 
M
;

1419 
lowb™d_off£t
;

1420 
upd©e_lowb™d
 = 1;

1421 
C
 = 
Y_
 !
NULL
 ? 2 : 1;

1422 
n‹m_off£t
;

1423 
thëa_rdo
 = 
ícode
 && 
Y_
!=
NULL
 && !
duÆ_°îeo
 && 
com∂exôy
>=8;

1424 #ifde‡
RESYNTH


1425 
ªsy¡h
 = 1;

1427 
ªsy¡h
 = !
ícode
 || 
thëa_rdo
;

1429 
b™d_˘x
 
˘x
;

1430 
SAVE_STACK
;

1432 
M
 = 1<<
LM
;

1433 
B
 = 
sh‹tBlocks
 ? 
M
 : 1;

1434 
n‹m_off£t
 = 
M
*
eB™ds
[
°¨t
];

1437 
	`ALLOC
(
_n‹m
, 
C
*(
M
*
eB™ds
[
m
->
nbEB™ds
-1]-
n‹m_off£t
), 
˚…_n‹m
);

1438 
n‹m
 = 
_n‹m
;

1439 
n‹m2
 = 
n‹m
 + 
M
*
eB™ds
[
m
->
nbEB™ds
-1]-
n‹m_off£t
;

1444 i‡(
ícode
 && 
ªsy¡h
)

1445 
ªsy¡h_Æloc
 = 
M
*(
eB™ds
[
m
->
nbEB™ds
]-eBands[m->nbEBands-1]);

1447 
ªsy¡h_Æloc
 = 
ALLOC_NONE
;

1448 
	`ALLOC
(
_lowb™d_s¸©ch
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1449 i‡(
ícode
 && 
ªsy¡h
)

1450 
lowb™d_s¸©ch
 = 
_lowb™d_s¸©ch
;

1452 
lowb™d_s¸©ch
 = 
X_
+
M
*
eB™ds
[
m
->
nbEB™ds
-1];

1453 
	`ALLOC
(
X_ßve
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1454 
	`ALLOC
(
Y_ßve
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1455 
	`ALLOC
(
X_ßve2
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1456 
	`ALLOC
(
Y_ßve2
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1457 
	`ALLOC
(
n‹m_ßve2
, 
ªsy¡h_Æloc
, 
˚…_n‹m
);

1459 
lowb™d_off£t
 = 0;

1460 
˘x
.
b™dE
 = bandE;

1461 
˘x
.
ec
 =Éc;

1462 
˘x
.
ícode
 =Éncode;

1463 
˘x
.
öãnsôy
 = intensity;

1464 
˘x
.
m
 = m;

1465 
˘x
.
£ed
 = *seed;

1466 
˘x
.
•ªad
 = spread;

1467 
˘x
.
¨ch
 =árch;

1468 
˘x
.
dißbÀ_öv
 = disable_inv;

1469 
˘x
.
ªsy¡h
 =Ñesynth;

1470 
˘x
.
thëa_round
 = 0;

1472 
˘x
.
avoid_•lô_noi£
 = 
B
 > 1;

1473 
i
=
°¨t
;i<
íd
;i++)

1475 
›us_öt32
 
ãŒ
;

1476 
b
;

1477 
N
;

1478 
›us_öt32
 
cuº_bÆ™˚
;

1479 
ef„˘ive_lowb™d
=-1;

1480 
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
, * OPUS_RESTRICT 
Y
;

1481 
tf_ch™ge
=0;

1482 
x_cm
;

1483 
y_cm
;

1484 
œ°
;

1486 
˘x
.
i
 = i;

1487 
œ°
 = (
i
==
íd
-1);

1489 
X
 = 
X_
+
M
*
eB™ds
[
i
];

1490 i‡(
Y_
!=
NULL
)

1491 
Y
 = 
Y_
+
M
*
eB™ds
[
i
];

1493 
Y
 = 
NULL
;

1494 
N
 = 
M
*
eB™ds
[
i
+1]-M*eBands[i];

1495 
	`˚…_as£π
(
N
 > 0);

1496 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
ec
);

1499 i‡(
i
 !
°¨t
)

1500 
bÆ™˚
 -
ãŒ
;

1501 
ªmaöög_bôs
 = 
tŸÆ_bôs
-
ãŒ
-1;

1502 
˘x
.
ªmaöög_bôs
 =Ñemaining_bits;

1503 i‡(
i
 <
codedB™ds
-1)

1505 
cuº_bÆ™˚
 = 
	`˚…_sudiv
(
bÆ™˚
, 
	`IMIN
(3, 
codedB™ds
-
i
));

1506 
b
 = 
	`IMAX
(0, 
	`IMIN
(16383, IMIN(
ªmaöög_bôs
+1,
pul£s
[
i
]+
cuº_bÆ™˚
)));

1508 
b
 = 0;

1511 #i‚de‡
DISABLE_UPDATE_DRAFT


1512 i‡(
ªsy¡h
 && (
M
*
eB™ds
[
i
]-
N
 >M*eB™ds[
°¨t
] || i==°¨t+1Ë&& (
upd©e_lowb™d
 || 
lowb™d_off£t
==0))

1513 
lowb™d_off£t
 = 
i
;

1514 i‡(
i
 =
°¨t
+1)

1515 
	`•ecül_hybrid_fﬁdög
(
m
, 
n‹m
, 
n‹m2
, 
°¨t
, 
M
, 
duÆ_°îeo
);

1517 i‡(
ªsy¡h
 && 
M
*
eB™ds
[
i
]-
N
 >M*eB™ds[
°¨t
] && (
upd©e_lowb™d
 || 
lowb™d_off£t
==0))

1518 
lowb™d_off£t
 = 
i
;

1521 
tf_ch™ge
 = 
tf_ªs
[
i
];

1522 
˘x
.
tf_ch™ge
 =Åf_change;

1523 i‡(
i
>=
m
->
effEB™ds
)

1525 
X
=
n‹m
;

1526 i‡(
Y_
!=
NULL
)

1527 
Y
 = 
n‹m
;

1528 
lowb™d_s¸©ch
 = 
NULL
;

1530 i‡(
œ°
 && !
thëa_rdo
)

1531 
lowb™d_s¸©ch
 = 
NULL
;

1535 i‡(
lowb™d_off£t
 !0 && (
•ªad
!=
SPREAD_AGGRESSIVE
 || 
B
>1 || 
tf_ch™ge
<0))

1537 
fﬁd_°¨t
;

1538 
fﬁd_íd
;

1539 
fﬁd_i
;

1541 
ef„˘ive_lowb™d
 = 
	`IMAX
(0, 
M
*
eB™ds
[
lowb™d_off£t
]-
n‹m_off£t
-
N
);

1542 
fﬁd_°¨t
 = 
lowb™d_off£t
;

1543 
M
*
eB™ds
[--
fﬁd_°¨t
] > 
ef„˘ive_lowb™d
+
n‹m_off£t
);

1544 
fﬁd_íd
 = 
lowb™d_off£t
-1;

1545 #i‚de‡
DISABLE_UPDATE_DRAFT


1546 ++
fﬁd_íd
 < 
i
 && 
M
*
eB™ds
[fﬁd_íd] < 
ef„˘ive_lowb™d
+
n‹m_off£t
+
N
);

1548 
M
*
eB™ds
[++
fﬁd_íd
] < 
ef„˘ive_lowb™d
+
n‹m_off£t
+
N
);

1550 
x_cm
 = 
y_cm
 = 0;

1551 
fﬁd_i
 = 
fﬁd_°¨t
; do {

1552 
x_cm
 |
cﬁœp£_masks
[
fﬁd_i
*
C
+0];

1553 
y_cm
 |
cﬁœp£_masks
[
fﬁd_i
*
C
+C-1];

1554 } ++
fﬁd_i
<
fﬁd_íd
);

1559 
x_cm
 = 
y_cm
 = (1<<
B
)-1;

1561 i‡(
duÆ_°îeo
 && 
i
==
öãnsôy
)

1563 
j
;

1566 
duÆ_°îeo
 = 0;

1567 i‡(
ªsy¡h
)

1568 
j
=0;j<
M
*
eB™ds
[
i
]-
n‹m_off£t
;j++)

1569 
n‹m
[
j
] = 
	`HALF32
“‹m[j]+
n‹m2
[j]);

1571 i‡(
duÆ_°îeo
)

1573 
x_cm
 = 
	`qu™t_b™d
(&
˘x
, 
X
, 
N
, 
b
/2, 
B
,

1574 
ef„˘ive_lowb™d
 !-1 ? 
n‹m
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1575 
œ°
?
NULL
:
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
Q15ONE
, 
lowb™d_s¸©ch
, 
x_cm
);

1576 
y_cm
 = 
	`qu™t_b™d
(&
˘x
, 
Y
, 
N
, 
b
/2, 
B
,

1577 
ef„˘ive_lowb™d
 !-1 ? 
n‹m2
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1578 
œ°
?
NULL
:
n‹m2
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
Q15ONE
, 
lowb™d_s¸©ch
, 
y_cm
);

1580 i‡(
Y
!=
NULL
)

1582 i‡(
thëa_rdo
 && 
i
 < 
öãnsôy
)

1584 
ec_˘x
 
ec_ßve
, 
ec_ßve2
;

1585 
b™d_˘x
 
˘x_ßve
, 
˘x_ßve2
;

1586 
›us_vÆ32
 
di°0
, 
di°1
;

1587 
cm
, 
cm2
;

1588 
n°¨t_byãs
, 
√nd_byãs
, 
ßve_byãs
;

1589 *
byãs_buf
;

1590 
byãs_ßve
[1275];

1591 
›us_vÆ16
 
w
[2];

1592 
	`compuã_ch™√l_weights
(
b™dE
[
i
], b™dE[i+
m
->
nbEB™ds
], 
w
);

1594 
cm
 = 
x_cm
|
y_cm
;

1595 
ec_ßve
 = *
ec
;

1596 
˘x_ßve
 = 
˘x
;

1597 
	`OPUS_COPY
(
X_ßve
, 
X
, 
N
);

1598 
	`OPUS_COPY
(
Y_ßve
, 
Y
, 
N
);

1600 
˘x
.
thëa_round
 = -1;

1601 
x_cm
 = 
	`qu™t_b™d_°îeo
(&
˘x
, 
X
, 
Y
, 
N
, 
b
, 
B
,

1602 
ef„˘ive_lowb™d
 !-1 ? 
n‹m
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1603 
œ°
?
NULL
:
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
lowb™d_s¸©ch
, 
cm
);

1604 
di°0
 = 
	`MULT16_32_Q15
(
w
[0], 
	`˚…_ö√r_¥od
(
X_ßve
, 
X
, 
N
, 
¨ch
)Ë+ MULT16_32_Q15(w[1], cñt_ö√r_¥od(
Y_ßve
, 
Y
, N,árch));

1607 
cm2
 = 
x_cm
;

1608 
ec_ßve2
 = *
ec
;

1609 
˘x_ßve2
 = 
˘x
;

1610 
	`OPUS_COPY
(
X_ßve2
, 
X
, 
N
);

1611 
	`OPUS_COPY
(
Y_ßve2
, 
Y
, 
N
);

1612 i‡(!
œ°
)

1613 
	`OPUS_COPY
(
n‹m_ßve2
, 
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
N
);

1614 
n°¨t_byãs
 = 
ec_ßve
.
offs
;

1615 
√nd_byãs
 = 
ec_ßve
.
°‹age
;

1616 
byãs_buf
 = 
ec_ßve
.
buf
+
n°¨t_byãs
;

1617 
ßve_byãs
 = 
√nd_byãs
-
n°¨t_byãs
;

1618 
	`OPUS_COPY
(
byãs_ßve
, 
byãs_buf
, 
ßve_byãs
);

1621 *
ec
 = 
ec_ßve
;

1622 
˘x
 = 
˘x_ßve
;

1623 
	`OPUS_COPY
(
X
, 
X_ßve
, 
N
);

1624 
	`OPUS_COPY
(
Y
, 
Y_ßve
, 
N
);

1625 #i‚de‡
DISABLE_UPDATE_DRAFT


1626 i‡(
i
 =
°¨t
+1)

1627 
	`•ecül_hybrid_fﬁdög
(
m
, 
n‹m
, 
n‹m2
, 
°¨t
, 
M
, 
duÆ_°îeo
);

1630 
˘x
.
thëa_round
 = 1;

1631 
x_cm
 = 
	`qu™t_b™d_°îeo
(&
˘x
, 
X
, 
Y
, 
N
, 
b
, 
B
,

1632 
ef„˘ive_lowb™d
 !-1 ? 
n‹m
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1633 
œ°
?
NULL
:
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
lowb™d_s¸©ch
, 
cm
);

1634 
di°1
 = 
	`MULT16_32_Q15
(
w
[0], 
	`˚…_ö√r_¥od
(
X_ßve
, 
X
, 
N
, 
¨ch
)Ë+ MULT16_32_Q15(w[1], cñt_ö√r_¥od(
Y_ßve
, 
Y
, N,árch));

1635 i‡(
di°0
 >
di°1
) {

1636 
x_cm
 = 
cm2
;

1637 *
ec
 = 
ec_ßve2
;

1638 
˘x
 = 
˘x_ßve2
;

1639 
	`OPUS_COPY
(
X
, 
X_ßve2
, 
N
);

1640 
	`OPUS_COPY
(
Y
, 
Y_ßve2
, 
N
);

1641 i‡(!
œ°
)

1642 
	`OPUS_COPY
(
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
n‹m_ßve2
, 
N
);

1643 
	`OPUS_COPY
(
byãs_buf
, 
byãs_ßve
, 
ßve_byãs
);

1646 
˘x
.
thëa_round
 = 0;

1647 
x_cm
 = 
	`qu™t_b™d_°îeo
(&
˘x
, 
X
, 
Y
, 
N
, 
b
, 
B
,

1648 
ef„˘ive_lowb™d
 !-1 ? 
n‹m
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1649 
œ°
?
NULL
:
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
lowb™d_s¸©ch
, 
x_cm
|
y_cm
);

1652 
x_cm
 = 
	`qu™t_b™d
(&
˘x
, 
X
, 
N
, 
b
, 
B
,

1653 
ef„˘ive_lowb™d
 !-1 ? 
n‹m
+ef„˘ive_lowb™d : 
NULL
, 
LM
,

1654 
œ°
?
NULL
:
n‹m
+
M
*
eB™ds
[
i
]-
n‹m_off£t
, 
Q15ONE
, 
lowb™d_s¸©ch
, 
x_cm
|
y_cm
);

1656 
y_cm
 = 
x_cm
;

1658 
cﬁœp£_masks
[
i
*
C
+0] = ()
x_cm
;

1659 
cﬁœp£_masks
[
i
*
C
+C-1] = ()
y_cm
;

1660 
bÆ™˚
 +
pul£s
[
i
] + 
ãŒ
;

1663 
upd©e_lowb™d
 = 
b
>(
N
<<
BITRES
);

1666 
˘x
.
avoid_•lô_noi£
 = 0;

1668 *
£ed
 = 
˘x
.seed;

1670 
RESTORE_STACK
;

1671 
	}
}

	@celt/bands.h

30 #i‚de‡
BANDS_H


31 
	#BANDS_H


	)

33 
	~"¨ch.h
"

34 
	~"modes.h
"

35 
	~"íãnc.h
"

36 
	~"ítdec.h
"

37 
	~"øã.h
"

39 
›us_öt16
 
bôexa˘_cos
(›us_öt16 
x
);

40 
bôexa˘_log2èn
(
isö
,
icos
);

47 
compuã_b™d_íîgõs
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 *
X
, 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
LM
, 
¨ch
);

57 
n‹mÆi£_b™ds
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_sig
 * 
OPUS_RESTRICT
 
‰eq
, 
˚…_n‹m
 * OPUS_RESTRICT 
X
, c⁄° 
˚…_íî
 *
b™dE
, 
íd
, 
C
, 
M
);

64 
dí‹mÆi£_b™ds
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 * 
OPUS_RESTRICT
 
X
,

65 
˚…_sig
 * 
OPUS_RESTRICT
 
‰eq
, c⁄° 
›us_vÆ16
 *
b™dE
, 
°¨t
,

66 
íd
, 
M
, 
downßm∂e
, 
sûí˚
);

68 
	#SPREAD_NONE
 (0)

	)

69 
	#SPREAD_LIGHT
 (1)

	)

70 
	#SPREAD_NORMAL
 (2)

	)

71 
	#SPREAD_AGGRESSIVE
 (3)

	)

73 
•ªadög_decisi⁄
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 *
X
, *
avîage
,

74 
œ°_decisi⁄
, *
hf_avîage
, *
èp£t_decisi⁄
, 
upd©e_hf
,

75 
íd
, 
C
, 
M
, c⁄° *
•ªad_weight
);

77 #ifde‡
MEASURE_NORM_MSE


78 
mósuª_n‹m_m£
(c⁄° 
CELTMode
 *
m
, *
X
, *
X0
, *
b™dE
, *
b™dE0
, 
M
, 
N
, 
C
);

81 
hØr1
(
˚…_n‹m
 *
X
, 
N0
, 
°ride
);

106 
qu™t_Æl_b™ds
(
ícode
, c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
,

107 
˚…_n‹m
 * 
X
, cñt_n‹m * 
Y
, *
cﬁœp£_masks
,

108 c⁄° 
˚…_íî
 *
b™dE
, *
pul£s
, 
sh‹tBlocks
, 
•ªad
,

109 
duÆ_°îeo
, 
öãnsôy
, *
tf_ªs
, 
›us_öt32
 
tŸÆ_bôs
,

110 
›us_öt32
 
bÆ™˚
, 
ec_˘x
 *
ec
, 
M
, 
codedB™ds
, 
›us_uöt32
 *
£ed
,

111 
com∂exôy
, 
¨ch
, 
dißbÀ_öv
);

113 
™ti_cﬁœp£
(c⁄° 
CELTMode
 *
m
, 
˚…_n‹m
 *
X_
,

114 *
cﬁœp£_masks
, 
LM
, 
C
, 
size
, 
°¨t
,

115 
íd
, c⁄° 
›us_vÆ16
 *
logE
, c⁄° opus_vÆ16 *
¥ev1logE
,

116 c⁄° 
›us_vÆ16
 *
¥ev2logE
, c⁄° *
pul£s
, 
›us_uöt32
 
£ed
,

117 
¨ch
);

119 
›us_uöt32
 
˚…_lcg_ønd
(›us_uöt32 
£ed
);

121 
hy°îesis_decisi⁄
(
›us_vÆ16
 
vÆ
, c⁄° opus_vÆ16 *
thªshﬁds
, c⁄° opus_vÆ16 *
hy°îesis
, 
N
, 
¥ev
);

	@celt/celt.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	#CELT_C


	)

36 
	~"os_suµ‹t.h
"

37 
	~"md˘.h
"

38 
	~<m©h.h
>

39 
	~"˚….h
"

40 
	~"pôch.h
"

41 
	~"b™ds.h
"

42 
	~"modes.h
"

43 
	~"ítcode.h
"

44 
	~"qu™t_b™ds.h
"

45 
	~"øã.h
"

46 
	~"°ack_Æloc.h
"

47 
	~"m©h›s.h
"

48 
	~"Êﬂt_ˇ°.h
"

49 
	~<°d¨g.h
>

50 
	~"˚…_Õc.h
"

51 
	~"vq.h
"

53 #i‚de‡
PACKAGE_VERSION


54 
	#PACKAGE_VERSION
 "unknown"

	)

57 #i‡
deföed
(
MIPSr1_ASM
)

58 
	~"mùs/˚…_mù§1.h
"

62 
	$ªßm∂ög_Á˘‹
(
›us_öt32
 
øã
)

64 
ªt
;

65 
øã
)

68 
ªt
 = 1;

71 
ªt
 = 2;

74 
ªt
 = 3;

77 
ªt
 = 4;

80 
ªt
 = 6;

83 #i‚de‡
CUSTOM_MODES


84 
	`˚…_as£π
(0);

86 
ªt
 = 0;

89  
ªt
;

90 
	}
}

92 #i‡!
deföed
(
OVERRIDE_COMB_FILTER_CONST
Ë|| deföed(
NON_STATIC_COMB_FILTER_CONST_C
)

94 #ifde‡
OPUS_ARM_ASM


95 #i‚de‡
NON_STATIC_COMB_FILTER_CONST_C


98 
	$comb_fûãr_c⁄°_c
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T
, 
N
,

99 
›us_vÆ16
 
g10
, opus_vÆ16 
g11
, opus_vÆ16 
g12
)

101 
›us_vÆ32
 
x0
, 
x1
, 
x2
, 
x3
, 
x4
;

102 
i
;

103 
x4
 = 
	`SHL32
(
x
[-
T
-2], 1);

104 
x3
 = 
	`SHL32
(
x
[-
T
-1], 1);

105 
x2
 = 
	`SHL32
(
x
[-
T
], 1);

106 
x1
 = 
	`SHL32
(
x
[-
T
+1], 1);

107 
i
=0;i<
N
-4;i+=5)

109 
›us_vÆ32
 
t
;

110 
x0
=
	`SHL32
(
x
[
i
-
T
+2],1);

111 
t
 = 
	`MAC16_32_Q16
(
x
[
i
], 
g10
, 
x2
);

112 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x1
,
x3
));

113 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x0
,
x4
));

114 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

115 
y
[
i
] = 
t
;

116 
x4
=
	`SHL32
(
x
[
i
-
T
+3],1);

117 
t
 = 
	`MAC16_32_Q16
(
x
[
i
+1], 
g10
, 
x1
);

118 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x0
,
x2
));

119 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x4
,
x3
));

120 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

121 
y
[
i
+1] = 
t
;

122 
x3
=
	`SHL32
(
x
[
i
-
T
+4],1);

123 
t
 = 
	`MAC16_32_Q16
(
x
[
i
+2], 
g10
, 
x0
);

124 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x4
,
x1
));

125 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x3
,
x2
));

126 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

127 
y
[
i
+2] = 
t
;

128 
x2
=
	`SHL32
(
x
[
i
-
T
+5],1);

129 
t
 = 
	`MAC16_32_Q16
(
x
[
i
+3], 
g10
, 
x4
);

130 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x3
,
x0
));

131 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x2
,
x1
));

132 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

133 
y
[
i
+3] = 
t
;

134 
x1
=
	`SHL32
(
x
[
i
-
T
+6],1);

135 
t
 = 
	`MAC16_32_Q16
(
x
[
i
+4], 
g10
, 
x3
);

136 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x2
,
x4
));

137 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x1
,
x0
));

138 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

139 
y
[
i
+4] = 
t
;

141 #ifde‡
CUSTOM_MODES


142 ;
i
<
N
;i++)

144 
›us_vÆ32
 
t
;

145 
x0
=
	`SHL32
(
x
[
i
-
T
+2],1);

146 
t
 = 
	`MAC16_32_Q16
(
x
[
i
], 
g10
, 
x2
);

147 
t
 = 
	`MAC16_32_Q16
—, 
g11
, 
	`ADD32
(
x1
,
x3
));

148 
t
 = 
	`MAC16_32_Q16
—, 
g12
, 
	`ADD32
(
x0
,
x4
));

149 
t
 = 
	`SATURATE
—, 
SIG_SAT
);

150 
y
[
i
] = 
t
;

151 
x4
=
x3
;

152 
x3
=
x2
;

153 
x2
=
x1
;

154 
x1
=
x0
;

157 
	}
}

159 #i‚de‡
NON_STATIC_COMB_FILTER_CONST_C


162 
	$comb_fûãr_c⁄°_c
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T
, 
N
,

163 
›us_vÆ16
 
g10
, opus_vÆ16 
g11
, opus_vÆ16 
g12
)

165 
›us_vÆ32
 
x0
, 
x1
, 
x2
, 
x3
, 
x4
;

166 
i
;

167 
x4
 = 
x
[-
T
-2];

168 
x3
 = 
x
[-
T
-1];

169 
x2
 = 
x
[-
T
];

170 
x1
 = 
x
[-
T
+1];

171 
i
=0;i<
N
;i++)

173 
x0
=
x
[
i
-
T
+2];

174 
y
[
i
] = 
x
[i]

175 + 
	`MULT16_32_Q15
(
g10
,
x2
)

176 + 
	`MULT16_32_Q15
(
g11
,
	`ADD32
(
x1
,
x3
))

177 + 
	`MULT16_32_Q15
(
g12
,
	`ADD32
(
x0
,
x4
));

178 
y
[
i
] = 
	`SATURATE
(y[i], 
SIG_SAT
);

179 
x4
=
x3
;

180 
x3
=
x2
;

181 
x2
=
x1
;

182 
x1
=
x0
;

185 
	}
}

189 #i‚de‡
OVERRIDE_comb_fûãr


190 
	$comb_fûãr
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T0
, 
T1
, 
N
,

191 
›us_vÆ16
 
g0
, opus_vÆ16 
g1
, 
èp£t0
, 
èp£t1
,

192 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
¨ch
)

194 
i
;

196 
›us_vÆ16
 
g00
, 
g01
, 
g02
, 
g10
, 
g11
, 
g12
;

197 
›us_vÆ32
 
x0
, 
x1
, 
x2
, 
x3
, 
x4
;

198 c⁄° 
›us_vÆ16
 
gaös
[3][3] = {

199 {
	`QCONST16
(0.3066406250f, 15), QCONST16(0.2170410156f, 15), QCONST16(0.1296386719f, 15)},

200 {
	`QCONST16
(0.4638671875f, 15), QCONST16(0.2680664062f, 15), QCONST16(0.f, 15)},

201 {
	`QCONST16
(0.7998046875f, 15), QCONST16(0.1000976562f, 15), QCONST16(0.f, 15)}};

203 i‡(
g0
==0 && 
g1
==0)

206 i‡(
x
!=
y
)

207 
	`OPUS_MOVE
(
y
, 
x
, 
N
);

212 
T0
 = 
	`IMAX
(T0, 
COMBFILTER_MINPERIOD
);

213 
T1
 = 
	`IMAX
(T1, 
COMBFILTER_MINPERIOD
);

214 
g00
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][0]);

215 
g01
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][1]);

216 
g02
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][2]);

217 
g10
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][0]);

218 
g11
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][1]);

219 
g12
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][2]);

220 
x1
 = 
x
[-
T1
+1];

221 
x2
 = 
x
[-
T1
 ];

222 
x3
 = 
x
[-
T1
-1];

223 
x4
 = 
x
[-
T1
-2];

225 i‡(
g0
==
g1
 && 
T0
==
T1
 && 
èp£t0
==
èp£t1
)

226 
ovîœp
=0;

227 
i
=0;i<
ovîœp
;i++)

229 
›us_vÆ16
 
f
;

230 
x0
=
x
[
i
-
T1
+2];

231 
f
 = 
	`MULT16_16_Q15
(
wödow
[
i
],window[i]);

232 
y
[
i
] = 
x
[i]

233 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g00
),
x
[
i
-
T0
])

234 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g01
),
	`ADD32
(
x
[
i
-
T0
+1],x[i-T0-1]))

235 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g02
),
	`ADD32
(
x
[
i
-
T0
+2],x[i-T0-2]))

236 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
(
f
,
g10
),
x2
)

237 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
(
f
,
g11
),
	`ADD32
(
x1
,
x3
))

238 + 
	`MULT16_32_Q15
(
	`MULT16_16_Q15
(
f
,
g12
),
	`ADD32
(
x0
,
x4
));

239 
y
[
i
] = 
	`SATURATE
(y[i], 
SIG_SAT
);

240 
x4
=
x3
;

241 
x3
=
x2
;

242 
x2
=
x1
;

243 
x1
=
x0
;

246 i‡(
g1
==0)

249 i‡(
x
!=
y
)

250 
	`OPUS_MOVE
(
y
+
ovîœp
, 
x
+ovîœp, 
N
-overlap);

255 
	`comb_fûãr_c⁄°
(
y
+
i
, 
x
+i, 
T1
, 
N
-i, 
g10
, 
g11
, 
g12
, 
¨ch
);

256 
	}
}

263 c⁄° sig√d 
	gtf_£À˘_èbÀ
[4][8] = {

272 
	$öô_ˇps
(c⁄° 
CELTMode
 *
m
,*
ˇp
,
LM
,
C
)

274 
i
;

275 
i
=0;i<
m
->
nbEB™ds
;i++)

277 
N
;

278 
N
=(
m
->
eB™ds
[
i
+1]-m->eB™ds[i])<<
LM
;

279 
ˇp
[
i
] = (
m
->
ˇche
.
ˇps
[m->
nbEB™ds
*(2*
LM
+
C
-1)+i]+64)*C*
N
>>2;

281 
	}
}

285 c⁄° *
	$›us_°ªº‹
(
îr‹
)

287 c⁄° * c⁄° 
îr‹_°rögs
[8] = {

297 i‡(
îr‹
 > 0 ||Érror < -7)

300  
îr‹_°rögs
[-
îr‹
];

301 
	}
}

303 c⁄° *
	$›us_gë_vîsi⁄_°rög
()

305  "lib›u†" 
PACKAGE_VERSION


309 #ifde‡
FIXED_POINT


312 #ifde‡
FUZZING


316 
	}
}

	@celt/celt.h

35 #i‚de‡
CELT_H


36 
	#CELT_H


	)

38 
	~"›us_ty≥s.h
"

39 
	~"›us_deföes.h
"

40 
	~"›us_cu°om.h
"

41 
	~"íãnc.h
"

42 
	~"ítdec.h
"

43 
	~"¨ch.h
"

45 #ifde‡
__˝lu•lus


49 
	#CELTEncodî
 
OpusCu°omEncodî


	)

50 
	#CELTDecodî
 
OpusCu°omDecodî


	)

51 
	#CELTMode
 
OpusCu°omMode


	)

53 
	#LEAK_BANDS
 19

	)

56 
vÆid
;

57 
t⁄Æôy
;

58 
t⁄Æôy_¶›e
;

59 
noisöess
;

60 
a˘ivôy
;

61 
music_¥ob
;

62 
music_¥ob_mö
;

63 
music_¥ob_max
;

64 
b™dwidth
;

65 
a˘ivôy_¥obabûôy
;

66 
max_pôch_øtio
;

68 
Àak_boo°
[
LEAK_BANDS
];

69 } 
	tA«lysisInfo
;

72 
sig«lTy≥
;

73 
off£t
;

74 } 
	tSILKInfo
;

76 
	#__˚…_check_mode_±r_±r
(
±r
Ë(’åË+ (’åË- (c⁄° 
CELTMode
**)’å)))

	)

78 
	#__˚…_check_™Æysis_±r
(
±r
Ë(’åË+ (’åË- (c⁄° 
A«lysisInfo
*)’å)))

	)

80 
	#__˚…_check_sûköfo_±r
(
±r
Ë(’åË+ (’åË- (c⁄° 
SILKInfo
*)’å)))

	)

85 
	#CELT_SET_PREDICTION_REQUEST
 10002

	)

91 
	#CELT_SET_PREDICTION
(
x
Ë
CELT_SET_PREDICTION_REQUEST
, 
	`__›us_check_öt
(x)

	)

93 
	#CELT_SET_INPUT_CLIPPING_REQUEST
 10004

	)

94 
	#CELT_SET_INPUT_CLIPPING
(
x
Ë
CELT_SET_INPUT_CLIPPING_REQUEST
, 
	`__›us_check_öt
(x)

	)

96 
	#CELT_GET_AND_CLEAR_ERROR_REQUEST
 10007

	)

97 
	#CELT_GET_AND_CLEAR_ERROR
(
x
Ë
CELT_GET_AND_CLEAR_ERROR_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

99 
	#CELT_SET_CHANNELS_REQUEST
 10008

	)

100 
	#CELT_SET_CHANNELS
(
x
Ë
CELT_SET_CHANNELS_REQUEST
, 
	`__›us_check_öt
(x)

	)

104 
	#CELT_SET_START_BAND_REQUEST
 10010

	)

105 
	#CELT_SET_START_BAND
(
x
Ë
CELT_SET_START_BAND_REQUEST
, 
	`__›us_check_öt
(x)

	)

107 
	#CELT_SET_END_BAND_REQUEST
 10012

	)

108 
	#CELT_SET_END_BAND
(
x
Ë
CELT_SET_END_BAND_REQUEST
, 
	`__›us_check_öt
(x)

	)

110 
	#CELT_GET_MODE_REQUEST
 10015

	)

112 
	#CELT_GET_MODE
(
x
Ë
CELT_GET_MODE_REQUEST
, 
	`__˚…_check_mode_±r_±r
(x)

	)

114 
	#CELT_SET_SIGNALLING_REQUEST
 10016

	)

115 
	#CELT_SET_SIGNALLING
(
x
Ë
CELT_SET_SIGNALLING_REQUEST
, 
	`__›us_check_öt
(x)

	)

117 
	#CELT_SET_TONALITY_REQUEST
 10018

	)

118 
	#CELT_SET_TONALITY
(
x
Ë
CELT_SET_TONALITY_REQUEST
, 
	`__›us_check_öt
(x)

	)

119 
	#CELT_SET_TONALITY_SLOPE_REQUEST
 10020

	)

120 
	#CELT_SET_TONALITY_SLOPE
(
x
Ë
CELT_SET_TONALITY_SLOPE_REQUEST
, 
	`__›us_check_öt
(x)

	)

122 
	#CELT_SET_ANALYSIS_REQUEST
 10022

	)

123 
	#CELT_SET_ANALYSIS
(
x
Ë
CELT_SET_ANALYSIS_REQUEST
, 
	`__˚…_check_™Æysis_±r
(x)

	)

125 
	#OPUS_SET_LFE_REQUEST
 10024

	)

126 
	#OPUS_SET_LFE
(
x
Ë
OPUS_SET_LFE_REQUEST
, 
	`__›us_check_öt
(x)

	)

128 
	#OPUS_SET_ENERGY_MASK_REQUEST
 10026

	)

129 
	#OPUS_SET_ENERGY_MASK
(
x
Ë
OPUS_SET_ENERGY_MASK_REQUEST
, 
	`__›us_check_vÆ16_±r
(x)

	)

131 
	#CELT_SET_SILK_INFO_REQUEST
 10028

	)

132 
	#CELT_SET_SILK_INFO
(
x
Ë
CELT_SET_SILK_INFO_REQUEST
, 
	`__˚…_check_sûköfo_±r
(x)

	)

136 
˚…_ícodî_gë_size
(
ch™√ls
);

138 
˚…_ícode_wôh_ec
(
OpusCu°omEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° 
›us_vÆ16
 * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
, 
ec_íc
 *
íc
);

140 
˚…_ícodî_öô
(
CELTEncodî
 *
°
, 
›us_öt32
 
ßm∂ög_øã
, 
ch™√ls
,

141 
¨ch
);

147 
˚…_decodî_gë_size
(
ch™√ls
);

150 
˚…_decodî_öô
(
CELTDecodî
 *
°
, 
›us_öt32
 
ßm∂ög_øã
, 
ch™√ls
);

152 
˚…_decode_wôh_ec
(
OpusCu°omDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
,

153 
Àn
, 
›us_vÆ16
 * 
OPUS_RESTRICT
 
pcm
, 
‰ame_size
, 
ec_dec
 *
dec
, 
accum
);

155 
	#˚…_ícodî_˘l
 
›us_cu°om_ícodî_˘l


	)

156 
	#˚…_decodî_˘l
 
›us_cu°om_decodî_˘l


	)

159 #ifde‡
CUSTOM_MODES


160 
	#OPUS_CUSTOM_NOSTATIC


	)

162 
	#OPUS_CUSTOM_NOSTATIC
 
OPUS_INLINE


	)

165 c⁄° 
åim_icdf
[11] = {126, 124, 119, 109, 87, 41, 19, 9, 4, 2, 0};

167 c⁄° 
•ªad_icdf
[4] = {25, 23, 2, 0};

169 c⁄° 
èp£t_icdf
[3]={2,1,0};

171 #ifde‡
CUSTOM_MODES


172 c⁄° 
toOpusTabÀ
[20] = {

180 c⁄° 
‰omOpusTabÀ
[16] = {

187 
OPUS_INLINE
 
toOpus
(
c
)

189 
ªt
=0;

190 i‡(
c
<0xA0)

191 
ªt
 = 
toOpusTabÀ
[
c
>>3];

192 i‡(
ªt
 == 0)

195  
ªt
|(
c
&0x7);

198 
OPUS_INLINE
 
‰omOpus
(
c
)

200 i‡(
c
<0x80)

203  
‰omOpusTabÀ
[(
c
>>3)-16] | (c&0x7);

207 
	#COMBFILTER_MAXPERIOD
 1024

	)

208 
	#COMBFILTER_MINPERIOD
 15

	)

210 c⁄° sig√d 
tf_£À˘_èbÀ
[4][8];

212 #i‡
deföed
(
ENABLE_HARDENING
Ë|| deföed(
ENABLE_ASSERTIONS
)

213 
vÆid©e_˚…_decodî
(
CELTDecodî
 *
°
);

214 
	#VALIDATE_CELT_DECODER
(
°
Ë
	`vÆid©e_˚…_decodî
(°)

	)

216 
	#VALIDATE_CELT_DECODER
(
°
)

	)

219 
ªßm∂ög_Á˘‹
(
›us_öt32
 
øã
);

221 
˚…_¥ìmphasis
(c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
pcmp
, 
˚…_sig
 * OPUS_RESTRICT 
öp
,

222 
N
, 
CC
, 
upßm∂e
, c⁄° 
›us_vÆ16
 *
c€f
, 
˚…_sig
 *
mem
, 
˛ù
);

224 
comb_fûãr
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T0
, 
T1
, 
N
,

225 
›us_vÆ16
 
g0
, opus_vÆ16 
g1
, 
èp£t0
, 
èp£t1
,

226 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
¨ch
);

228 #ifde‡
NON_STATIC_COMB_FILTER_CONST_C


229 
comb_fûãr_c⁄°_c
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T
, 
N
,

230 
›us_vÆ16
 
g10
, opus_vÆ16 
g11
, opus_vÆ16 
g12
);

233 #i‚de‡
OVERRIDE_COMB_FILTER_CONST


234 
	#comb_fûãr_c⁄°
(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
, 
¨ch
) \

235 (()(
¨ch
),
	`comb_fûãr_c⁄°_c
(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
))

	)

238 
öô_ˇps
(c⁄° 
CELTMode
 *
m
,*
ˇp
,
LM
,
C
);

240 #ifde‡
RESYNTH


241 
dìmphasis
(
˚…_sig
 *
ö
[], 
›us_vÆ16
 *
pcm
, 
N
, 
C
, 
downßm∂e
, c⁄° opus_vÆ16 *
c€f
, cñt_sig *
mem
);

242 
˚…_sy¡hesis
(c⁄° 
CELTMode
 *
mode
, 
˚…_n‹m
 *
X
, 
˚…_sig
 * 
out_syn
[],

243 
›us_vÆ16
 *
ﬁdB™dE
, 
°¨t
, 
effEnd
, 
C
, 
CC
, 
isTønsõ¡
,

244 
LM
, 
downßm∂e
, 
sûí˚
);

247 #ifde‡
__˝lu•lus


	@celt/celt_decoder.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	#CELT_DECODER_C


	)

36 
	~"˝u_suµ‹t.h
"

37 
	~"os_suµ‹t.h
"

38 
	~"md˘.h
"

39 
	~<m©h.h
>

40 
	~"˚….h
"

41 
	~"pôch.h
"

42 
	~"b™ds.h
"

43 
	~"modes.h
"

44 
	~"ítcode.h
"

45 
	~"qu™t_b™ds.h
"

46 
	~"øã.h
"

47 
	~"°ack_Æloc.h
"

48 
	~"m©h›s.h
"

49 
	~"Êﬂt_ˇ°.h
"

50 
	~<°d¨g.h
>

51 
	~"˚…_Õc.h
"

52 
	~"vq.h
"

57 
	#PLC_PITCH_LAG_MAX
 (720)

	)

60 
	#PLC_PITCH_LAG_MIN
 (100)

	)

62 #i‡
deföed
(
SMALL_FOOTPRINT
Ë&& deföed(
FIXED_POINT
)

63 
	#NORM_ALIASING_HACK


	)

70 
	#DECODE_BUFFER_SIZE
 2048

	)

75 
	sOpusCu°omDecodî
 {

76 c⁄° 
OpusCu°omMode
 *
	mmode
;

77 
	movîœp
;

78 
	mch™√ls
;

79 
	m°ªam_ch™√ls
;

81 
	mdownßm∂e
;

82 
	m°¨t
, 
	míd
;

83 
	msig«Œög
;

84 
	mdißbÀ_öv
;

85 
	m¨ch
;

88 
	#DECODER_RESET_START
 
∫g


	)

90 
›us_uöt32
 
	m∫g
;

91 
	mîr‹
;

92 
	mœ°_pôch_ödex
;

93 
	mloss_cou¡
;

94 
	mskù_∂c
;

95 
	mpo°fûãr_≥riod
;

96 
	mpo°fûãr_≥riod_ﬁd
;

97 
›us_vÆ16
 
	mpo°fûãr_gaö
;

98 
›us_vÆ16
 
	mpo°fûãr_gaö_ﬁd
;

99 
	mpo°fûãr_èp£t
;

100 
	mpo°fûãr_èp£t_ﬁd
;

102 
˚…_sig
 
	m¥ìmph_memD
[2];

104 
˚…_sig
 
	m_decode_mem
[1];

112 #i‡
deföed
(
ENABLE_HARDENING
Ë|| deföed(
ENABLE_ASSERTIONS
)

115 
	$vÆid©e_˚…_decodî
(
CELTDecodî
 *
°
)

117 #i‚de‡
CUSTOM_MODES


118 
	`˚…_as£π
(
°
->
mode
 =
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
));

119 
	`˚…_as£π
(
°
->
ovîœp
 == 120);

121 
	`˚…_as£π
(
°
->
ch™√ls
 == 1 || st->channels == 2);

122 
	`˚…_as£π
(
°
->
°ªam_ch™√ls
 == 1 || st->stream_channels == 2);

123 
	`˚…_as£π
(
°
->
downßm∂e
 > 0);

124 
	`˚…_as£π
(
°
->
°¨t
 == 0 || st->start == 17);

125 
	`˚…_as£π
(
°
->
°¨t
 < st->
íd
);

126 
	`˚…_as£π
(
°
->
íd
 <= 21);

127 #ifde‡
OPUS_ARCHMASK


128 
	`˚…_as£π
(
°
->
¨ch
 >= 0);

129 
	`˚…_as£π
(
°
->
¨ch
 <
OPUS_ARCHMASK
);

131 
	`˚…_as£π
(
°
->
œ°_pôch_ödex
 <
PLC_PITCH_LAG_MAX
);

132 
	`˚…_as£π
(
°
->
œ°_pôch_ödex
 >
PLC_PITCH_LAG_MIN
 || st->last_pitch_index == 0);

133 
	`˚…_as£π
(
°
->
po°fûãr_≥riod
 < 
MAX_PERIOD
);

134 
	`˚…_as£π
(
°
->
po°fûãr_≥riod
 >
COMBFILTER_MINPERIOD
 || st->postfilter_period == 0);

135 
	`˚…_as£π
(
°
->
po°fûãr_≥riod_ﬁd
 < 
MAX_PERIOD
);

136 
	`˚…_as£π
(
°
->
po°fûãr_≥riod_ﬁd
 >
COMBFILTER_MINPERIOD
 || st->postfilter_period_old == 0);

137 
	`˚…_as£π
(
°
->
po°fûãr_èp£t
 <= 2);

138 
	`˚…_as£π
(
°
->
po°fûãr_èp£t
 >= 0);

139 
	`˚…_as£π
(
°
->
po°fûãr_èp£t_ﬁd
 <= 2);

140 
	`˚…_as£π
(
°
->
po°fûãr_èp£t_ﬁd
 >= 0);

141 
	}
}

144 
	$˚…_decodî_gë_size
(
ch™√ls
)

146 c⁄° 
CELTMode
 *
mode
 = 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
);

147  
	`›us_cu°om_decodî_gë_size
(
mode
, 
ch™√ls
);

148 
	}
}

150 
OPUS_CUSTOM_NOSTATIC
 
	$›us_cu°om_decodî_gë_size
(c⁄° 
CELTMode
 *
mode
, 
ch™√ls
)

152 
size
 = (
CELTDecodî
)

153 + (
ch™√ls
*(
DECODE_BUFFER_SIZE
+
mode
->
ovîœp
)-1)*(
˚…_sig
)

154 + 
ch™√ls
*
LPC_ORDER
*(
›us_vÆ16
)

155 + 4*2*
mode
->
nbEB™ds
*(
›us_vÆ16
);

156  
size
;

157 
	}
}

159 #ifde‡
CUSTOM_MODES


160 
CELTDecodî
 *
	$›us_cu°om_decodî_¸óã
(c⁄° 
CELTMode
 *
mode
, 
ch™√ls
, *
îr‹
)

162 
ªt
;

163 
CELTDecodî
 *
°
 = (CELTDecodî *)
	`›us_Æloc
(
	`›us_cu°om_decodî_gë_size
(
mode
, 
ch™√ls
));

164 
ªt
 = 
	`›us_cu°om_decodî_öô
(
°
, 
mode
, 
ch™√ls
);

165 i‡(
ªt
 !
OPUS_OK
)

167 
	`›us_cu°om_decodî_de°roy
(
°
);

168 
°
 = 
NULL
;

170 i‡(
îr‹
)

171 *
îr‹
 = 
ªt
;

172  
°
;

173 
	}
}

176 
	$˚…_decodî_öô
(
CELTDecodî
 *
°
, 
›us_öt32
 
ßm∂ög_øã
, 
ch™√ls
)

178 
ªt
;

179 
ªt
 = 
	`›us_cu°om_decodî_öô
(
°
, 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
), 
ch™√ls
);

180 i‡(
ªt
 !
OPUS_OK
)

181  
ªt
;

182 
°
->
downßm∂e
 = 
	`ªßm∂ög_Á˘‹
(
ßm∂ög_øã
);

183 i‡(
°
->
downßm∂e
==0)

184  
OPUS_BAD_ARG
;

186  
OPUS_OK
;

187 
	}
}

189 
OPUS_CUSTOM_NOSTATIC
 
	$›us_cu°om_decodî_öô
(
CELTDecodî
 *
°
, c⁄° 
CELTMode
 *
mode
, 
ch™√ls
)

191 i‡(
ch™√ls
 < 0 || channels > 2)

192  
OPUS_BAD_ARG
;

194 i‡(
°
==
NULL
)

195  
OPUS_ALLOC_FAIL
;

197 
	`OPUS_CLEAR
((*)
°
, 
	`›us_cu°om_decodî_gë_size
(
mode
, 
ch™√ls
));

199 
°
->
mode
 = mode;

200 
°
->
ovîœp
 = 
mode
->overlap;

201 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
 = channels;

203 
°
->
downßm∂e
 = 1;

204 
°
->
°¨t
 = 0;

205 
°
->
íd
 = st->
mode
->
effEB™ds
;

206 
°
->
sig«Œög
 = 1;

207 #i‚de‡
DISABLE_UPDATE_DRAFT


208 
°
->
dißbÀ_öv
 = 
ch™√ls
 == 1;

210 
°
->
dißbÀ_öv
 = 0;

212 
°
->
¨ch
 = 
	`›us_£À˘_¨ch
();

214 
	`›us_cu°om_decodî_˘l
(
°
, 
OPUS_RESET_STATE
);

216  
OPUS_OK
;

217 
	}
}

219 #ifde‡
CUSTOM_MODES


220 
	$›us_cu°om_decodî_de°roy
(
CELTDecodî
 *
°
)

222 
	`›us_‰ì
(
°
);

223 
	}
}

226 #i‚de‡
CUSTOM_MODES


230 
	$dìmphasis_°îeo_sim∂e
(
˚…_sig
 *
ö
[], 
›us_vÆ16
 *
pcm
, 
N
, c⁄° opus_vÆ16 
c€f0
,

231 
˚…_sig
 *
mem
)

233 
˚…_sig
 * 
OPUS_RESTRICT
 
x0
;

234 
˚…_sig
 * 
OPUS_RESTRICT
 
x1
;

235 
˚…_sig
 
m0
, 
m1
;

236 
j
;

237 
x0
=
ö
[0];

238 
x1
=
ö
[1];

239 
m0
 = 
mem
[0];

240 
m1
 = 
mem
[1];

241 
j
=0;j<
N
;j++)

243 
˚…_sig
 
tmp0
, 
tmp1
;

245 
tmp0
 = 
x0
[
j
] + 
VERY_SMALL
 + 
m0
;

246 
tmp1
 = 
x1
[
j
] + 
VERY_SMALL
 + 
m1
;

247 
m0
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp0
);

248 
m1
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp1
);

249 
pcm
[2*
j
 ] = 
	`SCALEOUT
(
	`SIG2WORD16
(
tmp0
));

250 
pcm
[2*
j
+1] = 
	`SCALEOUT
(
	`SIG2WORD16
(
tmp1
));

252 
mem
[0] = 
m0
;

253 
mem
[1] = 
m1
;

254 
	}
}

257 #i‚de‡
RESYNTH


260 
	$dìmphasis
(
˚…_sig
 *
ö
[], 
›us_vÆ16
 *
pcm
, 
N
, 
C
, 
downßm∂e
, c⁄° opus_vÆ16 *
c€f
,

261 
˚…_sig
 *
mem
, 
accum
)

263 
c
;

264 
Nd
;

265 
≠∂y_downßm∂ög
=0;

266 
›us_vÆ16
 
c€f0
;

267 
	`VARDECL
(
˚…_sig
, 
s¸©ch
);

268 
SAVE_STACK
;

269 #i‚de‡
CUSTOM_MODES


271 i‡(
downßm∂e
 =1 && 
C
 =2 && !
accum
)

273 
	`dìmphasis_°îeo_sim∂e
(
ö
, 
pcm
, 
N
, 
c€f
[0], 
mem
);

277 #i‚de‡
FIXED_POINT


278 ()
accum
;

279 
	`˚…_as£π
(
accum
==0);

281 
	`ALLOC
(
s¸©ch
, 
N
, 
˚…_sig
);

282 
c€f0
 = 
c€f
[0];

283 
Nd
 = 
N
/
downßm∂e
;

284 
c
=0; do {

285 
j
;

286 
˚…_sig
 * 
OPUS_RESTRICT
 
x
;

287 
›us_vÆ16
 * 
OPUS_RESTRICT
 
y
;

288 
˚…_sig
 
m
 = 
mem
[
c
];

289 
x
 =
ö
[
c
];

290 
y
 = 
pcm
+
c
;

291 #ifde‡
CUSTOM_MODES


292 i‡(
c€f
[1] != 0)

294 
›us_vÆ16
 
c€f1
 = 
c€f
[1];

295 
›us_vÆ16
 
c€f3
 = 
c€f
[3];

296 
j
=0;j<
N
;j++)

298 
˚…_sig
 
tmp
 = 
x
[
j
] + 
m
 + 
VERY_SMALL
;

299 
m
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp
)

300 - 
	`MULT16_32_Q15
(
c€f1
, 
x
[
j
]);

301 
tmp
 = 
	`SHL32
(
	`MULT16_32_Q15
(
c€f3
,Åmp), 2);

302 
s¸©ch
[
j
] = 
tmp
;

304 
≠∂y_downßm∂ög
=1;

307 i‡(
downßm∂e
>1)

310 
j
=0;j<
N
;j++)

312 
˚…_sig
 
tmp
 = 
x
[
j
] + 
VERY_SMALL
 + 
m
;

313 
m
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp
);

314 
s¸©ch
[
j
] = 
tmp
;

316 
≠∂y_downßm∂ög
=1;

319 #ifde‡
FIXED_POINT


320 i‡(
accum
)

322 
j
=0;j<
N
;j++)

324 
˚…_sig
 
tmp
 = 
x
[
j
] + 
m
 + 
VERY_SMALL
;

325 
m
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp
);

326 
y
[
j
*
C
] = 
	`SAT16
(
	`ADD32
(y[j*C], 
	`SCALEOUT
(
	`SIG2WORD16
(
tmp
))));

331 
j
=0;j<
N
;j++)

333 
˚…_sig
 
tmp
 = 
x
[
j
] + 
VERY_SMALL
 + 
m
;

334 
m
 = 
	`MULT16_32_Q15
(
c€f0
, 
tmp
);

335 
y
[
j
*
C
] = 
	`SCALEOUT
(
	`SIG2WORD16
(
tmp
));

339 
mem
[
c
] = 
m
;

341 i‡(
≠∂y_downßm∂ög
)

344 #ifde‡
FIXED_POINT


345 i‡(
accum
)

347 
j
=0;j<
Nd
;j++)

348 
y
[
j
*
C
] = 
	`SAT16
(
	`ADD32
(y[j*C], 
	`SCALEOUT
(
	`SIG2WORD16
(
s¸©ch
[j*
downßm∂e
]))));

352 
j
=0;j<
Nd
;j++)

353 
y
[
j
*
C
] = 
	`SCALEOUT
(
	`SIG2WORD16
(
s¸©ch
[j*
downßm∂e
]));

356 } ++
c
<
C
);

357 
RESTORE_STACK
;

358 
	}
}

360 #i‚de‡
RESYNTH


363 
	$˚…_sy¡hesis
(c⁄° 
CELTMode
 *
mode
, 
˚…_n‹m
 *
X
, 
˚…_sig
 * 
out_syn
[],

364 
›us_vÆ16
 *
ﬁdB™dE
, 
°¨t
, 
effEnd
, 
C
, 
CC
,

365 
isTønsõ¡
, 
LM
, 
downßm∂e
,

366 
sûí˚
, 
¨ch
)

368 
c
, 
i
;

369 
M
;

370 
b
;

371 
B
;

372 
N
, 
NB
;

373 
shi·
;

374 
nbEB™ds
;

375 
ovîœp
;

376 
	`VARDECL
(
˚…_sig
, 
‰eq
);

377 
SAVE_STACK
;

379 
ovîœp
 = 
mode
->overlap;

380 
nbEB™ds
 = 
mode
->nbEBands;

381 
N
 = 
mode
->
sh‹tMd˘Size
<<
LM
;

382 
	`ALLOC
(
‰eq
, 
N
, 
˚…_sig
);

383 
M
 = 1<<
LM
;

385 i‡(
isTønsõ¡
)

387 
B
 = 
M
;

388 
NB
 = 
mode
->
sh‹tMd˘Size
;

389 
shi·
 = 
mode
->
maxLM
;

391 
B
 = 1;

392 
NB
 = 
mode
->
sh‹tMd˘Size
<<
LM
;

393 
shi·
 = 
mode
->
maxLM
-
LM
;

396 i‡(
CC
==2&&
C
==1)

399 
˚…_sig
 *
‰eq2
;

400 
	`dí‹mÆi£_b™ds
(
mode
, 
X
, 
‰eq
, 
ﬁdB™dE
, 
°¨t
, 
effEnd
, 
M
,

401 
downßm∂e
, 
sûí˚
);

403 
‰eq2
 = 
out_syn
[1]+
ovîœp
/2;

404 
	`OPUS_COPY
(
‰eq2
, 
‰eq
, 
N
);

405 
b
=0;b<
B
;b++)

406 
	`˛t_md˘_backw¨d
(&
mode
->
md˘
, &
‰eq2
[
b
], 
out_syn
[0]+
NB
*b, mode->
wödow
, 
ovîœp
, 
shi·
, 
B
, 
¨ch
);

407 
b
=0;b<
B
;b++)

408 
	`˛t_md˘_backw¨d
(&
mode
->
md˘
, &
‰eq
[
b
], 
out_syn
[1]+
NB
*b, mode->
wödow
, 
ovîœp
, 
shi·
, 
B
, 
¨ch
);

409 } i‡(
CC
==1&&
C
==2)

412 
˚…_sig
 *
‰eq2
;

413 
‰eq2
 = 
out_syn
[0]+
ovîœp
/2;

414 
	`dí‹mÆi£_b™ds
(
mode
, 
X
, 
‰eq
, 
ﬁdB™dE
, 
°¨t
, 
effEnd
, 
M
,

415 
downßm∂e
, 
sûí˚
);

417 
	`dí‹mÆi£_b™ds
(
mode
, 
X
+
N
, 
‰eq2
, 
ﬁdB™dE
+
nbEB™ds
, 
°¨t
, 
effEnd
, 
M
,

418 
downßm∂e
, 
sûí˚
);

419 
i
=0;i<
N
;i++)

420 
‰eq
[
i
] = 
	`ADD32
(
	`HALF32
(‰eq[i]), HALF32(
‰eq2
[i]));

421 
b
=0;b<
B
;b++)

422 
	`˛t_md˘_backw¨d
(&
mode
->
md˘
, &
‰eq
[
b
], 
out_syn
[0]+
NB
*b, mode->
wödow
, 
ovîœp
, 
shi·
, 
B
, 
¨ch
);

425 
c
=0; do {

426 
	`dí‹mÆi£_b™ds
(
mode
, 
X
+
c
*
N
, 
‰eq
, 
ﬁdB™dE
+c*
nbEB™ds
, 
°¨t
, 
effEnd
, 
M
,

427 
downßm∂e
, 
sûí˚
);

428 
b
=0;b<
B
;b++)

429 
	`˛t_md˘_backw¨d
(&
mode
->
md˘
, &
‰eq
[
b
], 
out_syn
[
c
]+
NB
*b, mode->
wödow
, 
ovîœp
, 
shi·
, 
B
, 
¨ch
);

430 } ++
c
<
CC
);

434 
c
=0; do {

435 
i
=0;i<
N
;i++)

436 
out_syn
[
c
][
i
] = 
	`SATURATE
(out_syn[c][i], 
SIG_SAT
);

437 } ++
c
<
CC
);

438 
RESTORE_STACK
;

439 
	}
}

441 
	$tf_decode
(
°¨t
, 
íd
, 
isTønsõ¡
, *
tf_ªs
, 
LM
, 
ec_dec
 *
dec
)

443 
i
, 
cuº
, 
tf_£À˘
;

444 
tf_£À˘_rsv
;

445 
tf_ch™ged
;

446 
logp
;

447 
›us_uöt32
 
budgë
;

448 
›us_uöt32
 
ãŒ
;

450 
budgë
 = 
dec
->
°‹age
*8;

451 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

452 
logp
 = 
isTønsõ¡
 ? 2 : 4;

453 
tf_£À˘_rsv
 = 
LM
>0 && 
ãŒ
+
logp
+1<=
budgë
;

454 
budgë
 -
tf_£À˘_rsv
;

455 
tf_ch™ged
 = 
cuº
 = 0;

456 
i
=
°¨t
;i<
íd
;i++)

458 i‡(
ãŒ
+
logp
<=
budgë
)

460 
cuº
 ^
	`ec_dec_bô_logp
(
dec
, 
logp
);

461 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

462 
tf_ch™ged
 |
cuº
;

464 
tf_ªs
[
i
] = 
cuº
;

465 
logp
 = 
isTønsõ¡
 ? 4 : 5;

467 
tf_£À˘
 = 0;

468 i‡(
tf_£À˘_rsv
 &&

469 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+0+
tf_ch™ged
] !=

470 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2+
tf_ch™ged
])

472 
tf_£À˘
 = 
	`ec_dec_bô_logp
(
dec
, 1);

474 
i
=
°¨t
;i<
íd
;i++)

476 
tf_ªs
[
i
] = 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+tf_res[i]];

478 
	}
}

480 
	$˚…_∂c_pôch_£¨ch
(
˚…_sig
 *
decode_mem
[2], 
C
, 
¨ch
)

482 
pôch_ödex
;

483 
	`VARDECL
–
›us_vÆ16
, 
Õ_pôch_buf
 );

484 
SAVE_STACK
;

485 
	`ALLOC
–
Õ_pôch_buf
, 
DECODE_BUFFER_SIZE
>>1, 
›us_vÆ16
 );

486 
	`pôch_downßm∂e
(
decode_mem
, 
Õ_pôch_buf
,

487 
DECODE_BUFFER_SIZE
, 
C
, 
¨ch
);

488 
	`pôch_£¨ch
(
Õ_pôch_buf
+(
PLC_PITCH_LAG_MAX
>>1),Üp_pitch_buf,

489 
DECODE_BUFFER_SIZE
-
PLC_PITCH_LAG_MAX
,

490 
PLC_PITCH_LAG_MAX
-
PLC_PITCH_LAG_MIN
, &
pôch_ödex
, 
¨ch
);

491 
pôch_ödex
 = 
PLC_PITCH_LAG_MAX
-pitch_index;

492 
RESTORE_STACK
;

493  
pôch_ödex
;

494 
	}
}

496 
	$˚…_decode_lo°
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, 
N
, 
LM
)

498 
c
;

499 
i
;

500 c⁄° 
C
 = 
°
->
ch™√ls
;

501 
˚…_sig
 *
decode_mem
[2];

502 
˚…_sig
 *
out_syn
[2];

503 
›us_vÆ16
 *
Õc
;

504 
›us_vÆ16
 *
ﬁdB™dE
, *
ﬁdLogE
, *
ﬁdLogE2
, *
backgroundLogE
;

505 c⁄° 
OpusCu°omMode
 *
mode
;

506 
nbEB™ds
;

507 
ovîœp
;

508 
°¨t
;

509 
loss_cou¡
;

510 
noi£_ba£d
;

511 c⁄° 
›us_öt16
 *
eB™ds
;

512 
SAVE_STACK
;

514 
mode
 = 
°
->mode;

515 
nbEB™ds
 = 
mode
->nbEBands;

516 
ovîœp
 = 
mode
->overlap;

517 
eB™ds
 = 
mode
->eBands;

519 
c
=0; do {

520 
decode_mem
[
c
] = 
°
->
_decode_mem
 + c*(
DECODE_BUFFER_SIZE
+
ovîœp
);

521 
out_syn
[
c
] = 
decode_mem
[c]+
DECODE_BUFFER_SIZE
-
N
;

522 } ++
c
<
C
);

523 
Õc
 = (
›us_vÆ16
*)(
°
->
_decode_mem
+(
DECODE_BUFFER_SIZE
+
ovîœp
)*
C
);

524 
ﬁdB™dE
 = 
Õc
+
C
*
LPC_ORDER
;

525 
ﬁdLogE
 = 
ﬁdB™dE
 + 2*
nbEB™ds
;

526 
ﬁdLogE2
 = 
ﬁdLogE
 + 2*
nbEB™ds
;

527 
backgroundLogE
 = 
ﬁdLogE2
 + 2*
nbEB™ds
;

529 
loss_cou¡
 = 
°
->loss_count;

530 
°¨t
 = 
°
->start;

531 
noi£_ba£d
 = 
loss_cou¡
 >5 || 
°¨t
 !0 || 
°
->
skù_∂c
;

532 i‡(
noi£_ba£d
)

535 #ifde‡
NORM_ALIASING_HACK


536 
˚…_n‹m
 *
X
;

538 
	`VARDECL
(
˚…_n‹m
, 
X
);

540 
›us_uöt32
 
£ed
;

541 
íd
;

542 
effEnd
;

543 
›us_vÆ16
 
deˇy
;

544 
íd
 = 
°
->end;

545 
effEnd
 = 
	`IMAX
(
°¨t
, 
	`IMIN
(
íd
, 
mode
->
effEB™ds
));

547 #ifde‡
NORM_ALIASING_HACK


550 
X
 = (
˚…_n‹m
*)(
out_syn
[
C
-1]+
ovîœp
/2);

552 
	`ALLOC
(
X
, 
C
*
N
, 
˚…_n‹m
);

556 
deˇy
 = 
loss_cou¡
==0 ? 
	`QCONST16
(1.5f, 
DB_SHIFT
) : QCONST16(.5f, DB_SHIFT);

557 
c
=0; do

559 
i
=
°¨t
;i<
íd
;i++)

560 
ﬁdB™dE
[
c
*
nbEB™ds
+
i
] = 
	`MAX16
(
backgroundLogE
[c*nbEB™ds+i], oldB™dE[c*nbEB™ds+i] - 
deˇy
);

561 } ++
c
<
C
);

562 
£ed
 = 
°
->
∫g
;

563 
c
=0;c<
C
;c++)

565 
i
=
°¨t
;i<
effEnd
;i++)

567 
j
;

568 
boffs
;

569 
bÀn
;

570 
boffs
 = 
N
*
c
+(
eB™ds
[
i
]<<
LM
);

571 
bÀn
 = (
eB™ds
[
i
+1]-eB™ds[i])<<
LM
;

572 
j
=0;j<
bÀn
;j++)

574 
£ed
 = 
	`˚…_lcg_ønd
(seed);

575 
X
[
boffs
+
j
] = (
˚…_n‹m
)((
›us_öt32
)
£ed
>>20);

577 
	`ªn‹mÆi£_ve˘‹
(
X
+
boffs
, 
bÀn
, 
Q15ONE
, 
°
->
¨ch
);

580 
°
->
∫g
 = 
£ed
;

582 
c
=0; do {

583 
	`OPUS_MOVE
(
decode_mem
[
c
], decode_mem[c]+
N
,

584 
DECODE_BUFFER_SIZE
-
N
+(
ovîœp
>>1));

585 } ++
c
<
C
);

587 
	`˚…_sy¡hesis
(
mode
, 
X
, 
out_syn
, 
ﬁdB™dE
, 
°¨t
, 
effEnd
, 
C
, C, 0, 
LM
, 
°
->
downßm∂e
, 0, st->
¨ch
);

589 
exc_Àngth
;

591 c⁄° 
›us_vÆ16
 *
wödow
;

592 
›us_vÆ16
 *
exc
;

593 
›us_vÆ16
 
Áde
 = 
Q15ONE
;

594 
pôch_ödex
;

595 
	`VARDECL
(
›us_vÆ32
, 
ëmp
);

596 
	`VARDECL
(
›us_vÆ16
, 
_exc
);

597 
	`VARDECL
(
›us_vÆ16
, 
fú_tmp
);

599 i‡(
loss_cou¡
 == 0)

601 
°
->
œ°_pôch_ödex
 = 
pôch_ödex
 = 
	`˚…_∂c_pôch_£¨ch
(
decode_mem
, 
C
, st->
¨ch
);

603 
pôch_ödex
 = 
°
->
œ°_pôch_ödex
;

604 
Áde
 = 
	`QCONST16
(.8f,15);

609 
exc_Àngth
 = 
	`IMIN
(2*
pôch_ödex
, 
MAX_PERIOD
);

611 
	`ALLOC
(
ëmp
, 
ovîœp
, 
›us_vÆ32
);

612 
	`ALLOC
(
_exc
, 
MAX_PERIOD
+
LPC_ORDER
, 
›us_vÆ16
);

613 
	`ALLOC
(
fú_tmp
, 
exc_Àngth
, 
›us_vÆ16
);

614 
exc
 = 
_exc
+
LPC_ORDER
;

615 
wödow
 = 
mode
->window;

616 
c
=0; do {

617 
›us_vÆ16
 
deˇy
;

618 
›us_vÆ16
 
©ãnu©i⁄
;

619 
›us_vÆ32
 
S1
=0;

620 
˚…_sig
 *
buf
;

621 
exå≠ﬁ©i⁄_off£t
;

622 
exå≠ﬁ©i⁄_Àn
;

623 
j
;

625 
buf
 = 
decode_mem
[
c
];

626 
i
=0;i<
MAX_PERIOD
+
LPC_ORDER
;i++)

627 
exc
[
i
-
LPC_ORDER
] = 
	`ROUND16
(
buf
[
DECODE_BUFFER_SIZE
-
MAX_PERIOD
-LPC_ORDER+i], 
SIG_SHIFT
);

629 i‡(
loss_cou¡
 == 0)

631 
›us_vÆ32
 
ac
[
LPC_ORDER
+1];

634 
	`_˚…_autoc‹r
(
exc
, 
ac
, 
wödow
, 
ovîœp
,

635 
LPC_ORDER
, 
MAX_PERIOD
, 
°
->
¨ch
);

637 #ifde‡
FIXED_POINT


638 
ac
[0] +
	`SHR32
(ac[0],13);

640 
ac
[0] *= 1.0001f;

643 
i
=1;i<=
LPC_ORDER
;i++)

646 #ifde‡
FIXED_POINT


647 
ac
[
i
] -
	`MULT16_32_Q15
(2*i*i,ác[i]);

649 
ac
[
i
] -=ác[i]*(0.008f*0.008f)*i*i;

652 
	`_˚…_Õc
(
Õc
+
c
*
LPC_ORDER
, 
ac
, LPC_ORDER);

653 #ifde‡
FIXED_POINT


658 
›us_vÆ16
 
tmp
=
Q15ONE
;

659 
›us_vÆ32
 
sum
=
	`QCONST16
(1., 
SIG_SHIFT
);

660 
i
=0;i<
LPC_ORDER
;i++)

661 
sum
 +
	`ABS16
(
Õc
[
c
*
LPC_ORDER
+
i
]);

662 i‡(
sum
 < 65535) ;

663 
i
=0;i<
LPC_ORDER
;i++)

665 
tmp
 = 
	`MULT16_16_Q15
(
	`QCONST16
(.99f,15),Åmp);

666 
Õc
[
c
*
LPC_ORDER
+
i
] = 
	`MULT16_16_Q15
÷pc[c*LPC_ORDER+i], 
tmp
);

676 
	`˚…_fú
(
exc
+
MAX_PERIOD
-
exc_Àngth
, 
Õc
+
c
*
LPC_ORDER
,

677 
fú_tmp
, 
exc_Àngth
, 
LPC_ORDER
, 
°
->
¨ch
);

678 
	`OPUS_COPY
(
exc
+
MAX_PERIOD
-
exc_Àngth
, 
fú_tmp
,Éxc_length);

685 
›us_vÆ32
 
E1
=1, 
E2
=1;

686 
deˇy_Àngth
;

687 #ifde‡
FIXED_POINT


688 
shi·
 = 
	`IMAX
(0,2*
	`˚…_zlog2
(
	`˚…_maxabs16
(&
exc
[
MAX_PERIOD
-
exc_Àngth
],Éxc_length))-20);

690 
deˇy_Àngth
 = 
exc_Àngth
>>1;

691 
i
=0;i<
deˇy_Àngth
;i++)

693 
›us_vÆ16
 
e
;

694 
e
 = 
exc
[
MAX_PERIOD
-
deˇy_Àngth
+
i
];

695 
E1
 +
	`SHR32
(
	`MULT16_16
(
e
,É), 
shi·
);

696 
e
 = 
exc
[
MAX_PERIOD
-2*
deˇy_Àngth
+
i
];

697 
E2
 +
	`SHR32
(
	`MULT16_16
(
e
,É), 
shi·
);

699 
E1
 = 
	`MIN32
(E1, 
E2
);

700 
deˇy
 = 
	`˚…_sqπ
(
	`‰ac_div32
(
	`SHR32
(
E1
, 1), 
E2
));

706 
	`OPUS_MOVE
(
buf
, buf+
N
, 
DECODE_BUFFER_SIZE
-N);

711 
exå≠ﬁ©i⁄_off£t
 = 
MAX_PERIOD
-
pôch_ödex
;

714 
exå≠ﬁ©i⁄_Àn
 = 
N
+
ovîœp
;

716 
©ãnu©i⁄
 = 
	`MULT16_16_Q15
(
Áde
, 
deˇy
);

717 
i
=
j
=0;i<
exå≠ﬁ©i⁄_Àn
;i++,j++)

719 
›us_vÆ16
 
tmp
;

720 i‡(
j
 >
pôch_ödex
) {

721 
j
 -
pôch_ödex
;

722 
©ãnu©i⁄
 = 
	`MULT16_16_Q15
◊âíu©i⁄, 
deˇy
);

724 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
] =

725 
	`SHL32
(
	`EXTEND32
(
	`MULT16_16_Q15
(
©ãnu©i⁄
,

726 
exc
[
exå≠ﬁ©i⁄_off£t
+
j
])), 
SIG_SHIFT
);

729 
tmp
 = 
	`ROUND16
(

730 
buf
[
DECODE_BUFFER_SIZE
-
MAX_PERIOD
-
N
+
exå≠ﬁ©i⁄_off£t
+
j
],

731 
SIG_SHIFT
);

732 
S1
 +
	`SHR32
(
	`MULT16_16
(
tmp
,Åmp), 10);

735 
›us_vÆ16
 
Õc_mem
[
LPC_ORDER
];

738 
i
=0;i<
LPC_ORDER
;i++)

739 
Õc_mem
[
i
] = 
	`ROUND16
(
buf
[
DECODE_BUFFER_SIZE
-
N
-1-i], 
SIG_SHIFT
);

742 
	`˚…_iú
(
buf
+
DECODE_BUFFER_SIZE
-
N
, 
Õc
+
c
*
LPC_ORDER
,

743 
buf
+
DECODE_BUFFER_SIZE
-
N
, 
exå≠ﬁ©i⁄_Àn
, 
LPC_ORDER
,

744 
Õc_mem
, 
°
->
¨ch
);

745 #ifde‡
FIXED_POINT


746 
i
=0; i < 
exå≠ﬁ©i⁄_Àn
; i++)

747 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
] = 
	`SATURATE
(buf[DECODE_BUFFER_SIZE-N+i], 
SIG_SAT
);

755 
›us_vÆ32
 
S2
=0;

756 
i
=0;i<
exå≠ﬁ©i⁄_Àn
;i++)

758 
›us_vÆ16
 
tmp
 = 
	`ROUND16
(
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
], 
SIG_SHIFT
);

759 
S2
 +
	`SHR32
(
	`MULT16_16
(
tmp
,Åmp), 10);

762 #ifde‡
FIXED_POINT


763 i‡(!(
S1
 > 
	`SHR32
(
S2
,2)))

767 i‡(!(
S1
 > 0.2f*
S2
))

770 
i
=0;i<
exå≠ﬁ©i⁄_Àn
;i++)

771 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
] = 0;

772 } i‡(
S1
 < 
S2
)

774 
›us_vÆ16
 
øtio
 = 
	`˚…_sqπ
(
	`‰ac_div32
(
	`SHR32
(
S1
,1)+1,
S2
+1));

775 
i
=0;i<
ovîœp
;i++)

777 
›us_vÆ16
 
tmp_g
 = 
Q15ONE


778 - 
	`MULT16_16_Q15
(
wödow
[
i
], 
Q15ONE
-
øtio
);

779 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
] =

780 
	`MULT16_32_Q15
(
tmp_g
, 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
]);

782 
i
=
ovîœp
;i<
exå≠ﬁ©i⁄_Àn
;i++)

784 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
] =

785 
	`MULT16_32_Q15
(
øtio
, 
buf
[
DECODE_BUFFER_SIZE
-
N
+
i
]);

793 
	`comb_fûãr
(
ëmp
, 
buf
+
DECODE_BUFFER_SIZE
,

794 
°
->
po°fûãr_≥riod
, st->po°fûãr_≥riod, 
ovîœp
,

795 -
°
->
po°fûãr_gaö
, -st->postfilter_gain,

796 
°
->
po°fûãr_èp£t
, st->po°fûãr_èp£t, 
NULL
, 0, st->
¨ch
);

800 
i
=0;i<
ovîœp
/2;i++)

802 
buf
[
DECODE_BUFFER_SIZE
+
i
] =

803 
	`MULT16_32_Q15
(
wödow
[
i
], 
ëmp
[
ovîœp
-1-i])

804 + 
	`MULT16_32_Q15
(
wödow
[
ovîœp
-
i
-1], 
ëmp
[i]);

806 } ++
c
<
C
);

809 
°
->
loss_cou¡
 =Üoss_count+1;

811 
RESTORE_STACK
;

812 
	}
}

814 
	$˚…_decode_wôh_ec
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
,

815 
Àn
, 
›us_vÆ16
 * 
OPUS_RESTRICT
 
pcm
, 
‰ame_size
, 
ec_dec
 *
dec
, 
accum
)

817 
c
, 
i
, 
N
;

818 
•ªad_decisi⁄
;

819 
›us_öt32
 
bôs
;

820 
ec_dec
 
_dec
;

821 #ifde‡
NORM_ALIASING_HACK


822 
˚…_n‹m
 *
X
;

824 
	`VARDECL
(
˚…_n‹m
, 
X
);

826 
	`VARDECL
(, 
föe_qu™t
);

827 
	`VARDECL
(, 
pul£s
);

828 
	`VARDECL
(, 
ˇp
);

829 
	`VARDECL
(, 
off£ts
);

830 
	`VARDECL
(, 
föe_¥i‹ôy
);

831 
	`VARDECL
(, 
tf_ªs
);

832 
	`VARDECL
(, 
cﬁœp£_masks
);

833 
˚…_sig
 *
decode_mem
[2];

834 
˚…_sig
 *
out_syn
[2];

835 
›us_vÆ16
 *
Õc
;

836 
›us_vÆ16
 *
ﬁdB™dE
, *
ﬁdLogE
, *
ﬁdLogE2
, *
backgroundLogE
;

838 
sh‹tBlocks
;

839 
isTønsõ¡
;

840 
öåa_íî
;

841 c⁄° 
CC
 = 
°
->
ch™√ls
;

842 
LM
, 
M
;

843 
°¨t
;

844 
íd
;

845 
effEnd
;

846 
codedB™ds
;

847 
Æloc_åim
;

848 
po°fûãr_pôch
;

849 
›us_vÆ16
 
po°fûãr_gaö
;

850 
öãnsôy
=0;

851 
duÆ_°îeo
=0;

852 
›us_öt32
 
tŸÆ_bôs
;

853 
›us_öt32
 
bÆ™˚
;

854 
›us_öt32
 
ãŒ
;

855 
dy«Œoc_logp
;

856 
po°fûãr_èp£t
;

857 
™ti_cﬁœp£_rsv
;

858 
™ti_cﬁœp£_⁄
=0;

859 
sûí˚
;

860 
C
 = 
°
->
°ªam_ch™√ls
;

861 c⁄° 
OpusCu°omMode
 *
mode
;

862 
nbEB™ds
;

863 
ovîœp
;

864 c⁄° 
›us_öt16
 *
eB™ds
;

865 
ALLOC_STACK
;

867 
	`VALIDATE_CELT_DECODER
(
°
);

868 
mode
 = 
°
->mode;

869 
nbEB™ds
 = 
mode
->nbEBands;

870 
ovîœp
 = 
mode
->overlap;

871 
eB™ds
 = 
mode
->eBands;

872 
°¨t
 = 
°
->start;

873 
íd
 = 
°
->end;

874 
‰ame_size
 *
°
->
downßm∂e
;

876 
Õc
 = (
›us_vÆ16
*)(
°
->
_decode_mem
+(
DECODE_BUFFER_SIZE
+
ovîœp
)*
CC
);

877 
ﬁdB™dE
 = 
Õc
+
CC
*
LPC_ORDER
;

878 
ﬁdLogE
 = 
ﬁdB™dE
 + 2*
nbEB™ds
;

879 
ﬁdLogE2
 = 
ﬁdLogE
 + 2*
nbEB™ds
;

880 
backgroundLogE
 = 
ﬁdLogE2
 + 2*
nbEB™ds
;

882 #ifde‡
CUSTOM_MODES


883 i‡(
°
->
sig«Œög
 && 
d©a
!=
NULL
)

885 
d©a0
=
d©a
[0];

887 i‡(
mode
->
Fs
==48000 && mode->
sh‹tMd˘Size
==120)

889 
d©a0
 = 
	`‰omOpus
(data0);

890 i‡(
d©a0
<0)

891  
OPUS_INVALID_PACKET
;

893 
°
->
íd
 =Énd = 
	`IMAX
(1, 
mode
->
effEB™ds
-2*(
d©a0
>>5));

894 
LM
 = (
d©a0
>>3)&0x3;

895 
C
 = 1 + ((
d©a0
>>2)&0x1);

896 
d©a
++;

897 
Àn
--;

898 i‡(
LM
>
mode
->
maxLM
)

899  
OPUS_INVALID_PACKET
;

900 i‡(
‰ame_size
 < 
mode
->
sh‹tMd˘Size
<<
LM
)

901  
OPUS_BUFFER_TOO_SMALL
;

903 
‰ame_size
 = 
mode
->
sh‹tMd˘Size
<<
LM
;

908 
LM
=0;LM<=
mode
->
maxLM
;LM++)

909 i‡(
mode
->
sh‹tMd˘Size
<<
LM
==
‰ame_size
)

911 i‡(
LM
>
mode
->
maxLM
)

912  
OPUS_BAD_ARG
;

914 
M
=1<<
LM
;

916 i‡(
Àn
<0 ||Üí>1275 || 
pcm
==
NULL
)

917  
OPUS_BAD_ARG
;

919 
N
 = 
M
*
mode
->
sh‹tMd˘Size
;

920 
c
=0; do {

921 
decode_mem
[
c
] = 
°
->
_decode_mem
 + c*(
DECODE_BUFFER_SIZE
+
ovîœp
);

922 
out_syn
[
c
] = 
decode_mem
[c]+
DECODE_BUFFER_SIZE
-
N
;

923 } ++
c
<
CC
);

925 
effEnd
 = 
íd
;

926 i‡(
effEnd
 > 
mode
->
effEB™ds
)

927 
effEnd
 = 
mode
->
effEB™ds
;

929 i‡(
d©a
 =
NULL
 || 
Àn
<=1)

931 
	`˚…_decode_lo°
(
°
, 
N
, 
LM
);

932 
	`dìmphasis
(
out_syn
, 
pcm
, 
N
, 
CC
, 
°
->
downßm∂e
, 
mode
->
¥ìmph
, st->
¥ìmph_memD
, 
accum
);

933 
RESTORE_STACK
;

934  
‰ame_size
/
°
->
downßm∂e
;

939 
°
->
skù_∂c
 = st->
loss_cou¡
 != 0;

941 i‡(
dec
 =
NULL
)

943 
	`ec_dec_öô
(&
_dec
,(*)
d©a
,
Àn
);

944 
dec
 = &
_dec
;

947 i‡(
C
==1)

949 
i
=0;i<
nbEB™ds
;i++)

950 
ﬁdB™dE
[
i
]=
	`MAX16
(ﬁdB™dE[i],ﬁdB™dE[
nbEB™ds
+i]);

953 
tŸÆ_bôs
 = 
Àn
*8;

954 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

956 i‡(
ãŒ
 >
tŸÆ_bôs
)

957 
sûí˚
 = 1;

958 i‡(
ãŒ
==1)

959 
sûí˚
 = 
	`ec_dec_bô_logp
(
dec
, 15);

961 
sûí˚
 = 0;

962 i‡(
sûí˚
)

965 
ãŒ
 = 
Àn
*8;

966 
dec
->
nbôs_tŸÆ
+=
ãŒ
-
	`ec_ãŒ
(dec);

969 
po°fûãr_gaö
 = 0;

970 
po°fûãr_pôch
 = 0;

971 
po°fûãr_èp£t
 = 0;

972 i‡(
°¨t
==0 && 
ãŒ
+16 <
tŸÆ_bôs
)

974 if(
	`ec_dec_bô_logp
(
dec
, 1))

976 
qg
, 
o˘ave
;

977 
o˘ave
 = 
	`ec_dec_uöt
(
dec
, 6);

978 
po°fûãr_pôch
 = (16<<
o˘ave
)+
	`ec_dec_bôs
(
dec
, 4+octave)-1;

979 
qg
 = 
	`ec_dec_bôs
(
dec
, 3);

980 i‡(
	`ec_ãŒ
(
dec
)+2<=
tŸÆ_bôs
)

981 
po°fûãr_èp£t
 = 
	`ec_dec_icdf
(
dec
, 
èp£t_icdf
, 2);

982 
po°fûãr_gaö
 = 
	`QCONST16
(.09375f,15)*(
qg
+1);

984 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

987 i‡(
LM
 > 0 && 
ãŒ
+3 <
tŸÆ_bôs
)

989 
isTønsõ¡
 = 
	`ec_dec_bô_logp
(
dec
, 3);

990 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

993 
isTønsõ¡
 = 0;

995 i‡(
isTønsõ¡
)

996 
sh‹tBlocks
 = 
M
;

998 
sh‹tBlocks
 = 0;

1001 
öåa_íî
 = 
ãŒ
+3<=
tŸÆ_bôs
 ? 
	`ec_dec_bô_logp
(
dec
, 3) : 0;

1003 
	`unqu™t_cﬂr£_íîgy
(
mode
, 
°¨t
, 
íd
, 
ﬁdB™dE
,

1004 
öåa_íî
, 
dec
, 
C
, 
LM
);

1006 
	`ALLOC
(
tf_ªs
, 
nbEB™ds
, );

1007 
	`tf_decode
(
°¨t
, 
íd
, 
isTønsõ¡
, 
tf_ªs
, 
LM
, 
dec
);

1009 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

1010 
•ªad_decisi⁄
 = 
SPREAD_NORMAL
;

1011 i‡(
ãŒ
+4 <
tŸÆ_bôs
)

1012 
•ªad_decisi⁄
 = 
	`ec_dec_icdf
(
dec
, 
•ªad_icdf
, 5);

1014 
	`ALLOC
(
ˇp
, 
nbEB™ds
, );

1016 
	`öô_ˇps
(
mode
,
ˇp
,
LM
,
C
);

1018 
	`ALLOC
(
off£ts
, 
nbEB™ds
, );

1020 
dy«Œoc_logp
 = 6;

1021 
tŸÆ_bôs
<<=
BITRES
;

1022 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
dec
);

1023 
i
=
°¨t
;i<
íd
;i++)

1025 
width
, 
qu™è
;

1026 
dy«Œoc_lo›_logp
;

1027 
boo°
;

1028 
width
 = 
C
*(
eB™ds
[
i
+1]-eB™ds[i])<<
LM
;

1031 
qu™è
 = 
	`IMIN
(
width
<<
BITRES
, 
	`IMAX
(6<<BITRES, width));

1032 
dy«Œoc_lo›_logp
 = 
dy«Œoc_logp
;

1033 
boo°
 = 0;

1034 
ãŒ
+(
dy«Œoc_lo›_logp
<<
BITRES
Ë< 
tŸÆ_bôs
 && 
boo°
 < 
ˇp
[
i
])

1036 
Êag
;

1037 
Êag
 = 
	`ec_dec_bô_logp
(
dec
, 
dy«Œoc_lo›_logp
);

1038 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
dec
);

1039 i‡(!
Êag
)

1041 
boo°
 +
qu™è
;

1042 
tŸÆ_bôs
 -
qu™è
;

1043 
dy«Œoc_lo›_logp
 = 1;

1045 
off£ts
[
i
] = 
boo°
;

1047 i‡(
boo°
>0)

1048 
dy«Œoc_logp
 = 
	`IMAX
(2, dynalloc_logp-1);

1051 
	`ALLOC
(
föe_qu™t
, 
nbEB™ds
, );

1052 
Æloc_åim
 = 
ãŒ
+(6<<
BITRES
Ë<
tŸÆ_bôs
 ?

1053 
	`ec_dec_icdf
(
dec
, 
åim_icdf
, 7) : 5;

1055 
bôs
 = (((
›us_öt32
)
Àn
*8)<<
BITRES
Ë- 
	`ec_ãŒ_‰ac
(
dec
) - 1;

1056 
™ti_cﬁœp£_rsv
 = 
isTønsõ¡
&&
LM
>=2&&
bôs
>=((LM+2)<<
BITRES
) ? (1<<BITRES) : 0;

1057 
bôs
 -
™ti_cﬁœp£_rsv
;

1059 
	`ALLOC
(
pul£s
, 
nbEB™ds
, );

1060 
	`ALLOC
(
föe_¥i‹ôy
, 
nbEB™ds
, );

1062 
codedB™ds
 = 
	`˛t_compuã_Æloˇti⁄
(
mode
, 
°¨t
, 
íd
, 
off£ts
, 
ˇp
,

1063 
Æloc_åim
, &
öãnsôy
, &
duÆ_°îeo
, 
bôs
, &
bÆ™˚
, 
pul£s
,

1064 
föe_qu™t
, 
föe_¥i‹ôy
, 
C
, 
LM
, 
dec
, 0, 0, 0);

1066 
	`unqu™t_föe_íîgy
(
mode
, 
°¨t
, 
íd
, 
ﬁdB™dE
, 
föe_qu™t
, 
dec
, 
C
);

1068 
c
=0; do {

1069 
	`OPUS_MOVE
(
decode_mem
[
c
], decode_mem[c]+
N
, 
DECODE_BUFFER_SIZE
-N+
ovîœp
/2);

1070 } ++
c
<
CC
);

1073 
	`ALLOC
(
cﬁœp£_masks
, 
C
*
nbEB™ds
, );

1075 #ifde‡
NORM_ALIASING_HACK


1078 
X
 = (
˚…_n‹m
*)(
out_syn
[
CC
-1]+
ovîœp
/2);

1080 
	`ALLOC
(
X
, 
C
*
N
, 
˚…_n‹m
);

1083 
	`qu™t_Æl_b™ds
(0, 
mode
, 
°¨t
, 
íd
, 
X
, 
C
==2 ? X+
N
 : 
NULL
, 
cﬁœp£_masks
,

1084 
NULL
, 
pul£s
, 
sh‹tBlocks
, 
•ªad_decisi⁄
, 
duÆ_°îeo
, 
öãnsôy
, 
tf_ªs
,

1085 
Àn
*(8<<
BITRES
)-
™ti_cﬁœp£_rsv
, 
bÆ™˚
, 
dec
, 
LM
, 
codedB™ds
, &
°
->
∫g
, 0,

1086 
°
->
¨ch
, st->
dißbÀ_öv
);

1088 i‡(
™ti_cﬁœp£_rsv
 > 0)

1090 
™ti_cﬁœp£_⁄
 = 
	`ec_dec_bôs
(
dec
, 1);

1093 
	`unqu™t_íîgy_föÆi£
(
mode
, 
°¨t
, 
íd
, 
ﬁdB™dE
,

1094 
föe_qu™t
, 
föe_¥i‹ôy
, 
Àn
*8-
	`ec_ãŒ
(
dec
), dec, 
C
);

1096 i‡(
™ti_cﬁœp£_⁄
)

1097 
	`™ti_cﬁœp£
(
mode
, 
X
, 
cﬁœp£_masks
, 
LM
, 
C
, 
N
,

1098 
°¨t
, 
íd
, 
ﬁdB™dE
, 
ﬁdLogE
, 
ﬁdLogE2
, 
pul£s
, 
°
->
∫g
, st->
¨ch
);

1100 i‡(
sûí˚
)

1102 
i
=0;i<
C
*
nbEB™ds
;i++)

1103 
ﬁdB™dE
[
i
] = -
	`QCONST16
(28.f,
DB_SHIFT
);

1106 
	`˚…_sy¡hesis
(
mode
, 
X
, 
out_syn
, 
ﬁdB™dE
, 
°¨t
, 
effEnd
,

1107 
C
, 
CC
, 
isTønsõ¡
, 
LM
, 
°
->
downßm∂e
, 
sûí˚
, st->
¨ch
);

1109 
c
=0; do {

1110 
°
->
po°fûãr_≥riod
=
	`IMAX
(°->po°fûãr_≥riod, 
COMBFILTER_MINPERIOD
);

1111 
°
->
po°fûãr_≥riod_ﬁd
=
	`IMAX
(°->po°fûãr_≥riod_ﬁd, 
COMBFILTER_MINPERIOD
);

1112 
	`comb_fûãr
(
out_syn
[
c
], out_syn[c], 
°
->
po°fûãr_≥riod_ﬁd
, st->
po°fûãr_≥riod
, 
mode
->
sh‹tMd˘Size
,

1113 
°
->
po°fûãr_gaö_ﬁd
, st->
po°fûãr_gaö
, st->
po°fûãr_èp£t_ﬁd
, st->
po°fûãr_èp£t
,

1114 
mode
->
wödow
, 
ovîœp
, 
°
->
¨ch
);

1115 i‡(
LM
!=0)

1116 
	`comb_fûãr
(
out_syn
[
c
]+
mode
->
sh‹tMd˘Size
, out_syn[c]+mode->sh‹tMd˘Size, 
°
->
po°fûãr_≥riod
, 
po°fûãr_pôch
, 
N
-mode->shortMdctSize,

1117 
°
->
po°fûãr_gaö
,Öo°fûãr_gaö, st->
po°fûãr_èp£t
,Öostfilter_tapset,

1118 
mode
->
wödow
, 
ovîœp
, 
°
->
¨ch
);

1120 } ++
c
<
CC
);

1121 
°
->
po°fûãr_≥riod_ﬁd
 = st->
po°fûãr_≥riod
;

1122 
°
->
po°fûãr_gaö_ﬁd
 = st->
po°fûãr_gaö
;

1123 
°
->
po°fûãr_èp£t_ﬁd
 = st->
po°fûãr_èp£t
;

1124 
°
->
po°fûãr_≥riod
 = 
po°fûãr_pôch
;

1125 
°
->
po°fûãr_gaö
 =Öostfilter_gain;

1126 
°
->
po°fûãr_èp£t
 =Öostfilter_tapset;

1127 i‡(
LM
!=0)

1129 
°
->
po°fûãr_≥riod_ﬁd
 = st->
po°fûãr_≥riod
;

1130 
°
->
po°fûãr_gaö_ﬁd
 = st->
po°fûãr_gaö
;

1131 
°
->
po°fûãr_èp£t_ﬁd
 = st->
po°fûãr_èp£t
;

1134 i‡(
C
==1)

1135 
	`OPUS_COPY
(&
ﬁdB™dE
[
nbEB™ds
], oldBandE,ÇbEBands);

1138 i‡(!
isTønsõ¡
)

1140 
›us_vÆ16
 
max_background_ö¸ó£
;

1141 
	`OPUS_COPY
(
ﬁdLogE2
, 
ﬁdLogE
, 2*
nbEB™ds
);

1142 
	`OPUS_COPY
(
ﬁdLogE
, 
ﬁdB™dE
, 2*
nbEB™ds
);

1146 i‡(
°
->
loss_cou¡
 < 10)

1147 
max_background_ö¸ó£
 = 
M
*
	`QCONST16
(0.001f,
DB_SHIFT
);

1149 
max_background_ö¸ó£
 = 
	`QCONST16
(1.f,
DB_SHIFT
);

1150 
i
=0;i<2*
nbEB™ds
;i++)

1151 
backgroundLogE
[
i
] = 
	`MIN16
(backgroundLogE[i] + 
max_background_ö¸ó£
, 
ﬁdB™dE
[i]);

1153 
i
=0;i<2*
nbEB™ds
;i++)

1154 
ﬁdLogE
[
i
] = 
	`MIN16
(ﬁdLogE[i], 
ﬁdB™dE
[i]);

1156 
c
=0; do

1158 
i
=0;i<
°¨t
;i++)

1160 
ﬁdB™dE
[
c
*
nbEB™ds
+
i
]=0;

1161 
ﬁdLogE
[
c
*
nbEB™ds
+
i
]=
ﬁdLogE2
[c*nbEB™ds+i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

1163 
i
=
íd
;i<
nbEB™ds
;i++)

1165 
ﬁdB™dE
[
c
*
nbEB™ds
+
i
]=0;

1166 
ﬁdLogE
[
c
*
nbEB™ds
+
i
]=
ﬁdLogE2
[c*nbEB™ds+i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

1168 } ++
c
<2);

1169 
°
->
∫g
 = 
dec
->rng;

1171 
	`dìmphasis
(
out_syn
, 
pcm
, 
N
, 
CC
, 
°
->
downßm∂e
, 
mode
->
¥ìmph
, st->
¥ìmph_memD
, 
accum
);

1172 
°
->
loss_cou¡
 = 0;

1173 
RESTORE_STACK
;

1174 i‡(
	`ec_ãŒ
(
dec
Ë> 8*
Àn
)

1175  
OPUS_INTERNAL_ERROR
;

1176 if(
	`ec_gë_îr‹
(
dec
))

1177 
°
->
îr‹
 = 1;

1178  
‰ame_size
/
°
->
downßm∂e
;

1179 
	}
}

1182 #ifde‡
CUSTOM_MODES


1184 #ifde‡
FIXED_POINT


1185 
	$›us_cu°om_decode
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
, 
Àn
, 
›us_öt16
 * OPUS_RESTRICT 
pcm
, 
‰ame_size
)

1187  
	`˚…_decode_wôh_ec
(
°
, 
d©a
, 
Àn
, 
pcm
, 
‰ame_size
, 
NULL
, 0);

1188 
	}
}

1190 #i‚de‡
DISABLE_FLOAT_API


1191 
	$›us_cu°om_decode_Êﬂt
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
, 
Àn
, * OPUS_RESTRICT 
pcm
, 
‰ame_size
)

1193 
j
, 
ªt
, 
C
, 
N
;

1194 
	`VARDECL
(
›us_öt16
, 
out
);

1195 
ALLOC_STACK
;

1197 i‡(
pcm
==
NULL
)

1198  
OPUS_BAD_ARG
;

1200 
C
 = 
°
->
ch™√ls
;

1201 
N
 = 
‰ame_size
;

1203 
	`ALLOC
(
out
, 
C
*
N
, 
›us_öt16
);

1204 
ªt
=
	`˚…_decode_wôh_ec
(
°
, 
d©a
, 
Àn
, 
out
, 
‰ame_size
, 
NULL
, 0);

1205 i‡(
ªt
>0)

1206 
j
=0;j<
C
*
ªt
;j++)

1207 
pcm
[
j
]=
out
[j]*(1.f/32768.f);

1209 
RESTORE_STACK
;

1210  
ªt
;

1211 
	}
}

1216 
	$›us_cu°om_decode_Êﬂt
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
, 
Àn
, * OPUS_RESTRICT 
pcm
, 
‰ame_size
)

1218  
	`˚…_decode_wôh_ec
(
°
, 
d©a
, 
Àn
, 
pcm
, 
‰ame_size
, 
NULL
, 0);

1219 
	}
}

1221 
	$›us_cu°om_decode
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, c⁄° *
d©a
, 
Àn
, 
›us_öt16
 * OPUS_RESTRICT 
pcm
, 
‰ame_size
)

1223 
j
, 
ªt
, 
C
, 
N
;

1224 
	`VARDECL
(
˚…_sig
, 
out
);

1225 
ALLOC_STACK
;

1227 i‡(
pcm
==
NULL
)

1228  
OPUS_BAD_ARG
;

1230 
C
 = 
°
->
ch™√ls
;

1231 
N
 = 
‰ame_size
;

1232 
	`ALLOC
(
out
, 
C
*
N
, 
˚…_sig
);

1234 
ªt
=
	`˚…_decode_wôh_ec
(
°
, 
d©a
, 
Àn
, 
out
, 
‰ame_size
, 
NULL
, 0);

1236 i‡(
ªt
>0)

1237 
j
=0;j<
C
*
ªt
;j++)

1238 
pcm
[
j
] = 
	`FLOAT2INT16
 (
out
[j]);

1240 
RESTORE_STACK
;

1241  
ªt
;

1242 
	}
}

1247 
	$›us_cu°om_decodî_˘l
(
CELTDecodî
 * 
OPUS_RESTRICT
 
°
, 
ªque°
, ...)

1249 
va_li°
 
≠
;

1251 
	`va_°¨t
(
≠
, 
ªque°
);

1252 
ªque°
)

1254 
CELT_SET_START_BAND_REQUEST
:

1256 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1257 i‡(
vÆue
<0 || vÆue>=
°
->
mode
->
nbEB™ds
)

1258 
bad_¨g
;

1259 
°
->
°¨t
 = 
vÆue
;

1262 
CELT_SET_END_BAND_REQUEST
:

1264 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1265 i‡(
vÆue
<1 || vÆue>
°
->
mode
->
nbEB™ds
)

1266 
bad_¨g
;

1267 
°
->
íd
 = 
vÆue
;

1270 
CELT_SET_CHANNELS_REQUEST
:

1272 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1273 i‡(
vÆue
<1 || value>2)

1274 
bad_¨g
;

1275 
°
->
°ªam_ch™√ls
 = 
vÆue
;

1278 
CELT_GET_AND_CLEAR_ERROR_REQUEST
:

1280 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1281 i‡(
vÆue
==
NULL
)

1282 
bad_¨g
;

1283 *
vÆue
=
°
->
îr‹
;

1284 
°
->
îr‹
 = 0;

1287 
OPUS_GET_LOOKAHEAD_REQUEST
:

1289 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1290 i‡(
vÆue
==
NULL
)

1291 
bad_¨g
;

1292 *
vÆue
 = 
°
->
ovîœp
/°->
downßm∂e
;

1295 
OPUS_RESET_STATE
:

1297 
i
;

1298 
›us_vÆ16
 *
Õc
, *
ﬁdB™dE
, *
ﬁdLogE
, *
ﬁdLogE2
;

1299 
Õc
 = (
›us_vÆ16
*)(
°
->
_decode_mem
+(
DECODE_BUFFER_SIZE
+°->
ovîœp
)*°->
ch™√ls
);

1300 
ﬁdB™dE
 = 
Õc
+
°
->
ch™√ls
*
LPC_ORDER
;

1301 
ﬁdLogE
 = 
ﬁdB™dE
 + 2*
°
->
mode
->
nbEB™ds
;

1302 
ﬁdLogE2
 = 
ﬁdLogE
 + 2*
°
->
mode
->
nbEB™ds
;

1303 
	`OPUS_CLEAR
((*)&
°
->
DECODER_RESET_START
,

1304 
	`›us_cu°om_decodî_gë_size
(
°
->
mode
, st->
ch™√ls
)-

1305 ((*)&
°
->
DECODER_RESET_START
 - (*)st));

1306 
i
=0;i<2*
°
->
mode
->
nbEB™ds
;i++)

1307 
ﬁdLogE
[
i
]=
ﬁdLogE2
[i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

1308 
°
->
skù_∂c
 = 1;

1311 
OPUS_GET_PITCH_REQUEST
:

1313 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1314 i‡(
vÆue
==
NULL
)

1315 
bad_¨g
;

1316 *
vÆue
 = 
°
->
po°fûãr_≥riod
;

1319 
CELT_GET_MODE_REQUEST
:

1321 c⁄° 
CELTMode
 ** 
vÆue
 = 
	`va_¨g
(
≠
, const CELTMode**);

1322 i‡(
vÆue
==0)

1323 
bad_¨g
;

1324 *
vÆue
=
°
->
mode
;

1327 
CELT_SET_SIGNALLING_REQUEST
:

1329 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1330 
°
->
sig«Œög
 = 
vÆue
;

1333 
OPUS_GET_FINAL_RANGE_REQUEST
:

1335 
›us_uöt32
 * 
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32 *);

1336 i‡(
vÆue
==0)

1337 
bad_¨g
;

1338 *
vÆue
=
°
->
∫g
;

1341 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

1343 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1344 if(
vÆue
<0 || value>1)

1346 
bad_¨g
;

1348 
°
->
dißbÀ_öv
 = 
vÆue
;

1351 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

1353 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1354 i‡(!
vÆue
)

1356 
bad_¨g
;

1358 *
vÆue
 = 
°
->
dißbÀ_öv
;

1362 
bad_ªque°
;

1364 
	`va_íd
(
≠
);

1365  
OPUS_OK
;

1366 
bad_¨g
:

1367 
	`va_íd
(
≠
);

1368  
OPUS_BAD_ARG
;

1369 
bad_ªque°
:

1370 
	`va_íd
(
≠
);

1371  
OPUS_UNIMPLEMENTED
;

1372 
	}
}

	@celt/celt_encoder.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	#CELT_ENCODER_C


	)

36 
	~"˝u_suµ‹t.h
"

37 
	~"os_suµ‹t.h
"

38 
	~"md˘.h
"

39 
	~<m©h.h
>

40 
	~"˚….h
"

41 
	~"pôch.h
"

42 
	~"b™ds.h
"

43 
	~"modes.h
"

44 
	~"ítcode.h
"

45 
	~"qu™t_b™ds.h
"

46 
	~"øã.h
"

47 
	~"°ack_Æloc.h
"

48 
	~"m©h›s.h
"

49 
	~"Êﬂt_ˇ°.h
"

50 
	~<°d¨g.h
>

51 
	~"˚…_Õc.h
"

52 
	~"vq.h
"

58 
	sOpusCu°omEncodî
 {

59 c⁄° 
OpusCu°omMode
 *
	mmode
;

60 
	mch™√ls
;

61 
	m°ªam_ch™√ls
;

63 
	mf‹˚_öåa
;

64 
	m˛ù
;

65 
	mdißbÀ_pf
;

66 
	mcom∂exôy
;

67 
	mupßm∂e
;

68 
	m°¨t
, 
	míd
;

70 
›us_öt32
 
	mbôøã
;

71 
	mvbr
;

72 
	msig«Œög
;

73 
	mc⁄°øöed_vbr
;

74 
	mloss_øã
;

75 
	mlsb_dïth
;

76 
	ml„
;

77 
	mdißbÀ_öv
;

78 
	m¨ch
;

81 
	#ENCODER_RESET_START
 
∫g


	)

83 
›us_uöt32
 
	m∫g
;

84 
	m•ªad_decisi⁄
;

85 
›us_vÆ32
 
	mdñayedI¡ø
;

86 
	mt⁄Æ_avîage
;

87 
	mœ°CodedB™ds
;

88 
	mhf_avîage
;

89 
	mèp£t_decisi⁄
;

91 
	m¥efûãr_≥riod
;

92 
›us_vÆ16
 
	m¥efûãr_gaö
;

93 
	m¥efûãr_èp£t
;

94 #ifde‡
RESYNTH


95 
	m¥efûãr_≥riod_ﬁd
;

96 
›us_vÆ16
 
	m¥efûãr_gaö_ﬁd
;

97 
	m¥efûãr_èp£t_ﬁd
;

99 
	mc⁄£c_å™sõ¡
;

100 
A«lysisInfo
 
	m™Æysis
;

101 
SILKInfo
 
	msûk_öfo
;

103 
›us_vÆ32
 
	m¥ìmph_memE
[2];

104 
›us_vÆ32
 
	m¥ìmph_memD
[2];

107 
›us_öt32
 
	mvbr_ª£rvoú
;

108 
›us_öt32
 
	mvbr_dri·
;

109 
›us_öt32
 
	mvbr_off£t
;

110 
›us_öt32
 
	mvbr_cou¡
;

111 
›us_vÆ32
 
	movîœp_max
;

112 
›us_vÆ16
 
	m°îeo_ßvög
;

113 
	möãnsôy
;

114 
›us_vÆ16
 *
	míîgy_mask
;

115 
›us_vÆ16
 
	m•ec_avg
;

117 #ifde‡
RESYNTH


119 
˚…_sig
 
	msyn_mem
[2][2*
MAX_PERIOD
+MAX_PERIOD/2];

122 
˚…_sig
 
	mö_mem
[1];

130 
	$˚…_ícodî_gë_size
(
ch™√ls
)

132 
CELTMode
 *
mode
 = 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
);

133  
	`›us_cu°om_ícodî_gë_size
(
mode
, 
ch™√ls
);

134 
	}
}

136 
OPUS_CUSTOM_NOSTATIC
 
	$›us_cu°om_ícodî_gë_size
(c⁄° 
CELTMode
 *
mode
, 
ch™√ls
)

138 
size
 = (
CELTEncodî
)

139 + (
ch™√ls
*
mode
->
ovîœp
-1)*(
˚…_sig
)

140 + 
ch™√ls
*
COMBFILTER_MAXPERIOD
*(
˚…_sig
)

141 + 4*
ch™√ls
*
mode
->
nbEB™ds
*(
›us_vÆ16
);

145  
size
;

146 
	}
}

148 #ifde‡
CUSTOM_MODES


149 
CELTEncodî
 *
	$›us_cu°om_ícodî_¸óã
(c⁄° 
CELTMode
 *
mode
, 
ch™√ls
, *
îr‹
)

151 
ªt
;

152 
CELTEncodî
 *
°
 = (CELTEncodî *)
	`›us_Æloc
(
	`›us_cu°om_ícodî_gë_size
(
mode
, 
ch™√ls
));

154 
ªt
 = 
	`›us_cu°om_ícodî_öô
(
°
, 
mode
, 
ch™√ls
);

155 i‡(
ªt
 !
OPUS_OK
)

157 
	`›us_cu°om_ícodî_de°roy
(
°
);

158 
°
 = 
NULL
;

160 i‡(
îr‹
)

161 *
îr‹
 = 
ªt
;

162  
°
;

163 
	}
}

166 
	$›us_cu°om_ícodî_öô_¨ch
(
CELTEncodî
 *
°
, c⁄° 
CELTMode
 *
mode
,

167 
ch™√ls
, 
¨ch
)

169 i‡(
ch™√ls
 < 0 || channels > 2)

170  
OPUS_BAD_ARG
;

172 i‡(
°
==
NULL
 || 
mode
==NULL)

173  
OPUS_ALLOC_FAIL
;

175 
	`OPUS_CLEAR
((*)
°
, 
	`›us_cu°om_ícodî_gë_size
(
mode
, 
ch™√ls
));

177 
°
->
mode
 = mode;

178 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
 = channels;

180 
°
->
upßm∂e
 = 1;

181 
°
->
°¨t
 = 0;

182 
°
->
íd
 = st->
mode
->
effEB™ds
;

183 
°
->
sig«Œög
 = 1;

184 
°
->
¨ch
 =árch;

186 
°
->
c⁄°øöed_vbr
 = 1;

187 
°
->
˛ù
 = 1;

189 
°
->
bôøã
 = 
OPUS_BITRATE_MAX
;

190 
°
->
vbr
 = 0;

191 
°
->
f‹˚_öåa
 = 0;

192 
°
->
com∂exôy
 = 5;

193 
°
->
lsb_dïth
=24;

195 
	`›us_cu°om_ícodî_˘l
(
°
, 
OPUS_RESET_STATE
);

197  
OPUS_OK
;

198 
	}
}

200 #ifde‡
CUSTOM_MODES


201 
	$›us_cu°om_ícodî_öô
(
CELTEncodî
 *
°
, c⁄° 
CELTMode
 *
mode
, 
ch™√ls
)

203  
	`›us_cu°om_ícodî_öô_¨ch
(
°
, 
mode
, 
ch™√ls
, 
	`›us_£À˘_¨ch
());

204 
	}
}

207 
	$˚…_ícodî_öô
(
CELTEncodî
 *
°
, 
›us_öt32
 
ßm∂ög_øã
, 
ch™√ls
,

208 
¨ch
)

210 
ªt
;

211 
ªt
 = 
	`›us_cu°om_ícodî_öô_¨ch
(
°
,

212 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
), 
ch™√ls
, 
¨ch
);

213 i‡(
ªt
 !
OPUS_OK
)

214  
ªt
;

215 
°
->
upßm∂e
 = 
	`ªßm∂ög_Á˘‹
(
ßm∂ög_øã
);

216  
OPUS_OK
;

217 
	}
}

219 #ifde‡
CUSTOM_MODES


220 
	$›us_cu°om_ícodî_de°roy
(
CELTEncodî
 *
°
)

222 
	`›us_‰ì
(
°
);

223 
	}
}

227 
	$å™sõ¡_™Æysis
(c⁄° 
›us_vÆ32
 * 
OPUS_RESTRICT
 
ö
, 
Àn
, 
C
,

228 
›us_vÆ16
 *
tf_e°im©e
, *
tf_ch™
, 
Ælow_wók_å™sõ¡s
,

229 *
wók_å™sõ¡
)

231 
i
;

232 
	`VARDECL
(
›us_vÆ16
, 
tmp
);

233 
›us_vÆ32
 
mem0
,
mem1
;

234 
is_å™sõ¡
 = 0;

235 
›us_öt32
 
mask_mëric
 = 0;

236 
c
;

237 
›us_vÆ16
 
tf_max
;

238 
Àn2
;

240 #ifde‡
FIXED_POINT


241 
f‹w¨d_shi·
 = 4;

243 
›us_vÆ16
 
f‹w¨d_deˇy
 = 
	`QCONST16
(.0625f,15);

246 c⁄° 
öv_èbÀ
[128] = {

256 
SAVE_STACK
;

257 
	`ALLOC
(
tmp
, 
Àn
, 
›us_vÆ16
);

259 *
wók_å™sõ¡
 = 0;

264 i‡(
Ælow_wók_å™sõ¡s
)

266 #ifde‡
FIXED_POINT


267 
f‹w¨d_shi·
 = 5;

269 
f‹w¨d_deˇy
 = 
	`QCONST16
(.03125f,15);

272 
Àn2
=
Àn
/2;

273 
c
=0;c<
C
;c++)

275 
›us_vÆ32
 
món
;

276 
›us_öt32
 
unmask
=0;

277 
›us_vÆ32
 
n‹m
;

278 
›us_vÆ16
 
maxE
;

279 
mem0
=0;

280 
mem1
=0;

282 
i
=0;i<
Àn
;i++)

284 
›us_vÆ32
 
x
,
y
;

285 
x
 = 
	`SHR32
(
ö
[
i
+
c
*
Àn
],
SIG_SHIFT
);

286 
y
 = 
	`ADD32
(
mem0
, 
x
);

287 #ifde‡
FIXED_POINT


288 
mem0
 = 
mem1
 + 
y
 - 
	`SHL32
(
x
,1);

289 
mem1
 = 
x
 - 
	`SHR32
(
y
,1);

291 
mem0
 = 
mem1
 + 
y
 - 2*
x
;

292 
mem1
 = 
x
 - .5f*
y
;

294 
tmp
[
i
] = 
	`SROUND16
(
y
, 2);

299 
	`OPUS_CLEAR
(
tmp
, 12);

301 #ifde‡
FIXED_POINT


304 
shi·
=0;

305 
shi·
 = 14-
	`˚…_ûog2
(
	`MAX16
(1, 
	`˚…_maxabs16
(
tmp
, 
Àn
)));

306 i‡(
shi·
!=0)

308 
i
=0;i<
Àn
;i++)

309 
tmp
[
i
] = 
	`SHL16
—mp[i], 
shi·
);

314 
món
=0;

315 
mem0
=0;

318 
i
=0;i<
Àn2
;i++)

320 
›us_vÆ16
 
x2
 = 
	`PSHR32
(
	`MULT16_16
(
tmp
[2*
i
],tmp[2*i]) + MULT16_16(tmp[2*i+1],tmp[2*i+1]),16);

321 
món
 +
x2
;

322 #ifde‡
FIXED_POINT


324 
tmp
[
i
] = 
mem0
 + 
	`PSHR32
(
x2
-mem0,
f‹w¨d_shi·
);

326 
tmp
[
i
] = 
mem0
 + 
	`MULT16_16_P15
(
f‹w¨d_deˇy
,
x2
-mem0);

328 
mem0
 = 
tmp
[
i
];

331 
mem0
=0;

332 
maxE
=0;

334 
i
=
Àn2
-1;i>=0;i--)

337 #ifde‡
FIXED_POINT


339 
tmp
[
i
] = 
mem0
 + 
	`PSHR32
(tmp[i]-mem0,3);

341 
tmp
[
i
] = 
mem0
 + 
	`MULT16_16_P15
(
	`QCONST16
(0.125f,15),tmp[i]-mem0);

343 
mem0
 = 
tmp
[
i
];

344 
maxE
 = 
	`MAX16
(maxE, 
mem0
);

354 #ifde‡
FIXED_POINT


356 
món
 = 
	`MULT16_16
(
	`˚…_sqπ
(món), cñt_sqπ(MULT16_16(
maxE
,
Àn2
>>1)));

358 
món
 = 
	`˚…_sqπ
(mó¿* 
maxE
*.5*
Àn2
);

361 
n‹m
 = 
	`SHL32
(
	`EXTEND32
(
Àn2
),6+14)/
	`ADD32
(
EPSILON
,
	`SHR32
(
món
,1));

364 
unmask
=0;

369 
	`˚…_as£π
(!
	`˚…_i¢™
(
tmp
[0]));

370 
	`˚…_as£π
(!
	`˚…_i¢™
(
n‹m
));

371 
i
=12;i<
Àn2
-5;i+=4)

373 
id
;

374 #ifde‡
FIXED_POINT


375 
id
 = 
	`MAX32
(0,
	`MIN32
(127,
	`MULT16_32_Q15
(
tmp
[
i
]+
EPSILON
,
n‹m
)));

377 
id
 = ()
	`MAX32
(0,
	`MIN32
(127,
	`Êo‹
(64*
n‹m
*(
tmp
[
i
]+
EPSILON
))));

379 
unmask
 +
öv_èbÀ
[
id
];

383 
unmask
 = 64*unmask*4/(6*(
Àn2
-17));

384 i‡(
unmask
>
mask_mëric
)

386 *
tf_ch™
 = 
c
;

387 
mask_mëric
 = 
unmask
;

390 
is_å™sõ¡
 = 
mask_mëric
>200;

393 i‡(
Ælow_wók_å™sõ¡s
 && 
is_å™sõ¡
 && 
mask_mëric
<600) {

394 
is_å™sõ¡
 = 0;

395 *
wók_å™sõ¡
 = 1;

398 
tf_max
 = 
	`MAX16
(0,
	`˚…_sqπ
(27*
mask_mëric
)-42);

400 *
tf_e°im©e
 = 
	`˚…_sqπ
(
	`MAX32
(0, 
	`SHL32
(
	`MULT16_16
(
	`QCONST16
(0.0069,14),
	`MIN16
(163,
tf_max
)),14)-
	`QCONST32
(0.139,28)));

402 
RESTORE_STACK
;

403 #ifde‡
FUZZING


404 
is_å™sõ¡
 = 
	`ønd
()&0x1;

407  
is_å™sõ¡
;

408 
	}
}

412 
	$∑tch_å™sõ¡_decisi⁄
(
›us_vÆ16
 *
√wE
, opus_vÆ16 *
ﬁdE
, 
nbEB™ds
,

413 
°¨t
, 
íd
, 
C
)

415 
i
, 
c
;

416 
›us_vÆ32
 
món_diff
=0;

417 
›us_vÆ16
 
•ªad_ﬁd
[26];

420 i‡(
C
==1)

422 
•ªad_ﬁd
[
°¨t
] = 
ﬁdE
[start];

423 
i
=
°¨t
+1;i<
íd
;i++)

424 
•ªad_ﬁd
[
i
] = 
	`MAX16
(•ªad_ﬁd[i-1]-
	`QCONST16
(1.0f, 
DB_SHIFT
), 
ﬁdE
[i]);

426 
•ªad_ﬁd
[
°¨t
] = 
	`MAX16
(
ﬁdE
[°¨t],ﬁdE[°¨t+
nbEB™ds
]);

427 
i
=
°¨t
+1;i<
íd
;i++)

428 
•ªad_ﬁd
[
i
] = 
	`MAX16
(•ªad_ﬁd[i-1]-
	`QCONST16
(1.0f, 
DB_SHIFT
),

429 
	`MAX16
(
ﬁdE
[
i
],ﬁdE[i+
nbEB™ds
]));

431 
i
=
íd
-2;i>=
°¨t
;i--)

432 
•ªad_ﬁd
[
i
] = 
	`MAX16
(•ªad_ﬁd[i], s¥ód_ﬁd[i+1]-
	`QCONST16
(1.0f, 
DB_SHIFT
));

434 
c
=0; do {

435 
i
=
	`IMAX
(2,
°¨t
);i<
íd
-1;i++)

437 
›us_vÆ16
 
x1
, 
x2
;

438 
x1
 = 
	`MAX16
(0, 
√wE
[
i
 + 
c
*
nbEB™ds
]);

439 
x2
 = 
	`MAX16
(0, 
•ªad_ﬁd
[
i
]);

440 
món_diff
 = 
	`ADD32
(món_diff, 
	`EXTEND32
(
	`MAX16
(0, 
	`SUB16
(
x1
, 
x2
))));

442 } ++
c
<
C
);

443 
món_diff
 = 
	`DIV32
(món_diff, 
C
*(
íd
-1-
	`IMAX
(2,
°¨t
)));

445  
món_diff
 > 
	`QCONST16
(1.f, 
DB_SHIFT
);

446 
	}
}

450 
	$compuã_md˘s
(c⁄° 
CELTMode
 *
mode
, 
sh‹tBlocks
, 
˚…_sig
 * 
OPUS_RESTRICT
 
ö
,

451 
˚…_sig
 * 
OPUS_RESTRICT
 
out
, 
C
, 
CC
, 
LM
, 
upßm∂e
,

452 
¨ch
)

454 c⁄° 
ovîœp
 = 
mode
->overlap;

455 
N
;

456 
B
;

457 
shi·
;

458 
i
, 
b
, 
c
;

459 i‡(
sh‹tBlocks
)

461 
B
 = 
sh‹tBlocks
;

462 
N
 = 
mode
->
sh‹tMd˘Size
;

463 
shi·
 = 
mode
->
maxLM
;

465 
B
 = 1;

466 
N
 = 
mode
->
sh‹tMd˘Size
<<
LM
;

467 
shi·
 = 
mode
->
maxLM
-
LM
;

469 
c
=0; do {

470 
b
=0;b<
B
;b++)

473 
	`˛t_md˘_f‹w¨d
(&
mode
->
md˘
, 
ö
+
c
*(
B
*
N
+
ovîœp
)+
b
*N,

474 &
out
[
b
+
c
*
N
*
B
], 
mode
->
wödow
, 
ovîœp
, 
shi·
, B,

475 
¨ch
);

477 } ++
c
<
CC
);

478 i‡(
CC
==2&&
C
==1)

480 
i
=0;i<
B
*
N
;i++)

481 
out
[
i
] = 
	`ADD32
(
	`HALF32
(out[i]), HALF32(out[
B
*
N
+i]));

483 i‡(
upßm∂e
 != 1)

485 
c
=0; do

487 
bound
 = 
B
*
N
/
upßm∂e
;

488 
i
=0;i<
bound
;i++)

489 
out
[
c
*
B
*
N
+
i
] *
upßm∂e
;

490 
	`OPUS_CLEAR
(&
out
[
c
*
B
*
N
+
bound
], B*N-bound);

491 } ++
c
<
C
);

493 
	}
}

496 
	$˚…_¥ìmphasis
(c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
pcmp
, 
˚…_sig
 * OPUS_RESTRICT 
öp
,

497 
N
, 
CC
, 
upßm∂e
, c⁄° 
›us_vÆ16
 *
c€f
, 
˚…_sig
 *
mem
, 
˛ù
)

499 
i
;

500 
›us_vÆ16
 
c€f0
;

501 
˚…_sig
 
m
;

502 
Nu
;

504 
c€f0
 = 
c€f
[0];

505 
m
 = *
mem
;

508 i‡(
c€f
[1] =0 && 
upßm∂e
 =1 && !
˛ù
)

510 
i
=0;i<
N
;i++)

512 
›us_vÆ16
 
x
;

513 
x
 = 
	`SCALEIN
(
pcmp
[
CC
*
i
]);

515 
öp
[
i
] = 
	`SHL32
(
x
, 
SIG_SHIFT
Ë- 
m
;

516 
m
 = 
	`SHR32
(
	`MULT16_16
(
c€f0
, 
x
), 15-
SIG_SHIFT
);

518 *
mem
 = 
m
;

522 
Nu
 = 
N
/
upßm∂e
;

523 i‡(
upßm∂e
!=1)

525 
	`OPUS_CLEAR
(
öp
, 
N
);

527 
i
=0;i<
Nu
;i++)

528 
öp
[
i
*
upßm∂e
] = 
	`SCALEIN
(
pcmp
[
CC
*i]);

530 #i‚de‡
FIXED_POINT


531 i‡(
˛ù
)

534 
i
=0;i<
Nu
;i++)

535 
öp
[
i
*
upßm∂e
] = 
	`MAX32
(-65536.f, 
	`MIN32
(65536.f,inp[i*upsample]));

538 ()
˛ù
;

540 #ifde‡
CUSTOM_MODES


541 i‡(
c€f
[1] != 0)

543 
›us_vÆ16
 
c€f1
 = 
c€f
[1];

544 
›us_vÆ16
 
c€f2
 = 
c€f
[2];

545 
i
=0;i<
N
;i++)

547 
˚…_sig
 
x
, 
tmp
;

548 
x
 = 
öp
[
i
];

550 
tmp
 = 
	`MULT16_16
(
c€f2
, 
x
);

551 
öp
[
i
] = 
tmp
 + 
m
;

552 
m
 = 
	`MULT16_32_Q15
(
c€f1
, 
öp
[
i
]Ë- MULT16_32_Q15(
c€f0
, 
tmp
);

557 
i
=0;i<
N
;i++)

559 
›us_vÆ16
 
x
;

560 
x
 = 
öp
[
i
];

562 
öp
[
i
] = 
	`SHL32
(
x
, 
SIG_SHIFT
Ë- 
m
;

563 
m
 = 
	`SHR32
(
	`MULT16_16
(
c€f0
, 
x
), 15-
SIG_SHIFT
);

566 *
mem
 = 
m
;

567 
	}
}

571 
›us_vÆ32
 
	$l1_mëric
(c⁄° 
˚…_n‹m
 *
tmp
, 
N
, 
LM
, 
›us_vÆ16
 
büs
)

573 
i
;

574 
›us_vÆ32
 
L1
;

575 
L1
 = 0;

576 
i
=0;i<
N
;i++)

577 
L1
 +
	`EXTEND32
(
	`ABS16
(
tmp
[
i
]));

579 
L1
 = 
	`MAC16_32_Q15
(L1, 
LM
*
büs
, L1);

580  
L1
;

582 
	}
}

584 
	$tf_™Æysis
(c⁄° 
CELTMode
 *
m
, 
Àn
, 
isTønsõ¡
,

585 *
tf_ªs
, 
œmbda
, 
˚…_n‹m
 *
X
, 
N0
, 
LM
,

586 
›us_vÆ16
 
tf_e°im©e
, 
tf_ch™
, *
imp‹èn˚
)

588 
i
;

589 
	`VARDECL
(, 
mëric
);

590 
co°0
;

591 
co°1
;

592 
	`VARDECL
(, 
∑th0
);

593 
	`VARDECL
(, 
∑th1
);

594 
	`VARDECL
(
˚…_n‹m
, 
tmp
);

595 
	`VARDECL
(
˚…_n‹m
, 
tmp_1
);

596 
£l
;

597 
£lco°
[2];

598 
tf_£À˘
=0;

599 
›us_vÆ16
 
büs
;

601 
SAVE_STACK
;

602 
büs
 = 
	`MULT16_16_Q14
(
	`QCONST16
(.04f,15), 
	`MAX16
(-QCONST16(.25f,14), QCONST16(.5f,14)-
tf_e°im©e
));

605 
	`ALLOC
(
mëric
, 
Àn
, );

606 
	`ALLOC
(
tmp
, (
m
->
eB™ds
[
Àn
]-m->eB™ds[Àn-1])<<
LM
, 
˚…_n‹m
);

607 
	`ALLOC
(
tmp_1
, (
m
->
eB™ds
[
Àn
]-m->eB™ds[Àn-1])<<
LM
, 
˚…_n‹m
);

608 
	`ALLOC
(
∑th0
, 
Àn
, );

609 
	`ALLOC
(
∑th1
, 
Àn
, );

611 
i
=0;i<
Àn
;i++)

613 
k
, 
N
;

614 
«ºow
;

615 
›us_vÆ32
 
L1
, 
be°_L1
;

616 
be°_Àvñ
=0;

617 
N
 = (
m
->
eB™ds
[
i
+1]-m->eB™ds[i])<<
LM
;

619 
«ºow
 = (
m
->
eB™ds
[
i
+1]-m->eBands[i])==1;

620 
	`OPUS_COPY
(
tmp
, &
X
[
tf_ch™
*
N0
 + (
m
->
eB™ds
[
i
]<<
LM
)], 
N
);

625 
L1
 = 
	`l1_mëric
(
tmp
, 
N
, 
isTønsõ¡
 ? 
LM
 : 0, 
büs
);

626 
be°_L1
 = 
L1
;

628 i‡(
isTønsõ¡
 && !
«ºow
)

630 
	`OPUS_COPY
(
tmp_1
, 
tmp
, 
N
);

631 
	`hØr1
(
tmp_1
, 
N
>>
LM
, 1<<LM);

632 
L1
 = 
	`l1_mëric
(
tmp_1
, 
N
, 
LM
+1, 
büs
);

633 i‡(
L1
<
be°_L1
)

635 
be°_L1
 = 
L1
;

636 
be°_Àvñ
 = -1;

640 
k
=0;k<
LM
+!(
isTønsõ¡
||
«ºow
);k++)

642 
B
;

644 i‡(
isTønsõ¡
)

645 
B
 = (
LM
-
k
-1);

647 
B
 = 
k
+1;

649 
	`hØr1
(
tmp
, 
N
>>
k
, 1<<k);

651 
L1
 = 
	`l1_mëric
(
tmp
, 
N
, 
B
, 
büs
);

653 i‡(
L1
 < 
be°_L1
)

655 
be°_L1
 = 
L1
;

656 
be°_Àvñ
 = 
k
+1;

661 i‡(
isTønsõ¡
)

662 
mëric
[
i
] = 2*
be°_Àvñ
;

664 
mëric
[
i
] = -2*
be°_Àvñ
;

667 i‡(
«ºow
 && (
mëric
[
i
]==0 || mëric[i]==-2*
LM
))

668 
mëric
[
i
]-=1;

673 
tf_£À˘
 = 0;

674 
£l
=0;sel<2;sel++)

676 
co°0
 = 
imp‹èn˚
[0]*
	`abs
(
mëric
[0]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
£l
+0]);

677 
co°1
 = 
imp‹èn˚
[0]*
	`abs
(
mëric
[0]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
£l
+1]Ë+ (isTønsõ¡ ? 0 : 
œmbda
);

678 
i
=1;i<
Àn
;i++)

680 
cuº0
, 
cuº1
;

681 
cuº0
 = 
	`IMIN
(
co°0
, 
co°1
 + 
œmbda
);

682 
cuº1
 = 
	`IMIN
(
co°0
 + 
œmbda
, 
co°1
);

683 
co°0
 = 
cuº0
 + 
imp‹èn˚
[
i
]*
	`abs
(
mëric
[i]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
£l
+0]);

684 
co°1
 = 
cuº1
 + 
imp‹èn˚
[
i
]*
	`abs
(
mëric
[i]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
£l
+1]);

686 
co°0
 = 
	`IMIN
(co°0, 
co°1
);

687 
£lco°
[
£l
]=
co°0
;

691 i‡(
£lco°
[1]<£lco°[0] && 
isTønsõ¡
)

692 
tf_£À˘
=1;

693 
co°0
 = 
imp‹èn˚
[0]*
	`abs
(
mëric
[0]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+0]);

694 
co°1
 = 
imp‹èn˚
[0]*
	`abs
(
mëric
[0]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+1]Ë+ (isTønsõ¡ ? 0 : 
œmbda
);

696 
i
=1;i<
Àn
;i++)

698 
cuº0
, 
cuº1
;

699 
‰om0
, 
‰om1
;

701 
‰om0
 = 
co°0
;

702 
‰om1
 = 
co°1
 + 
œmbda
;

703 i‡(
‰om0
 < 
‰om1
)

705 
cuº0
 = 
‰om0
;

706 
∑th0
[
i
]= 0;

708 
cuº0
 = 
‰om1
;

709 
∑th0
[
i
]= 1;

712 
‰om0
 = 
co°0
 + 
œmbda
;

713 
‰om1
 = 
co°1
;

714 i‡(
‰om0
 < 
‰om1
)

716 
cuº1
 = 
‰om0
;

717 
∑th1
[
i
]= 0;

719 
cuº1
 = 
‰om1
;

720 
∑th1
[
i
]= 1;

722 
co°0
 = 
cuº0
 + 
imp‹èn˚
[
i
]*
	`abs
(
mëric
[i]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+0]);

723 
co°1
 = 
cuº1
 + 
imp‹èn˚
[
i
]*
	`abs
(
mëric
[i]-2*
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+1]);

725 
tf_ªs
[
Àn
-1] = 
co°0
 < 
co°1
 ? 0 : 1;

727 
i
=
Àn
-2;i>=0;i--)

729 i‡(
tf_ªs
[
i
+1] == 1)

730 
tf_ªs
[
i
] = 
∑th1
[i+1];

732 
tf_ªs
[
i
] = 
∑th0
[i+1];

735 
RESTORE_STACK
;

736 #ifde‡
FUZZING


737 
tf_£À˘
 = 
	`ønd
()&0x1;

738 
tf_ªs
[0] = 
	`ønd
()&0x1;

739 
i
=1;i<
Àn
;i++)

740 
tf_ªs
[
i
] =Åf_ªs[i-1] ^ ((
	`ønd
()&0xF) == 0);

742  
tf_£À˘
;

743 
	}
}

745 
	$tf_ícode
(
°¨t
, 
íd
, 
isTønsõ¡
, *
tf_ªs
, 
LM
, 
tf_£À˘
, 
ec_íc
 *
íc
)

747 
cuº
, 
i
;

748 
tf_£À˘_rsv
;

749 
tf_ch™ged
;

750 
logp
;

751 
›us_uöt32
 
budgë
;

752 
›us_uöt32
 
ãŒ
;

753 
budgë
 = 
íc
->
°‹age
*8;

754 
ãŒ
 = 
	`ec_ãŒ
(
íc
);

755 
logp
 = 
isTønsõ¡
 ? 2 : 4;

757 
tf_£À˘_rsv
 = 
LM
>0 && 
ãŒ
+
logp
+1 <
budgë
;

758 
budgë
 -
tf_£À˘_rsv
;

759 
cuº
 = 
tf_ch™ged
 = 0;

760 
i
=
°¨t
;i<
íd
;i++)

762 i‡(
ãŒ
+
logp
<=
budgë
)

764 
	`ec_íc_bô_logp
(
íc
, 
tf_ªs
[
i
] ^ 
cuº
, 
logp
);

765 
ãŒ
 = 
	`ec_ãŒ
(
íc
);

766 
cuº
 = 
tf_ªs
[
i
];

767 
tf_ch™ged
 |
cuº
;

770 
tf_ªs
[
i
] = 
cuº
;

771 
logp
 = 
isTønsõ¡
 ? 4 : 5;

774 i‡(
tf_£À˘_rsv
 &&

775 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+0+
tf_ch™ged
]!=

776 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2+
tf_ch™ged
])

777 
	`ec_íc_bô_logp
(
íc
, 
tf_£À˘
, 1);

779 
tf_£À˘
 = 0;

780 
i
=
°¨t
;i<
íd
;i++)

781 
tf_ªs
[
i
] = 
tf_£À˘_èbÀ
[
LM
][4*
isTønsõ¡
+2*
tf_£À˘
+tf_res[i]];

783 
	}
}

786 
	$Æloc_åim_™Æysis
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 *
X
,

787 c⁄° 
›us_vÆ16
 *
b™dLogE
, 
íd
, 
LM
, 
C
, 
N0
,

788 
A«lysisInfo
 *
™Æysis
, 
›us_vÆ16
 *
°îeo_ßvög
, opus_vÆ16 
tf_e°im©e
,

789 
öãnsôy
, 
›us_vÆ16
 
suºound_åim
, 
›us_öt32
 
equiv_øã
, 
¨ch
)

791 
i
;

792 
›us_vÆ32
 
diff
=0;

793 
c
;

794 
åim_ödex
;

795 
›us_vÆ16
 
åim
 = 
	`QCONST16
(5.f, 8);

796 
›us_vÆ16
 
logXC
, 
logXC2
;

799 i‡(
equiv_øã
 < 64000) {

800 
åim
 = 
	`QCONST16
(4.f, 8);

801 } i‡(
equiv_øã
 < 80000) {

802 
›us_öt32
 
‰ac
 = (
equiv_øã
-64000) >> 10;

803 
åim
 = 
	`QCONST16
(4.f, 8Ë+ QCONST16(1.f/16.f, 8)*
‰ac
;

805 i‡(
C
==2)

807 
›us_vÆ16
 
sum
 = 0;

808 
›us_vÆ16
 
möXC
;

810 
i
=0;i<8;i++)

812 
›us_vÆ32
 
∑πül
;

813 
∑πül
 = 
	`˚…_ö√r_¥od
(&
X
[
m
->
eB™ds
[
i
]<<
LM
], &X[
N0
+(m->eBands[i]<<LM)],

814 (
m
->
eB™ds
[
i
+1]-m->eB™ds[i])<<
LM
, 
¨ch
);

815 
sum
 = 
	`ADD16
(sum, 
	`EXTRACT16
(
	`SHR32
(
∑πül
, 18)));

817 
sum
 = 
	`MULT16_16_Q15
(
	`QCONST16
(1.f/8, 15), sum);

818 
sum
 = 
	`MIN16
(
	`QCONST16
(1.f, 10), 
	`ABS16
(sum));

819 
möXC
 = 
sum
;

820 
i
=8;i<
öãnsôy
;i++)

822 
›us_vÆ32
 
∑πül
;

823 
∑πül
 = 
	`˚…_ö√r_¥od
(&
X
[
m
->
eB™ds
[
i
]<<
LM
], &X[
N0
+(m->eBands[i]<<LM)],

824 (
m
->
eB™ds
[
i
+1]-m->eB™ds[i])<<
LM
, 
¨ch
);

825 
möXC
 = 
	`MIN16
(möXC, 
	`ABS16
(
	`EXTRACT16
(
	`SHR32
(
∑πül
, 18))));

827 
möXC
 = 
	`MIN16
(
	`QCONST16
(1.f, 10), 
	`ABS16
(minXC));

830 
logXC
 = 
	`˚…_log2
(
	`QCONST32
(1.001f, 20)-
	`MULT16_16
(
sum
, sum));

832 
logXC2
 = 
	`MAX16
(
	`HALF16
(
logXC
), 
	`˚…_log2
(
	`QCONST32
(1.001f, 20)-
	`MULT16_16
(
möXC
, minXC)));

833 #ifde‡
FIXED_POINT


835 
logXC
 = 
	`PSHR32
÷ogXC-
	`QCONST16
(6.f, 
DB_SHIFT
),DB_SHIFT-8);

836 
logXC2
 = 
	`PSHR32
÷ogXC2-
	`QCONST16
(6.f, 
DB_SHIFT
),DB_SHIFT-8);

839 
åim
 +
	`MAX16
(-
	`QCONST16
(4.f, 8), 
	`MULT16_16_Q15
(QCONST16(.75f,15),
logXC
));

840 *
°îeo_ßvög
 = 
	`MIN16
(*°îeo_ßvög + 
	`QCONST16
(0.25f, 8), -
	`HALF16
(
logXC2
));

844 
c
=0; do {

845 
i
=0;i<
íd
-1;i++)

847 
diff
 +
b™dLogE
[
i
+
c
*
m
->
nbEB™ds
]*(
›us_öt32
)(2+2*i-
íd
);

849 } ++
c
<
C
);

850 
diff
 /
C
*(
íd
-1);

852 
åim
 -
	`MAX32
(-
	`QCONST16
(2.f, 8), 
	`MIN32
(QCONST16(2.f, 8), 
	`SHR32
(
diff
+QCONST16(1.f, 
DB_SHIFT
),DB_SHIFT-8)/6 ));

853 
åim
 -
	`SHR16
(
suºound_åim
, 
DB_SHIFT
-8);

854 
åim
 -2*
	`SHR16
(
tf_e°im©e
, 14-8);

855 #i‚de‡
DISABLE_FLOAT_API


856 i‡(
™Æysis
->
vÆid
)

858 
åim
 -
	`MAX16
(-
	`QCONST16
(2.f, 8), 
	`MIN16
(QCONST16(2.f, 8),

859 (
›us_vÆ16
)(
	`QCONST16
(2.f, 8)*(
™Æysis
->
t⁄Æôy_¶›e
+.05f))));

862 ()
™Æysis
;

865 #ifde‡
FIXED_POINT


866 
åim_ödex
 = 
	`PSHR32
(
åim
, 8);

868 
åim_ödex
 = ()
	`Êo‹
(.5f+
åim
);

870 
åim_ödex
 = 
	`IMAX
(0, 
	`IMIN
(10,Årim_index));

872 #ifde‡
FUZZING


873 
åim_ödex
 = 
	`ønd
()%11;

875  
åim_ödex
;

876 
	}
}

878 
	$°îeo_™Æysis
(c⁄° 
CELTMode
 *
m
, c⁄° 
˚…_n‹m
 *
X
,

879 
LM
, 
N0
)

881 
i
;

882 
thëas
;

883 
›us_vÆ32
 
sumLR
 = 
EPSILON
, 
sumMS
 = EPSILON;

886 
i
=0;i<13;i++)

888 
j
;

889 
j
=
m
->
eB™ds
[
i
]<<
LM
;j<m->eBands[i+1]<<LM;j++)

891 
›us_vÆ32
 
L
, 
R
, 
M
, 
S
;

893 
L
 = 
	`EXTEND32
(
X
[
j
]);

894 
R
 = 
	`EXTEND32
(
X
[
N0
+
j
]);

895 
M
 = 
	`ADD32
(
L
, 
R
);

896 
S
 = 
	`SUB32
(
L
, 
R
);

897 
sumLR
 = 
	`ADD32
(sumLR, ADD32(
	`ABS32
(
L
), ABS32(
R
)));

898 
sumMS
 = 
	`ADD32
(sumMS, ADD32(
	`ABS32
(
M
), ABS32(
S
)));

901 
sumMS
 = 
	`MULT16_32_Q15
(
	`QCONST16
(0.707107f, 15), sumMS);

902 
thëas
 = 13;

904 i‡(
LM
<=1)

905 
thëas
 -= 8;

906  
	`MULT16_32_Q15
((
m
->
eB™ds
[13]<<(
LM
+1))+
thëas
, 
sumMS
)

907 > 
	`MULT16_32_Q15
(
m
->
eB™ds
[13]<<(
LM
+1), 
sumLR
);

908 
	}
}

910 
	#MSWAP
(
a
,
b
Ëdÿ{
›us_vÆ16
 
tmp
 =á;a=b;bÒmp;} 0)

	)

911 
›us_vÆ16
 
	$medün_of_5
(c⁄° 
›us_vÆ16
 *
x
)

913 
›us_vÆ16
 
t0
, 
t1
, 
t2
, 
t3
, 
t4
;

914 
t2
 = 
x
[2];

915 i‡(
x
[0] > x[1])

917 
t0
 = 
x
[1];

918 
t1
 = 
x
[0];

920 
t0
 = 
x
[0];

921 
t1
 = 
x
[1];

923 i‡(
x
[3] > x[4])

925 
t3
 = 
x
[4];

926 
t4
 = 
x
[3];

928 
t3
 = 
x
[3];

929 
t4
 = 
x
[4];

931 i‡(
t0
 > 
t3
)

933 
	`MSWAP
(
t0
, 
t3
);

934 
	`MSWAP
(
t1
, 
t4
);

936 i‡(
t2
 > 
t1
)

938 i‡(
t1
 < 
t3
)

939  
	`MIN16
(
t2
, 
t3
);

941  
	`MIN16
(
t4
, 
t1
);

943 i‡(
t2
 < 
t3
)

944  
	`MIN16
(
t1
, 
t3
);

946  
	`MIN16
(
t2
, 
t4
);

948 
	}
}

950 
›us_vÆ16
 
	$medün_of_3
(c⁄° 
›us_vÆ16
 *
x
)

952 
›us_vÆ16
 
t0
, 
t1
, 
t2
;

953 i‡(
x
[0] > x[1])

955 
t0
 = 
x
[1];

956 
t1
 = 
x
[0];

958 
t0
 = 
x
[0];

959 
t1
 = 
x
[1];

961 
t2
 = 
x
[2];

962 i‡(
t1
 < 
t2
)

963  
t1
;

964 i‡(
t0
 < 
t2
)

965  
t2
;

967  
t0
;

968 
	}
}

970 
›us_vÆ16
 
	$dy«Œoc_™Æysis
(c⁄° 
›us_vÆ16
 *
b™dLogE
, c⁄° opus_vÆ16 *
b™dLogE2
,

971 
nbEB™ds
, 
°¨t
, 
íd
, 
C
, *
off£ts
, 
lsb_dïth
, c⁄° 
›us_öt16
 *
logN
,

972 
isTønsõ¡
, 
vbr
, 
c⁄°øöed_vbr
, c⁄° 
›us_öt16
 *
eB™ds
, 
LM
,

973 
ef„˘iveByãs
, 
›us_öt32
 *
tŸ_boo°_
, 
l„
, 
›us_vÆ16
 *
suºound_dy«Œoc
,

974 
A«lysisInfo
 *
™Æysis
, *
imp‹èn˚
, *
•ªad_weight
)

976 
i
, 
c
;

977 
›us_öt32
 
tŸ_boo°
=0;

978 
›us_vÆ16
 
maxDïth
;

979 
	`VARDECL
(
›us_vÆ16
, 
fﬁlowî
);

980 
	`VARDECL
(
›us_vÆ16
, 
noi£_Êo‹
);

981 
SAVE_STACK
;

982 
	`ALLOC
(
fﬁlowî
, 
C
*
nbEB™ds
, 
›us_vÆ16
);

983 
	`ALLOC
(
noi£_Êo‹
, 
C
*
nbEB™ds
, 
›us_vÆ16
);

984 
	`OPUS_CLEAR
(
off£ts
, 
nbEB™ds
);

986 
maxDïth
=-
	`QCONST16
(31.9f, 
DB_SHIFT
);

987 
i
=0;i<
íd
;i++)

991 
noi£_Êo‹
[
i
] = 
	`MULT16_16
(
	`QCONST16
(0.0625f, 
DB_SHIFT
),
logN
[i])

992 +
	`QCONST16
(.5f,
DB_SHIFT
)+
	`SHL16
(9-
lsb_dïth
,DB_SHIFT)-SHL16(
eMóns
[
i
],6)

993 +
	`MULT16_16
(
	`QCONST16
(.0062,
DB_SHIFT
),(
i
+5)*(i+5));

995 
c
=0;do

997 
i
=0;i<
íd
;i++)

998 
maxDïth
 = 
	`MAX16
(maxDïth, 
b™dLogE
[
c
*
nbEB™ds
+
i
]-
noi£_Êo‹
[i]);

999 } ++
c
<
C
);

1003 
	`VARDECL
(
›us_vÆ16
, 
mask
);

1004 
	`VARDECL
(
›us_vÆ16
, 
sig
);

1005 
	`ALLOC
(
mask
, 
nbEB™ds
, 
›us_vÆ16
);

1006 
	`ALLOC
(
sig
, 
nbEB™ds
, 
›us_vÆ16
);

1007 
i
=0;i<
íd
;i++)

1008 
mask
[
i
] = 
b™dLogE
[i]-
noi£_Êo‹
[i];

1009 i‡(
C
==2)

1011 
i
=0;i<
íd
;i++)

1012 
mask
[
i
] = 
	`MAX16
(mask[i], 
b™dLogE
[
nbEB™ds
+i]-
noi£_Êo‹
[i]);

1014 
	`OPUS_COPY
(
sig
, 
mask
, 
íd
);

1015 
i
=1;i<
íd
;i++)

1016 
mask
[
i
] = 
	`MAX16
(mask[i], mask[i-1] - 
	`QCONST16
(2.f, 
DB_SHIFT
));

1017 
i
=
íd
-2;i>=0;i--)

1018 
mask
[
i
] = 
	`MAX16
(mask[i], mask[i+1] - 
	`QCONST16
(3.f, 
DB_SHIFT
));

1019 
i
=0;i<
íd
;i++)

1022 
›us_vÆ16
 
smr
 = 
sig
[
i
]-
	`MAX16
(MAX16(0, 
maxDïth
-
	`QCONST16
(12.f, 
DB_SHIFT
)), 
mask
[i]);

1024 #ifde‡
FIXED_POINT


1026 
shi·
 = -
	`PSHR32
(
	`MAX16
(-
	`QCONST16
(5.f, 
DB_SHIFT
), 
	`MIN16
(0, 
smr
)), DB_SHIFT);

1028 
shi·
 = 
	`IMIN
(5, 
	`IMAX
(0, -()
	`Êo‹
(.5‡+ 
smr
)));

1030 
•ªad_weight
[
i
] = 32 >> 
shi·
;

1037 i‡(
ef„˘iveByãs
 > 50 && 
LM
>=1 && !
l„
)

1039 
œ°
=0;

1040 
c
=0;do

1042 
›us_vÆ16
 
off£t
;

1043 
›us_vÆ16
 
tmp
;

1044 
›us_vÆ16
 *
f
;

1045 
f
 = &
fﬁlowî
[
c
*
nbEB™ds
];

1046 
f
[0] = 
b™dLogE2
[
c
*
nbEB™ds
];

1047 
i
=1;i<
íd
;i++)

1052 i‡(
b™dLogE2
[
c
*
nbEB™ds
+
i
] > b™dLogE2[c*nbEB™ds+i-1]+
	`QCONST16
(.5f,
DB_SHIFT
))

1053 
œ°
=
i
;

1054 
f
[
i
] = 
	`MIN16
(f[i-1]+
	`QCONST16
(1.5f,
DB_SHIFT
), 
b™dLogE2
[
c
*
nbEB™ds
+i]);

1056 
i
=
œ°
-1;i>=0;i--)

1057 
f
[
i
] = 
	`MIN16
(f[i], MIN16(f[i+1]+
	`QCONST16
(2.f,
DB_SHIFT
), 
b™dLogE2
[
c
*
nbEB™ds
+i]));

1062 
off£t
 = 
	`QCONST16
(1.f, 
DB_SHIFT
);

1063 
i
=2;i<
íd
-2;i++)

1064 
f
[
i
] = 
	`MAX16
(f[i], 
	`medün_of_5
(&
b™dLogE2
[
c
*
nbEB™ds
+i-2])-
off£t
);

1065 
tmp
 = 
	`medün_of_3
(&
b™dLogE2
[
c
*
nbEB™ds
])-
off£t
;

1066 
f
[0] = 
	`MAX16
(f[0], 
tmp
);

1067 
f
[1] = 
	`MAX16
(f[1], 
tmp
);

1068 
tmp
 = 
	`medün_of_3
(&
b™dLogE2
[
c
*
nbEB™ds
+
íd
-3])-
off£t
;

1069 
f
[
íd
-2] = 
	`MAX16
(f[íd-2], 
tmp
);

1070 
f
[
íd
-1] = 
	`MAX16
(f[íd-1], 
tmp
);

1072 
i
=0;i<
íd
;i++)

1073 
f
[
i
] = 
	`MAX16
(f[i], 
noi£_Êo‹
[i]);

1074 } ++
c
<
C
);

1075 i‡(
C
==2)

1077 
i
=
°¨t
;i<
íd
;i++)

1080 
fﬁlowî
[
nbEB™ds
+
i
] = 
	`MAX16
(fﬁlowî[nbEB™ds+i], fﬁlowî[ i]-
	`QCONST16
(4.f,
DB_SHIFT
));

1081 
fﬁlowî
[ 
i
] = 
	`MAX16
(fﬁlowî[ i], fﬁlowî[
nbEB™ds
+i]-
	`QCONST16
(4.f,
DB_SHIFT
));

1082 
fﬁlowî
[
i
] = 
	`HALF16
(
	`MAX16
(0, 
b™dLogE
[i]-fﬁlowî[i]Ë+ MAX16(0, b™dLogE[
nbEB™ds
+i]-follower[nbEBands+i]));

1085 
i
=
°¨t
;i<
íd
;i++)

1087 
fﬁlowî
[
i
] = 
	`MAX16
(0, 
b™dLogE
[i]-follower[i]);

1090 
i
=
°¨t
;i<
íd
;i++)

1091 
fﬁlowî
[
i
] = 
	`MAX16
(fﬁlowî[i], 
suºound_dy«Œoc
[i]);

1092 
i
=
°¨t
;i<
íd
;i++)

1094 #ifde‡
FIXED_POINT


1095 
imp‹èn˚
[
i
] = 
	`PSHR32
(13*
	`˚…_exp2
(
	`MIN16
(
fﬁlowî
[i], 
	`QCONST16
(4.f, 
DB_SHIFT
))), 16);

1097 
imp‹èn˚
[
i
] = ()
	`Êo‹
(.5f+13*
	`˚…_exp2
(
	`MIN16
(
fﬁlowî
[i], 
	`QCONST16
(4.f, 
DB_SHIFT
))));

1101 i‡((!
vbr
 || 
c⁄°øöed_vbr
)&&!
isTønsõ¡
)

1103 
i
=
°¨t
;i<
íd
;i++)

1104 
fﬁlowî
[
i
] = 
	`HALF16
(follower[i]);

1106 
i
=
°¨t
;i<
íd
;i++)

1108 i‡(
i
<8)

1109 
fﬁlowî
[
i
] *= 2;

1110 i‡(
i
>=12)

1111 
fﬁlowî
[
i
] = 
	`HALF16
(follower[i]);

1113 #ifde‡
DISABLE_FLOAT_API


1114 ()
™Æysis
;

1116 i‡(
™Æysis
->
vÆid
)

1118 
i
=
°¨t
;i<
	`IMIN
(
LEAK_BANDS
, 
íd
);i++)

1119 
fﬁlowî
[
i
] = fﬁlowî[i] + 
	`QCONST16
(1.f/64.f, 
DB_SHIFT
)*
™Æysis
->
Àak_boo°
[i];

1122 
i
=
°¨t
;i<
íd
;i++)

1124 
width
;

1125 
boo°
;

1126 
boo°_bôs
;

1128 
fﬁlowî
[
i
] = 
	`MIN16
(fﬁlowî[i], 
	`QCONST16
(4, 
DB_SHIFT
));

1130 
width
 = 
C
*(
eB™ds
[
i
+1]-eB™ds[i])<<
LM
;

1131 i‡(
width
<6)

1133 
boo°
 = ()
	`SHR32
(
	`EXTEND32
(
fﬁlowî
[
i
]),
DB_SHIFT
);

1134 
boo°_bôs
 = 
boo°
*
width
<<
BITRES
;

1135 } i‡(
width
 > 48) {

1136 
boo°
 = ()
	`SHR32
(
	`EXTEND32
(
fﬁlowî
[
i
])*8,
DB_SHIFT
);

1137 
boo°_bôs
 = (
boo°
*
width
<<
BITRES
)/8;

1139 
boo°
 = ()
	`SHR32
(
	`EXTEND32
(
fﬁlowî
[
i
])*
width
/6,
DB_SHIFT
);

1140 
boo°_bôs
 = 
boo°
*6<<
BITRES
;

1143 i‡((!
vbr
 || (
c⁄°øöed_vbr
&&!
isTønsõ¡
))

1144 && (
tŸ_boo°
+
boo°_bôs
)>>
BITRES
>>3 > 2*
ef„˘iveByãs
/3)

1146 
›us_öt32
 
ˇp
 = ((2*
ef„˘iveByãs
/3)<<
BITRES
<<3);

1147 
off£ts
[
i
] = 
ˇp
-
tŸ_boo°
;

1148 
tŸ_boo°
 = 
ˇp
;

1151 
off£ts
[
i
] = 
boo°
;

1152 
tŸ_boo°
 +
boo°_bôs
;

1156 
i
=
°¨t
;i<
íd
;i++)

1157 
imp‹èn˚
[
i
] = 13;

1159 *
tŸ_boo°_
 = 
tŸ_boo°
;

1160 
RESTORE_STACK
;

1161  
maxDïth
;

1162 
	}
}

1165 
	$run_¥efûãr
(
CELTEncodî
 *
°
, 
˚…_sig
 *
ö
, cñt_sig *
¥efûãr_mem
, 
CC
, 
N
,

1166 
¥efûãr_èp£t
, *
pôch
, 
›us_vÆ16
 *
gaö
, *
qgaö
, 
íabÀd
, 
nbAvaûabÀByãs
, 
A«lysisInfo
 *
™Æysis
)

1168 
c
;

1169 
	`VARDECL
(
˚…_sig
, 
_¥e
);

1170 
˚…_sig
 *
¥e
[2];

1171 c⁄° 
CELTMode
 *
mode
;

1172 
pôch_ödex
;

1173 
›us_vÆ16
 
gaö1
;

1174 
›us_vÆ16
 
pf_thªshﬁd
;

1175 
pf_⁄
;

1176 
qg
;

1177 
ovîœp
;

1178 
SAVE_STACK
;

1180 
mode
 = 
°
->mode;

1181 
ovîœp
 = 
mode
->overlap;

1182 
	`ALLOC
(
_¥e
, 
CC
*(
N
+
COMBFILTER_MAXPERIOD
), 
˚…_sig
);

1184 
¥e
[0] = 
_¥e
;

1185 
¥e
[1] = 
_¥e
 + (
N
+
COMBFILTER_MAXPERIOD
);

1188 
c
=0; do {

1189 
	`OPUS_COPY
(
¥e
[
c
], 
¥efûãr_mem
+c*
COMBFILTER_MAXPERIOD
, COMBFILTER_MAXPERIOD);

1190 
	`OPUS_COPY
(
¥e
[
c
]+
COMBFILTER_MAXPERIOD
, 
ö
+c*(
N
+
ovîœp
)+overlap, N);

1191 } ++
c
<
CC
);

1193 i‡(
íabÀd
)

1195 
	`VARDECL
(
›us_vÆ16
, 
pôch_buf
);

1196 
	`ALLOC
(
pôch_buf
, (
COMBFILTER_MAXPERIOD
+
N
)>>1, 
›us_vÆ16
);

1198 
	`pôch_downßm∂e
(
¥e
, 
pôch_buf
, 
COMBFILTER_MAXPERIOD
+
N
, 
CC
, 
°
->
¨ch
);

1201 
	`pôch_£¨ch
(
pôch_buf
+(
COMBFILTER_MAXPERIOD
>>1),Öôch_buf, 
N
,

1202 
COMBFILTER_MAXPERIOD
-3*
COMBFILTER_MINPERIOD
, &
pôch_ödex
,

1203 
°
->
¨ch
);

1204 
pôch_ödex
 = 
COMBFILTER_MAXPERIOD
-pitch_index;

1206 
gaö1
 = 
	`ªmove_doublög
(
pôch_buf
, 
COMBFILTER_MAXPERIOD
, 
COMBFILTER_MINPERIOD
,

1207 
N
, &
pôch_ödex
, 
°
->
¥efûãr_≥riod
, st->
¥efûãr_gaö
, st->
¨ch
);

1208 i‡(
pôch_ödex
 > 
COMBFILTER_MAXPERIOD
-2)

1209 
pôch_ödex
 = 
COMBFILTER_MAXPERIOD
-2;

1210 
gaö1
 = 
	`MULT16_16_Q15
(
	`QCONST16
(.7f,15),gain1);

1212 i‡(
°
->
loss_øã
>2)

1213 
gaö1
 = 
	`HALF32
(gain1);

1214 i‡(
°
->
loss_øã
>4)

1215 
gaö1
 = 
	`HALF32
(gain1);

1216 i‡(
°
->
loss_øã
>8)

1217 
gaö1
 = 0;

1219 
gaö1
 = 0;

1220 
pôch_ödex
 = 
COMBFILTER_MINPERIOD
;

1222 #i‚de‡
DISABLE_FLOAT_API


1223 i‡(
™Æysis
->
vÆid
)

1224 
gaö1
 = (
›us_vÆ16
)(gaö1 * 
™Æysis
->
max_pôch_øtio
);

1226 ()
™Æysis
;

1229 
pf_thªshﬁd
 = 
	`QCONST16
(.2f,15);

1232 i‡(
	`abs
(
pôch_ödex
-
°
->
¥efûãr_≥riod
)*10>pitch_index)

1233 
pf_thªshﬁd
 +
	`QCONST16
(.2f,15);

1234 i‡(
nbAvaûabÀByãs
<25)

1235 
pf_thªshﬁd
 +
	`QCONST16
(.1f,15);

1236 i‡(
nbAvaûabÀByãs
<35)

1237 
pf_thªshﬁd
 +
	`QCONST16
(.1f,15);

1238 i‡(
°
->
¥efûãr_gaö
 > 
	`QCONST16
(.4f,15))

1239 
pf_thªshﬁd
 -
	`QCONST16
(.1f,15);

1240 i‡(
°
->
¥efûãr_gaö
 > 
	`QCONST16
(.55f,15))

1241 
pf_thªshﬁd
 -
	`QCONST16
(.1f,15);

1244 
pf_thªshﬁd
 = 
	`MAX16
’f_thªshﬁd, 
	`QCONST16
(.2f,15));

1245 i‡(
gaö1
<
pf_thªshﬁd
)

1247 
gaö1
 = 0;

1248 
pf_⁄
 = 0;

1249 
qg
 = 0;

1253 i‡(
	`ABS16
(
gaö1
-
°
->
¥efûãr_gaö
)<
	`QCONST16
(.1f,15))

1254 
gaö1
=
°
->
¥efûãr_gaö
;

1256 #ifde‡
FIXED_POINT


1257 
qg
 = ((
gaö1
+1536)>>10)/3-1;

1259 
qg
 = ()
	`Êo‹
(.5f+
gaö1
*32/3)-1;

1261 
qg
 = 
	`IMAX
(0, 
	`IMIN
(7, qg));

1262 
gaö1
 = 
	`QCONST16
(0.09375f,15)*(
qg
+1);

1263 
pf_⁄
 = 1;

1267 
c
=0; do {

1268 
off£t
 = 
mode
->
sh‹tMd˘Size
-
ovîœp
;

1269 
°
->
¥efûãr_≥riod
=
	`IMAX
(°->¥efûãr_≥riod, 
COMBFILTER_MINPERIOD
);

1270 
	`OPUS_COPY
(
ö
+
c
*(
N
+
ovîœp
), 
°
->
ö_mem
+c*(overlap), overlap);

1271 i‡(
off£t
)

1272 
	`comb_fûãr
(
ö
+
c
*(
N
+
ovîœp
)+ovîœp, 
¥e
[c]+
COMBFILTER_MAXPERIOD
,

1273 
°
->
¥efûãr_≥riod
, st->¥efûãr_≥riod, 
off£t
, -°->
¥efûãr_gaö
, -st->prefilter_gain,

1274 
°
->
¥efûãr_èp£t
, st->¥efûãr_èp£t, 
NULL
, 0, st->
¨ch
);

1276 
	`comb_fûãr
(
ö
+
c
*(
N
+
ovîœp
)+ovîœp+
off£t
, 
¥e
[c]+
COMBFILTER_MAXPERIOD
+offset,

1277 
°
->
¥efûãr_≥riod
, 
pôch_ödex
, 
N
-
off£t
, -°->
¥efûãr_gaö
, -
gaö1
,

1278 
°
->
¥efûãr_èp£t
,Öªfûãr_èp£t, 
mode
->
wödow
, 
ovîœp
, st->
¨ch
);

1279 
	`OPUS_COPY
(
°
->
ö_mem
+
c
*(
ovîœp
), 
ö
+c*(
N
+overlap)+N, overlap);

1281 i‡(
N
>
COMBFILTER_MAXPERIOD
)

1283 
	`OPUS_COPY
(
¥efûãr_mem
+
c
*
COMBFILTER_MAXPERIOD
, 
¥e
[c]+
N
, COMBFILTER_MAXPERIOD);

1285 
	`OPUS_MOVE
(
¥efûãr_mem
+
c
*
COMBFILTER_MAXPERIOD
,Öªfûãr_mem+c*COMBFILTER_MAXPERIOD+
N
, COMBFILTER_MAXPERIOD-N);

1286 
	`OPUS_COPY
(
¥efûãr_mem
+
c
*
COMBFILTER_MAXPERIOD
+COMBFILTER_MAXPERIOD-
N
, 
¥e
[c]+COMBFILTER_MAXPERIOD, N);

1288 } ++
c
<
CC
);

1290 
RESTORE_STACK
;

1291 *
gaö
 = 
gaö1
;

1292 *
pôch
 = 
pôch_ödex
;

1293 *
qgaö
 = 
qg
;

1294  
pf_⁄
;

1295 
	}
}

1297 
	$compuã_vbr
(c⁄° 
CELTMode
 *
mode
, 
A«lysisInfo
 *
™Æysis
, 
›us_öt32
 
ba£_èrgë
,

1298 
LM
, 
›us_öt32
 
bôøã
, 
œ°CodedB™ds
, 
C
, 
öãnsôy
,

1299 
c⁄°øöed_vbr
, 
›us_vÆ16
 
°îeo_ßvög
, 
tŸ_boo°
,

1300 
›us_vÆ16
 
tf_e°im©e
, 
pôch_ch™ge
, opus_vÆ16 
maxDïth
,

1301 
l„
, 
has_suºound_mask
, 
›us_vÆ16
 
suºound_maskög
,

1302 
›us_vÆ16
 
ãmp‹Æ_vbr
)

1305 
›us_öt32
 
èrgë
;

1306 
coded_bös
;

1307 
coded_b™ds
;

1308 
›us_vÆ16
 
tf_ˇlibøti⁄
;

1309 
nbEB™ds
;

1310 c⁄° 
›us_öt16
 *
eB™ds
;

1312 
nbEB™ds
 = 
mode
->nbEBands;

1313 
eB™ds
 = 
mode
->eBands;

1315 
coded_b™ds
 = 
œ°CodedB™ds
 ?Üa°CodedB™d†: 
nbEB™ds
;

1316 
coded_bös
 = 
eB™ds
[
coded_b™ds
]<<
LM
;

1317 i‡(
C
==2)

1318 
coded_bös
 +
eB™ds
[
	`IMIN
(
öãnsôy
, 
coded_b™ds
)]<<
LM
;

1320 
èrgë
 = 
ba£_èrgë
;

1323 #i‚de‡
DISABLE_FLOAT_API


1324 i‡(
™Æysis
->
vÆid
 &&á«lysis->
a˘ivôy
<.4)

1325 
èrgë
 -(
›us_öt32
)((
coded_bös
<<
BITRES
)*(.4f-
™Æysis
->
a˘ivôy
));

1328 i‡(
C
==2)

1330 
coded_°îeo_b™ds
;

1331 
coded_°îeo_dof
;

1332 
›us_vÆ16
 
max_‰ac
;

1333 
coded_°îeo_b™ds
 = 
	`IMIN
(
öãnsôy
, 
coded_b™ds
);

1334 
coded_°îeo_dof
 = (
eB™ds
[
coded_°îeo_b™ds
]<<
LM
)-coded_stereo_bands;

1336 
max_‰ac
 = 
	`DIV32_16
(
	`MULT16_16
(
	`QCONST16
(0.8f, 15), 
coded_°îeo_dof
), 
coded_bös
);

1337 
°îeo_ßvög
 = 
	`MIN16
(°îeo_ßvög, 
	`QCONST16
(1.f, 8));

1339 
èrgë
 -(
›us_öt32
)
	`MIN32
(
	`MULT16_32_Q15
(
max_‰ac
,target),

1340 
	`SHR32
(
	`MULT16_16
(
°îeo_ßvög
-
	`QCONST16
(0.1f,8),(
coded_°îeo_dof
<<
BITRES
)),8));

1343 
èrgë
 +
tŸ_boo°
-(19<<
LM
);

1345 
tf_ˇlibøti⁄
 = 
	`QCONST16
(0.044f,14);

1346 
èrgë
 +(
›us_öt32
)
	`SHL32
(
	`MULT16_32_Q15
(
tf_e°im©e
-
tf_ˇlibøti⁄
,Åarget),1);

1348 #i‚de‡
DISABLE_FLOAT_API


1350 i‡(
™Æysis
->
vÆid
 && !
l„
)

1352 
›us_öt32
 
t⁄Æ_èrgë
;

1353 
t⁄Æ
;

1356 
t⁄Æ
 = 
	`MAX16
(0.f,
™Æysis
->
t⁄Æôy
-.15f)-0.12f;

1357 
t⁄Æ_èrgë
 = 
èrgë
 + (
›us_öt32
)((
coded_bös
<<
BITRES
)*1.2f*
t⁄Æ
);

1358 i‡(
pôch_ch™ge
)

1359 
t⁄Æ_èrgë
 +(
›us_öt32
)((
coded_bös
<<
BITRES
)*.8f);

1361 
èrgë
 = 
t⁄Æ_èrgë
;

1364 ()
™Æysis
;

1365 ()
pôch_ch™ge
;

1368 i‡(
has_suºound_mask
&&!
l„
)

1370 
›us_öt32
 
suºound_èrgë
 = 
èrgë
 + (›us_öt32)
	`SHR32
(
	`MULT16_16
(
suºound_maskög
,
coded_bös
<<
BITRES
), 
DB_SHIFT
);

1372 
èrgë
 = 
	`IMAX
—¨gë/4, 
suºound_èrgë
);

1376 
›us_öt32
 
Êo‹_dïth
;

1377 
bös
;

1378 
bös
 = 
eB™ds
[
nbEB™ds
-2]<<
LM
;

1380 
Êo‹_dïth
 = (
›us_öt32
)
	`SHR32
(
	`MULT16_16
((
C
*
bös
<<
BITRES
),
maxDïth
), 
DB_SHIFT
);

1381 
Êo‹_dïth
 = 
	`IMAX
(Êo‹_dïth, 
èrgë
>>2);

1382 
èrgë
 = 
	`IMIN
—¨gë, 
Êo‹_dïth
);

1388 i‡((!
has_suºound_mask
||
l„
Ë&& 
c⁄°øöed_vbr
)

1390 
èrgë
 = 
ba£_èrgë
 + (
›us_öt32
)
	`MULT16_32_Q15
(
	`QCONST16
(0.67f, 15),Åarget-base_target);

1393 i‡(!
has_suºound_mask
 && 
tf_e°im©e
 < 
	`QCONST16
(.2f, 14))

1395 
›us_vÆ16
 
amou¡
;

1396 
›us_vÆ16
 
tvbr_Á˘‹
;

1397 
amou¡
 = 
	`MULT16_16_Q15
(
	`QCONST16
(.0000031f, 30), 
	`IMAX
(0, 
	`IMIN
(32000, 96000-
bôøã
)));

1398 
tvbr_Á˘‹
 = 
	`SHR32
(
	`MULT16_16
(
ãmp‹Æ_vbr
, 
amou¡
), 
DB_SHIFT
);

1399 
èrgë
 +(
›us_öt32
)
	`MULT16_32_Q15
(
tvbr_Á˘‹
,Åarget);

1403 
èrgë
 = 
	`IMIN
(2*
ba£_èrgë
,Åarget);

1405  
èrgë
;

1406 
	}
}

1408 
	$˚…_ícode_wôh_ec
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° 
›us_vÆ16
 * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
, 
ec_íc
 *
íc
)

1410 
i
, 
c
, 
N
;

1411 
›us_öt32
 
bôs
;

1412 
ec_íc
 
_íc
;

1413 
	`VARDECL
(
˚…_sig
, 
ö
);

1414 
	`VARDECL
(
˚…_sig
, 
‰eq
);

1415 
	`VARDECL
(
˚…_n‹m
, 
X
);

1416 
	`VARDECL
(
˚…_íî
, 
b™dE
);

1417 
	`VARDECL
(
›us_vÆ16
, 
b™dLogE
);

1418 
	`VARDECL
(
›us_vÆ16
, 
b™dLogE2
);

1419 
	`VARDECL
(, 
föe_qu™t
);

1420 
	`VARDECL
(
›us_vÆ16
, 
îr‹
);

1421 
	`VARDECL
(, 
pul£s
);

1422 
	`VARDECL
(, 
ˇp
);

1423 
	`VARDECL
(, 
off£ts
);

1424 
	`VARDECL
(, 
imp‹èn˚
);

1425 
	`VARDECL
(, 
•ªad_weight
);

1426 
	`VARDECL
(, 
föe_¥i‹ôy
);

1427 
	`VARDECL
(, 
tf_ªs
);

1428 
	`VARDECL
(, 
cﬁœp£_masks
);

1429 
˚…_sig
 *
¥efûãr_mem
;

1430 
›us_vÆ16
 *
ﬁdB™dE
, *
ﬁdLogE
, *
ﬁdLogE2
, *
íîgyEº‹
;

1431 
sh‹tBlocks
=0;

1432 
isTønsõ¡
=0;

1433 c⁄° 
CC
 = 
°
->
ch™√ls
;

1434 c⁄° 
C
 = 
°
->
°ªam_ch™√ls
;

1435 
LM
, 
M
;

1436 
tf_£À˘
;

1437 
nbFûÀdByãs
, 
nbAvaûabÀByãs
;

1438 
°¨t
;

1439 
íd
;

1440 
effEnd
;

1441 
codedB™ds
;

1442 
Æloc_åim
;

1443 
pôch_ödex
=
COMBFILTER_MINPERIOD
;

1444 
›us_vÆ16
 
gaö1
 = 0;

1445 
duÆ_°îeo
=0;

1446 
ef„˘iveByãs
;

1447 
dy«Œoc_logp
;

1448 
›us_öt32
 
vbr_øã
;

1449 
›us_öt32
 
tŸÆ_bôs
;

1450 
›us_öt32
 
tŸÆ_boo°
;

1451 
›us_öt32
 
bÆ™˚
;

1452 
›us_öt32
 
ãŒ
;

1453 
›us_öt32
 
ãŒ0_‰ac
;

1454 
¥efûãr_èp£t
=0;

1455 
pf_⁄
;

1456 
™ti_cﬁœp£_rsv
;

1457 
™ti_cﬁœp£_⁄
=0;

1458 
sûí˚
=0;

1459 
tf_ch™
 = 0;

1460 
›us_vÆ16
 
tf_e°im©e
;

1461 
pôch_ch™ge
=0;

1462 
›us_öt32
 
tŸ_boo°
;

1463 
›us_vÆ32
 
ßm∂e_max
;

1464 
›us_vÆ16
 
maxDïth
;

1465 c⁄° 
OpusCu°omMode
 *
mode
;

1466 
nbEB™ds
;

1467 
ovîœp
;

1468 c⁄° 
›us_öt16
 *
eB™ds
;

1469 
£c⁄dMd˘
;

1470 
sig«lB™dwidth
;

1471 
å™sõ¡_gŸ_dißbÀd
=0;

1472 
›us_vÆ16
 
suºound_maskög
=0;

1473 
›us_vÆ16
 
ãmp‹Æ_vbr
=0;

1474 
›us_vÆ16
 
suºound_åim
 = 0;

1475 
›us_öt32
 
equiv_øã
;

1476 
hybrid
;

1477 
wók_å™sõ¡
 = 0;

1478 
íabÀ_tf_™Æysis
;

1479 
	`VARDECL
(
›us_vÆ16
, 
suºound_dy«Œoc
);

1480 
ALLOC_STACK
;

1482 
mode
 = 
°
->mode;

1483 
nbEB™ds
 = 
mode
->nbEBands;

1484 
ovîœp
 = 
mode
->overlap;

1485 
eB™ds
 = 
mode
->eBands;

1486 
°¨t
 = 
°
->start;

1487 
íd
 = 
°
->end;

1488 
hybrid
 = 
°¨t
 != 0;

1489 
tf_e°im©e
 = 0;

1490 i‡(
nbCom¥es£dByãs
<2 || 
pcm
==
NULL
)

1492 
RESTORE_STACK
;

1493  
OPUS_BAD_ARG
;

1496 
‰ame_size
 *
°
->
upßm∂e
;

1497 
LM
=0;LM<=
mode
->
maxLM
;LM++)

1498 i‡(
mode
->
sh‹tMd˘Size
<<
LM
==
‰ame_size
)

1500 i‡(
LM
>
mode
->
maxLM
)

1502 
RESTORE_STACK
;

1503  
OPUS_BAD_ARG
;

1505 
M
=1<<
LM
;

1506 
N
 = 
M
*
mode
->
sh‹tMd˘Size
;

1508 
¥efûãr_mem
 = 
°
->
ö_mem
+
CC
*(
ovîœp
);

1509 
ﬁdB™dE
 = (
›us_vÆ16
*)(
°
->
ö_mem
+
CC
*(
ovîœp
+
COMBFILTER_MAXPERIOD
));

1510 
ﬁdLogE
 = 
ﬁdB™dE
 + 
CC
*
nbEB™ds
;

1511 
ﬁdLogE2
 = 
ﬁdLogE
 + 
CC
*
nbEB™ds
;

1512 
íîgyEº‹
 = 
ﬁdLogE2
 + 
CC
*
nbEB™ds
;

1514 i‡(
íc
==
NULL
)

1516 
ãŒ0_‰ac
=
ãŒ
=1;

1517 
nbFûÀdByãs
=0;

1519 
ãŒ0_‰ac
=
	`ec_ãŒ_‰ac
(
íc
);

1520 
ãŒ
=
	`ec_ãŒ
(
íc
);

1521 
nbFûÀdByãs
=(
ãŒ
+4)>>3;

1524 #ifde‡
CUSTOM_MODES


1525 i‡(
°
->
sig«Œög
 && 
íc
==
NULL
)

1527 
tmp
 = (
mode
->
effEB™ds
-
íd
)>>1;

1528 
íd
 = 
°
->íd = 
	`IMAX
(1, 
mode
->
effEB™ds
-
tmp
);

1529 
com¥es£d
[0] = 
tmp
<<5;

1530 
com¥es£d
[0] |
LM
<<3;

1531 
com¥es£d
[0] |(
C
==2)<<2;

1533 i‡(
mode
->
Fs
==48000 && mode->
sh‹tMd˘Size
==120)

1535 
c0
 = 
	`toOpus
(
com¥es£d
[0]);

1536 i‡(
c0
<0)

1538 
RESTORE_STACK
;

1539  
OPUS_BAD_ARG
;

1541 
com¥es£d
[0] = 
c0
;

1543 
com¥es£d
++;

1544 
nbCom¥es£dByãs
--;

1547 
	`˚…_as£π
(
°
->
sig«Œög
==0);

1551 
nbCom¥es£dByãs
 = 
	`IMIN
(nbCompressedBytes,1275);

1552 
nbAvaûabÀByãs
 = 
nbCom¥es£dByãs
 - 
nbFûÀdByãs
;

1554 i‡(
°
->
vbr
 && st->
bôøã
!=
OPUS_BITRATE_MAX
)

1556 
›us_öt32
 
dí
=
mode
->
Fs
>>
BITRES
;

1557 
vbr_øã
=(
°
->
bôøã
*
‰ame_size
+(
dí
>>1))/den;

1558 #ifde‡
CUSTOM_MODES


1559 i‡(
°
->
sig«Œög
)

1560 
vbr_øã
 -8<<
BITRES
;

1562 
ef„˘iveByãs
 = 
vbr_øã
>>(3+
BITRES
);

1564 
›us_öt32
 
tmp
;

1565 
vbr_øã
 = 0;

1566 
tmp
 = 
°
->
bôøã
*
‰ame_size
;

1567 i‡(
ãŒ
>1)

1568 
tmp
 +
ãŒ
;

1569 i‡(
°
->
bôøã
!=
OPUS_BITRATE_MAX
)

1570 
nbCom¥es£dByãs
 = 
	`IMAX
(2, 
	`IMIN
(nbCompressedBytes,

1571 (
tmp
+4*
mode
->
Fs
)/(8*mode->Fs)-!!
°
->
sig«Œög
));

1572 
ef„˘iveByãs
 = 
nbCom¥es£dByãs
 - 
nbFûÀdByãs
;

1574 
equiv_øã
 = ((
›us_öt32
)
nbCom¥es£dByãs
*8*50 >> (3-
LM
)Ë- (40*
C
+20)*((400>>LM) - 50);

1575 i‡(
°
->
bôøã
 !
OPUS_BITRATE_MAX
)

1576 
equiv_øã
 = 
	`IMIN
”quiv_øã, 
°
->
bôøã
 - (40*
C
+20)*((400>>
LM
) - 50));

1578 i‡(
íc
==
NULL
)

1580 
	`ec_íc_öô
(&
_íc
, 
com¥es£d
, 
nbCom¥es£dByãs
);

1581 
íc
 = &
_íc
;

1584 i‡(
vbr_øã
>0)

1590 i‡(
°
->
c⁄°øöed_vbr
)

1592 
›us_öt32
 
vbr_bound
;

1593 
›us_öt32
 
max_Ælowed
;

1598 
vbr_bound
 = 
vbr_øã
;

1599 
max_Ælowed
 = 
	`IMIN
(
	`IMAX
(
ãŒ
==1?2:0,

1600 (
vbr_øã
+
vbr_bound
-
°
->
vbr_ª£rvoú
)>>(
BITRES
+3)),

1601 
nbAvaûabÀByãs
);

1602 if(
max_Ælowed
 < 
nbAvaûabÀByãs
)

1604 
nbCom¥es£dByãs
 = 
nbFûÀdByãs
+
max_Ælowed
;

1605 
nbAvaûabÀByãs
 = 
max_Ælowed
;

1606 
	`ec_íc_shrök
(
íc
, 
nbCom¥es£dByãs
);

1610 
tŸÆ_bôs
 = 
nbCom¥es£dByãs
*8;

1612 
effEnd
 = 
íd
;

1613 i‡(
effEnd
 > 
mode
->
effEB™ds
)

1614 
effEnd
 = 
mode
->
effEB™ds
;

1616 
	`ALLOC
(
ö
, 
CC
*(
N
+
ovîœp
), 
˚…_sig
);

1618 
ßm∂e_max
=
	`MAX32
(
°
->
ovîœp_max
, 
	`˚…_maxabs16
(
pcm
, 
C
*(
N
-
ovîœp
)/°->
upßm∂e
));

1619 
°
->
ovîœp_max
=
	`˚…_maxabs16
(
pcm
+
C
*(
N
-
ovîœp
)/°->
upßm∂e
, C*overlap/st->upsample);

1620 
ßm∂e_max
=
	`MAX32
(ßm∂e_max, 
°
->
ovîœp_max
);

1621 #ifde‡
FIXED_POINT


1622 
sûí˚
 = (
ßm∂e_max
==0);

1624 
sûí˚
 = (
ßm∂e_max
 <(
›us_vÆ16
)1/(1<<
°
->
lsb_dïth
));

1626 #ifde‡
FUZZING


1627 i‡((
	`ønd
()&0x3F)==0)

1628 
sûí˚
 = 1;

1630 i‡(
ãŒ
==1)

1631 
	`ec_íc_bô_logp
(
íc
, 
sûí˚
, 15);

1633 
sûí˚
=0;

1634 i‡(
sûí˚
)

1637 i‡(
vbr_øã
>0)

1639 
ef„˘iveByãs
=
nbCom¥es£dByãs
=
	`IMIN
“bCom¥es£dByãs, 
nbFûÀdByãs
+2);

1640 
tŸÆ_bôs
=
nbCom¥es£dByãs
*8;

1641 
nbAvaûabÀByãs
=2;

1642 
	`ec_íc_shrök
(
íc
, 
nbCom¥es£dByãs
);

1646 
ãŒ
 = 
nbCom¥es£dByãs
*8;

1647 
íc
->
nbôs_tŸÆ
+=
ãŒ
-
	`ec_ãŒ
(enc);

1649 
c
=0; do {

1650 
√ed_˛ù
=0;

1651 #i‚de‡
FIXED_POINT


1652 
√ed_˛ù
 = 
°
->
˛ù
 && 
ßm∂e_max
>65536.f;

1654 
	`˚…_¥ìmphasis
(
pcm
+
c
, 
ö
+c*(
N
+
ovîœp
)+ovîœp, N, 
CC
, 
°
->
upßm∂e
,

1655 
mode
->
¥ìmph
, 
°
->
¥ìmph_memE
+
c
, 
√ed_˛ù
);

1656 } ++
c
<
CC
);

1662 
íabÀd
;

1663 
qg
;

1664 
íabÀd
 = ((
°
->
l„
&&
nbAvaûabÀByãs
>3Ë||ÇbAvaûabÀByãs>12*
C
Ë&& !
hybrid
 && !
sûí˚
 && !°->
dißbÀ_pf


1665 && 
°
->
com∂exôy
 >= 5;

1667 
¥efûãr_èp£t
 = 
°
->
èp£t_decisi⁄
;

1668 
pf_⁄
 = 
	`run_¥efûãr
(
°
, 
ö
, 
¥efûãr_mem
, 
CC
, 
N
, 
¥efûãr_èp£t
, &
pôch_ödex
, &
gaö1
, &
qg
, 
íabÀd
, 
nbAvaûabÀByãs
, &°->
™Æysis
);

1669 i‡((
gaö1
 > 
	`QCONST16
(.4f,15Ë|| 
°
->
¥efûãr_gaö
 > QCONST16(.4f,15)Ë&& (!°->
™Æysis
.
vÆid
 || st->™Æysis.
t⁄Æôy
 > .3)

1670 && (
pôch_ödex
 > 1.26*
°
->
¥efûãr_≥riod
 ||Öitch_index < .79*st->prefilter_period))

1671 
pôch_ch™ge
 = 1;

1672 i‡(
pf_⁄
==0)

1674 if(!
hybrid
 && 
ãŒ
+16<=
tŸÆ_bôs
)

1675 
	`ec_íc_bô_logp
(
íc
, 0, 1);

1679 
o˘ave
;

1680 
	`ec_íc_bô_logp
(
íc
, 1, 1);

1681 
pôch_ödex
 += 1;

1682 
o˘ave
 = 
	`EC_ILOG
(
pôch_ödex
)-5;

1683 
	`ec_íc_uöt
(
íc
, 
o˘ave
, 6);

1684 
	`ec_íc_bôs
(
íc
, 
pôch_ödex
-(16<<
o˘ave
), 4+octave);

1685 
pôch_ödex
 -= 1;

1686 
	`ec_íc_bôs
(
íc
, 
qg
, 3);

1687 
	`ec_íc_icdf
(
íc
, 
¥efûãr_èp£t
, 
èp£t_icdf
, 2);

1691 
isTønsõ¡
 = 0;

1692 
sh‹tBlocks
 = 0;

1693 i‡(
°
->
com∂exôy
 >1 && !°->
l„
)

1698 
Ælow_wók_å™sõ¡s
 = 
hybrid
 && 
ef„˘iveByãs
<15 && 
°
->
sûk_öfo
.
sig«lTy≥
 != 2;

1699 
isTønsõ¡
 = 
	`å™sõ¡_™Æysis
(
ö
, 
N
+
ovîœp
, 
CC
,

1700 &
tf_e°im©e
, &
tf_ch™
, 
Ælow_wók_å™sõ¡s
, &
wók_å™sõ¡
);

1702 i‡(
LM
>0 && 
	`ec_ãŒ
(
íc
)+3<=
tŸÆ_bôs
)

1704 i‡(
isTønsõ¡
)

1705 
sh‹tBlocks
 = 
M
;

1707 
isTønsõ¡
 = 0;

1708 
å™sõ¡_gŸ_dißbÀd
=1;

1711 
	`ALLOC
(
‰eq
, 
CC
*
N
, 
˚…_sig
);

1712 
	`ALLOC
(
b™dE
,
nbEB™ds
*
CC
, 
˚…_íî
);

1713 
	`ALLOC
(
b™dLogE
,
nbEB™ds
*
CC
, 
›us_vÆ16
);

1715 
£c⁄dMd˘
 = 
sh‹tBlocks
 && 
°
->
com∂exôy
>=8;

1716 
	`ALLOC
(
b™dLogE2
, 
C
*
nbEB™ds
, 
›us_vÆ16
);

1717 i‡(
£c⁄dMd˘
)

1719 
	`compuã_md˘s
(
mode
, 0, 
ö
, 
‰eq
, 
C
, 
CC
, 
LM
, 
°
->
upßm∂e
, st->
¨ch
);

1720 
	`compuã_b™d_íîgõs
(
mode
, 
‰eq
, 
b™dE
, 
effEnd
, 
C
, 
LM
, 
°
->
¨ch
);

1721 
	`amp2Log2
(
mode
, 
effEnd
, 
íd
, 
b™dE
, 
b™dLogE2
, 
C
);

1722 
i
=0;i<
C
*
nbEB™ds
;i++)

1723 
b™dLogE2
[
i
] +
	`HALF16
(
	`SHL16
(
LM
, 
DB_SHIFT
));

1726 
	`compuã_md˘s
(
mode
, 
sh‹tBlocks
, 
ö
, 
‰eq
, 
C
, 
CC
, 
LM
, 
°
->
upßm∂e
, st->
¨ch
);

1729 
	`˚…_as£π
(!
	`˚…_i¢™
(
‰eq
[0]Ë&& (
C
==1 || !˚…_i¢™(‰eq[
N
])));

1730 i‡(
CC
==2&&
C
==1)

1731 
tf_ch™
 = 0;

1732 
	`compuã_b™d_íîgõs
(
mode
, 
‰eq
, 
b™dE
, 
effEnd
, 
C
, 
LM
, 
°
->
¨ch
);

1734 i‡(
°
->
l„
)

1736 
i
=2;i<
íd
;i++)

1738 
b™dE
[
i
] = 
	`IMIN
(b™dE[i], 
	`MULT16_32_Q15
(
	`QCONST16
(1e-4f,15),bandE[0]));

1739 
b™dE
[
i
] = 
	`MAX32
(b™dE[i], 
EPSILON
);

1742 
	`amp2Log2
(
mode
, 
effEnd
, 
íd
, 
b™dE
, 
b™dLogE
, 
C
);

1744 
	`ALLOC
(
suºound_dy«Œoc
, 
C
*
nbEB™ds
, 
›us_vÆ16
);

1745 
	`OPUS_CLEAR
(
suºound_dy«Œoc
, 
íd
);

1747 i‡(!
hybrid
&&
°
->
íîgy_mask
&&!°->
l„
)

1749 
mask_íd
;

1750 
midb™d
;

1751 
cou¡_dy«Œoc
;

1752 
›us_vÆ32
 
mask_avg
=0;

1753 
›us_vÆ32
 
diff
=0;

1754 
cou¡
=0;

1755 
mask_íd
 = 
	`IMAX
(2,
°
->
œ°CodedB™ds
);

1756 
c
=0;c<
C
;c++)

1758 
i
=0;i<
mask_íd
;i++)

1760 
›us_vÆ16
 
mask
;

1761 
mask
 = 
	`MAX16
(
	`MIN16
(
°
->
íîgy_mask
[
nbEB™ds
*
c
+
i
],

1762 
	`QCONST16
(.25f, 
DB_SHIFT
)), -QCONST16(2.0f, DB_SHIFT));

1763 i‡(
mask
 > 0)

1764 
mask
 = 
	`HALF16
(mask);

1765 
mask_avg
 +
	`MULT16_16
(
mask
, 
eB™ds
[
i
+1]-eBands[i]);

1766 
cou¡
 +
eB™ds
[
i
+1]-eBands[i];

1767 
diff
 +
	`MULT16_16
(
mask
, 1+2*
i
-
mask_íd
);

1770 
	`˚…_as£π
(
cou¡
>0);

1771 
mask_avg
 = 
	`DIV32_16
(mask_avg,
cou¡
);

1772 
mask_avg
 +
	`QCONST16
(.2f, 
DB_SHIFT
);

1773 
diff
 = diff*6/(
C
*(
mask_íd
-1)*(mask_end+1)*mask_end);

1775 
diff
 = 
	`HALF32
(diff);

1776 
diff
 = 
	`MAX32
(
	`MIN32
(diff, 
	`QCONST32
(.031f, 
DB_SHIFT
)), -QCONST32(.031f, DB_SHIFT));

1778 
midb™d
=0;
eB™ds
[midb™d+1] <ÉB™ds[
mask_íd
]/2;midband++);

1779 
cou¡_dy«Œoc
=0;

1780 
i
=0;i<
mask_íd
;i++)

1782 
›us_vÆ32
 
lö
;

1783 
›us_vÆ16
 
unmask
;

1784 
lö
 = 
mask_avg
 + 
diff
*(
i
-
midb™d
);

1785 i‡(
C
==2)

1786 
unmask
 = 
	`MAX16
(
°
->
íîgy_mask
[
i
], st->íîgy_mask[
nbEB™ds
+i]);

1788 
unmask
 = 
°
->
íîgy_mask
[
i
];

1789 
unmask
 = 
	`MIN16
(unmask, 
	`QCONST16
(.0f, 
DB_SHIFT
));

1790 
unmask
 -
lö
;

1791 i‡(
unmask
 > 
	`QCONST16
(.25f, 
DB_SHIFT
))

1793 
suºound_dy«Œoc
[
i
] = 
unmask
 - 
	`QCONST16
(.25f, 
DB_SHIFT
);

1794 
cou¡_dy«Œoc
++;

1797 i‡(
cou¡_dy«Œoc
>=3)

1801 
mask_avg
 +
	`QCONST16
(.25f, 
DB_SHIFT
);

1802 i‡(
mask_avg
>0)

1806 
mask_avg
 = 0;

1807 
diff
 = 0;

1808 
	`OPUS_CLEAR
(
suºound_dy«Œoc
, 
mask_íd
);

1810 
i
=0;i<
mask_íd
;i++)

1811 
suºound_dy«Œoc
[
i
] = 
	`MAX16
(0, suºound_dy«Œoc[i]-
	`QCONST16
(.25f, 
DB_SHIFT
));

1814 
mask_avg
 +
	`QCONST16
(.2f, 
DB_SHIFT
);

1816 
suºound_åim
 = 64*
diff
;

1818 
suºound_maskög
 = 
mask_avg
;

1821 i‡(!
°
->
l„
)

1823 
›us_vÆ16
 
fﬁlow
=-
	`QCONST16
(10.0f,
DB_SHIFT
);

1824 
›us_vÆ32
 
‰ame_avg
=0;

1825 
›us_vÆ16
 
off£t
 = 
sh‹tBlocks
?
	`HALF16
(
	`SHL16
(
LM
, 
DB_SHIFT
)):0;

1826 
i
=
°¨t
;i<
íd
;i++)

1828 
fﬁlow
 = 
	`MAX16
(fﬁlow-
	`QCONST16
(1.f, 
DB_SHIFT
), 
b™dLogE
[
i
]-
off£t
);

1829 i‡(
C
==2)

1830 
fﬁlow
 = 
	`MAX16
(fﬁlow, 
b™dLogE
[
i
+
nbEB™ds
]-
off£t
);

1831 
‰ame_avg
 +
fﬁlow
;

1833 
‰ame_avg
 /(
íd
-
°¨t
);

1834 
ãmp‹Æ_vbr
 = 
	`SUB16
(
‰ame_avg
,
°
->
•ec_avg
);

1835 
ãmp‹Æ_vbr
 = 
	`MIN16
(
	`QCONST16
(3.f, 
DB_SHIFT
), 
	`MAX16
(-QCONST16(1.5f, DB_SHIFT),Åemporal_vbr));

1836 
°
->
•ec_avg
 +
	`MULT16_16_Q15
(
	`QCONST16
(.02f, 15), 
ãmp‹Æ_vbr
);

1842 i‡(!
£c⁄dMd˘
)

1844 
	`OPUS_COPY
(
b™dLogE2
, 
b™dLogE
, 
C
*
nbEB™ds
);

1849 i‡(
LM
>0 && 
	`ec_ãŒ
(
íc
)+3<=
tŸÆ_bôs
 && !
isTønsõ¡
 && 
°
->
com∂exôy
>=5 && !°->
l„
 && !
hybrid
)

1851 i‡(
	`∑tch_å™sõ¡_decisi⁄
(
b™dLogE
, 
ﬁdB™dE
, 
nbEB™ds
, 
°¨t
, 
íd
, 
C
))

1853 
isTønsõ¡
 = 1;

1854 
sh‹tBlocks
 = 
M
;

1855 
	`compuã_md˘s
(
mode
, 
sh‹tBlocks
, 
ö
, 
‰eq
, 
C
, 
CC
, 
LM
, 
°
->
upßm∂e
, st->
¨ch
);

1856 
	`compuã_b™d_íîgõs
(
mode
, 
‰eq
, 
b™dE
, 
effEnd
, 
C
, 
LM
, 
°
->
¨ch
);

1857 
	`amp2Log2
(
mode
, 
effEnd
, 
íd
, 
b™dE
, 
b™dLogE
, 
C
);

1859 
i
=0;i<
C
*
nbEB™ds
;i++)

1860 
b™dLogE2
[
i
] +
	`HALF16
(
	`SHL16
(
LM
, 
DB_SHIFT
));

1861 
tf_e°im©e
 = 
	`QCONST16
(.2f,14);

1865 i‡(
LM
>0 && 
	`ec_ãŒ
(
íc
)+3<=
tŸÆ_bôs
)

1866 
	`ec_íc_bô_logp
(
íc
, 
isTønsõ¡
, 3);

1868 
	`ALLOC
(
X
, 
C
*
N
, 
˚…_n‹m
);

1871 
	`n‹mÆi£_b™ds
(
mode
, 
‰eq
, 
X
, 
b™dE
, 
effEnd
, 
C
, 
M
);

1873 
íabÀ_tf_™Æysis
 = 
ef„˘iveByãs
>=15*
C
 && !
hybrid
 && 
°
->
com∂exôy
>=2 && !°->
l„
;

1875 
	`ALLOC
(
off£ts
, 
nbEB™ds
, );

1876 
	`ALLOC
(
imp‹èn˚
, 
nbEB™ds
, );

1877 
	`ALLOC
(
•ªad_weight
, 
nbEB™ds
, );

1879 
maxDïth
 = 
	`dy«Œoc_™Æysis
(
b™dLogE
, 
b™dLogE2
, 
nbEB™ds
, 
°¨t
, 
íd
, 
C
, 
off£ts
,

1880 
°
->
lsb_dïth
, 
mode
->
logN
, 
isTønsõ¡
, st->
vbr
, st->
c⁄°øöed_vbr
,

1881 
eB™ds
, 
LM
, 
ef„˘iveByãs
, &
tŸ_boo°
, 
°
->
l„
, 
suºound_dy«Œoc
, &°->
™Æysis
, 
imp‹èn˚
, 
•ªad_weight
);

1883 
	`ALLOC
(
tf_ªs
, 
nbEB™ds
, );

1885 i‡(
íabÀ_tf_™Æysis
)

1887 
œmbda
;

1888 
œmbda
 = 
	`IMAX
(80, 20480/
ef„˘iveByãs
 + 2);

1889 
tf_£À˘
 = 
	`tf_™Æysis
(
mode
, 
effEnd
, 
isTønsõ¡
, 
tf_ªs
, 
œmbda
, 
X
, 
N
, 
LM
, 
tf_e°im©e
, 
tf_ch™
, 
imp‹èn˚
);

1890 
i
=
effEnd
;i<
íd
;i++)

1891 
tf_ªs
[
i
] =Åf_ªs[
effEnd
-1];

1892 } i‡(
hybrid
 && 
wók_å™sõ¡
)

1897 
i
=0;i<
íd
;i++)

1898 
tf_ªs
[
i
] = 1;

1899 
tf_£À˘
=0;

1900 } i‡(
hybrid
 && 
ef„˘iveByãs
<15 && 
°
->
sûk_öfo
.
sig«lTy≥
 != 2)

1903 
i
=0;i<
íd
;i++)

1904 
tf_ªs
[
i
] = 0;

1905 
tf_£À˘
=
isTønsõ¡
;

1907 
i
=0;i<
íd
;i++)

1908 
tf_ªs
[
i
] = 
isTønsõ¡
;

1909 
tf_£À˘
=0;

1912 
	`ALLOC
(
îr‹
, 
C
*
nbEB™ds
, 
›us_vÆ16
);

1913 
c
=0;

1915 
i
=
°¨t
;i<
íd
;i++)

1920 i‡(
	`ABS32
(
	`SUB32
(
b™dLogE
[
i
+
c
*
nbEB™ds
], 
ﬁdB™dE
[i+c*nbEB™ds])Ë< 
	`QCONST16
(2.f, 
DB_SHIFT
))

1922 
b™dLogE
[
i
+
c
*
nbEB™ds
] -
	`MULT16_16_Q15
(
íîgyEº‹
[i+c*nbEB™ds], 
	`QCONST16
(0.25f, 15));

1925 } ++
c
 < 
C
);

1926 
	`qu™t_cﬂr£_íîgy
(
mode
, 
°¨t
, 
íd
, 
effEnd
, 
b™dLogE
,

1927 
ﬁdB™dE
, 
tŸÆ_bôs
, 
îr‹
, 
íc
,

1928 
C
, 
LM
, 
nbAvaûabÀByãs
, 
°
->
f‹˚_öåa
,

1929 &
°
->
dñayedI¡ø
, st->
com∂exôy
 >4, st->
loss_øã
, st->
l„
);

1931 
	`tf_ícode
(
°¨t
, 
íd
, 
isTønsõ¡
, 
tf_ªs
, 
LM
, 
tf_£À˘
, 
íc
);

1933 i‡(
	`ec_ãŒ
(
íc
)+4<=
tŸÆ_bôs
)

1935 i‡(
°
->
l„
)

1937 
°
->
èp£t_decisi⁄
 = 0;

1938 
°
->
•ªad_decisi⁄
 = 
SPREAD_NORMAL
;

1939 } i‡(
hybrid
)

1941 i‡(
°
->
com∂exôy
 == 0)

1942 
°
->
•ªad_decisi⁄
 = 
SPREAD_NONE
;

1943 i‡(
isTønsõ¡
)

1944 
°
->
•ªad_decisi⁄
 = 
SPREAD_NORMAL
;

1946 
°
->
•ªad_decisi⁄
 = 
SPREAD_AGGRESSIVE
;

1947 } i‡(
sh‹tBlocks
 || 
°
->
com∂exôy
 < 3 || 
nbAvaûabÀByãs
 < 10*
C
)

1949 i‡(
°
->
com∂exôy
 == 0)

1950 
°
->
•ªad_decisi⁄
 = 
SPREAD_NONE
;

1952 
°
->
•ªad_decisi⁄
 = 
SPREAD_NORMAL
;

1958 i‡(
°
->
™Æysis
.
vÆid
)

1960 c⁄° 
›us_vÆ16
 
•ªad_thªshﬁds
[3] = {-
	`QCONST16
(.6f, 15), -QCONST16(.2f, 15), -QCONST16(.07f, 15)};

1961 c⁄° 
›us_vÆ16
 
•ªad_hi°îesis
[3] = {
	`QCONST16
(.15f, 15), QCONST16(.07f, 15), QCONST16(.02f, 15)};

1962 c⁄° 
›us_vÆ16
 
èp£t_thªshﬁds
[2] = {
	`QCONST16
(.0f, 15), QCONST16(.15f, 15)};

1963 c⁄° 
›us_vÆ16
 
èp£t_hi°îesis
[2] = {
	`QCONST16
(.1f, 15), QCONST16(.05f, 15)};

1964 
°
->
•ªad_decisi⁄
 = 
	`hy°îesis_decisi⁄
(-°->
™Æysis
.
t⁄Æôy
, 
•ªad_thªshﬁds
, 
•ªad_hi°îesis
, 3, st->spread_decision);

1965 
°
->
èp£t_decisi⁄
 = 
	`hy°îesis_decisi⁄
(°->
™Æysis
.
t⁄Æôy_¶›e
, 
èp£t_thªshﬁds
, 
èp£t_hi°îesis
, 2, st->tapset_decision);

1969 
°
->
•ªad_decisi⁄
 = 
	`•ªadög_decisi⁄
(
mode
, 
X
,

1970 &
°
->
t⁄Æ_avîage
, st->
•ªad_decisi⁄
, &°->
hf_avîage
,

1971 &
°
->
èp£t_decisi⁄
, 
pf_⁄
&&!
sh‹tBlocks
, 
effEnd
, 
C
, 
M
, 
•ªad_weight
);

1976 
	`ec_íc_icdf
(
íc
, 
°
->
•ªad_decisi⁄
, 
•ªad_icdf
, 5);

1980 i‡(
°
->
l„
)

1981 
off£ts
[0] = 
	`IMIN
(8, 
ef„˘iveByãs
/3);

1982 
	`ALLOC
(
ˇp
, 
nbEB™ds
, );

1983 
	`öô_ˇps
(
mode
,
ˇp
,
LM
,
C
);

1985 
dy«Œoc_logp
 = 6;

1986 
tŸÆ_bôs
<<=
BITRES
;

1987 
tŸÆ_boo°
 = 0;

1988 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
íc
);

1989 
i
=
°¨t
;i<
íd
;i++)

1991 
width
, 
qu™è
;

1992 
dy«Œoc_lo›_logp
;

1993 
boo°
;

1994 
j
;

1995 
width
 = 
C
*(
eB™ds
[
i
+1]-eB™ds[i])<<
LM
;

1998 
qu™è
 = 
	`IMIN
(
width
<<
BITRES
, 
	`IMAX
(6<<BITRES, width));

1999 
dy«Œoc_lo›_logp
 = 
dy«Œoc_logp
;

2000 
boo°
 = 0;

2001 
j
 = 0; 
ãŒ
+(
dy«Œoc_lo›_logp
<<
BITRES
Ë< 
tŸÆ_bôs
-
tŸÆ_boo°


2002 && 
boo°
 < 
ˇp
[
i
]; 
j
++)

2004 
Êag
;

2005 
Êag
 = 
j
<
off£ts
[
i
];

2006 
	`ec_íc_bô_logp
(
íc
, 
Êag
, 
dy«Œoc_lo›_logp
);

2007 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
íc
);

2008 i‡(!
Êag
)

2010 
boo°
 +
qu™è
;

2011 
tŸÆ_boo°
 +
qu™è
;

2012 
dy«Œoc_lo›_logp
 = 1;

2015 i‡(
j
)

2016 
dy«Œoc_logp
 = 
	`IMAX
(2, dynalloc_logp-1);

2017 
off£ts
[
i
] = 
boo°
;

2020 i‡(
C
==2)

2022 c⁄° 
›us_vÆ16
 
öãnsôy_thªshﬁds
[21]=

2025 c⁄° 
›us_vÆ16
 
öãnsôy_hi°îesis
[21]=

2029 i‡(
LM
!=0)

2030 
duÆ_°îeo
 = 
	`°îeo_™Æysis
(
mode
, 
X
, 
LM
, 
N
);

2032 
°
->
öãnsôy
 = 
	`hy°îesis_decisi⁄
((
›us_vÆ16
)(
equiv_øã
/1000),

2033 
öãnsôy_thªshﬁds
, 
öãnsôy_hi°îesis
, 21, 
°
->
öãnsôy
);

2034 
°
->
öãnsôy
 = 
	`IMIN
(
íd
,
	`IMAX
(
°¨t
, st->intensity));

2037 
Æloc_åim
 = 5;

2038 i‡(
ãŒ
+(6<<
BITRES
Ë<
tŸÆ_bôs
 - 
tŸÆ_boo°
)

2040 i‡(
°¨t
 > 0 || 
°
->
l„
)

2042 
°
->
°îeo_ßvög
 = 0;

2043 
Æloc_åim
 = 5;

2045 
Æloc_åim
 = 
	`Æloc_åim_™Æysis
(
mode
, 
X
, 
b™dLogE
,

2046 
íd
, 
LM
, 
C
, 
N
, &
°
->
™Æysis
, &°->
°îeo_ßvög
, 
tf_e°im©e
,

2047 
°
->
öãnsôy
, 
suºound_åim
, 
equiv_øã
, st->
¨ch
);

2049 
	`ec_íc_icdf
(
íc
, 
Æloc_åim
, 
åim_icdf
, 7);

2050 
ãŒ
 = 
	`ec_ãŒ_‰ac
(
íc
);

2054 i‡(
vbr_øã
>0)

2056 
›us_vÆ16
 
Æpha
;

2057 
›us_öt32
 
dñè
;

2059 
›us_öt32
 
èrgë
, 
ba£_èrgë
;

2060 
›us_öt32
 
mö_Ælowed
;

2061 
lm_diff
 = 
mode
->
maxLM
 - 
LM
;

2065 
nbCom¥es£dByãs
 = 
	`IMIN
“bCom¥es£dByãs,1275>>(3-
LM
));

2066 i‡(!
hybrid
)

2068 
ba£_èrgë
 = 
vbr_øã
 - ((40*
C
+20)<<
BITRES
);

2070 
ba£_èrgë
 = 
	`IMAX
(0, 
vbr_øã
 - ((9*
C
+4)<<
BITRES
));

2073 i‡(
°
->
c⁄°øöed_vbr
)

2074 
ba£_èrgë
 +(
°
->
vbr_off£t
>>
lm_diff
);

2076 i‡(!
hybrid
)

2078 
èrgë
 = 
	`compuã_vbr
(
mode
, &
°
->
™Æysis
, 
ba£_èrgë
, 
LM
, 
equiv_øã
,

2079 
°
->
œ°CodedB™ds
, 
C
, st->
öãnsôy
, st->
c⁄°øöed_vbr
,

2080 
°
->
°îeo_ßvög
, 
tŸ_boo°
, 
tf_e°im©e
, 
pôch_ch™ge
, 
maxDïth
,

2081 
°
->
l„
, st->
íîgy_mask
!=
NULL
, 
suºound_maskög
,

2082 
ãmp‹Æ_vbr
);

2084 
èrgë
 = 
ba£_èrgë
;

2086 i‡(
°
->
sûk_öfo
.
off£t
 < 100Ë
èrgë
 +12 << 
BITRES
 >> (3-
LM
);

2087 i‡(
°
->
sûk_öfo
.
off£t
 > 100Ë
èrgë
 -18 << 
BITRES
 >> (3-
LM
);

2090 
èrgë
 +(
›us_öt32
)
	`MULT16_16_Q14
(
tf_e°im©e
-
	`QCONST16
(.25f,14), (50<<
BITRES
));

2093 i‡(
tf_e°im©e
 > 
	`QCONST16
(.7f,14))

2094 
èrgë
 = 
	`IMAX
—¨gë, 50<<
BITRES
);

2098 
èrgë
Ò¨gë+
ãŒ
;

2103 
mö_Ælowed
 = ((
ãŒ
+
tŸÆ_boo°
+(1<<(
BITRES
+3))-1)>>(BITRES+3)) + 2;

2107 i‡(
hybrid
)

2108 
mö_Ælowed
 = 
	`IMAX
(mö_Ælowed, (
ãŒ0_‰ac
+(37<<
BITRES
)+
tŸÆ_boo°
+(1<<(BITRES+3))-1)>>(BITRES+3));

2110 
nbAvaûabÀByãs
 = (
èrgë
+(1<<(
BITRES
+2)))>>(BITRES+3);

2111 
nbAvaûabÀByãs
 = 
	`IMAX
(
mö_Ælowed
,nbAvailableBytes);

2112 
nbAvaûabÀByãs
 = 
	`IMIN
(
nbCom¥es£dByãs
,nbAvailableBytes);

2115 
dñè
 = 
èrgë
 - 
vbr_øã
;

2117 
èrgë
=
nbAvaûabÀByãs
<<(
BITRES
+3);

2124 if(
sûí˚
)

2126 
nbAvaûabÀByãs
 = 2;

2127 
èrgë
 = 2*8<<
BITRES
;

2128 
dñè
 = 0;

2131 i‡(
°
->
vbr_cou¡
 < 970)

2133 
°
->
vbr_cou¡
++;

2134 
Æpha
 = 
	`˚…_r˝
(
	`SHL32
(
	`EXTEND32
(
°
->
vbr_cou¡
+20),16));

2136 
Æpha
 = 
	`QCONST16
(.001f,15);

2138 i‡(
°
->
c⁄°øöed_vbr
)

2139 
°
->
vbr_ª£rvoú
 +
èrgë
 - 
vbr_øã
;

2143 i‡(
°
->
c⁄°øöed_vbr
)

2145 
°
->
vbr_dri·
 +(
›us_öt32
)
	`MULT16_32_Q15
(
Æpha
,(
dñè
*(1<<
lm_diff
))-°->
vbr_off£t
-st->vbr_drift);

2146 
°
->
vbr_off£t
 = -°->
vbr_dri·
;

2150 i‡(
°
->
c⁄°øöed_vbr
 && st->
vbr_ª£rvoú
 < 0)

2153 
adju°
 = (-
°
->
vbr_ª£rvoú
)/(8<<
BITRES
);

2155 
nbAvaûabÀByãs
 +
sûí˚
?0:
adju°
;

2156 
°
->
vbr_ª£rvoú
 = 0;

2159 
nbCom¥es£dByãs
 = 
	`IMIN
“bCom¥es£dByãs,
nbAvaûabÀByãs
);

2162 
	`ec_íc_shrök
(
íc
, 
nbCom¥es£dByãs
);

2166 
	`ALLOC
(
föe_qu™t
, 
nbEB™ds
, );

2167 
	`ALLOC
(
pul£s
, 
nbEB™ds
, );

2168 
	`ALLOC
(
föe_¥i‹ôy
, 
nbEB™ds
, );

2171 
bôs
 = (((
›us_öt32
)
nbCom¥es£dByãs
*8)<<
BITRES
Ë- 
	`ec_ãŒ_‰ac
(
íc
) - 1;

2172 
™ti_cﬁœp£_rsv
 = 
isTønsõ¡
&&
LM
>=2&&
bôs
>=((LM+2)<<
BITRES
) ? (1<<BITRES) : 0;

2173 
bôs
 -
™ti_cﬁœp£_rsv
;

2174 
sig«lB™dwidth
 = 
íd
-1;

2175 #i‚de‡
DISABLE_FLOAT_API


2176 i‡(
°
->
™Æysis
.
vÆid
)

2178 
mö_b™dwidth
;

2179 i‡(
equiv_øã
 < (
›us_öt32
)32000*
C
)

2180 
mö_b™dwidth
 = 13;

2181 i‡(
equiv_øã
 < (
›us_öt32
)48000*
C
)

2182 
mö_b™dwidth
 = 16;

2183 i‡(
equiv_øã
 < (
›us_öt32
)60000*
C
)

2184 
mö_b™dwidth
 = 18;

2185 i‡(
equiv_øã
 < (
›us_öt32
)80000*
C
)

2186 
mö_b™dwidth
 = 19;

2188 
mö_b™dwidth
 = 20;

2189 
sig«lB™dwidth
 = 
	`IMAX
(
°
->
™Æysis
.
b™dwidth
, 
mö_b™dwidth
);

2192 i‡(
°
->
l„
)

2193 
sig«lB™dwidth
 = 1;

2194 
codedB™ds
 = 
	`˛t_compuã_Æloˇti⁄
(
mode
, 
°¨t
, 
íd
, 
off£ts
, 
ˇp
,

2195 
Æloc_åim
, &
°
->
öãnsôy
, &
duÆ_°îeo
, 
bôs
, &
bÆ™˚
, 
pul£s
,

2196 
föe_qu™t
, 
föe_¥i‹ôy
, 
C
, 
LM
, 
íc
, 1, 
°
->
œ°CodedB™ds
, 
sig«lB™dwidth
);

2197 i‡(
°
->
œ°CodedB™ds
)

2198 
°
->
œ°CodedB™ds
 = 
	`IMIN
(°->œ°CodedB™ds+1,
	`IMAX
(°->œ°CodedB™ds-1,
codedB™ds
));

2200 
°
->
œ°CodedB™ds
 = 
codedB™ds
;

2202 
	`qu™t_föe_íîgy
(
mode
, 
°¨t
, 
íd
, 
ﬁdB™dE
, 
îr‹
, 
föe_qu™t
, 
íc
, 
C
);

2205 
	`ALLOC
(
cﬁœp£_masks
, 
C
*
nbEB™ds
, );

2206 
	`qu™t_Æl_b™ds
(1, 
mode
, 
°¨t
, 
íd
, 
X
, 
C
==2 ? X+
N
 : 
NULL
, 
cﬁœp£_masks
,

2207 
b™dE
, 
pul£s
, 
sh‹tBlocks
, 
°
->
•ªad_decisi⁄
,

2208 
duÆ_°îeo
, 
°
->
öãnsôy
, 
tf_ªs
, 
nbCom¥es£dByãs
*(8<<
BITRES
)-
™ti_cﬁœp£_rsv
,

2209 
bÆ™˚
, 
íc
, 
LM
, 
codedB™ds
, &
°
->
∫g
, st->
com∂exôy
, st->
¨ch
, st->
dißbÀ_öv
);

2211 i‡(
™ti_cﬁœp£_rsv
 > 0)

2213 
™ti_cﬁœp£_⁄
 = 
°
->
c⁄£c_å™sõ¡
<2;

2214 #ifde‡
FUZZING


2215 
™ti_cﬁœp£_⁄
 = 
	`ønd
()&0x1;

2217 
	`ec_íc_bôs
(
íc
, 
™ti_cﬁœp£_⁄
, 1);

2219 
	`qu™t_íîgy_föÆi£
(
mode
, 
°¨t
, 
íd
, 
ﬁdB™dE
, 
îr‹
, 
föe_qu™t
, 
föe_¥i‹ôy
, 
nbCom¥es£dByãs
*8-
	`ec_ãŒ
(
íc
),Énc, 
C
);

2220 
	`OPUS_CLEAR
(
íîgyEº‹
, 
nbEB™ds
*
CC
);

2221 
c
=0;

2223 
i
=
°¨t
;i<
íd
;i++)

2225 
íîgyEº‹
[
i
+
c
*
nbEB™ds
] = 
	`MAX16
(-
	`QCONST16
(0.5f, 15), 
	`MIN16
(QCONST16(0.5f, 15), 
îr‹
[i+c*nbEBands]));

2227 } ++
c
 < 
C
);

2229 i‡(
sûí˚
)

2231 
i
=0;i<
C
*
nbEB™ds
;i++)

2232 
ﬁdB™dE
[
i
] = -
	`QCONST16
(28.f,
DB_SHIFT
);

2235 #ifde‡
RESYNTH


2238 
˚…_sig
 *
out_mem
[2];

2240 i‡(
™ti_cﬁœp£_⁄
)

2242 
	`™ti_cﬁœp£
(
mode
, 
X
, 
cﬁœp£_masks
, 
LM
, 
C
, 
N
,

2243 
°¨t
, 
íd
, 
ﬁdB™dE
, 
ﬁdLogE
, 
ﬁdLogE2
, 
pul£s
, 
°
->
∫g
);

2246 
c
=0; do {

2247 
	`OPUS_MOVE
(
°
->
syn_mem
[
c
], st->syn_mem[c]+
N
, 2*
MAX_PERIOD
-N+
ovîœp
/2);

2248 } ++
c
<
CC
);

2250 
c
=0; do {

2251 
out_mem
[
c
] = 
°
->
syn_mem
[c]+2*
MAX_PERIOD
-
N
;

2252 } ++
c
<
CC
);

2254 
	`˚…_sy¡hesis
(
mode
, 
X
, 
out_mem
, 
ﬁdB™dE
, 
°¨t
, 
effEnd
,

2255 
C
, 
CC
, 
isTønsõ¡
, 
LM
, 
°
->
upßm∂e
, 
sûí˚
, st->
¨ch
);

2257 
c
=0; do {

2258 
°
->
¥efûãr_≥riod
=
	`IMAX
(°->¥efûãr_≥riod, 
COMBFILTER_MINPERIOD
);

2259 
°
->
¥efûãr_≥riod_ﬁd
=
	`IMAX
(°->¥efûãr_≥riod_ﬁd, 
COMBFILTER_MINPERIOD
);

2260 
	`comb_fûãr
(
out_mem
[
c
], out_mem[c], 
°
->
¥efûãr_≥riod_ﬁd
, st->
¥efûãr_≥riod
, 
mode
->
sh‹tMd˘Size
,

2261 
°
->
¥efûãr_gaö_ﬁd
, st->
¥efûãr_gaö
, st->
¥efûãr_èp£t_ﬁd
, st->
¥efûãr_èp£t
,

2262 
mode
->
wödow
, 
ovîœp
);

2263 i‡(
LM
!=0)

2264 
	`comb_fûãr
(
out_mem
[
c
]+
mode
->
sh‹tMd˘Size
, out_mem[c]+mode->sh‹tMd˘Size, 
°
->
¥efûãr_≥riod
, 
pôch_ödex
, 
N
-mode->shortMdctSize,

2265 
°
->
¥efûãr_gaö
, 
gaö1
, st->
¥efûãr_èp£t
,Örefilter_tapset,

2266 
mode
->
wödow
, 
ovîœp
);

2267 } ++
c
<
CC
);

2270 
	`dìmphasis
(
out_mem
, (
›us_vÆ16
*)
pcm
, 
N
, 
CC
, 
°
->
upßm∂e
, 
mode
->
¥ìmph
, st->
¥ìmph_memD
);

2271 
°
->
¥efûãr_≥riod_ﬁd
 = st->
¥efûãr_≥riod
;

2272 
°
->
¥efûãr_gaö_ﬁd
 = st->
¥efûãr_gaö
;

2273 
°
->
¥efûãr_èp£t_ﬁd
 = st->
¥efûãr_èp£t
;

2277 
°
->
¥efûãr_≥riod
 = 
pôch_ödex
;

2278 
°
->
¥efûãr_gaö
 = 
gaö1
;

2279 
°
->
¥efûãr_èp£t
 =Örefilter_tapset;

2280 #ifde‡
RESYNTH


2281 i‡(
LM
!=0)

2283 
°
->
¥efûãr_≥riod_ﬁd
 = st->
¥efûãr_≥riod
;

2284 
°
->
¥efûãr_gaö_ﬁd
 = st->
¥efûãr_gaö
;

2285 
°
->
¥efûãr_èp£t_ﬁd
 = st->
¥efûãr_èp£t
;

2289 i‡(
CC
==2&&
C
==1) {

2290 
	`OPUS_COPY
(&
ﬁdB™dE
[
nbEB™ds
], oldBandE,ÇbEBands);

2293 i‡(!
isTønsõ¡
)

2295 
	`OPUS_COPY
(
ﬁdLogE2
, 
ﬁdLogE
, 
CC
*
nbEB™ds
);

2296 
	`OPUS_COPY
(
ﬁdLogE
, 
ﬁdB™dE
, 
CC
*
nbEB™ds
);

2298 
i
=0;i<
CC
*
nbEB™ds
;i++)

2299 
ﬁdLogE
[
i
] = 
	`MIN16
(ﬁdLogE[i], 
ﬁdB™dE
[i]);

2302 
c
=0; do

2304 
i
=0;i<
°¨t
;i++)

2306 
ﬁdB™dE
[
c
*
nbEB™ds
+
i
]=0;

2307 
ﬁdLogE
[
c
*
nbEB™ds
+
i
]=
ﬁdLogE2
[c*nbEB™ds+i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

2309 
i
=
íd
;i<
nbEB™ds
;i++)

2311 
ﬁdB™dE
[
c
*
nbEB™ds
+
i
]=0;

2312 
ﬁdLogE
[
c
*
nbEB™ds
+
i
]=
ﬁdLogE2
[c*nbEB™ds+i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

2314 } ++
c
<
CC
);

2316 i‡(
isTønsõ¡
 || 
å™sõ¡_gŸ_dißbÀd
)

2317 
°
->
c⁄£c_å™sõ¡
++;

2319 
°
->
c⁄£c_å™sõ¡
=0;

2320 
°
->
∫g
 = 
íc
->rng;

2324 
	`ec_íc_d⁄e
(
íc
);

2326 #ifde‡
CUSTOM_MODES


2327 i‡(
°
->
sig«Œög
)

2328 
nbCom¥es£dByãs
++;

2331 
RESTORE_STACK
;

2332 i‡(
	`ec_gë_îr‹
(
íc
))

2333  
OPUS_INTERNAL_ERROR
;

2335  
nbCom¥es£dByãs
;

2336 
	}
}

2339 #ifde‡
CUSTOM_MODES


2341 #ifde‡
FIXED_POINT


2342 
	$›us_cu°om_ícode
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° 
›us_öt16
 * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
)

2344  
	`˚…_ícode_wôh_ec
(
°
, 
pcm
, 
‰ame_size
, 
com¥es£d
, 
nbCom¥es£dByãs
, 
NULL
);

2345 
	}
}

2347 #i‚de‡
DISABLE_FLOAT_API


2348 
	$›us_cu°om_ícode_Êﬂt
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
)

2350 
j
, 
ªt
, 
C
, 
N
;

2351 
	`VARDECL
(
›us_öt16
, 
ö
);

2352 
ALLOC_STACK
;

2354 i‡(
pcm
==
NULL
)

2355  
OPUS_BAD_ARG
;

2357 
C
 = 
°
->
ch™√ls
;

2358 
N
 = 
‰ame_size
;

2359 
	`ALLOC
(
ö
, 
C
*
N
, 
›us_öt16
);

2361 
j
=0;j<
C
*
N
;j++)

2362 
ö
[
j
] = 
	`FLOAT2INT16
(
pcm
[j]);

2364 
ªt
=
	`˚…_ícode_wôh_ec
(
°
,
ö
,
‰ame_size
,
com¥es£d
,
nbCom¥es£dByãs
, 
NULL
);

2365 #ifde‡
RESYNTH


2366 
j
=0;j<
C
*
N
;j++)

2367 ((*)
pcm
)[
j
]=
ö
[j]*(1.f/32768.f);

2369 
RESTORE_STACK
;

2370  
ªt
;

2371 
	}
}

2375 
	$›us_cu°om_ícode
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° 
›us_öt16
 * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
)

2377 
j
, 
ªt
, 
C
, 
N
;

2378 
	`VARDECL
(
˚…_sig
, 
ö
);

2379 
ALLOC_STACK
;

2381 i‡(
pcm
==
NULL
)

2382  
OPUS_BAD_ARG
;

2384 
C
=
°
->
ch™√ls
;

2385 
N
=
‰ame_size
;

2386 
	`ALLOC
(
ö
, 
C
*
N
, 
˚…_sig
);

2387 
j
=0;j<
C
*
N
;j++) {

2388 
ö
[
j
] = 
	`SCALEOUT
(
pcm
[j]);

2391 
ªt
 = 
	`˚…_ícode_wôh_ec
(
°
,
ö
,
‰ame_size
,
com¥es£d
,
nbCom¥es£dByãs
, 
NULL
);

2392 #ifde‡
RESYNTH


2393 
j
=0;j<
C
*
N
;j++)

2394 ((
›us_öt16
*)
pcm
)[
j
] = 
	`FLOAT2INT16
(
ö
[j]);

2396 
RESTORE_STACK
;

2397  
ªt
;

2398 
	}
}

2400 
	$›us_cu°om_ícode_Êﬂt
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, c⁄° * 
pcm
, 
‰ame_size
, *
com¥es£d
, 
nbCom¥es£dByãs
)

2402  
	`˚…_ícode_wôh_ec
(
°
, 
pcm
, 
‰ame_size
, 
com¥es£d
, 
nbCom¥es£dByãs
, 
NULL
);

2403 
	}
}

2409 
	$›us_cu°om_ícodî_˘l
(
CELTEncodî
 * 
OPUS_RESTRICT
 
°
, 
ªque°
, ...)

2411 
va_li°
 
≠
;

2413 
	`va_°¨t
(
≠
, 
ªque°
);

2414 
ªque°
)

2416 
OPUS_SET_COMPLEXITY_REQUEST
:

2418 
vÆue
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

2419 i‡(
vÆue
<0 || value>10)

2420 
bad_¨g
;

2421 
°
->
com∂exôy
 = 
vÆue
;

2424 
CELT_SET_START_BAND_REQUEST
:

2426 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2427 i‡(
vÆue
<0 || vÆue>=
°
->
mode
->
nbEB™ds
)

2428 
bad_¨g
;

2429 
°
->
°¨t
 = 
vÆue
;

2432 
CELT_SET_END_BAND_REQUEST
:

2434 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2435 i‡(
vÆue
<1 || vÆue>
°
->
mode
->
nbEB™ds
)

2436 
bad_¨g
;

2437 
°
->
íd
 = 
vÆue
;

2440 
CELT_SET_PREDICTION_REQUEST
:

2442 
vÆue
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

2443 i‡(
vÆue
<0 || value>2)

2444 
bad_¨g
;

2445 
°
->
dißbÀ_pf
 = 
vÆue
<=1;

2446 
°
->
f‹˚_öåa
 = 
vÆue
==0;

2449 
OPUS_SET_PACKET_LOSS_PERC_REQUEST
:

2451 
vÆue
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

2452 i‡(
vÆue
<0 || value>100)

2453 
bad_¨g
;

2454 
°
->
loss_øã
 = 
vÆue
;

2457 
OPUS_SET_VBR_CONSTRAINT_REQUEST
:

2459 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2460 
°
->
c⁄°øöed_vbr
 = 
vÆue
;

2463 
OPUS_SET_VBR_REQUEST
:

2465 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2466 
°
->
vbr
 = 
vÆue
;

2469 
OPUS_SET_BITRATE_REQUEST
:

2471 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2472 i‡(
vÆue
<=500 && vÆue!=
OPUS_BITRATE_MAX
)

2473 
bad_¨g
;

2474 
vÆue
 = 
	`IMIN
(vÆue, 260000*
°
->
ch™√ls
);

2475 
°
->
bôøã
 = 
vÆue
;

2478 
CELT_SET_CHANNELS_REQUEST
:

2480 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2481 i‡(
vÆue
<1 || value>2)

2482 
bad_¨g
;

2483 
°
->
°ªam_ch™√ls
 = 
vÆue
;

2486 
OPUS_SET_LSB_DEPTH_REQUEST
:

2488 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2489 i‡(
vÆue
<8 || value>24)

2490 
bad_¨g
;

2491 
°
->
lsb_dïth
=
vÆue
;

2494 
OPUS_GET_LSB_DEPTH_REQUEST
:

2496 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2497 *
vÆue
=
°
->
lsb_dïth
;

2500 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

2502 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2503 if(
vÆue
<0 || value>1)

2505 
bad_¨g
;

2507 
°
->
dißbÀ_öv
 = 
vÆue
;

2510 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

2512 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2513 i‡(!
vÆue
)

2515 
bad_¨g
;

2517 *
vÆue
 = 
°
->
dißbÀ_öv
;

2520 
OPUS_RESET_STATE
:

2522 
i
;

2523 
›us_vÆ16
 *
ﬁdB™dE
, *
ﬁdLogE
, *
ﬁdLogE2
;

2524 
ﬁdB™dE
 = (
›us_vÆ16
*)(
°
->
ö_mem
+°->
ch™√ls
*(°->
mode
->
ovîœp
+
COMBFILTER_MAXPERIOD
));

2525 
ﬁdLogE
 = 
ﬁdB™dE
 + 
°
->
ch™√ls
*°->
mode
->
nbEB™ds
;

2526 
ﬁdLogE2
 = 
ﬁdLogE
 + 
°
->
ch™√ls
*°->
mode
->
nbEB™ds
;

2527 
	`OPUS_CLEAR
((*)&
°
->
ENCODER_RESET_START
,

2528 
	`›us_cu°om_ícodî_gë_size
(
°
->
mode
, st->
ch™√ls
)-

2529 ((*)&
°
->
ENCODER_RESET_START
 - (*)st));

2530 
i
=0;i<
°
->
ch™√ls
*°->
mode
->
nbEB™ds
;i++)

2531 
ﬁdLogE
[
i
]=
ﬁdLogE2
[i]=-
	`QCONST16
(28.f,
DB_SHIFT
);

2532 
°
->
vbr_off£t
 = 0;

2533 
°
->
dñayedI¡ø
 = 1;

2534 
°
->
•ªad_decisi⁄
 = 
SPREAD_NORMAL
;

2535 
°
->
t⁄Æ_avîage
 = 256;

2536 
°
->
hf_avîage
 = 0;

2537 
°
->
èp£t_decisi⁄
 = 0;

2540 #ifde‡
CUSTOM_MODES


2541 
CELT_SET_INPUT_CLIPPING_REQUEST
:

2543 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2544 
°
->
˛ù
 = 
vÆue
;

2548 
CELT_SET_SIGNALLING_REQUEST
:

2550 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2551 
°
->
sig«Œög
 = 
vÆue
;

2554 
CELT_SET_ANALYSIS_REQUEST
:

2556 
A«lysisInfo
 *
öfo
 = 
	`va_¨g
(
≠
, AnalysisInfo *);

2557 i‡(
öfo
)

2558 
	`OPUS_COPY
(&
°
->
™Æysis
, 
öfo
, 1);

2561 
CELT_SET_SILK_INFO_REQUEST
:

2563 
SILKInfo
 *
öfo
 = 
	`va_¨g
(
≠
, SILKInfo *);

2564 i‡(
öfo
)

2565 
	`OPUS_COPY
(&
°
->
sûk_öfo
, 
öfo
, 1);

2568 
CELT_GET_MODE_REQUEST
:

2570 c⁄° 
CELTMode
 ** 
vÆue
 = 
	`va_¨g
(
≠
, const CELTMode**);

2571 i‡(
vÆue
==0)

2572 
bad_¨g
;

2573 *
vÆue
=
°
->
mode
;

2576 
OPUS_GET_FINAL_RANGE_REQUEST
:

2578 
›us_uöt32
 * 
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32 *);

2579 i‡(
vÆue
==0)

2580 
bad_¨g
;

2581 *
vÆue
=
°
->
∫g
;

2584 
OPUS_SET_LFE_REQUEST
:

2586 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2587 
°
->
l„
 = 
vÆue
;

2590 
OPUS_SET_ENERGY_MASK_REQUEST
:

2592 
›us_vÆ16
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_val16*);

2593 
°
->
íîgy_mask
 = 
vÆue
;

2597 
bad_ªque°
;

2599 
	`va_íd
(
≠
);

2600  
OPUS_OK
;

2601 
bad_¨g
:

2602 
	`va_íd
(
≠
);

2603  
OPUS_BAD_ARG
;

2604 
bad_ªque°
:

2605 
	`va_íd
(
≠
);

2606  
OPUS_UNIMPLEMENTED
;

2607 
	}
}

	@celt/celt_lpc.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"˚…_Õc.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"m©h›s.h
"

35 
	~"pôch.h
"

37 
	$_˚…_Õc
(

38 
›us_vÆ16
 *
_Õc
,

39 c⁄° 
›us_vÆ32
 *
ac
,

40 
p


43 
i
, 
j
;

44 
›us_vÆ32
 
r
;

45 
›us_vÆ32
 
îr‹
 = 
ac
[0];

46 #ifde‡
FIXED_POINT


47 
›us_vÆ32
 
Õc
[
LPC_ORDER
];

49 *
Õc
 = 
_Õc
;

52 
	`OPUS_CLEAR
(
Õc
, 
p
);

53 i‡(
ac
[0] != 0)

55 
i
 = 0; i < 
p
; i++) {

57 
›us_vÆ32
 
º
 = 0;

58 
j
 = 0; j < 
i
; j++)

59 
º
 +
	`MULT32_32_Q31
(
Õc
[
j
],
ac
[
i
 - j]);

60 
º
 +
	`SHR32
(
ac
[
i
 + 1],3);

61 
r
 = -
	`‰ac_div32
(
	`SHL32
(
º
,3), 
îr‹
);

63 
Õc
[
i
] = 
	`SHR32
(
r
,3);

64 
j
 = 0; j < (
i
+1)>>1; j++)

66 
›us_vÆ32
 
tmp1
, 
tmp2
;

67 
tmp1
 = 
Õc
[
j
];

68 
tmp2
 = 
Õc
[
i
-1-
j
];

69 
Õc
[
j
] = 
tmp1
 + 
	`MULT32_32_Q31
(
r
,
tmp2
);

70 
Õc
[
i
-1-
j
] = 
tmp2
 + 
	`MULT32_32_Q31
(
r
,
tmp1
);

73 
îr‹
 =Éº‹ - 
	`MULT32_32_Q31
(MULT32_32_Q31(
r
,r),error);

75 #ifde‡
FIXED_POINT


76 i‡(
îr‹
<
	`SHR32
(
ac
[0],10))

79 i‡(
îr‹
<.001f*
ac
[0])

84 #ifde‡
FIXED_POINT


85 
i
=0;i<
p
;i++)

86 
_Õc
[
i
] = 
	`ROUND16
(
Õc
[i],16);

88 
	}
}

91 
	$˚…_fú_c
(

92 c⁄° 
›us_vÆ16
 *
x
,

93 c⁄° 
›us_vÆ16
 *
num
,

94 
›us_vÆ16
 *
y
,

95 
N
,

96 
‹d
,

97 
¨ch
)

99 
i
,
j
;

100 
	`VARDECL
(
›us_vÆ16
, 
∫um
);

101 
SAVE_STACK
;

102 
	`˚…_as£π
(
x
 !
y
);

103 
	`ALLOC
(
∫um
, 
‹d
, 
›us_vÆ16
);

104 
i
=0;i<
‹d
;i++)

105 
∫um
[
i
] = 
num
[
‹d
-i-1];

106 
i
=0;i<
N
-3;i+=4)

108 
›us_vÆ32
 
sum
[4];

109 
sum
[0] = 
	`SHL32
(
	`EXTEND32
(
x
[
i
 ]), 
SIG_SHIFT
);

110 
sum
[1] = 
	`SHL32
(
	`EXTEND32
(
x
[
i
+1]), 
SIG_SHIFT
);

111 
sum
[2] = 
	`SHL32
(
	`EXTEND32
(
x
[
i
+2]), 
SIG_SHIFT
);

112 
sum
[3] = 
	`SHL32
(
	`EXTEND32
(
x
[
i
+3]), 
SIG_SHIFT
);

113 
	`xc‹r_kî√l
(
∫um
, 
x
+
i
-
‹d
, 
sum
, ord, 
¨ch
);

114 
y
[
i
 ] = 
	`ROUND16
(
sum
[0], 
SIG_SHIFT
);

115 
y
[
i
+1] = 
	`ROUND16
(
sum
[1], 
SIG_SHIFT
);

116 
y
[
i
+2] = 
	`ROUND16
(
sum
[2], 
SIG_SHIFT
);

117 
y
[
i
+3] = 
	`ROUND16
(
sum
[3], 
SIG_SHIFT
);

119 ;
i
<
N
;i++)

121 
›us_vÆ32
 
sum
 = 
	`SHL32
(
	`EXTEND32
(
x
[
i
]), 
SIG_SHIFT
);

122 
j
=0;j<
‹d
;j++)

123 
sum
 = 
	`MAC16_16
(sum,
∫um
[
j
],
x
[
i
+j-
‹d
]);

124 
y
[
i
] = 
	`ROUND16
(
sum
, 
SIG_SHIFT
);

126 
RESTORE_STACK
;

127 
	}
}

129 
	$˚…_iú
(c⁄° 
›us_vÆ32
 *
_x
,

130 c⁄° 
›us_vÆ16
 *
dí
,

131 
›us_vÆ32
 *
_y
,

132 
N
,

133 
‹d
,

134 
›us_vÆ16
 *
mem
,

135 
¨ch
)

137 #ifde‡
SMALL_FOOTPRINT


138 
i
,
j
;

139 ()
¨ch
;

140 
i
=0;i<
N
;i++)

142 
›us_vÆ32
 
sum
 = 
_x
[
i
];

143 
j
=0;j<
‹d
;j++)

145 
sum
 -
	`MULT16_16
(
dí
[
j
],
mem
[j]);

147 
j
=
‹d
-1;j>=1;j--)

149 
mem
[
j
]=mem[j-1];

151 
mem
[0] = 
	`SROUND16
(
sum
, 
SIG_SHIFT
);

152 
_y
[
i
] = 
sum
;

155 
i
,
j
;

156 
	`VARDECL
(
›us_vÆ16
, 
rdí
);

157 
	`VARDECL
(
›us_vÆ16
, 
y
);

158 
SAVE_STACK
;

160 
	`˚…_as£π
((
‹d
&3)==0);

161 
	`ALLOC
(
rdí
, 
‹d
, 
›us_vÆ16
);

162 
	`ALLOC
(
y
, 
N
+
‹d
, 
›us_vÆ16
);

163 
i
=0;i<
‹d
;i++)

164 
rdí
[
i
] = 
dí
[
‹d
-i-1];

165 
i
=0;i<
‹d
;i++)

166 
y
[
i
] = -
mem
[
‹d
-i-1];

167 ;
i
<
N
+
‹d
;i++)

168 
y
[
i
]=0;

169 
i
=0;i<
N
-3;i+=4)

172 
›us_vÆ32
 
sum
[4];

173 
sum
[0]=
_x
[
i
];

174 
sum
[1]=
_x
[
i
+1];

175 
sum
[2]=
_x
[
i
+2];

176 
sum
[3]=
_x
[
i
+3];

177 
	`xc‹r_kî√l
(
rdí
, 
y
+
i
, 
sum
, 
‹d
, 
¨ch
);

180 
y
[
i
+
‹d
 ] = -
	`SROUND16
(
sum
[0],
SIG_SHIFT
);

181 
_y
[
i
 ] = 
sum
[0];

182 
sum
[1] = 
	`MAC16_16
(sum[1], 
y
[
i
+
‹d
 ], 
dí
[0]);

183 
y
[
i
+
‹d
+1] = -
	`SROUND16
(
sum
[1],
SIG_SHIFT
);

184 
_y
[
i
+1] = 
sum
[1];

185 
sum
[2] = 
	`MAC16_16
(sum[2], 
y
[
i
+
‹d
+1], 
dí
[0]);

186 
sum
[2] = 
	`MAC16_16
(sum[2], 
y
[
i
+
‹d
 ], 
dí
[1]);

187 
y
[
i
+
‹d
+2] = -
	`SROUND16
(
sum
[2],
SIG_SHIFT
);

188 
_y
[
i
+2] = 
sum
[2];

190 
sum
[3] = 
	`MAC16_16
(sum[3], 
y
[
i
+
‹d
+2], 
dí
[0]);

191 
sum
[3] = 
	`MAC16_16
(sum[3], 
y
[
i
+
‹d
+1], 
dí
[1]);

192 
sum
[3] = 
	`MAC16_16
(sum[3], 
y
[
i
+
‹d
 ], 
dí
[2]);

193 
y
[
i
+
‹d
+3] = -
	`SROUND16
(
sum
[3],
SIG_SHIFT
);

194 
_y
[
i
+3] = 
sum
[3];

196 ;
i
<
N
;i++)

198 
›us_vÆ32
 
sum
 = 
_x
[
i
];

199 
j
=0;j<
‹d
;j++)

200 
sum
 -
	`MULT16_16
(
rdí
[
j
],
y
[
i
+j]);

201 
y
[
i
+
‹d
] = 
	`SROUND16
(
sum
,
SIG_SHIFT
);

202 
_y
[
i
] = 
sum
;

204 
i
=0;i<
‹d
;i++)

205 
mem
[
i
] = 
_y
[
N
-i-1];

206 
RESTORE_STACK
;

208 
	}
}

210 
	$_˚…_autoc‹r
(

211 c⁄° 
›us_vÆ16
 *
x
,

212 
›us_vÆ32
 *
ac
,

213 c⁄° 
›us_vÆ16
 *
wödow
,

214 
ovîœp
,

215 
œg
,

216 
n
,

217 
¨ch


220 
›us_vÆ32
 
d
;

221 
i
, 
k
;

222 
Á°N
=
n
-
œg
;

223 
shi·
;

224 c⁄° 
›us_vÆ16
 *
x±r
;

225 
	`VARDECL
(
›us_vÆ16
, 
xx
);

226 
SAVE_STACK
;

227 
	`ALLOC
(
xx
, 
n
, 
›us_vÆ16
);

228 
	`˚…_as£π
(
n
>0);

229 
	`˚…_as£π
(
ovîœp
>=0);

230 i‡(
ovîœp
 == 0)

232 
x±r
 = 
x
;

234 
i
=0;i<
n
;i++)

235 
xx
[
i
] = 
x
[i];

236 
i
=0;i<
ovîœp
;i++)

238 
xx
[
i
] = 
	`MULT16_16_Q15
(
x
[i],
wödow
[i]);

239 
xx
[
n
-
i
-1] = 
	`MULT16_16_Q15
(
x
[n-i-1],
wödow
[i]);

241 
x±r
 = 
xx
;

243 
shi·
=0;

244 #ifde‡
FIXED_POINT


246 
›us_vÆ32
 
ac0
;

247 
ac0
 = 1+(
n
<<7);

248 i‡(
n
&1Ë
ac0
 +
	`SHR32
(
	`MULT16_16
(
x±r
[0],xptr[0]),9);

249 
i
=(
n
&1);i<n;i+=2)

251 
ac0
 +
	`SHR32
(
	`MULT16_16
(
x±r
[
i
],xptr[i]),9);

252 
ac0
 +
	`SHR32
(
	`MULT16_16
(
x±r
[
i
+1],xptr[i+1]),9);

255 
shi·
 = 
	`˚…_ûog2
(
ac0
)-30+10;

256 
shi·
 = (shift)/2;

257 i‡(
shi·
>0)

259 
i
=0;i<
n
;i++)

260 
xx
[
i
] = 
	`PSHR32
(
x±r
[i], 
shi·
);

261 
x±r
 = 
xx
;

263 
shi·
 = 0;

266 
	`˚…_pôch_xc‹r
(
x±r
, x±r, 
ac
, 
Á°N
, 
œg
+1, 
¨ch
);

267 
k
=0;k<=
œg
;k++)

269 
i
 = 
k
+
Á°N
, 
d
 = 0; i < 
n
; i++)

270 
d
 = 
	`MAC16_16
(d, 
x±r
[
i
], x±r[i-
k
]);

271 
ac
[
k
] +
d
;

273 #ifde‡
FIXED_POINT


274 
shi·
 = 2*shift;

275 i‡(
shi·
<=0)

276 
ac
[0] +
	`SHL32
((
›us_öt32
)1, -
shi·
);

277 i‡(
ac
[0] < 268435456)

279 
shi·2
 = 29 - 
	`EC_ILOG
(
ac
[0]);

280 
i
=0;i<=
œg
;i++)

281 
ac
[
i
] = 
	`SHL32
◊c[i], 
shi·2
);

282 
shi·
 -
shi·2
;

283 } i‡(
ac
[0] >= 536870912)

285 
shi·2
=1;

286 i‡(
ac
[0] >= 1073741824)

287 
shi·2
++;

288 
i
=0;i<=
œg
;i++)

289 
ac
[
i
] = 
	`SHR32
◊c[i], 
shi·2
);

290 
shi·
 +
shi·2
;

294 
RESTORE_STACK
;

295  
shi·
;

296 
	}
}

	@celt/celt_lpc.h

28 #i‚de‡
PLC_H


29 
	#PLC_H


	)

31 
	~"¨ch.h
"

32 
	~"˝u_suµ‹t.h
"

34 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

35 
	~"x86/˚…_Õc_s£.h
"

38 
	#LPC_ORDER
 24

	)

40 
_˚…_Õc
(
›us_vÆ16
 *
_Õc
, c⁄° 
›us_vÆ32
 *
ac
, 
p
);

42 
˚…_fú_c
(

43 c⁄° 
›us_vÆ16
 *
x
,

44 c⁄° 
›us_vÆ16
 *
num
,

45 
›us_vÆ16
 *
y
,

46 
N
,

47 
‹d
,

48 
¨ch
);

50 #i‡!
deföed
(
OVERRIDE_CELT_FIR
)

51 
	#˚…_fú
(
x
, 
num
, 
y
, 
N
, 
‹d
, 
¨ch
) \

52 (
	`˚…_fú_c
(
x
, 
num
, 
y
, 
N
, 
‹d
, 
¨ch
))

	)

55 
˚…_iú
(c⁄° 
›us_vÆ32
 *
x
,

56 c⁄° 
›us_vÆ16
 *
dí
,

57 
›us_vÆ32
 *
y
,

58 
N
,

59 
‹d
,

60 
›us_vÆ16
 *
mem
,

61 
¨ch
);

63 
_˚…_autoc‹r
(c⁄° 
›us_vÆ16
 *
x
, 
›us_vÆ32
 *
ac
,

64 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
œg
, 
n
, 
¨ch
);

	@celt/cpu_support.h

28 #i‚de‡
CPU_SUPPORT_H


29 
	#CPU_SUPPORT_H


	)

31 
	~"›us_ty≥s.h
"

32 
	~"›us_deföes.h
"

34 #i‡
deföed
(
OPUS_HAVE_RTCD
) && \

35 (
deföed
(
OPUS_ARM_ASM
Ë|| 
	$deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
))

36 
	~"¨m/¨m˝u.h
"

44 
	#OPUS_ARCHMASK
 3

	)

46 #ñi‡(
	`deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
OPUS_X86_PRESUME_SSE
)) || \

47 (
	`deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
OPUS_X86_PRESUME_SSE2
)) || \

48 (
	`deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& !deföed(
OPUS_X86_PRESUME_SSE4_1
)) || \

49 (
	`deföed
(
OPUS_X86_MAY_HAVE_AVX
Ë&& !
	$deföed
(
OPUS_X86_PRESUME_AVX
))

51 
	~"x86/x86˝u.h
"

59 
	#OPUS_ARCHMASK
 7

	)

60 
	`›us_£À˘_¨ch
();

63 
	#OPUS_ARCHMASK
 0

	)

65 
OPUS_INLINE
 
	$›us_£À˘_¨ch
()

68 
	}
}

	@celt/cwrs.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	~"os_suµ‹t.h
"

35 
	~"cwrs.h
"

36 
	~"m©h›s.h
"

37 
	~"¨ch.h
"

39 #ifde‡
CUSTOM_MODES


45 
	$log2_‰ac
(
›us_uöt32
 
vÆ
, 
‰ac
)

47 
l
;

48 
l
=
	`EC_ILOG
(
vÆ
);

49 if(
vÆ
&(val-1)){

53 if(
l
>16)
vÆ
=((val-1)>>(l-16))+1;

54 
vÆ
<<=16-
l
;

55 
l
=÷-1)<<
‰ac
;

59 
b
;

60 
b
=()(
vÆ
>>16);

61 
l
+=
b
<<
‰ac
;

62 
vÆ
=(vÆ+
b
)>>b;

63 
vÆ
=(val*val+0x7FFF)>>15;

65 
‰ac
-->0);

67  
l
+(
vÆ
>0x8000);

70  (
l
-1)<<
‰ac
;

71 
	}
}

193 #i‡!
deföed
(
SMALL_FOOTPRINT
)

196 
	#CELT_PVQ_U
(
_n
,
_k
Ë(
CELT_PVQ_U_ROW
[
	`IMIN
(_n,_k)][
	`IMAX
(_n,_k)])

	)

199 
	#CELT_PVQ_V
(
_n
,
_k
Ë(
	`CELT_PVQ_U
(_n,_k)+CELT_PVQ_U(_n,(_k)+1))

	)

210 #i‡
deföed
(
CUSTOM_MODES
)

211 c⁄° 
›us_uöt32
 
	gCELT_PVQ_U_DATA
[1488]={

213 c⁄° 
›us_uöt32
 
CELT_PVQ_U_DATA
[1272]={

223 #i‡
deföed
(
CUSTOM_MODES
)

236 #i‡
deföed
(
CUSTOM_MODES
)

253 #i‡
deföed
(
CUSTOM_MODES
)

275 #i‡
deföed
(
CUSTOM_MODES
)

302 #i‡
deföed
(
CUSTOM_MODES
)

334 #i‡
deföed
(
CUSTOM_MODES
)

356 #i‡
deföed
(
CUSTOM_MODES
)

370 #i‡
deföed
(
CUSTOM_MODES
)

380 #i‡
deföed
(
CUSTOM_MODES
)

388 #i‡
deföed
(
CUSTOM_MODES
)

399 #i‡
deföed
(
CUSTOM_MODES
)

412 #i‡
deföed
(
CUSTOM_MODES
)

413 c⁄° 
›us_uöt32
 *c⁄° 
	gCELT_PVQ_U_ROW
[15]={

414 
CELT_PVQ_U_DATA
+ 0,CELT_PVQ_U_DATA+ 208,CELT_PVQ_U_DATA+ 415,

415 
CELT_PVQ_U_DATA
+ 621,CELT_PVQ_U_DATA+ 826,CELT_PVQ_U_DATA+1030,

416 
CELT_PVQ_U_DATA
+1233,CELT_PVQ_U_DATA+1336,CELT_PVQ_U_DATA+1389,

417 
CELT_PVQ_U_DATA
+1421,CELT_PVQ_U_DATA+1441,CELT_PVQ_U_DATA+1455,

418 
CELT_PVQ_U_DATA
+1464,CELT_PVQ_U_DATA+1470,CELT_PVQ_U_DATA+1473

421 c⁄° 
›us_uöt32
 *c⁄° 
	gCELT_PVQ_U_ROW
[15]={

422 
CELT_PVQ_U_DATA
+ 0,CELT_PVQ_U_DATA+ 176,CELT_PVQ_U_DATA+ 351,

423 
CELT_PVQ_U_DATA
+ 525,CELT_PVQ_U_DATA+ 698,CELT_PVQ_U_DATA+ 870,

424 
CELT_PVQ_U_DATA
+1041,CELT_PVQ_U_DATA+1131,CELT_PVQ_U_DATA+1178,

425 
CELT_PVQ_U_DATA
+1207,CELT_PVQ_U_DATA+1226,CELT_PVQ_U_DATA+1240,

426 
CELT_PVQ_U_DATA
+1248,CELT_PVQ_U_DATA+1254,CELT_PVQ_U_DATA+1257

430 #i‡
deföed
(
CUSTOM_MODES
)

431 
	$gë_ªquúed_bôs
(
›us_öt16
 *
_bôs
,
_n
,
_maxk
,
_‰ac
){

432 
k
;

434 
	`˚…_as£π
(
_maxk
>0);

435 
_bôs
[0]=0;

436 
k
=1;k<=
_maxk
;k++)
_bôs
[k]=
	`log2_‰ac
(
	`CELT_PVQ_V
(
_n
,k),
_‰ac
);

437 
	}
}

440 
›us_uöt32
 
	$icwrs
(
_n
,c⁄° *
_y
){

441 
›us_uöt32
 
i
;

442 
j
;

443 
k
;

444 
	`˚…_as£π
(
_n
>=2);

445 
j
=
_n
-1;

446 
i
=
_y
[
j
]<0;

447 
k
=
	`abs
(
_y
[
j
]);

449 
j
--;

450 
i
+=
	`CELT_PVQ_U
(
_n
-
j
,
k
);

451 
k
+=
	`abs
(
_y
[
j
]);

452 if(
_y
[
j
]<0)
i
+=
	`CELT_PVQ_U
(
_n
-j,
k
+1);

454 
j
>0);

455  
i
;

456 
	}
}

458 
	$ícode_pul£s
(c⁄° *
_y
,
_n
,
_k
,
ec_íc
 *
_íc
){

459 
	`˚…_as£π
(
_k
>0);

460 
	`ec_íc_uöt
(
_íc
,
	`icwrs
(
_n
,
_y
),
	`CELT_PVQ_V
(_n,
_k
));

461 
	}
}

463 
›us_vÆ32
 
	$cwrsi
(
_n
,
_k
,
›us_uöt32
 
_i
,*
_y
){

464 
›us_uöt32
 
p
;

465 
s
;

466 
k0
;

467 
›us_öt16
 
vÆ
;

468 
›us_vÆ32
 
yy
=0;

469 
	`˚…_as£π
(
_k
>0);

470 
	`˚…_as£π
(
_n
>1);

471 
_n
>2){

472 
›us_uöt32
 
q
;

474 if(
_k
>=
_n
){

475 c⁄° 
›us_uöt32
 *
row
;

476 
row
=
CELT_PVQ_U_ROW
[
_n
];

478 
p
=
row
[
_k
+1];

479 
s
=-(
_i
>=
p
);

480 
_i
-=
p
&
s
;

482 
k0
=
_k
;

483 
q
=
row
[
_n
];

484 if(
q
>
_i
){

485 
	`˚…_sig_as£π
(
p
>
q
);

486 
_k
=
_n
;

487 dÿ
p
=
CELT_PVQ_U_ROW
[--
_k
][
_n
];

488 
p
>
_i
);

490 
p
=
row
[
_k
];p>
_i
;p=row[_k])_k--;

491 
_i
-=
p
;

492 
vÆ
=(
k0
-
_k
+
s
)^s;

493 *
_y
++=
vÆ
;

494 
yy
=
	`MAC16_16
(yy,
vÆ
,val);

499 
p
=
CELT_PVQ_U_ROW
[
_k
][
_n
];

500 
q
=
CELT_PVQ_U_ROW
[
_k
+1][
_n
];

501 if(
p
<=
_i
&&_i<
q
){

502 
_i
-=
p
;

503 *
_y
++=0;

507 
s
=-(
_i
>=
q
);

508 
_i
-=
q
&
s
;

510 
k0
=
_k
;

511 dÿ
p
=
CELT_PVQ_U_ROW
[--
_k
][
_n
];

512 
p
>
_i
);

513 
_i
-=
p
;

514 
vÆ
=(
k0
-
_k
+
s
)^s;

515 *
_y
++=
vÆ
;

516 
yy
=
	`MAC16_16
(yy,
vÆ
,val);

519 
_n
--;

522 
p
=2*
_k
+1;

523 
s
=-(
_i
>=
p
);

524 
_i
-=
p
&
s
;

525 
k0
=
_k
;

526 
_k
=(
_i
+1)>>1;

527 if(
_k
)
_i
-=2*_k-1;

528 
vÆ
=(
k0
-
_k
+
s
)^s;

529 *
_y
++=
vÆ
;

530 
yy
=
	`MAC16_16
(yy,
vÆ
,val);

532 
s
=-()
_i
;

533 
vÆ
=(
_k
+
s
)^s;

534 *
_y
=
vÆ
;

535 
yy
=
	`MAC16_16
(yy,
vÆ
,val);

536  
yy
;

537 
	}
}

539 
›us_vÆ32
 
	$decode_pul£s
(*
_y
,
_n
,
_k
,
ec_dec
 *
_dec
){

540  
	`cwrsi
(
_n
,
_k
,
	`ec_dec_uöt
(
_dec
,
	`CELT_PVQ_V
(_n,_k)),
_y
);

541 
	}
}

548 
OPUS_INLINE
 
	$u√xt
(
›us_uöt32
 *
_ui
,
_Àn
,›us_uöt32 
_ui0
){

549 
›us_uöt32
 
ui1
;

550 
j
;

553 
j
=1; do {

554 
ui1
=
	`UADD32
(UADD32(
_ui
[
j
],_ui[j-1]),
_ui0
);

555 
_ui
[
j
-1]=
_ui0
;

556 
_ui0
=
ui1
;

557 } ++
j
<
_Àn
);

558 
_ui
[
j
-1]=
_ui0
;

559 
	}
}

564 
OPUS_INLINE
 
	$u¥ev
(
›us_uöt32
 *
_ui
,
_n
,›us_uöt32 
_ui0
){

565 
›us_uöt32
 
ui1
;

566 
j
;

569 
j
=1; do {

570 
ui1
=
	`USUB32
(USUB32(
_ui
[
j
],_ui[j-1]),
_ui0
);

571 
_ui
[
j
-1]=
_ui0
;

572 
_ui0
=
ui1
;

573 } ++
j
<
_n
);

574 
_ui
[
j
-1]=
_ui0
;

575 
	}
}

579 
›us_uöt32
 
	$ncwrs_urow
(
_n
,
_k
,
›us_uöt32
 *
_u
){

580 
›us_uöt32
 
um2
;

581 
Àn
;

582 
k
;

583 
Àn
=
_k
+2;

585 
	`˚…_as£π
(
Àn
>=3);

586 
_u
[0]=0;

587 
_u
[1]=
um2
=1;

590 
	`˚…_as£π
(
_n
>=2);

592 
	`˚…_as£π
(
_k
>0);

593 
k
=2;

594 dÿ
_u
[
k
]=(k<<1)-1;

595 ++
k
<
Àn
);

596 
k
=2;k<
_n
;k++)
	`u√xt
(
_u
+1,
_k
+1,1);

597  
_u
[
_k
]+_u[_k+1];

598 
	}
}

605 
›us_vÆ32
 
	$cwrsi
(
_n
,
_k
,
›us_uöt32
 
_i
,*
_y
,›us_uöt32 *
_u
){

606 
j
;

607 
›us_öt16
 
vÆ
;

608 
›us_vÆ32
 
yy
=0;

609 
	`˚…_as£π
(
_n
>0);

610 
j
=0;

612 
›us_uöt32
 
p
;

613 
s
;

614 
yj
;

615 
p
=
_u
[
_k
+1];

616 
s
=-(
_i
>=
p
);

617 
_i
-=
p
&
s
;

618 
yj
=
_k
;

619 
p
=
_u
[
_k
];

620 
p
>
_i
Ì=
_u
[--
_k
];

621 
_i
-=
p
;

622 
yj
-=
_k
;

623 
vÆ
=(
yj
+
s
)^s;

624 
_y
[
j
]=
vÆ
;

625 
yy
=
	`MAC16_16
(yy,
vÆ
,val);

626 
	`u¥ev
(
_u
,
_k
+2,0);

628 ++
j
<
_n
);

629  
yy
;

630 
	}
}

636 
OPUS_INLINE
 
›us_uöt32
 
	$icwrs1
(c⁄° *
_y
,*
_k
){

637 *
_k
=
	`abs
(
_y
[0]);

638  
_y
[0]<0;

639 
	}
}

645 
OPUS_INLINE
 
›us_uöt32
 
	$icwrs
(
_n
,
_k
,
›us_uöt32
 *
_nc
,c⁄° *
_y
,

646 
›us_uöt32
 *
_u
){

647 
›us_uöt32
 
i
;

648 
j
;

649 
k
;

651 
	`˚…_as£π
(
_n
>=2);

652 
_u
[0]=0;

653 
k
=1;k<=
_k
+1;k++)
_u
[k]=(k<<1)-1;

654 
i
=
	`icwrs1
(
_y
+
_n
-1,&
k
);

655 
j
=
_n
-2;

656 
i
+=
_u
[
k
];

657 
k
+=
	`abs
(
_y
[
j
]);

658 if(
_y
[
j
]<0)
i
+=
_u
[
k
+1];

659 
j
-->0){

660 
	`u√xt
(
_u
,
_k
+2,0);

661 
i
+=
_u
[
k
];

662 
k
+=
	`abs
(
_y
[
j
]);

663 if(
_y
[
j
]<0)
i
+=
_u
[
k
+1];

665 *
_nc
=
_u
[
k
]+_u[k+1];

666  
i
;

667 
	}
}

669 #ifde‡
CUSTOM_MODES


670 
	$gë_ªquúed_bôs
(
›us_öt16
 *
_bôs
,
_n
,
_maxk
,
_‰ac
){

671 
k
;

673 
	`˚…_as£π
(
_maxk
>0);

674 
_bôs
[0]=0;

675 i‡(
_n
==1)

677 
k
=1;k<=
_maxk
;k++)

678 
_bôs
[
k
] = 1<<
_‰ac
;

681 
	`VARDECL
(
›us_uöt32
,
u
);

682 
SAVE_STACK
;

683 
	`ALLOC
(
u
,
_maxk
+2U,
›us_uöt32
);

684 
	`ncwrs_urow
(
_n
,
_maxk
,
u
);

685 
k
=1;k<=
_maxk
;k++)

686 
_bôs
[
k
]=
	`log2_‰ac
(
u
[k]+u[k+1],
_‰ac
);

687 
RESTORE_STACK
;

689 
	}
}

692 
	$ícode_pul£s
(c⁄° *
_y
,
_n
,
_k
,
ec_íc
 *
_íc
){

693 
›us_uöt32
 
i
;

694 
	`VARDECL
(
›us_uöt32
,
u
);

695 
›us_uöt32
 
nc
;

696 
SAVE_STACK
;

697 
	`˚…_as£π
(
_k
>0);

698 
	`ALLOC
(
u
,
_k
+2U,
›us_uöt32
);

699 
i
=
	`icwrs
(
_n
,
_k
,&
nc
,
_y
,
u
);

700 
	`ec_íc_uöt
(
_íc
,
i
,
nc
);

701 
RESTORE_STACK
;

702 
	}
}

704 
›us_vÆ32
 
	$decode_pul£s
(*
_y
,
_n
,
_k
,
ec_dec
 *
_dec
){

705 
	`VARDECL
(
›us_uöt32
,
u
);

706 
ªt
;

707 
SAVE_STACK
;

708 
	`˚…_as£π
(
_k
>0);

709 
	`ALLOC
(
u
,
_k
+2U,
›us_uöt32
);

710 
ªt
 = 
	`cwrsi
(
_n
,
_k
,
	`ec_dec_uöt
(
_dec
,
	`ncwrs_urow
(_n,_k,
u
)),
_y
,u);

711 
RESTORE_STACK
;

712  
ªt
;

713 
	}
}

	@celt/cwrs.h

30 #i‚de‡
CWRS_H


31 
	#CWRS_H


	)

33 
	~"¨ch.h
"

34 
	~"°ack_Æloc.h
"

35 
	~"íãnc.h
"

36 
	~"ítdec.h
"

38 #ifde‡
CUSTOM_MODES


39 
log2_‰ac
(
›us_uöt32
 
vÆ
, 
‰ac
);

42 
gë_ªquúed_bôs
(
›us_öt16
 *
bôs
, 
N
, 
K
, 
‰ac
);

44 
ícode_pul£s
(c⁄° *
_y
, 
N
, 
K
, 
ec_íc
 *
íc
);

46 
›us_vÆ32
 
decode_pul£s
(*
_y
, 
N
, 
K
, 
ec_dec
 *
dec
);

	@celt/dump_modes/dump_modes.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<°dlib.h
>

34 
	~<°dio.h
>

35 
	~"modes.h
"

36 
	~"˚….h
"

37 
	~"øã.h
"

38 
	~"dump_modes_¨ch.h
"

40 
	#INT16
 "%d"

	)

41 
	#INT32
 "%d"

	)

42 
	#FLOAT
 "%#0.8gf"

	)

44 #ifde‡
FIXED_POINT


45 
	#WORD16
 
INT16


	)

46 
	#WORD32
 
INT32


	)

48 
	#WORD16
 
FLOAT


	)

49 
	#WORD32
 
FLOAT


	)

52 
	$dump_modes
(
FILE
 *
fûe
, 
CELTMode
 **
modes
, 
nb_modes
)

54 
i
, 
j
, 
k
;

55 
md˘_twiddÀs_size
;

56 
	`Ârötf
(
fûe
, "/* The contents ofÅhis file wasáutomatically generated by dump_modes.c\n");

57 
	`Ârötf
(
fûe
, " withárguments:");

58 
i
=0;i<
nb_modes
;i++)

60 
CELTMode
 *
mode
 = 
modes
[
i
];

61 
	`Ârötf
(
fûe
, " %d %d",
mode
->
Fs
,mode->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
);

63 
	`Ârötf
(
fûe
, "\n It contains static definitions for someÖre-defined modes. */\n");

64 
	`Ârötf
(
fûe
, "#include \"modes.h\"\n");

65 
	`Ârötf
(
fûe
, "#include \"rate.h\"\n");

66 
	`Ârötf
(
fûe
, "\n#ifdef HAVE_ARM_NE10\n");

67 
	`Ârötf
(
fûe
, "#define OVERRIDE_FFT 1\n");

68 
	`Ârötf
(
fûe
, "#ö˛udê\"%s\"\n", 
ARM_NE10_ARCH_FILE_NAME
);

69 
	`Ârötf
(
fûe
, "#endif\n");

71 
	`Ârötf
(
fûe
, "\n");

73 
i
=0;i<
nb_modes
;i++)

75 
CELTMode
 *
mode
 = 
modes
[
i
];

76 
md˘Size
;

77 
°™d¨d
, 
‰amî©e
;

79 
md˘Size
 = 
mode
->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
;

80 
°™d¨d
 = (
mode
->
Fs
 =400*(
›us_öt32
)mode->
sh‹tMd˘Size
);

81 
‰amî©e
 = 
mode
->
Fs
/mode->
sh‹tMd˘Size
;

83 i‡(!
°™d¨d
)

85 
	`Ârötf
(
fûe
, "#i‚de‡DEF_EBANDS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

86 
	`Ârötf
(
fûe
, "#deföêDEF_EBANDS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

87 
	`Ârötf
 (
fûe
, "°©i¯c⁄° opus_öt16ÉB™ds%d_%d[%d] = {\n", 
mode
->
Fs
, 
md˘Size
, mode->
nbEB™ds
+2);

88 
j
=0;j<
mode
->
nbEB™ds
+2;j++)

89 
	`Ârötf
 (
fûe
, "%d, ", 
mode
->
eB™ds
[
j
]);

90 
	`Ârötf
 (
fûe
, "};\n");

91 
	`Ârötf
(
fûe
, "#endif\n");

92 
	`Ârötf
(
fûe
, "\n");

95 
	`Ârötf
(
fûe
, "#i‚de‡DEF_WINDOW%d\n", 
mode
->
ovîœp
);

96 
	`Ârötf
(
fûe
, "#deföêDEF_WINDOW%d\n", 
mode
->
ovîœp
);

97 
	`Ârötf
 (
fûe
, "°©i¯c⁄° opus_vÆ16 wödow%d[%d] = {\n", 
mode
->
ovîœp
, mode->overlap);

98 
j
=0;j<
mode
->
ovîœp
;j++)

99 
	`Ârötf
 (
fûe
, 
WORD16
 ",%c", 
mode
->
wödow
[
j
],(j+6)%5==0?'\n':' ');

100 
	`Ârötf
 (
fûe
, "};\n");

101 
	`Ârötf
(
fûe
, "#endif\n");

102 
	`Ârötf
(
fûe
, "\n");

104 i‡(!
°™d¨d
)

106 
	`Ârötf
(
fûe
, "#i‚de‡DEF_ALLOC_VECTORS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

107 
	`Ârötf
(
fûe
, "#deföêDEF_ALLOC_VECTORS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

108 
	`Ârötf
 (
fûe
, "°©i¯c⁄° unsig√d ch¨áŒocVe˘‹s%d_%d[%d] = {\n", 
mode
->
Fs
, 
md˘Size
, mode->
nbEB™ds
*mode->
nbAŒocVe˘‹s
);

109 
j
=0;j<
mode
->
nbAŒocVe˘‹s
;j++)

111 
k
=0;k<
mode
->
nbEB™ds
;k++)

112 
	`Ârötf
 (
fûe
, "%2d, ", 
mode
->
ÆlocVe˘‹s
[
j
*mode->
nbEB™ds
+
k
]);

113 
	`Ârötf
 (
fûe
, "\n");

115 
	`Ârötf
 (
fûe
, "};\n");

116 
	`Ârötf
(
fûe
, "#endif\n");

117 
	`Ârötf
(
fûe
, "\n");

120 
	`Ârötf
(
fûe
, "#i‚de‡DEF_LOGN%d\n", 
‰amî©e
);

121 
	`Ârötf
(
fûe
, "#deföêDEF_LOGN%d\n", 
‰amî©e
);

122 
	`Ârötf
 (
fûe
, "°©i¯c⁄° opus_öt16ÜogN%d[%d] = {\n", 
‰amî©e
, 
mode
->
nbEB™ds
);

123 
j
=0;j<
mode
->
nbEB™ds
;j++)

124 
	`Ârötf
 (
fûe
, "%d, ", 
mode
->
logN
[
j
]);

125 
	`Ârötf
 (
fûe
, "};\n");

126 
	`Ârötf
(
fûe
, "#endif\n");

127 
	`Ârötf
(
fûe
, "\n");

130 
	`Ârötf
(
fûe
, "#i‚de‡DEF_PULSE_CACHE%d\n", 
mode
->
Fs
/
md˘Size
);

131 
	`Ârötf
(
fûe
, "#deföêDEF_PULSE_CACHE%d\n", 
mode
->
Fs
/
md˘Size
);

132 
	`Ârötf
 (
fûe
, "°©i¯c⁄° opus_öt16 cache_ödex%d[%d] = {\n", 
mode
->
Fs
/
md˘Size
, (mode->
maxLM
+2)*mode->
nbEB™ds
);

133 
j
=0;j<
mode
->
nbEB™ds
*(mode->
maxLM
+2);j++)

134 
	`Ârötf
 (
fûe
, "%d,%c", 
mode
->
ˇche
.
ödex
[
j
],(j+16)%15==0?'\n':' ');

135 
	`Ârötf
 (
fûe
, "};\n");

136 
	`Ârötf
 (
fûe
, "°©i¯c⁄° unsig√d ch¨ cache_bôs%d[%d] = {\n", 
mode
->
Fs
/
md˘Size
, mode->
ˇche
.
size
);

137 
j
=0;j<
mode
->
ˇche
.
size
;j++)

138 
	`Ârötf
 (
fûe
, "%d,%c", 
mode
->
ˇche
.
bôs
[
j
],(j+16)%15==0?'\n':' ');

139 
	`Ârötf
 (
fûe
, "};\n");

140 
	`Ârötf
 (
fûe
, "°©i¯c⁄° unsig√d ch¨ cache_ˇps%d[%d] = {\n", 
mode
->
Fs
/
md˘Size
, (mode->
maxLM
+1)*2*mode->
nbEB™ds
);

141 
j
=0;j<(
mode
->
maxLM
+1)*2*mode->
nbEB™ds
;j++)

142 
	`Ârötf
 (
fûe
, "%d,%c", 
mode
->
ˇche
.
ˇps
[
j
],(j+16)%15==0?'\n':' ');

143 
	`Ârötf
 (
fûe
, "};\n");

145 
	`Ârötf
(
fûe
, "#endif\n");

146 
	`Ârötf
(
fûe
, "\n");

149 
	`Ârötf
(
fûe
, "#i‚de‡FFT_TWIDDLES%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

150 
	`Ârötf
(
fûe
, "#deföêFFT_TWIDDLES%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

151 
	`Ârötf
 (
fûe
, "static const kiss_twiddle_cpx fft_twiddles%d_%d[%d] = {\n",

152 
mode
->
Fs
, 
md˘Size
, mode->
md˘
.
kf·
[0]->
nf·
);

153 
j
=0;j<
mode
->
md˘
.
kf·
[0]->
nf·
;j++)

154 
	`Ârötf
 (
fûe
, "{" 
WORD16
 ", " WORD16 "},%c", 
mode
->
md˘
.
kf·
[0]->
twiddÀs
[
j
].
r
, mode->md˘.kf·[0]->twiddÀs[j].
i
,(j+3)%2==0?'\n':' ');

155 
	`Ârötf
 (
fûe
, "};\n");

157 #ifde‡
OVERRIDE_FFT


158 
	`dump_mode_¨ch
(
mode
);

161 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++)

163 
	`Ârötf
(
fûe
, "#i‚de‡FFT_BITREV%d\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

164 
	`Ârötf
(
fûe
, "#deföêFFT_BITREV%d\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

165 
	`Ârötf
 (
fûe
, "static const opus_int16 fft_bitrev%d[%d] = {\n",

166 
mode
->
md˘
.
kf·
[
k
]->
nf·
, mode->mdct.kfft[k]->nfft);

167 
j
=0;j<
mode
->
md˘
.
kf·
[
k
]->
nf·
;j++)

168 
	`Ârötf
 (
fûe
, "%d,%c", 
mode
->
md˘
.
kf·
[
k
]->
bôªv
[
j
],(j+16)%15==0?'\n':' ');

169 
	`Ârötf
 (
fûe
, "};\n");

171 
	`Ârötf
(
fûe
, "#endif\n");

172 
	`Ârötf
(
fûe
, "\n");

176 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++)

178 
	`Ârötf
(
fûe
, "#i‚de‡FFT_STATE%d_%d_%d\n", 
mode
->
Fs
, 
md˘Size
, 
k
);

179 
	`Ârötf
(
fûe
, "#deföêFFT_STATE%d_%d_%d\n", 
mode
->
Fs
, 
md˘Size
, 
k
);

180 
	`Ârötf
 (
fûe
, "static const kiss_fft_state fft_state%d_%d_%d = {\n",

181 
mode
->
Fs
, 
md˘Size
, 
k
);

182 
	`Ârötf
 (
fûe
, "%d, /*Çf· */\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

183 
	`Ârötf
 (
fûe
, 
WORD16
 ", /* sˇÀ */\n", 
mode
->
md˘
.
kf·
[
k
]->
sˇÀ
);

184 #ifde‡
FIXED_POINT


185 
	`Ârötf
 (
fûe
, "%d, /* sˇÀ_shi· */\n", 
mode
->
md˘
.
kf·
[
k
]->
sˇÀ_shi·
);

187 
	`Ârötf
 (
fûe
, "%d, /* shi· */\n", 
mode
->
md˘
.
kf·
[
k
]->
shi·
);

188 
	`Ârötf
 (
fûe
, "{");

189 
j
=0;j<2*
MAXFACTORS
;j++)

190 
	`Ârötf
 (
fûe
, "%d, ", 
mode
->
md˘
.
kf·
[
k
]->
Á˘‹s
[
j
]);

191 
	`Ârötf
 (
fûe
, "}, /* factors */\n");

192 
	`Ârötf
 (
fûe
, "f·_bôªv%d, /* bôªv */\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

193 
	`Ârötf
 (
fûe
, "f·_twiddÀs%d_%d, /* bôªv */\n", 
mode
->
Fs
, 
md˘Size
);

195 
	`Ârötf
 (
fûe
, "#ifdef OVERRIDE_FFT\n");

196 
	`Ârötf
 (
fûe
, "◊rch_f·_°©ê*)&cfg_¨ch_%d,\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

197 
	`Ârötf
 (
fûe
, "#else\n");

198 
	`Ârötf
 (
fûe
, "NULL,\n");

199 
	`Ârötf
(
fûe
, "#endif\n");

201 
	`Ârötf
 (
fûe
, "};\n");

203 
	`Ârötf
(
fûe
, "#endif\n");

204 
	`Ârötf
(
fûe
, "\n");

207 
	`Ârötf
(
fûe
, "#endif\n");

208 
	`Ârötf
(
fûe
, "\n");

211 
md˘_twiddÀs_size
 = 
mode
->
md˘
.
n
-(mode->md˘.n/2>>mode->md˘.
maxshi·
);

212 
	`Ârötf
(
fûe
, "#i‚de‡MDCT_TWIDDLES%d\n", 
md˘Size
);

213 
	`Ârötf
(
fûe
, "#deföêMDCT_TWIDDLES%d\n", 
md˘Size
);

214 
	`Ârötf
 (
fûe
, "static const opus_val16 mdct_twiddles%d[%d] = {\n",

215 
md˘Size
, 
md˘_twiddÀs_size
);

216 
j
=0;j<
md˘_twiddÀs_size
;j++)

217 
	`Ârötf
 (
fûe
, 
WORD16
 ",%c", 
mode
->
md˘
.
åig
[
j
],(j+6)%5==0?'\n':' ');

218 
	`Ârötf
 (
fûe
, "};\n");

220 
	`Ârötf
(
fûe
, "#endif\n");

221 
	`Ârötf
(
fûe
, "\n");

225 
	`Ârötf
(
fûe
, "°©i¯c⁄° CELTModêmode%d_%d_%d = {\n", 
mode
->
Fs
, 
md˘Size
, mode->
ovîœp
);

226 
	`Ârötf
(
fûe
, 
INT32
 ", /* F†*/\n", 
mode
->
Fs
);

227 
	`Ârötf
(
fûe
, "%d, /* ovîœ∞*/\n", 
mode
->
ovîœp
);

228 
	`Ârötf
(
fûe
, "%d, /*ÇbEB™d†*/\n", 
mode
->
nbEB™ds
);

229 
	`Ârötf
(
fûe
, "%d, /*ÉffEB™d†*/\n", 
mode
->
effEB™ds
);

230 
	`Ârötf
(
fûe
, "{");

231 
j
=0;j<4;j++)

232 
	`Ârötf
(
fûe
, 
WORD16
 ", ", 
mode
->
¥ìmph
[
j
]);

233 
	`Ârötf
(
fûe
, "}, /*Öreemph */\n");

234 i‡(
°™d¨d
)

235 
	`Ârötf
(
fûe
, "eband5ms, /*ÉBands */\n");

237 
	`Ârötf
(
fûe
, "eB™ds%d_%d, /*ÉB™d†*/\n", 
mode
->
Fs
, 
md˘Size
);

239 
	`Ârötf
(
fûe
, "%d, /* maxLM */\n", 
mode
->
maxLM
);

240 
	`Ârötf
(
fûe
, "%d, /*ÇbSh‹tMd˘†*/\n", 
mode
->
nbSh‹tMd˘s
);

241 
	`Ârötf
(
fûe
, "%d, /* sh‹tMd˘Sizê*/\n", 
mode
->
sh‹tMd˘Size
);

243 
	`Ârötf
(
fûe
, "%d, /*ÇbAŒocVe˘‹†*/\n", 
mode
->
nbAŒocVe˘‹s
);

244 i‡(
°™d¨d
)

245 
	`Ârötf
(
fûe
, "band_allocation, /*állocVectors */\n");

247 
	`Ârötf
(
fûe
, "ÆlocVe˘‹s%d_%d, /*áŒocVe˘‹†*/\n", 
mode
->
Fs
, 
md˘Size
);

249 
	`Ârötf
(
fûe
, "logN%d, /*ÜogN */\n", 
‰amî©e
);

250 
	`Ârötf
(
fûe
, "wödow%d, /* wödow */\n", 
mode
->
ovîœp
);

251 
	`Ârötf
(
fûe
, "{%d, %d, {", 
mode
->
md˘
.
n
, mode->md˘.
maxshi·
);

252 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++)

253 
	`Ârötf
(
fûe
, "&f·_°©e%d_%d_%d, ", 
mode
->
Fs
, 
md˘Size
, 
k
);

254 
	`Ârötf
 (
fûe
, "}, md˘_twiddÀs%d}, /* md˘ */\n", 
md˘Size
);

256 
	`Ârötf
(
fûe
, "{%d, cache_index%d, cache_bits%d, cache_caps%d}, /* cache */\n",

257 
mode
->
ˇche
.
size
, mode->
Fs
/
md˘Size
, mode->Fs/mdctSize, mode->Fs/mdctSize);

258 
	`Ârötf
(
fûe
, "};\n");

260 
	`Ârötf
(
fûe
, "\n");

261 
	`Ârötf
(
fûe
, "/* List ofállÅheávailable modes */\n");

262 
	`Ârötf
(
fûe
, "#deföêTOTAL_MODES %d\n", 
nb_modes
);

263 
	`Ârötf
(
fûe
, "static const CELTMode * const static_mode_list[TOTAL_MODES] = {\n");

264 
i
=0;i<
nb_modes
;i++)

266 
CELTMode
 *
mode
 = 
modes
[
i
];

267 
md˘Size
;

268 
md˘Size
 = 
mode
->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
;

269 
	`Ârötf
(
fûe
, "&mode%d_%d_%d,\n", 
mode
->
Fs
, 
md˘Size
, mode->
ovîœp
);

271 
	`Ârötf
(
fûe
, "};\n");

272 
	}
}

274 
	$dump_hódî
(
FILE
 *
fûe
, 
CELTMode
 **
modes
, 
nb_modes
)

276 
i
;

277 
ch™√ls
 = 0;

278 
‰ame_size
 = 0;

279 
ovîœp
 = 0;

280 
	`Ârötf
 (
fûe
, "/* This header file is generatedáutomatically*/\n");

281 
i
=0;i<
nb_modes
;i++)

283 
CELTMode
 *
mode
 = 
modes
[
i
];

284 i‡(
‰ame_size
==0)

285 
‰ame_size
 = 
mode
->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
;

286 i‡(
‰ame_size
 !
mode
->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
)

287 
‰ame_size
 = -1;

288 i‡(
ovîœp
==0)

289 
ovîœp
 = 
mode
->overlap;

290 i‡(
ovîœp
 !
mode
->overlap)

291 
ovîœp
 = -1;

293 i‡(
ch™√ls
>0)

295 
	`Ârötf
 (
fûe
, "#deföêCHANNELS(modeË%d\n", 
ch™√ls
);

296 i‡(
ch™√ls
==1)

297 
	`Ârötf
 (
fûe
, "#define DISABLE_STEREO\n");

299 i‡(
‰ame_size
>0)

301 
	`Ârötf
 (
fûe
, "#deföêFRAMESIZE(modeË%d\n", 
‰ame_size
);

303 i‡(
ovîœp
>0)

305 
	`Ârötf
 (
fûe
, "#deföêOVERLAP(modeË%d\n", 
ovîœp
);

307 
	}
}

309 #ifde‡
FIXED_POINT


310 
	#BASENAME
 "°©ic_modes_fixed"

	)

312 
	#BASENAME
 "°©ic_modes_Êﬂt"

	)

315 
	$maö
(
¨gc
, **
¨gv
)

317 
i
, 
nb
;

318 
FILE
 *
fûe
;

319 
CELTMode
 **
m
;

320 i‡(
¨gc
%2 != 1 ||árgc<3)

322 
	`Ârötf
 (
°dîr
, "Ußge: %†øã føme_sizê[øã føme_size] [øã føme_size]...\n",
¨gv
[0]);

325 
nb
 = (
¨gc
-1)/2;

326 
m
 = 
	`mÆloc
(
nb
*(
CELTMode
*));

327 
i
=0;i<
nb
;i++)

329 
Fs
, 
‰ame
;

330 
Fs
 = 
	`©oi
(
¨gv
[2*
i
+1]);

331 
‰ame
 = 
	`©oi
(
¨gv
[2*
i
+2]);

332 
m
[
i
] = 
	`›us_cu°om_mode_¸óã
(
Fs
, 
‰ame
, 
NULL
);

333 i‡(
m
[
i
]==
NULL
)

335 
	`Ârötf
(
°dîr
,"Error creating mode with Fs=%s, frame_size=%s\n",

336 
¨gv
[2*
i
+1],argv[2*i+2]);

337  
EXIT_FAILURE
;

340 
fûe
 = 
	`f›í
(
BASENAME
 ".h", "w");

341 #ifde‡
OVERRIDE_FFT


342 
	`dump_modes_¨ch_öô
(
m
, 
nb
);

344 
	`dump_modes
(
fûe
, 
m
, 
nb
);

345 
	`f˛o£
(
fûe
);

346 #ifde‡
OVERRIDE_FFT


347 
	`dump_modes_¨ch_föÆize
();

349 
i
=0;i<
nb
;i++)

350 
	`›us_cu°om_mode_de°roy
(
m
[
i
]);

351 
	`‰ì
(
m
);

353 
	}
}

	@celt/dump_modes/dump_modes_arch.h

28 #i‚de‡
DUMP_MODE_ARCH_H


29 
	#DUMP_MODE_ARCH_H


	)

31 
dump_modes_¨ch_öô
();

32 
dump_mode_¨ch
(
CELTMode
 *
mode
);

33 
dump_modes_¨ch_föÆize
();

35 #i‡!
deföed
(
FIXED_POINT
)

36 
	#ARM_NE10_ARCH_FILE_NAME
 "°©ic_modes_Êﬂt_¨m_√10.h"

	)

38 
	#ARM_NE10_ARCH_FILE_NAME
 "°©ic_modes_fixed_¨m_√10.h"

	)

41 #i‡
deföed
(
HAVE_ARM_NE10
)

42 
	#OVERRIDE_FFT
 (1)

	)

	@celt/dump_modes/dump_modes_arm_ne10.c

28 #i‡
deföed
(
HAVE_CONFIG_H
)

29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~"modes.h
"

35 
	~"dump_modes_¨ch.h
"

36 
	~<NE10_d•.h
>

38 #i‡!
deföed
(
FIXED_POINT
)

39 
	#NE10_FFT_CFG_TYPE_T
 
√10_f·_cfg_Êﬂt32_t


	)

40 
	#NE10_FFT_CPX_TYPE_T_STR
 "√10_f·_˝x_Êﬂt32_t"

	)

41 
	#NE10_FFT_STATE_TYPE_T_STR
 "√10_f·_°©e_Êﬂt32_t"

	)

43 
	#NE10_FFT_CFG_TYPE_T
 
√10_f·_cfg_öt32_t


	)

44 
	#NE10_FFT_CPX_TYPE_T_STR
 "√10_f·_˝x_öt32_t"

	)

45 
	#NE10_FFT_STATE_TYPE_T_STR
 "√10_f·_°©e_öt32_t"

	)

48 
FILE
 *
	gfûe
;

50 
	$dump_modes_¨ch_öô
(
CELTMode
 **
modes
, 
nb_modes
)

52 
i
;

54 
fûe
 = 
	`f›í
(
ARM_NE10_ARCH_FILE_NAME
, "w");

55 
	`Ârötf
(
fûe
, "/* The contents ofÅhis file wasáutomatically generated by\n");

56 
	`Ârötf
(
fûe
, " * dump_mode_arm_ne10.c withárguments:");

57 
i
=0;i<
nb_modes
;i++)

59 
CELTMode
 *
mode
 = 
modes
[
i
];

60 
	`Ârötf
(
fûe
, " %d %d",
mode
->
Fs
,mode->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
);

62 
	`Ârötf
(
fûe
, "\n * It contains static definitions for someÖre-defined modes. */\n");

63 
	`Ârötf
(
fûe
, "#include <NE10_types.h>\n\n");

64 
	}
}

66 
	$dump_modes_¨ch_föÆize
()

68 
	`f˛o£
(
fûe
);

69 
	}
}

71 
	$dump_mode_¨ch
(
CELTMode
 *
mode
)

73 
k
, 
j
;

74 
md˘Size
;

76 
md˘Size
 = 
mode
->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
;

78 
	`Ârötf
(
fûe
, "#i‚de‡NE10_FFT_PARAMS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

79 
	`Ârötf
(
fûe
, "#deföêNE10_FFT_PARAMS%d_%d\n", 
mode
->
Fs
, 
md˘Size
);

81 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++) {

82 
NE10_FFT_CFG_TYPE_T
 
cfg
;

83 
cfg
 = (
NE10_FFT_CFG_TYPE_T
)
mode
->
md˘
.
kf·
[
k
]->
¨ch_f·
->
¥iv
;

84 i‡(!
cfg
)

86 
	`Ârötf
(
fûe
, "static constÇe10_int32_tÇe10_factors_%d[%d] = {\n",

87 
mode
->
md˘
.
kf·
[
k
]->
nf·
, (
NE10_MAXFACTORS
 * 2));

88 
j
=0;j<(
NE10_MAXFACTORS
 * 2);j++) {

89 
	`Ârötf
(
fûe
, "%d,%c", 
cfg
->
Á˘‹s
[
j
],(j+16)%15==0?'\n':' ');

91 
	`Ârötf
 (
fûe
, "};\n");

95 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++) {

96 
NE10_FFT_CFG_TYPE_T
 
cfg
;

97 
cfg
 = (
NE10_FFT_CFG_TYPE_T
)
mode
->
md˘
.
kf·
[
k
]->
¨ch_f·
->
¥iv
;

98 i‡(!
cfg
)

100 
	`Ârötf
(
fûe
, "static const %sÇe10_twiddles_%d[%d] = {\n",

101 
NE10_FFT_CPX_TYPE_T_STR
, 
mode
->
md˘
.
kf·
[
k
]->
nf·
,

102 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

103 
j
=0;j<
mode
->
md˘
.
kf·
[
k
]->
nf·
;j++) {

104 #i‡!
	`deföed
(
FIXED_POINT
)

105 
	`Ârötf
(
fûe
, "{%#0.8gf,%#0.8gf},%c",

106 
cfg
->
twiddÀs
[
j
].
r
, cfg->twiddÀs[j].
i
,(j+4)%3==0?'\n':' ');

108 
	`Ârötf
(
fûe
, "{%d,%d},%c",

109 
cfg
->
twiddÀs
[
j
].
r
, cfg->twiddÀs[j].
i
,(j+4)%3==0?'\n':' ');

112 
	`Ârötf
 (
fûe
, "};\n");

115 
k
=0;k<=
mode
->
md˘
.
maxshi·
;k++) {

116 
NE10_FFT_CFG_TYPE_T
 
cfg
;

117 
cfg
 = (
NE10_FFT_CFG_TYPE_T
)
mode
->
md˘
.
kf·
[
k
]->
¨ch_f·
->
¥iv
;

118 i‡(!
cfg
) {

119 
	`Ârötf
(
fûe
, "/* Ne10 doesÇot support scaled FFT forÜength = %d */\n",

120 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

121 
	`Ârötf
(
fûe
, "°©i¯c⁄°árch_f·_°©êcfg_¨ch_%d = {\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

122 
	`Ârötf
(
fûe
, "0,\n");

123 
	`Ârötf
(
fûe
, "NULL\n");

124 
	`Ârötf
(
fûe
, "};\n");

127 
	`Ârötf
(
fûe
, "°©i¯c⁄° %†%s_%d = {\n", 
NE10_FFT_STATE_TYPE_T_STR
,

128 
NE10_FFT_STATE_TYPE_T_STR
, 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

129 
	`Ârötf
(
fûe
, "%d,\n", 
cfg
->
nf·
);

130 
	`Ârötf
(
fûe
, "“e10_öt32_à*Íe10_Á˘‹s_%d,\n", 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

131 
	`Ârötf
(
fûe
, "(%s *)ne10_twiddles_%d,\n",

132 
NE10_FFT_CPX_TYPE_T_STR
, 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

133 
	`Ârötf
(
fûe
, "NULL,\n");

134 
	`Ârötf
(
fûe
, "(%s *)&ne10_twiddles_%d[%d],\n",

135 
NE10_FFT_CPX_TYPE_T_STR
, 
mode
->
md˘
.
kf·
[
k
]->
nf·
, 
cfg
->nfft);

136 #i‡!
	`deföed
(
FIXED_POINT
)

137 
	`Ârötf
(
fûe
, "/* is_forward_scaled =Årue */\n");

138 
	`Ârötf
(
fûe
, "(ne10_int32_t) 1,\n");

139 
	`Ârötf
(
fûe
, "/* is_backward_scaled = false */\n");

140 
	`Ârötf
(
fûe
, "(ne10_int32_t) 0,\n");

142 
	`Ârötf
(
fûe
, "};\n");

144 
	`Ârötf
(
fûe
, "static constárch_fft_state cfg_arch_%d = {\n",

145 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

146 
	`Ârötf
(
fûe
, "1,\n");

147 
	`Ârötf
(
fûe
, "(void *)&%s_%d,\n",

148 
NE10_FFT_STATE_TYPE_T_STR
, 
mode
->
md˘
.
kf·
[
k
]->
nf·
);

149 
	`Ârötf
(
fûe
, "};\n\n");

151 
	`Ârötf
(
fûe
, "#ídi‡ /*Énd NE10_FFT_PARAMS%d_%d */\n", 
mode
->
Fs
, 
md˘Size
);

152 
	}
}

	@celt/ecintrin.h

29 
	~"›us_ty≥s.h
"

30 
	~<m©h.h
>

31 
	~<limôs.h
>

32 
	~"¨ch.h
"

33 #i‡!
deföed
(
_ecöåö_H
)

34 
	#_ecöåö_H
 (1)

	)

46 
	#EC_MINI
(
_a
,
_b
Ë((_a)+(((_b)-(_a))&-((_b)<(_a))))

	)

51 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER >= 1400)

52 
	~<öåö.h
>

54 #¥agm®
öåösic
(
_BôSˇnRevî£
)

56 
__ölöe
 
	$ec_b§
(
_x
){

57 
ªt
;

58 
	`_BôSˇnRevî£
(&
ªt
,
_x
);

59  ()
ªt
;

60 
	}
}

61 
	#EC_CLZ0
 (1)

	)

62 
	#EC_CLZ
(
_x
Ë(-
	`ec_b§
(_x))

	)

63 #ñi‡
deföed
(
ENABLE_TI_DSPLIB
)

64 
	~"d•lib.h
"

65 
	#EC_CLZ0
 (31)

	)

66 
	#EC_CLZ
(
_x
Ë(
	`_ ‹m
(_x))

	)

67 #ñi‡
__GNUC_PREREQ
(3,4)

68 #i‡
INT_MAX
>=2147483647

69 
	#EC_CLZ0
 (()()*
CHAR_BIT
)

	)

70 
	#EC_CLZ
(
_x
Ë(
	`__buûtö_˛z
(_x))

	)

71 #ñi‡
LONG_MAX
>=2147483647L

72 
	#EC_CLZ0
 (()()*
CHAR_BIT
)

	)

73 
	#EC_CLZ
(
_x
Ë(
	`__buûtö_˛zl
(_x))

	)

77 #i‡
deföed
(
EC_CLZ
)

82 
	#EC_ILOG
(
_x
Ë(
EC_CLZ0
-
	`EC_CLZ
(_x))

	)

84 
ec_ûog
(
›us_uöt32
 
_v
);

85 
	#EC_ILOG
(
_x
Ë(
	`ec_ûog
(_x))

	)

	@celt/entcode.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"ítcode.h
"

33 
	~"¨ch.h
"

35 #i‡!
deföed
(
EC_CLZ
)

41 
	$ec_ûog
(
›us_uöt32
 
_v
){

45 
ªt
;

46 
m
;

47 
ªt
=!!
_v
;

48 
m
=!!(
_v
&0xFFFF0000)<<4;

49 
_v
>>=
m
;

50 
ªt
|=
m
;

51 
m
=!!(
_v
&0xFF00)<<3;

52 
_v
>>=
m
;

53 
ªt
|=
m
;

54 
m
=!!(
_v
&0xF0)<<2;

55 
_v
>>=
m
;

56 
ªt
|=
m
;

57 
m
=!!(
_v
&0xC)<<1;

58 
_v
>>=
m
;

59 
ªt
|=
m
;

60 
ªt
+=!!(
_v
&0x2);

61  
ªt
;

62 
	}
}

69 
›us_uöt32
 
	$ec_ãŒ_‰ac
(
ec_˘x
 *
_this
){

70 c⁄° 
c‹ª˘i⁄
[8] =

73 
›us_uöt32
 
nbôs
;

74 
›us_uöt32
 
r
;

75 
l
;

76 
b
;

77 
nbôs
=
_this
->
nbôs_tŸÆ
<<
BITRES
;

78 
l
=
	`EC_ILOG
(
_this
->
∫g
);

79 
r
=
_this
->
∫g
>>(
l
-16);

80 
b
 = (
r
>>12)-8;

81 
b
 +
r
>
c‹ª˘i⁄
[b];

82 
l
 = (l<<3)+
b
;

83  
nbôs
-
l
;

84 
	}
}

86 
›us_uöt32
 
	$ec_ãŒ_‰ac
(
ec_˘x
 *
_this
){

87 
›us_uöt32
 
nbôs
;

88 
›us_uöt32
 
r
;

89 
l
;

90 
i
;

103 
nbôs
=
_this
->
nbôs_tŸÆ
<<
BITRES
;

104 
l
=
	`EC_ILOG
(
_this
->
∫g
);

105 
r
=
_this
->
∫g
>>(
l
-16);

106 
i
=
BITRES
;i-->0;){

107 
b
;

108 
r
=r*r>>15;

109 
b
=()(
r
>>16);

110 
l
ˆ<<1|
b
;

111 
r
>>=
b
;

113  
nbôs
-
l
;

114 
	}
}

117 #ifde‡
USE_SMALL_DIV_TABLE


119 c⁄° 
›us_uöt32
 
	gSMALL_DIV_TABLE
[129] = {

	@celt/entcode.h

28 
	~"›us_ty≥s.h
"

29 
	~"›us_deföes.h
"

31 #i‡!
deföed
(
_ítcode_H
)

32 
	#_ítcode_H
 (1)

	)

33 
	~<limôs.h
>

34 
	~<°ddef.h
>

35 
	~"ecöåö.h
"

37 c⁄° 
›us_uöt32
 
SMALL_DIV_TABLE
[129];

39 #ifde‡
OPUS_ARM_ASM


40 
	#USE_SMALL_DIV_TABLE


	)

45 
›us_uöt32
 
	tec_wödow
;

46 
ec_˘x
 
	tec_˘x
;

47 
ec_˘x
 
	tec_íc
;

48 
ec_˘x
 
	tec_dec
;

50 
	#EC_WINDOW_SIZE
 (()(
ec_wödow
)*
CHAR_BIT
)

	)

53 
	#EC_UINT_BITS
 (8)

	)

57 
	#BITRES
 3

	)

62 
	sec_˘x
{

64 *
	mbuf
;

66 
›us_uöt32
 
	m°‹age
;

68 
›us_uöt32
 
	míd_offs
;

70 
ec_wödow
 
	míd_wödow
;

72 
	m√nd_bôs
;

75 
	mnbôs_tŸÆ
;

77 
›us_uöt32
 
	moffs
;

79 
›us_uöt32
 
	m∫g
;

83 
›us_uöt32
 
	mvÆ
;

86 
›us_uöt32
 
	mext
;

88 
	mªm
;

90 
	mîr‹
;

93 
OPUS_INLINE
 
›us_uöt32
 
	$ec_ønge_byãs
(
ec_˘x
 *
_this
){

94  
_this
->
offs
;

95 
	}
}

97 
OPUS_INLINE
 *
	$ec_gë_buf„r
(
ec_˘x
 *
_this
){

98  
_this
->
buf
;

99 
	}
}

101 
OPUS_INLINE
 
	$ec_gë_îr‹
(
ec_˘x
 *
_this
){

102  
_this
->
îr‹
;

103 
	}
}

111 
OPUS_INLINE
 
	$ec_ãŒ
(
ec_˘x
 *
_this
){

112  
_this
->
nbôs_tŸÆ
-
	`EC_ILOG
(_this->
∫g
);

113 
	}
}

121 
›us_uöt32
 
ec_ãŒ_‰ac
(
ec_˘x
 *
_this
);

124 
OPUS_INLINE
 
›us_uöt32
 
	$˚…_udiv
(
›us_uöt32
 
n
, opus_uöt32 
d
) {

125 
	`˚…_sig_as£π
(
d
>0);

126 #ifde‡
USE_SMALL_DIV_TABLE


127 i‡(
d
>256)

128  
n
/
d
;

130 
›us_uöt32
 
t
, 
q
;

131 
t
 = 
	`EC_ILOG
(
d
&-d);

132 
q
 = (
›us_uöt64
)
SMALL_DIV_TABLE
[
d
>>
t
]*(
n
>>(t-1))>>32;

133  
q
+(
n
-q*
d
 >= d);

136  
n
/
d
;

138 
	}
}

140 
OPUS_INLINE
 
›us_öt32
 
	$˚…_sudiv
(
›us_öt32
 
n
, opus_öt32 
d
) {

141 
	`˚…_sig_as£π
(
d
>0);

142 #ifde‡
USE_SMALL_DIV_TABLE


143 i‡(
n
<0)

144  -(
›us_öt32
)
	`˚…_udiv
(-
n
, 
d
);

146  
	`˚…_udiv
(
n
, 
d
);

148  
n
/
d
;

150 
	}
}

	@celt/entdec.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°ddef.h
>

33 
	~"os_suµ‹t.h
"

34 
	~"¨ch.h
"

35 
	~"ítdec.h
"

36 
	~"m‰ngcod.h
"

91 
	$ec_ªad_byã
(
ec_dec
 *
_this
){

92  
_this
->
offs
<_this->
°‹age
?_this->
buf
[_this->offs++]:0;

93 
	}
}

95 
	$ec_ªad_byã_‰om_íd
(
ec_dec
 *
_this
){

96  
_this
->
íd_offs
<_this->
°‹age
?

97 
_this
->
buf
[_this->
°‹age
-++(_this->
íd_offs
)]:0;

98 
	}
}

102 
	$ec_dec_n‹mÆize
(
ec_dec
 *
_this
){

104 
_this
->
∫g
<=
EC_CODE_BOT
){

105 
sym
;

106 
_this
->
nbôs_tŸÆ
+=
EC_SYM_BITS
;

107 
_this
->
∫g
<<=
EC_SYM_BITS
;

109 
sym
=
_this
->
ªm
;

111 
_this
->
ªm
=
	`ec_ªad_byã
(_this);

113 
sym
=(sym<<
EC_SYM_BITS
|
_this
->
ªm
)>>(EC_SYM_BITS-
EC_CODE_EXTRA
);

115 
_this
->
vÆ
=((_this->vÆ<<
EC_SYM_BITS
)+(
EC_SYM_MAX
&~
sym
))&(
EC_CODE_TOP
-1);

117 
	}
}

119 
	$ec_dec_öô
(
ec_dec
 *
_this
,*
_buf
,
›us_uöt32
 
_°‹age
){

120 
_this
->
buf
=
_buf
;

121 
_this
->
°‹age
=
_°‹age
;

122 
_this
->
íd_offs
=0;

123 
_this
->
íd_wödow
=0;

124 
_this
->
√nd_bôs
=0;

128 
_this
->
nbôs_tŸÆ
=
EC_CODE_BITS
+1

129 -((
EC_CODE_BITS
-
EC_CODE_EXTRA
)/
EC_SYM_BITS
)*EC_SYM_BITS;

130 
_this
->
offs
=0;

131 
_this
->
∫g
=1U<<
EC_CODE_EXTRA
;

132 
_this
->
ªm
=
	`ec_ªad_byã
(_this);

133 
_this
->
vÆ
=_this->
∫g
-1-(_this->
ªm
>>(
EC_SYM_BITS
-
EC_CODE_EXTRA
));

134 
_this
->
îr‹
=0;

136 
	`ec_dec_n‹mÆize
(
_this
);

137 
	}
}

139 
	$ec_decode
(
ec_dec
 *
_this
,
_·
){

140 
s
;

141 
_this
->
ext
=
	`˚…_udiv
(_this->
∫g
,
_·
);

142 
s
=()(
_this
->
vÆ
/_this->
ext
);

143  
_·
-
	`EC_MINI
(
s
+1,_ft);

144 
	}
}

146 
	$ec_decode_bö
(
ec_dec
 *
_this
,
_bôs
){

147 
s
;

148 
_this
->
ext
=_this->
∫g
>>
_bôs
;

149 
s
=()(
_this
->
vÆ
/_this->
ext
);

150  (1U<<
_bôs
)-
	`EC_MINI
(
s
+1U,1U<<_bits);

151 
	}
}

153 
	$ec_dec_upd©e
(
ec_dec
 *
_this
,
_Ê
,
_fh
,
_·
){

154 
›us_uöt32
 
s
;

155 
s
=
	`IMUL32
(
_this
->
ext
,
_·
-
_fh
);

156 
_this
->
vÆ
-=
s
;

157 
_this
->
∫g
=
_Ê
>0?
	`IMUL32
(_this->
ext
,
_fh
-_Ê):_this->∫g-
s
;

158 
	`ec_dec_n‹mÆize
(
_this
);

159 
	}
}

162 
	$ec_dec_bô_logp
(
ec_dec
 *
_this
,
_logp
){

163 
›us_uöt32
 
r
;

164 
›us_uöt32
 
d
;

165 
›us_uöt32
 
s
;

166 
ªt
;

167 
r
=
_this
->
∫g
;

168 
d
=
_this
->
vÆ
;

169 
s
=
r
>>
_logp
;

170 
ªt
=
d
<
s
;

171 if(!
ªt
)
_this
->
vÆ
=
d
-
s
;

172 
_this
->
∫g
=
ªt
?
s
:
r
-s;

173 
	`ec_dec_n‹mÆize
(
_this
);

174  
ªt
;

175 
	}
}

177 
	$ec_dec_icdf
(
ec_dec
 *
_this
,c⁄° *
_icdf
,
_·b
){

178 
›us_uöt32
 
r
;

179 
›us_uöt32
 
d
;

180 
›us_uöt32
 
s
;

181 
›us_uöt32
 
t
;

182 
ªt
;

183 
s
=
_this
->
∫g
;

184 
d
=
_this
->
vÆ
;

185 
r
=
s
>>
_·b
;

186 
ªt
=-1;

188 
t
=
s
;

189 
s
=
	`IMUL32
(
r
,
_icdf
[++
ªt
]);

191 
d
<
s
);

192 
_this
->
vÆ
=
d
-
s
;

193 
_this
->
∫g
=
t
-
s
;

194 
	`ec_dec_n‹mÆize
(
_this
);

195  
ªt
;

196 
	}
}

198 
›us_uöt32
 
	$ec_dec_uöt
(
ec_dec
 *
_this
,
›us_uöt32
 
_·
){

199 
·
;

200 
s
;

201 
·b
;

203 
	`˚…_as£π
(
_·
>1);

204 
_·
--;

205 
·b
=
	`EC_ILOG
(
_·
);

206 if(
·b
>
EC_UINT_BITS
){

207 
›us_uöt32
 
t
;

208 
·b
-=
EC_UINT_BITS
;

209 
·
=()(
_·
>>
·b
)+1;

210 
s
=
	`ec_decode
(
_this
,
·
);

211 
	`ec_dec_upd©e
(
_this
,
s
,s+1,
·
);

212 
t
=(
›us_uöt32
)
s
<<
·b
|
	`ec_dec_bôs
(
_this
,ftb);

213 if(
t
<=
_·
)Å;

214 
_this
->
îr‹
=1;

215  
_·
;

218 
_·
++;

219 
s
=
	`ec_decode
(
_this
,()
_·
);

220 
	`ec_dec_upd©e
(
_this
,
s
,s+1,()
_·
);

221  
s
;

223 
	}
}

225 
›us_uöt32
 
	$ec_dec_bôs
(
ec_dec
 *
_this
,
_bôs
){

226 
ec_wödow
 
wödow
;

227 
avaûabÀ
;

228 
›us_uöt32
 
ªt
;

229 
wödow
=
_this
->
íd_wödow
;

230 
avaûabÀ
=
_this
->
√nd_bôs
;

231 if(()
avaûabÀ
<
_bôs
){

233 
wödow
|=(
ec_wödow
)
	`ec_ªad_byã_‰om_íd
(
_this
)<<
avaûabÀ
;

234 
avaûabÀ
+=
EC_SYM_BITS
;

236 
avaûabÀ
<=
EC_WINDOW_SIZE
-
EC_SYM_BITS
);

238 
ªt
=(
›us_uöt32
)
wödow
&(((›us_uöt32)1<<
_bôs
)-1U);

239 
wödow
>>=
_bôs
;

240 
avaûabÀ
-=
_bôs
;

241 
_this
->
íd_wödow
=
wödow
;

242 
_this
->
√nd_bôs
=
avaûabÀ
;

243 
_this
->
nbôs_tŸÆ
+=
_bôs
;

244  
ªt
;

245 
	}
}

	@celt/entdec.h

28 #i‡!
deföed
(
_ítdec_H
)

29 
	#_ítdec_H
 (1)

	)

30 
	~<limôs.h
>

31 
	~"ítcode.h
"

36 
ec_dec_öô
(
ec_dec
 *
_this
,*
_buf
,
›us_uöt32
 
_°‹age
);

51 
ec_decode
(
ec_dec
 *
_this
,
_·
);

54 
ec_decode_bö
(
ec_dec
 *
_this
,
_bôs
);

69 
ec_dec_upd©e
(
ec_dec
 *
_this
,
_Ê
,
_fh
,
_·
);

72 
ec_dec_bô_logp
(
ec_dec
 *
_this
,
_logp
);

82 
ec_dec_icdf
(
ec_dec
 *
_this
,c⁄° *
_icdf
,
_·b
);

90 
›us_uöt32
 
ec_dec_uöt
(
ec_dec
 *
_this
,›us_uöt32 
_·
);

98 
›us_uöt32
 
ec_dec_bôs
(
ec_dec
 *
_this
,
_·b
);

	@celt/entenc.c

28 #i‡
deföed
(
HAVE_CONFIG_H
)

29 
	~"c⁄fig.h
"

31 
	~"os_suµ‹t.h
"

32 
	~"¨ch.h
"

33 
	~"íãnc.h
"

34 
	~"m‰ngcod.h
"

60 
	$ec_wrôe_byã
(
ec_íc
 *
_this
,
_vÆue
){

61 if(
_this
->
offs
+_this->
íd_offs
>=_this->
°‹age
) -1;

62 
_this
->
buf
[_this->
offs
++]=()
_vÆue
;

64 
	}
}

66 
	$ec_wrôe_byã_©_íd
(
ec_íc
 *
_this
,
_vÆue
){

67 if(
_this
->
offs
+_this->
íd_offs
>=_this->
°‹age
) -1;

68 
_this
->
buf
[_this->
°‹age
-++(_this->
íd_offs
)]=()
_vÆue
;

70 
	}
}

82 
	$ec_íc_ˇºy_out
(
ec_íc
 *
_this
,
_c
){

83 if(
_c
!=
EC_SYM_MAX
){

85 
ˇºy
;

86 
ˇºy
=
_c
>>
EC_SYM_BITS
;

89 if(
_this
->
ªm
>=0)_this->
îr‹
|=
	`ec_wrôe_byã
(_this,_this->ªm+
ˇºy
);

90 if(
_this
->
ext
>0){

91 
sym
;

92 
sym
=(
EC_SYM_MAX
+
ˇºy
)&EC_SYM_MAX;

93 dÿ
_this
->
îr‹
|=
	`ec_wrôe_byã
(_this,
sym
);

94 --(
_this
->
ext
)>0);

96 
_this
->
ªm
=
_c
&
EC_SYM_MAX
;

98 
_this
->
ext
++;

99 
	}
}

101 
OPUS_INLINE
 
	$ec_íc_n‹mÆize
(
ec_íc
 *
_this
){

103 
_this
->
∫g
<=
EC_CODE_BOT
){

104 
	`ec_íc_ˇºy_out
(
_this
,()(_this->
vÆ
>>
EC_CODE_SHIFT
));

106 
_this
->
vÆ
=(_this->vÆ<<
EC_SYM_BITS
)&(
EC_CODE_TOP
-1);

107 
_this
->
∫g
<<=
EC_SYM_BITS
;

108 
_this
->
nbôs_tŸÆ
+=
EC_SYM_BITS
;

110 
	}
}

112 
	$ec_íc_öô
(
ec_íc
 *
_this
,*
_buf
,
›us_uöt32
 
_size
){

113 
_this
->
buf
=
_buf
;

114 
_this
->
íd_offs
=0;

115 
_this
->
íd_wödow
=0;

116 
_this
->
√nd_bôs
=0;

118 
_this
->
nbôs_tŸÆ
=
EC_CODE_BITS
+1;

119 
_this
->
offs
=0;

120 
_this
->
∫g
=
EC_CODE_TOP
;

121 
_this
->
ªm
=-1;

122 
_this
->
vÆ
=0;

123 
_this
->
ext
=0;

124 
_this
->
°‹age
=
_size
;

125 
_this
->
îr‹
=0;

126 
	}
}

128 
	$ec_ícode
(
ec_íc
 *
_this
,
_Ê
,
_fh
,
_·
){

129 
›us_uöt32
 
r
;

130 
r
=
	`˚…_udiv
(
_this
->
∫g
,
_·
);

131 if(
_Ê
>0){

132 
_this
->
vÆ
+=_this->
∫g
-
	`IMUL32
(
r
,(
_·
-
_Ê
));

133 
_this
->
∫g
=
	`IMUL32
(
r
,(
_fh
-
_Ê
));

135 
_this
->
∫g
-=
	`IMUL32
(
r
,(
_·
-
_fh
));

136 
	`ec_íc_n‹mÆize
(
_this
);

137 
	}
}

139 
	$ec_ícode_bö
(
ec_íc
 *
_this
,
_Ê
,
_fh
,
_bôs
){

140 
›us_uöt32
 
r
;

141 
r
=
_this
->
∫g
>>
_bôs
;

142 if(
_Ê
>0){

143 
_this
->
vÆ
+=_this->
∫g
-
	`IMUL32
(
r
,((1U<<
_bôs
)-
_Ê
));

144 
_this
->
∫g
=
	`IMUL32
(
r
,(
_fh
-
_Ê
));

146 
_this
->
∫g
-=
	`IMUL32
(
r
,((1U<<
_bôs
)-
_fh
));

147 
	`ec_íc_n‹mÆize
(
_this
);

148 
	}
}

151 
	$ec_íc_bô_logp
(
ec_íc
 *
_this
,
_vÆ
,
_logp
){

152 
›us_uöt32
 
r
;

153 
›us_uöt32
 
s
;

154 
›us_uöt32
 
l
;

155 
r
=
_this
->
∫g
;

156 
l
=
_this
->
vÆ
;

157 
s
=
r
>>
_logp
;

158 
r
-=
s
;

159 if(
_vÆ
)
_this
->
vÆ
=
l
+
r
;

160 
_this
->
∫g
=
_vÆ
?
s
:
r
;

161 
	`ec_íc_n‹mÆize
(
_this
);

162 
	}
}

164 
	$ec_íc_icdf
(
ec_íc
 *
_this
,
_s
,c⁄° *
_icdf
,
_·b
){

165 
›us_uöt32
 
r
;

166 
r
=
_this
->
∫g
>>
_·b
;

167 if(
_s
>0){

168 
_this
->
vÆ
+=_this->
∫g
-
	`IMUL32
(
r
,
_icdf
[
_s
-1]);

169 
_this
->
∫g
=
	`IMUL32
(
r
,
_icdf
[
_s
-1]-_icdf[_s]);

171 
_this
->
∫g
-=
	`IMUL32
(
r
,
_icdf
[
_s
]);

172 
	`ec_íc_n‹mÆize
(
_this
);

173 
	}
}

175 
	$ec_íc_uöt
(
ec_íc
 *
_this
,
›us_uöt32
 
_Ê
,›us_uöt32 
_·
){

176 
·
;

177 
Ê
;

178 
·b
;

180 
	`˚…_as£π
(
_·
>1);

181 
_·
--;

182 
·b
=
	`EC_ILOG
(
_·
);

183 if(
·b
>
EC_UINT_BITS
){

184 
·b
-=
EC_UINT_BITS
;

185 
·
=(
_·
>>
·b
)+1;

186 
Ê
=()(
_Ê
>>
·b
);

187 
	`ec_ícode
(
_this
,
Ê
,Ê+1,
·
);

188 
	`ec_íc_bôs
(
_this
,
_Ê
&(((
›us_uöt32
)1<<
·b
)-1U),ftb);

190 
	`ec_ícode
(
_this
,
_Ê
,_Ê+1,
_·
+1);

191 
	}
}

193 
	$ec_íc_bôs
(
ec_íc
 *
_this
,
›us_uöt32
 
_Ê
,
_bôs
){

194 
ec_wödow
 
wödow
;

195 
u£d
;

196 
wödow
=
_this
->
íd_wödow
;

197 
u£d
=
_this
->
√nd_bôs
;

198 
	`˚…_as£π
(
_bôs
>0);

199 if(
u£d
+
_bôs
>
EC_WINDOW_SIZE
){

201 
_this
->
îr‹
|=
	`ec_wrôe_byã_©_íd
(_this,()
wödow
&
EC_SYM_MAX
);

202 
wödow
>>=
EC_SYM_BITS
;

203 
u£d
-=
EC_SYM_BITS
;

205 
u£d
>=
EC_SYM_BITS
);

207 
wödow
|=(
ec_wödow
)
_Ê
<<
u£d
;

208 
u£d
+=
_bôs
;

209 
_this
->
íd_wödow
=
wödow
;

210 
_this
->
√nd_bôs
=
u£d
;

211 
_this
->
nbôs_tŸÆ
+=
_bôs
;

212 
	}
}

214 
	$ec_íc_∑tch_öôül_bôs
(
ec_íc
 *
_this
,
_vÆ
,
_nbôs
){

215 
shi·
;

216 
mask
;

217 
	`˚…_as£π
(
_nbôs
<=
EC_SYM_BITS
);

218 
shi·
=
EC_SYM_BITS
-
_nbôs
;

219 
mask
=((1<<
_nbôs
)-1)<<
shi·
;

220 if(
_this
->
offs
>0){

222 
_this
->
buf
[0]=()((_this->buf[0]&~
mask
)|
_vÆ
<<
shi·
);

224 if(
_this
->
ªm
>=0){

226 
_this
->
ªm
=(_this->ªm&~
mask
)|
_vÆ
<<
shi·
;

228 if(
_this
->
∫g
<=(
EC_CODE_TOP
>>
_nbôs
)){

230 
_this
->
vÆ
=(_this->vÆ&~((
›us_uöt32
)
mask
<<
EC_CODE_SHIFT
))|

231 (
›us_uöt32
)
_vÆ
<<(
EC_CODE_SHIFT
+
shi·
);

234 
_this
->
îr‹
=-1;

235 
	}
}

237 
	$ec_íc_shrök
(
ec_íc
 *
_this
,
›us_uöt32
 
_size
){

238 
	`˚…_as£π
(
_this
->
offs
+_this->
íd_offs
<=
_size
);

239 
	`OPUS_MOVE
(
_this
->
buf
+
_size
-_this->
íd_offs
,

240 
_this
->
buf
+_this->
°‹age
-_this->
íd_offs
,_this->end_offs);

241 
_this
->
°‹age
=
_size
;

242 
	}
}

244 
	$ec_íc_d⁄e
(
ec_íc
 *
_this
){

245 
ec_wödow
 
wödow
;

246 
u£d
;

247 
›us_uöt32
 
msk
;

248 
›us_uöt32
 
íd
;

249 
l
;

252 
l
=
EC_CODE_BITS
-
	`EC_ILOG
(
_this
->
∫g
);

253 
msk
=(
EC_CODE_TOP
-1)>>
l
;

254 
íd
=(
_this
->
vÆ
+
msk
)&~msk;

255 if((
íd
|
msk
)>=
_this
->
vÆ
+_this->
∫g
){

256 
l
++;

257 
msk
>>=1;

258 
íd
=(
_this
->
vÆ
+
msk
)&~msk;

260 
l
>0){

261 
	`ec_íc_ˇºy_out
(
_this
,()(
íd
>>
EC_CODE_SHIFT
));

262 
íd
=”nd<<
EC_SYM_BITS
)&(
EC_CODE_TOP
-1);

263 
l
-=
EC_SYM_BITS
;

266 if(
_this
->
ªm
>=0||_this->
ext
>0)
	`ec_íc_ˇºy_out
(_this,0);

268 
wödow
=
_this
->
íd_wödow
;

269 
u£d
=
_this
->
√nd_bôs
;

270 
u£d
>=
EC_SYM_BITS
){

271 
_this
->
îr‹
|=
	`ec_wrôe_byã_©_íd
(_this,()
wödow
&
EC_SYM_MAX
);

272 
wödow
>>=
EC_SYM_BITS
;

273 
u£d
-=
EC_SYM_BITS
;

276 if(!
_this
->
îr‹
){

277 
	`OPUS_CLEAR
(
_this
->
buf
+_this->
offs
,

278 
_this
->
°‹age
-_this->
offs
-_this->
íd_offs
);

279 if(
u£d
>0){

281 if(
_this
->
íd_offs
>=_this->
°‹age
)_this->
îr‹
=-1;

283 
l
=-l;

286 if(
_this
->
offs
+_this->
íd_offs
>=_this->
°‹age
&&
l
<
u£d
){

287 
wödow
&=(1<<
l
)-1;

288 
_this
->
îr‹
=-1;

290 
_this
->
buf
[_this->
°‹age
-_this->
íd_offs
-1]|=()
wödow
;

294 
	}
}

	@celt/entenc.h

28 #i‡!
deföed
(
_íãnc_H
)

29 
	#_íãnc_H
 (1)

	)

30 
	~<°ddef.h
>

31 
	~"ítcode.h
"

36 
ec_íc_öô
(
ec_íc
 *
_this
,*
_buf
,
›us_uöt32
 
_size
);

50 
ec_ícode
(
ec_íc
 *
_this
,
_Ê
,
_fh
,
_·
);

53 
ec_ícode_bö
(
ec_íc
 *
_this
,
_Ê
,
_fh
,
_bôs
);

56 
ec_íc_bô_logp
(
ec_íc
 *
_this
,
_vÆ
,
_logp
);

65 
ec_íc_icdf
(
ec_íc
 *
_this
,
_s
,c⁄° *
_icdf
,
_·b
);

71 
ec_íc_uöt
(
ec_íc
 *
_this
,
›us_uöt32
 
_Ê
,›us_uöt32 
_·
);

77 
ec_íc_bôs
(
ec_íc
 *
_this
,
›us_uöt32
 
_Ê
,
_·b
);

93 
ec_íc_∑tch_öôül_bôs
(
ec_íc
 *
_this
,
_vÆ
,
_nbôs
);

103 
ec_íc_shrök
(
ec_íc
 *
_this
,
›us_uöt32
 
_size
);

108 
ec_íc_d⁄e
(
ec_íc
 *
_this
);

	@celt/fixed_c5x.h

31 #i‚de‡
FIXED_C5X_H


32 
	#FIXED_C5X_H


	)

34 
	~"d•lib.h
"

36 #unde‡
IMUL32


37 
OPUS_INLINE
 
	$IMUL32
(
i
, 
j
)

39 
ac0
, 
ac1
;

40 
ac0
 = 
	`_lmpy
(
i
>>16,
j
);

41 
ac1
 = 
ac0
 + 
	`_lmpy
(
i
,
j
>>16);

42  
	`_lmpyu
(
i
,
j
Ë+ (
ac1
<<16);

43 
	}
}

45 #unde‡
MAX16


46 
	#MAX16
(
a
,
b
Ë
	`_max
◊,b)

	)

48 #unde‡
MIN16


49 
	#MIN16
(
a
,
b
Ë
	`_mö
◊,b)

	)

51 #unde‡
MAX32


52 
	#MAX32
(
a
,
b
Ë
	`_lmax
◊,b)

	)

54 #unde‡
MIN32


55 
	#MIN32
(
a
,
b
Ë
	`_lmö
◊,b)

	)

57 #unde‡
VSHR32


58 
	#VSHR32
(
a
, 
shi·
Ë
	`_lshl
◊,-(shi·))

	)

60 #unde‡
MULT16_16_Q15


61 
	#MULT16_16_Q15
(
a
,
b
Ë(
	`_smpy
◊,b))

	)

63 #unde‡
MULT16_16SU


64 
	#MULT16_16SU
(
a
,
b
Ë
	`_lmpysu
◊,b)

	)

66 #unde‡
MULT_16_16


67 
	#MULT_16_16
(
a
,
b
Ë
	`_lmpy
◊,b)

	)

70 #unde‡
MULT16_32_Q15


71 
	#MULT16_32_Q15
(
a
,
b
Ë
	`ADD32
(
	`SHL
(
	`MULT16_16
(◊),
	`SHR
((b),16)),1), SHR(
	`MULT16_16SU
(◊),(b)),15))

	)

73 
	#˚…_ûog2
(
x
Ë(30 - 
	`_ ‹m
(x))

	)

74 
	#OVERRIDE_CELT_ILOG2


	)

76 
	#˚…_maxabs16
(
x
, 
Àn
Ë
	`MAX32
(
	`EXTEND32
(
	`maxvÆ
((
DATA
 *)x,Üí)),-EXTEND32(
	`mövÆ
((DATA *)x,Üí)))

	)

77 
	#OVERRIDE_CELT_MAXABS16


	)

	@celt/fixed_c6x.h

31 #i‚de‡
FIXED_C6X_H


32 
	#FIXED_C6X_H


	)

34 #unde‡
MULT16_16SU


35 
	#MULT16_16SU
(
a
,
b
Ë
	`_mpysu
◊,b)

	)

37 #unde‡
MULT_16_16


38 
	#MULT_16_16
(
a
,
b
Ë
	`_mpy
◊,b)

	)

40 
	#˚…_ûog2
(
x
Ë(30 - 
	`_n‹m
(x))

	)

41 
	#OVERRIDE_CELT_ILOG2


	)

43 #unde‡
MULT16_32_Q15


44 
	#MULT16_32_Q15
(
a
,
b
Ë(
	`_mpylûl
◊, bË>> 15)

	)

47 
	~"d•lib.h
"

49 #unde‡
MAX16


50 
	#MAX16
(
a
,
b
Ë
	`_max
◊,b)

	)

52 #unde‡
MIN16


53 
	#MIN16
(
a
,
b
Ë
	`_mö
◊,b)

	)

55 #unde‡
MAX32


56 
	#MAX32
(
a
,
b
Ë
	`_lmax
◊,b)

	)

58 #unde‡
MIN32


59 
	#MIN32
(
a
,
b
Ë
	`_lmö
◊,b)

	)

61 #unde‡
VSHR32


62 
	#VSHR32
(
a
, 
shi·
Ë
	`_lshl
◊,-(shi·))

	)

64 #unde‡
MULT16_16_Q15


65 
	#MULT16_16_Q15
(
a
,
b
Ë(
	`_smpy
◊,b))

	)

67 
	#˚…_maxabs16
(
x
, 
Àn
Ë
	`MAX32
(
	`EXTEND32
(
	`maxvÆ
((
DATA
 *)x,Üí)),-EXTEND32(
	`mövÆ
((DATA *)x,Üí)))

	)

68 
	#OVERRIDE_CELT_MAXABS16


	)

	@celt/fixed_debug.h

32 #i‚de‡
FIXED_DEBUG_H


33 
	#FIXED_DEBUG_H


	)

35 
	~<°dio.h
>

36 
	~"›us_deföes.h
"

38 #ifde‡
CELT_C


39 
OPUS_EXPORT
 
›us_öt64
 
	g˚…_mùs
=0;

41 
›us_öt64
 
˚…_mùs
;

44 
	#MULT16_16SU
(
a
,
b
Ë((
›us_vÆ32
)(
›us_vÆ16
)◊)*(›us_vÆ32)(
›us_uöt16
)(b))

	)

45 
	#MULT32_32_Q31
(
a
,
b
Ë
	`ADD32
(ADD32(
	`SHL32
(
	`MULT16_16
(
	`SHR32
(◊),16),
	`SHR
((b),16)),1), SHR32(
	`MULT16_16SU
(SHR32(◊),16),((b)&0x0000ffff)),15)), SHR32(MULT16_16SU(SHR32((b),16),(◊)&0x0000ffff)),15))

	)

48 
	#MULT16_32_Q16
(
a
,
b
Ë
	`ADD32
(
	`MULT16_16
(◊),
	`SHR32
((b),16)), SHR32(
	`MULT16_16SU
(◊),((b)&0x0000ffff)),16))

	)

50 
	#MULT16_32_P16
(
a
,
b
Ë
	`MULT16_32_PX
◊,b,16)

	)

52 
	#QCONST16
(
x
,
bôs
Ë((
›us_vÆ16
)(.5+(x)*(((
›us_vÆ32
)1)<<(bôs))))

	)

53 
	#QCONST32
(
x
,
bôs
Ë((
›us_vÆ32
)(.5+(x)*(((›us_vÆ32)1)<<(bôs))))

	)

55 
	#VERIFY_SHORT
(
x
Ë((x)<=32767&&(x)>=-32768)

	)

56 
	#VERIFY_INT
(
x
Ë((x)<=2147483647LL&&(x)>=-2147483648LL)

	)

57 
	#VERIFY_UINT
(
x
Ë((x)<=(2147483647LLU<<1))

	)

59 
	#SHR
(
a
,
b
Ë
	`SHR32
◊,b)

	)

60 
	#PSHR
(
a
,
b
Ë
	`PSHR32
◊,b)

	)

63 
	#ADD32_ovÊw
(
a
,
b
Ë(
˚…_mùs
+=2,(
›us_vÆ32
)((
›us_uöt32
)◊)+(›us_uöt32)(b)))

	)

65 
	#SUB32_ovÊw
(
a
,
b
Ë(
˚…_mùs
+=2,(
›us_vÆ32
)((
›us_uöt32
)◊)-(›us_uöt32)(b)))

	)

68 
	#NEG32_ovÊw
(
a
Ë(
˚…_mùs
+=2,(
›us_vÆ32
)(0-(
›us_uöt32
)◊)))

	)

70 
OPUS_INLINE
 
	$NEG16
(
x
)

72 
ªs
;

73 i‡(!
	`VERIFY_SHORT
(
x
))

75 
	`Ârötf
 (
°dîr
, "NEG16: i≈uài†nŸ sh‹t: %d\n", ()
x
);

76 #ifde‡
FIXED_DEBUG_ASSERT


77 
	`˚…_as£π
(0);

80 
ªs
 = -
x
;

81 i‡(!
	`VERIFY_SHORT
(
ªs
))

83 
	`Ârötf
 (
°dîr
, "NEG16: ouçuài†nŸ sh‹t: %d\n", ()
ªs
);

84 #ifde‡
FIXED_DEBUG_ASSERT


85 
	`˚…_as£π
(0);

88 
˚…_mùs
++;

89  
ªs
;

90 
	}
}

91 
OPUS_INLINE
 
	$NEG32
(
›us_öt64
 
x
)

93 
›us_öt64
 
ªs
;

94 i‡(!
	`VERIFY_INT
(
x
))

96 
	`Ârötf
 (
°dîr
, "NEG16: i≈uài†nŸ i¡: %d\n", ()
x
);

97 #ifde‡
FIXED_DEBUG_ASSERT


98 
	`˚…_as£π
(0);

101 
ªs
 = -
x
;

102 i‡(!
	`VERIFY_INT
(
ªs
))

104 
	`Ârötf
 (
°dîr
, "NEG16: ouçuài†nŸ i¡: %d\n", ()
ªs
);

105 #ifde‡
FIXED_DEBUG_ASSERT


106 
	`˚…_as£π
(0);

109 
˚…_mùs
+=2;

110  
ªs
;

111 
	}
}

113 
	#EXTRACT16
(
x
Ë
	`EXTRACT16_
(x, 
__FILE__
, 
__LINE__
)

	)

114 
OPUS_INLINE
 
	$EXTRACT16_
(
x
, *
fûe
, 
löe
)

116 
ªs
;

117 i‡(!
	`VERIFY_SHORT
(
x
))

119 
	`Ârötf
 (
°dîr
, "EXTRACT16: i≈uài†nŸ sh‹t: %d i¿%s:Üöê%d\n", 
x
, 
fûe
, 
löe
);

120 #ifde‡
FIXED_DEBUG_ASSERT


121 
	`˚…_as£π
(0);

124 
ªs
 = 
x
;

125 
˚…_mùs
++;

126  
ªs
;

127 
	}
}

129 
	#EXTEND32
(
x
Ë
	`EXTEND32_
(x, 
__FILE__
, 
__LINE__
)

	)

130 
OPUS_INLINE
 
	$EXTEND32_
(
x
, *
fûe
, 
löe
)

132 
ªs
;

133 i‡(!
	`VERIFY_SHORT
(
x
))

135 
	`Ârötf
 (
°dîr
, "EXTEND32: i≈uài†nŸ sh‹t: %d i¿%s:Üöê%d\n", 
x
, 
fûe
, 
löe
);

136 #ifde‡
FIXED_DEBUG_ASSERT


137 
	`˚…_as£π
(0);

140 
ªs
 = 
x
;

141 
˚…_mùs
++;

142  
ªs
;

143 
	}
}

145 
	#SHR16
(
a
, 
shi·
Ë
	`SHR16_
◊, shi·, 
__FILE__
, 
__LINE__
)

	)

146 
OPUS_INLINE
 
	$SHR16_
(
a
, 
shi·
, *
fûe
, 
löe
)

148 
ªs
;

149 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
shi·
))

151 
	`Ârötf
 (
°dîr
, "SHR16: i≈ut†¨ênŸ sh‹t: %d >> %d i¿%s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

152 #ifde‡
FIXED_DEBUG_ASSERT


153 
	`˚…_as£π
(0);

156 
ªs
 = 
a
>>
shi·
;

157 i‡(!
	`VERIFY_SHORT
(
ªs
))

159 
	`Ârötf
 (
°dîr
, "SHR16: ouçuài†nŸ sh‹t: %d i¿%s:Üöê%d\n", 
ªs
, 
fûe
, 
löe
);

160 #ifde‡
FIXED_DEBUG_ASSERT


161 
	`˚…_as£π
(0);

164 
˚…_mùs
++;

165  
ªs
;

166 
	}
}

167 
	#SHL16
(
a
, 
shi·
Ë
	`SHL16_
◊, shi·, 
__FILE__
, 
__LINE__
)

	)

168 
OPUS_INLINE
 
	$SHL16_
(
a
, 
shi·
, *
fûe
, 
löe
)

170 
ªs
;

171 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
shi·
))

173 
	`Ârötf
 (
°dîr
, "SHL16: i≈ut†¨ênŸ sh‹t: %d %d i¿%s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

174 #ifde‡
FIXED_DEBUG_ASSERT


175 
	`˚…_as£π
(0);

178 
ªs
 = 
a
<<
shi·
;

179 i‡(!
	`VERIFY_SHORT
(
ªs
))

181 
	`Ârötf
 (
°dîr
, "SHL16: ouçuài†nŸ sh‹t: %d i¿%s:Üöê%d\n", 
ªs
, 
fûe
, 
löe
);

182 #ifde‡
FIXED_DEBUG_ASSERT


183 
	`˚…_as£π
(0);

186 
˚…_mùs
++;

187  
ªs
;

188 
	}
}

190 
OPUS_INLINE
 
	$SHR32
(
›us_öt64
 
a
, 
shi·
)

192 
›us_öt64
 
ªs
;

193 i‡(!
	`VERIFY_INT
(
a
Ë|| !
	`VERIFY_SHORT
(
shi·
))

195 
	`Ârötf
 (
°dîr
, "SHR32: i≈ut†¨ênŸ i¡: %d %d\n", ()
a
, 
shi·
);

196 #ifde‡
FIXED_DEBUG_ASSERT


197 
	`˚…_as£π
(0);

200 
ªs
 = 
a
>>
shi·
;

201 i‡(!
	`VERIFY_INT
(
ªs
))

203 
	`Ârötf
 (
°dîr
, "SHR32: ouçuài†nŸ i¡: %d\n", ()
ªs
);

204 #ifde‡
FIXED_DEBUG_ASSERT


205 
	`˚…_as£π
(0);

208 
˚…_mùs
+=2;

209  
ªs
;

210 
	}
}

211 
	#SHL32
(
a
, 
shi·
Ë
	`SHL32_
◊, shi·, 
__FILE__
, 
__LINE__
)

	)

212 
OPUS_INLINE
 
	$SHL32_
(
›us_öt64
 
a
, 
shi·
, *
fûe
, 
löe
)

214 
›us_öt64
 
ªs
;

215 i‡(!
	`VERIFY_INT
(
a
Ë|| !
	`VERIFY_SHORT
(
shi·
))

217 
	`Ârötf
 (
°dîr
, "SHL32: i≈ut†¨ênŸ i¡: %Œd %d i¿%s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

218 #ifde‡
FIXED_DEBUG_ASSERT


219 
	`˚…_as£π
(0);

222 
ªs
 = 
a
<<
shi·
;

223 i‡(!
	`VERIFY_INT
(
ªs
))

225 
	`Ârötf
 (
°dîr
, "SHL32: ouçuài†nŸ i¡: %Œd<<%d = %Œd i¿%s:Üöê%d\n", 
a
, 
shi·
, 
ªs
, 
fûe
, 
löe
);

226 #ifde‡
FIXED_DEBUG_ASSERT


227 
	`˚…_as£π
(0);

230 
˚…_mùs
+=2;

231  
ªs
;

232 
	}
}

234 
	#PSHR32
(
a
,
shi·
Ë(
˚…_mùs
--,
	`SHR32
(
	`ADD32
(◊),(((
›us_vÆ32
)(1)<<((shi·))>>1))),shi·))

	)

235 
	#VSHR32
(
a
, 
shi·
Ë(((shi·)>0Ë? 
	`SHR32
◊, shi·Ë: 
	`SHL32
◊, -(shi·)))

	)

237 
	#ROUND16
(
x
,
a
Ë(
˚…_mùs
--,
	`EXTRACT16
(
	`PSHR32
((x),◊))))

	)

238 
	#SROUND16
(
x
,
a
Ë(
˚…_mùs
--,
	`EXTRACT16
(
	`SATURATE
(
	`PSHR32
(x,a), 32767)));

	)

240 
	#HALF16
(
x
Ë(
	`SHR16
(x,1))

	)

241 
	#HALF32
(
x
Ë(
	`SHR32
(x,1))

	)

243 
	#ADD16
(
a
, 
b
Ë
	`ADD16_
◊, b, 
__FILE__
, 
__LINE__
)

	)

244 
OPUS_INLINE
 
	$ADD16_
(
a
, 
b
, *
fûe
, 
löe
)

246 
ªs
;

247 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

249 
	`Ârötf
 (
°dîr
, "ADD16: i≈ut†¨ênŸ sh‹t: %d %d i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

250 #ifde‡
FIXED_DEBUG_ASSERT


251 
	`˚…_as£π
(0);

254 
ªs
 = 
a
+
b
;

255 i‡(!
	`VERIFY_SHORT
(
ªs
))

257 
	`Ârötf
 (
°dîr
, "ADD16: ouçuài†nŸ sh‹t: %d+%d=%d i¿%s:Üöê%d\n", 
a
,
b
,
ªs
, 
fûe
, 
löe
);

258 #ifde‡
FIXED_DEBUG_ASSERT


259 
	`˚…_as£π
(0);

262 
˚…_mùs
++;

263  
ªs
;

264 
	}
}

266 
	#SUB16
(
a
, 
b
Ë
	`SUB16_
◊, b, 
__FILE__
, 
__LINE__
)

	)

267 
OPUS_INLINE
 
	$SUB16_
(
a
, 
b
, *
fûe
, 
löe
)

269 
ªs
;

270 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

272 
	`Ârötf
 (
°dîr
, "SUB16: i≈ut†¨ênŸ sh‹t: %d %d i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

273 #ifde‡
FIXED_DEBUG_ASSERT


274 
	`˚…_as£π
(0);

277 
ªs
 = 
a
-
b
;

278 i‡(!
	`VERIFY_SHORT
(
ªs
))

280 
	`Ârötf
 (
°dîr
, "SUB16: ouçuài†nŸ sh‹t: %d i¿%s:Üöê%d\n", 
ªs
, 
fûe
, 
löe
);

281 #ifde‡
FIXED_DEBUG_ASSERT


282 
	`˚…_as£π
(0);

285 
˚…_mùs
++;

286  
ªs
;

287 
	}
}

289 
	#ADD32
(
a
, 
b
Ë
	`ADD32_
◊, b, 
__FILE__
, 
__LINE__
)

	)

290 
OPUS_INLINE
 
	$ADD32_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
)

292 
›us_öt64
 
ªs
;

293 i‡(!
	`VERIFY_INT
(
a
Ë|| !VERIFY_INT(
b
))

295 
	`Ârötf
 (
°dîr
, "ADD32: i≈ut†¨ênŸ i¡: %d %d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

296 #ifde‡
FIXED_DEBUG_ASSERT


297 
	`˚…_as£π
(0);

300 
ªs
 = 
a
+
b
;

301 i‡(!
	`VERIFY_INT
(
ªs
))

303 
	`Ârötf
 (
°dîr
, "ADD32: ouçuài†nŸ i¡: %d i¿%s:Üöê%d\n", ()
ªs
, 
fûe
, 
löe
);

304 #ifde‡
FIXED_DEBUG_ASSERT


305 
	`˚…_as£π
(0);

308 
˚…_mùs
+=2;

309  
ªs
;

310 
	}
}

312 
	#SUB32
(
a
, 
b
Ë
	`SUB32_
◊, b, 
__FILE__
, 
__LINE__
)

	)

313 
OPUS_INLINE
 
	$SUB32_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
)

315 
›us_öt64
 
ªs
;

316 i‡(!
	`VERIFY_INT
(
a
Ë|| !VERIFY_INT(
b
))

318 
	`Ârötf
 (
°dîr
, "SUB32: i≈ut†¨ênŸ i¡: %d %d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

319 #ifde‡
FIXED_DEBUG_ASSERT


320 
	`˚…_as£π
(0);

323 
ªs
 = 
a
-
b
;

324 i‡(!
	`VERIFY_INT
(
ªs
))

326 
	`Ârötf
 (
°dîr
, "SUB32: ouçuài†nŸ i¡: %d i¿%s:Üöê%d\n", ()
ªs
, 
fûe
, 
löe
);

327 #ifde‡
FIXED_DEBUG_ASSERT


328 
	`˚…_as£π
(0);

331 
˚…_mùs
+=2;

332  
ªs
;

333 
	}
}

335 #unde‡
UADD32


336 
	#UADD32
(
a
, 
b
Ë
	`UADD32_
◊, b, 
__FILE__
, 
__LINE__
)

	)

337 
OPUS_INLINE
 
	$UADD32_
(
›us_uöt64
 
a
, opus_uöt64 
b
, *
fûe
, 
löe
)

339 
›us_uöt64
 
ªs
;

340 i‡(!
	`VERIFY_UINT
(
a
Ë|| !VERIFY_UINT(
b
))

342 
	`Ârötf
 (
°dîr
, "UADD32: i≈ut†¨ênŸ uöt32: %Œu %Œu i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

343 #ifde‡
FIXED_DEBUG_ASSERT


344 
	`˚…_as£π
(0);

347 
ªs
 = 
a
+
b
;

348 i‡(!
	`VERIFY_UINT
(
ªs
))

350 
	`Ârötf
 (
°dîr
, "UADD32: ouçuài†nŸ uöt32: %Œu i¿%s:Üöê%d\n", 
ªs
, 
fûe
, 
löe
);

351 #ifde‡
FIXED_DEBUG_ASSERT


352 
	`˚…_as£π
(0);

355 
˚…_mùs
+=2;

356  
ªs
;

357 
	}
}

359 #unde‡
USUB32


360 
	#USUB32
(
a
, 
b
Ë
	`USUB32_
◊, b, 
__FILE__
, 
__LINE__
)

	)

361 
OPUS_INLINE
 
	$USUB32_
(
›us_uöt64
 
a
, opus_uöt64 
b
, *
fûe
, 
löe
)

363 
›us_uöt64
 
ªs
;

364 i‡(!
	`VERIFY_UINT
(
a
Ë|| !VERIFY_UINT(
b
))

366 
	`Ârötf
 (
°dîr
, "USUB32: i≈ut†¨ênŸ uöt32: %Œu %Œu i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

367 #ifde‡
FIXED_DEBUG_ASSERT


368 
	`˚…_as£π
(0);

371 i‡(
a
<
b
)

373 
	`Ârötf
 (
°dîr
, "USUB32: i≈ut†undîÊow: %Œu < %Œu i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

374 #ifde‡
FIXED_DEBUG_ASSERT


375 
	`˚…_as£π
(0);

378 
ªs
 = 
a
-
b
;

379 i‡(!
	`VERIFY_UINT
(
ªs
))

381 
	`Ârötf
 (
°dîr
, "USUB32: ouçuài†nŸ uöt32: %Œu - %Œu = %Œu i¿%s:Üöê%d\n", 
a
, 
b
, 
ªs
, 
fûe
, 
löe
);

382 #ifde‡
FIXED_DEBUG_ASSERT


383 
	`˚…_as£π
(0);

386 
˚…_mùs
+=2;

387  
ªs
;

388 
	}
}

391 
OPUS_INLINE
 
	$MULT16_16_16
(
a
, 
b
)

393 
ªs
;

394 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

396 
	`Ârötf
 (
°dîr
, "MULT16_16_16: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

397 #ifde‡
FIXED_DEBUG_ASSERT


398 
	`˚…_as£π
(0);

401 
ªs
 = 
a
*
b
;

402 i‡(!
	`VERIFY_SHORT
(
ªs
))

404 
	`Ârötf
 (
°dîr
, "MULT16_16_16: ouçuài†nŸ sh‹t: %d\n", 
ªs
);

405 #ifde‡
FIXED_DEBUG_ASSERT


406 
	`˚…_as£π
(0);

409 
˚…_mùs
++;

410  
ªs
;

411 
	}
}

413 
	#MULT16_16
(
a
, 
b
Ë
	`MULT16_16_
◊, b, 
__FILE__
, 
__LINE__
)

	)

414 
OPUS_INLINE
 
	$MULT16_16_
(
a
, 
b
, *
fûe
, 
löe
)

416 
›us_öt64
 
ªs
;

417 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

419 
	`Ârötf
 (
°dîr
, "MULT16_16: i≈ut†¨ênŸ sh‹t: %d %d i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

420 #ifde‡
FIXED_DEBUG_ASSERT


421 
	`˚…_as£π
(0);

424 
ªs
 = ((
›us_öt64
)
a
)*
b
;

425 i‡(!
	`VERIFY_INT
(
ªs
))

427 
	`Ârötf
 (
°dîr
, "MULT16_16: ouçuài†nŸ i¡: %d i¿%s:Üöê%d\n", ()
ªs
, 
fûe
, 
löe
);

428 #ifde‡
FIXED_DEBUG_ASSERT


429 
	`˚…_as£π
(0);

432 
˚…_mùs
++;

433  
ªs
;

434 
	}
}

436 
	#MAC16_16
(
c
,
a
,
b
Ë(
˚…_mùs
-=2,
	`ADD32
((c),
	`MULT16_16
(◊),(b))))

	)

438 
	#MULT16_32_QX
(
a
, 
b
, 
Q
Ë
	`MULT16_32_QX_
◊, b, Q, 
__FILE__
, 
__LINE__
)

	)

439 
OPUS_INLINE
 
	$MULT16_32_QX_
(
a
, 
›us_öt64
 
b
, 
Q
, *
fûe
, 
löe
)

441 
›us_öt64
 
ªs
;

442 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !
	`VERIFY_INT
(
b
))

444 
	`Ârötf
 (
°dîr
, "MULT16_32_Q%d: i≈ut†¨ênŸ sh‹t+öt: %d %d i¿%s:Üöê%d\n", 
Q
, ()
a
, ()
b
, 
fûe
, 
löe
);

445 #ifde‡
FIXED_DEBUG_ASSERT


446 
	`˚…_as£π
(0);

449 i‡(
	`ABS32
(
b
)>=((
›us_vÆ32
)(1)<<(15+
Q
)))

451 
	`Ârötf
 (
°dîr
, "MULT16_32_Q%d: sec⁄d o≥øndÅoÿœrge: %d %d i¿%s:Üöê%d\n", 
Q
, ()
a
, ()
b
, 
fûe
, 
löe
);

452 #ifde‡
FIXED_DEBUG_ASSERT


453 
	`˚…_as£π
(0);

456 
ªs
 = (((
›us_öt64
)
a
)*(›us_öt64)
b
Ë>> 
Q
;

457 i‡(!
	`VERIFY_INT
(
ªs
))

459 
	`Ârötf
 (
°dîr
, "MULT16_32_Q%d: ouçuài†nŸ i¡: %d*%d=%d i¿%s:Üöê%d\n", 
Q
, ()
a
, ()
b
,()
ªs
, 
fûe
, 
löe
);

460 #ifde‡
FIXED_DEBUG_ASSERT


461 
	`˚…_as£π
(0);

464 i‡(
Q
==15)

465 
˚…_mùs
+=3;

467 
˚…_mùs
+=4;

468  
ªs
;

469 
	}
}

471 
	#MULT16_32_PX
(
a
, 
b
, 
Q
Ë
	`MULT16_32_PX_
◊, b, Q, 
__FILE__
, 
__LINE__
)

	)

472 
OPUS_INLINE
 
	$MULT16_32_PX_
(
a
, 
›us_öt64
 
b
, 
Q
, *
fûe
, 
löe
)

474 
›us_öt64
 
ªs
;

475 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !
	`VERIFY_INT
(
b
))

477 
	`Ârötf
 (
°dîr
, "MULT16_32_P%d: i≈ut†¨ênŸ sh‹t+öt: %d %d i¿%s:Üöê%d\n\n", 
Q
, ()
a
, ()
b
, 
fûe
, 
löe
);

478 #ifde‡
FIXED_DEBUG_ASSERT


479 
	`˚…_as£π
(0);

482 i‡(
	`ABS32
(
b
)>=((
›us_öt64
)(1)<<(15+
Q
)))

484 
	`Ârötf
 (
°dîr
, "MULT16_32_Q%d: sec⁄d o≥øndÅoÿœrge: %d %d i¿%s:Üöê%d\n\n", 
Q
, ()
a
, ()
b
,
fûe
, 
löe
);

485 #ifde‡
FIXED_DEBUG_ASSERT


486 
	`˚…_as£π
(0);

489 
ªs
 = ((((
›us_öt64
)
a
)*(›us_öt64)
b
Ë+ (((
›us_vÆ32
)(1)<<
Q
)>>1))>> Q;

490 i‡(!
	`VERIFY_INT
(
ªs
))

492 
	`Ârötf
 (
°dîr
, "MULT16_32_P%d: ouçuài†nŸ i¡: %d*%d=%d i¿%s:Üöê%d\n\n", 
Q
, ()
a
, ()
b
,()
ªs
, 
fûe
, 
löe
);

493 #ifde‡
FIXED_DEBUG_ASSERT


494 
	`˚…_as£π
(0);

497 i‡(
Q
==15)

498 
˚…_mùs
+=4;

500 
˚…_mùs
+=5;

501  
ªs
;

502 
	}
}

504 
	#MULT16_32_Q15
(
a
,
b
Ë
	`MULT16_32_QX
◊,b,15)

	)

505 
	#MAC16_32_Q15
(
c
,
a
,
b
Ë(
˚…_mùs
-=2,
	`ADD32
((c),
	`MULT16_32_Q15
(◊),(b))))

	)

506 
	#MAC16_32_Q16
(
c
,
a
,
b
Ë(
˚…_mùs
-=2,
	`ADD32
((c),
	`MULT16_32_Q16
(◊),(b))))

	)

508 
OPUS_INLINE
 
	$SATURATE
(
a
, 
b
)

510 i‡(
a
>
b
)

511 
a
=
b
;

512 i‡(
a
<-
b
)

513 
a
 = -
b
;

514 
˚…_mùs
+=3;

515  
a
;

516 
	}
}

518 
OPUS_INLINE
 
›us_öt16
 
	$SATURATE16
(
›us_öt32
 
a
)

520 
˚…_mùs
+=3;

521 i‡(
a
>32767)

523 i‡(
a
<-32768)

525  
a
;

526 
	}
}

528 
OPUS_INLINE
 
	$MULT16_16_Q11_32
(
a
, 
b
)

530 
›us_öt64
 
ªs
;

531 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

533 
	`Ârötf
 (
°dîr
, "MULT16_16_Q11: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

534 #ifde‡
FIXED_DEBUG_ASSERT


535 
	`˚…_as£π
(0);

538 
ªs
 = ((
›us_öt64
)
a
)*
b
;

539 
ªs
 >>= 11;

540 i‡(!
	`VERIFY_INT
(
ªs
))

542 
	`Ârötf
 (
°dîr
, "MULT16_16_Q11: ouçuài†nŸ sh‹t: %d*%d=%d\n", ()
a
, ()
b
, ()
ªs
);

543 #ifde‡
FIXED_DEBUG_ASSERT


544 
	`˚…_as£π
(0);

547 
˚…_mùs
+=3;

548  
ªs
;

549 
	}
}

550 
OPUS_INLINE
 
	$MULT16_16_Q13
(
a
, 
b
)

552 
›us_öt64
 
ªs
;

553 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

555 
	`Ârötf
 (
°dîr
, "MULT16_16_Q13: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

556 #ifde‡
FIXED_DEBUG_ASSERT


557 
	`˚…_as£π
(0);

560 
ªs
 = ((
›us_öt64
)
a
)*
b
;

561 
ªs
 >>= 13;

562 i‡(!
	`VERIFY_SHORT
(
ªs
))

564 
	`Ârötf
 (
°dîr
, "MULT16_16_Q13: ouçuài†nŸ sh‹t: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

565 #ifde‡
FIXED_DEBUG_ASSERT


566 
	`˚…_as£π
(0);

569 
˚…_mùs
+=3;

570  
ªs
;

571 
	}
}

572 
OPUS_INLINE
 
	$MULT16_16_Q14
(
a
, 
b
)

574 
›us_öt64
 
ªs
;

575 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

577 
	`Ârötf
 (
°dîr
, "MULT16_16_Q14: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

578 #ifde‡
FIXED_DEBUG_ASSERT


579 
	`˚…_as£π
(0);

582 
ªs
 = ((
›us_öt64
)
a
)*
b
;

583 
ªs
 >>= 14;

584 i‡(!
	`VERIFY_SHORT
(
ªs
))

586 
	`Ârötf
 (
°dîr
, "MULT16_16_Q14: ouçuài†nŸ sh‹t: %d\n", ()
ªs
);

587 #ifde‡
FIXED_DEBUG_ASSERT


588 
	`˚…_as£π
(0);

591 
˚…_mùs
+=3;

592  
ªs
;

593 
	}
}

595 
	#MULT16_16_Q15
(
a
, 
b
Ë
	`MULT16_16_Q15_
◊, b, 
__FILE__
, 
__LINE__
)

	)

596 
OPUS_INLINE
 
	$MULT16_16_Q15_
(
a
, 
b
, *
fûe
, 
löe
)

598 
›us_öt64
 
ªs
;

599 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

601 
	`Ârötf
 (
°dîr
, "MULT16_16_Q15: i≈ut†¨ênŸ sh‹t: %d %d i¿%s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

602 #ifde‡
FIXED_DEBUG_ASSERT


603 
	`˚…_as£π
(0);

606 
ªs
 = ((
›us_öt64
)
a
)*
b
;

607 
ªs
 >>= 15;

608 i‡(!
	`VERIFY_SHORT
(
ªs
))

610 
	`Ârötf
 (
°dîr
, "MULT16_16_Q15: ouçuài†nŸ sh‹t: %d i¿%s:Üöê%d\n", ()
ªs
, 
fûe
, 
löe
);

611 #ifde‡
FIXED_DEBUG_ASSERT


612 
	`˚…_as£π
(0);

615 
˚…_mùs
+=1;

616  
ªs
;

617 
	}
}

619 
OPUS_INLINE
 
	$MULT16_16_P13
(
a
, 
b
)

621 
›us_öt64
 
ªs
;

622 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

624 
	`Ârötf
 (
°dîr
, "MULT16_16_P13: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

625 #ifde‡
FIXED_DEBUG_ASSERT


626 
	`˚…_as£π
(0);

629 
ªs
 = ((
›us_öt64
)
a
)*
b
;

630 
ªs
 += 4096;

631 i‡(!
	`VERIFY_INT
(
ªs
))

633 
	`Ârötf
 (
°dîr
, "MULT16_16_P13: ovîÊow: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

634 #ifde‡
FIXED_DEBUG_ASSERT


635 
	`˚…_as£π
(0);

638 
ªs
 >>= 13;

639 i‡(!
	`VERIFY_SHORT
(
ªs
))

641 
	`Ârötf
 (
°dîr
, "MULT16_16_P13: ouçuài†nŸ sh‹t: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

642 #ifde‡
FIXED_DEBUG_ASSERT


643 
	`˚…_as£π
(0);

646 
˚…_mùs
+=4;

647  
ªs
;

648 
	}
}

649 
OPUS_INLINE
 
	$MULT16_16_P14
(
a
, 
b
)

651 
›us_öt64
 
ªs
;

652 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

654 
	`Ârötf
 (
°dîr
, "MULT16_16_P14: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

655 #ifde‡
FIXED_DEBUG_ASSERT


656 
	`˚…_as£π
(0);

659 
ªs
 = ((
›us_öt64
)
a
)*
b
;

660 
ªs
 += 8192;

661 i‡(!
	`VERIFY_INT
(
ªs
))

663 
	`Ârötf
 (
°dîr
, "MULT16_16_P14: ovîÊow: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

664 #ifde‡
FIXED_DEBUG_ASSERT


665 
	`˚…_as£π
(0);

668 
ªs
 >>= 14;

669 i‡(!
	`VERIFY_SHORT
(
ªs
))

671 
	`Ârötf
 (
°dîr
, "MULT16_16_P14: ouçuài†nŸ sh‹t: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

672 #ifde‡
FIXED_DEBUG_ASSERT


673 
	`˚…_as£π
(0);

676 
˚…_mùs
+=4;

677  
ªs
;

678 
	}
}

679 
OPUS_INLINE
 
	$MULT16_16_P15
(
a
, 
b
)

681 
›us_öt64
 
ªs
;

682 i‡(!
	`VERIFY_SHORT
(
a
Ë|| !VERIFY_SHORT(
b
))

684 
	`Ârötf
 (
°dîr
, "MULT16_16_P15: i≈ut†¨ênŸ sh‹t: %d %d\n", 
a
, 
b
);

685 #ifde‡
FIXED_DEBUG_ASSERT


686 
	`˚…_as£π
(0);

689 
ªs
 = ((
›us_öt64
)
a
)*
b
;

690 
ªs
 += 16384;

691 i‡(!
	`VERIFY_INT
(
ªs
))

693 
	`Ârötf
 (
°dîr
, "MULT16_16_P15: ovîÊow: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

694 #ifde‡
FIXED_DEBUG_ASSERT


695 
	`˚…_as£π
(0);

698 
ªs
 >>= 15;

699 i‡(!
	`VERIFY_SHORT
(
ªs
))

701 
	`Ârötf
 (
°dîr
, "MULT16_16_P15: ouçuài†nŸ sh‹t: %d*%d=%d\n", 
a
, 
b
, ()
ªs
);

702 #ifde‡
FIXED_DEBUG_ASSERT


703 
	`˚…_as£π
(0);

706 
˚…_mùs
+=2;

707  
ªs
;

708 
	}
}

710 
	#DIV32_16
(
a
, 
b
Ë
	`DIV32_16_
◊, b, 
__FILE__
, 
__LINE__
)

	)

712 
OPUS_INLINE
 
	$DIV32_16_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
)

714 
›us_öt64
 
ªs
;

715 i‡(
b
==0)

717 
	`Ârötf
(
°dîr
, "DIV32_16: dividêby zîo: %d/%d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

718 #ifde‡
FIXED_DEBUG_ASSERT


719 
	`˚…_as£π
(0);

723 i‡(!
	`VERIFY_INT
(
a
Ë|| !
	`VERIFY_SHORT
(
b
))

725 
	`Ârötf
 (
°dîr
, "DIV32_16: i≈ut†¨ênŸ i¡/sh‹t: %d %d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

726 #ifde‡
FIXED_DEBUG_ASSERT


727 
	`˚…_as£π
(0);

730 
ªs
 = 
a
/
b
;

731 i‡(!
	`VERIFY_SHORT
(
ªs
))

733 
	`Ârötf
 (
°dîr
, "DIV32_16: ouçuài†nŸ sh‹t: %d / %d = %d i¿%s:Üöê%d\n", ()
a
,()
b
,()
ªs
, 
fûe
, 
löe
);

734 i‡(
ªs
>32767)

735 
ªs
 = 32767;

736 i‡(
ªs
<-32768)

737 
ªs
 = -32768;

738 #ifde‡
FIXED_DEBUG_ASSERT


739 
	`˚…_as£π
(0);

742 
˚…_mùs
+=35;

743  
ªs
;

744 
	}
}

746 
	#DIV32
(
a
, 
b
Ë
	`DIV32_
◊, b, 
__FILE__
, 
__LINE__
)

	)

747 
OPUS_INLINE
 
	$DIV32_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
)

749 
›us_öt64
 
ªs
;

750 i‡(
b
==0)

752 
	`Ârötf
(
°dîr
, "DIV32: dividêby zîo: %d/%d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

753 #ifde‡
FIXED_DEBUG_ASSERT


754 
	`˚…_as£π
(0);

759 i‡(!
	`VERIFY_INT
(
a
Ë|| !VERIFY_INT(
b
))

761 
	`Ârötf
 (
°dîr
, "DIV32: i≈ut†¨ênŸ i¡/sh‹t: %d %d i¿%s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

762 #ifde‡
FIXED_DEBUG_ASSERT


763 
	`˚…_as£π
(0);

766 
ªs
 = 
a
/
b
;

767 i‡(!
	`VERIFY_INT
(
ªs
))

769 
	`Ârötf
 (
°dîr
, "DIV32: ouçuài†nŸ i¡: %d i¿%s:Üöê%d\n", ()
ªs
, 
fûe
, 
löe
);

770 #ifde‡
FIXED_DEBUG_ASSERT


771 
	`˚…_as£π
(0);

774 
˚…_mùs
+=70;

775  
ªs
;

776 
	}
}

778 
OPUS_INLINE
 
›us_vÆ16
 
	$SIG2WORD16_gíîic
(
˚…_sig
 
x
)

780 
x
 = 
	`PSHR32
(x, 
SIG_SHIFT
);

781 
x
 = 
	`MAX32
(x, -32768);

782 
x
 = 
	`MIN32
(x, 32767);

783  
	`EXTRACT16
(
x
);

784 
	}
}

785 
	#SIG2WORD16
(
x
Ë(
	`SIG2WORD16_gíîic
(x))

	)

788 #unde‡
PRINT_MIPS


789 
	#PRINT_MIPS
(
fûe
Ëdÿ{
	`Ârötf
 (fûe, "tŸÆ com∂exôy = %Œu MIPS\n", 
˚…_mùs
);} 0);

	)

	@celt/fixed_generic.h

33 #i‚de‡
FIXED_GENERIC_H


34 
	#FIXED_GENERIC_H


	)

37 
	#MULT16_16SU
(
a
,
b
Ë((
›us_vÆ32
)(
›us_vÆ16
)◊)*(›us_vÆ32)(
›us_uöt16
)(b))

	)

40 #i‡
OPUS_FAST_INT64


41 
	#MULT16_32_Q16
(
a
,
b
Ë((
›us_vÆ32
)
	`SHR
((
›us_öt64
)((
›us_vÆ16
)◊))*(b),16))

	)

43 
	#MULT16_32_Q16
(
a
,
b
Ë
	`ADD32
(
	`MULT16_16
(◊),
	`SHR
((b),16)), SHR(
	`MULT16_16SU
(◊),((b)&0x0000ffff)),16))

	)

47 #i‡
OPUS_FAST_INT64


48 
	#MULT16_32_P16
(
a
,
b
Ë((
›us_vÆ32
)
	`PSHR
((
›us_öt64
)((
›us_vÆ16
)◊))*(b),16))

	)

50 
	#MULT16_32_P16
(
a
,
b
Ë
	`ADD32
(
	`MULT16_16
(◊),
	`SHR
((b),16)), 
	`PSHR
(
	`MULT16_16SU
(◊),((b)&0x0000ffff)),16))

	)

54 #i‡
OPUS_FAST_INT64


55 
	#MULT16_32_Q15
(
a
,
b
Ë((
›us_vÆ32
)
	`SHR
((
›us_öt64
)((
›us_vÆ16
)◊))*(b),15))

	)

57 
	#MULT16_32_Q15
(
a
,
b
Ë
	`ADD32
(
	`SHL
(
	`MULT16_16
(◊),
	`SHR
((b),16)),1), SHR(
	`MULT16_16SU
(◊),((b)&0x0000ffff)),15))

	)

61 #i‡
OPUS_FAST_INT64


62 
	#MULT32_32_Q31
(
a
,
b
Ë((
›us_vÆ32
)
	`SHR
((
›us_öt64
)◊)*(›us_öt64)(b),31))

	)

64 
	#MULT32_32_Q31
(
a
,
b
Ë
	`ADD32
(ADD32(
	`SHL
(
	`MULT16_16
(
	`SHR
(◊),16),SHR((b),16)),1), SHR(
	`MULT16_16SU
(SHR(◊),16),((b)&0x0000ffff)),15)), SHR(MULT16_16SU(SHR((b),16),(◊)&0x0000ffff)),15))

	)

68 
	#QCONST16
(
x
,
bôs
Ë((
›us_vÆ16
)(.5+(x)*(((
›us_vÆ32
)1)<<(bôs))))

	)

71 
	#QCONST32
(
x
,
bôs
Ë((
›us_vÆ32
)(.5+(x)*(((›us_vÆ32)1)<<(bôs))))

	)

74 
	#NEG16
(
x
Ë(-(x))

	)

76 
	#NEG32
(
x
Ë(-(x))

	)

79 
	#EXTRACT16
(
x
Ë((
›us_vÆ16
)(x))

	)

81 
	#EXTEND32
(
x
Ë((
›us_vÆ32
)(x))

	)

84 
	#SHR16
(
a
,
shi·
Ë(◊Ë>> (shi·))

	)

86 
	#SHL16
(
a
,
shi·
Ë((
›us_öt16
)((
›us_uöt16
)◊)<<(shi·)))

	)

88 
	#SHR32
(
a
,
shi·
Ë(◊Ë>> (shi·))

	)

90 
	#SHL32
(
a
,
shi·
Ë((
›us_öt32
)((
›us_uöt32
)◊)<<(shi·)))

	)

93 
	#PSHR32
(
a
,
shi·
Ë(
	`SHR32
(◊)+((
	`EXTEND32
(1)<<((shi·))>>1)),shi·))

	)

95 
	#VSHR32
(
a
, 
shi·
Ë(((shi·)>0Ë? 
	`SHR32
◊, shi·Ë: 
	`SHL32
◊, -(shi·)))

	)

98 
	#SHR
(
a
,
shi·
Ë(◊Ë>> (shi·))

	)

99 
	#SHL
(
a
,
shi·
Ë
	`SHL32
◊,shi·)

	)

100 
	#PSHR
(
a
,
shi·
Ë(
	`SHR
(◊)+((
	`EXTEND32
(1)<<((shi·))>>1)),shi·))

	)

101 
	#SATURATE
(
x
,
a
Ë(((x)>◊Ë? (aË: (x)<-◊Ë? -◊Ë: (x)))

	)

103 
	#SATURATE16
(
x
Ë(
	`EXTRACT16
((x)>32767 ? 32767 : (x)<-32768 ? -32768 : (x)))

	)

106 
	#ROUND16
(
x
,
a
Ë(
	`EXTRACT16
(
	`PSHR32
((x),◊))))

	)

108 
	#SROUND16
(
x
,
a
Ë
	`EXTRACT16
(
	`SATURATE
(
	`PSHR32
(x,a), 32767));

	)

111 
	#HALF16
(
x
Ë(
	`SHR16
(x,1))

	)

112 
	#HALF32
(
x
Ë(
	`SHR32
(x,1))

	)

115 
	#ADD16
(
a
,
b
Ë((
›us_vÆ16
)((›us_vÆ16)◊)+(›us_vÆ16)(b)))

	)

117 
	#SUB16
(
a
,
b
Ë((
›us_vÆ16
)◊)-(›us_vÆ16)(b))

	)

119 
	#ADD32
(
a
,
b
Ë((
›us_vÆ32
)◊)+(›us_vÆ32)(b))

	)

121 
	#SUB32
(
a
,
b
Ë((
›us_vÆ32
)◊)-(›us_vÆ32)(b))

	)

124 
	#ADD32_ovÊw
(
a
,
b
Ë((
›us_vÆ32
)((
›us_uöt32
)◊)+(›us_uöt32)(b)))

	)

126 
	#SUB32_ovÊw
(
a
,
b
Ë((
›us_vÆ32
)((
›us_uöt32
)◊)-(›us_uöt32)(b)))

	)

129 
	#NEG32_ovÊw
(
a
Ë((
›us_vÆ32
)(0-(
›us_uöt32
)◊)))

	)

132 
	#MULT16_16_16
(
a
,
b
Ë((((
›us_vÆ16
)◊))*((›us_vÆ16)(b))))

	)

136 
	#MULT16_16
(
a
,
b
Ë(((
›us_vÆ32
)(
›us_vÆ16
)◊))*((›us_vÆ32)(›us_vÆ16)(b)))

	)

139 
	#MAC16_16
(
c
,
a
,
b
Ë(
	`ADD32
((c),
	`MULT16_16
(◊),(b))))

	)

143 
	#MAC16_32_Q15
(
c
,
a
,
b
Ë
	`ADD32
((c),ADD32(
	`MULT16_16
(◊),
	`SHR
((b),15)), SHR(MULT16_16(◊),((b)&0x00007fff)),15)))

	)

147 
	#MAC16_32_Q16
(
c
,
a
,
b
Ë
	`ADD32
((c),ADD32(
	`MULT16_16
(◊),
	`SHR
((b),16)), SHR(
	`MULT16_16SU
(◊),((b)&0x0000ffff)),16)))

	)

149 
	#MULT16_16_Q11_32
(
a
,
b
Ë(
	`SHR
(
	`MULT16_16
(◊),(b)),11))

	)

150 
	#MULT16_16_Q11
(
a
,
b
Ë(
	`SHR
(
	`MULT16_16
(◊),(b)),11))

	)

151 
	#MULT16_16_Q13
(
a
,
b
Ë(
	`SHR
(
	`MULT16_16
(◊),(b)),13))

	)

152 
	#MULT16_16_Q14
(
a
,
b
Ë(
	`SHR
(
	`MULT16_16
(◊),(b)),14))

	)

153 
	#MULT16_16_Q15
(
a
,
b
Ë(
	`SHR
(
	`MULT16_16
(◊),(b)),15))

	)

155 
	#MULT16_16_P13
(
a
,
b
Ë(
	`SHR
(
	`ADD32
(4096,
	`MULT16_16
(◊),(b))),13))

	)

156 
	#MULT16_16_P14
(
a
,
b
Ë(
	`SHR
(
	`ADD32
(8192,
	`MULT16_16
(◊),(b))),14))

	)

157 
	#MULT16_16_P15
(
a
,
b
Ë(
	`SHR
(
	`ADD32
(16384,
	`MULT16_16
(◊),(b))),15))

	)

160 
	#DIV32_16
(
a
,
b
Ë((
›us_vÆ16
)(((
›us_vÆ32
)◊))/((›us_vÆ16)(b))))

	)

163 
	#DIV32
(
a
,
b
Ë(((
›us_vÆ32
)◊))/((›us_vÆ32)(b)))

	)

165 #i‡
deföed
(
MIPSr1_ASM
)

166 
	~"mùs/fixed_gíîic_mù§1.h
"

169 
OPUS_INLINE
 
›us_vÆ16
 
	$SIG2WORD16_gíîic
(
˚…_sig
 
x
)

171 
x
 = 
	`PSHR32
(x, 
SIG_SHIFT
);

172 
x
 = 
	`MAX32
(x, -32768);

173 
x
 = 
	`MIN32
(x, 32767);

174  
	`EXTRACT16
(
x
);

175 
	}
}

176 
	#SIG2WORD16
(
x
Ë(
	`SIG2WORD16_gíîic
(x))

	)

	@celt/float_cast.h

29 #i‚de‡
FLOAT_CAST_H


30 
	#FLOAT_CAST_H


	)

33 
	~"¨ch.h
"

65 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__SSE__
)

67 
	~<xmmöåö.h
>

68 
OPUS_INLINE
 
›us_öt32
 
	$Êﬂt2öt
(
x
Ë{ 
	`_mm_cvt_ss2si
(
	`_mm_£t_ss
(x));
	}
}

70 #ñi‡
deföed
(
HAVE_LRINTF
)

79 
	#_ISOC9X_SOURCE
 1

	)

80 
	#_ISOC99_SOURCE
 1

	)

82 
	#__USE_ISOC9X
 1

	)

83 
	#__USE_ISOC99
 1

	)

85 
	~<m©h.h
>

86 
	#Êﬂt2öt
(
x
Ë
	`Ãötf
(x)

	)

88 #ñi‡(
deföed
(
HAVE_LRINT
))

90 
	#_ISOC9X_SOURCE
 1

	)

91 
	#_ISOC99_SOURCE
 1

	)

93 
	#__USE_ISOC9X
 1

	)

94 
	#__USE_ISOC99
 1

	)

96 
	~<m©h.h
>

97 
	#Êﬂt2öt
(
x
Ë
	`Ãöt
(x)

	)

99 #ñi‡(
deföed
(
_MSC_VER
Ë&& _MSC_VER >1400Ë&& (deföed(
_M_X64
Ë|| (deföed(
_M_IX86_FP
) && _M_IX86_FP >= 1))

100 
	~<xmmöåö.h
>

102 
__ölöe
 
	$Êﬂt2öt
(
vÆue
)

104  
	`_mm_cvtss_si32
(
	`_mm_lﬂd_ss
(&
vÆue
));

105 
	}
}

106 #ñi‡(
deföed
(
_MSC_VER
Ë&& _MSC_VER >1400Ë&& deföed (
_M_IX86
)

107 
	~<m©h.h
>

113 
__ölöe
 

114 
	$Êﬂt2öt
 (
Êt
)

115 { 
ötgr
;

117 
_asm


118 { 
Êd
 
Êt


119 
fi°p
 
ötgr


122  
ötgr
 ;

123 
	}
}

127 #i‡(
deföed
(
__GNUC__
Ë&& deföed(
__STDC__
Ë&& __STDC__ && 
__STDC_VERSION__
 >= 199901L)

132 
	~<m©h.h
>

133 
	#Êﬂt2öt
(
Êt
Ë(()(
	`Êo‹
(.5+Êt)))

	)

136 #i‚de‡
DISABLE_FLOAT_API


137 
OPUS_INLINE
 
›us_öt16
 
	$FLOAT2INT16
(
x
)

139 
x
 = x*
CELT_SIG_SCALE
;

140 
x
 = 
	`MAX32
(x, -32768);

141 
x
 = 
	`MIN32
(x, 32767);

142  (
›us_öt16
)
	`Êﬂt2öt
(
x
);

143 
	}
}

	@celt/kiss_fft.c

32 #i‚de‡
SKIP_CONFIG_H


33 #ifde‡
HAVE_CONFIG_H


34 
	~"c⁄fig.h
"

38 
	~"_kiss_f·_guts.h
"

39 
	~"¨ch.h
"

40 
	~"os_suµ‹t.h
"

41 
	~"m©h›s.h
"

42 
	~"°ack_Æloc.h
"

48 
	$kf_bÊy2
(

49 
kiss_f·_˝x
 * 
Fout
,

50 
m
,

51 
N


54 
kiss_f·_˝x
 * 
Fout2
;

55 
i
;

56 ()
m
;

57 #ifde‡
CUSTOM_MODES


58 i‡(
m
==1)

60 
	`˚…_as£π
(
m
==1);

61 
i
=0;i<
N
;i++)

63 
kiss_f·_˝x
 
t
;

64 
Fout2
 = 
Fout
 + 1;

65 
t
 = *
Fout2
;

66 
	`C_SUB
–*
Fout2
 , *
Fout
 , 
t
 );

67 
	`C_ADDTO
–*
Fout
 , 
t
 );

68 
Fout
 += 2;

73 
›us_vÆ16
 
tw
;

74 
tw
 = 
	`QCONST16
(0.7071067812f, 15);

76 
	`˚…_as£π
(
m
==4);

77 
i
=0;i<
N
;i++)

79 
kiss_f·_˝x
 
t
;

80 
Fout2
 = 
Fout
 + 4;

81 
t
 = 
Fout2
[0];

82 
	`C_SUB
–
Fout2
[0] , 
Fout
[0] , 
t
 );

83 
	`C_ADDTO
–
Fout
[0] , 
t
 );

85 
t
.
r
 = 
	`S_MUL
(
	`ADD32_ovÊw
(
Fout2
[1].r, Fout2[1].
i
), 
tw
);

86 
t
.
i
 = 
	`S_MUL
(
	`SUB32_ovÊw
(
Fout2
[1].i, Fout2[1].
r
), 
tw
);

87 
	`C_SUB
–
Fout2
[1] , 
Fout
[1] , 
t
 );

88 
	`C_ADDTO
–
Fout
[1] , 
t
 );

90 
t
.
r
 = 
Fout2
[2].
i
;

91 
t
.
i
 = -
Fout2
[2].
r
;

92 
	`C_SUB
–
Fout2
[2] , 
Fout
[2] , 
t
 );

93 
	`C_ADDTO
–
Fout
[2] , 
t
 );

95 
t
.
r
 = 
	`S_MUL
(
	`SUB32_ovÊw
(
Fout2
[3].
i
, Fout2[3].r), 
tw
);

96 
t
.
i
 = 
	`S_MUL
(
	`NEG32_ovÊw
(
	`ADD32_ovÊw
(
Fout2
[3].i, Fout2[3].
r
)), 
tw
);

97 
	`C_SUB
–
Fout2
[3] , 
Fout
[3] , 
t
 );

98 
	`C_ADDTO
–
Fout
[3] , 
t
 );

99 
Fout
 += 8;

102 
	}
}

104 
	$kf_bÊy4
(

105 
kiss_f·_˝x
 * 
Fout
,

106 c⁄° 
size_t
 
f°ride
,

107 c⁄° 
kiss_f·_°©e
 *
°
,

108 
m
,

109 
N
,

110 
mm


113 
i
;

115 i‡(
m
==1)

118 
i
=0;i<
N
;i++)

120 
kiss_f·_˝x
 
s¸©ch0
, 
s¸©ch1
;

122 
	`C_SUB
–
s¸©ch0
 , *
Fout
, Fout[2] );

123 
	`C_ADDTO
(*
Fout
, Fout[2]);

124 
	`C_ADD
–
s¸©ch1
 , 
Fout
[1] , Fout[3] );

125 
	`C_SUB
–
Fout
[2], *Fout, 
s¸©ch1
 );

126 
	`C_ADDTO
–*
Fout
 , 
s¸©ch1
 );

127 
	`C_SUB
–
s¸©ch1
 , 
Fout
[1] , Fout[3] );

129 
Fout
[1].
r
 = 
	`ADD32_ovÊw
(
s¸©ch0
.r, 
s¸©ch1
.
i
);

130 
Fout
[1].
i
 = 
	`SUB32_ovÊw
(
s¸©ch0
.i, 
s¸©ch1
.
r
);

131 
Fout
[3].
r
 = 
	`SUB32_ovÊw
(
s¸©ch0
.r, 
s¸©ch1
.
i
);

132 
Fout
[3].
i
 = 
	`ADD32_ovÊw
(
s¸©ch0
.i, 
s¸©ch1
.
r
);

133 
Fout
+=4;

136 
j
;

137 
kiss_f·_˝x
 
s¸©ch
[6];

138 c⁄° 
kiss_twiddÀ_˝x
 *
tw1
,*
tw2
,*
tw3
;

139 c⁄° 
m2
=2*
m
;

140 c⁄° 
m3
=3*
m
;

141 
kiss_f·_˝x
 * 
Fout_beg
 = 
Fout
;

142 
i
=0;i<
N
;i++)

144 
Fout
 = 
Fout_beg
 + 
i
*
mm
;

145 
tw3
 = 
tw2
 = 
tw1
 = 
°
->
twiddÀs
;

147 
j
=0;j<
m
;j++)

149 
	`C_MUL
(
s¸©ch
[0],
Fout
[
m
] , *
tw1
 );

150 
	`C_MUL
(
s¸©ch
[1],
Fout
[
m2
] , *
tw2
 );

151 
	`C_MUL
(
s¸©ch
[2],
Fout
[
m3
] , *
tw3
 );

153 
	`C_SUB
–
s¸©ch
[5] , *
Fout
, scratch[1] );

154 
	`C_ADDTO
(*
Fout
, 
s¸©ch
[1]);

155 
	`C_ADD
–
s¸©ch
[3] , scratch[0] , scratch[2] );

156 
	`C_SUB
–
s¸©ch
[4] , scratch[0] , scratch[2] );

157 
	`C_SUB
–
Fout
[
m2
], *Fout, 
s¸©ch
[3] );

158 
tw1
 +
f°ride
;

159 
tw2
 +
f°ride
*2;

160 
tw3
 +
f°ride
*3;

161 
	`C_ADDTO
–*
Fout
 , 
s¸©ch
[3] );

163 
Fout
[
m
].
r
 = 
	`ADD32_ovÊw
(
s¸©ch
[5].r, s¸©ch[4].
i
);

164 
Fout
[
m
].
i
 = 
	`SUB32_ovÊw
(
s¸©ch
[5].i, s¸©ch[4].
r
);

165 
Fout
[
m3
].
r
 = 
	`SUB32_ovÊw
(
s¸©ch
[5].r, s¸©ch[4].
i
);

166 
Fout
[
m3
].
i
 = 
	`ADD32_ovÊw
(
s¸©ch
[5].i, s¸©ch[4].
r
);

167 ++
Fout
;

171 
	}
}

174 #i‚de‡
RADIX_TWO_ONLY


176 
	$kf_bÊy3
(

177 
kiss_f·_˝x
 * 
Fout
,

178 c⁄° 
size_t
 
f°ride
,

179 c⁄° 
kiss_f·_°©e
 *
°
,

180 
m
,

181 
N
,

182 
mm


185 
i
;

186 
size_t
 
k
;

187 c⁄° 
size_t
 
m2
 = 2*
m
;

188 c⁄° 
kiss_twiddÀ_˝x
 *
tw1
,*
tw2
;

189 
kiss_f·_˝x
 
s¸©ch
[5];

190 
kiss_twiddÀ_˝x
 
ïi3
;

192 
kiss_f·_˝x
 * 
Fout_beg
 = 
Fout
;

193 #ifde‡
FIXED_POINT


195 
ïi3
.
i
 = -28378;

197 
ïi3
 = 
°
->
twiddÀs
[
f°ride
*
m
];

199 
i
=0;i<
N
;i++)

201 
Fout
 = 
Fout_beg
 + 
i
*
mm
;

202 
tw1
=
tw2
=
°
->
twiddÀs
;

204 
k
=
m
;

207 
	`C_MUL
(
s¸©ch
[1],
Fout
[
m
] , *
tw1
);

208 
	`C_MUL
(
s¸©ch
[2],
Fout
[
m2
] , *
tw2
);

210 
	`C_ADD
(
s¸©ch
[3],scratch[1],scratch[2]);

211 
	`C_SUB
(
s¸©ch
[0],scratch[1],scratch[2]);

212 
tw1
 +
f°ride
;

213 
tw2
 +
f°ride
*2;

215 
Fout
[
m
].
r
 = 
	`SUB32_ovÊw
(Fout->r, 
	`HALF_OF
(
s¸©ch
[3].r));

216 
Fout
[
m
].
i
 = 
	`SUB32_ovÊw
(Fout->i, 
	`HALF_OF
(
s¸©ch
[3].i));

218 
	`C_MULBYSCALAR
–
s¸©ch
[0] , 
ïi3
.
i
 );

220 
	`C_ADDTO
(*
Fout
,
s¸©ch
[3]);

222 
Fout
[
m2
].
r
 = 
	`ADD32_ovÊw
(Fout[
m
].r, 
s¸©ch
[0].
i
);

223 
Fout
[
m2
].
i
 = 
	`SUB32_ovÊw
(Fout[
m
].i, 
s¸©ch
[0].
r
);

225 
Fout
[
m
].
r
 = 
	`SUB32_ovÊw
(Fout[m].r, 
s¸©ch
[0].
i
);

226 
Fout
[
m
].
i
 = 
	`ADD32_ovÊw
(Fout[m].i, 
s¸©ch
[0].
r
);

228 ++
Fout
;

229 } --
k
);

231 
	}
}

234 #i‚de‡
OVERRIDE_kf_bÊy5


235 
	$kf_bÊy5
(

236 
kiss_f·_˝x
 * 
Fout
,

237 c⁄° 
size_t
 
f°ride
,

238 c⁄° 
kiss_f·_°©e
 *
°
,

239 
m
,

240 
N
,

241 
mm


244 
kiss_f·_˝x
 *
Fout0
,*
Fout1
,*
Fout2
,*
Fout3
,*
Fout4
;

245 
i
, 
u
;

246 
kiss_f·_˝x
 
s¸©ch
[13];

247 c⁄° 
kiss_twiddÀ_˝x
 *
tw
;

248 
kiss_twiddÀ_˝x
 
ya
,
yb
;

249 
kiss_f·_˝x
 * 
Fout_beg
 = 
Fout
;

251 #ifde‡
FIXED_POINT


252 
ya
.
r
 = 10126;

253 
ya
.
i
 = -31164;

254 
yb
.
r
 = -26510;

255 
yb
.
i
 = -19261;

257 
ya
 = 
°
->
twiddÀs
[
f°ride
*
m
];

258 
yb
 = 
°
->
twiddÀs
[
f°ride
*2*
m
];

260 
tw
=
°
->
twiddÀs
;

262 
i
=0;i<
N
;i++)

264 
Fout
 = 
Fout_beg
 + 
i
*
mm
;

265 
Fout0
=
Fout
;

266 
Fout1
=
Fout0
+
m
;

267 
Fout2
=
Fout0
+2*
m
;

268 
Fout3
=
Fout0
+3*
m
;

269 
Fout4
=
Fout0
+4*
m
;

272  
u
=0; u<
m
; ++u ) {

273 
s¸©ch
[0] = *
Fout0
;

275 
	`C_MUL
(
s¸©ch
[1] ,*
Fout1
, 
tw
[
u
*
f°ride
]);

276 
	`C_MUL
(
s¸©ch
[2] ,*
Fout2
, 
tw
[2*
u
*
f°ride
]);

277 
	`C_MUL
(
s¸©ch
[3] ,*
Fout3
, 
tw
[3*
u
*
f°ride
]);

278 
	`C_MUL
(
s¸©ch
[4] ,*
Fout4
, 
tw
[4*
u
*
f°ride
]);

280 
	`C_ADD
–
s¸©ch
[7],scratch[1],scratch[4]);

281 
	`C_SUB
–
s¸©ch
[10],scratch[1],scratch[4]);

282 
	`C_ADD
–
s¸©ch
[8],scratch[2],scratch[3]);

283 
	`C_SUB
–
s¸©ch
[9],scratch[2],scratch[3]);

285 
Fout0
->
r
 = 
	`ADD32_ovÊw
(Fout0->r, ADD32_ovÊw(
s¸©ch
[7].r, scratch[8].r));

286 
Fout0
->
i
 = 
	`ADD32_ovÊw
(Fout0->i, ADD32_ovÊw(
s¸©ch
[7].i, scratch[8].i));

288 
s¸©ch
[5].
r
 = 
	`ADD32_ovÊw
(s¸©ch[0].r, ADD32_ovÊw(
	`S_MUL
(s¸©ch[7].r,
ya
.r), S_MUL(s¸©ch[8].r,
yb
.r)));

289 
s¸©ch
[5].
i
 = 
	`ADD32_ovÊw
(s¸©ch[0].i, ADD32_ovÊw(
	`S_MUL
(s¸©ch[7].i,
ya
.
r
), S_MUL(s¸©ch[8].i,
yb
.r)));

291 
s¸©ch
[6].
r
 = 
	`ADD32_ovÊw
(
	`S_MUL
(s¸©ch[10].
i
,
ya
.i), S_MUL(s¸©ch[9].i,
yb
.i));

292 
s¸©ch
[6].
i
 = 
	`NEG32_ovÊw
(
	`ADD32_ovÊw
(
	`S_MUL
(s¸©ch[10].
r
,
ya
.i), S_MUL(s¸©ch[9].r,
yb
.i)));

294 
	`C_SUB
(*
Fout1
,
s¸©ch
[5],scratch[6]);

295 
	`C_ADD
(*
Fout4
,
s¸©ch
[5],scratch[6]);

297 
s¸©ch
[11].
r
 = 
	`ADD32_ovÊw
(s¸©ch[0].r, ADD32_ovÊw(
	`S_MUL
(s¸©ch[7].r,
yb
.r), S_MUL(s¸©ch[8].r,
ya
.r)));

298 
s¸©ch
[11].
i
 = 
	`ADD32_ovÊw
(s¸©ch[0].i, ADD32_ovÊw(
	`S_MUL
(s¸©ch[7].i,
yb
.
r
), S_MUL(s¸©ch[8].i,
ya
.r)));

299 
s¸©ch
[12].
r
 = 
	`SUB32_ovÊw
(
	`S_MUL
(s¸©ch[9].
i
,
ya
.i), S_MUL(s¸©ch[10].i,
yb
.i));

300 
s¸©ch
[12].
i
 = 
	`SUB32_ovÊw
(
	`S_MUL
(s¸©ch[10].
r
,
yb
.i), S_MUL(s¸©ch[9].r,
ya
.i));

302 
	`C_ADD
(*
Fout2
,
s¸©ch
[11],scratch[12]);

303 
	`C_SUB
(*
Fout3
,
s¸©ch
[11],scratch[12]);

305 ++
Fout0
;++
Fout1
;++
Fout2
;++
Fout3
;++
Fout4
;

308 
	}
}

315 #ifde‡
CUSTOM_MODES


318 
	$compuã_bôªv_èbÀ
(

319 
Fout
,

320 
›us_öt16
 *
f
,

321 c⁄° 
size_t
 
f°ride
,

322 
ö_°ride
,

323 
›us_öt16
 * 
Á˘‹s
,

324 c⁄° 
kiss_f·_°©e
 *
°


327 c⁄° 
p
=*
Á˘‹s
++;

328 c⁄° 
m
=*
Á˘‹s
++;

331 i‡(
m
==1)

333 
j
;

334 
j
=0;j<
p
;j++)

336 *
f
 = 
Fout
+
j
;

337 
f
 +
f°ride
*
ö_°ride
;

340 
j
;

341 
j
=0;j<
p
;j++)

343 
	`compuã_bôªv_èbÀ
–
Fout
 , 
f
, 
f°ride
*
p
, 
ö_°ride
, 
Á˘‹s
,
°
);

344 
f
 +
f°ride
*
ö_°ride
;

345 
Fout
 +
m
;

348 
	}
}

355 
	$kf_Á˘‹
(
n
,
›us_öt16
 * 
Ácbuf
)

357 
p
=4;

358 
i
;

359 
°ages
=0;

360 
nbak
 = 
n
;

364 
n
 % 
p
) {

365 
p
) {

366 4: 
p
 = 2; ;

367 2: 
p
 = 3; ;

368 : 
p
 += 2; ;

370 i‡(
p
>32000 || (
›us_öt32
Ì*(›us_öt32Ì > 
n
)

371 
p
 = 
n
;

373 
n
 /
p
;

374 #ifde‡
RADIX_TWO_ONLY


375 i‡(
p
!=2 &&Ö != 4)

377 i‡(
p
>5)

382 
Ácbuf
[2*
°ages
] = 
p
;

383 i‡(
p
==2 && 
°ages
 > 1)

385 
Ácbuf
[2*
°ages
] = 4;

386 
Ácbuf
[2] = 2;

388 
°ages
++;

389 } 
n
 > 1);

390 
n
 = 
nbak
;

394 
i
=0;i<
°ages
/2;i++)

396 
tmp
;

397 
tmp
 = 
Ácbuf
[2*
i
];

398 
Ácbuf
[2*
i
] = facbuf[2*(
°ages
-i-1)];

399 
Ácbuf
[2*(
°ages
-
i
-1)] = 
tmp
;

401 
i
=0;i<
°ages
;i++)

403 
n
 /
Ácbuf
[2*
i
];

404 
Ácbuf
[2*
i
+1] = 
n
;

407 
	}
}

409 
	$compuã_twiddÀs
(
kiss_twiddÀ_˝x
 *
twiddÀs
, 
nf·
)

411 
i
;

412 #ifde‡
FIXED_POINT


413 
i
=0;i<
nf·
;++i) {

414 
›us_vÆ32
 
pha£
 = -
i
;

415 
	`kf_˚xp2
(
twiddÀs
+
i
, 
	`DIV32
(
	`SHL32
(
pha£
,17),
nf·
));

418 
i
=0;i<
nf·
;++i) {

419 c⁄° 
pi
=3.14159265358979323846264338327;

420 
pha£
 = ( -2*
pi
 /
nf·
 ) * 
i
;

421 
	`kf_˚xp
(
twiddÀs
+
i
, 
pha£
 );

424 
	}
}

426 
	$›us_f·_Æloc_¨ch_c
(
kiss_f·_°©e
 *
°
) {

427 ()
°
;

429 
	}
}

437 
kiss_f·_°©e
 *
	$›us_f·_Æloc_twiddÀs
(
nf·
,* 
mem
,
size_t
 * 
Ànmem
,

438 c⁄° 
kiss_f·_°©e
 *
ba£
, 
¨ch
)

440 
kiss_f·_°©e
 *
°
=
NULL
;

441 
size_t
 
mem√eded
 = (
kiss_f·_°©e
);

443 i‡–
Ànmem
==
NULL
 ) {

444 
°
 = ( 
kiss_f·_°©e
*)
	`KISS_FFT_MALLOC
–
mem√eded
 );

446 i‡(
mem
 !
NULL
 && *
Ànmem
 >
mem√eded
)

447 
°
 = (
kiss_f·_°©e
*)
mem
;

448 *
Ànmem
 = 
mem√eded
;

450 i‡(
°
) {

451 
›us_öt16
 *
bôªv
;

452 
kiss_twiddÀ_˝x
 *
twiddÀs
;

454 
°
->
nf·
=nfft;

455 #ifde‡
FIXED_POINT


456 
°
->
sˇÀ_shi·
 = 
	`˚…_ûog2
(°->
nf·
);

457 i‡(
°
->
nf·
 =1<<°->
sˇÀ_shi·
)

458 
°
->
sˇÀ
 = 
Q15ONE
;

460 
°
->
sˇÀ
 = (1073741824+°->
nf·
/2)/°->nf·>>(15-°->
sˇÀ_shi·
);

462 
°
->
sˇÀ
 = 1.f/
nf·
;

464 i‡(
ba£
 !
NULL
)

466 
°
->
twiddÀs
 = 
ba£
->twiddles;

467 
°
->
shi·
 = 0;

468 
°
->
shi·
 < 32 && 
nf·
<<°->shi· !
ba£
->nfft)

469 
°
->
shi·
++;

470 i‡(
°
->
shi·
>=32)

471 
Áû
;

473 
°
->
twiddÀs
 =ÅwiddÀ†(
kiss_twiddÀ_˝x
*)
	`KISS_FFT_MALLOC
((kiss_twiddÀ_˝x)*
nf·
);

474 
	`compuã_twiddÀs
(
twiddÀs
, 
nf·
);

475 
°
->
shi·
 = -1;

477 i‡(!
	`kf_Á˘‹
(
nf·
,
°
->
Á˘‹s
))

479 
Áû
;

483 
°
->
bôªv
 = bôªv = (
›us_öt16
*)
	`KISS_FFT_MALLOC
((›us_öt16)*
nf·
);

484 i‡(
°
->
bôªv
==
NULL
)

485 
Áû
;

486 
	`compuã_bôªv_èbÀ
(0, 
bôªv
, 1,1, 
°
->
Á˘‹s
,st);

489 i‡(
	`›us_f·_Æloc_¨ch
(
°
, 
¨ch
))

490 
Áû
;

492  
°
;

493 
Áû
:

494 
	`›us_f·_‰ì
(
°
, 
¨ch
);

495  
NULL
;

496 
	}
}

498 
kiss_f·_°©e
 *
	$›us_f·_Æloc
(
nf·
,* 
mem
,
size_t
 * 
Ànmem
, 
¨ch
)

500  
	`›us_f·_Æloc_twiddÀs
(
nf·
, 
mem
, 
Ànmem
, 
NULL
, 
¨ch
);

501 
	}
}

503 
	$›us_f·_‰ì_¨ch_c
(
kiss_f·_°©e
 *
°
) {

504 ()
°
;

505 
	}
}

507 
	$›us_f·_‰ì
(c⁄° 
kiss_f·_°©e
 *
cfg
, 
¨ch
)

509 i‡(
cfg
)

511 
	`›us_f·_‰ì_¨ch
((
kiss_f·_°©e
 *)
cfg
, 
¨ch
);

512 
	`›us_‰ì
((
›us_öt16
*)
cfg
->
bôªv
);

513 i‡(
cfg
->
shi·
 < 0)

514 
	`›us_‰ì
((
kiss_twiddÀ_˝x
*)
cfg
->
twiddÀs
);

515 
	`›us_‰ì
((
kiss_f·_°©e
*)
cfg
);

517 
	}
}

521 
	$›us_f·_im∂
(c⁄° 
kiss_f·_°©e
 *
°
,
kiss_f·_˝x
 *
fout
)

523 
m2
, 
m
;

524 
p
;

525 
L
;

526 
f°ride
[
MAXFACTORS
];

527 
i
;

528 
shi·
;

531 
shi·
 = 
°
->shift>0 ? st->shift : 0;

533 
f°ride
[0] = 1;

534 
L
=0;

536 
p
 = 
°
->
Á˘‹s
[2*
L
];

537 
m
 = 
°
->
Á˘‹s
[2*
L
+1];

538 
f°ride
[
L
+1] = f°ride[L]*
p
;

539 
L
++;

540 } 
m
!=1);

541 
m
 = 
°
->
Á˘‹s
[2*
L
-1];

542 
i
=
L
-1;i>=0;i--)

544 i‡(
i
!=0)

545 
m2
 = 
°
->
Á˘‹s
[2*
i
-1];

547 
m2
 = 1;

548 
°
->
Á˘‹s
[2*
i
])

551 
	`kf_bÊy2
(
fout
, 
m
, 
f°ride
[
i
]);

554 
	`kf_bÊy4
(
fout
,
f°ride
[
i
]<<
shi·
,
°
,
m
, f°ride[i], 
m2
);

556 #i‚de‡
RADIX_TWO_ONLY


558 
	`kf_bÊy3
(
fout
,
f°ride
[
i
]<<
shi·
,
°
,
m
, f°ride[i], 
m2
);

561 
	`kf_bÊy5
(
fout
,
f°ride
[
i
]<<
shi·
,
°
,
m
, f°ride[i], 
m2
);

565 
m
 = 
m2
;

567 
	}
}

569 
	$›us_f·_c
(c⁄° 
kiss_f·_°©e
 *
°
,c⁄° 
kiss_f·_˝x
 *
fö
,kiss_f·_˝x *
fout
)

571 
i
;

572 
›us_vÆ16
 
sˇÀ
;

573 #ifde‡
FIXED_POINT


576 
sˇÀ_shi·
 = 
°
->scale_shift-1;

578 
sˇÀ
 = 
°
->scale;

580 
	`˚…_as£π2
 (
fö
 !
fout
, "In-place FFTÇot supported");

582 
i
=0;i<
°
->
nf·
;i++)

584 
kiss_f·_˝x
 
x
 = 
fö
[
i
];

585 
fout
[
°
->
bôªv
[
i
]].
r
 = 
	`SHR32
(
	`MULT16_32_Q16
(
sˇÀ
, 
x
.r), 
sˇÀ_shi·
);

586 
fout
[
°
->
bôªv
[
i
]].ò
	`SHR32
(
	`MULT16_32_Q16
(
sˇÀ
, 
x
.i), 
sˇÀ_shi·
);

588 
	`›us_f·_im∂
(
°
, 
fout
);

589 
	}
}

592 
	$›us_if·_c
(c⁄° 
kiss_f·_°©e
 *
°
,c⁄° 
kiss_f·_˝x
 *
fö
,kiss_f·_˝x *
fout
)

594 
i
;

595 
	`˚…_as£π2
 (
fö
 !
fout
, "In-place FFTÇot supported");

597 
i
=0;i<
°
->
nf·
;i++)

598 
fout
[
°
->
bôªv
[
i
]] = 
fö
[i];

599 
i
=0;i<
°
->
nf·
;i++)

600 
fout
[
i
].i = -fout[i].i;

601 
	`›us_f·_im∂
(
°
, 
fout
);

602 
i
=0;i<
°
->
nf·
;i++)

603 
fout
[
i
].i = -fout[i].i;

604 
	}
}

	@celt/kiss_fft.h

29 #i‚de‡
KISS_FFT_H


30 
	#KISS_FFT_H


	)

32 
	~<°dlib.h
>

33 
	~<m©h.h
>

34 
	~"¨ch.h
"

35 
	~"˝u_suµ‹t.h
"

37 #ifde‡
__˝lu•lus


41 #ifde‡
USE_SIMD


42 
	~<xmmöåö.h
>

43 
	#kiss_f·_sˇœr
 
__m128


	)

44 
	#KISS_FFT_MALLOC
(
nbyãs
Ë
	`memÆign
(16,nbyãs)

	)

46 
	#KISS_FFT_MALLOC
 
›us_Æloc


	)

49 #ifde‡
FIXED_POINT


50 
	~"¨ch.h
"

52 
	#kiss_f·_sˇœr
 
›us_öt32


	)

53 
	#kiss_twiddÀ_sˇœr
 
›us_öt16


	)

57 #i‚de‡
kiss_f·_sˇœr


59 
	#kiss_f·_sˇœr
 

	)

60 
	#kiss_twiddÀ_sˇœr
 

	)

61 
	#KF_SUFFIX
 
_˚…_sögÀ


	)

66 
kiss_f·_sˇœr
 
r
;

67 
kiss_f·_sˇœr
 
i
;

68 }
	tkiss_f·_˝x
;

71 
kiss_twiddÀ_sˇœr
 
r
;

72 
kiss_twiddÀ_sˇœr
 
i
;

73 }
	tkiss_twiddÀ_˝x
;

75 
	#MAXFACTORS
 8

	)

81 
	s¨ch_f·_°©e
{

82 
is_suµ‹ãd
;

83 *
¥iv
;

84 } 
	t¨ch_f·_°©e
;

86 
	skiss_f·_°©e
{

87 
nf·
;

88 
›us_vÆ16
 
sˇÀ
;

89 #ifde‡
FIXED_POINT


90 
sˇÀ_shi·
;

92 
shi·
;

93 
›us_öt16
 
Á˘‹s
[2*
MAXFACTORS
];

94 c⁄° 
›us_öt16
 *
bôªv
;

95 c⁄° 
kiss_twiddÀ_˝x
 *
twiddÀs
;

96 
¨ch_f·_°©e
 *
¨ch_f·
;

97 } 
	tkiss_f·_°©e
;

99 #i‡
deföed
(
HAVE_ARM_NE10
)

100 
	~"¨m/f·_¨m.h
"

128 
kiss_f·_°©e
 *
›us_f·_Æloc_twiddÀs
(
nf·
,* 
mem
,
size_t
 * 
Ànmem
, c⁄° kiss_f·_°©ê*
ba£
, 
¨ch
);

130 
kiss_f·_°©e
 *
›us_f·_Æloc
(
nf·
,* 
mem
,
size_t
 * 
Ànmem
, 
¨ch
);

142 
›us_f·_c
(c⁄° 
kiss_f·_°©e
 *
cfg
,c⁄° 
kiss_f·_˝x
 *
fö
,kiss_f·_˝x *
fout
);

143 
›us_if·_c
(c⁄° 
kiss_f·_°©e
 *
cfg
,c⁄° 
kiss_f·_˝x
 *
fö
,kiss_f·_˝x *
fout
);

145 
›us_f·_im∂
(c⁄° 
kiss_f·_°©e
 *
°
,
kiss_f·_˝x
 *
fout
);

146 
›us_if·_im∂
(c⁄° 
kiss_f·_°©e
 *
°
,
kiss_f·_˝x
 *
fout
);

148 
›us_f·_‰ì
(c⁄° 
kiss_f·_°©e
 *
cfg
, 
¨ch
);

151 
›us_f·_‰ì_¨ch_c
(
kiss_f·_°©e
 *
°
);

152 
›us_f·_Æloc_¨ch_c
(
kiss_f·_°©e
 *
°
);

154 #i‡!
deföed
(
OVERRIDE_OPUS_FFT
)

156 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
HAVE_ARM_NE10
))

158 (*c⁄° 
OPUS_FFT_ALLOC_ARCH_IMPL
[
OPUS_ARCHMASK
+1])(

159 
kiss_f·_°©e
 *
°
);

161 
	#›us_f·_Æloc_¨ch
(
_°
, 
¨ch
) \

162 ((*
OPUS_FFT_ALLOC_ARCH_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_°
))

	)

164 (*c⁄° 
OPUS_FFT_FREE_ARCH_IMPL
[
OPUS_ARCHMASK
+1])(

165 
kiss_f·_°©e
 *
°
);

166 
	#›us_f·_‰ì_¨ch
(
_°
, 
¨ch
) \

167 ((*
OPUS_FFT_FREE_ARCH_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_°
))

	)

169 (*c⁄° 
OPUS_FFT
[
OPUS_ARCHMASK
+1])(c⁄° 
kiss_f·_°©e
 *
cfg
,

170 c⁄° 
kiss_f·_˝x
 *
fö
, kiss_f·_˝x *
fout
);

171 
	#›us_f·
(
_cfg
, 
_fö
, 
_fout
, 
¨ch
) \

172 ((*
OPUS_FFT
[(
¨ch
)&
OPUS_ARCHMASK
])(
_cfg
, 
_fö
, 
_fout
))

	)

174 (*c⁄° 
OPUS_IFFT
[
OPUS_ARCHMASK
+1])(c⁄° 
kiss_f·_°©e
 *
cfg
,

175 c⁄° 
kiss_f·_˝x
 *
fö
, kiss_f·_˝x *
fout
);

176 
	#›us_if·
(
_cfg
, 
_fö
, 
_fout
, 
¨ch
) \

177 ((*
OPUS_IFFT
[(
¨ch
)&
OPUS_ARCHMASK
])(
_cfg
, 
_fö
, 
_fout
))

	)

181 
	#›us_f·_Æloc_¨ch
(
_°
, 
¨ch
) \

182 (()(
¨ch
), 
	`›us_f·_Æloc_¨ch_c
(
_°
))

	)

184 
	#›us_f·_‰ì_¨ch
(
_°
, 
¨ch
) \

185 (()(
¨ch
), 
	`›us_f·_‰ì_¨ch_c
(
_°
))

	)

187 
	#›us_f·
(
_cfg
, 
_fö
, 
_fout
, 
¨ch
) \

188 (()(
¨ch
), 
	`›us_f·_c
(
_cfg
, 
_fö
, 
_fout
))

	)

190 
	#›us_if·
(
_cfg
, 
_fö
, 
_fout
, 
¨ch
) \

191 (()(
¨ch
), 
	`›us_if·_c
(
_cfg
, 
_fö
, 
_fout
))

	)

196 #ifde‡
__˝lu•lus


	@celt/laplace.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~"œ∂a˚.h
"

34 
	~"m©h›s.h
"

37 
	#LAPLACE_LOG_MINP
 (0)

	)

38 
	#LAPLACE_MINP
 (1<<
LAPLACE_LOG_MINP
)

	)

41 
	#LAPLACE_NMIN
 (16)

	)

44 
	$ec_œ∂a˚_gë_‰eq1
(
fs0
, 
deˇy
)

46 
·
;

47 
·
 = 32768 - 
LAPLACE_MINP
*(2*
LAPLACE_NMIN
Ë- 
fs0
;

48  
·
*(
›us_öt32
)(16384-
deˇy
)>>15;

49 
	}
}

51 
	$ec_œ∂a˚_ícode
(
ec_íc
 *
íc
, *
vÆue
, 
fs
, 
deˇy
)

53 
Ê
;

54 
vÆ
 = *
vÆue
;

55 
Ê
 = 0;

56 i‡(
vÆ
)

58 
s
;

59 
i
;

60 
s
 = -(
vÆ
<0);

61 
vÆ
 = (vÆ+
s
)^s;

62 
Ê
 = 
fs
;

63 
fs
 = 
	`ec_œ∂a˚_gë_‰eq1
(fs, 
deˇy
);

65 
i
=1; 
fs
 > 0 && i < 
vÆ
; i++)

67 
fs
 *= 2;

68 
Ê
 +
fs
+2*
LAPLACE_MINP
;

69 
fs
 = (fs*(
›us_öt32
)
deˇy
)>>15;

72 i‡(!
fs
)

74 
di
;

75 
ndi_max
;

76 
ndi_max
 = (32768-
Ê
+
LAPLACE_MINP
-1)>>
LAPLACE_LOG_MINP
;

77 
ndi_max
 = (ndi_max-
s
)>>1;

78 
di
 = 
	`IMIN
(
vÆ
 - 
i
, 
ndi_max
 - 1);

79 
Ê
 +(2*
di
+1+
s
)*
LAPLACE_MINP
;

80 
fs
 = 
	`IMIN
(
LAPLACE_MINP
, 32768-
Ê
);

81 *
vÆue
 = (
i
+
di
+
s
)^s;

85 
fs
 +
LAPLACE_MINP
;

86 
Ê
 +
fs
&~
s
;

88 
	`˚…_as£π
(
Ê
+
fs
<=32768);

89 
	`˚…_as£π
(
fs
>0);

91 
	`ec_ícode_bö
(
íc
, 
Ê
, fl+
fs
, 15);

92 
	}
}

94 
	$ec_œ∂a˚_decode
(
ec_dec
 *
dec
, 
fs
, 
deˇy
)

96 
vÆ
=0;

97 
Ê
;

98 
fm
;

99 
fm
 = 
	`ec_decode_bö
(
dec
, 15);

100 
Ê
 = 0;

101 i‡(
fm
 >
fs
)

103 
vÆ
++;

104 
Ê
 = 
fs
;

105 
fs
 = 
	`ec_œ∂a˚_gë_‰eq1
(fs, 
deˇy
)+
LAPLACE_MINP
;

107 
fs
 > 
LAPLACE_MINP
 && 
fm
 >
Ê
+2*fs)

109 
fs
 *= 2;

110 
Ê
 +
fs
;

111 
fs
 = ((fs-2*
LAPLACE_MINP
)*(
›us_öt32
)
deˇy
)>>15;

112 
fs
 +
LAPLACE_MINP
;

113 
vÆ
++;

116 i‡(
fs
 <
LAPLACE_MINP
)

118 
di
;

119 
di
 = (
fm
-
Ê
)>>(
LAPLACE_LOG_MINP
+1);

120 
vÆ
 +
di
;

121 
Ê
 +2*
di
*
LAPLACE_MINP
;

123 i‡(
fm
 < 
Ê
+
fs
)

124 
vÆ
 = -val;

126 
Ê
 +
fs
;

128 
	`˚…_as£π
(
Ê
<32768);

129 
	`˚…_as£π
(
fs
>0);

130 
	`˚…_as£π
(
Ê
<=
fm
);

131 
	`˚…_as£π
(
fm
<
	`IMIN
(
Ê
+
fs
,32768));

132 
	`ec_dec_upd©e
(
dec
, 
Ê
, 
	`IMIN
(Ê+
fs
,32768), 32768);

133  
vÆ
;

134 
	}
}

	@celt/laplace.h

29 
	~"íãnc.h
"

30 
	~"ítdec.h
"

39 
ec_œ∂a˚_ícode
(
ec_íc
 *
íc
, *
vÆue
, 
fs
, 
deˇy
);

48 
ec_œ∂a˚_decode
(
ec_dec
 *
dec
, 
fs
, 
deˇy
);

	@celt/mathops.c

34 #ifde‡
HAVE_CONFIG_H


35 
	~"c⁄fig.h
"

38 
	~"m©h›s.h
"

43 
	$isqπ32
(
›us_uöt32
 
_vÆ
){

44 
b
;

45 
g
;

46 
bshi·
;

51 
g
=0;

52 
bshi·
=(
	`EC_ILOG
(
_vÆ
)-1)>>1;

53 
b
=1U<<
bshi·
;

55 
›us_uöt32
 
t
;

56 
t
=(((
›us_uöt32
)
g
<<1)+
b
)<<
bshi·
;

57 if(
t
<=
_vÆ
){

58 
g
+=
b
;

59 
_vÆ
-=
t
;

61 
b
>>=1;

62 
bshi·
--;

64 
bshi·
>=0);

65  
g
;

66 
	}
}

68 #ifde‡
FIXED_POINT


70 
›us_vÆ32
 
	$‰ac_div32
(
›us_vÆ32
 
a
, opus_vÆ32 
b
)

72 
›us_vÆ16
 
r˝
;

73 
›us_vÆ32
 
ªsu…
, 
ªm
;

74 
shi·
 = 
	`˚…_ûog2
(
b
)-29;

75 
a
 = 
	`VSHR32
◊,
shi·
);

76 
b
 = 
	`VSHR32
(b,
shi·
);

78 
r˝
 = 
	`ROUND16
(
	`˚…_r˝
(ROUND16(
b
,16)),3);

79 
ªsu…
 = 
	`MULT16_32_Q15
(
r˝
, 
a
);

80 
ªm
 = 
	`PSHR32
(
a
,2)-
	`MULT32_32_Q31
(
ªsu…
, 
b
);

81 
ªsu…
 = 
	`ADD32
‘esu…, 
	`SHL32
(
	`MULT16_32_Q15
(
r˝
, 
ªm
),2));

82 i‡(
ªsu…
 >= 536870912)

84 i‡(
ªsu…
 <= -536870912)

87  
	`SHL32
(
ªsu…
, 2);

88 
	}
}

91 
›us_vÆ16
 
	$˚…_rsqπ_n‹m
(
›us_vÆ32
 
x
)

93 
›us_vÆ16
 
n
;

94 
›us_vÆ16
 
r
;

95 
›us_vÆ16
 
r2
;

96 
›us_vÆ16
 
y
;

98 
n
 = 
x
-32768;

103 
r
 = 
	`ADD16
(23557, 
	`MULT16_16_Q15
(
n
, ADD16(-13490, MULT16_16_Q15(n, 6713))));

108 
r2
 = 
	`MULT16_16_Q15
(
r
,Ñ);

109 
y
 = 
	`SHL16
(
	`SUB16
(
	`ADD16
(
	`MULT16_16_Q15
(
r2
, 
n
),Ñ2), 16384), 1);

114  
	`ADD16
(
r
, 
	`MULT16_16_Q15
‘, MULT16_16_Q15(
y
,

115 
	`SUB16
(
	`MULT16_16_Q15
(
y
, 12288), 16384))));

116 
	}
}

119 
›us_vÆ32
 
	$˚…_sqπ
(
›us_vÆ32
 
x
)

121 
k
;

122 
›us_vÆ16
 
n
;

123 
›us_vÆ32
 
π
;

124 c⁄° 
›us_vÆ16
 
C
[5] = {23175, 11561, -3011, 1699, -664};

125 i‡(
x
==0)

127 i‡(
x
>=1073741824)

129 
k
 = (
	`˚…_ûog2
(
x
)>>1)-7;

130 
x
 = 
	`VSHR32
(x, 2*
k
);

131 
n
 = 
x
-32768;

132 
π
 = 
	`ADD16
(
C
[0], 
	`MULT16_16_Q15
(
n
, ADD16(C[1], MULT16_16_Q15(n, ADD16(C[2],

133 
	`MULT16_16_Q15
(
n
, 
	`ADD16
(
C
[3], MULT16_16_Q15(n, (C[4])))))))));

134 
π
 = 
	`VSHR32
‘t,7-
k
);

135  
π
;

136 
	}
}

138 
	#L1
 32767

	)

139 
	#L2
 -7651

	)

140 
	#L3
 8277

	)

141 
	#L4
 -626

	)

143 
OPUS_INLINE
 
›us_vÆ16
 
	$_˚…_cos_pi_2
(
›us_vÆ16
 
x
)

145 
›us_vÆ16
 
x2
;

147 
x2
 = 
	`MULT16_16_P15
(
x
,x);

148  
	`ADD16
(1,
	`MIN16
(32766,
	`ADD32
(
	`SUB16
(
L1
,
x2
), 
	`MULT16_16_P15
(x2, ADD32(
L2
, MULT16_16_P15(x2, ADD32(
L3
, MULT16_16_P15(
L4
, x2

150 
	}
}

152 #unde‡
L1


153 #unde‡
L2


154 #unde‡
L3


155 #unde‡
L4


157 
›us_vÆ16
 
	$˚…_cos_n‹m
(
›us_vÆ32
 
x
)

159 
x
 = x&0x0001ffff;

160 i‡(
x
>
	`SHL32
(
	`EXTEND32
(1), 16))

161 
x
 = 
	`SUB32
(
	`SHL32
(
	`EXTEND32
(1), 17),x);

162 i‡(
x
&0x00007fff)

164 i‡(
x
<
	`SHL32
(
	`EXTEND32
(1), 15))

166  
	`_˚…_cos_pi_2
(
	`EXTRACT16
(
x
));

168  
	`NEG16
(
	`_˚…_cos_pi_2
(
	`EXTRACT16
(65536-
x
)));

171 i‡(
x
&0x0000ffff)

173 i‡(
x
&0x0001ffff)

178 
	}
}

181 
›us_vÆ32
 
	$˚…_r˝
(
›us_vÆ32
 
x
)

183 
i
;

184 
›us_vÆ16
 
n
;

185 
›us_vÆ16
 
r
;

186 
	`˚…_sig_as£π
(
x
>0);

187 
i
 = 
	`˚…_ûog2
(
x
);

189 
n
 = 
	`VSHR32
(
x
,
i
-15)-32768;

193 
r
 = 
	`ADD16
(30840, 
	`MULT16_16_Q15
(-15420, 
n
));

197 
r
 = 
	`SUB16
‘, 
	`MULT16_16_Q15
(r,

198 
	`ADD16
(
	`MULT16_16_Q15
(
r
, 
n
), ADD16(r, -32768))));

201 
r
 = 
	`SUB16
‘, 
	`ADD16
(1, 
	`MULT16_16_Q15
(r,

202 
	`ADD16
(
	`MULT16_16_Q15
(
r
, 
n
), ADD16(r, -32768)))));

206  
	`VSHR32
(
	`EXTEND32
(
r
),
i
-16);

207 
	}
}

	@celt/mathops.h

34 #i‚de‡
MATHOPS_H


35 
	#MATHOPS_H


	)

37 
	~"¨ch.h
"

38 
	~"ítcode.h
"

39 
	~"os_suµ‹t.h
"

41 
	#PI
 3.141592653f

	)

44 
	#FRAC_MUL16
(
a
,
b
Ë((16384+((
›us_öt32
)(
›us_öt16
)◊)*(›us_öt16)(b)))>>15)

	)

46 
isqπ32
(
›us_uöt32
 
_vÆ
);

49 #i‡!
deföed
(
FIXED_POINT
Ë|| deföed(
ANALYSIS_C
)

50 
	#cA
 0.43157974f

	)

51 
	#cB
 0.67848403f

	)

52 
	#cC
 0.08595542f

	)

53 
	#cE
 (()
PI
/2)

	)

54 
OPUS_INLINE
 
	$Á°_©™2f
(
y
, 
x
) {

55 
x2
, 
y2
;

56 
x2
 = 
x
*x;

57 
y2
 = 
y
*y;

60 i‡(
x2
 + 
y2
 < 1e-18f)

64 if(
x2
<
y2
){

65 
dí
 = (
y2
 + 
cB
*
x2
Ë* (y2 + 
cC
*x2);

66  -
x
*
y
*(
y2
 + 
cA
*
x2
Ë/ 
dí
 + (y<0 ? -
cE
 : cE);

68 
dí
 = (
x2
 + 
cB
*
y2
Ë* (x2 + 
cC
*y2);

69  
x
*
y
*(
x2
 + 
cA
*
y2
Ë/ 
dí
 + (y<0 ? -
cE
 : cE) - (x*y<0 ? -cE : cE);

71 
	}
}

72 #unde‡
cA


73 #unde‡
cB


74 #unde‡
cC


75 #unde‡
cE


79 #i‚de‡
OVERRIDE_CELT_MAXABS16


80 
OPUS_INLINE
 
›us_vÆ32
 
	$˚…_maxabs16
(c⁄° 
›us_vÆ16
 *
x
, 
Àn
)

82 
i
;

83 
›us_vÆ16
 
maxvÆ
 = 0;

84 
›us_vÆ16
 
mövÆ
 = 0;

85 
i
=0;i<
Àn
;i++)

87 
maxvÆ
 = 
	`MAX16
(maxvÆ, 
x
[
i
]);

88 
mövÆ
 = 
	`MIN16
(mövÆ, 
x
[
i
]);

90  
	`MAX32
(
	`EXTEND32
(
maxvÆ
),-EXTEND32(
mövÆ
));

91 
	}
}

94 #i‚de‡
OVERRIDE_CELT_MAXABS32


95 #ifde‡
FIXED_POINT


96 
OPUS_INLINE
 
›us_vÆ32
 
	$˚…_maxabs32
(c⁄° 
›us_vÆ32
 *
x
, 
Àn
)

98 
i
;

99 
›us_vÆ32
 
maxvÆ
 = 0;

100 
›us_vÆ32
 
mövÆ
 = 0;

101 
i
=0;i<
Àn
;i++)

103 
maxvÆ
 = 
	`MAX32
(maxvÆ, 
x
[
i
]);

104 
mövÆ
 = 
	`MIN32
(mövÆ, 
x
[
i
]);

106  
	`MAX32
(
maxvÆ
, -
mövÆ
);

107 
	}
}

109 
	#˚…_maxabs32
(
x
,
Àn
Ë
	`˚…_maxabs16
(x,Àn)

	)

114 #i‚de‡
FIXED_POINT


116 
	#˚…_sqπ
(
x
Ë(()
	`sqπ
(x))

	)

117 
	#˚…_rsqπ
(
x
Ë(1.f/
	`˚…_sqπ
(x))

	)

118 
	#˚…_rsqπ_n‹m
(
x
Ë(
	`˚…_rsqπ
(x))

	)

119 
	#˚…_cos_n‹m
(
x
Ë(()
	`cos
((.5f*
PI
)*(x)))

	)

120 
	#˚…_r˝
(
x
Ë(1.f/(x))

	)

121 
	#˚…_div
(
a
,
b
Ë(◊)/(b))

	)

122 
	#‰ac_div32
(
a
,
b
Ë(()◊)/(b))

	)

124 #ifde‡
FLOAT_APPROX


130 
OPUS_INLINE
 
	$˚…_log2
(
x
)

132 
öãgî
;

133 
‰ac
;

135 
f
;

136 
›us_uöt32
 
i
;

137 } 
ö
;

138 
ö
.
f
 = 
x
;

139 
öãgî
 = (
ö
.
i
>>23)-127;

140 
ö
.
i
 -
öãgî
<<23;

141 
‰ac
 = 
ö
.
f
 - 1.5f;

142 
‰ac
 = -0.41445418f + frac*(0.95909232f

143 + 
‰ac
*(-0.33951290f + frac*0.16541097f));

144  1+
öãgî
+
‰ac
;

145 
	}
}

148 
OPUS_INLINE
 
	$˚…_exp2
(
x
)

150 
öãgî
;

151 
‰ac
;

153 
f
;

154 
›us_uöt32
 
i
;

155 } 
ªs
;

156 
öãgî
 = 
	`Êo‹
(
x
);

157 i‡(
öãgî
 < -50)

159 
‰ac
 = 
x
-
öãgî
;

161 
ªs
.
f
 = 0.99992522‡+ 
‰ac
 * (0.69583354f

162 + 
‰ac
 * (0.22606716f + 0.078024523f*frac));

163 
ªs
.
i
 = (ªs.ò+ (
öãgî
<<23)) & 0x7fffffff;

164  
ªs
.
f
;

165 
	}
}

168 
	#˚…_log2
(
x
Ë(()(1.442695040888963387*
	`log
(x)))

	)

169 
	#˚…_exp2
(
x
Ë(()
	`exp
(0.6931471805599453094*(x)))

	)

174 #ifde‡
FIXED_POINT


176 
	~"os_suµ‹t.h
"

178 #i‚de‡
OVERRIDE_CELT_ILOG2


180 
OPUS_INLINE
 
›us_öt16
 
	$˚…_ûog2
(
›us_öt32
 
x
)

182 
	`˚…_sig_as£π
(
x
>0);

183  
	`EC_ILOG
(
x
)-1;

184 
	}
}

189 
OPUS_INLINE
 
›us_öt16
 
	$˚…_zlog2
(
›us_vÆ32
 
x
)

191  
x
 <0 ? 0 : 
	`˚…_ûog2
(x);

192 
	}
}

194 
›us_vÆ16
 
˚…_rsqπ_n‹m
(
›us_vÆ32
 
x
);

196 
›us_vÆ32
 
˚…_sqπ
(›us_vÆ32 
x
);

198 
›us_vÆ16
 
˚…_cos_n‹m
(
›us_vÆ32
 
x
);

201 
OPUS_INLINE
 
›us_vÆ16
 
	$˚…_log2
(
›us_vÆ32
 
x
)

203 
i
;

204 
›us_vÆ16
 
n
, 
‰ac
;

207 c⁄° 
›us_vÆ16
 
C
[5] = {-6801+(1<<(13-
DB_SHIFT
)), 15746, -5217, 2545, -1401};

208 i‡(
x
==0)

210 
i
 = 
	`˚…_ûog2
(
x
);

211 
n
 = 
	`VSHR32
(
x
,
i
-15)-32768-16384;

212 
‰ac
 = 
	`ADD16
(
C
[0], 
	`MULT16_16_Q15
(
n
, ADD16(C[1], MULT16_16_Q15(n, ADD16(C[2], MULT16_16_Q15(n, ADD16(C[3], MULT16_16_Q15(n, C[4]))))))));

213  
	`SHL16
(
i
-13,
DB_SHIFT
)+
	`SHR16
(
‰ac
,14-DB_SHIFT);

214 
	}
}

222 
	#D0
 16383

	)

223 
	#D1
 22804

	)

224 
	#D2
 14819

	)

225 
	#D3
 10204

	)

227 
OPUS_INLINE
 
›us_vÆ32
 
	$˚…_exp2_‰ac
(
›us_vÆ16
 
x
)

229 
›us_vÆ16
 
‰ac
;

230 
‰ac
 = 
	`SHL16
(
x
, 4);

231  
	`ADD16
(
D0
, 
	`MULT16_16_Q15
(
‰ac
, ADD16(
D1
, MULT16_16_Q15(‰ac, ADD16(
D2
 , MULT16_16_Q15(
D3
,frac))))));

232 
	}
}

234 
OPUS_INLINE
 
›us_vÆ32
 
	$˚…_exp2
(
›us_vÆ16
 
x
)

236 
öãgî
;

237 
›us_vÆ16
 
‰ac
;

238 
öãgî
 = 
	`SHR16
(
x
,10);

239 i‡(
öãgî
>14)

241 i‡(
öãgî
 < -15)

243 
‰ac
 = 
	`˚…_exp2_‰ac
(
x
-
	`SHL16
(
öãgî
,10));

244  
	`VSHR32
(
	`EXTEND32
(
‰ac
), -
öãgî
-2);

245 
	}
}

247 
›us_vÆ32
 
˚…_r˝
(›us_vÆ32 
x
);

249 
	#˚…_div
(
a
,
b
Ë
	`MULT32_32_Q31
((
›us_vÆ32
)◊),
	`˚…_r˝
(b))

	)

251 
›us_vÆ32
 
‰ac_div32
(›us_vÆ32 
a
, opus_vÆ32 
b
);

253 
	#M1
 32767

	)

254 
	#M2
 -21

	)

255 
	#M3
 -11943

	)

256 
	#M4
 4936

	)

260 
OPUS_INLINE
 
›us_vÆ16
 
	$˚…_©™01
(
›us_vÆ16
 
x
)

262  
	`MULT16_16_P15
(
x
, 
	`ADD32
(
M1
, MULT16_16_P15(x, ADD32(
M2
, MULT16_16_P15(x, ADD32(
M3
, MULT16_16_P15(
M4
, x)))))));

263 
	}
}

265 #unde‡
M1


266 #unde‡
M2


267 #unde‡
M3


268 #unde‡
M4


271 
OPUS_INLINE
 
›us_vÆ16
 
	$˚…_©™2p
(
›us_vÆ16
 
y
, opus_vÆ16 
x
)

273 i‡(
y
 < 
x
)

275 
›us_vÆ32
 
¨g
;

276 
¨g
 = 
	`˚…_div
(
	`SHL32
(
	`EXTEND32
(
y
),15),
x
);

277 i‡(
¨g
 >= 32767)

278 
¨g
 = 32767;

279  
	`SHR16
(
	`˚…_©™01
(
	`EXTRACT16
(
¨g
)),1);

281 
›us_vÆ32
 
¨g
;

282 
¨g
 = 
	`˚…_div
(
	`SHL32
(
	`EXTEND32
(
x
),15),
y
);

283 i‡(
¨g
 >= 32767)

284 
¨g
 = 32767;

285  25736-
	`SHR16
(
	`˚…_©™01
(
	`EXTRACT16
(
¨g
)),1);

287 
	}
}

	@celt/mdct.c

42 #i‚de‡
SKIP_CONFIG_H


43 #ifde‡
HAVE_CONFIG_H


44 
	~"c⁄fig.h
"

48 
	~"md˘.h
"

49 
	~"kiss_f·.h
"

50 
	~"_kiss_f·_guts.h
"

51 
	~<m©h.h
>

52 
	~"os_suµ‹t.h
"

53 
	~"m©h›s.h
"

54 
	~"°ack_Æloc.h
"

56 #i‡
deföed
(
MIPSr1_ASM
)

57 
	~"mùs/md˘_mù§1.h
"

61 #ifde‡
CUSTOM_MODES


63 
	$˛t_md˘_öô
(
md˘_lookup
 *
l
,
N
, 
maxshi·
, 
¨ch
)

65 
i
;

66 
kiss_twiddÀ_sˇœr
 *
åig
;

67 
shi·
;

68 
N2
=
N
>>1;

69 
l
->
n
 = 
N
;

70 
l
->
maxshi·
 = maxshift;

71 
i
=0;i<=
maxshi·
;i++)

73 i‡(
i
==0)

74 
l
->
kf·
[
i
] = 
	`›us_f·_Æloc
(
N
>>2>>i, 0, 0, 
¨ch
);

76 
l
->
kf·
[
i
] = 
	`›us_f·_Æloc_twiddÀs
(
N
>>2>>i, 0, 0,Ü->kf·[0], 
¨ch
);

77 #i‚de‡
ENABLE_TI_DSPLIB55


78 i‡(
l
->
kf·
[
i
]==
NULL
)

82 
l
->
åig
 =Årig = (
kiss_twiddÀ_sˇœr
*)
	`›us_Æloc
((
N
-(
N2
>>
maxshi·
))*(kiss_twiddle_scalar));

83 i‡(
l
->
åig
==
NULL
)

85 
shi·
=0;shi·<=
maxshi·
;shift++)

88 #i‡
	`deföed
(
FIXED_POINT
)

90 
i
=0;i<
N2
;i++)

91 
åig
[
i
] = 
TRIG_UPSCALE
*
	`˚…_cos_n‹m
(
	`DIV32
(
	`ADD32
(
	`SHL32
(
	`EXTEND32
(i),17),
N2
+16384),
N
));

93 
i
=0;i<
N2
;i++)

94 
åig
[
i
] = (
kiss_twiddÀ_sˇœr
)
	`MAX32
(-32767,
	`MIN32
(32767,
	`Êo‹
(.5+32768*
	`cos
(2*
M_PI
*(i+.125)/
N
))));

97 
i
=0;i<
N2
;i++)

98 
åig
[
i
] = (
kiss_twiddÀ_sˇœr
)
	`cos
(2*
PI
*(i+.125)/
N
);

100 
åig
 +
N2
;

101 
N2
 >>= 1;

102 
N
 >>= 1;

105 
	}
}

107 
	$˛t_md˘_˛ór
(
md˘_lookup
 *
l
, 
¨ch
)

109 
i
;

110 
i
=0;i<=
l
->
maxshi·
;i++)

111 
	`›us_f·_‰ì
(
l
->
kf·
[
i
], 
¨ch
);

112 
	`›us_‰ì
((
kiss_twiddÀ_sˇœr
*)
l
->
åig
);

113 
	}
}

118 #i‚de‡
OVERRIDE_˛t_md˘_f‹w¨d


119 
	$˛t_md˘_f‹w¨d_c
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
, kiss_f·_sˇœ∏* 
OPUS_RESTRICT
 
out
,

120 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

122 
i
;

123 
N
, 
N2
, 
N4
;

124 
	`VARDECL
(
kiss_f·_sˇœr
, 
f
);

125 
	`VARDECL
(
kiss_f·_˝x
, 
f2
);

126 c⁄° 
kiss_f·_°©e
 *
°
 = 
l
->
kf·
[
shi·
];

127 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

128 
›us_vÆ16
 
sˇÀ
;

129 #ifde‡
FIXED_POINT


132 
sˇÀ_shi·
 = 
°
->scale_shift-1;

134 
SAVE_STACK
;

135 ()
¨ch
;

136 
sˇÀ
 = 
°
->scale;

138 
N
 = 
l
->
n
;

139 
åig
 = 
l
->trig;

140 
i
=0;i<
shi·
;i++)

142 
N
 >>= 1;

143 
åig
 +
N
;

145 
N2
 = 
N
>>1;

146 
N4
 = 
N
>>2;

148 
	`ALLOC
(
f
, 
N2
, 
kiss_f·_sˇœr
);

149 
	`ALLOC
(
f2
, 
N4
, 
kiss_f·_˝x
);

155 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
+(
ovîœp
>>1);

156 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
N2
-1+(
ovîœp
>>1);

157 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

158 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
+(
ovîœp
>>1);

159 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+(
ovîœp
>>1)-1;

160 
i
=0;i<((
ovîœp
+3)>>2);i++)

163 *
yp
++ = 
	`MULT16_32_Q15
(*
wp2
, 
xp1
[
N2
]Ë+ MULT16_32_Q15(*
wp1
,*
xp2
);

164 *
yp
++ = 
	`MULT16_32_Q15
(*
wp1
, *
xp1
Ë- MULT16_32_Q15(*
wp2
, 
xp2
[-
N2
]);

165 
xp1
+=2;

166 
xp2
-=2;

167 
wp1
+=2;

168 
wp2
-=2;

170 
wp1
 = 
wödow
;

171 
wp2
 = 
wödow
+
ovîœp
-1;

172 ;
i
<
N4
-((
ovîœp
+3)>>2);i++)

175 *
yp
++ = *
xp2
;

176 *
yp
++ = *
xp1
;

177 
xp1
+=2;

178 
xp2
-=2;

180 ;
i
<
N4
;i++)

183 *
yp
++ = -
	`MULT16_32_Q15
(*
wp1
, 
xp1
[-
N2
]Ë+ MULT16_32_Q15(*
wp2
, *
xp2
);

184 *
yp
++ = 
	`MULT16_32_Q15
(*
wp2
, *
xp1
Ë+ MULT16_32_Q15(*
wp1
, 
xp2
[
N2
]);

185 
xp1
+=2;

186 
xp2
-=2;

187 
wp1
+=2;

188 
wp2
-=2;

193 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

194 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

195 
i
=0;i<
N4
;i++)

197 
kiss_f·_˝x
 
yc
;

198 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

199 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

200 
t0
 = 
t
[
i
];

201 
t1
 = 
t
[
N4
+
i
];

202 
ª
 = *
yp
++;

203 
im
 = *
yp
++;

204 
yr
 = 
	`S_MUL
(
ª
,
t0
Ë- S_MUL(
im
,
t1
);

205 
yi
 = 
	`S_MUL
(
im
,
t0
Ë+ S_MUL(
ª
,
t1
);

206 
yc
.
r
 = 
yr
;

207 
yc
.
i
 = 
yi
;

208 
yc
.
r
 = 
	`PSHR32
(
	`MULT16_32_Q16
(
sˇÀ
, yc.r), 
sˇÀ_shi·
);

209 
yc
.
i
 = 
	`PSHR32
(
	`MULT16_32_Q16
(
sˇÀ
, yc.i), 
sˇÀ_shi·
);

210 
f2
[
°
->
bôªv
[
i
]] = 
yc
;

215 
	`›us_f·_im∂
(
°
, 
f2
);

220 c⁄° 
kiss_f·_˝x
 * 
OPUS_RESTRICT
 
Â
 = 
f2
;

221 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

222 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp2
 = 
out
+
°ride
*(
N2
-1);

223 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

225 
i
=0;i<
N4
;i++)

227 
kiss_f·_sˇœr
 
yr
, 
yi
;

228 
yr
 = 
	`S_MUL
(
Â
->
i
,
t
[
N4
+i]Ë- S_MUL(Â->
r
,t[i]);

229 
yi
 = 
	`S_MUL
(
Â
->
r
,
t
[
N4
+
i
]) + S_MUL(fp->i,t[i]);

230 *
yp1
 = 
yr
;

231 *
yp2
 = 
yi
;

232 
Â
++;

233 
yp1
 +2*
°ride
;

234 
yp2
 -2*
°ride
;

237 
RESTORE_STACK
;

238 
	}
}

241 #i‚de‡
OVERRIDE_˛t_md˘_backw¨d


242 
	$˛t_md˘_backw¨d_c
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
, kiss_f·_sˇœ∏* 
OPUS_RESTRICT
 
out
,

243 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wödow
, 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

245 
i
;

246 
N
, 
N2
, 
N4
;

247 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

248 (Ë
¨ch
;

250 
N
 = 
l
->
n
;

251 
åig
 = 
l
->trig;

252 
i
=0;i<
shi·
;i++)

254 
N
 >>= 1;

255 
åig
 +
N
;

257 
N2
 = 
N
>>1;

258 
N4
 = 
N
>>2;

263 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
;

264 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
°ride
*(
N2
-1);

265 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
out
+(
ovîœp
>>1);

266 c⁄° 
kiss_twiddÀ_sˇœr
 * 
OPUS_RESTRICT
 
t
 = &
åig
[0];

267 c⁄° 
›us_öt16
 * 
OPUS_RESTRICT
 
bôªv
 = 
l
->
kf·
[
shi·
]->bitrev;

268 
i
=0;i<
N4
;i++)

270 
ªv
;

271 
kiss_f·_sˇœr
 
yr
, 
yi
;

272 
ªv
 = *
bôªv
++;

273 
yr
 = 
	`ADD32_ovÊw
(
	`S_MUL
(*
xp2
, 
t
[
i
]), S_MUL(*
xp1
,Å[
N4
+i]));

274 
yi
 = 
	`SUB32_ovÊw
(
	`S_MUL
(*
xp1
, 
t
[
i
]), S_MUL(*
xp2
,Å[
N4
+i]));

276 
yp
[2*
ªv
+1] = 
yr
;

277 
yp
[2*
ªv
] = 
yi
;

279 
xp1
+=2*
°ride
;

280 
xp2
-=2*
°ride
;

284 
	`›us_f·_im∂
(
l
->
kf·
[
shi·
], (
kiss_f·_˝x
*)(
out
+(
ovîœp
>>1)));

289 
kiss_f·_sˇœr
 * 
yp0
 = 
out
+(
ovîœp
>>1);

290 
kiss_f·_sˇœr
 * 
yp1
 = 
out
+(
ovîœp
>>1)+
N2
-2;

291 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

294 
i
=0;i<(
N4
+1)>>1;i++)

296 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

297 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

299 
ª
 = 
yp0
[1];

300 
im
 = 
yp0
[0];

301 
t0
 = 
t
[
i
];

302 
t1
 = 
t
[
N4
+
i
];

304 
yr
 = 
	`ADD32_ovÊw
(
	`S_MUL
(
ª
,
t0
), S_MUL(
im
,
t1
));

305 
yi
 = 
	`SUB32_ovÊw
(
	`S_MUL
(
ª
,
t1
), S_MUL(
im
,
t0
));

307 
ª
 = 
yp1
[1];

308 
im
 = 
yp1
[0];

309 
yp0
[0] = 
yr
;

310 
yp1
[1] = 
yi
;

312 
t0
 = 
t
[(
N4
-
i
-1)];

313 
t1
 = 
t
[(
N2
-
i
-1)];

315 
yr
 = 
	`ADD32_ovÊw
(
	`S_MUL
(
ª
,
t0
), S_MUL(
im
,
t1
));

316 
yi
 = 
	`SUB32_ovÊw
(
	`S_MUL
(
ª
,
t1
), S_MUL(
im
,
t0
));

317 
yp1
[0] = 
yr
;

318 
yp0
[1] = 
yi
;

319 
yp0
 += 2;

320 
yp1
 -= 2;

326 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
out
+
ovîœp
-1;

327 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

328 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
;

329 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+
ovîœp
-1;

331 
i
 = 0; i < 
ovîœp
/2; i++)

333 
kiss_f·_sˇœr
 
x1
, 
x2
;

334 
x1
 = *
xp1
;

335 
x2
 = *
yp1
;

336 *
yp1
++ = 
	`SUB32_ovÊw
(
	`MULT16_32_Q15
(*
wp2
, 
x2
), MULT16_32_Q15(*
wp1
, 
x1
));

337 *
xp1
-- = 
	`ADD32_ovÊw
(
	`MULT16_32_Q15
(*
wp1
, 
x2
), MULT16_32_Q15(*
wp2
, 
x1
));

338 
wp1
++;

339 
wp2
--;

342 
	}
}

	@celt/mdct.h

42 #i‚de‡
MDCT_H


43 
	#MDCT_H


	)

45 
	~"›us_deföes.h
"

46 
	~"kiss_f·.h
"

47 
	~"¨ch.h
"

50 
	mn
;

51 
	mmaxshi·
;

52 c⁄° 
kiss_f·_°©e
 *
	mkf·
[4];

53 c⁄° 
kiss_twiddÀ_sˇœr
 * 
OPUS_RESTRICT
 
	måig
;

54 } 
	tmd˘_lookup
;

56 #i‡
deföed
(
HAVE_ARM_NE10
)

57 
	~"¨m/md˘_¨m.h
"

61 
˛t_md˘_öô
(
md˘_lookup
 *
l
,
N
, 
maxshi·
, 
¨ch
);

62 
˛t_md˘_˛ór
(
md˘_lookup
 *
l
, 
¨ch
);

65 
˛t_md˘_f‹w¨d_c
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

66 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

67 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
,

68 
shi·
, 
°ride
, 
¨ch
);

72 
˛t_md˘_backw¨d_c
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

73 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
,

74 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wödow
,

75 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
);

77 #i‡!
deföed
(
OVERRIDE_OPUS_MDCT
)

79 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
HAVE_ARM_NE10
)

81 (*c⁄° 
CLT_MDCT_FORWARD_IMPL
[
OPUS_ARCHMASK
+1])(

82 c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

83 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
, c⁄° 
›us_vÆ16
 *
wödow
,

84 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
);

86 
	#˛t_md˘_f‹w¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
) \

87 ((*
CLT_MDCT_FORWARD_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_l
, 
_ö
, 
_out
, \

88 
_wödow
, 
_ovîœp
, 
_shi·
, \

89 
_°ride
, 
_¨ch
))

	)

91 (*c⁄° 
CLT_MDCT_BACKWARD_IMPL
[
OPUS_ARCHMASK
+1])(

92 c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
,

93 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
out
, c⁄° 
›us_vÆ16
 *
wödow
,

94 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
);

96 
	#˛t_md˘_backw¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
) \

97 (*
CLT_MDCT_BACKWARD_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
_l
, 
_ö
, 
_out
, \

98 
_wödow
, 
_ovîœp
, 
_shi·
, \

99 
_°ride
, 
_¨ch
)

	)

103 
	#˛t_md˘_f‹w¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
) \

104 
	`˛t_md˘_f‹w¨d_c
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
)

	)

106 
	#˛t_md˘_backw¨d
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
) \

107 
	`˛t_md˘_backw¨d_c
(
_l
, 
_ö
, 
_out
, 
_wödow
, 
_ovîœp
, 
_shi·
, 
_°ride
, 
_¨ch
)

	)

	@celt/mfrngcod.h

28 #i‡!
deföed
(
_m‰ngcode_H
)

29 
	#_m‰ngcode_H
 (1)

	)

30 
	~"ítcode.h
"

35 
	#EC_SYM_BITS
 (8)

	)

37 
	#EC_CODE_BITS
 (32)

	)

39 
	#EC_SYM_MAX
 ((1U<<
EC_SYM_BITS
)-1)

	)

41 
	#EC_CODE_SHIFT
 (
EC_CODE_BITS
-
EC_SYM_BITS
-1)

	)

43 
	#EC_CODE_TOP
 (((
›us_uöt32
)1U)<<(
EC_CODE_BITS
-1))

	)

45 
	#EC_CODE_BOT
 (
EC_CODE_TOP
>>
EC_SYM_BITS
)

	)

47 
	#EC_CODE_EXTRA
 ((
EC_CODE_BITS
-2)%
EC_SYM_BITS
+1)

	)

	@celt/mips/celt_mipsr1.h

30 #i‚de‡
__CELT_MIPSR1_H__


31 
	#__CELT_MIPSR1_H__


	)

33 #ifde‡
HAVE_CONFIG_H


34 
	~"c⁄fig.h
"

37 
	#CELT_C


	)

39 
	~"os_suµ‹t.h
"

40 
	~"md˘.h
"

41 
	~<m©h.h
>

42 
	~"˚….h
"

43 
	~"pôch.h
"

44 
	~"b™ds.h
"

45 
	~"modes.h
"

46 
	~"ítcode.h
"

47 
	~"qu™t_b™ds.h
"

48 
	~"øã.h
"

49 
	~"°ack_Æloc.h
"

50 
	~"m©h›s.h
"

51 
	~"Êﬂt_ˇ°.h
"

52 
	~<°d¨g.h
>

53 
	~"˚…_Õc.h
"

54 
	~"vq.h
"

56 
	#OVERRIDE_COMB_FILTER_CONST


	)

57 
	#OVERRIDE_comb_fûãr


	)

58 
	$comb_fûãr
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T0
, 
T1
, 
N
,

59 
›us_vÆ16
 
g0
, opus_vÆ16 
g1
, 
èp£t0
, 
èp£t1
,

60 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
¨ch
)

62 
i
;

63 
›us_vÆ32
 
x0
, 
x1
, 
x2
, 
x3
, 
x4
;

65 ()
¨ch
;

68 
›us_vÆ16
 
g00
, 
g01
, 
g02
, 
g10
, 
g11
, 
g12
;

69 c⁄° 
›us_vÆ16
 
gaös
[3][3] = {

70 {
	`QCONST16
(0.3066406250f, 15), QCONST16(0.2170410156f, 15), QCONST16(0.1296386719f, 15)},

71 {
	`QCONST16
(0.4638671875f, 15), QCONST16(0.2680664062f, 15), QCONST16(0.f, 15)},

72 {
	`QCONST16
(0.7998046875f, 15), QCONST16(0.1000976562f, 15), QCONST16(0.f, 15)}};

74 i‡(
g0
==0 && 
g1
==0)

77 i‡(
x
!=
y
)

78 
	`OPUS_MOVE
(
y
, 
x
, 
N
);

82 
g00
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][0]);

83 
g01
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][1]);

84 
g02
 = 
	`MULT16_16_P15
(
g0
, 
gaös
[
èp£t0
][2]);

85 
g10
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][0]);

86 
g11
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][1]);

87 
g12
 = 
	`MULT16_16_P15
(
g1
, 
gaös
[
èp£t1
][2]);

88 
x1
 = 
x
[-
T1
+1];

89 
x2
 = 
x
[-
T1
 ];

90 
x3
 = 
x
[-
T1
-1];

91 
x4
 = 
x
[-
T1
-2];

93 i‡(
g0
==
g1
 && 
T0
==
T1
 && 
èp£t0
==
èp£t1
)

94 
ovîœp
=0;

96 
i
=0;i<
ovîœp
;i++)

98 
›us_vÆ16
 
f
;

99 
›us_vÆ32
 
ªs
;

100 
f
 = 
	`MULT16_16_Q15
(
wödow
[
i
],window[i]);

101 
x0

x
[
i
-
T1
+2];

103 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g00
)), "r" (()
x
[
i
-
T0
]));

105 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g01
)), "r" (()
	`ADD32
(
x
[
i
-
T0
-1],x[i-T0+1])));

106 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
((
Q15ONE
-
f
),
g02
)), "r" (()
	`ADD32
(
x
[
i
-
T0
-2],x[i-T0+2])));

107 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
(
f
,
g10
)), "r" (()
x2
));

108 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
(
f
,
g11
)), "r" (()
	`ADD32
(
x3
,
x1
)));

109 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
	`MULT16_16_Q15
(
f
,
g12
)), "r" (()
	`ADD32
(
x4
,
x0
)));

111 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
ªs
): "i" (15));

113 
y
[
i
] = 
x
[i] + 
ªs
;

115 
x4
=
x3
;

116 
x3
=
x2
;

117 
x2
=
x1
;

118 
x1
=
x0
;

121 
x4
 = 
x
[
i
-
T1
-2];

122 
x3
 = 
x
[
i
-
T1
-1];

123 
x2
 = 
x
[
i
-
T1
];

124 
x1
 = 
x
[
i
-
T1
+1];

126 i‡(
g1
==0)

129 i‡(
x
!=
y
)

130 
	`OPUS_MOVE
(
y
+
ovîœp
, 
x
+ovîœp, 
N
-overlap);

134 
i
=
ovîœp
;i<
N
;i++)

136 
›us_vÆ32
 
ªs
;

137 
x0
=
x
[
i
-
T1
+2];

139 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
g10
), "r" (()
x2
));

141 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
g11
), "r" (()
	`ADD32
(
x3
,
x1
)));

142 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
g12
), "r" (()
	`ADD32
(
x4
,
x0
)));

143 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
ªs
): "i" (15));

144 
y
[
i
] = 
x
[i] + 
ªs
;

145 
x4
=
x3
;

146 
x3
=
x2
;

147 
x2
=
x1
;

148 
x1
=
x0
;

150 
	}
}

	@celt/mips/fixed_generic_mipsr1.h

33 #i‚de‡
CELT_FIXED_GENERIC_MIPSR1_H


34 
	#CELT_FIXED_GENERIC_MIPSR1_H


	)

36 #unde‡
MULT16_32_Q15_ADD


37 
ölöe
 
	$MULT16_32_Q15_ADD
(
a
, 
b
, 
c
, 
d
) {

38 
m
;

39 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

40 
asm
 vﬁ©ûe("madd $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

41 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

42  
m
;

43 
	}
}

45 #unde‡
MULT16_32_Q15_SUB


46 
ölöe
 
	$MULT16_32_Q15_SUB
(
a
, 
b
, 
c
, 
d
) {

47 
m
;

48 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

49 
asm
 vﬁ©ûe("msub $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

50 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

51  
m
;

52 
	}
}

54 #unde‡
MULT16_16_Q15_ADD


55 
ölöe
 
	$MULT16_16_Q15_ADD
(
a
, 
b
, 
c
, 
d
) {

56 
m
;

57 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

58 
asm
 vﬁ©ûe("madd $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

59 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

60  
m
;

61 
	}
}

63 #unde‡
MULT16_16_Q15_SUB


64 
ölöe
 
	$MULT16_16_Q15_SUB
(
a
, 
b
, 
c
, 
d
) {

65 
m
;

66 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

67 
asm
 vﬁ©ûe("msub $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

68 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

69  
m
;

70 
	}
}

73 #unde‡
MULT16_32_Q16


74 
ölöe
 
	$MULT16_32_Q16
(
a
, 
b
)

76 
c
;

77 
asm
 vﬁ©ûe("MULT $ac1,%0, %1" : : "r" (
a
), "r" (
b
));

78 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
c
): "i" (16));

79  
c
;

80 
	}
}

82 #unde‡
MULT16_32_P16


83 
ölöe
 
	$MULT16_32_P16
(
a
, 
b
)

85 
c
;

86 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (
a
), "r" (
b
));

87 
asm
 vﬁ©ûe("EXTR_R.W %0,$ac1, %1" : "Ù" (
c
): "i" (16));

88  
c
;

89 
	}
}

91 #unde‡
MULT16_32_Q15


92 
ölöe
 
	$MULT16_32_Q15
(
a
, 
b
)

94 
c
;

95 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (
a
), "r" (
b
));

96 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
c
): "i" (15));

97  
c
;

98 
	}
}

100 #unde‡
MULT32_32_Q31


101 
ölöe
 
	$MULT32_32_Q31
(
a
, 
b
)

103 
r
;

104 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (
a
), "r" (
b
));

105 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
r
): "i" (31));

106  
r
;

107 
	}
}

109 #unde‡
PSHR32


110 
ölöe
 
	$PSHR32
(
a
, 
shi·
)

112 
r
;

113 
asm
 vﬁ©ûê("SHRAV_R.W %0, %1, %2" :"Ù" (
r
): "r" (
a
), "r" (
shi·
));

114  
r
;

115 
	}
}

117 #unde‡
MULT16_16_P15


118 
ölöe
 
	$MULT16_16_P15
(
a
, 
b
)

120 
r
;

121 
asm
 vﬁ©ûê("mu»%0, %1, %2" :"Ù" (
r
): "r" (
a
), "r" (
b
));

122 
asm
 vﬁ©ûê("SHRA_R.W %0, %1, %2" : "+r" (
r
): "0" (r), "i"(15));

123  
r
;

124 
	}
}

	@celt/mips/kiss_fft_mipsr1.h

26 #i‚de‡
KISS_FFT_MIPSR1_H


27 
	#KISS_FFT_MIPSR1_H


	)

29 #i‡!
deföed
(
KISS_FFT_GUTS_H
)

33 #ifde‡
FIXED_POINT


35 
	#S_MUL_ADD
(
a
, 
b
, 
c
, 
d
Ë(
	`S_MUL
◊,b)+S_MUL(c,d))

	)

36 
	#S_MUL_SUB
(
a
, 
b
, 
c
, 
d
Ë(
	`S_MUL
◊,b)-S_MUL(c,d))

	)

38 #unde‡
S_MUL_ADD


39 
ölöe
 
	$S_MUL_ADD
(
a
, 
b
, 
c
, 
d
) {

40 
m
;

41 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

42 
asm
 vﬁ©ûe("madd $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

43 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

44  
m
;

45 
	}
}

47 #unde‡
S_MUL_SUB


48 
ölöe
 
	$S_MUL_SUB
(
a
, 
b
, 
c
, 
d
) {

49 
m
;

50 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
), "r" (()
b
));

51 
asm
 vﬁ©ûe("msub $ac1, %0, %1" : : "r" (()
c
), "r" (()
d
));

52 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
): "i" (15));

53  
m
;

54 
	}
}

56 #unde‡
C_MUL


57 
	#C_MUL
(
m
,
a
,
b
Ë(m=
	`C_MUL_fun
◊,b))

	)

58 
ölöe
 
kiss_f·_˝x
 
	$C_MUL_fun
(
kiss_f·_˝x
 
a
, 
kiss_twiddÀ_˝x
 
b
) {

59 
kiss_f·_˝x
 
m
;

61 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
.
r
), "r" (()
b
.r));

62 
asm
 vﬁ©ûe("msub $ac1, %0, %1" : : "r" (()
a
.
i
), "r" (()
b
.i));

63 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
.
r
): "i" (15));

64 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
.
r
), "r" (()
b
.
i
));

65 
asm
 vﬁ©ûe("madd $ac1, %0, %1" : : "r" (()
a
.
i
), "r" (()
b
.
r
));

66 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
.
i
): "i" (15));

68  
m
;

69 
	}
}

70 #unde‡
C_MULC


71 
	#C_MULC
(
m
,
a
,
b
Ë(m=
	`C_MULC_fun
◊,b))

	)

72 
ölöe
 
kiss_f·_˝x
 
	$C_MULC_fun
(
kiss_f·_˝x
 
a
, 
kiss_twiddÀ_˝x
 
b
) {

73 
kiss_f·_˝x
 
m
;

75 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
.
r
), "r" (()
b
.r));

76 
asm
 vﬁ©ûe("madd $ac1, %0, %1" : : "r" (()
a
.
i
), "r" (()
b
.i));

77 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
.
r
): "i" (15));

78 
asm
 vﬁ©ûe("MULT $ac1, %0, %1" : : "r" (()
a
.
i
), "r" (()
b
.
r
));

79 
asm
 vﬁ©ûe("msub $ac1, %0, %1" : : "r" (()
a
.
r
), "r" (()
b
.
i
));

80 
asm
 vﬁ©ûe("EXTR.W %0,$ac1, %1" : "Ù" (
m
.
i
): "i" (15));

82  
m
;

83 
	}
}

87 
	#OVERRIDE_kf_bÊy5


	)

88 
	$kf_bÊy5
(

89 
kiss_f·_˝x
 * 
Fout
,

90 c⁄° 
size_t
 
f°ride
,

91 c⁄° 
kiss_f·_°©e
 *
°
,

92 
m
,

93 
N
,

94 
mm


97 
kiss_f·_˝x
 *
Fout0
,*
Fout1
,*
Fout2
,*
Fout3
,*
Fout4
;

98 
i
, 
u
;

99 
kiss_f·_˝x
 
s¸©ch
[13];

101 c⁄° 
kiss_twiddÀ_˝x
 *
tw
;

102 
kiss_twiddÀ_˝x
 
ya
,
yb
;

103 
kiss_f·_˝x
 * 
Fout_beg
 = 
Fout
;

105 #ifde‡
FIXED_POINT


106 
ya
.
r
 = 10126;

107 
ya
.
i
 = -31164;

108 
yb
.
r
 = -26510;

109 
yb
.
i
 = -19261;

111 
ya
 = 
°
->
twiddÀs
[
f°ride
*
m
];

112 
yb
 = 
°
->
twiddÀs
[
f°ride
*2*
m
];

115 
tw
=
°
->
twiddÀs
;

117 
i
=0;i<
N
;i++)

119 
Fout
 = 
Fout_beg
 + 
i
*
mm
;

120 
Fout0
=
Fout
;

121 
Fout1
=
Fout0
+
m
;

122 
Fout2
=
Fout0
+2*
m
;

123 
Fout3
=
Fout0
+3*
m
;

124 
Fout4
=
Fout0
+4*
m
;

127  
u
=0; u<
m
; ++u ) {

128 
s¸©ch
[0] = *
Fout0
;

131 
	`C_MUL
(
s¸©ch
[1] ,*
Fout1
, 
tw
[
u
*
f°ride
]);

132 
	`C_MUL
(
s¸©ch
[2] ,*
Fout2
, 
tw
[2*
u
*
f°ride
]);

133 
	`C_MUL
(
s¸©ch
[3] ,*
Fout3
, 
tw
[3*
u
*
f°ride
]);

134 
	`C_MUL
(
s¸©ch
[4] ,*
Fout4
, 
tw
[4*
u
*
f°ride
]);

136 
	`C_ADD
–
s¸©ch
[7],scratch[1],scratch[4]);

137 
	`C_SUB
–
s¸©ch
[10],scratch[1],scratch[4]);

138 
	`C_ADD
–
s¸©ch
[8],scratch[2],scratch[3]);

139 
	`C_SUB
–
s¸©ch
[9],scratch[2],scratch[3]);

141 
Fout0
->
r
 +
s¸©ch
[7].r + scratch[8].r;

142 
Fout0
->
i
 +
s¸©ch
[7].i + scratch[8].i;

143 
s¸©ch
[5].
r
 = s¸©ch[0].∏+ 
	`S_MUL_ADD
(s¸©ch[7].r,
ya
.r,s¸©ch[8].r,
yb
.r);

144 
s¸©ch
[5].
i
 = s¸©ch[0].ò+ 
	`S_MUL_ADD
(s¸©ch[7].i,
ya
.
r
,s¸©ch[8].i,
yb
.r);

146 
s¸©ch
[6].
r
 = 
	`S_MUL_ADD
(s¸©ch[10].
i
,
ya
.i,s¸©ch[9].i,
yb
.i);

147 
s¸©ch
[6].
i
 = -
	`S_MUL_ADD
(s¸©ch[10].
r
,
ya
.i,s¸©ch[9].r,
yb
.i);

149 
	`C_SUB
(*
Fout1
,
s¸©ch
[5],scratch[6]);

150 
	`C_ADD
(*
Fout4
,
s¸©ch
[5],scratch[6]);

152 
s¸©ch
[11].
r
 = s¸©ch[0].∏+ 
	`S_MUL_ADD
(s¸©ch[7].r,
yb
.r,s¸©ch[8].r,
ya
.r);

153 
s¸©ch
[11].
i
 = s¸©ch[0].ò+ 
	`S_MUL_ADD
(s¸©ch[7].i,
yb
.
r
,s¸©ch[8].i,
ya
.r);

155 
s¸©ch
[12].
r
 = 
	`S_MUL_SUB
(s¸©ch[9].
i
,
ya
.i,s¸©ch[10].i,
yb
.i);

156 
s¸©ch
[12].
i
 = 
	`S_MUL_SUB
(s¸©ch[10].
r
,
yb
.i,s¸©ch[9].r,
ya
.i);

158 
	`C_ADD
(*
Fout2
,
s¸©ch
[11],scratch[12]);

159 
	`C_SUB
(*
Fout3
,
s¸©ch
[11],scratch[12]);

161 ++
Fout0
;++
Fout1
;++
Fout2
;++
Fout3
;++
Fout4
;

164 
	}
}

	@celt/mips/mdct_mipsr1.h

41 #i‚de‡
__MDCT_MIPSR1_H__


42 
	#__MDCT_MIPSR1_H__


	)

44 #i‚de‡
SKIP_CONFIG_H


45 #ifde‡
HAVE_CONFIG_H


46 
	~"c⁄fig.h
"

50 
	~"md˘.h
"

51 
	~"kiss_f·.h
"

52 
	~"_kiss_f·_guts.h
"

53 
	~<m©h.h
>

54 
	~"os_suµ‹t.h
"

55 
	~"m©h›s.h
"

56 
	~"°ack_Æloc.h
"

59 
	#OVERRIDE_˛t_md˘_f‹w¨d


	)

60 
	$˛t_md˘_f‹w¨d
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
, kiss_f·_sˇœ∏* 
OPUS_RESTRICT
 
out
,

61 c⁄° 
›us_vÆ16
 *
wödow
, 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

63 
i
;

64 
N
, 
N2
, 
N4
;

65 
	`VARDECL
(
kiss_f·_sˇœr
, 
f
);

66 
	`VARDECL
(
kiss_f·_˝x
, 
f2
);

67 c⁄° 
kiss_f·_°©e
 *
°
 = 
l
->
kf·
[
shi·
];

68 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

69 
›us_vÆ16
 
sˇÀ
;

70 #ifde‡
FIXED_POINT


73 
sˇÀ_shi·
 = 
°
->scale_shift-1;

76 ()
¨ch
;

78 
SAVE_STACK
;

79 
sˇÀ
 = 
°
->scale;

81 
N
 = 
l
->
n
;

82 
åig
 = 
l
->trig;

83 
i
=0;i<
shi·
;i++)

85 
N
 >>= 1;

86 
åig
 +
N
;

88 
N2
 = 
N
>>1;

89 
N4
 = 
N
>>2;

91 
	`ALLOC
(
f
, 
N2
, 
kiss_f·_sˇœr
);

92 
	`ALLOC
(
f2
, 
N4
, 
kiss_f·_˝x
);

98 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
+(
ovîœp
>>1);

99 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
N2
-1+(
ovîœp
>>1);

100 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

101 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
+(
ovîœp
>>1);

102 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+(
ovîœp
>>1)-1;

103 
i
=0;i<((
ovîœp
+3)>>2);i++)

106 *
yp
++ = 
	`S_MUL_ADD
(*
wp2
, 
xp1
[
N2
],*
wp1
,*
xp2
);

107 *
yp
++ = 
	`S_MUL_SUB
(*
wp1
, *
xp1
,*
wp2
, 
xp2
[-
N2
]);

108 
xp1
+=2;

109 
xp2
-=2;

110 
wp1
+=2;

111 
wp2
-=2;

113 
wp1
 = 
wödow
;

114 
wp2
 = 
wödow
+
ovîœp
-1;

115 ;
i
<
N4
-((
ovîœp
+3)>>2);i++)

118 *
yp
++ = *
xp2
;

119 *
yp
++ = *
xp1
;

120 
xp1
+=2;

121 
xp2
-=2;

123 ;
i
<
N4
;i++)

126 *
yp
++ = 
	`S_MUL_SUB
(*
wp2
, *
xp2
, *
wp1
, 
xp1
[-
N2
]);

127 *
yp
++ = 
	`S_MUL_ADD
(*
wp2
, *
xp1
, *
wp1
, 
xp2
[
N2
]);

128 
xp1
+=2;

129 
xp2
-=2;

130 
wp1
+=2;

131 
wp2
-=2;

136 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
f
;

137 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

138 
i
=0;i<
N4
;i++)

140 
kiss_f·_˝x
 
yc
;

141 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

142 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

143 
t0
 = 
t
[
i
];

144 
t1
 = 
t
[
N4
+
i
];

145 
ª
 = *
yp
++;

146 
im
 = *
yp
++;

148 
yr
 = 
	`S_MUL_SUB
(
ª
,
t0
,
im
,
t1
);

149 
yi
 = 
	`S_MUL_ADD
(
im
,
t0
,
ª
,
t1
);

151 
yc
.
r
 = 
yr
;

152 
yc
.
i
 = 
yi
;

153 
yc
.
r
 = 
	`PSHR32
(
	`MULT16_32_Q16
(
sˇÀ
, yc.r), 
sˇÀ_shi·
);

154 
yc
.
i
 = 
	`PSHR32
(
	`MULT16_32_Q16
(
sˇÀ
, yc.i), 
sˇÀ_shi·
);

155 
f2
[
°
->
bôªv
[
i
]] = 
yc
;

160 
	`›us_f·_im∂
(
°
, 
f2
);

165 c⁄° 
kiss_f·_˝x
 * 
OPUS_RESTRICT
 
Â
 = 
f2
;

166 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

167 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp2
 = 
out
+
°ride
*(
N2
-1);

168 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

170 
i
=0;i<
N4
;i++)

172 
kiss_f·_sˇœr
 
yr
, 
yi
;

173 
yr
 = 
	`S_MUL_SUB
(
Â
->
i
,
t
[
N4
+i] , fp->
r
,t[i]);

174 
yi
 = 
	`S_MUL_ADD
(
Â
->
r
,
t
[
N4
+
i
] ,fp->i,t[i]);

175 *
yp1
 = 
yr
;

176 *
yp2
 = 
yi
;

177 
Â
++;

178 
yp1
 +2*
°ride
;

179 
yp2
 -2*
°ride
;

182 
RESTORE_STACK
;

183 
	}
}

185 
	#OVERRIDE_˛t_md˘_backw¨d


	)

186 
	$˛t_md˘_backw¨d
(c⁄° 
md˘_lookup
 *
l
, 
kiss_f·_sˇœr
 *
ö
, kiss_f·_sˇœ∏* 
OPUS_RESTRICT
 
out
,

187 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wödow
, 
ovîœp
, 
shi·
, 
°ride
, 
¨ch
)

189 
i
;

190 
N
, 
N2
, 
N4
;

191 c⁄° 
kiss_twiddÀ_sˇœr
 *
åig
;

193 ()
¨ch
;

195 
N
 = 
l
->
n
;

196 
åig
 = 
l
->trig;

197 
i
=0;i<
shi·
;i++)

199 
N
 >>= 1;

200 
åig
 +
N
;

202 
N2
 = 
N
>>1;

203 
N4
 = 
N
>>2;

208 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
ö
;

209 c⁄° 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp2
 = 
ö
+
°ride
*(
N2
-1);

210 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp
 = 
out
+(
ovîœp
>>1);

211 c⁄° 
kiss_twiddÀ_sˇœr
 * 
OPUS_RESTRICT
 
t
 = &
åig
[0];

212 c⁄° 
›us_öt16
 * 
OPUS_RESTRICT
 
bôªv
 = 
l
->
kf·
[
shi·
]->bitrev;

213 
i
=0;i<
N4
;i++)

215 
ªv
;

216 
kiss_f·_sˇœr
 
yr
, 
yi
;

217 
ªv
 = *
bôªv
++;

218 
yr
 = 
	`S_MUL_ADD
(*
xp2
, 
t
[
i
] , *
xp1
,Å[
N4
+i]);

219 
yi
 = 
	`S_MUL_SUB
(*
xp1
, 
t
[
i
] , *
xp2
,Å[
N4
+i]);

221 
yp
[2*
ªv
+1] = 
yr
;

222 
yp
[2*
ªv
] = 
yi
;

224 
xp1
+=2*
°ride
;

225 
xp2
-=2*
°ride
;

229 
	`›us_f·_im∂
(
l
->
kf·
[
shi·
], (
kiss_f·_˝x
*)(
out
+(
ovîœp
>>1)));

234 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp0
 = 
out
+(
ovîœp
>>1);

235 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
+(
ovîœp
>>1)+
N2
-2;

236 c⁄° 
kiss_twiddÀ_sˇœr
 *
t
 = &
åig
[0];

239 
i
=0;i<(
N4
+1)>>1;i++)

241 
kiss_f·_sˇœr
 
ª
, 
im
, 
yr
, 
yi
;

242 
kiss_twiddÀ_sˇœr
 
t0
, 
t1
;

244 
ª
 = 
yp0
[1];

245 
im
 = 
yp0
[0];

246 
t0
 = 
t
[
i
];

247 
t1
 = 
t
[
N4
+
i
];

249 
yr
 = 
	`S_MUL_ADD
(
ª
,
t0
 , 
im
,
t1
);

250 
yi
 = 
	`S_MUL_SUB
(
ª
,
t1
 , 
im
,
t0
);

252 
ª
 = 
yp1
[1];

253 
im
 = 
yp1
[0];

254 
yp0
[0] = 
yr
;

255 
yp1
[1] = 
yi
;

257 
t0
 = 
t
[(
N4
-
i
-1)];

258 
t1
 = 
t
[(
N2
-
i
-1)];

260 
yr
 = 
	`S_MUL_ADD
(
ª
,
t0
,
im
,
t1
);

261 
yi
 = 
	`S_MUL_SUB
(
ª
,
t1
,
im
,
t0
);

262 
yp1
[0] = 
yr
;

263 
yp0
[1] = 
yi
;

264 
yp0
 += 2;

265 
yp1
 -= 2;

271 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
xp1
 = 
out
+
ovîœp
-1;

272 
kiss_f·_sˇœr
 * 
OPUS_RESTRICT
 
yp1
 = 
out
;

273 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp1
 = 
wödow
;

274 c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
wp2
 = 
wödow
+
ovîœp
-1;

276 
i
 = 0; i < 
ovîœp
/2; i++)

278 
kiss_f·_sˇœr
 
x1
, 
x2
;

279 
x1
 = *
xp1
;

280 
x2
 = *
yp1
;

281 *
yp1
++ = 
	`MULT16_32_Q15
(*
wp2
, 
x2
Ë- MULT16_32_Q15(*
wp1
, 
x1
);

282 *
xp1
-- = 
	`MULT16_32_Q15
(*
wp1
, 
x2
Ë+ MULT16_32_Q15(*
wp2
, 
x1
);

283 
wp1
++;

284 
wp2
--;

287 
	}
}

	@celt/mips/pitch_mipsr1.h

34 #i‚de‡
PITCH_MIPSR1_H


35 
	#PITCH_MIPSR1_H


	)

37 
	#OVERRIDE_DUAL_INNER_PROD


	)

38 
ölöe
 
	$duÆ_ö√r_¥od
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

39 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
, 
¨ch
)

41 
j
;

42 
›us_vÆ32
 
xy01
=0;

43 
›us_vÆ32
 
xy02
=0;

45 ()
¨ch
;

47 
asm
 volatile("MULT $ac1, $0, $0");

48 
asm
 volatile("MULT $ac2, $0, $0");

50 
j
=0;j<
N
;j++)

52 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
x
[
j
]), "r" (()
y01
[j]));

53 
asm
 vﬁ©ûe("MADD $ac2, %0, %1" : : "r" (()
x
[
j
]), "r" (()
y02
[j]));

54 ++
j
;

55 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (()
x
[
j
]), "r" (()
y01
[j]));

56 
asm
 vﬁ©ûe("MADD $ac2, %0, %1" : : "r" (()
x
[
j
]), "r" (()
y02
[j]));

58 
asm
 vﬁ©ûê("mÊÿ%0, $ac1": "Ù"(
xy01
));

59 
asm
 vﬁ©ûê("mÊÿ%0, $ac2": "Ù"(
xy02
));

60 *
xy1
 = 
xy01
;

61 *
xy2
 = 
xy02
;

62 
	}
}

64 
ölöe
 
	$xc‹r_kî√l_mùs
(c⁄° 
›us_vÆ16
 * 
x
,

65 c⁄° 
›us_vÆ16
 * 
y
, 
›us_vÆ32
 
sum
[4], 
Àn
)

67 
j
;

68 
›us_vÆ16
 
y_0
, 
y_1
, 
y_2
, 
y_3
;

70 
›us_öt64
 
sum_0
, 
sum_1
, 
sum_2
, 
sum_3
;

71 
sum_0
 = (
›us_öt64
)
sum
[0];

72 
sum_1
 = (
›us_öt64
)
sum
[1];

73 
sum_2
 = (
›us_öt64
)
sum
[2];

74 
sum_3
 = (
›us_öt64
)
sum
[3];

76 
y_3
=0;

77 
y_0
=*
y
++;

78 
y_1
=*
y
++;

79 
y_2
=*
y
++;

80 
j
=0;j<
Àn
-3;j+=4)

82 
›us_vÆ16
 
tmp
;

83 
tmp
 = *
x
++;

84 
y_3
=*
y
++;

86 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_0
);

87 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_1
);

88 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_2
);

89 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_3
);

91 
tmp
=*
x
++;

92 
y_0
=*
y
++;

94 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_1
 );

95 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_2
 );

96 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_3
);

97 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_0
);

99 
tmp
=*
x
++;

100 
y_1
=*
y
++;

102 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_2
 );

103 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_3
 );

104 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_0
);

105 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_1
);

108 
tmp
=*
x
++;

109 
y_2
=*
y
++;

111 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_3
 );

112 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_0
 );

113 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_1
);

114 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_2
);

117 i‡(
j
++<
Àn
)

119 
›us_vÆ16
 
tmp
 = *
x
++;

120 
y_3
=*
y
++;

122 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_0
 );

123 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_1
 );

124 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_2
);

125 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_3
);

128 i‡(
j
++<
Àn
)

130 
›us_vÆ16
 
tmp
=*
x
++;

131 
y_0
=*
y
++;

133 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_1
 );

134 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_2
 );

135 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_3
);

136 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_0
);

139 i‡(
j
<
Àn
)

141 
›us_vÆ16
 
tmp
=*
x
++;

142 
y_1
=*
y
++;

144 
sum_0
 = 
	`__buûtö_mùs_madd
–sum_0, 
tmp
, 
y_2
 );

145 
sum_1
 = 
	`__buûtö_mùs_madd
–sum_1, 
tmp
, 
y_3
 );

146 
sum_2
 = 
	`__buûtö_mùs_madd
–sum_2, 
tmp
, 
y_0
);

147 
sum_3
 = 
	`__buûtö_mùs_madd
–sum_3, 
tmp
, 
y_1
);

151 
sum
[0] = (
›us_vÆ32
)
sum_0
;

152 
sum
[1] = (
›us_vÆ32
)
sum_1
;

153 
sum
[2] = (
›us_vÆ32
)
sum_2
;

154 
sum
[3] = (
›us_vÆ32
)
sum_3
;

155 
	}
}

157 
	#OVERRIDE_XCORR_KERNEL


	)

158 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

159 (()(
¨ch
), 
	`xc‹r_kî√l_mùs
(
x
, 
y
, 
sum
, 
Àn
))

	)

	@celt/mips/vq_mipsr1.h

29 #i‚de‡
__VQ_MIPSR1_H__


30 
	#__VQ_MIPSR1_H__


	)

32 #ifde‡
HAVE_CONFIG_H


33 
	~"c⁄fig.h
"

36 
	~"m©h›s.h
"

37 
	~"¨ch.h
"

39 
	#OVERRIDE_vq_exp_rŸ©i⁄1


	)

40 
	$exp_rŸ©i⁄1
(
˚…_n‹m
 *
X
, 
Àn
, 
°ride
, 
›us_vÆ16
 
c
, opus_vÆ16 
s
)

42 
i
;

43 
›us_vÆ16
 
ms
;

44 
˚…_n‹m
 *
X±r
;

45 
X±r
 = 
X
;

46 
ms
 = 
	`NEG16
(
s
);

47 
i
=0;i<
Àn
-
°ride
;i++)

49 
˚…_n‹m
 
x1
, 
x2
;

50 
x1
 = 
X±r
[0];

51 
x2
 = 
X±r
[
°ride
];

52 
X±r
[
°ride
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x2
), 
s
, 
x1
), 15));

53 *
X±r
++ = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x1
), 
ms
, 
x2
), 15));

55 
X±r
 = &
X
[
Àn
-2*
°ride
-1];

56 
i
=
Àn
-2*
°ride
-1;i>=0;i--)

58 
˚…_n‹m
 
x1
, 
x2
;

59 
x1
 = 
X±r
[0];

60 
x2
 = 
X±r
[
°ride
];

61 
X±r
[
°ride
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x2
), 
s
, 
x1
), 15));

62 *
X±r
-- = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x1
), 
ms
, 
x2
), 15));

64 
	}
}

66 
	#OVERRIDE_ªn‹mÆi£_ve˘‹


	)

67 
	$ªn‹mÆi£_ve˘‹
(
˚…_n‹m
 *
X
, 
N
, 
›us_vÆ16
 
gaö
, 
¨ch
)

69 
i
;

70 #ifde‡
FIXED_POINT


71 
k
;

73 
›us_vÆ32
 
E
 = 
EPSILON
;

74 
›us_vÆ16
 
g
;

75 
›us_vÆ32
 
t
;

76 
˚…_n‹m
 *
x±r
 = 
X
;

77 
X0
, 
X1
;

79 ()
¨ch
;

81 
asm
 volatile("mult $ac1, $0, $0");

82 
asm
 vﬁ©ûe("MTLO %0, $ac1" : :"r" (
E
));

85 
i
=0;i<
N
-2;i+=2)

87 
X0
 = ()*
x±r
++;

88 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (
X0
), "r" (X0));

90 
X1
 = ()*
x±r
++;

91 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (
X1
), "r" (X1));

94 ;
i
<
N
;i++)

96 
X0
 = ()*
x±r
++;

97 
asm
 vﬁ©ûe("MADD $ac1, %0, %1" : : "r" (
X0
), "r" (X0));

100 
asm
 vﬁ©ûe("MFLO %0, $ac1" : "Ù" (
E
));

101 #ifde‡
FIXED_POINT


102 
k
 = 
	`˚…_ûog2
(
E
)>>1;

104 
t
 = 
	`VSHR32
(
E
, 2*(
k
-7));

105 
g
 = 
	`MULT16_16_P15
(
	`˚…_rsqπ_n‹m
(
t
),
gaö
);

107 
x±r
 = 
X
;

108 
i
=0;i<
N
;i++)

110 *
x±r
 = 
	`EXTRACT16
(
	`PSHR32
(
	`MULT16_16
(
g
, *x±r), 
k
+1));

111 
x±r
++;

114 
	}
}

	@celt/modes.c

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	~"˚….h
"

35 
	~"modes.h
"

36 
	~"øã.h
"

37 
	~"os_suµ‹t.h
"

38 
	~"°ack_Æloc.h
"

39 
	~"qu™t_b™ds.h
"

40 
	~"˝u_suµ‹t.h
"

42 c⁄° 
›us_öt16
 
	geb™d5ms
[] = {

48 
	#BITALLOC_SIZE
 11

	)

50 c⁄° 
	gb™d_Æloˇti⁄
[] = {

65 #i‚de‡
CUSTOM_MODES_ONLY


66 #ifde‡
FIXED_POINT


67 
	~"°©ic_modes_fixed.h
"

69 
	~"°©ic_modes_Êﬂt.h
"

73 #i‚de‡
M_PI


74 
	#M_PI
 3.141592653

	)

77 #ifde‡
CUSTOM_MODES


81 
	#BARK_BANDS
 25

	)

82 c⁄° 
›us_öt16
 
	gb¨k_‰eq
[
BARK_BANDS
+1] = {

90 
›us_öt16
 *
	$compuã_eb™ds
(
›us_öt32
 
Fs
, 
‰ame_size
, 
ªs
, *
nbEB™ds
)

92 
›us_öt16
 *
eB™ds
;

93 
i
, 
j
, 
lö
, 
low
, 
high
, 
nB¨k
, 
off£t
=0;

96 i‡(
Fs
 =400*(
›us_öt32
)
‰ame_size
)

98 *
nbEB™ds
 = (
eb™d5ms
)/(eband5ms[0])-1;

99 
eB™ds
 = 
	`›us_Æloc
((
›us_öt16
)*(*
nbEB™ds
+1));

100 
i
=0;i<*
nbEB™ds
+1;i++)

101 
eB™ds
[
i
] = 
eb™d5ms
[i];

102  
eB™ds
;

105 
nB¨k
=1;nB¨k<
BARK_BANDS
;nBark++)

106 i‡(
b¨k_‰eq
[
nB¨k
+1]*2 >
Fs
)

110 
lö
=0;lö<
nB¨k
;lin++)

111 i‡(
b¨k_‰eq
[
lö
+1]-b¨k_‰eq[lö] >
ªs
)

114 
low
 = (
b¨k_‰eq
[
lö
]+
ªs
/2)/res;

115 
high
 = 
nB¨k
-
lö
;

116 *
nbEB™ds
 = 
low
+
high
;

117 
eB™ds
 = 
	`›us_Æloc
((
›us_öt16
)*(*
nbEB™ds
+2));

119 i‡(
eB™ds
==
NULL
)

120  
NULL
;

123 
i
=0;i<
low
;i++)

124 
eB™ds
[
i
] = i;

125 i‡(
low
>0)

126 
off£t
 = 
eB™ds
[
low
-1]*
ªs
 - 
b¨k_‰eq
[
lö
-1];

128 
i
=0;i<
high
;i++)

130 
èrgë
 = 
b¨k_‰eq
[
lö
+
i
];

132 
eB™ds
[
i
+
low
] = (
èrgë
+
off£t
/2+
ªs
)/(2*res)*2;

133 
off£t
 = 
eB™ds
[
i
+
low
]*
ªs
 - 
èrgë
;

136 
i
=0;i<*
nbEB™ds
;i++)

137 i‡(
eB™ds
[
i
] < i)

138 
eB™ds
[
i
] = i;

140 
eB™ds
[*
nbEB™ds
] = (
b¨k_‰eq
[
nB¨k
]+
ªs
)/(2*res)*2;

141 i‡(
eB™ds
[*
nbEB™ds
] > 
‰ame_size
)

142 
eB™ds
[*
nbEB™ds
] = 
‰ame_size
;

143 
i
=1;i<*
nbEB™ds
-1;i++)

145 i‡(
eB™ds
[
i
+1]-eBands[i] <ÉBands[i]-eBands[i-1])

147 
eB™ds
[
i
] -= (2*eBands[i]-eBands[i-1]-eBands[i+1])/2;

151 
i
=
j
=0;i<*
nbEB™ds
;i++)

152 if(
eB™ds
[
i
+1]>eB™ds[
j
])

153 
eB™ds
[++
j
]ÛB™ds[
i
+1];

154 *
nbEB™ds
=
j
;

156 
i
=1;i<*
nbEB™ds
;i++)

159 
	`˚…_as£π
(
eB™ds
[
i
]-eB™ds[i-1]<ÛB™ds[*
nbEB™ds
]-eBands[*nbEBands-1]);

161 
	`˚…_as£π
(
eB™ds
[
i
+1]-eBands[i]<=2*(eBands[i]-eBands[i-1]));

164  
eB™ds
;

165 
	}
}

167 
	$compuã_Æloˇti⁄_èbÀ
(
CELTMode
 *
mode
)

169 
i
, 
j
;

170 *
ÆlocVe˘‹s
;

171 
maxB™ds
 = (
eb™d5ms
)/(eband5ms[0])-1;

173 
mode
->
nbAŒocVe˘‹s
 = 
BITALLOC_SIZE
;

174 
ÆlocVe˘‹s
 = 
	`›us_Æloc
(()*(
BITALLOC_SIZE
*
mode
->
nbEB™ds
));

175 i‡(
ÆlocVe˘‹s
==
NULL
)

179 i‡(
mode
->
Fs
 =400*(
›us_öt32
)mode->
sh‹tMd˘Size
)

181 
i
=0;i<
BITALLOC_SIZE
*
mode
->
nbEB™ds
;i++)

182 
ÆlocVe˘‹s
[
i
] = 
b™d_Æloˇti⁄
[i];

183 
mode
->
ÆlocVe˘‹s
 =állocVectors;

188 
i
=0;i<
BITALLOC_SIZE
;i++)

190 
j
=0;j<
mode
->
nbEB™ds
;j++)

192 
k
;

193 
k
=0;k<
maxB™ds
;k++)

195 i‡(400*(
›us_öt32
)
eb™d5ms
[
k
] > 
mode
->
eB™ds
[
j
]*(›us_öt32)mode->
Fs
/mode->
sh‹tMd˘Size
)

198 i‡(
k
>
maxB™ds
-1)

199 
ÆlocVe˘‹s
[
i
*
mode
->
nbEB™ds
+
j
] = 
b™d_Æloˇti⁄
[i*
maxB™ds
 + maxBands-1];

201 
›us_öt32
 
a0
, 
a1
;

202 
a1
 = 
mode
->
eB™ds
[
j
]*(
›us_öt32
)mode->
Fs
/mode->
sh‹tMd˘Size
 - 400*(›us_öt32)
eb™d5ms
[
k
-1];

203 
a0
 = 400*(
›us_öt32
)
eb™d5ms
[
k
] - 
mode
->
eB™ds
[
j
]*(›us_öt32)mode->
Fs
/mode->
sh‹tMd˘Size
;

204 
ÆlocVe˘‹s
[
i
*
mode
->
nbEB™ds
+
j
] = (
a0
*
b™d_Æloˇti⁄
[i*
maxB™ds
+
k
-1]

205 + 
a1
*
b™d_Æloˇti⁄
[
i
*
maxB™ds
+
k
])/(
a0
+a1);

219 
mode
->
ÆlocVe˘‹s
 =állocVectors;

220 
	}
}

224 
CELTMode
 *
	$›us_cu°om_mode_¸óã
(
›us_öt32
 
Fs
, 
‰ame_size
, *
îr‹
)

226 
i
;

227 #ifde‡
CUSTOM_MODES


228 
CELTMode
 *
mode
=
NULL
;

229 
ªs
;

230 
›us_vÆ16
 *
wödow
;

231 
›us_öt16
 *
logN
;

232 
LM
;

233 
¨ch
 = 
	`›us_£À˘_¨ch
();

234 
ALLOC_STACK
;

235 #i‡!
	`deföed
(
VAR_ARRAYS
Ë&& !deföed(
USE_ALLOCA
)

236 i‡(
globÆ_°ack
==
NULL
)

237 
Áûuª
;

241 #i‚de‡
CUSTOM_MODES_ONLY


242 
i
=0;i<
TOTAL_MODES
;i++)

244 
j
;

245 
j
=0;j<4;j++)

247 i‡(
Fs
 =
°©ic_mode_li°
[
i
]->Fs &&

248 (
‰ame_size
<<
j
Ë=
°©ic_mode_li°
[
i
]->
sh‹tMd˘Size
*°©ic_mode_li°[i]->
nbSh‹tMd˘s
)

250 i‡(
îr‹
)

251 *
îr‹
 = 
OPUS_OK
;

252  (
CELTMode
*)
°©ic_mode_li°
[
i
];

258 #i‚de‡
CUSTOM_MODES


259 i‡(
îr‹
)

260 *
îr‹
 = 
OPUS_BAD_ARG
;

261  
NULL
;

266 i‡(
Fs
 < 8000 || Fs > 96000)

268 i‡(
îr‹
)

269 *
îr‹
 = 
OPUS_BAD_ARG
;

270  
NULL
;

272 i‡(
‰ame_size
 < 40 || frame_size > 1024 || frame_size%2!=0)

274 i‡(
îr‹
)

275 *
îr‹
 = 
OPUS_BAD_ARG
;

276  
NULL
;

279 i‡((
›us_öt32
)
‰ame_size
*1000 < 
Fs
)

281 i‡(
îr‹
)

282 *
îr‹
 = 
OPUS_BAD_ARG
;

283  
NULL
;

286 i‡((
›us_öt32
)
‰ame_size
*75 >
Fs
 && (frame_size%16)==0)

288 
LM
 = 3;

289 } i‡((
›us_öt32
)
‰ame_size
*150 >
Fs
 && (frame_size%8)==0)

291 
LM
 = 2;

292 } i‡((
›us_öt32
)
‰ame_size
*300 >
Fs
 && (frame_size%4)==0)

294 
LM
 = 1;

297 
LM
 = 0;

301 i‡((
›us_öt32
)(
‰ame_size
>>
LM
)*300 > 
Fs
)

303 i‡(
îr‹
)

304 *
îr‹
 = 
OPUS_BAD_ARG
;

305  
NULL
;

308 
mode
 = 
	`›us_Æloc
((
CELTMode
));

309 i‡(
mode
==
NULL
)

310 
Áûuª
;

311 
mode
->
Fs
 = Fs;

316 if(
Fs
 < 12000)

318 
mode
->
¥ìmph
[0] = 
	`QCONST16
(0.3500061035f, 15);

319 
mode
->
¥ìmph
[1] = -
	`QCONST16
(0.1799926758f, 15);

320 
mode
->
¥ìmph
[2] = 
	`QCONST16
(0.2719968125f, 
SIG_SHIFT
);

321 
mode
->
¥ìmph
[3] = 
	`QCONST16
(3.6765136719f, 13);

322 } if(
Fs
 < 24000)

324 
mode
->
¥ìmph
[0] = 
	`QCONST16
(0.6000061035f, 15);

325 
mode
->
¥ìmph
[1] = -
	`QCONST16
(0.1799926758f, 15);

326 
mode
->
¥ìmph
[2] = 
	`QCONST16
(0.4424998650f, 
SIG_SHIFT
);

327 
mode
->
¥ìmph
[3] = 
	`QCONST16
(2.2598876953f, 13);

328 } if(
Fs
 < 40000)

330 
mode
->
¥ìmph
[0] = 
	`QCONST16
(0.7799987793f, 15);

331 
mode
->
¥ìmph
[1] = -
	`QCONST16
(0.1000061035f, 15);

332 
mode
->
¥ìmph
[2] = 
	`QCONST16
(0.7499771125f, 
SIG_SHIFT
);

333 
mode
->
¥ìmph
[3] = 
	`QCONST16
(1.3333740234f, 13);

336 
mode
->
¥ìmph
[0] = 
	`QCONST16
(0.8500061035f, 15);

337 
mode
->
¥ìmph
[1] = 
	`QCONST16
(0.0f, 15);

338 
mode
->
¥ìmph
[2] = 
	`QCONST16
(1.f, 
SIG_SHIFT
);

339 
mode
->
¥ìmph
[3] = 
	`QCONST16
(1.f, 13);

342 
mode
->
maxLM
 = 
LM
;

343 
mode
->
nbSh‹tMd˘s
 = 1<<
LM
;

344 
mode
->
sh‹tMd˘Size
 = 
‰ame_size
/mode->
nbSh‹tMd˘s
;

345 
ªs
 = (
mode
->
Fs
+mode->
sh‹tMd˘Size
)/(2*mode->shortMdctSize);

347 
mode
->
eB™ds
 = 
	`compuã_eb™ds
(
Fs
, mode->
sh‹tMd˘Size
, 
ªs
, &mode->
nbEB™ds
);

348 i‡(
mode
->
eB™ds
==
NULL
)

349 
Áûuª
;

350 #i‡!
	`deföed
(
SMALL_FOOTPRINT
)

353 i‡((
mode
->
eB™ds
[mode->
nbEB™ds
] - mode->eB™ds[mode->nbEB™ds-1])<<
LM
 >

355 
Áûuª
;

359 
mode
->
effEB™ds
 = mode->
nbEB™ds
;

360 
mode
->
eB™ds
[mode->
effEB™ds
] > mode->
sh‹tMd˘Size
)

361 
mode
->
effEB™ds
--;

364 
mode
->
ovîœp
 = ((mode->
sh‹tMd˘Size
>>2)<<2);

366 
	`compuã_Æloˇti⁄_èbÀ
(
mode
);

367 i‡(
mode
->
ÆlocVe˘‹s
==
NULL
)

368 
Áûuª
;

370 
wödow
 = (
›us_vÆ16
*)
	`›us_Æloc
(
mode
->
ovîœp
*(opus_val16));

371 i‡(
wödow
==
NULL
)

372 
Áûuª
;

374 #i‚de‡
FIXED_POINT


375 
i
=0;i<
mode
->
ovîœp
;i++)

376 
wödow
[
i
] = 
Q15ONE
*
	`sö
(.5*
M_PI
* sö(.5*M_PI*(i+.5)/
mode
->
ovîœp
) * sin(.5*M_PI*(i+.5)/mode->overlap));

378 
i
=0;i<
mode
->
ovîœp
;i++)

379 
wödow
[
i
] = 
	`MIN32
(32767,
	`Êo‹
(.5+32768.*
	`sö
(.5*
M_PI
* sö(.5*M_PI*(i+.5)/
mode
->
ovîœp
) * sin(.5*M_PI*(i+.5)/mode->overlap))));

381 
mode
->
wödow
 = window;

383 
logN
 = (
›us_öt16
*)
	`›us_Æloc
(
mode
->
nbEB™ds
*(opus_int16));

384 i‡(
logN
==
NULL
)

385 
Áûuª
;

387 
i
=0;i<
mode
->
nbEB™ds
;i++)

388 
logN
[
i
] = 
	`log2_‰ac
(
mode
->
eB™ds
[i+1]-mode->eB™ds[i], 
BITRES
);

389 
mode
->
logN
 =ÜogN;

391 
	`compuã_pul£_ˇche
(
mode
, mode->
maxLM
);

393 i‡(
	`˛t_md˘_öô
(&
mode
->
md˘
, 2*mode->
sh‹tMd˘Size
*mode->
nbSh‹tMd˘s
,

394 
mode
->
maxLM
, 
¨ch
) == 0)

395 
Áûuª
;

397 i‡(
îr‹
)

398 *
îr‹
 = 
OPUS_OK
;

400  
mode
;

401 
Áûuª
:

402 i‡(
îr‹
)

403 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

404 i‡(
mode
!=
NULL
)

405 
	`›us_cu°om_mode_de°roy
(
mode
);

406  
NULL
;

408 
	}
}

410 #ifde‡
CUSTOM_MODES


411 
	$›us_cu°om_mode_de°roy
(
CELTMode
 *
mode
)

413 
¨ch
 = 
	`›us_£À˘_¨ch
();

415 i‡(
mode
 =
NULL
)

417 #i‚de‡
CUSTOM_MODES_ONLY


419 
i
;

420 
i
=0;i<
TOTAL_MODES
;i++)

422 i‡(
mode
 =
°©ic_mode_li°
[
i
])

429 
	`›us_‰ì
((
›us_öt16
*)
mode
->
eB™ds
);

430 
	`›us_‰ì
((*)
mode
->
ÆlocVe˘‹s
);

432 
	`›us_‰ì
((
›us_vÆ16
*)
mode
->
wödow
);

433 
	`›us_‰ì
((
›us_öt16
*)
mode
->
logN
);

435 
	`›us_‰ì
((
›us_öt16
*)
mode
->
ˇche
.
ödex
);

436 
	`›us_‰ì
((*)
mode
->
ˇche
.
bôs
);

437 
	`›us_‰ì
((*)
mode
->
ˇche
.
ˇps
);

438 
	`˛t_md˘_˛ór
(&
mode
->
md˘
, 
¨ch
);

440 
	`›us_‰ì
((
CELTMode
 *)
mode
);

441 
	}
}

	@celt/modes.h

30 #i‚de‡
MODES_H


31 
	#MODES_H


	)

33 
	~"›us_ty≥s.h
"

34 
	~"˚….h
"

35 
	~"¨ch.h
"

36 
	~"md˘.h
"

37 
	~"íãnc.h
"

38 
	~"ítdec.h
"

40 
	#MAX_PERIOD
 1024

	)

43 
	msize
;

44 c⁄° 
›us_öt16
 *
	mödex
;

45 c⁄° *
	mbôs
;

46 c⁄° *
	mˇps
;

47 } 
	tPul£Cache
;

52 
	sOpusCu°omMode
 {

53 
›us_öt32
 
	mFs
;

54 
	movîœp
;

56 
	mnbEB™ds
;

57 
	meffEB™ds
;

58 
›us_vÆ16
 
	m¥ìmph
[4];

59 c⁄° 
›us_öt16
 *
	meB™ds
;

61 
	mmaxLM
;

62 
	mnbSh‹tMd˘s
;

63 
	msh‹tMd˘Size
;

65 
	mnbAŒocVe˘‹s
;

66 c⁄° *
	mÆlocVe˘‹s
;

67 c⁄° 
›us_öt16
 *
	mlogN
;

69 c⁄° 
›us_vÆ16
 *
	mwödow
;

70 
md˘_lookup
 
	mmd˘
;

71 
Pul£Cache
 
	mˇche
;

	@celt/opus_custom_demo.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~"›us_cu°om.h
"

34 
	~"¨ch.h
"

35 
	~<°dio.h
>

36 
	~<°dlib.h
>

37 
	~<m©h.h
>

38 
	~<°rög.h
>

40 
	#MAX_PACKET
 1275

	)

42 
	$maö
(
¨gc
, *
¨gv
[])

44 
îr
;

45 *
öFûe
, *
outFûe
;

46 
FILE
 *
fö
, *
fout
;

47 
OpusCu°omMode
 *
mode
=
NULL
;

48 
OpusCu°omEncodî
 *
íc
;

49 
OpusCu°omDecodî
 *
dec
;

50 
Àn
;

51 
›us_öt32
 
‰ame_size
, 
ch™√ls
, 
øã
;

52 
byãs_≥r_∑ckë
;

53 
d©a
[
MAX_PACKET
];

54 
com∂exôy
;

55 #i‡!(
	`deföed
 (
FIXED_POINT
Ë&& !deföed(
CUSTOM_MODES
)Ë&& deföed(
RESYNTH
)

56 
i
;

57 
rmsd
 = 0;

59 
cou¡
 = 0;

60 
›us_öt32
 
skù
;

61 
›us_öt16
 *
ö
, *
out
;

62 i‡(
¨gc
 != 9 &&árgc != 8 &&árgc != 7)

64 
	`Ârötf
 (
°dîr
, "Usage:Åest_opus_custom <rate> <channels> <frame size> "

70 
øã
 = (
›us_öt32
)
	`©ﬁ
(
¨gv
[1]);

71 
ch™√ls
 = 
	`©oi
(
¨gv
[2]);

72 
‰ame_size
 = 
	`©oi
(
¨gv
[3]);

73 
mode
 = 
	`›us_cu°om_mode_¸óã
(
øã
, 
‰ame_size
, 
NULL
);

74 i‡(
mode
 =
NULL
)

76 
	`Ârötf
(
°dîr
, "failedÅo createá mode\n");

80 
byãs_≥r_∑ckë
 = 
	`©oi
(
¨gv
[4]);

81 i‡(
byãs_≥r_∑ckë
 < 0 || byãs_≥r_∑ckë > 
MAX_PACKET
)

83 
	`Ârötf
 (
°dîr
, "bytesÖerÖacket must be between 0ánd %d\n",

84 
MAX_PACKET
);

88 
öFûe
 = 
¨gv
[
¨gc
-2];

89 
fö
 = 
	`f›í
(
öFûe
, "rb");

90 i‡(!
fö
)

92 
	`Ârötf
 (
°dîr
, "CouldÇŸ o≥¿öpuàfûê%s\n", 
¨gv
[
¨gc
-2]);

95 
outFûe
 = 
¨gv
[
¨gc
-1];

96 
fout
 = 
	`f›í
(
outFûe
, "wb+");

97 i‡(!
fout
)

99 
	`Ârötf
 (
°dîr
, "CouldÇŸ o≥¿ouçuàfûê%s\n", 
¨gv
[
¨gc
-1]);

100 
	`f˛o£
(
fö
);

104 
íc
 = 
	`›us_cu°om_ícodî_¸óã
(
mode
, 
ch™√ls
, &
îr
);

105 i‡(
îr
 != 0)

107 
	`Ârötf
(
°dîr
, "FaûedÅÿ¸óãÅhêícodî: %s\n", 
	`›us_°ªº‹
(
îr
));

108 
	`f˛o£
(
fö
);

109 
	`f˛o£
(
fout
);

112 
dec
 = 
	`›us_cu°om_decodî_¸óã
(
mode
, 
ch™√ls
, &
îr
);

113 i‡(
îr
 != 0)

115 
	`Ârötf
(
°dîr
, "FaûedÅÿ¸óãÅhêdecodî: %s\n", 
	`›us_°ªº‹
(
îr
));

116 
	`f˛o£
(
fö
);

117 
	`f˛o£
(
fout
);

120 
	`›us_cu°om_decodî_˘l
(
dec
, 
	`OPUS_GET_LOOKAHEAD
(&
skù
));

122 i‡(
¨gc
>7)

124 
com∂exôy
=
	`©oi
(
¨gv
[5]);

125 
	`›us_cu°om_ícodî_˘l
(
íc
,
	`OPUS_SET_COMPLEXITY
(
com∂exôy
));

128 
ö
 = (
›us_öt16
*)
	`mÆloc
(
‰ame_size
*
ch™√ls
*(opus_int16));

129 
out
 = (
›us_öt16
*)
	`mÆloc
(
‰ame_size
*
ch™√ls
*(opus_int16));

131 !
	`„of
(
fö
))

133 
ªt
;

134 
îr
 = 
	`‰ód
(
ö
, (), 
‰ame_size
*
ch™√ls
, 
fö
);

135 i‡(
	`„of
(
fö
))

137 
Àn
 = 
	`›us_cu°om_ícode
(
íc
, 
ö
, 
‰ame_size
, 
d©a
, 
byãs_≥r_∑ckë
);

138 i‡(
Àn
 <= 0)

139 
	`Ârötf
 (
°dîr
, "›us_cu°om_ícode(ËÁûed: %s\n", 
	`›us_°ªº‹
(
Àn
));

143 
îr‹s
 = 0;

144 
eid
 = 0;

146 
i
=0;i<
Àn
*8;i++)

148 i‡(
	`ønd
()%
	`©oi
(
¨gv
[8])==0)

150 i‡(
i
<64)

152 
îr‹s
++;

153 
eid
 = 
i
;

155 
d©a
[
i
/8] ^= 1<<(7-(i%8));

158 i‡(
îr‹s
 == 1)

159 
d©a
[
eid
/8] ^= 1<<(7-(eid%8));

160 i‡(
îr‹s
%2 == 1)

161 
d©a
[
	`ønd
()%8] ^= 1<<rand()%8;

166 i‡(
¨gc
==9 && 
	`ønd
()%1000<
	`©oi
(
¨gv
[argc-3]))

168 
ªt
 = 
	`›us_cu°om_decode
(
dec
, 
NULL
, 
Àn
, 
out
, 
‰ame_size
);

170 
ªt
 = 
	`›us_cu°om_decode
(
dec
, 
d©a
, 
Àn
, 
out
, 
‰ame_size
);

171 i‡(
ªt
 < 0)

172 
	`Ârötf
(
°dîr
, "›us_cu°om_decode(ËÁûed: %s\n", 
	`›us_°ªº‹
(
ªt
));

174 
i
=0;i<
ªt
*
ch™√ls
;i++)

175 
out
[
i
] = 
ö
[i];

177 #i‡!(
	`deföed
 (
FIXED_POINT
Ë&& !deföed(
CUSTOM_MODES
)Ë&& deföed(
RESYNTH
)

178 
i
=0;i<
ªt
*
ch™√ls
;i++)

180 
rmsd
 +(
ö
[
i
]-
out
[i])*1.0*(in[i]-out[i]);

184 
cou¡
++;

185 
	`fwrôe
(
out
+
skù
*
ch™√ls
, (), (
ªt
-skù)*ch™√ls, 
fout
);

186 
skù
 = 0;

188 
	`PRINT_MIPS
(
°dîr
);

190 
	`›us_cu°om_ícodî_de°roy
(
íc
);

191 
	`›us_cu°om_decodî_de°roy
(
dec
);

192 
	`f˛o£
(
fö
);

193 
	`f˛o£
(
fout
);

194 
	`›us_cu°om_mode_de°roy
(
mode
);

195 
	`‰ì
(
ö
);

196 
	`‰ì
(
out
);

197 #i‡!(
	`deföed
 (
FIXED_POINT
Ë&& !deföed(
CUSTOM_MODES
)Ë&& deföed(
RESYNTH
)

198 i‡(
rmsd
 > 0)

200 
rmsd
 = 
	`sqπ
‘msd/(1.0*
‰ame_size
*
ch™√ls
*
cou¡
));

201 
	`Ârötf
 (
°dîr
, "Error:Éncoder doesn't match decoder\n");

202 
	`Ârötf
 (
°dîr
, "RMS mism©ch i†%f\n", 
rmsd
);

205 
	`Ârötf
 (
°dîr
, "Encoder matches decoder!!\n");

209 
	}
}

	@celt/os_support.h

31 #i‚de‡
OS_SUPPORT_H


32 
	#OS_SUPPORT_H


	)

34 #ifde‡
CUSTOM_SUPPORT


35 
	~"cu°om_suµ‹t.h
"

38 
	~"›us_ty≥s.h
"

39 
	~"›us_deföes.h
"

41 
	~<°rög.h
>

42 
	~<°dio.h
>

43 
	~<°dlib.h
>

46 #i‚de‡
OVERRIDE_OPUS_ALLOC


47 
OPUS_INLINE
 *
	$›us_Æloc
 (
size_t
 
size
)

49  
	`mÆloc
(
size
);

50 
	}
}

54 #i‚de‡
OVERRIDE_OPUS_ALLOC_SCRATCH


55 
OPUS_INLINE
 *
	$›us_Æloc_s¸©ch
 (
size_t
 
size
)

58  
	`›us_Æloc
(
size
);

59 
	}
}

63 #i‚de‡
OVERRIDE_OPUS_FREE


64 
OPUS_INLINE
 
	$›us_‰ì
 (*
±r
)

66 
	`‰ì
(
±r
);

67 
	}
}

71 #i‚de‡
OVERRIDE_OPUS_COPY


72 
	#OPUS_COPY
(
d°
, 
§c
, 
n
Ë(
	`mem˝y
((d°), (§c), (n)*(*(d°)Ë+ 0*((d°)-(§c)Ë))

	)

77 #i‚de‡
OVERRIDE_OPUS_MOVE


78 
	#OPUS_MOVE
(
d°
, 
§c
, 
n
Ë(
	`memmove
((d°), (§c), (n)*(*(d°)Ë+ 0*((d°)-(§c)Ë))

	)

82 #i‚de‡
OVERRIDE_OPUS_CLEAR


83 
	#OPUS_CLEAR
(
d°
, 
n
Ë(
	`mem£t
((d°), 0, (n)*(*(d°))))

	)

	@celt/pitch.c

34 #ifde‡
HAVE_CONFIG_H


35 
	~"c⁄fig.h
"

38 
	~"pôch.h
"

39 
	~"os_suµ‹t.h
"

40 
	~"modes.h
"

41 
	~"°ack_Æloc.h
"

42 
	~"m©h›s.h
"

43 
	~"˚…_Õc.h
"

45 
föd_be°_pôch
(
›us_vÆ32
 *
xc‹r
, 
›us_vÆ16
 *
y
, 
Àn
,

46 
max_pôch
, *
be°_pôch


47 #ifde‡
FIXED_POINT


48 , 
yshi·
, 
›us_vÆ32
 
maxc‹r


52 
	gi
, 
	gj
;

53 
›us_vÆ32
 
	gSyy
=1;

54 
›us_vÆ16
 
	gbe°_num
[2];

55 
›us_vÆ32
 
	gbe°_dí
[2];

56 #ifde‡
FIXED_POINT


57 
	gxshi·
;

59 
	gxshi·
 = 
˚…_ûog2
(
maxc‹r
)-14;

62 
	gbe°_num
[0] = -1;

63 
	gbe°_num
[1] = -1;

64 
	gbe°_dí
[0] = 0;

65 
	gbe°_dí
[1] = 0;

66 
	gbe°_pôch
[0] = 0;

67 
	gbe°_pôch
[1] = 1;

68 
	gj
=0;j<
	gÀn
;j++)

69 
	gSyy
 = 
ADD32
(
Syy
, 
SHR32
(
MULT16_16
(
y
[
j
],y[j]), 
yshi·
));

70 
	gi
=0;i<
	gmax_pôch
;i++)

72 i‡(
	gxc‹r
[
i
]>0)

74 
›us_vÆ16
 
	gnum
;

75 
›us_vÆ32
 
	gxc‹r16
;

76 
	gxc‹r16
 = 
EXTRACT16
(
VSHR32
(
xc‹r
[
i
], 
xshi·
));

77 #i‚de‡
FIXED_POINT


80 
	gxc‹r16
 *= 1e-12f;

82 
	gnum
 = 
MULT16_16_Q15
(
xc‹r16
,xcorr16);

83 i‡(
MULT16_32_Q15
(
num
,
be°_dí
[1]Ë> MULT16_32_Q15(
be°_num
[1],
Syy
))

85 i‡(
MULT16_32_Q15
(
num
,
be°_dí
[0]Ë> MULT16_32_Q15(
be°_num
[0],
Syy
))

87 
	gbe°_num
[1] = 
be°_num
[0];

88 
	gbe°_dí
[1] = 
be°_dí
[0];

89 
	gbe°_pôch
[1] = 
be°_pôch
[0];

90 
	gbe°_num
[0] = 
num
;

91 
	gbe°_dí
[0] = 
Syy
;

92 
	gbe°_pôch
[0] = 
i
;

94 
	gbe°_num
[1] = 
num
;

95 
	gbe°_dí
[1] = 
Syy
;

96 
	gbe°_pôch
[1] = 
i
;

100 
	gSyy
 +
SHR32
(
MULT16_16
(
y
[
i
+
Àn
],y[i+Àn]),
yshi·
) - SHR32(MULT16_16(y[i],y[i]),yshift);

101 
	gSyy
 = 
MAX32
(1, 
Syy
);

105 
	$˚…_fú5
(
›us_vÆ16
 *
x
,

106 c⁄° 
›us_vÆ16
 *
num
,

107 
N
)

109 
i
;

110 
›us_vÆ16
 
num0
, 
num1
, 
num2
, 
num3
, 
num4
;

111 
›us_vÆ32
 
mem0
, 
mem1
, 
mem2
, 
mem3
, 
mem4
;

112 
num0
=
num
[0];

113 
num1
=
num
[1];

114 
num2
=
num
[2];

115 
num3
=
num
[3];

116 
num4
=
num
[4];

117 
mem0
=0;

118 
mem1
=0;

119 
mem2
=0;

120 
mem3
=0;

121 
mem4
=0;

122 
i
=0;i<
N
;i++)

124 
›us_vÆ32
 
sum
 = 
	`SHL32
(
	`EXTEND32
(
x
[
i
]), 
SIG_SHIFT
);

125 
sum
 = 
	`MAC16_16
(sum,
num0
,
mem0
);

126 
sum
 = 
	`MAC16_16
(sum,
num1
,
mem1
);

127 
sum
 = 
	`MAC16_16
(sum,
num2
,
mem2
);

128 
sum
 = 
	`MAC16_16
(sum,
num3
,
mem3
);

129 
sum
 = 
	`MAC16_16
(sum,
num4
,
mem4
);

130 
mem4
 = 
mem3
;

131 
mem3
 = 
mem2
;

132 
mem2
 = 
mem1
;

133 
mem1
 = 
mem0
;

134 
mem0
 = 
x
[
i
];

135 
x
[
i
] = 
	`ROUND16
(
sum
, 
SIG_SHIFT
);

137 
	}
}

140 
	$pôch_downßm∂e
(
˚…_sig
 * 
OPUS_RESTRICT
 
x
[], 
›us_vÆ16
 * OPUS_RESTRICT 
x_Õ
,

141 
Àn
, 
C
, 
¨ch
)

143 
i
;

144 
›us_vÆ32
 
ac
[5];

145 
›us_vÆ16
 
tmp
=
Q15ONE
;

146 
›us_vÆ16
 
Õc
[4];

147 
›us_vÆ16
 
Õc2
[5];

148 
›us_vÆ16
 
c1
 = 
	`QCONST16
(.8f,15);

149 #ifde‡
FIXED_POINT


150 
shi·
;

151 
›us_vÆ32
 
maxabs
 = 
	`˚…_maxabs32
(
x
[0], 
Àn
);

152 i‡(
C
==2)

154 
›us_vÆ32
 
maxabs_1
 = 
	`˚…_maxabs32
(
x
[1], 
Àn
);

155 
maxabs
 = 
	`MAX32
(maxabs, 
maxabs_1
);

157 i‡(
maxabs
<1)

158 
maxabs
=1;

159 
shi·
 = 
	`˚…_ûog2
(
maxabs
)-10;

160 i‡(
shi·
<0)

161 
shi·
=0;

162 i‡(
C
==2)

163 
shi·
++;

165 
i
=1;i<
Àn
>>1;i++)

166 
x_Õ
[
i
] = 
	`SHR32
(
	`HALF32
(HALF32(
x
[0][(2*i-1)]+x[0][(2*i+1)])+x[0][2*i]), 
shi·
);

167 
x_Õ
[0] = 
	`SHR32
(
	`HALF32
(HALF32(
x
[0][1])+x[0][0]), 
shi·
);

168 i‡(
C
==2)

170 
i
=1;i<
Àn
>>1;i++)

171 
x_Õ
[
i
] +
	`SHR32
(
	`HALF32
(HALF32(
x
[1][(2*i-1)]+x[1][(2*i+1)])+x[1][2*i]), 
shi·
);

172 
x_Õ
[0] +
	`SHR32
(
	`HALF32
(HALF32(
x
[1][1])+x[1][0]), 
shi·
);

175 
	`_˚…_autoc‹r
(
x_Õ
, 
ac
, 
NULL
, 0,

176 4, 
Àn
>>1, 
¨ch
);

179 #ifde‡
FIXED_POINT


180 
ac
[0] +
	`SHR32
(ac[0],13);

182 
ac
[0] *= 1.0001f;

185 
i
=1;i<=4;i++)

188 #ifde‡
FIXED_POINT


189 
ac
[
i
] -
	`MULT16_32_Q15
(2*i*i,ác[i]);

191 
ac
[
i
] -=ác[i]*(.008f*i)*(.008f*i);

195 
	`_˚…_Õc
(
Õc
, 
ac
, 4);

196 
i
=0;i<4;i++)

198 
tmp
 = 
	`MULT16_16_Q15
(
	`QCONST16
(.9f,15),Åmp);

199 
Õc
[
i
] = 
	`MULT16_16_Q15
÷pc[i], 
tmp
);

202 
Õc2
[0] = 
Õc
[0] + 
	`QCONST16
(.8f,
SIG_SHIFT
);

203 
Õc2
[1] = 
Õc
[1] + 
	`MULT16_16_Q15
(
c1
,lpc[0]);

204 
Õc2
[2] = 
Õc
[2] + 
	`MULT16_16_Q15
(
c1
,lpc[1]);

205 
Õc2
[3] = 
Õc
[3] + 
	`MULT16_16_Q15
(
c1
,lpc[2]);

206 
Õc2
[4] = 
	`MULT16_16_Q15
(
c1
,
Õc
[3]);

207 
	`˚…_fú5
(
x_Õ
, 
Õc2
, 
Àn
>>1);

208 
	}
}

211 #ifde‡
FIXED_POINT


212 
	g›us_vÆ32


216 
	$˚…_pôch_xc‹r_c
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

217 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
)

222 
i
, 
j
;

223 #ifde‡
FIXED_POINT


224 
›us_vÆ32
 
maxc‹r
=1;

226 #i‡!
	`deföed
(
OVERRIDE_PITCH_XCORR
)

227 ()
¨ch
;

229 
i
=0;i<
max_pôch
;i++)

231 
›us_vÆ32
 
sum
 = 0;

232 
j
=0;j<
Àn
;j++)

233 
sum
 = 
	`MAC16_16
(sum, 
_x
[
j
], 
_y
[
i
+j]);

234 
xc‹r
[
i
] = 
sum
;

235 #ifde‡
FIXED_POINT


236 
maxc‹r
 = 
	`MAX32
(maxc‹r, 
sum
);

239 #ifde‡
FIXED_POINT


240  
maxc‹r
;

244 
i
;

248 #ifde‡
FIXED_POINT


249 
›us_vÆ32
 
maxc‹r
=1;

251 
	`˚…_as£π
(
max_pôch
>0);

252 
	`˚…_sig_as£π
((((*)
_x
-(*)
NULL
)&3)==0);

253 
i
=0;i<
max_pôch
-3;i+=4)

255 
›us_vÆ32
 
sum
[4]={0,0,0,0};

256 
	`xc‹r_kî√l
(
_x
, 
_y
+
i
, 
sum
, 
Àn
, 
¨ch
);

257 
xc‹r
[
i
]=
sum
[0];

258 
xc‹r
[
i
+1]=
sum
[1];

259 
xc‹r
[
i
+2]=
sum
[2];

260 
xc‹r
[
i
+3]=
sum
[3];

261 #ifde‡
FIXED_POINT


262 
sum
[0] = 
	`MAX32
(sum[0], sum[1]);

263 
sum
[2] = 
	`MAX32
(sum[2], sum[3]);

264 
sum
[0] = 
	`MAX32
(sum[0], sum[2]);

265 
maxc‹r
 = 
	`MAX32
(maxc‹r, 
sum
[0]);

269 ;
i
<
max_pôch
;i++)

271 
›us_vÆ32
 
sum
;

272 
sum
 = 
	`˚…_ö√r_¥od
(
_x
, 
_y
+
i
, 
Àn
, 
¨ch
);

273 
xc‹r
[
i
] = 
sum
;

274 #ifde‡
FIXED_POINT


275 
maxc‹r
 = 
	`MAX32
(maxc‹r, 
sum
);

278 #ifde‡
FIXED_POINT


279  
maxc‹r
;

282 
	}
}

284 
	$pôch_£¨ch
(c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
x_Õ
, opus_vÆ16 * OPUS_RESTRICT 
y
,

285 
Àn
, 
max_pôch
, *
pôch
, 
¨ch
)

287 
i
, 
j
;

288 
œg
;

289 
be°_pôch
[2]={0,0};

290 
	`VARDECL
(
›us_vÆ16
, 
x_Õ4
);

291 
	`VARDECL
(
›us_vÆ16
, 
y_Õ4
);

292 
	`VARDECL
(
›us_vÆ32
, 
xc‹r
);

293 #ifde‡
FIXED_POINT


294 
›us_vÆ32
 
maxc‹r
;

295 
›us_vÆ32
 
xmax
, 
ymax
;

296 
shi·
=0;

298 
off£t
;

300 
SAVE_STACK
;

302 
	`˚…_as£π
(
Àn
>0);

303 
	`˚…_as£π
(
max_pôch
>0);

304 
œg
 = 
Àn
+
max_pôch
;

306 
	`ALLOC
(
x_Õ4
, 
Àn
>>2, 
›us_vÆ16
);

307 
	`ALLOC
(
y_Õ4
, 
œg
>>2, 
›us_vÆ16
);

308 
	`ALLOC
(
xc‹r
, 
max_pôch
>>1, 
›us_vÆ32
);

311 
j
=0;j<
Àn
>>2;j++)

312 
x_Õ4
[
j
] = 
x_Õ
[2*j];

313 
j
=0;j<
œg
>>2;j++)

314 
y_Õ4
[
j
] = 
y
[2*j];

316 #ifde‡
FIXED_POINT


317 
xmax
 = 
	`˚…_maxabs16
(
x_Õ4
, 
Àn
>>2);

318 
ymax
 = 
	`˚…_maxabs16
(
y_Õ4
, 
œg
>>2);

319 
shi·
 = 
	`˚…_ûog2
(
	`MAX32
(1, MAX32(
xmax
, 
ymax
)))-11;

320 i‡(
shi·
>0)

322 
j
=0;j<
Àn
>>2;j++)

323 
x_Õ4
[
j
] = 
	`SHR16
(x_Õ4[j], 
shi·
);

324 
j
=0;j<
œg
>>2;j++)

325 
y_Õ4
[
j
] = 
	`SHR16
(y_Õ4[j], 
shi·
);

327 
shi·
 *= 2;

329 
shi·
 = 0;

335 #ifde‡
FIXED_POINT


336 
maxc‹r
 =

338 
	`˚…_pôch_xc‹r
(
x_Õ4
, 
y_Õ4
, 
xc‹r
, 
Àn
>>2, 
max_pôch
>>2, 
¨ch
);

340 
	`föd_be°_pôch
(
xc‹r
, 
y_Õ4
, 
Àn
>>2, 
max_pôch
>>2, 
be°_pôch


341 #ifde‡
FIXED_POINT


342 , 0, 
maxc‹r


347 #ifde‡
FIXED_POINT


348 
maxc‹r
=1;

350 
i
=0;i<
max_pôch
>>1;i++)

352 
›us_vÆ32
 
sum
;

353 
xc‹r
[
i
] = 0;

354 i‡(
	`abs
(
i
-2*
be°_pôch
[0])>2 &&ábs(i-2*best_pitch[1])>2)

356 #ifde‡
FIXED_POINT


357 
sum
 = 0;

358 
j
=0;j<
Àn
>>1;j++)

359 
sum
 +
	`SHR32
(
	`MULT16_16
(
x_Õ
[
j
],
y
[
i
+j]), 
shi·
);

361 
sum
 = 
	`˚…_ö√r_¥od
(
x_Õ
, 
y
+
i
, 
Àn
>>1, 
¨ch
);

363 
xc‹r
[
i
] = 
	`MAX32
(-1, 
sum
);

364 #ifde‡
FIXED_POINT


365 
maxc‹r
 = 
	`MAX32
(maxc‹r, 
sum
);

368 
	`föd_be°_pôch
(
xc‹r
, 
y
, 
Àn
>>1, 
max_pôch
>>1, 
be°_pôch


369 #ifde‡
FIXED_POINT


370 , 
shi·
+1, 
maxc‹r


375 i‡(
be°_pôch
[0]>0 && be°_pôch[0]<(
max_pôch
>>1)-1)

377 
›us_vÆ32
 
a
, 
b
, 
c
;

378 
a
 = 
xc‹r
[
be°_pôch
[0]-1];

379 
b
 = 
xc‹r
[
be°_pôch
[0]];

380 
c
 = 
xc‹r
[
be°_pôch
[0]+1];

381 i‡((
c
-
a
Ë> 
	`MULT16_32_Q15
(
	`QCONST16
(.7f,15),
b
-a))

382 
off£t
 = 1;

383 i‡((
a
-
c
Ë> 
	`MULT16_32_Q15
(
	`QCONST16
(.7f,15),
b
-c))

384 
off£t
 = -1;

386 
off£t
 = 0;

388 
off£t
 = 0;

390 *
pôch
 = 2*
be°_pôch
[0]-
off£t
;

392 
RESTORE_STACK
;

393 
	}
}

395 #ifde‡
FIXED_POINT


396 
›us_vÆ16
 
	$compuã_pôch_gaö
(
›us_vÆ32
 
xy
, opus_vÆ32 
xx
, opus_vÆ32 
yy
)

398 
›us_vÆ32
 
x2y2
;

399 
sx
, 
sy
, 
shi·
;

400 
›us_vÆ32
 
g
;

401 
›us_vÆ16
 
dí
;

402 i‡(
xy
 =0 || 
xx
 =0 || 
yy
 == 0)

404 
sx
 = 
	`˚…_ûog2
(
xx
)-14;

405 
sy
 = 
	`˚…_ûog2
(
yy
)-14;

406 
shi·
 = 
sx
 + 
sy
;

407 
x2y2
 = 
	`SHR32
(
	`MULT16_16
(
	`VSHR32
(
xx
, 
sx
), VSHR32(
yy
, 
sy
)), 14);

408 i‡(
shi·
 & 1) {

409 i‡(
x2y2
 < 32768)

411 
x2y2
 <<= 1;

412 
shi·
--;

414 
x2y2
 >>= 1;

415 
shi·
++;

418 
dí
 = 
	`˚…_rsqπ_n‹m
(
x2y2
);

419 
g
 = 
	`MULT16_32_Q15
(
dí
, 
xy
);

420 
g
 = 
	`VSHR32
(g, (
shi·
>>1)-1);

421  
	`EXTRACT16
(
	`MIN32
(
g
, 
Q15ONE
));

422 
	}
}

424 
›us_vÆ16
 
	$compuã_pôch_gaö
(
›us_vÆ32
 
xy
, opus_vÆ32 
xx
, opus_vÆ32 
yy
)

426  
xy
/
	`˚…_sqπ
(1+
xx
*
yy
);

427 
	}
}

430 c⁄° 
	g£c⁄d_check
[16] = {0, 0, 3, 2, 3, 2, 5, 2, 3, 2, 3, 2, 5, 2, 3, 2};

431 
›us_vÆ16
 
	$ªmove_doublög
(
›us_vÆ16
 *
x
, 
max≥riod
, 
mö≥riod
,

432 
N
, *
T0_
, 
¥ev_≥riod
, 
›us_vÆ16
 
¥ev_gaö
, 
¨ch
)

434 
k
, 
i
, 
T
, 
T0
;

435 
›us_vÆ16
 
g
, 
g0
;

436 
›us_vÆ16
 
pg
;

437 
›us_vÆ32
 
xy
,
xx
,
yy
,
xy2
;

438 
›us_vÆ32
 
xc‹r
[3];

439 
›us_vÆ32
 
be°_xy
, 
be°_yy
;

440 
off£t
;

441 
mö≥riod0
;

442 
	`VARDECL
(
›us_vÆ32
, 
yy_lookup
);

443 
SAVE_STACK
;

445 
mö≥riod0
 = 
mö≥riod
;

446 
max≥riod
 /= 2;

447 
mö≥riod
 /= 2;

448 *
T0_
 /= 2;

449 
¥ev_≥riod
 /= 2;

450 
N
 /= 2;

451 
x
 +
max≥riod
;

452 i‡(*
T0_
>=
max≥riod
)

453 *
T0_
=
max≥riod
-1;

455 
T
 = 
T0
 = *
T0_
;

456 
	`ALLOC
(
yy_lookup
, 
max≥riod
+1, 
›us_vÆ32
);

457 
	`duÆ_ö√r_¥od
(
x
, x, x-
T0
, 
N
, &
xx
, &
xy
, 
¨ch
);

458 
yy_lookup
[0] = 
xx
;

459 
yy
=
xx
;

460 
i
=1;i<=
max≥riod
;i++)

462 
yy
 = yy+
	`MULT16_16
(
x
[-
i
],x[-i])-MULT16_16(x[
N
-i],x[N-i]);

463 
yy_lookup
[
i
] = 
	`MAX32
(0, 
yy
);

465 
yy
 = 
yy_lookup
[
T0
];

466 
be°_xy
 = 
xy
;

467 
be°_yy
 = 
yy
;

468 
g
 = 
g0
 = 
	`compuã_pôch_gaö
(
xy
, 
xx
, 
yy
);

470 
k
=2;k<=15;k++)

472 
T1
, 
T1b
;

473 
›us_vÆ16
 
g1
;

474 
›us_vÆ16
 
c⁄t
=0;

475 
›us_vÆ16
 
thªsh
;

476 
T1
 = 
	`˚…_udiv
(2*
T0
+
k
, 2*k);

477 i‡(
T1
 < 
mö≥riod
)

480 i‡(
k
==2)

482 i‡(
T1
+
T0
>
max≥riod
)

483 
T1b
 = 
T0
;

485 
T1b
 = 
T0
+
T1
;

488 
T1b
 = 
	`˚…_udiv
(2*
£c⁄d_check
[
k
]*
T0
+k, 2*k);

490 
	`duÆ_ö√r_¥od
(
x
, &x[-
T1
], &x[-
T1b
], 
N
, &
xy
, &
xy2
, 
¨ch
);

491 
xy
 = 
	`HALF32
(xy + 
xy2
);

492 
yy
 = 
	`HALF32
(
yy_lookup
[
T1
] + yy_lookup[
T1b
]);

493 
g1
 = 
	`compuã_pôch_gaö
(
xy
, 
xx
, 
yy
);

494 i‡(
	`abs
(
T1
-
¥ev_≥riod
)<=1)

495 
c⁄t
 = 
¥ev_gaö
;

496 i‡(
	`abs
(
T1
-
¥ev_≥riod
)<=2 && 5*
k
*k < 
T0
)

497 
c⁄t
 = 
	`HALF16
(
¥ev_gaö
);

499 
c⁄t
 = 0;

500 
thªsh
 = 
	`MAX16
(
	`QCONST16
(.3f,15), 
	`MULT16_16_Q15
(QCONST16(.7f,15),
g0
)-
c⁄t
);

503 i‡(
T1
<3*
mö≥riod
)

504 
thªsh
 = 
	`MAX16
(
	`QCONST16
(.4f,15), 
	`MULT16_16_Q15
(QCONST16(.85f,15),
g0
)-
c⁄t
);

505 i‡(
T1
<2*
mö≥riod
)

506 
thªsh
 = 
	`MAX16
(
	`QCONST16
(.5f,15), 
	`MULT16_16_Q15
(QCONST16(.9f,15),
g0
)-
c⁄t
);

507 i‡(
g1
 > 
thªsh
)

509 
be°_xy
 = 
xy
;

510 
be°_yy
 = 
yy
;

511 
T
 = 
T1
;

512 
g
 = 
g1
;

515 
be°_xy
 = 
	`MAX32
(0, best_xy);

516 i‡(
be°_yy
 <
be°_xy
)

517 
pg
 = 
Q15ONE
;

519 
pg
 = 
	`SHR32
(
	`‰ac_div32
(
be°_xy
,
be°_yy
+1),16);

521 
k
=0;k<3;k++)

522 
xc‹r
[
k
] = 
	`˚…_ö√r_¥od
(
x
, x-(
T
+k-1), 
N
, 
¨ch
);

523 i‡((
xc‹r
[2]-xc‹r[0]Ë> 
	`MULT16_32_Q15
(
	`QCONST16
(.7f,15),xcorr[1]-xcorr[0]))

524 
off£t
 = 1;

525 i‡((
xc‹r
[0]-xc‹r[2]Ë> 
	`MULT16_32_Q15
(
	`QCONST16
(.7f,15),xcorr[1]-xcorr[2]))

526 
off£t
 = -1;

528 
off£t
 = 0;

529 i‡(
pg
 > 
g
)

530 
pg
 = 
g
;

531 *
T0_
 = 2*
T
+
off£t
;

533 i‡(*
T0_
<
mö≥riod0
)

534 *
T0_
=
mö≥riod0
;

535 
RESTORE_STACK
;

536  
pg
;

537 
	}
}

	@celt/pitch.h

34 #i‚de‡
PITCH_H


35 
	#PITCH_H


	)

37 
	~"modes.h
"

38 
	~"˝u_suµ‹t.h
"

40 #i‡(
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
FIXED_POINT
)) \

41 || ((
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë|| deföed(
OPUS_X86_MAY_HAVE_SSE2
)Ë&& 
	$deföed
(
FIXED_POINT
))

42 
	~"x86/pôch_s£.h
"

45 #i‡
	`deföed
(
MIPSr1_ASM
)

46 
	~"mùs/pôch_mù§1.h
"

49 #i‡(
	`deföed
(
OPUS_ARM_ASM
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
))

50 
	~"¨m/pôch_¨m.h
"

53 
	`pôch_downßm∂e
(
˚…_sig
 * 
OPUS_RESTRICT
 
x
[], 
›us_vÆ16
 * OPUS_RESTRICT 
x_Õ
,

54 
Àn
, 
C
, 
¨ch
);

56 
	`pôch_£¨ch
(c⁄° 
›us_vÆ16
 * 
OPUS_RESTRICT
 
x_Õ
, opus_vÆ16 * OPUS_RESTRICT 
y
,

57 
Àn
, 
max_pôch
, *
pôch
, 
¨ch
);

59 
›us_vÆ16
 
	`ªmove_doublög
(›us_vÆ16 *
x
, 
max≥riod
, 
mö≥riod
,

60 
N
, *
T0
, 
¥ev_≥riod
, 
›us_vÆ16
 
¥ev_gaö
, 
¨ch
);

65 
OPUS_INLINE
 
	$xc‹r_kî√l_c
(c⁄° 
›us_vÆ16
 * 
x
, c⁄° opus_vÆ16 * 
y
, 
›us_vÆ32
 
sum
[4], 
Àn
)

67 
j
;

68 
›us_vÆ16
 
y_0
, 
y_1
, 
y_2
, 
y_3
;

69 
	`˚…_as£π
(
Àn
>=3);

70 
y_3
=0;

71 
y_0
=*
y
++;

72 
y_1
=*
y
++;

73 
y_2
=*
y
++;

74 
j
=0;j<
Àn
-3;j+=4)

76 
›us_vÆ16
 
tmp
;

77 
tmp
 = *
x
++;

78 
y_3
=*
y
++;

79 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_0
);

80 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_1
);

81 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_2
);

82 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_3
);

83 
tmp
=*
x
++;

84 
y_0
=*
y
++;

85 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_1
);

86 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_2
);

87 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_3
);

88 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_0
);

89 
tmp
=*
x
++;

90 
y_1
=*
y
++;

91 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_2
);

92 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_3
);

93 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_0
);

94 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_1
);

95 
tmp
=*
x
++;

96 
y_2
=*
y
++;

97 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_3
);

98 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_0
);

99 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_1
);

100 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_2
);

102 i‡(
j
++<
Àn
)

104 
›us_vÆ16
 
tmp
 = *
x
++;

105 
y_3
=*
y
++;

106 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_0
);

107 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_1
);

108 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_2
);

109 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_3
);

111 i‡(
j
++<
Àn
)

113 
›us_vÆ16
 
tmp
=*
x
++;

114 
y_0
=*
y
++;

115 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_1
);

116 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_2
);

117 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_3
);

118 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_0
);

120 i‡(
j
<
Àn
)

122 
›us_vÆ16
 
tmp
=*
x
++;

123 
y_1
=*
y
++;

124 
sum
[0] = 
	`MAC16_16
(sum[0],
tmp
,
y_2
);

125 
sum
[1] = 
	`MAC16_16
(sum[1],
tmp
,
y_3
);

126 
sum
[2] = 
	`MAC16_16
(sum[2],
tmp
,
y_0
);

127 
sum
[3] = 
	`MAC16_16
(sum[3],
tmp
,
y_1
);

129 
	}
}

131 #i‚de‡
OVERRIDE_XCORR_KERNEL


132 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

133 (()(
¨ch
),
	`xc‹r_kî√l_c
(
x
, 
y
, 
sum
, 
Àn
))

	)

137 
OPUS_INLINE
 
	$duÆ_ö√r_¥od_c
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

138 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
)

140 
i
;

141 
›us_vÆ32
 
xy01
=0;

142 
›us_vÆ32
 
xy02
=0;

143 
i
=0;i<
N
;i++)

145 
xy01
 = 
	`MAC16_16
(xy01, 
x
[
i
], 
y01
[i]);

146 
xy02
 = 
	`MAC16_16
(xy02, 
x
[
i
], 
y02
[i]);

148 *
xy1
 = 
xy01
;

149 *
xy2
 = 
xy02
;

150 
	}
}

152 #i‚de‡
OVERRIDE_DUAL_INNER_PROD


153 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
) \

154 (()(
¨ch
),
	`duÆ_ö√r_¥od_c
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
))

	)

159 
OPUS_INLINE
 
›us_vÆ32
 
	$˚…_ö√r_¥od_c
(c⁄° 
›us_vÆ16
 *
x
,

160 c⁄° 
›us_vÆ16
 *
y
, 
N
)

162 
i
;

163 
›us_vÆ32
 
xy
=0;

164 
i
=0;i<
N
;i++)

165 
xy
 = 
	`MAC16_16
(xy, 
x
[
i
], 
y
[i]);

166  
xy
;

167 
	}
}

169 #i‡!
deföed
(
OVERRIDE_CELT_INNER_PROD
)

170 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
) \

171 (()(
¨ch
),
	`˚…_ö√r_¥od_c
(
x
, 
y
, 
N
))

	)

174 #ifde‡
NON_STATIC_COMB_FILTER_CONST_C


175 
comb_fûãr_c⁄°_c
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T
, 
N
,

176 
›us_vÆ16
 
g10
, opus_vÆ16 
g11
, opus_vÆ16 
g12
);

180 #ifde‡
FIXED_POINT


181 
	g›us_vÆ32


185 
˚…_pôch_xc‹r_c
(c⁄° 
›us_vÆ16
 *
_x
, c⁄° opus_vÆ16 *
_y
,

186 
›us_vÆ32
 *
xc‹r
, 
Àn
, 
max_pôch
, 
¨ch
);

188 #i‚de‡
OVERRIDE_PITCH_XCORR


189 
	#˚…_pôch_xc‹r
 
˚…_pôch_xc‹r_c


	)

	@celt/quant_bands.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~"qu™t_b™ds.h
"

34 
	~"œ∂a˚.h
"

35 
	~<m©h.h
>

36 
	~"os_suµ‹t.h
"

37 
	~"¨ch.h
"

38 
	~"m©h›s.h
"

39 
	~"°ack_Æloc.h
"

40 
	~"øã.h
"

42 #ifde‡
FIXED_POINT


44 c⁄° sig√d 
	geMóns
[25] = {

53 c⁄° 
›us_vÆ16
 
	geMóns
[25] = {

62 #ifde‡
FIXED_POINT


63 c⁄° 
›us_vÆ16
 
	g¥ed_c€f
[4] = {29440, 26112, 21248, 16384};

64 c⁄° 
›us_vÆ16
 
	gbëa_c€f
[4] = {30147, 22282, 12124, 6554};

65 c⁄° 
›us_vÆ16
 
	gbëa_öåa
 = 4915;

67 c⁄° 
›us_vÆ16
 
	g¥ed_c€f
[4] = {29440/32768., 26112/32768., 21248/32768., 16384/32768.};

68 c⁄° 
›us_vÆ16
 
	gbëa_c€f
[4] = {30147/32768., 22282/32768., 12124/32768., 6554/32768.};

69 c⁄° 
›us_vÆ16
 
	gbëa_öåa
 = 4915/32768.;

77 c⁄° 
	ge_¥ob_modñ
[4][2][42] = {

140 c⁄° 
	gsmÆl_íîgy_icdf
[3]={2,1,0};

142 
›us_vÆ32
 
	$loss_di°‹ti⁄
(c⁄° 
›us_vÆ16
 *
eB™ds
, opus_vÆ16 *
ﬁdEB™ds
, 
°¨t
, 
íd
, 
Àn
, 
C
)

144 
c
, 
i
;

145 
›us_vÆ32
 
di°
 = 0;

146 
c
=0; do {

147 
i
=
°¨t
;i<
íd
;i++)

149 
›us_vÆ16
 
d
 = 
	`SUB16
(
	`SHR16
(
eB™ds
[
i
+
c
*
Àn
], 3), SHR16(
ﬁdEB™ds
[i+c*len], 3));

150 
di°
 = 
	`MAC16_16
(di°, 
d
,d);

152 } ++
c
<
C
);

153  
	`MIN32
(200,
	`SHR32
(
di°
,2*
DB_SHIFT
-6));

154 
	}
}

156 
	$qu™t_cﬂr£_íîgy_im∂
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
,

157 c⁄° 
›us_vÆ16
 *
eB™ds
, opus_vÆ16 *
ﬁdEB™ds
,

158 
›us_öt32
 
budgë
, opus_öt32 
ãŒ
,

159 c⁄° *
¥ob_modñ
, 
›us_vÆ16
 *
îr‹
, 
ec_íc
 *
íc
,

160 
C
, 
LM
, 
öåa
, 
›us_vÆ16
 
max_deˇy
, 
l„
)

162 
i
, 
c
;

163 
bad√ss
 = 0;

164 
›us_vÆ32
 
¥ev
[2] = {0,0};

165 
›us_vÆ16
 
c€f
;

166 
›us_vÆ16
 
bëa
;

168 i‡(
ãŒ
+3 <
budgë
)

169 
	`ec_íc_bô_logp
(
íc
, 
öåa
, 3);

170 i‡(
öåa
)

172 
c€f
 = 0;

173 
bëa
 = 
bëa_öåa
;

175 
bëa
 = 
bëa_c€f
[
LM
];

176 
c€f
 = 
¥ed_c€f
[
LM
];

180 
i
=
°¨t
;i<
íd
;i++)

182 
c
=0;

184 
bôs_À·
;

185 
qi
, 
qi0
;

186 
›us_vÆ32
 
q
;

187 
›us_vÆ16
 
x
;

188 
›us_vÆ32
 
f
, 
tmp
;

189 
›us_vÆ16
 
ﬁdE
;

190 
›us_vÆ16
 
deˇy_bound
;

191 
x
 = 
eB™ds
[
i
+
c
*
m
->
nbEB™ds
];

192 
ﬁdE
 = 
	`MAX16
(-
	`QCONST16
(9.f,
DB_SHIFT
), 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
]);

193 #ifde‡
FIXED_POINT


194 
f
 = 
	`SHL32
(
	`EXTEND32
(
x
),7Ë- 
	`PSHR32
(
	`MULT16_16
(
c€f
,
ﬁdE
), 8Ë- 
¥ev
[
c
];

196 
qi
 = (
f
+
	`QCONST32
(.5f,
DB_SHIFT
+7))>>(DB_SHIFT+7);

197 
deˇy_bound
 = 
	`EXTRACT16
(
	`MAX32
(-
	`QCONST16
(28.f,
DB_SHIFT
),

198 
	`SUB32
((
›us_vÆ32
)
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
],
max_deˇy
)));

200 
f
 = 
x
-
c€f
*
ﬁdE
-
¥ev
[
c
];

202 
qi
 = ()
	`Êo‹
(.5f+
f
);

203 
deˇy_bound
 = 
	`MAX16
(-
	`QCONST16
(28.f,
DB_SHIFT
), 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
]Ë- 
max_deˇy
;

207 i‡(
qi
 < 0 && 
x
 < 
deˇy_bound
)

209 
qi
 +()
	`SHR16
(
	`SUB16
(
deˇy_bound
,
x
), 
DB_SHIFT
);

210 i‡(
qi
 > 0)

211 
qi
 = 0;

213 
qi0
 = 
qi
;

216 
ãŒ
 = 
	`ec_ãŒ
(
íc
);

217 
bôs_À·
 = 
budgë
-
ãŒ
-3*
C
*(
íd
-
i
);

218 i‡(
i
!=
°¨t
 && 
bôs_À·
 < 30)

220 i‡(
bôs_À·
 < 24)

221 
qi
 = 
	`IMIN
(1, qi);

222 i‡(
bôs_À·
 < 16)

223 
qi
 = 
	`IMAX
(-1, qi);

225 i‡(
l„
 && 
i
>=2)

226 
qi
 = 
	`IMIN
(qi, 0);

227 i‡(
budgë
-
ãŒ
 >= 15)

229 
pi
;

230 
pi
 = 2*
	`IMIN
(
i
,20);

231 
	`ec_œ∂a˚_ícode
(
íc
, &
qi
,

232 
¥ob_modñ
[
pi
]<<7,Örob_model[pi+1]<<6);

234 if(
budgë
-
ãŒ
 >= 2)

236 
qi
 = 
	`IMAX
(-1, 
	`IMIN
(qi, 1));

237 
	`ec_íc_icdf
(
íc
, 2*
qi
^-(qi<0), 
smÆl_íîgy_icdf
, 2);

239 if(
budgë
-
ãŒ
 >= 1)

241 
qi
 = 
	`IMIN
(0, qi);

242 
	`ec_íc_bô_logp
(
íc
, -
qi
, 1);

245 
qi
 = -1;

246 
îr‹
[
i
+
c
*
m
->
nbEB™ds
] = 
	`PSHR32
(
f
,7Ë- 
	`SHL16
(
qi
,
DB_SHIFT
);

247 
bad√ss
 +
	`abs
(
qi0
-
qi
);

248 
q
 = (
›us_vÆ32
)
	`SHL32
(
	`EXTEND32
(
qi
),
DB_SHIFT
);

250 
tmp
 = 
	`PSHR32
(
	`MULT16_16
(
c€f
,
ﬁdE
),8Ë+ 
¥ev
[
c
] + 
	`SHL32
(
q
,7);

251 #ifde‡
FIXED_POINT


252 
tmp
 = 
	`MAX32
(-
	`QCONST32
(28.f, 
DB_SHIFT
+7),Åmp);

254 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] = 
	`PSHR32
(
tmp
, 7);

255 
¥ev
[
c
] =Öªv[c] + 
	`SHL32
(
q
,7Ë- 
	`MULT16_16
(
bëa
,
	`PSHR32
(q,8));

256 } ++
c
 < 
C
);

258  
l„
 ? 0 : 
bad√ss
;

259 
	}
}

261 
	$qu™t_cﬂr£_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
effEnd
,

262 c⁄° 
›us_vÆ16
 *
eB™ds
, opus_vÆ16 *
ﬁdEB™ds
, 
›us_uöt32
 
budgë
,

263 
›us_vÆ16
 *
îr‹
, 
ec_íc
 *
íc
, 
C
, 
LM
, 
nbAvaûabÀByãs
,

264 
f‹˚_öåa
, 
›us_vÆ32
 *
dñayedI¡ø
, 
two_∑ss
, 
loss_øã
, 
l„
)

266 
öåa
;

267 
›us_vÆ16
 
max_deˇy
;

268 
	`VARDECL
(
›us_vÆ16
, 
ﬁdEB™ds_öåa
);

269 
	`VARDECL
(
›us_vÆ16
, 
îr‹_öåa
);

270 
ec_íc
 
íc_°¨t_°©e
;

271 
›us_uöt32
 
ãŒ
;

272 
bad√ss1
=0;

273 
›us_öt32
 
öåa_büs
;

274 
›us_vÆ32
 
√w_di°‹ti⁄
;

275 
SAVE_STACK
;

277 
öåa
 = 
f‹˚_öåa
 || (!
two_∑ss
 && *
dñayedI¡ø
>2*
C
*(
íd
-
°¨t
Ë&& 
nbAvaûabÀByãs
 > (end-start)*C);

278 
öåa_büs
 = (
›us_öt32
)((
budgë
**
dñayedI¡ø
*
loss_øã
)/(
C
*512));

279 
√w_di°‹ti⁄
 = 
	`loss_di°‹ti⁄
(
eB™ds
, 
ﬁdEB™ds
, 
°¨t
, 
effEnd
, 
m
->
nbEB™ds
, 
C
);

281 
ãŒ
 = 
	`ec_ãŒ
(
íc
);

282 i‡(
ãŒ
+3 > 
budgë
)

283 
two_∑ss
 = 
öåa
 = 0;

285 
max_deˇy
 = 
	`QCONST16
(16.f,
DB_SHIFT
);

286 i‡(
íd
-
°¨t
>10)

288 #ifde‡
FIXED_POINT


289 
max_deˇy
 = 
	`MIN32
(max_deˇy, 
	`SHL32
(
	`EXTEND32
(
nbAvaûabÀByãs
),
DB_SHIFT
-3));

291 
max_deˇy
 = 
	`MIN32
(max_deˇy, .125f*
nbAvaûabÀByãs
);

294 i‡(
l„
)

295 
max_deˇy
 = 
	`QCONST16
(3.f,
DB_SHIFT
);

296 
íc_°¨t_°©e
 = *
íc
;

298 
	`ALLOC
(
ﬁdEB™ds_öåa
, 
C
*
m
->
nbEB™ds
, 
›us_vÆ16
);

299 
	`ALLOC
(
îr‹_öåa
, 
C
*
m
->
nbEB™ds
, 
›us_vÆ16
);

300 
	`OPUS_COPY
(
ﬁdEB™ds_öåa
, 
ﬁdEB™ds
, 
C
*
m
->
nbEB™ds
);

302 i‡(
two_∑ss
 || 
öåa
)

304 
bad√ss1
 = 
	`qu™t_cﬂr£_íîgy_im∂
(
m
, 
°¨t
, 
íd
, 
eB™ds
, 
ﬁdEB™ds_öåa
, 
budgë
,

305 
ãŒ
, 
e_¥ob_modñ
[
LM
][1], 
îr‹_öåa
, 
íc
, 
C
, LM, 1, 
max_deˇy
, 
l„
);

308 i‡(!
öåa
)

310 *
öåa_buf
;

311 
ec_íc
 
íc_öåa_°©e
;

312 
›us_öt32
 
ãŒ_öåa
;

313 
›us_uöt32
 
n°¨t_byãs
;

314 
›us_uöt32
 
nöåa_byãs
;

315 
›us_uöt32
 
ßve_byãs
;

316 
bad√ss2
;

317 
	`VARDECL
(, 
öåa_bôs
);

319 
ãŒ_öåa
 = 
	`ec_ãŒ_‰ac
(
íc
);

321 
íc_öåa_°©e
 = *
íc
;

323 
n°¨t_byãs
 = 
	`ec_ønge_byãs
(&
íc_°¨t_°©e
);

324 
nöåa_byãs
 = 
	`ec_ønge_byãs
(&
íc_öåa_°©e
);

325 
öåa_buf
 = 
	`ec_gë_buf„r
(&
íc_öåa_°©e
Ë+ 
n°¨t_byãs
;

326 
ßve_byãs
 = 
nöåa_byãs
-
n°¨t_byãs
;

327 i‡(
ßve_byãs
 == 0)

328 
ßve_byãs
 = 
ALLOC_NONE
;

329 
	`ALLOC
(
öåa_bôs
, 
ßve_byãs
, );

331 
	`OPUS_COPY
(
öåa_bôs
, 
öåa_buf
, 
nöåa_byãs
 - 
n°¨t_byãs
);

333 *
íc
 = 
íc_°¨t_°©e
;

335 
bad√ss2
 = 
	`qu™t_cﬂr£_íîgy_im∂
(
m
, 
°¨t
, 
íd
, 
eB™ds
, 
ﬁdEB™ds
, 
budgë
,

336 
ãŒ
, 
e_¥ob_modñ
[
LM
][
öåa
], 
îr‹
, 
íc
, 
C
, LM, 0, 
max_deˇy
, 
l„
);

338 i‡(
two_∑ss
 && (
bad√ss1
 < 
bad√ss2
 || (bad√ss1 =bad√ss2 && ((
›us_öt32
)
	`ec_ãŒ_‰ac
(
íc
))+
öåa_büs
 > 
ãŒ_öåa
)))

340 *
íc
 = 
íc_öåa_°©e
;

342 
	`OPUS_COPY
(
öåa_buf
, 
öåa_bôs
, 
nöåa_byãs
 - 
n°¨t_byãs
);

343 
	`OPUS_COPY
(
ﬁdEB™ds
, 
ﬁdEB™ds_öåa
, 
C
*
m
->
nbEB™ds
);

344 
	`OPUS_COPY
(
îr‹
, 
îr‹_öåa
, 
C
*
m
->
nbEB™ds
);

345 
öåa
 = 1;

348 
	`OPUS_COPY
(
ﬁdEB™ds
, 
ﬁdEB™ds_öåa
, 
C
*
m
->
nbEB™ds
);

349 
	`OPUS_COPY
(
îr‹
, 
îr‹_öåa
, 
C
*
m
->
nbEB™ds
);

352 i‡(
öåa
)

353 *
dñayedI¡ø
 = 
√w_di°‹ti⁄
;

355 *
dñayedI¡ø
 = 
	`ADD32
(
	`MULT16_32_Q15
(
	`MULT16_16_Q15
(
¥ed_c€f
[
LM
],Öred_coef[LM]),*delayedIntra),

356 
√w_di°‹ti⁄
);

358 
RESTORE_STACK
;

359 
	}
}

361 
	$qu™t_föe_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, opus_vÆ16 *
îr‹
, *
föe_qu™t
, 
ec_íc
 *
íc
, 
C
)

363 
i
, 
c
;

366 
i
=
°¨t
;i<
íd
;i++)

368 
›us_öt16
 
‰ac
 = 1<<
föe_qu™t
[
i
];

369 i‡(
föe_qu™t
[
i
] <= 0)

371 
c
=0;

373 
q2
;

374 
›us_vÆ16
 
off£t
;

375 #ifde‡
FIXED_POINT


377 
q2
 = (
îr‹
[
i
+
c
*
m
->
nbEB™ds
]+
	`QCONST16
(.5f,
DB_SHIFT
))>>(DB_SHIFT-
föe_qu™t
[i]);

379 
q2
 = ()
	`Êo‹
((
îr‹
[
i
+
c
*
m
->
nbEB™ds
]+.5f)*
‰ac
);

381 i‡(
q2
 > 
‰ac
-1)

382 
q2
 = 
‰ac
-1;

383 i‡(
q2
<0)

384 
q2
 = 0;

385 
	`ec_íc_bôs
(
íc
, 
q2
, 
föe_qu™t
[
i
]);

386 #ifde‡
FIXED_POINT


387 
off£t
 = 
	`SUB16
(
	`SHR32
(
	`SHL32
(
	`EXTEND32
(
q2
),
DB_SHIFT
)+
	`QCONST16
(.5f,DB_SHIFT),
föe_qu™t
[
i
]),QCONST16(.5f,DB_SHIFT));

389 
off£t
 = (
q2
+.5f)*(1<<(14-
föe_qu™t
[
i
]))*(1.f/16384) - .5f;

391 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] +
off£t
;

392 
îr‹
[
i
+
c
*
m
->
nbEB™ds
] -
off£t
;

394 } ++
c
 < 
C
);

396 
	}
}

398 
	$qu™t_íîgy_föÆi£
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, opus_vÆ16 *
îr‹
, *
föe_qu™t
, *
föe_¥i‹ôy
, 
bôs_À·
, 
ec_íc
 *
íc
, 
C
)

400 
i
, 
¥io
, 
c
;

403 
¥io
=0;prio<2;prio++)

405 
i
=
°¨t
;i<
íd
 && 
bôs_À·
>=
C
 ;i++)

407 i‡(
föe_qu™t
[
i
] >
MAX_FINE_BITS
 || 
föe_¥i‹ôy
[i]!=
¥io
)

409 
c
=0;

411 
q2
;

412 
›us_vÆ16
 
off£t
;

413 
q2
 = 
îr‹
[
i
+
c
*
m
->
nbEB™ds
]<0 ? 0 : 1;

414 
	`ec_íc_bôs
(
íc
, 
q2
, 1);

415 #ifde‡
FIXED_POINT


416 
off£t
 = 
	`SHR16
(
	`SHL16
(
q2
,
DB_SHIFT
)-
	`QCONST16
(.5f,DB_SHIFT),
föe_qu™t
[
i
]+1);

418 
off£t
 = (
q2
-.5f)*(1<<(14-
föe_qu™t
[
i
]-1))*(1.f/16384);

420 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] +
off£t
;

421 
îr‹
[
i
+
c
*
m
->
nbEB™ds
] -
off£t
;

422 
bôs_À·
--;

423 } ++
c
 < 
C
);

426 
	}
}

428 
	$unqu™t_cﬂr£_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, 
öåa
, 
ec_dec
 *
dec
, 
C
, 
LM
)

430 c⁄° *
¥ob_modñ
 = 
e_¥ob_modñ
[
LM
][
öåa
];

431 
i
, 
c
;

432 
›us_vÆ32
 
¥ev
[2] = {0, 0};

433 
›us_vÆ16
 
c€f
;

434 
›us_vÆ16
 
bëa
;

435 
›us_öt32
 
budgë
;

436 
›us_öt32
 
ãŒ
;

438 i‡(
öåa
)

440 
c€f
 = 0;

441 
bëa
 = 
bëa_öåa
;

443 
bëa
 = 
bëa_c€f
[
LM
];

444 
c€f
 = 
¥ed_c€f
[
LM
];

447 
budgë
 = 
dec
->
°‹age
*8;

450 
i
=
°¨t
;i<
íd
;i++)

452 
c
=0;

454 
qi
;

455 
›us_vÆ32
 
q
;

456 
›us_vÆ32
 
tmp
;

460 
	`˚…_sig_as£π
(
c
<2);

461 
ãŒ
 = 
	`ec_ãŒ
(
dec
);

462 if(
budgë
-
ãŒ
>=15)

464 
pi
;

465 
pi
 = 2*
	`IMIN
(
i
,20);

466 
qi
 = 
	`ec_œ∂a˚_decode
(
dec
,

467 
¥ob_modñ
[
pi
]<<7,Örob_model[pi+1]<<6);

469 if(
budgë
-
ãŒ
>=2)

471 
qi
 = 
	`ec_dec_icdf
(
dec
, 
smÆl_íîgy_icdf
, 2);

472 
qi
 = (qi>>1)^-(qi&1);

474 if(
budgë
-
ãŒ
>=1)

476 
qi
 = -
	`ec_dec_bô_logp
(
dec
, 1);

479 
qi
 = -1;

480 
q
 = (
›us_vÆ32
)
	`SHL32
(
	`EXTEND32
(
qi
),
DB_SHIFT
);

482 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] = 
	`MAX16
(-
	`QCONST16
(9.f,
DB_SHIFT
), oldEBands[i+c*m->nbEBands]);

483 
tmp
 = 
	`PSHR32
(
	`MULT16_16
(
c€f
,
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
]),8Ë+ 
¥ev
[c] + 
	`SHL32
(
q
,7);

484 #ifde‡
FIXED_POINT


485 
tmp
 = 
	`MAX32
(-
	`QCONST32
(28.f, 
DB_SHIFT
+7),Åmp);

487 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] = 
	`PSHR32
(
tmp
, 7);

488 
¥ev
[
c
] =Öªv[c] + 
	`SHL32
(
q
,7Ë- 
	`MULT16_16
(
bëa
,
	`PSHR32
(q,8));

489 } ++
c
 < 
C
);

491 
	}
}

493 
	$unqu™t_föe_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, *
föe_qu™t
, 
ec_dec
 *
dec
, 
C
)

495 
i
, 
c
;

497 
i
=
°¨t
;i<
íd
;i++)

499 i‡(
föe_qu™t
[
i
] <= 0)

501 
c
=0;

503 
q2
;

504 
›us_vÆ16
 
off£t
;

505 
q2
 = 
	`ec_dec_bôs
(
dec
, 
föe_qu™t
[
i
]);

506 #ifde‡
FIXED_POINT


507 
off£t
 = 
	`SUB16
(
	`SHR32
(
	`SHL32
(
	`EXTEND32
(
q2
),
DB_SHIFT
)+
	`QCONST16
(.5f,DB_SHIFT),
föe_qu™t
[
i
]),QCONST16(.5f,DB_SHIFT));

509 
off£t
 = (
q2
+.5f)*(1<<(14-
föe_qu™t
[
i
]))*(1.f/16384) - .5f;

511 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] +
off£t
;

512 } ++
c
 < 
C
);

514 
	}
}

516 
	$unqu™t_íîgy_föÆi£
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, *
föe_qu™t
, *
föe_¥i‹ôy
, 
bôs_À·
, 
ec_dec
 *
dec
, 
C
)

518 
i
, 
¥io
, 
c
;

521 
¥io
=0;prio<2;prio++)

523 
i
=
°¨t
;i<
íd
 && 
bôs_À·
>=
C
 ;i++)

525 i‡(
föe_qu™t
[
i
] >
MAX_FINE_BITS
 || 
föe_¥i‹ôy
[i]!=
¥io
)

527 
c
=0;

529 
q2
;

530 
›us_vÆ16
 
off£t
;

531 
q2
 = 
	`ec_dec_bôs
(
dec
, 1);

532 #ifde‡
FIXED_POINT


533 
off£t
 = 
	`SHR16
(
	`SHL16
(
q2
,
DB_SHIFT
)-
	`QCONST16
(.5f,DB_SHIFT),
föe_qu™t
[
i
]+1);

535 
off£t
 = (
q2
-.5f)*(1<<(14-
föe_qu™t
[
i
]-1))*(1.f/16384);

537 
ﬁdEB™ds
[
i
+
c
*
m
->
nbEB™ds
] +
off£t
;

538 
bôs_À·
--;

539 } ++
c
 < 
C
);

542 
	}
}

544 
	$amp2Log2
(c⁄° 
CELTMode
 *
m
, 
effEnd
, 
íd
,

545 
˚…_íî
 *
b™dE
, 
›us_vÆ16
 *
b™dLogE
, 
C
)

547 
c
, 
i
;

548 
c
=0;

550 
i
=0;i<
effEnd
;i++)

552 
b™dLogE
[
i
+
c
*
m
->
nbEB™ds
] =

553 
	`˚…_log2
(
b™dE
[
i
+
c
*
m
->
nbEB™ds
])

554 - 
	`SHL16
((
›us_vÆ16
)
eMóns
[
i
],6);

555 #ifde‡
FIXED_POINT


557 
b™dLogE
[
i
+
c
*
m
->
nbEB™ds
] +
	`QCONST16
(2.f, 
DB_SHIFT
);

560 
i
=
effEnd
;i<
íd
;i++)

561 
b™dLogE
[
c
*
m
->
nbEB™ds
+
i
] = -
	`QCONST16
(14.f,
DB_SHIFT
);

562 } ++
c
 < 
C
);

563 
	}
}

	@celt/quant_bands.h

29 #i‚de‡
QUANT_BANDS


30 
	#QUANT_BANDS


	)

32 
	~"¨ch.h
"

33 
	~"modes.h
"

34 
	~"íãnc.h
"

35 
	~"ítdec.h
"

36 
	~"m©h›s.h
"

38 #ifde‡
FIXED_POINT


39 c⁄° sig√d 
eMóns
[25];

41 c⁄° 
›us_vÆ16
 
eMóns
[25];

44 
amp2Log2
(c⁄° 
CELTMode
 *
m
, 
effEnd
, 
íd
,

45 
˚…_íî
 *
b™dE
, 
›us_vÆ16
 *
b™dLogE
, 
C
);

47 
log2Amp
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
,

48 
˚…_íî
 *
eB™ds
, c⁄° 
›us_vÆ16
 *
ﬁdEB™ds
, 
C
);

50 
qu™t_cﬂr£_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
effEnd
,

51 c⁄° 
›us_vÆ16
 *
eB™ds
, opus_vÆ16 *
ﬁdEB™ds
, 
›us_uöt32
 
budgë
,

52 
›us_vÆ16
 *
îr‹
, 
ec_íc
 *
íc
, 
C
, 
LM
,

53 
nbAvaûabÀByãs
, 
f‹˚_öåa
, 
›us_vÆ32
 *
dñayedI¡ø
,

54 
two_∑ss
, 
loss_øã
, 
l„
);

56 
qu™t_föe_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, opus_vÆ16 *
îr‹
, *
föe_qu™t
, 
ec_íc
 *
íc
, 
C
);

58 
qu™t_íîgy_föÆi£
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, opus_vÆ16 *
îr‹
, *
föe_qu™t
, *
föe_¥i‹ôy
, 
bôs_À·
, 
ec_íc
 *
íc
, 
C
);

60 
unqu™t_cﬂr£_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, 
öåa
, 
ec_dec
 *
dec
, 
C
, 
LM
);

62 
unqu™t_föe_íîgy
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, *
föe_qu™t
, 
ec_dec
 *
dec
, 
C
);

64 
unqu™t_íîgy_föÆi£
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
›us_vÆ16
 *
ﬁdEB™ds
, *
föe_qu™t
, *
föe_¥i‹ôy
, 
bôs_À·
, 
ec_dec
 *
dec
, 
C
);

	@celt/rate.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<m©h.h
>

34 
	~"modes.h
"

35 
	~"cwrs.h
"

36 
	~"¨ch.h
"

37 
	~"os_suµ‹t.h
"

39 
	~"ítcode.h
"

40 
	~"øã.h
"

42 c⁄° 
	gLOG2_FRAC_TABLE
[24]={

50 #ifde‡
CUSTOM_MODES


54 
	$fôs_ö32
(
_n
, 
_k
)

56 c⁄° 
›us_öt16
 
maxN
[15] = {

59 c⁄° 
›us_öt16
 
maxK
[15] = {

62 i‡(
_n
>=14)

64 i‡(
_k
>=14)

67  
_n
 <
maxN
[
_k
];

69  
_k
 <
maxK
[
_n
];

71 
	}
}

73 
	$compuã_pul£_ˇche
(
CELTMode
 *
m
, 
LM
)

75 
C
;

76 
i
;

77 
j
;

78 
cuº
=0;

79 
nbE¡rõs
=0;

80 
íåyN
[100], 
íåyK
[100], 
íåyI
[100];

81 c⁄° 
›us_öt16
 *
eB™ds
 = 
m
->eBands;

82 
Pul£Cache
 *
ˇche
 = &
m
->cache;

83 
›us_öt16
 *
cödex
;

84 *
bôs
;

85 *
ˇp
;

87 
cödex
 = (
›us_öt16
 *)
	`›us_Æloc
((
ˇche
->
ödex
[0])*
m
->
nbEB™ds
*(
LM
+2));

88 
ˇche
->
ödex
 = 
cödex
;

91 
i
=0;i<=
LM
+1;i++)

93 
j
=0;j<
m
->
nbEB™ds
;j++)

95 
k
;

96 
N
 = (
eB™ds
[
j
+1]-eB™ds[j])<<
i
>>1;

97 
cödex
[
i
*
m
->
nbEB™ds
+
j
] = -1;

99 
k
=0;k<=
i
;k++)

101 
n
;

102 
n
=0;n<
m
->
nbEB™ds
 && (
k
!=
i
 ||Ç<
j
);n++)

104 i‡(
N
 =(
eB™ds
[
n
+1]-eB™ds[n])<<
k
>>1)

106 
cödex
[
i
*
m
->
nbEB™ds
+
j
] = cödex[
k
*m->nbEB™ds+
n
];

111 i‡(
ˇche
->
ödex
[
i
*
m
->
nbEB™ds
+
j
] =-1 && 
N
!=0)

113 
K
;

114 
íåyN
[
nbE¡rõs
] = 
N
;

115 
K
 = 0;

116 
	`fôs_ö32
(
N
,
	`gë_pul£s
(
K
+1)Ë&& K<
MAX_PSEUDO
)

117 
K
++;

118 
íåyK
[
nbE¡rõs
] = 
K
;

119 
cödex
[
i
*
m
->
nbEB™ds
+
j
] = 
cuº
;

120 
íåyI
[
nbE¡rõs
] = 
cuº
;

122 
cuº
 +
K
+1;

123 
nbE¡rõs
++;

127 
bôs
 = (*)
	`›us_Æloc
(()*
cuº
);

128 
ˇche
->
bôs
 = bits;

129 
ˇche
->
size
 = 
cuº
;

131 
i
=0;i<
nbE¡rõs
;i++)

133 *
±r
 = 
bôs
+
íåyI
[
i
];

134 
›us_öt16
 
tmp
[
CELT_MAX_PULSES
+1];

135 
	`gë_ªquúed_bôs
(
tmp
, 
íåyN
[
i
], 
	`gë_pul£s
(
íåyK
[i]), 
BITRES
);

136 
j
=1;j<=
íåyK
[
i
];j++)

137 
±r
[
j
] = 
tmp
[
	`gë_pul£s
(j)]-1;

138 
±r
[0] = 
íåyK
[
i
];

143 
ˇche
->
ˇps
 = 
ˇp
 = (*)
	`›us_Æloc
((ˇche->ˇps[0])*(
LM
+1)*2*
m
->
nbEB™ds
);

144 
i
=0;i<=
LM
;i++)

146 
C
=1;C<=2;C++)

148 
j
=0;j<
m
->
nbEB™ds
;j++)

150 
N0
;

151 
max_bôs
;

152 
N0
 = 
m
->
eB™ds
[
j
+1]-m->eBands[j];

154 i‡(
N0
<<
i
 == 1)

155 
max_bôs
 = 
C
*(1+
MAX_FINE_BITS
)<<
BITRES
;

158 c⁄° *
pˇche
;

159 
›us_öt32
 
num
;

160 
›us_öt32
 
dí
;

161 
LM0
;

162 
N
;

163 
off£t
;

164 
ndof
;

165 
qb
;

166 
k
;

167 
LM0
 = 0;

170 i‡(
N0
 > 2)

172 
N0
>>=1;

173 
LM0
--;

176 i‡(
N0
 <= 1)

178 
LM0
=
	`IMIN
(
i
,1);

179 
N0
<<=
LM0
;

183 
pˇche
 = 
bôs
 + 
cödex
[(
LM0
+1)*
m
->
nbEB™ds
+
j
];

184 
max_bôs
 = 
pˇche
[pcache[0]]+1;

186 
N
 = 
N0
;

187 
k
=0;k<
i
-
LM0
;k++){

188 
max_bôs
 <<= 1;

192 
off£t
 = ((
m
->
logN
[
j
]+((
LM0
+
k
)<<
BITRES
))>>1)-
QTHETA_OFFSET
;

197 
num
=459*(
›us_öt32
)((2*
N
-1)*
off£t
+
max_bôs
);

198 
dí
=((
›us_öt32
)(2*
N
-1)<<9)-459;

199 
qb
 = 
	`IMIN
((
num
+(
dí
>>1))/den, 57);

200 
	`˚…_as£π
(
qb
 >= 0);

201 
max_bôs
 +
qb
;

202 
N
 <<= 1;

205 i‡(
C
==2)

207 
max_bôs
 <<= 1;

208 
off£t
 = ((
m
->
logN
[
j
]+(
i
<<
BITRES
))>>1)-(
N
==2?
QTHETA_OFFSET_TWOPHASE
:
QTHETA_OFFSET
);

209 
ndof
 = 2*
N
-1-(N==2);

212 
num
 = (
N
==2?512:487)*(
›us_öt32
)(
max_bôs
+
ndof
*
off£t
);

213 
dí
 = ((
›us_öt32
)
ndof
<<9)-(
N
==2?512:487);

214 
qb
 = 
	`IMIN
((
num
+(
dí
>>1))/dí, (
N
==2?64:61));

215 
	`˚…_as£π
(
qb
 >= 0);

216 
max_bôs
 +
qb
;

220 
ndof
 = 
C
*
N
 + ((C==2 && N>2) ? 1 : 0);

223 
off£t
 = ((
m
->
logN
[
j
] + (
i
<<
BITRES
))>>1)-
FINE_OFFSET
;

225 i‡(
N
==2)

226 
off£t
 +1<<
BITRES
>>2;

229 
num
 = 
max_bôs
+
ndof
*
off£t
;

230 
dí
 = (
ndof
-1)<<
BITRES
;

231 
qb
 = 
	`IMIN
((
num
+(
dí
>>1))/dí, 
MAX_FINE_BITS
);

232 
	`˚…_as£π
(
qb
 >= 0);

233 
max_bôs
 +
C
*
qb
<<
BITRES
;

235 
max_bôs
 = (4*max_bôs/(
C
*((
m
->
eB™ds
[
j
+1]-m->eB™ds[j])<<
i
)))-64;

236 
	`˚…_as£π
(
max_bôs
 >= 0);

237 
	`˚…_as£π
(
max_bôs
 < 256);

238 *
ˇp
++ = ()
max_bôs
;

242 
	}
}

246 
	#ALLOC_STEPS
 6

	)

248 
OPUS_INLINE
 
	$öãΩ_bôs2pul£s
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, 
skù_°¨t
,

249 c⁄° *
bôs1
, c⁄° *
bôs2
, c⁄° *
thªsh
, c⁄° *
ˇp
, 
›us_öt32
 
tŸÆ
, opus_öt32 *
_bÆ™˚
,

250 
skù_rsv
, *
öãnsôy
, 
öãnsôy_rsv
, *
duÆ_°îeo
, 
duÆ_°îeo_rsv
, *
bôs
,

251 *
ebôs
, *
föe_¥i‹ôy
, 
C
, 
LM
, 
ec_˘x
 *
ec
, 
ícode
, 
¥ev
, 
sig«lB™dwidth
)

253 
›us_öt32
 
psum
;

254 
lo
, 
hi
;

255 
i
, 
j
;

256 
logM
;

257 
°îeo
;

258 
codedB™ds
=-1;

259 
Æloc_Êo‹
;

260 
›us_öt32
 
À·
, 
≥rc€ff
;

261 
d⁄e
;

262 
›us_öt32
 
bÆ™˚
;

263 
SAVE_STACK
;

265 
Æloc_Êo‹
 = 
C
<<
BITRES
;

266 
°îeo
 = 
C
>1;

268 
logM
 = 
LM
<<
BITRES
;

269 
lo
 = 0;

270 
hi
 = 1<<
ALLOC_STEPS
;

271 
i
=0;i<
ALLOC_STEPS
;i++)

273 
mid
 = (
lo
+
hi
)>>1;

274 
psum
 = 0;

275 
d⁄e
 = 0;

276 
j
=
íd
;j-->
°¨t
;)

278 
tmp
 = 
bôs1
[
j
] + (
mid
*(
›us_öt32
)
bôs2
[j]>>
ALLOC_STEPS
);

279 i‡(
tmp
 >
thªsh
[
j
] || 
d⁄e
)

281 
d⁄e
 = 1;

283 
psum
 +
	`IMIN
(
tmp
, 
ˇp
[
j
]);

285 i‡(
tmp
 >
Æloc_Êo‹
)

286 
psum
 +
Æloc_Êo‹
;

289 i‡(
psum
 > 
tŸÆ
)

290 
hi
 = 
mid
;

292 
lo
 = 
mid
;

294 
psum
 = 0;

296 
d⁄e
 = 0;

297 
j
=
íd
;j-->
°¨t
;)

299 
tmp
 = 
bôs1
[
j
] + ((
›us_öt32
)
lo
*
bôs2
[j]>>
ALLOC_STEPS
);

300 i‡(
tmp
 < 
thªsh
[
j
] && !
d⁄e
)

302 i‡(
tmp
 >
Æloc_Êo‹
)

303 
tmp
 = 
Æloc_Êo‹
;

305 
tmp
 = 0;

307 
d⁄e
 = 1;

309 
tmp
 = 
	`IMIN
—mp, 
ˇp
[
j
]);

310 
bôs
[
j
] = 
tmp
;

311 
psum
 +
tmp
;

315 
codedB™ds
=
íd
;;codedBands--)

317 
b™d_width
;

318 
b™d_bôs
;

319 
ªm
;

320 
j
 = 
codedB™ds
-1;

327 i‡(
j
<=
skù_°¨t
)

330 
tŸÆ
 +
skù_rsv
;

335 
À·
 = 
tŸÆ
-
psum
;

336 
≥rc€ff
 = 
	`˚…_udiv
(
À·
, 
m
->
eB™ds
[
codedB™ds
]-m->eB™ds[
°¨t
]);

337 
À·
 -(
m
->
eB™ds
[
codedB™ds
]-m->eB™ds[
°¨t
])*
≥rc€ff
;

338 
ªm
 = 
	`IMAX
(
À·
-(
m
->
eB™ds
[
j
]-m->eB™ds[
°¨t
]),0);

339 
b™d_width
 = 
m
->
eB™ds
[
codedB™ds
]-m->eB™ds[
j
];

340 
b™d_bôs
 = ()(
bôs
[
j
] + 
≥rc€ff
*
b™d_width
 + 
ªm
);

344 i‡(
b™d_bôs
 >
	`IMAX
(
thªsh
[
j
], 
Æloc_Êo‹
+(1<<
BITRES
)))

346 i‡(
ícode
)

351 
dïth_thªshﬁd
;

354 i‡(
codedB™ds
 > 17)

355 
dïth_thªshﬁd
 = 
j
<
¥ev
 ? 7 : 9;

357 
dïth_thªshﬁd
 = 0;

358 #ifde‡
FUZZING


359 i‡((
	`ønd
()&0x1) == 0)

361 i‡(
codedB™ds
<=
°¨t
+2 || (
b™d_bôs
 > (
dïth_thªshﬁd
*
b™d_width
<<
LM
<<
BITRES
)>>4 && 
j
<=
sig«lB™dwidth
))

364 
	`ec_íc_bô_logp
(
ec
, 1, 1);

367 
	`ec_íc_bô_logp
(
ec
, 0, 1);

368 } i‡(
	`ec_dec_bô_logp
(
ec
, 1)) {

372 
psum
 +1<<
BITRES
;

373 
b™d_bôs
 -1<<
BITRES
;

376 
psum
 -
bôs
[
j
]+
öãnsôy_rsv
;

377 i‡(
öãnsôy_rsv
 > 0)

378 
öãnsôy_rsv
 = 
LOG2_FRAC_TABLE
[
j
-
°¨t
];

379 
psum
 +
öãnsôy_rsv
;

380 i‡(
b™d_bôs
 >
Æloc_Êo‹
)

383 
psum
 +
Æloc_Êo‹
;

384 
bôs
[
j
] = 
Æloc_Êo‹
;

387 
bôs
[
j
] = 0;

391 
	`˚…_as£π
(
codedB™ds
 > 
°¨t
);

393 i‡(
öãnsôy_rsv
 > 0)

395 i‡(
ícode
)

397 *
öãnsôy
 = 
	`IMIN
(*öãnsôy, 
codedB™ds
);

398 
	`ec_íc_uöt
(
ec
, *
öãnsôy
-
°¨t
, 
codedB™ds
+1-start);

401 *
öãnsôy
 = 
°¨t
+
	`ec_dec_uöt
(
ec
, 
codedB™ds
+1-start);

404 *
öãnsôy
 = 0;

405 i‡(*
öãnsôy
 <
°¨t
)

407 
tŸÆ
 +
duÆ_°îeo_rsv
;

408 
duÆ_°îeo_rsv
 = 0;

410 i‡(
duÆ_°îeo_rsv
 > 0)

412 i‡(
ícode
)

413 
	`ec_íc_bô_logp
(
ec
, *
duÆ_°îeo
, 1);

415 *
duÆ_°îeo
 = 
	`ec_dec_bô_logp
(
ec
, 1);

418 *
duÆ_°îeo
 = 0;

421 
À·
 = 
tŸÆ
-
psum
;

422 
≥rc€ff
 = 
	`˚…_udiv
(
À·
, 
m
->
eB™ds
[
codedB™ds
]-m->eB™ds[
°¨t
]);

423 
À·
 -(
m
->
eB™ds
[
codedB™ds
]-m->eB™ds[
°¨t
])*
≥rc€ff
;

424 
j
=
°¨t
;j<
codedB™ds
;j++)

425 
bôs
[
j
] +(()
≥rc€ff
*(
m
->
eB™ds
[j+1]-m->eBands[j]));

426 
j
=
°¨t
;j<
codedB™ds
;j++)

428 
tmp
 = ()
	`IMIN
(
À·
, 
m
->
eB™ds
[
j
+1]-m->eBands[j]);

429 
bôs
[
j
] +
tmp
;

430 
À·
 -
tmp
;

434 
bÆ™˚
 = 0;

435 
j
=
°¨t
;j<
codedB™ds
;j++)

437 
N0
, 
N
, 
dí
;

438 
off£t
;

439 
NClogN
;

440 
›us_öt32
 
ex˚ss
, 
bô
;

442 
	`˚…_as£π
(
bôs
[
j
] >= 0);

443 
N0
 = 
m
->
eB™ds
[
j
+1]-m->eBands[j];

444 
N
=
N0
<<
LM
;

445 
bô
 = (
›us_öt32
)
bôs
[
j
]+
bÆ™˚
;

447 i‡(
N
>1)

449 
ex˚ss
 = 
	`MAX32
(
bô
-
ˇp
[
j
],0);

450 
bôs
[
j
] = 
bô
-
ex˚ss
;

453 
dí
=(
C
*
N
+ ((C==2 && N>2 && !*
duÆ_°îeo
 && 
j
<*
öãnsôy
) ? 1 : 0));

455 
NClogN
 = 
dí
*(
m
->
logN
[
j
] + 
logM
);

459 
off£t
 = (
NClogN
>>1)-
dí
*
FINE_OFFSET
;

462 i‡(
N
==2)

463 
off£t
 +
dí
<<
BITRES
>>2;

467 i‡(
bôs
[
j
] + 
off£t
 < 
dí
*2<<
BITRES
)

468 
off£t
 +
NClogN
>>2;

469 i‡(
bôs
[
j
] + 
off£t
 < 
dí
*3<<
BITRES
)

470 
off£t
 +
NClogN
>>3;

473 
ebôs
[
j
] = 
	`IMAX
(0, (
bôs
[j] + 
off£t
 + (
dí
<<(
BITRES
-1))));

474 
ebôs
[
j
] = 
	`˚…_udiv
”bôs[j], 
dí
)>>
BITRES
;

477 i‡(
C
*
ebôs
[
j
] > (
bôs
[j]>>
BITRES
))

478 
ebôs
[
j
] = 
bôs
[j] >> 
°îeo
 >> 
BITRES
;

481 
ebôs
[
j
] = 
	`IMIN
”bôs[j], 
MAX_FINE_BITS
);

485 
föe_¥i‹ôy
[
j
] = 
ebôs
[j]*(
dí
<<
BITRES
Ë>
bôs
[j]+
off£t
;

488 
bôs
[
j
] -
C
*
ebôs
[j]<<
BITRES
;

492 
ex˚ss
 = 
	`MAX32
(0,
bô
-(
C
<<
BITRES
));

493 
bôs
[
j
] = 
bô
-
ex˚ss
;

494 
ebôs
[
j
] = 0;

495 
föe_¥i‹ôy
[
j
] = 1;

501 if(
ex˚ss
 > 0)

503 
exåa_föe
;

504 
exåa_bôs
;

505 
exåa_föe
 = 
	`IMIN
(
ex˚ss
>>(
°îeo
+
BITRES
),
MAX_FINE_BITS
-
ebôs
[
j
]);

506 
ebôs
[
j
] +
exåa_föe
;

507 
exåa_bôs
 = 
exåa_föe
*
C
<<
BITRES
;

508 
föe_¥i‹ôy
[
j
] = 
exåa_bôs
 >
ex˚ss
-
bÆ™˚
;

509 
ex˚ss
 -
exåa_bôs
;

511 
bÆ™˚
 = 
ex˚ss
;

513 
	`˚…_as£π
(
bôs
[
j
] >= 0);

514 
	`˚…_as£π
(
ebôs
[
j
] >= 0);

518 *
_bÆ™˚
 = 
bÆ™˚
;

521 ;
j
<
íd
;j++)

523 
ebôs
[
j
] = 
bôs
[j] >> 
°îeo
 >> 
BITRES
;

524 
	`˚…_as£π
(
C
*
ebôs
[
j
]<<
BITRES
 =
bôs
[j]);

525 
bôs
[
j
] = 0;

526 
föe_¥i‹ôy
[
j
] = 
ebôs
[j]<1;

528 
RESTORE_STACK
;

529  
codedB™ds
;

530 
	}
}

532 
	$˛t_compuã_Æloˇti⁄
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, c⁄° *
off£ts
, c⁄° *
ˇp
, 
Æloc_åim
, *
öãnsôy
, *
duÆ_°îeo
,

533 
›us_öt32
 
tŸÆ
, opus_öt32 *
bÆ™˚
, *
pul£s
, *
ebôs
, *
föe_¥i‹ôy
, 
C
, 
LM
, 
ec_˘x
 *
ec
, 
ícode
, 
¥ev
, 
sig«lB™dwidth
)

535 
lo
, 
hi
, 
Àn
, 
j
;

536 
codedB™ds
;

537 
skù_°¨t
;

538 
skù_rsv
;

539 
öãnsôy_rsv
;

540 
duÆ_°îeo_rsv
;

541 
	`VARDECL
(, 
bôs1
);

542 
	`VARDECL
(, 
bôs2
);

543 
	`VARDECL
(, 
thªsh
);

544 
	`VARDECL
(, 
åim_off£t
);

545 
SAVE_STACK
;

547 
tŸÆ
 = 
	`IMAX
(total, 0);

548 
Àn
 = 
m
->
nbEB™ds
;

549 
skù_°¨t
 = 
°¨t
;

551 
skù_rsv
 = 
tŸÆ
 >1<<
BITRES
 ? 1<<BITRES : 0;

552 
tŸÆ
 -
skù_rsv
;

554 
öãnsôy_rsv
 = 
duÆ_°îeo_rsv
 = 0;

555 i‡(
C
==2)

557 
öãnsôy_rsv
 = 
LOG2_FRAC_TABLE
[
íd
-
°¨t
];

558 i‡(
öãnsôy_rsv
>
tŸÆ
)

559 
öãnsôy_rsv
 = 0;

562 
tŸÆ
 -
öãnsôy_rsv
;

563 
duÆ_°îeo_rsv
 = 
tŸÆ
>=1<<
BITRES
 ? 1<<BITRES : 0;

564 
tŸÆ
 -
duÆ_°îeo_rsv
;

567 
	`ALLOC
(
bôs1
, 
Àn
, );

568 
	`ALLOC
(
bôs2
, 
Àn
, );

569 
	`ALLOC
(
thªsh
, 
Àn
, );

570 
	`ALLOC
(
åim_off£t
, 
Àn
, );

572 
j
=
°¨t
;j<
íd
;j++)

575 
thªsh
[
j
] = 
	`IMAX
((
C
)<<
BITRES
, (3*(
m
->
eB™ds
[j+1]-m->eB™ds[j])<<
LM
<<BITRES)>>4);

577 
åim_off£t
[
j
] = 
C
*(
m
->
eB™ds
[j+1]-m->eB™ds[j])*(
Æloc_åim
-5-
LM
)*(
íd
-j-1)

578 *(1<<(
LM
+
BITRES
))>>6;

581 i‡((
m
->
eB™ds
[
j
+1]-m->eB™ds[j])<<
LM
==1)

582 
åim_off£t
[
j
] -
C
<<
BITRES
;

584 
lo
 = 1;

585 
hi
 = 
m
->
nbAŒocVe˘‹s
 - 1;

588 
d⁄e
 = 0;

589 
psum
 = 0;

590 
mid
 = (
lo
+
hi
) >> 1;

591 
j
=
íd
;j-->
°¨t
;)

593 
bôsj
;

594 
N
 = 
m
->
eB™ds
[
j
+1]-m->eBands[j];

595 
bôsj
 = 
C
*
N
*
m
->
ÆlocVe˘‹s
[
mid
*
Àn
+
j
]<<
LM
>>2;

596 i‡(
bôsj
 > 0)

597 
bôsj
 = 
	`IMAX
(0, bôsj + 
åim_off£t
[
j
]);

598 
bôsj
 +
off£ts
[
j
];

599 i‡(
bôsj
 >
thªsh
[
j
] || 
d⁄e
)

601 
d⁄e
 = 1;

603 
psum
 +
	`IMIN
(
bôsj
, 
ˇp
[
j
]);

605 i‡(
bôsj
 >
C
<<
BITRES
)

606 
psum
 +
C
<<
BITRES
;

609 i‡(
psum
 > 
tŸÆ
)

610 
hi
 = 
mid
 - 1;

612 
lo
 = 
mid
 + 1;

615 
lo
 <
hi
);

616 
hi
 = 
lo
--;

618 
j
=
°¨t
;j<
íd
;j++)

620 
bôs1j
, 
bôs2j
;

621 
N
 = 
m
->
eB™ds
[
j
+1]-m->eBands[j];

622 
bôs1j
 = 
C
*
N
*
m
->
ÆlocVe˘‹s
[
lo
*
Àn
+
j
]<<
LM
>>2;

623 
bôs2j
 = 
hi
>=
m
->
nbAŒocVe˘‹s
 ?

624 
ˇp
[
j
] : 
C
*
N
*
m
->
ÆlocVe˘‹s
[
hi
*
Àn
+j]<<
LM
>>2;

625 i‡(
bôs1j
 > 0)

626 
bôs1j
 = 
	`IMAX
(0, bôs1j + 
åim_off£t
[
j
]);

627 i‡(
bôs2j
 > 0)

628 
bôs2j
 = 
	`IMAX
(0, bôs2j + 
åim_off£t
[
j
]);

629 i‡(
lo
 > 0)

630 
bôs1j
 +
off£ts
[
j
];

631 
bôs2j
 +
off£ts
[
j
];

632 i‡(
off£ts
[
j
]>0)

633 
skù_°¨t
 = 
j
;

634 
bôs2j
 = 
	`IMAX
(0,bôs2j-
bôs1j
);

635 
bôs1
[
j
] = 
bôs1j
;

636 
bôs2
[
j
] = 
bôs2j
;

638 
codedB™ds
 = 
	`öãΩ_bôs2pul£s
(
m
, 
°¨t
, 
íd
, 
skù_°¨t
, 
bôs1
, 
bôs2
, 
thªsh
, 
ˇp
,

639 
tŸÆ
, 
bÆ™˚
, 
skù_rsv
, 
öãnsôy
, 
öãnsôy_rsv
, 
duÆ_°îeo
, 
duÆ_°îeo_rsv
,

640 
pul£s
, 
ebôs
, 
föe_¥i‹ôy
, 
C
, 
LM
, 
ec
, 
ícode
, 
¥ev
, 
sig«lB™dwidth
);

641 
RESTORE_STACK
;

642  
codedB™ds
;

643 
	}
}

	@celt/rate.h

29 #i‚de‡
RATE_H


30 
	#RATE_H


	)

32 
	#MAX_PSEUDO
 40

	)

33 
	#LOG_MAX_PSEUDO
 6

	)

35 
	#CELT_MAX_PULSES
 128

	)

37 
	#MAX_FINE_BITS
 8

	)

39 
	#FINE_OFFSET
 21

	)

40 
	#QTHETA_OFFSET
 4

	)

41 
	#QTHETA_OFFSET_TWOPHASE
 16

	)

43 
	~"cwrs.h
"

44 
	~"modes.h
"

46 
compuã_pul£_ˇche
(
CELTMode
 *
m
, 
LM
);

48 
OPUS_INLINE
 
	$gë_pul£s
(
i
)

50  
i
<8 ? i : (8 + (i&7)) << ((i>>3)-1);

51 
	}
}

53 
OPUS_INLINE
 
	$bôs2pul£s
(c⁄° 
CELTMode
 *
m
, 
b™d
, 
LM
, 
bôs
)

55 
i
;

56 
lo
, 
hi
;

57 c⁄° *
ˇche
;

59 
LM
++;

60 
ˇche
 = 
m
->ˇche.
bôs
 + m->ˇche.
ödex
[
LM
*m->
nbEB™ds
+
b™d
];

62 
lo
 = 0;

63 
hi
 = 
ˇche
[0];

64 
bôs
--;

65 
i
=0;i<
LOG_MAX_PSEUDO
;i++)

67 
mid
 = (
lo
+
hi
+1)>>1;

69 i‡(()
ˇche
[
mid
] >
bôs
)

70 
hi
 = 
mid
;

72 
lo
 = 
mid
;

74 i‡(
bôs
- (
lo
 =0 ? -1 : ()
ˇche
[lo]Ë<()ˇche[
hi
]-bits)

75  
lo
;

77  
hi
;

78 
	}
}

80 
OPUS_INLINE
 
	$pul£s2bôs
(c⁄° 
CELTMode
 *
m
, 
b™d
, 
LM
, 
pul£s
)

82 c⁄° *
ˇche
;

84 
LM
++;

85 
ˇche
 = 
m
->ˇche.
bôs
 + m->ˇche.
ödex
[
LM
*m->
nbEB™ds
+
b™d
];

86  
pul£s
 =0 ? 0 : 
ˇche
[pulses]+1;

87 
	}
}

98 
˛t_compuã_Æloˇti⁄
(c⁄° 
CELTMode
 *
m
, 
°¨t
, 
íd
, c⁄° *
off£ts
, c⁄° *
ˇp
, 
Æloc_åim
, *
öãnsôy
, *
duÆ_°îeo
,

99 
›us_öt32
 
tŸÆ
, opus_öt32 *
bÆ™˚
, *
pul£s
, *
ebôs
, *
föe_¥i‹ôy
, 
C
, 
LM
, 
ec_˘x
 *
ec
, 
ícode
, 
¥ev
, 
sig«lB™dwidth
);

	@celt/stack_alloc.h

32 #i‚de‡
STACK_ALLOC_H


33 
	#STACK_ALLOC_H


	)

35 
	~"›us_ty≥s.h
"

36 
	~"›us_deföes.h
"

38 #i‡(!
deföed
 (
VAR_ARRAYS
Ë&& !deföed (
USE_ALLOCA
Ë&& !deföed (
NONTHREADSAFE_PSEUDOSTACK
))

42 #ifde‡
USE_ALLOCA


43 #ifde‡
WIN32


44 
	~<mÆloc.h
>

46 #ifde‡
HAVE_ALLOCA_H


47 
	~<Æloˇ.h
>

49 
	~<°dlib.h
>

91 #i‡
deföed
(
VAR_ARRAYS
)

93 
	#VARDECL
(
ty≥
, 
v¨
)

	)

94 
	#ALLOC
(
v¨
, 
size
, 
ty≥
Ëty≥ v¨[size]

	)

95 
	#SAVE_STACK


	)

96 
	#RESTORE_STACK


	)

97 
	#ALLOC_STACK


	)

99 
	#ALLOC_NONE
 1

	)

101 #ñi‡
deföed
(
USE_ALLOCA
)

103 
	#VARDECL
(
ty≥
, 
v¨
Ëty≥ *
	)
var

105 #ifde‡
WIN32


106 
	#ALLOC
(
v¨
, 
size
, 
ty≥
Ëv¨ = (—y≥*)
	`_Æloˇ
(—y≥)*(size)))

	)

108 
	#ALLOC
(
v¨
, 
size
, 
ty≥
Ëv¨ = (—y≥*)
	`Æloˇ
(—y≥)*(size)))

	)

111 
	#SAVE_STACK


	)

112 
	#RESTORE_STACK


	)

113 
	#ALLOC_STACK


	)

114 
	#ALLOC_NONE
 0

	)

118 #ifde‡
CELT_C


119 *
	gs¸©ch_±r
=0;

120 *
	gglobÆ_°ack
=0;

122 *
globÆ_°ack
;

123 *
s¸©ch_±r
;

126 #ifde‡
ENABLE_VALGRIND


128 
	~<vÆgröd/memcheck.h
>

130 #ifde‡
CELT_C


131 *
	gglobÆ_°ack_t›
=0;

133 *
globÆ_°ack_t›
;

136 
	#ALIGN
(
°ack
, 
size
Ë((°ackË+((sizeË- ()(°ack)Ë& ((sizeË- 1))

	)

137 
	#PUSH
(
°ack
, 
size
, 
ty≥
Ë(
	`VALGRIND_MAKE_MEM_NOACCESS
(°ack, 
globÆ_°ack_t›
-°ack),
	`ALIGN
((°ack),—y≥)/()),
	`VALGRIND_MAKE_MEM_UNDEFINED
(°ack, ((size)*—y≥)/())),(°ack)+=(2*(size)*—y≥)/()),—y≥*)((°ack)-(2*(size)*—y≥)/())))

	)

138 
	#RESTORE_STACK
 ((
globÆ_°ack
 = 
_ßved_°ack
),
	`VALGRIND_MAKE_MEM_NOACCESS
(globÆ_°ack, 
globÆ_°ack_t›
-globÆ_°ack))

	)

139 
	#ALLOC_STACK
 *
_ßved_°ack
; ((
globÆ_°ack
 = (globÆ_°ack==0Ë? ((
globÆ_°ack_t›
=
	`›us_Æloc_s¸©ch
(
GLOBAL_STACK_SIZE
*2)+(GLOBAL_STACK_SIZE*2))-(GLOBAL_STACK_SIZE*2)Ë: globÆ_°ack),
	`VALGRIND_MAKE_MEM_NOACCESS
(globÆ_°ack, globÆ_°ack_t›-globÆ_°ack)); _ßved_°ack = globÆ_°ack;

	)

143 
	#ALIGN
(
°ack
, 
size
Ë((°ackË+((sizeË- ()(°ack)Ë& ((sizeË- 1))

	)

144 
	#PUSH
(
°ack
, 
size
, 
ty≥
Ë(
	`ALIGN
((°ack),—y≥)/()),(°ack)+=(size)*(—y≥)/()),—y≥*)((°ack)-(size)*(—y≥)/())))

	)

146 
	#RESTORE_STACK
 (
	`¥ötf
("%ld %s:%d\n", 
globÆ_°ack
-
s¸©ch_±r
, 
__FILE__
, 
__LINE__
),globÆ_°ack = 
_ßved_°ack
)

	)

148 
	#RESTORE_STACK
 (
globÆ_°ack
 = 
_ßved_°ack
)

	)

150 
	#ALLOC_STACK
 *
_ßved_°ack
; (
globÆ_°ack
 = (globÆ_°ack==0Ë? (
s¸©ch_±r
=
	`›us_Æloc_s¸©ch
(
GLOBAL_STACK_SIZE
)Ë: globÆ_°ack); _ßved_°ack = globÆ_°ack;

	)

154 
	~"os_suµ‹t.h
"

155 
	#VARDECL
(
ty≥
, 
v¨
Ëty≥ *
	)
var

156 
	#ALLOC
(
v¨
, 
size
, 
ty≥
Ëv¨ = 
	`PUSH
(
globÆ_°ack
, size,Åy≥)

	)

157 
	#SAVE_STACK
 *
_ßved_°ack
 = 
globÆ_°ack
;

	)

158 
	#ALLOC_NONE
 0

	)

163 #ifde‡
ENABLE_VALGRIND


165 
	~<vÆgröd/memcheck.h
>

166 
	#OPUS_CHECK_ARRAY
(
±r
, 
Àn
Ë
	`VALGRIND_CHECK_MEM_IS_DEFINED
’å,Üí*(*±r))

	)

167 
	#OPUS_CHECK_VALUE
(
vÆue
Ë
	`VALGRIND_CHECK_VALUE_IS_DEFINED
(vÆue)

	)

168 
	#OPUS_CHECK_ARRAY_COND
(
±r
, 
Àn
Ë
	`VALGRIND_CHECK_MEM_IS_DEFINED
’å,Üí*(*±r))

	)

169 
	#OPUS_CHECK_VALUE_COND
(
vÆue
Ë
	`VALGRIND_CHECK_VALUE_IS_DEFINED
(vÆue)

	)

170 
	#OPUS_PRINT_INT
(
vÆue
Ëdÿ{
	`Ârötf
(
°dîr
, #vÆuê" = %dáà%s:%d\n", vÆue, 
__FILE__
, 
__LINE__
);}0)

	)

171 
	#OPUS_FPRINTF
 
Ârötf


	)

175 
OPUS_INLINE
 
	$_›us_Ál£
(Ë{ 0;
	}
}

176 
	#OPUS_CHECK_ARRAY
(
±r
, 
Àn
Ë
	`_›us_Ál£
()

	)

177 
	#OPUS_CHECK_VALUE
(
vÆue
Ë
	`_›us_Ál£
()

	)

178 
	#OPUS_PRINT_INT
(
vÆue
Ëdo{}0)

	)

179 
	#OPUS_FPRINTF
 ()

	)

	@celt/static_modes_fixed.h

4 
	~"modes.h
"

5 
	~"øã.h
"

7 #ifde‡
HAVE_ARM_NE10


8 
	#OVERRIDE_FFT
 1

	)

9 
	~"°©ic_modes_fixed_¨m_√10.h
"

12 #i‚de‡
DEF_WINDOW120


13 
	#DEF_WINDOW120


	)

14 c⁄° 
›us_vÆ16
 
	gwödow120
[120] = {

42 #i‚de‡
DEF_LOGN400


43 
	#DEF_LOGN400


	)

44 c⁄° 
›us_öt16
 
	glogN400
[21] = {

48 #i‚de‡
DEF_PULSE_CACHE50


49 
	#DEF_PULSE_CACHE50


	)

50 c⁄° 
›us_öt16
 
	gˇche_ödex50
[105] = {

59 c⁄° 
	gˇche_bôs50
[392] = {

87 c⁄° 
	gˇche_ˇps50
[168] = {

102 #i‚de‡
FFT_TWIDDLES48000_960


103 
	#FFT_TWIDDLES48000_960


	)

104 c⁄° 
kiss_twiddÀ_˝x
 
	gf·_twiddÀs48000_960
[480] = {

346 #i‚de‡
FFT_BITREV480


347 
	#FFT_BITREV480


	)

348 c⁄° 
›us_öt16
 
	gf·_bôªv480
[480] = {

384 #i‚de‡
FFT_BITREV240


385 
	#FFT_BITREV240


	)

386 c⁄° 
›us_öt16
 
	gf·_bôªv240
[240] = {

406 #i‚de‡
FFT_BITREV120


407 
	#FFT_BITREV120


	)

408 c⁄° 
›us_öt16
 
	gf·_bôªv120
[120] = {

420 #i‚de‡
FFT_BITREV60


421 
	#FFT_BITREV60


	)

422 c⁄° 
›us_öt16
 
	gf·_bôªv60
[60] = {

430 #i‚de‡
FFT_STATE48000_960_0


431 
	#FFT_STATE48000_960_0


	)

432 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_0
 = {

438 
f·_bôªv480
,

439 
f·_twiddÀs48000_960
,

440 #ifde‡
OVERRIDE_FFT


441 (
¨ch_f·_°©e
 *)&
cfg_¨ch_480
,

443 
NULL
,

448 #i‚de‡
FFT_STATE48000_960_1


449 
	#FFT_STATE48000_960_1


	)

450 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_1
 = {

456 
f·_bôªv240
,

457 
f·_twiddÀs48000_960
,

458 #ifde‡
OVERRIDE_FFT


459 (
¨ch_f·_°©e
 *)&
cfg_¨ch_240
,

461 
NULL
,

466 #i‚de‡
FFT_STATE48000_960_2


467 
	#FFT_STATE48000_960_2


	)

468 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_2
 = {

474 
f·_bôªv120
,

475 
f·_twiddÀs48000_960
,

476 #ifde‡
OVERRIDE_FFT


477 (
¨ch_f·_°©e
 *)&
cfg_¨ch_120
,

479 
NULL
,

484 #i‚de‡
FFT_STATE48000_960_3


485 
	#FFT_STATE48000_960_3


	)

486 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_3
 = {

492 
f·_bôªv60
,

493 
f·_twiddÀs48000_960
,

494 #ifde‡
OVERRIDE_FFT


495 (
¨ch_f·_°©e
 *)&
cfg_¨ch_60
,

497 
NULL
,

504 #i‚de‡
MDCT_TWIDDLES960


505 
	#MDCT_TWIDDLES960


	)

506 c⁄° 
›us_vÆ16
 
	gmd˘_twiddÀs960
[1800] = {

870 c⁄° 
CELTMode
 
	gmode48000_960_120
 = {

876 
eb™d5ms
,

881 
b™d_Æloˇti⁄
,

882 
logN400
,

883 
wödow120
,

884 {1920, 3, {&
f·_°©e48000_960_0
, &
f·_°©e48000_960_1
, &
f·_°©e48000_960_2
, &
f·_°©e48000_960_3
, }, 
md˘_twiddÀs960
},

885 {392, 
ˇche_ödex50
, 
ˇche_bôs50
, 
ˇche_ˇps50
},

889 
	#TOTAL_MODES
 1

	)

890 c⁄° 
CELTMode
 * c⁄° 
	g°©ic_mode_li°
[
TOTAL_MODES
] = {

891 &
mode48000_960_120
,

	@celt/static_modes_fixed_arm_ne10.h

4 
	~<NE10_ty≥s.h
>

6 #i‚de‡
NE10_FFT_PARAMS48000_960


7 
	#NE10_FFT_PARAMS48000_960


	)

8 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_480
[64] = {

14 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_240
[64] = {

20 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_120
[64] = {

26 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_60
[64] = {

32 c⁄° 
√10_f·_˝x_öt32_t
 
	g√10_twiddÀs_480
[480] = {

194 c⁄° 
√10_f·_˝x_öt32_t
 
	g√10_twiddÀs_240
[240] = {

276 c⁄° 
√10_f·_˝x_öt32_t
 
	g√10_twiddÀs_120
[120] = {

318 c⁄° 
√10_f·_˝x_öt32_t
 
	g√10_twiddÀs_60
[60] = {

340 c⁄° 
√10_f·_°©e_öt32_t
 
	g√10_f·_°©e_öt32_t_480
 = {

342 (
√10_öt32_t
 *)
√10_Á˘‹s_480
,

343 (
√10_f·_˝x_öt32_t
 *)
√10_twiddÀs_480
,

344 
NULL
,

345 (
√10_f·_˝x_öt32_t
 *)&
√10_twiddÀs_480
[120],

347 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_480
 = {

349 (*)&
√10_f·_°©e_öt32_t_480
,

352 c⁄° 
√10_f·_°©e_öt32_t
 
	g√10_f·_°©e_öt32_t_240
 = {

354 (
√10_öt32_t
 *)
√10_Á˘‹s_240
,

355 (
√10_f·_˝x_öt32_t
 *)
√10_twiddÀs_240
,

356 
NULL
,

357 (
√10_f·_˝x_öt32_t
 *)&
√10_twiddÀs_240
[60],

359 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_240
 = {

361 (*)&
√10_f·_°©e_öt32_t_240
,

364 c⁄° 
√10_f·_°©e_öt32_t
 
	g√10_f·_°©e_öt32_t_120
 = {

366 (
√10_öt32_t
 *)
√10_Á˘‹s_120
,

367 (
√10_f·_˝x_öt32_t
 *)
√10_twiddÀs_120
,

368 
NULL
,

369 (
√10_f·_˝x_öt32_t
 *)&
√10_twiddÀs_120
[30],

371 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_120
 = {

373 (*)&
√10_f·_°©e_öt32_t_120
,

376 c⁄° 
√10_f·_°©e_öt32_t
 
	g√10_f·_°©e_öt32_t_60
 = {

378 (
√10_öt32_t
 *)
√10_Á˘‹s_60
,

379 (
√10_f·_˝x_öt32_t
 *)
√10_twiddÀs_60
,

380 
NULL
,

381 (
√10_f·_˝x_öt32_t
 *)&
√10_twiddÀs_60
[15],

383 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_60
 = {

385 (*)&
√10_f·_°©e_öt32_t_60
,

	@celt/static_modes_float.h

4 
	~"modes.h
"

5 
	~"øã.h
"

7 #ifde‡
HAVE_ARM_NE10


8 
	#OVERRIDE_FFT
 1

	)

9 
	~"°©ic_modes_Êﬂt_¨m_√10.h
"

12 #i‚de‡
DEF_WINDOW120


13 
	#DEF_WINDOW120


	)

14 c⁄° 
›us_vÆ16
 
	gwödow120
[120] = {

42 #i‚de‡
DEF_LOGN400


43 
	#DEF_LOGN400


	)

44 c⁄° 
›us_öt16
 
	glogN400
[21] = {

48 #i‚de‡
DEF_PULSE_CACHE50


49 
	#DEF_PULSE_CACHE50


	)

50 c⁄° 
›us_öt16
 
	gˇche_ödex50
[105] = {

59 c⁄° 
	gˇche_bôs50
[392] = {

87 c⁄° 
	gˇche_ˇps50
[168] = {

102 #i‚de‡
FFT_TWIDDLES48000_960


103 
	#FFT_TWIDDLES48000_960


	)

104 c⁄° 
kiss_twiddÀ_˝x
 
	gf·_twiddÀs48000_960
[480] = {

346 #i‚de‡
FFT_BITREV480


347 
	#FFT_BITREV480


	)

348 c⁄° 
›us_öt16
 
	gf·_bôªv480
[480] = {

384 #i‚de‡
FFT_BITREV240


385 
	#FFT_BITREV240


	)

386 c⁄° 
›us_öt16
 
	gf·_bôªv240
[240] = {

406 #i‚de‡
FFT_BITREV120


407 
	#FFT_BITREV120


	)

408 c⁄° 
›us_öt16
 
	gf·_bôªv120
[120] = {

420 #i‚de‡
FFT_BITREV60


421 
	#FFT_BITREV60


	)

422 c⁄° 
›us_öt16
 
	gf·_bôªv60
[60] = {

430 #i‚de‡
FFT_STATE48000_960_0


431 
	#FFT_STATE48000_960_0


	)

432 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_0
 = {

437 
f·_bôªv480
,

438 
f·_twiddÀs48000_960
,

439 #ifde‡
OVERRIDE_FFT


440 (
¨ch_f·_°©e
 *)&
cfg_¨ch_480
,

442 
NULL
,

447 #i‚de‡
FFT_STATE48000_960_1


448 
	#FFT_STATE48000_960_1


	)

449 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_1
 = {

454 
f·_bôªv240
,

455 
f·_twiddÀs48000_960
,

456 #ifde‡
OVERRIDE_FFT


457 (
¨ch_f·_°©e
 *)&
cfg_¨ch_240
,

459 
NULL
,

464 #i‚de‡
FFT_STATE48000_960_2


465 
	#FFT_STATE48000_960_2


	)

466 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_2
 = {

471 
f·_bôªv120
,

472 
f·_twiddÀs48000_960
,

473 #ifde‡
OVERRIDE_FFT


474 (
¨ch_f·_°©e
 *)&
cfg_¨ch_120
,

476 
NULL
,

481 #i‚de‡
FFT_STATE48000_960_3


482 
	#FFT_STATE48000_960_3


	)

483 c⁄° 
kiss_f·_°©e
 
	gf·_°©e48000_960_3
 = {

488 
f·_bôªv60
,

489 
f·_twiddÀs48000_960
,

490 #ifde‡
OVERRIDE_FFT


491 (
¨ch_f·_°©e
 *)&
cfg_¨ch_60
,

493 
NULL
,

500 #i‚de‡
MDCT_TWIDDLES960


501 
	#MDCT_TWIDDLES960


	)

502 c⁄° 
›us_vÆ16
 
	gmd˘_twiddÀs960
[1800] = {

866 c⁄° 
CELTMode
 
	gmode48000_960_120
 = {

872 
eb™d5ms
,

877 
b™d_Æloˇti⁄
,

878 
logN400
,

879 
wödow120
,

880 {1920, 3, {&
f·_°©e48000_960_0
, &
f·_°©e48000_960_1
, &
f·_°©e48000_960_2
, &
f·_°©e48000_960_3
, }, 
md˘_twiddÀs960
},

881 {392, 
ˇche_ödex50
, 
ˇche_bôs50
, 
ˇche_ˇps50
},

885 
	#TOTAL_MODES
 1

	)

886 c⁄° 
CELTMode
 * c⁄° 
	g°©ic_mode_li°
[
TOTAL_MODES
] = {

887 &
mode48000_960_120
,

	@celt/static_modes_float_arm_ne10.h

4 
	~<NE10_ty≥s.h
>

6 #i‚de‡
NE10_FFT_PARAMS48000_960


7 
	#NE10_FFT_PARAMS48000_960


	)

8 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_480
[64] = {

14 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_240
[64] = {

20 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_120
[64] = {

26 c⁄° 
√10_öt32_t
 
	g√10_Á˘‹s_60
[64] = {

32 c⁄° 
√10_f·_˝x_Êﬂt32_t
 
	g√10_twiddÀs_480
[480] = {

194 c⁄° 
√10_f·_˝x_Êﬂt32_t
 
	g√10_twiddÀs_240
[240] = {

276 c⁄° 
√10_f·_˝x_Êﬂt32_t
 
	g√10_twiddÀs_120
[120] = {

318 c⁄° 
√10_f·_˝x_Êﬂt32_t
 
	g√10_twiddÀs_60
[60] = {

340 c⁄° 
√10_f·_°©e_Êﬂt32_t
 
	g√10_f·_°©e_Êﬂt32_t_480
 = {

342 (
√10_öt32_t
 *)
√10_Á˘‹s_480
,

343 (
√10_f·_˝x_Êﬂt32_t
 *)
√10_twiddÀs_480
,

344 
NULL
,

345 (
√10_f·_˝x_Êﬂt32_t
 *)&
√10_twiddÀs_480
[120],

347 (
√10_öt32_t
) 1,

349 (
√10_öt32_t
) 0,

351 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_480
 = {

353 (*)&
√10_f·_°©e_Êﬂt32_t_480
,

356 c⁄° 
√10_f·_°©e_Êﬂt32_t
 
	g√10_f·_°©e_Êﬂt32_t_240
 = {

358 (
√10_öt32_t
 *)
√10_Á˘‹s_240
,

359 (
√10_f·_˝x_Êﬂt32_t
 *)
√10_twiddÀs_240
,

360 
NULL
,

361 (
√10_f·_˝x_Êﬂt32_t
 *)&
√10_twiddÀs_240
[60],

363 (
√10_öt32_t
) 1,

365 (
√10_öt32_t
) 0,

367 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_240
 = {

369 (*)&
√10_f·_°©e_Êﬂt32_t_240
,

372 c⁄° 
√10_f·_°©e_Êﬂt32_t
 
	g√10_f·_°©e_Êﬂt32_t_120
 = {

374 (
√10_öt32_t
 *)
√10_Á˘‹s_120
,

375 (
√10_f·_˝x_Êﬂt32_t
 *)
√10_twiddÀs_120
,

376 
NULL
,

377 (
√10_f·_˝x_Êﬂt32_t
 *)&
√10_twiddÀs_120
[30],

379 (
√10_öt32_t
) 1,

381 (
√10_öt32_t
) 0,

383 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_120
 = {

385 (*)&
√10_f·_°©e_Êﬂt32_t_120
,

388 c⁄° 
√10_f·_°©e_Êﬂt32_t
 
	g√10_f·_°©e_Êﬂt32_t_60
 = {

390 (
√10_öt32_t
 *)
√10_Á˘‹s_60
,

391 (
√10_f·_˝x_Êﬂt32_t
 *)
√10_twiddÀs_60
,

392 
NULL
,

393 (
√10_f·_˝x_Êﬂt32_t
 *)&
√10_twiddÀs_60
[15],

395 (
√10_öt32_t
) 1,

397 (
√10_öt32_t
) 0,

399 c⁄° 
¨ch_f·_°©e
 
	gcfg_¨ch_60
 = {

401 (*)&
√10_f·_°©e_Êﬂt32_t_60
,

	@celt/tests/test_unit_cwrs32.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<°dio.h
>

34 
	~<°rög.h
>

36 #i‚de‡
CUSTOM_MODES


37 
	#CUSTOM_MODES


	)

39 
	#TEST_CUSTOM_MODES


	)

42 
	#CELT_C


	)

43 
	~"°ack_Æloc.h
"

44 
	~"íãnc.c
"

45 
	~"ítdec.c
"

46 
	~"ítcode.c
"

47 
	~"cwrs.c
"

48 
	~"m©h›s.c
"

49 
	~"øã.h
"

51 
	#NMAX
 (240)

	)

52 
	#KMAX
 (128)

	)

54 #ifde‡
TEST_CUSTOM_MODES


56 
	#NDIMS
 (44)

	)

57 c⁄° 
	g≤
[
NDIMS
]={

64 c⁄° 
	gpkmax
[
NDIMS
]={

74 
	#NDIMS
 (22)

	)

75 c⁄° 
	g≤
[
NDIMS
]={

80 c⁄° 
	gpkmax
[
NDIMS
]={

88 
	$maö
(){

89 
t
;

90 
n
;

91 
ALLOC_STACK
;

92 
t
=0;t<
NDIMS
;t++){

93 
p£udo
;

94 
n
=
≤
[
t
];

95 
p£udo
=1;pseudo<41;pseudo++)

97 
k
;

98 #i‡
	`deföed
(
SMALL_FOOTPRINT
)

99 
›us_uöt32
 
uu
[
KMAX
+2U];

101 
›us_uöt32
 
öc
;

102 
›us_uöt32
 
nc
;

103 
›us_uöt32
 
i
;

104 
k
=
	`gë_pul£s
(
p£udo
);

105 i‡(
k
>
pkmax
[
t
]);

106 
	`¥ötf
("Te°ög CWRS wôh N=%i, K=%i...\n",
n
,
k
);

107 #i‡
	`deföed
(
SMALL_FOOTPRINT
)

108 
nc
=
	`ncwrs_urow
(
n
,
k
,
uu
);

110 
nc
=
	`CELT_PVQ_V
(
n
,
k
);

112 
öc
=
nc
/20000;

113 if(
öc
<1)inc=1;

114 
i
=0;i<
nc
;i+=
öc
){

115 #i‡
	`deföed
(
SMALL_FOOTPRINT
)

116 
›us_uöt32
 
u
[
KMAX
+2U];

118 
y
[
NMAX
];

119 
sy
;

120 
›us_uöt32
 
v
;

121 
›us_uöt32
 
ii
;

122 
j
;

123 #i‡
	`deföed
(
SMALL_FOOTPRINT
)

124 
	`mem˝y
(
u
,
uu
,(
k
+2U)*(*u));

125 
	`cwrsi
(
n
,
k
,
i
,
y
,
u
);

127 
	`cwrsi
(
n
,
k
,
i
,
y
);

129 
sy
=0;

130 
j
=0;j<
n
;j++)
sy
+=
	`abs
(
y
[j]);

131 if(
sy
!=
k
){

132 
	`Ârötf
(
°dîr
,"N=%d Pulse count mismatch in cwrsi (%d!=%d).\n",

133 
n
,
sy
,
k
);

139 #i‡
	`deföed
(
SMALL_FOOTPRINT
)

140 
ii
=
	`icwrs
(
n
,
k
,&
v
,
y
,
u
);

142 
ii
=
	`icwrs
(
n
,
y
);

143 
v
=
	`CELT_PVQ_V
(
n
,
k
);

145 if(
ii
!=
i
){

146 
	`Ârötf
(
°dîr
,"Combination-index mismatch (%lu!=%lu).\n",

147 ()
ii
,()
i
);

150 if(
v
!=
nc
){

151 
	`Ârötf
(
°dîr
,"Combination count mismatch (%lu!=%lu).\n",

152 ()
v
,()
nc
);

161 
	}
}

	@celt/tests/test_unit_dft.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

34 
	~"°ack_Æloc.h
"

35 
	~"kiss_f·.h
"

36 
	~"m©h›s.h
"

37 
	~"modes.h
"

39 #i‚de‡
M_PI


40 
	#M_PI
 3.141592653

	)

43 
	gªt
 = 0;

45 
	$check
(
kiss_f·_˝x
 * 
ö
,kiss_f·_˝x * 
out
,
nf·
,
isövî£
)

47 
bö
,
k
;

48 
îΩow
=0,
sigpow
=0, 
¢r
;

50 
bö
=0;bö<
nf·
;++bin) {

51 
™§
 = 0;

52 
™si
 = 0;

53 
di‰
;

54 
difi
;

56 
k
=0;k<
nf·
;++k) {

57 
pha£
 = -2*
M_PI
*
bö
*
k
/
nf·
;

58 
ª
 = 
	`cos
(
pha£
);

59 
im
 = 
	`sö
(
pha£
);

60 i‡(
isövî£
)

61 
im
 = -im;

63 i‡(!
isövî£
)

65 
ª
 /
nf·
;

66 
im
 /
nf·
;

69 
™§
 +
ö
[
k
].
r
 * 
ª
 - in[k].
i
 * 
im
;

70 
™si
 +
ö
[
k
].
r
 * 
im
 + in[k].
i
 * 
ª
;

73 
di‰
 = 
™§
 - 
out
[
bö
].
r
;

74 
difi
 = 
™si
 - 
out
[
bö
].
i
;

75 
îΩow
 +
di‰
*di‰ + 
difi
*difi;

76 
sigpow
 +
™§
*™§+
™si
*ansi;

78 
¢r
 = 10*
	`log10
(
sigpow
/
îΩow
);

79 
	`¥ötf
("nf·=%d invî£=%d,¢∏%f\n",
nf·
,
isövî£
,
¢r
 );

80 i‡(
¢r
<60) {

81 
	`¥ötf
–"**Öo‹ sƒ: %‡** \n", 
¢r
);

82 
ªt
 = 1;

84 
	}
}

86 
	$ã°1d
(
nf·
,
isövî£
,
¨ch
)

88 
size_t
 
buÊí
 = (
kiss_f·_˝x
)*
nf·
;

89 
kiss_f·_˝x
 *
ö
;

90 
kiss_f·_˝x
 *
out
;

91 
k
;

92 #ifde‡
CUSTOM_MODES


93 
kiss_f·_°©e
 *
cfg
 = 
	`›us_f·_Æloc
(
nf·
,0,0,
¨ch
);

95 
id
;

96 c⁄° 
kiss_f·_°©e
 *
cfg
;

97 
CELTMode
 *
mode
 = 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
);

98 i‡(
nf·
 =480Ë
id
 = 0;

99 i‡(
nf·
 =240Ë
id
 = 1;

100 i‡(
nf·
 =120Ë
id
 = 2;

101 i‡(
nf·
 =60Ë
id
 = 3;

103 
cfg
 = 
mode
->
md˘
.
kf·
[
id
];

106 
ö
 = (
kiss_f·_˝x
*)
	`mÆloc
(
buÊí
);

107 
out
 = (
kiss_f·_˝x
*)
	`mÆloc
(
buÊí
);

109 
k
=0;k<
nf·
;++k) {

110 
ö
[
k
].
r
 = (
	`ønd
() % 32767) - 16384;

111 
ö
[
k
].
i
 = (
	`ønd
() % 32767) - 16384;

114 
k
=0;k<
nf·
;++k) {

115 
ö
[
k
].
r
 *= 32768;

116 
ö
[
k
].
i
 *= 32768;

119 i‡(
isövî£
)

121 
k
=0;k<
nf·
;++k) {

122 
ö
[
k
].
r
 /
nf·
;

123 
ö
[
k
].
i
 /
nf·
;

129 i‡(
isövî£
)

130 
	`›us_if·
(
cfg
,
ö
,
out
, 
¨ch
);

132 
	`›us_f·
(
cfg
,
ö
,
out
, 
¨ch
);

136 
	`check
(
ö
,
out
,
nf·
,
isövî£
);

138 
	`‰ì
(
ö
);

139 
	`‰ì
(
out
);

140 #ifde‡
CUSTOM_MODES


141 
	`›us_f·_‰ì
(
cfg
, 
¨ch
);

143 
	}
}

145 
	$maö
(
¨gc
,** 
¨gv
)

147 
ALLOC_STACK
;

148 
¨ch
 = 
	`›us_£À˘_¨ch
();

150 i‡(
¨gc
>1) {

151 
k
;

152 
k
=1;k<
¨gc
;++k) {

153 
	`ã°1d
(
	`©oi
(
¨gv
[
k
]),0,
¨ch
);

154 
	`ã°1d
(
	`©oi
(
¨gv
[
k
]),1,
¨ch
);

157 
	`ã°1d
(32,0,
¨ch
);

158 
	`ã°1d
(32,1,
¨ch
);

159 
	`ã°1d
(128,0,
¨ch
);

160 
	`ã°1d
(128,1,
¨ch
);

161 
	`ã°1d
(256,0,
¨ch
);

162 
	`ã°1d
(256,1,
¨ch
);

163 #i‚de‡
RADIX_TWO_ONLY


164 
	`ã°1d
(36,0,
¨ch
);

165 
	`ã°1d
(36,1,
¨ch
);

166 
	`ã°1d
(50,0,
¨ch
);

167 
	`ã°1d
(50,1,
¨ch
);

168 
	`ã°1d
(60,0,
¨ch
);

169 
	`ã°1d
(60,1,
¨ch
);

170 
	`ã°1d
(120,0,
¨ch
);

171 
	`ã°1d
(120,1,
¨ch
);

172 
	`ã°1d
(240,0,
¨ch
);

173 
	`ã°1d
(240,1,
¨ch
);

174 
	`ã°1d
(480,0,
¨ch
);

175 
	`ã°1d
(480,1,
¨ch
);

178  
ªt
;

179 
	}
}

	@celt/tests/test_unit_entropy.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<°dlib.h
>

34 
	~<°dio.h
>

35 
	~<m©h.h
>

36 
	~<time.h
>

37 
	#CELT_C


	)

38 
	~"ítcode.h
"

39 
	~"íãnc.h
"

40 
	~"ítdec.h
"

41 
	~<°rög.h
>

43 
	~"íãnc.c
"

44 
	~"ítdec.c
"

45 
	~"ítcode.c
"

47 #i‚de‡
M_LOG2E


48 
	#M_LOG2E
 1.4426950408889634074

	)

50 
	#DATA_SIZE
 10000000

	)

51 
	#DATA_SIZE2
 10000

	)

53 
	$maö
(
_¨gc
,**
_¨gv
){

54 
ec_íc
 
íc
;

55 
ec_dec
 
dec
;

56 
nbôs
;

57 
nbôs2
;

58 
íå›y
;

59 
·
;

60 
·b
;

61 
sz
;

62 
i
;

63 
ªt
;

64 
sym
;

65 
£ed
;

66 *
±r
;

67 c⁄° *
ív_£ed
;

68 
ªt
=0;

69 
íå›y
=0;

70 i‡(
_¨gc
 > 2) {

71 
	`Ârötf
(
°dîr
, "Ußge: %†[<£ed>]\n", 
_¨gv
[0]);

74 
ív_£ed
 = 
	`gëív
("SEED");

75 i‡(
_¨gc
 > 1)

76 
£ed
 = 
	`©oi
(
_¨gv
[1]);

77 i‡(
ív_£ed
)

78 
£ed
 = 
	`©oi
(
ív_£ed
);

80 
£ed
 = 
	`time
(
NULL
);

82 
±r
 = (*)
	`mÆloc
(
DATA_SIZE
);

83 
	`ec_íc_öô
(&
íc
,
±r
, 
DATA_SIZE
);

84 
·
=2;ft<1024;ft++){

85 
i
=0;i<
·
;i++){

86 
íå›y
+=
	`log
(
·
)*
M_LOG2E
;

87 
	`ec_íc_uöt
(&
íc
,
i
,
·
);

91 
·b
=1;ftb<16;ftb++){

92 
i
=0;i<(1<<
·b
);i++){

93 
íå›y
+=
·b
;

94 
nbôs
=
	`ec_ãŒ
(&
íc
);

95 
	`ec_íc_bôs
(&
íc
,
i
,
·b
);

96 
nbôs2
=
	`ec_ãŒ
(&
íc
);

97 if(
nbôs2
-
nbôs
!=
·b
){

98 
	`Ârötf
(
°dîr
,"Used %li bitsÅoÉncode %i bits directly.\n",

99 
nbôs2
-
nbôs
,
·b
);

100 
ªt
=-1;

104 
nbôs
=
	`ec_ãŒ_‰ac
(&
íc
);

105 
	`ec_íc_d⁄e
(&
íc
);

106 
	`Ârötf
(
°dîr
,

108 
íå›y
,
	`ldexp
(
nbôs
,-3),100*(nbits-ldexp(entropy,3))/nbits);

109 
	`Ârötf
(
°dîr
,"PackedÅÿ%lòbyãs.\n",()
	`ec_ønge_byãs
(&
íc
));

110 
	`ec_dec_öô
(&
dec
,
±r
,
DATA_SIZE
);

111 
·
=2;ft<1024;ft++){

112 
i
=0;i<
·
;i++){

113 
sym
=
	`ec_dec_uöt
(&
dec
,
·
);

114 if(
sym
!=()
i
){

115 
	`Ârötf
(
°dîr
,"Decoded %òö°ód o‡%òwôh fào‡%i.\n",
sym
,
i
,
·
);

116 
ªt
=-1;

120 
·b
=1;ftb<16;ftb++){

121 
i
=0;i<(1<<
·b
);i++){

122 
sym
=
	`ec_dec_bôs
(&
dec
,
·b
);

123 if(
sym
!=()
i
){

124 
	`Ârötf
(
°dîr
,"Decoded %òö°ód o‡%òwôh ftb o‡%i.\n",
sym
,
i
,
·b
);

125 
ªt
=-1;

129 
nbôs2
=
	`ec_ãŒ_‰ac
(&
dec
);

130 if(
nbôs
!=
nbôs2
){

131 
	`Ârötf
(
°dîr
,

133 
	`ldexp
(
nbôs2
,-3),ldexp(
nbôs
,-3));

134 
ªt
=-1;

142 
	`ec_íc_öô
(&
íc
,
±r
,2);

144 
	`ec_íc_bôs
(&
íc
,0x55,7);

146 
	`ec_íc_uöt
(&
íc
,1,2);

147 
	`ec_íc_uöt
(&
íc
,1,3);

148 
	`ec_íc_uöt
(&
íc
,1,4);

149 
	`ec_íc_uöt
(&
íc
,1,5);

150 
	`ec_íc_uöt
(&
íc
,2,6);

151 
	`ec_íc_uöt
(&
íc
,6,7);

152 
	`ec_íc_d⁄e
(&
íc
);

153 
	`ec_dec_öô
(&
dec
,
±r
,2);

154 if(!
íc
.
îr‹


156 ||
	`ec_dec_bôs
(&
dec
,7)!=0x05

158 ||
	`ec_dec_uöt
(&
dec
,2)!=1

159 ||
	`ec_dec_uöt
(&
dec
,3)!=1

160 ||
	`ec_dec_uöt
(&
dec
,4)!=1

161 ||
	`ec_dec_uöt
(&
dec
,5)!=1

162 ||
	`ec_dec_uöt
(&
dec
,6)!=2

163 ||
	`ec_dec_uöt
(&
dec
,7)!=6){

164 
	`Ârötf
(
°dîr
,"Encoder bust overwroteÑange coder data withÑaw bits.\n");

165 
ªt
=-1;

167 
	`§™d
(
£ed
);

168 
	`Ârötf
(
°dîr
,"Te°ögÑ™dom såóms... R™dom sìd: %u (%.4X)\n", 
£ed
, 
	`ønd
() % 65536);

169 
i
=0;i<409600;i++){

170 *
d©a
;

171 *
ãŒ
;

172 
ãŒ_bôs
;

173 
j
;

174 
zîos
;

175 
·
=
	`ønd
()/((
RAND_MAX
>>(rand()%11U))+1U)+10;

176 
sz
=
	`ønd
()/((
RAND_MAX
>>(rand()%9U))+1U);

177 
d©a
=(*)
	`mÆloc
(
sz
*(*data));

178 
ãŒ
=(*)
	`mÆloc
((
sz
+1)*(*tell));

179 
	`ec_íc_öô
(&
íc
,
±r
,
DATA_SIZE2
);

180 
zîos
 = 
	`ønd
()%13==0;

181 
ãŒ
[0]=
	`ec_ãŒ_‰ac
(&
íc
);

182 
j
=0;j<
sz
;j++){

183 i‡(
zîos
)

184 
d©a
[
j
]=0;

186 
d©a
[
j
]=
	`ønd
()%
·
;

187 
	`ec_íc_uöt
(&
íc
,
d©a
[
j
],
·
);

188 
ãŒ
[
j
+1]=
	`ec_ãŒ_‰ac
(&
íc
);

190 i‡(
	`ønd
()%2==0)

191 
	`ec_ãŒ
(&
íc
)%8 != 0)

192 
	`ec_íc_uöt
(&
íc
, 
	`ønd
()%2, 2);

193 
ãŒ_bôs
 = 
	`ec_ãŒ
(&
íc
);

194 
	`ec_íc_d⁄e
(&
íc
);

195 if(
ãŒ_bôs
!=()
	`ec_ãŒ
(&
íc
)){

196 
	`Ârötf
(
°dîr
,"ec_tell() changedáfterÉc_enc_done(): %i instead of %i (Random seed: %u)\n",

197 
	`ec_ãŒ
(&
íc
),
ãŒ_bôs
,
£ed
);

198 
ªt
=-1;

200 i‡((
ãŒ_bôs
+7)/8 < 
	`ec_ønge_byãs
(&
íc
))

202 
	`Ârötf
 (
°dîr
, "ec_tell()Üied,Åhere's %i bytes instead of %d (Random seed: %u)\n",

203 
	`ec_ønge_byãs
(&
íc
), (
ãŒ_bôs
+7)/8,
£ed
);

204 
ªt
=-1;

206 
	`ec_dec_öô
(&
dec
,
±r
,
DATA_SIZE2
);

207 if(
	`ec_ãŒ_‰ac
(&
dec
)!=
ãŒ
[0]){

208 
	`Ârötf
(
°dîr
,

210 0,
	`ec_ãŒ_‰ac
(&
dec
),
ãŒ
[0],
£ed
);

212 
j
=0;j<
sz
;j++){

213 
sym
=
	`ec_dec_uöt
(&
dec
,
·
);

214 if(
sym
!=
d©a
[
j
]){

215 
	`Ârötf
(
°dîr
,

217 
sym
,
d©a
[
j
],
·
,j,
sz
,
£ed
);

218 
ªt
=-1;

220 if(
	`ec_ãŒ_‰ac
(&
dec
)!=
ãŒ
[
j
+1]){

221 
	`Ârötf
(
°dîr
,

223 
j
+1,
	`ec_ãŒ_‰ac
(&
dec
),
ãŒ
[j+1],
£ed
);

226 
	`‰ì
(
ãŒ
);

227 
	`‰ì
(
d©a
);

230 
i
=0;i<409600;i++){

231 *
logp1
;

232 *
d©a
;

233 *
ãŒ
;

234 *
íc_mëhod
;

235 
j
;

236 
sz
=
	`ønd
()/((
RAND_MAX
>>(rand()%9U))+1U);

237 
logp1
=(*)
	`mÆloc
(
sz
*(*logp1));

238 
d©a
=(*)
	`mÆloc
(
sz
*(*data));

239 
ãŒ
=(*)
	`mÆloc
((
sz
+1)*(*tell));

240 
íc_mëhod
=(*)
	`mÆloc
(
sz
*(*enc_method));

241 
	`ec_íc_öô
(&
íc
,
±r
,
DATA_SIZE2
);

242 
ãŒ
[0]=
	`ec_ãŒ_‰ac
(&
íc
);

243 
j
=0;j<
sz
;j++){

244 
d©a
[
j
]=
	`ønd
()/((
RAND_MAX
>>1)+1);

245 
logp1
[
j
]=(
	`ønd
()%15)+1;

246 
íc_mëhod
[
j
]=
	`ønd
()/((
RAND_MAX
>>2)+1);

247 
íc_mëhod
[
j
]){

249 
	`ec_ícode
(&
íc
,
d©a
[
j
]?(1<<
logp1
[j])-1:0,

250 (1<<
logp1
[
j
])-(
d©a
[j]?0:1),1<<logp1[j]);

253 
	`ec_ícode_bö
(&
íc
,
d©a
[
j
]?(1<<
logp1
[j])-1:0,

254 (1<<
logp1
[
j
])-(
d©a
[j]?0:1),logp1[j]);

257 
	`ec_íc_bô_logp
(&
íc
,
d©a
[
j
],
logp1
[j]);

260 
icdf
[2];

261 
icdf
[0]=1;

262 
icdf
[1]=0;

263 
	`ec_íc_icdf
(&
íc
,
d©a
[
j
],
icdf
,
logp1
[j]);

266 
ãŒ
[
j
+1]=
	`ec_ãŒ_‰ac
(&
íc
);

268 
	`ec_íc_d⁄e
(&
íc
);

269 if((
	`ec_ãŒ
(&
íc
)+7U)/8U<
	`ec_ønge_byãs
(&enc)){

270 
	`Ârötf
(
°dîr
,"tell()Üied,Åhere's %i bytes instead of %d (Random seed: %u)\n",

271 
	`ec_ønge_byãs
(&
íc
),(
	`ec_ãŒ
(&íc)+7)/8,
£ed
);

272 
ªt
=-1;

274 
	`ec_dec_öô
(&
dec
,
±r
,
DATA_SIZE2
);

275 if(
	`ec_ãŒ_‰ac
(&
dec
)!=
ãŒ
[0]){

276 
	`Ârötf
(
°dîr
,

278 0,
	`ec_ãŒ_‰ac
(&
dec
),
ãŒ
[0],
£ed
);

280 
j
=0;j<
sz
;j++){

281 
fs
;

282 
dec_mëhod
;

283 
dec_mëhod
=
	`ønd
()/((
RAND_MAX
>>2)+1);

284 
dec_mëhod
){

286 
fs
=
	`ec_decode
(&
dec
,1<<
logp1
[
j
]);

287 
sym
=
fs
>=(1<<
logp1
[
j
])-1;

288 
	`ec_dec_upd©e
(&
dec
,
sym
?(1<<
logp1
[
j
])-1:0,

289 (1<<
logp1
[
j
])-(
sym
?0:1),1<<logp1[j]);

292 
fs
=
	`ec_decode_bö
(&
dec
,
logp1
[
j
]);

293 
sym
=
fs
>=(1<<
logp1
[
j
])-1;

294 
	`ec_dec_upd©e
(&
dec
,
sym
?(1<<
logp1
[
j
])-1:0,

295 (1<<
logp1
[
j
])-(
sym
?0:1),1<<logp1[j]);

298 
sym
=
	`ec_dec_bô_logp
(&
dec
,
logp1
[
j
]);

301 
icdf
[2];

302 
icdf
[0]=1;

303 
icdf
[1]=0;

304 
sym
=
	`ec_dec_icdf
(&
dec
,
icdf
,
logp1
[
j
]);

307 if(
sym
!=
d©a
[
j
]){

308 
	`Ârötf
(
°dîr
,

310 
sym
,
d©a
[
j
],
logp1
[j],j,
sz
,
£ed
);

311 
	`Ârötf
(
°dîr
,"Encoding method: %i, decoding method: %i\n",

312 
íc_mëhod
[
j
],
dec_mëhod
);

313 
ªt
=-1;

315 if(
	`ec_ãŒ_‰ac
(&
dec
)!=
ãŒ
[
j
+1]){

316 
	`Ârötf
(
°dîr
,

318 
j
+1,
	`ec_ãŒ_‰ac
(&
dec
),
ãŒ
[j+1],
£ed
);

321 
	`‰ì
(
íc_mëhod
);

322 
	`‰ì
(
ãŒ
);

323 
	`‰ì
(
d©a
);

324 
	`‰ì
(
logp1
);

326 
	`ec_íc_öô
(&
íc
,
±r
,
DATA_SIZE2
);

327 
	`ec_íc_bô_logp
(&
íc
,0,1);

328 
	`ec_íc_bô_logp
(&
íc
,0,1);

329 
	`ec_íc_bô_logp
(&
íc
,0,1);

330 
	`ec_íc_bô_logp
(&
íc
,0,1);

331 
	`ec_íc_bô_logp
(&
íc
,0,2);

332 
	`ec_íc_∑tch_öôül_bôs
(&
íc
,3,2);

333 if(
íc
.
îr‹
){

334 
	`Ârötf
(
°dîr
,"patch_initial_bits failed");

335 
ªt
=-1;

337 
	`ec_íc_∑tch_öôül_bôs
(&
íc
,0,5);

338 if(!
íc
.
îr‹
){

339 
	`Ârötf
(
°dîr
,"patch_initial_bits didn't fail when it should have");

340 
ªt
=-1;

342 
	`ec_íc_d⁄e
(&
íc
);

343 if(
	`ec_ønge_byãs
(&
íc
)!=1||
±r
[0]!=192){

344 
	`Ârötf
(
°dîr
,"GŸ %d whíÉx≥˘ög 192 f‹Ö©ch_öôül_bôs",
±r
[0]);

345 
ªt
=-1;

347 
	`ec_íc_öô
(&
íc
,
±r
,
DATA_SIZE2
);

348 
	`ec_íc_bô_logp
(&
íc
,0,1);

349 
	`ec_íc_bô_logp
(&
íc
,0,1);

350 
	`ec_íc_bô_logp
(&
íc
,1,6);

351 
	`ec_íc_bô_logp
(&
íc
,0,2);

352 
	`ec_íc_∑tch_öôül_bôs
(&
íc
,0,2);

353 if(
íc
.
îr‹
){

354 
	`Ârötf
(
°dîr
,"patch_initial_bits failed");

355 
ªt
=-1;

357 
	`ec_íc_d⁄e
(&
íc
);

358 if(
	`ec_ønge_byãs
(&
íc
)!=2||
±r
[0]!=63){

359 
	`Ârötf
(
°dîr
,"GŸ %d whíÉx≥˘ög 63 f‹Ö©ch_öôül_bôs",
±r
[0]);

360 
ªt
=-1;

362 
	`ec_íc_öô
(&
íc
,
±r
,2);

363 
	`ec_íc_bô_logp
(&
íc
,0,2);

364 
i
=0;i<48;i++){

365 
	`ec_íc_bôs
(&
íc
,0,1);

367 
	`ec_íc_d⁄e
(&
íc
);

368 if(!
íc
.
îr‹
){

369 
	`Ârötf
(
°dîr
,"Raw bits overfill didn't fail when it should have");

370 
ªt
=-1;

372 
	`ec_íc_öô
(&
íc
,
±r
,2);

373 
i
=0;i<17;i++){

374 
	`ec_íc_bôs
(&
íc
,0,1);

376 
	`ec_íc_d⁄e
(&
íc
);

377 if(!
íc
.
îr‹
){

378 
	`Ârötf
(
°dîr
,"17Ñaw bitsÉncoded inÅwo bytes");

379 
ªt
=-1;

381 
	`‰ì
(
±r
);

382  
ªt
;

383 
	}
}

	@celt/tests/test_unit_laplace.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	#CELT_C


	)

35 
	~"œ∂a˚.h
"

36 
	~"°ack_Æloc.h
"

38 
	~"íãnc.c
"

39 
	~"ítdec.c
"

40 
	~"ítcode.c
"

41 
	~"œ∂a˚.c
"

43 
	#DATA_SIZE
 40000

	)

45 
	$ec_œ∂a˚_gë_°¨t_‰eq
(
deˇy
)

47 
›us_uöt32
 
·
 = 32768 - 
LAPLACE_MINP
*(2*
LAPLACE_NMIN
+1);

48 
fs
 = (
·
*(16384-
deˇy
))/(16384+decay);

49  
fs
+
LAPLACE_MINP
;

50 
	}
}

52 
	$maö
()

54 
i
;

55 
ªt
 = 0;

56 
ec_íc
 
íc
;

57 
ec_dec
 
dec
;

58 *
±r
;

59 
vÆ
[10000], 
deˇy
[10000];

60 
ALLOC_STACK
;

61 
±r
 = (*)
	`mÆloc
(
DATA_SIZE
);

62 
	`ec_íc_öô
(&
íc
,
±r
,
DATA_SIZE
);

64 
vÆ
[0] = 3; 
deˇy
[0] = 6000;

65 
vÆ
[1] = 0; 
deˇy
[1] = 5800;

66 
vÆ
[2] = -1; 
deˇy
[2] = 5600;

67 
i
=3;i<10000;i++)

69 
vÆ
[
i
] = 
	`ønd
()%15-7;

70 
deˇy
[
i
] = 
	`ønd
()%11000+5000;

72 
i
=0;i<10000;i++)

73 
	`ec_œ∂a˚_ícode
(&
íc
, &
vÆ
[
i
],

74 
	`ec_œ∂a˚_gë_°¨t_‰eq
(
deˇy
[
i
]), decay[i]);

76 
	`ec_íc_d⁄e
(&
íc
);

78 
	`ec_dec_öô
(&
dec
,
	`ec_gë_buf„r
(&
íc
),
	`ec_ønge_byãs
(&enc));

80 
i
=0;i<10000;i++)

82 
d
 = 
	`ec_œ∂a˚_decode
(&
dec
,

83 
	`ec_œ∂a˚_gë_°¨t_‰eq
(
deˇy
[
i
]), decay[i]);

84 i‡(
d
 !
vÆ
[
i
])

86 
	`Ârötf
 (
°dîr
, "GŸ %d in°ód o‡%d\n", 
d
, 
vÆ
[
i
]);

87 
ªt
 = 1;

91 
	`‰ì
(
±r
);

92  
ªt
;

93 
	}
}

	@celt/tests/test_unit_mathops.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 #i‚de‡
CUSTOM_MODES


34 
	#CUSTOM_MODES


	)

37 
	~<°dio.h
>

38 
	~<m©h.h
>

39 
	~"m©h›s.h
"

40 
	~"b™ds.h
"

42 #ifde‡
FIXED_POINT


43 
	#WORD
 "%d"

	)

45 
	#WORD
 "%f"

	)

48 
	gªt
 = 0;

50 
	$ã°div
()

52 
›us_öt32
 
i
;

53 
i
=1;i<=327670;i++)

55 
¥od
;

56 
›us_vÆ32
 
vÆ
;

57 
vÆ
 = 
	`˚…_r˝
(
i
);

58 #ifde‡
FIXED_POINT


59 
¥od
 = (1./32768./65526.)*
vÆ
*
i
;

61 
¥od
 = 
vÆ
*
i
;

63 i‡(
	`Ábs
(
¥od
-1) > .00025)

65 
	`Ârötf
 (
°dîr
, "div faûed: 1/%d="
WORD
" (¥odu˘ = %f)\n", 
i
, 
vÆ
, 
¥od
);

66 
ªt
 = 1;

69 
	}
}

71 
	$ã°sqπ
()

73 
›us_öt32
 
i
;

74 
i
=1;i<=1000000000;i++)

76 
øtio
;

77 
›us_vÆ16
 
vÆ
;

78 
vÆ
 = 
	`˚…_sqπ
(
i
);

79 
øtio
 = 
vÆ
/
	`sqπ
(
i
);

80 i‡(
	`Ábs
(
øtio
 - 1Ë> .0005 && fabs(
vÆ
-
	`sqπ
(
i
)) > 2)

82 
	`Ârötf
 (
°dîr
, "sqπ faûed: sqπ(%d)="
WORD
" (øtiÿ%f)\n", 
i
, 
vÆ
, 
øtio
);

83 
ªt
 = 1;

85 
i
+= i>>10;

87 
	}
}

89 
	$ã°bôexa˘cos
()

91 
i
;

92 
›us_öt32
 
mö_d
,
max_d
,
œ°
,
chk
;

93 
chk
=
max_d
=0;

94 
œ°
=
mö_d
=32767;

95 
i
=64;i<=16320;i++)

97 
›us_öt32
 
d
;

98 
›us_öt32
 
q
=
	`bôexa˘_cos
(
i
);

99 
chk
 ^
q
*
i
;

100 
d
 = 
œ°
 - 
q
;

101 i‡(
d
>
max_d
)max_d=d;

102 i‡(
d
<
mö_d
)min_d=d;

103 
œ°
 = 
q
;

105 i‡((
chk
!=89408644)||(
max_d
!=5)||(
mö_d
!=0)||(
	`bôexa˘_cos
(64)!=32767)||

106 (
	`bôexa˘_cos
(16320)!=200)||(bitexact_cos(8192)!=23171))

108 
	`Ârötf
 (
°dîr
, "bitexact_cos failed\n");

109 
ªt
 = 1;

111 
	}
}

113 
	$ã°bôexa˘log2èn
()

115 
i
,
Áû
;

116 
›us_öt32
 
mö_d
,
max_d
,
œ°
,
chk
;

117 
Áû
=
chk
=
max_d
=0;

118 
œ°
=
mö_d
=15059;

119 
i
=64;i<8193;i++)

121 
›us_öt32
 
d
;

122 
›us_öt32
 
mid
=
	`bôexa˘_cos
(
i
);

123 
›us_öt32
 
side
=
	`bôexa˘_cos
(16384-
i
);

124 
›us_öt32
 
q
=
	`bôexa˘_log2èn
(
mid
,
side
);

125 
chk
 ^
q
*
i
;

126 
d
 = 
œ°
 - 
q
;

127 i‡(
q
!=-1*
	`bôexa˘_log2èn
(
side
,
mid
))

128 
Áû
 = 1;

129 i‡(
d
>
max_d
)max_d=d;

130 i‡(
d
<
mö_d
)min_d=d;

131 
œ°
 = 
q
;

133 i‡((
chk
!=15821257)||(
max_d
!=61)||(
mö_d
!=-2)||
Áû
||

134 (
	`bôexa˘_log2èn
(32767,200)!=15059)||(bitexact_log2tan(30274,12540)!=2611)||

135 (
	`bôexa˘_log2èn
(23171,23171)!=0))

137 
	`Ârötf
 (
°dîr
, "bitexact_log2tan failed\n");

138 
ªt
 = 1;

140 
	}
}

142 #i‚de‡
FIXED_POINT


143 
	$ã°log2
()

145 
x
;

146 
x
=0.001;x<1677700.0;x+=(x/8.0))

148 
îr‹
 = 
	`Ábs
((1.442695040888963387*
	`log
(
x
))-
	`˚…_log2
(x));

149 i‡(
îr‹
>0.0009)

151 
	`Ârötf
 (
°dîr
, "˚…_log2 faûed: fabs((1.442695040888963387*log(x))-˚…_log2(x))>0.001 (x = %f,Éº‹ = %f)\n", 
x
,
îr‹
);

152 
ªt
 = 1;

155 
	}
}

157 
	$ã°exp2
()

159 
x
;

160 
x
=-11.0;x<24.0;x+=0.0007)

162 
îr‹
 = 
	`Ábs
(
x
-(1.442695040888963387*
	`log
(
	`˚…_exp2
(x))));

163 i‡(
îr‹
>0.0002)

165 
	`Ârötf
 (
°dîr
, "˚…_exp2 faûed: fabs(x-(1.442695040888963387*log(˚…_exp2(x))))>0.0005 (x = %f,Éº‹ = %f)\n", 
x
,
îr‹
);

166 
ªt
 = 1;

169 
	}
}

171 
	$ã°exp2log2
()

173 
x
;

174 
x
=-11.0;x<24.0;x+=0.0007)

176 
îr‹
 = 
	`Ábs
(
x
-(
	`˚…_log2
(
	`˚…_exp2
(x))));

177 i‡(
îr‹
>0.001)

179 
	`Ârötf
 (
°dîr
, "˚…_log2/˚…_exp2 faûed: fabs(x-(˚…_log2(˚…_exp2(x))))>0.001 (x = %f,Éº‹ = %f)\n", 
x
,
îr‹
);

180 
ªt
 = 1;

183 
	}
}

185 
	$ã°log2
()

187 
›us_vÆ32
 
x
;

188 
x
=8;x<1073741824;x+=(x>>3))

190 
îr‹
 = 
	`Ábs
((1.442695040888963387*
	`log
(
x
/16384.0))-
	`˚…_log2
(x)/1024.0);

191 i‡(
îr‹
>0.003)

193 
	`Ârötf
 (
°dîr
, "˚…_log2 faûed: x = %ld,Éº‹ = %f\n", ()
x
,
îr‹
);

194 
ªt
 = 1;

197 
	}
}

199 
	$ã°exp2
()

201 
›us_vÆ16
 
x
;

202 
x
=-32768;x<15360;x++)

204 
îr‹1
 = 
	`Ábs
(
x
/1024.0-(1.442695040888963387*
	`log
(
	`˚…_exp2
(x)/65536.0)));

205 
îr‹2
 = 
	`Ábs
(
	`exp
(0.6931471805599453094*
x
/1024.0)-
	`˚…_exp2
(x)/65536.0);

206 i‡(
îr‹1
>0.0002&&
îr‹2
>0.00004)

208 
	`Ârötf
 (
°dîr
, "˚…_exp2 faûed: x = "
WORD
",Éº‹1 = %f,Éº‹2 = %f\n", 
x
,
îr‹1
,
îr‹2
);

209 
ªt
 = 1;

212 
	}
}

214 
	$ã°exp2log2
()

216 
›us_vÆ32
 
x
;

217 
x
=8;x<65536;x+=(x>>3))

219 
îr‹
 = 
	`Ábs
(
x
-0.25*
	`˚…_exp2
(
	`˚…_log2
(x)))/16384;

220 i‡(
îr‹
>0.004)

222 
	`Ârötf
 (
°dîr
, "˚…_log2/˚…_exp2 faûed: fabs(x-(˚…_exp2(˚…_log2(x))))>0.001 (x = %ld,Éº‹ = %f)\n", ()
x
,
îr‹
);

223 
ªt
 = 1;

226 
	}
}

228 
	$ã°ûog2
()

230 
›us_vÆ32
 
x
;

231 
x
=1;x<=268435455;x+=127)

233 
›us_vÆ32
 
lg
;

234 
›us_vÆ32
 
y
;

236 
lg
 = 
	`˚…_ûog2
(
x
);

237 i‡(
lg
<0 ||Üg>=31)

239 
	`¥ötf
("˚…_ûog2 faûed: 0<=˚…_ûog2(x)<31 (x = %d, cñt_ûog2(xË%d)\n",
x
,
lg
);

240 
ªt
 = 1;

242 
y
 = 1<<
lg
;

244 i‡(
x
<
y
 || (x>>1)>=y)

246 
	`¥ötf
("˚…_ûog2 faûed: 2**˚…_ûog2(x)<=x<2**(˚…_ûog2(x)+1Ë(x = %d, 2**˚…_ûog2(xË%d)\n",
x
,
y
);

247 
ªt
 = 1;

250 
	}
}

253 
	$maö
()

255 
	`ã°bôexa˘cos
();

256 
	`ã°bôexa˘log2èn
();

257 
	`ã°div
();

258 
	`ã°sqπ
();

259 
	`ã°log2
();

260 
	`ã°exp2
();

261 
	`ã°exp2log2
();

262 #ifde‡
FIXED_POINT


263 
	`ã°ûog2
();

265  
ªt
;

266 
	}
}

	@celt/tests/test_unit_mdct.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

34 
	~"md˘.h
"

35 
	~"°ack_Æloc.h
"

36 
	~"kiss_f·.h
"

37 
	~"md˘.h
"

38 
	~"modes.h
"

40 #i‚de‡
M_PI


41 
	#M_PI
 3.141592653

	)

44 
	gªt
 = 0;

45 
	$check
(
kiss_f·_sˇœr
 * 
ö
,kiss_f·_sˇœ∏* 
out
,
nf·
,
isövî£
)

47 
bö
,
k
;

48 
îΩow
=0,
sigpow
=0;

49 
¢r
;

50 
bö
=0;bö<
nf·
/2;++bin) {

51 
™§
 = 0;

52 
di‰
;

54 
k
=0;k<
nf·
;++k) {

55 
pha£
 = 2*
M_PI
*(
k
+.5+.25*
nf·
)*(
bö
+.5)/nfft;

56 
ª
 = 
	`cos
(
pha£
);

58 
ª
 /
nf·
/4;

60 
™§
 +
ö
[
k
] * 
ª
;

63 
di‰
 = 
™§
 - 
out
[
bö
];

64 
îΩow
 +
di‰
*difr;

65 
sigpow
 +
™§
*ansr;

67 
¢r
 = 10*
	`log10
(
sigpow
/
îΩow
);

68 
	`¥ötf
("nf·=%d invî£=%d,¢∏%f\n",
nf·
,
isövî£
,
¢r
 );

69 i‡(
¢r
<60) {

70 
	`¥ötf
–"**Öo‹ sƒ: %‡**\n", 
¢r
);

71 
ªt
 = 1;

73 
	}
}

75 
	$check_öv
(
kiss_f·_sˇœr
 * 
ö
,kiss_f·_sˇœ∏* 
out
,
nf·
,
isövî£
)

77 
bö
,
k
;

78 
îΩow
=0,
sigpow
=0;

79 
¢r
;

80 
bö
=0;bö<
nf·
;++bin) {

81 
™§
 = 0;

82 
di‰
;

84 
k
=0;k<
nf·
/2;++k) {

85 
pha£
 = 2*
M_PI
*(
bö
+.5+.25*
nf·
)*(
k
+.5)/nfft;

86 
ª
 = 
	`cos
(
pha£
);

90 
™§
 +
ö
[
k
] * 
ª
;

93 
di‰
 = 
™§
 - 
out
[
bö
];

94 
îΩow
 +
di‰
*difr;

95 
sigpow
 +
™§
*ansr;

97 
¢r
 = 10*
	`log10
(
sigpow
/
îΩow
);

98 
	`¥ötf
("nf·=%d invî£=%d,¢∏%f\n",
nf·
,
isövî£
,
¢r
 );

99 i‡(
¢r
<60) {

100 
	`¥ötf
–"**Öo‹ sƒ: %‡**\n", 
¢r
);

101 
ªt
 = 1;

103 
	}
}

106 
	$ã°1d
(
nf·
,
isövî£
,
¨ch
)

108 
size_t
 
buÊí
 = (
kiss_f·_sˇœr
)*
nf·
;

109 
kiss_f·_sˇœr
 *
ö
;

110 
kiss_f·_sˇœr
 *
ö_c›y
;

111 
kiss_f·_sˇœr
 *
out
;

112 
›us_vÆ16
 *
wödow
;

113 
k
;

115 #ifde‡
CUSTOM_MODES


116 
shi·
 = 0;

117 c⁄° 
md˘_lookup
 *
cfg
;

118 
md˘_lookup
 
_cfg
;

119 
	`˛t_md˘_öô
(&
_cfg
, 
nf·
, 0, 
¨ch
);

120 
cfg
 = &
_cfg
;

122 
shi·
;

123 c⁄° 
md˘_lookup
 *
cfg
;

124 
CELTMode
 *
mode
 = 
	`›us_cu°om_mode_¸óã
(48000, 960, 
NULL
);

125 i‡(
nf·
 =1920Ë
shi·
 = 0;

126 i‡(
nf·
 =960Ë
shi·
 = 1;

127 i‡(
nf·
 =480Ë
shi·
 = 2;

128 i‡(
nf·
 =240Ë
shi·
 = 3;

130 
cfg
 = &
mode
->
md˘
;

133 
ö
 = (
kiss_f·_sˇœr
*)
	`mÆloc
(
buÊí
);

134 
ö_c›y
 = (
kiss_f·_sˇœr
*)
	`mÆloc
(
buÊí
);

135 
out
 = (
kiss_f·_sˇœr
*)
	`mÆloc
(
buÊí
);

136 
wödow
 = (
›us_vÆ16
*)
	`mÆloc
((›us_vÆ16)*
nf·
/2);

138 
k
=0;k<
nf·
;++k) {

139 
ö
[
k
] = (
	`ønd
() % 32768) - 16384;

142 
k
=0;k<
nf·
/2;++k) {

143 
wödow
[
k
] = 
Q15ONE
;

145 
k
=0;k<
nf·
;++k) {

146 
ö
[
k
] *= 32768;

149 i‡(
isövî£
)

151 
k
=0;k<
nf·
;++k) {

152 
ö
[
k
] /
nf·
;

156 
k
=0;k<
nf·
;++k)

157 
ö_c›y
[
k
] = 
ö
[k];

160 i‡(
isövî£
)

162 
k
=0;k<
nf·
;++k)

163 
out
[
k
] = 0;

164 
	`˛t_md˘_backw¨d
(
cfg
,
ö
,
out
, 
wödow
, 
nf·
/2, 
shi·
, 1, 
¨ch
);

166 
k
=0;k<
nf·
/4;++k)

167 
out
[
nf·
-
k
-1] = out[nfft/2+k];

168 
	`check_öv
(
ö
,
out
,
nf·
,
isövî£
);

170 
	`˛t_md˘_f‹w¨d
(
cfg
,
ö
,
out
,
wödow
, 
nf·
/2, 
shi·
, 1, 
¨ch
);

171 
	`check
(
ö_c›y
,
out
,
nf·
,
isövî£
);

176 
	`‰ì
(
ö
);

177 
	`‰ì
(
ö_c›y
);

178 
	`‰ì
(
out
);

179 
	`‰ì
(
wödow
);

180 #ifde‡
CUSTOM_MODES


181 
	`˛t_md˘_˛ór
(&
_cfg
, 
¨ch
);

183 
	}
}

185 
	$maö
(
¨gc
,** 
¨gv
)

187 
ALLOC_STACK
;

188 
¨ch
 = 
	`›us_£À˘_¨ch
();

190 i‡(
¨gc
>1) {

191 
k
;

192 
k
=1;k<
¨gc
;++k) {

193 
	`ã°1d
(
	`©oi
(
¨gv
[
k
]),0,
¨ch
);

194 
	`ã°1d
(
	`©oi
(
¨gv
[
k
]),1,
¨ch
);

197 
	`ã°1d
(32,0,
¨ch
);

198 
	`ã°1d
(32,1,
¨ch
);

199 
	`ã°1d
(256,0,
¨ch
);

200 
	`ã°1d
(256,1,
¨ch
);

201 
	`ã°1d
(512,0,
¨ch
);

202 
	`ã°1d
(512,1,
¨ch
);

203 
	`ã°1d
(1024,0,
¨ch
);

204 
	`ã°1d
(1024,1,
¨ch
);

205 
	`ã°1d
(2048,0,
¨ch
);

206 
	`ã°1d
(2048,1,
¨ch
);

207 #i‚de‡
RADIX_TWO_ONLY


208 
	`ã°1d
(36,0,
¨ch
);

209 
	`ã°1d
(36,1,
¨ch
);

210 
	`ã°1d
(40,0,
¨ch
);

211 
	`ã°1d
(40,1,
¨ch
);

212 
	`ã°1d
(60,0,
¨ch
);

213 
	`ã°1d
(60,1,
¨ch
);

214 
	`ã°1d
(120,0,
¨ch
);

215 
	`ã°1d
(120,1,
¨ch
);

216 
	`ã°1d
(240,0,
¨ch
);

217 
	`ã°1d
(240,1,
¨ch
);

218 
	`ã°1d
(480,0,
¨ch
);

219 
	`ã°1d
(480,1,
¨ch
);

220 
	`ã°1d
(960,0,
¨ch
);

221 
	`ã°1d
(960,1,
¨ch
);

222 
	`ã°1d
(1920,0,
¨ch
);

223 
	`ã°1d
(1920,1,
¨ch
);

226  
ªt
;

227 
	}
}

	@celt/tests/test_unit_rotation.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 #i‚de‡
CUSTOM_MODES


33 
	#CUSTOM_MODES


	)

36 
	~<°dio.h
>

37 
	~<°dlib.h
>

38 
	~"vq.h
"

39 
	~"b™ds.h
"

40 
	~"°ack_Æloc.h
"

41 
	~<m©h.h
>

44 
	#MAX_SIZE
 100

	)

46 
	gªt
=0;

47 
	$ã°_rŸ©i⁄
(
N
, 
K
)

49 
i
;

50 
îr
 = 0, 
íî
 = 0, 
¢r
, 
¢r0
;

51 
›us_vÆ16
 
x0
[
MAX_SIZE
];

52 
›us_vÆ16
 
x1
[
MAX_SIZE
];

53 
i
=0;i<
N
;i++)

54 
x1
[
i
] = 
x0
[i] = 
	`ønd
()%32767-16384;

55 
	`exp_rŸ©i⁄
(
x1
, 
N
, 1, 1, 
K
, 
SPREAD_NORMAL
);

56 
i
=0;i<
N
;i++)

58 
îr
 +(
x0
[
i
]-()
x1
[i])*(x0[i]-()x1[i]);

59 
íî
 +
x0
[
i
]*()x0[i];

61 
¢r0
 = 20*
	`log10
(
íî
/
îr
);

62 
îr
 = 
íî
 = 0;

63 
	`exp_rŸ©i⁄
(
x1
, 
N
, -1, 1, 
K
, 
SPREAD_NORMAL
);

64 
i
=0;i<
N
;i++)

66 
îr
 +(
x0
[
i
]-()
x1
[i])*(x0[i]-()x1[i]);

67 
íî
 +
x0
[
i
]*()x0[i];

69 
¢r
 = 20*
	`log10
(
íî
/
îr
);

70 
	`¥ötf
 ("SNR f‹ sizê%d (%dÖul£sËi†%‡(wa†%‡wôhouàövî£)\n", 
N
, 
K
, 
¢r
, 
¢r0
);

71 i‡(
¢r
 < 60 || 
¢r0
 > 20)

73 
	`Ârötf
(
°dîr
, "FAIL!\n");

74 
ªt
 = 1;

76 
	}
}

78 
	$maö
()

80 
ALLOC_STACK
;

81 
	`ã°_rŸ©i⁄
(15, 3);

82 
	`ã°_rŸ©i⁄
(23, 5);

83 
	`ã°_rŸ©i⁄
(50, 3);

84 
	`ã°_rŸ©i⁄
(80, 1);

85  
ªt
;

86 
	}
}

	@celt/tests/test_unit_types.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us_ty≥s.h
"

33 
	~<°dio.h
>

35 
	$maö
()

37 
›us_öt16
 
i
 = 1;

38 
i
 <<= 14;

39 i‡(
i
>>14 != 1)

41 
	`Ârötf
(
°dîr
, "opus_int16 isn't 16 bits\n");

44 i‡((
›us_öt16
)*2 !(
›us_öt32
))

46 
	`Ârötf
(
°dîr
, "16*2 != 32\n");

50 
	}
}

	@celt/vq.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~"m©h›s.h
"

34 
	~"cwrs.h
"

35 
	~"vq.h
"

36 
	~"¨ch.h
"

37 
	~"os_suµ‹t.h
"

38 
	~"b™ds.h
"

39 
	~"øã.h
"

40 
	~"pôch.h
"

42 #i‡
deföed
(
MIPSr1_ASM
)

43 
	~"mùs/vq_mù§1.h
"

46 #i‚de‡
OVERRIDE_vq_exp_rŸ©i⁄1


47 
	$exp_rŸ©i⁄1
(
˚…_n‹m
 *
X
, 
Àn
, 
°ride
, 
›us_vÆ16
 
c
, opus_vÆ16 
s
)

49 
i
;

50 
›us_vÆ16
 
ms
;

51 
˚…_n‹m
 *
X±r
;

52 
X±r
 = 
X
;

53 
ms
 = 
	`NEG16
(
s
);

54 
i
=0;i<
Àn
-
°ride
;i++)

56 
˚…_n‹m
 
x1
, 
x2
;

57 
x1
 = 
X±r
[0];

58 
x2
 = 
X±r
[
°ride
];

59 
X±r
[
°ride
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x2
), 
s
, 
x1
), 15));

60 *
X±r
++ = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x1
), 
ms
, 
x2
), 15));

62 
X±r
 = &
X
[
Àn
-2*
°ride
-1];

63 
i
=
Àn
-2*
°ride
-1;i>=0;i--)

65 
˚…_n‹m
 
x1
, 
x2
;

66 
x1
 = 
X±r
[0];

67 
x2
 = 
X±r
[
°ride
];

68 
X±r
[
°ride
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x2
), 
s
, 
x1
), 15));

69 *
X±r
-- = 
	`EXTRACT16
(
	`PSHR32
(
	`MAC16_16
(
	`MULT16_16
(
c
, 
x1
), 
ms
, 
x2
), 15));

71 
	}
}

74 
	$exp_rŸ©i⁄
(
˚…_n‹m
 *
X
, 
Àn
, 
dú
, 
°ride
, 
K
, 
•ªad
)

76 c⁄° 
SPREAD_FACTOR
[3]={15,10,5};

77 
i
;

78 
›us_vÆ16
 
c
, 
s
;

79 
›us_vÆ16
 
gaö
, 
thëa
;

80 
°ride2
=0;

81 
Á˘‹
;

83 i‡(2*
K
>=
Àn
 || 
•ªad
==
SPREAD_NONE
)

85 
Á˘‹
 = 
SPREAD_FACTOR
[
•ªad
-1];

87 
gaö
 = 
	`˚…_div
((
›us_vÆ32
)
	`MULT16_16
(
Q15_ONE
,
Àn
),(›us_vÆ32)÷í+
Á˘‹
*
K
));

88 
thëa
 = 
	`HALF16
(
	`MULT16_16_Q15
(
gaö
,gain));

90 
c
 = 
	`˚…_cos_n‹m
(
	`EXTEND32
(
thëa
));

91 
s
 = 
	`˚…_cos_n‹m
(
	`EXTEND32
(
	`SUB16
(
Q15ONE
,
thëa
)));

93 i‡(
Àn
>=8*
°ride
)

95 
°ride2
 = 1;

98 (
°ride2
*°ride2+°ride2)*
°ride
 + (°ride>>2Ë< 
Àn
)

99 
°ride2
++;

103 
Àn
 = 
	`˚…_udiv
÷í, 
°ride
);

104 
i
=0;i<
°ride
;i++)

106 i‡(
dú
 < 0)

108 i‡(
°ride2
)

109 
	`exp_rŸ©i⁄1
(
X
+
i
*
Àn
,Üí, 
°ride2
, 
s
, 
c
);

110 
	`exp_rŸ©i⁄1
(
X
+
i
*
Àn
,Üí, 1, 
c
, 
s
);

112 
	`exp_rŸ©i⁄1
(
X
+
i
*
Àn
,Üí, 1, 
c
, -
s
);

113 i‡(
°ride2
)

114 
	`exp_rŸ©i⁄1
(
X
+
i
*
Àn
,Üí, 
°ride2
, 
s
, -
c
);

117 
	}
}

121 
	$n‹mÆi£_ªsiduÆ
(* 
OPUS_RESTRICT
 
iy
, 
˚…_n‹m
 * OPUS_RESTRICT 
X
,

122 
N
, 
›us_vÆ32
 
Ryy
, 
›us_vÆ16
 
gaö
)

124 
i
;

125 #ifde‡
FIXED_POINT


126 
k
;

128 
›us_vÆ32
 
t
;

129 
›us_vÆ16
 
g
;

131 #ifde‡
FIXED_POINT


132 
k
 = 
	`˚…_ûog2
(
Ryy
)>>1;

134 
t
 = 
	`VSHR32
(
Ryy
, 2*(
k
-7));

135 
g
 = 
	`MULT16_16_P15
(
	`˚…_rsqπ_n‹m
(
t
),
gaö
);

137 
i
=0;

139 
X
[
i
] = 
	`EXTRACT16
(
	`PSHR32
(
	`MULT16_16
(
g
, 
iy
[i]), 
k
+1));

140 ++
i
 < 
N
);

141 
	}
}

143 
	$exåa˘_cﬁœp£_mask
(*
iy
, 
N
, 
B
)

145 
cﬁœp£_mask
;

146 
N0
;

147 
i
;

148 i‡(
B
<=1)

152 
N0
 = 
	`˚…_udiv
(
N
, 
B
);

153 
cﬁœp£_mask
 = 0;

154 
i
=0; do {

155 
j
;

156 
tmp
=0;

157 
j
=0; do {

158 
tmp
 |
iy
[
i
*
N0
+
j
];

159 } ++
j
<
N0
);

160 
cﬁœp£_mask
 |(
tmp
!=0)<<
i
;

161 } ++
i
<
B
);

162  
cﬁœp£_mask
;

163 
	}
}

165 
›us_vÆ16
 
	$›_pvq_£¨ch_c
(
˚…_n‹m
 *
X
, *
iy
, 
K
, 
N
, 
¨ch
)

167 
	`VARDECL
(
˚…_n‹m
, 
y
);

168 
	`VARDECL
(, 
signx
);

169 
i
, 
j
;

170 
pul£sLe·
;

171 
›us_vÆ32
 
sum
;

172 
›us_vÆ32
 
xy
;

173 
›us_vÆ16
 
yy
;

174 
SAVE_STACK
;

176 ()
¨ch
;

177 
	`ALLOC
(
y
, 
N
, 
˚…_n‹m
);

178 
	`ALLOC
(
signx
, 
N
, );

181 
sum
 = 0;

182 
j
=0; do {

183 
signx
[
j
] = 
X
[j]<0;

185 
X
[
j
] = 
	`ABS16
(X[j]);

186 
iy
[
j
] = 0;

187 
y
[
j
] = 0;

188 } ++
j
<
N
);

190 
xy
 = 
yy
 = 0;

192 
pul£sLe·
 = 
K
;

195 i‡(
K
 > (
N
>>1))

197 
›us_vÆ16
 
r˝
;

198 
j
=0; do {

199 
sum
 +
X
[
j
];

200 } ++
j
<
N
);

203 #ifde‡
FIXED_POINT


204 i‡(
sum
 <
K
)

208 i‡(!(
sum
 > 
EPSILON
 && sum < 64))

211 
X
[0] = 
	`QCONST16
(1.f,14);

212 
j
=1; do

213 
X
[
j
]=0;

214 ++
j
<
N
);

215 
sum
 = 
	`QCONST16
(1.f,14);

217 #ifde‡
FIXED_POINT


218 
r˝
 = 
	`EXTRACT16
(
	`MULT16_32_Q16
(
K
, 
	`˚…_r˝
(
sum
)));

221 
r˝
 = 
	`EXTRACT16
(
	`MULT16_32_Q16
(
K
+0.8f, 
	`˚…_r˝
(
sum
)));

223 
j
=0; do {

224 #ifde‡
FIXED_POINT


226 
iy
[
j
] = 
	`MULT16_16_Q15
(
X
[j],
r˝
);

228 
iy
[
j
] = ()
	`Êo‹
(
r˝
*
X
[j]);

230 
y
[
j
] = (
˚…_n‹m
)
iy
[j];

231 
yy
 = 
	`MAC16_16
(yy, 
y
[
j
],y[j]);

232 
xy
 = 
	`MAC16_16
(xy, 
X
[
j
],
y
[j]);

233 
y
[
j
] *= 2;

234 
pul£sLe·
 -
iy
[
j
];

235 } ++
j
<
N
);

237 
	`˚…_sig_as£π
(
pul£sLe·
>=0);

241 #ifde‡
FIXED_POINT_DEBUG


242 
	`˚…_sig_as£π
(
pul£sLe·
<=
N
+3);

244 i‡(
pul£sLe·
 > 
N
+3)

246 
›us_vÆ16
 
tmp
 = (›us_vÆ16)
pul£sLe·
;

247 
yy
 = 
	`MAC16_16
(yy, 
tmp
,Åmp);

248 
yy
 = 
	`MAC16_16
(yy, 
tmp
, 
y
[0]);

249 
iy
[0] +
pul£sLe·
;

250 
pul£sLe·
=0;

253 
i
=0;i<
pul£sLe·
;i++)

255 
›us_vÆ16
 
Rxy
, 
Ryy
;

256 
be°_id
;

257 
›us_vÆ32
 
be°_num
;

258 
›us_vÆ16
 
be°_dí
;

259 #ifde‡
FIXED_POINT


260 
rshi·
;

262 #ifde‡
FIXED_POINT


263 
rshi·
 = 1+
	`˚…_ûog2
(
K
-
pul£sLe·
+
i
+1);

265 
be°_id
 = 0;

268 
yy
 = 
	`ADD16
(yy, 1);

274 
Rxy
 = 
	`EXTRACT16
(
	`SHR32
(
	`ADD32
(
xy
, 
	`EXTEND32
(
X
[0])),
rshi·
));

276 
Ryy
 = 
	`ADD16
(
yy
, 
y
[0]);

280 
Rxy
 = 
	`MULT16_16_Q15
(Rxy,Rxy);

281 
be°_dí
 = 
Ryy
;

282 
be°_num
 = 
Rxy
;

283 
j
=1;

286 
Rxy
 = 
	`EXTRACT16
(
	`SHR32
(
	`ADD32
(
xy
, 
	`EXTEND32
(
X
[
j
])),
rshi·
));

288 
Ryy
 = 
	`ADD16
(
yy
, 
y
[
j
]);

292 
Rxy
 = 
	`MULT16_16_Q15
(Rxy,Rxy);

299 i‡(
	`›us_u∆ikñy
(
	`MULT16_16
(
be°_dí
, 
Rxy
Ë> MULT16_16(
Ryy
, 
be°_num
)))

301 
be°_dí
 = 
Ryy
;

302 
be°_num
 = 
Rxy
;

303 
be°_id
 = 
j
;

305 } ++
j
<
N
);

308 
xy
 = 
	`ADD32
(xy, 
	`EXTEND32
(
X
[
be°_id
]));

310 
yy
 = 
	`ADD16
(yy, 
y
[
be°_id
]);

314 
y
[
be°_id
] += 2;

315 
iy
[
be°_id
]++;

319 
j
=0;

324 
iy
[
j
] = (iy[j]^-
signx
[j]) + signx[j];

325 } ++
j
<
N
);

326 
RESTORE_STACK
;

327  
yy
;

328 
	}
}

330 
	$Æg_qu™t
(
˚…_n‹m
 *
X
, 
N
, 
K
, 
•ªad
, 
B
, 
ec_íc
 *
íc
,

331 
›us_vÆ16
 
gaö
, 
ªsy¡h
, 
¨ch
)

333 
	`VARDECL
(, 
iy
);

334 
›us_vÆ16
 
yy
;

335 
cﬁœp£_mask
;

336 
SAVE_STACK
;

338 
	`˚…_as£π2
(
K
>0, "alg_quant()ÇeedsátÜeast oneÖulse");

339 
	`˚…_as£π2
(
N
>1, "alg_quant()ÇeedsátÜeastÅwo dimensions");

342 
	`ALLOC
(
iy
, 
N
+3, );

344 
	`exp_rŸ©i⁄
(
X
, 
N
, 1, 
B
, 
K
, 
•ªad
);

346 
yy
 = 
	`›_pvq_£¨ch
(
X
, 
iy
, 
K
, 
N
, 
¨ch
);

348 
	`ícode_pul£s
(
iy
, 
N
, 
K
, 
íc
);

350 i‡(
ªsy¡h
)

352 
	`n‹mÆi£_ªsiduÆ
(
iy
, 
X
, 
N
, 
yy
, 
gaö
);

353 
	`exp_rŸ©i⁄
(
X
, 
N
, -1, 
B
, 
K
, 
•ªad
);

356 
cﬁœp£_mask
 = 
	`exåa˘_cﬁœp£_mask
(
iy
, 
N
, 
B
);

357 
RESTORE_STACK
;

358  
cﬁœp£_mask
;

359 
	}
}

363 
	$Æg_unqu™t
(
˚…_n‹m
 *
X
, 
N
, 
K
, 
•ªad
, 
B
,

364 
ec_dec
 *
dec
, 
›us_vÆ16
 
gaö
)

366 
›us_vÆ32
 
Ryy
;

367 
cﬁœp£_mask
;

368 
	`VARDECL
(, 
iy
);

369 
SAVE_STACK
;

371 
	`˚…_as£π2
(
K
>0, "alg_unquant()ÇeedsátÜeast oneÖulse");

372 
	`˚…_as£π2
(
N
>1, "alg_unquant()ÇeedsátÜeastÅwo dimensions");

373 
	`ALLOC
(
iy
, 
N
, );

374 
Ryy
 = 
	`decode_pul£s
(
iy
, 
N
, 
K
, 
dec
);

375 
	`n‹mÆi£_ªsiduÆ
(
iy
, 
X
, 
N
, 
Ryy
, 
gaö
);

376 
	`exp_rŸ©i⁄
(
X
, 
N
, -1, 
B
, 
K
, 
•ªad
);

377 
cﬁœp£_mask
 = 
	`exåa˘_cﬁœp£_mask
(
iy
, 
N
, 
B
);

378 
RESTORE_STACK
;

379  
cﬁœp£_mask
;

380 
	}
}

382 #i‚de‡
OVERRIDE_ªn‹mÆi£_ve˘‹


383 
	$ªn‹mÆi£_ve˘‹
(
˚…_n‹m
 *
X
, 
N
, 
›us_vÆ16
 
gaö
, 
¨ch
)

385 
i
;

386 #ifde‡
FIXED_POINT


387 
k
;

389 
›us_vÆ32
 
E
;

390 
›us_vÆ16
 
g
;

391 
›us_vÆ32
 
t
;

392 
˚…_n‹m
 *
x±r
;

393 
E
 = 
EPSILON
 + 
	`˚…_ö√r_¥od
(
X
, X, 
N
, 
¨ch
);

394 #ifde‡
FIXED_POINT


395 
k
 = 
	`˚…_ûog2
(
E
)>>1;

397 
t
 = 
	`VSHR32
(
E
, 2*(
k
-7));

398 
g
 = 
	`MULT16_16_P15
(
	`˚…_rsqπ_n‹m
(
t
),
gaö
);

400 
x±r
 = 
X
;

401 
i
=0;i<
N
;i++)

403 *
x±r
 = 
	`EXTRACT16
(
	`PSHR32
(
	`MULT16_16
(
g
, *x±r), 
k
+1));

404 
x±r
++;

407 
	}
}

410 
	$°îeo_ôhëa
(c⁄° 
˚…_n‹m
 *
X
, c⁄° cñt_n‹m *
Y
, 
°îeo
, 
N
, 
¨ch
)

412 
i
;

413 
ôhëa
;

414 
›us_vÆ16
 
mid
, 
side
;

415 
›us_vÆ32
 
Emid
, 
Eside
;

417 
Emid
 = 
Eside
 = 
EPSILON
;

418 i‡(
°îeo
)

420 
i
=0;i<
N
;i++)

422 
˚…_n‹m
 
m
, 
s
;

423 
m
 = 
	`ADD16
(
	`SHR16
(
X
[
i
],1),SHR16(
Y
[i],1));

424 
s
 = 
	`SUB16
(
	`SHR16
(
X
[
i
],1),SHR16(
Y
[i],1));

425 
Emid
 = 
	`MAC16_16
(Emid, 
m
, m);

426 
Eside
 = 
	`MAC16_16
(Eside, 
s
, s);

429 
Emid
 +
	`˚…_ö√r_¥od
(
X
, X, 
N
, 
¨ch
);

430 
Eside
 +
	`˚…_ö√r_¥od
(
Y
, Y, 
N
, 
¨ch
);

432 
mid
 = 
	`˚…_sqπ
(
Emid
);

433 
side
 = 
	`˚…_sqπ
(
Eside
);

434 #ifde‡
FIXED_POINT


436 
ôhëa
 = 
	`MULT16_16_Q15
(
	`QCONST16
(0.63662f,15),
	`˚…_©™2p
(
side
, 
mid
));

438 
ôhëa
 = ()
	`Êo‹
(.5f+16384*0.63662f*
	`Á°_©™2f
(
side
,
mid
));

441  
ôhëa
;

442 
	}
}

	@celt/vq.h

33 #i‚de‡
VQ_H


34 
	#VQ_H


	)

36 
	~"íãnc.h
"

37 
	~"ítdec.h
"

38 
	~"modes.h
"

40 #i‡(
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
FIXED_POINT
))

41 
	~"x86/vq_s£.h
"

44 
exp_rŸ©i⁄
(
˚…_n‹m
 *
X
, 
Àn
, 
dú
, 
°ride
, 
K
, 
•ªad
);

46 
›us_vÆ16
 
›_pvq_£¨ch_c
(
˚…_n‹m
 *
X
, *
iy
, 
K
, 
N
, 
¨ch
);

48 #i‡!
deföed
(
OVERRIDE_OP_PVQ_SEARCH
)

49 
	#›_pvq_£¨ch
(
x
, 
iy
, 
K
, 
N
, 
¨ch
) \

50 (
	`›_pvq_£¨ch_c
(
x
, 
iy
, 
K
, 
N
, 
¨ch
))

	)

62 
Æg_qu™t
(
˚…_n‹m
 *
X
, 
N
, 
K
, 
•ªad
, 
B
, 
ec_íc
 *
íc
,

63 
›us_vÆ16
 
gaö
, 
ªsy¡h
, 
¨ch
);

72 
Æg_unqu™t
(
˚…_n‹m
 *
X
, 
N
, 
K
, 
•ªad
, 
B
,

73 
ec_dec
 *
dec
, 
›us_vÆ16
 
gaö
);

75 
ªn‹mÆi£_ve˘‹
(
˚…_n‹m
 *
X
, 
N
, 
›us_vÆ16
 
gaö
, 
¨ch
);

77 
°îeo_ôhëa
(c⁄° 
˚…_n‹m
 *
X
, c⁄° cñt_n‹m *
Y
, 
°îeo
, 
N
, 
¨ch
);

	@celt/x86/celt_lpc_sse.h

28 #i‚de‡
CELT_LPC_SSE_H


29 
	#CELT_LPC_SSE_H


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& deföed(
FIXED_POINT
)

36 
	#OVERRIDE_CELT_FIR


	)

38 
˚…_fú_s£4_1
(

39 c⁄° 
›us_vÆ16
 *
x
,

40 c⁄° 
›us_vÆ16
 *
num
,

41 
›us_vÆ16
 *
y
,

42 
N
,

43 
‹d
,

44 
¨ch
);

46 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
)

47 
	#˚…_fú
(
x
, 
num
, 
y
, 
N
, 
‹d
, 
¨ch
) \

48 (()
¨ch
, 
	`˚…_fú_s£4_1
(
x
, 
num
, 
y
, 
N
, 
‹d
,árch))

	)

52 (*c⁄° 
CELT_FIR_IMPL
[
OPUS_ARCHMASK
 + 1])(

53 c⁄° 
›us_vÆ16
 *
x
,

54 c⁄° 
›us_vÆ16
 *
num
,

55 
›us_vÆ16
 *
y
,

56 
N
,

57 
‹d
,

58 
¨ch
);

60 
	#˚…_fú
(
x
, 
num
, 
y
, 
N
, 
‹d
, 
¨ch
) \

61 ((*
CELT_FIR_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
x
, 
num
, 
y
, 
N
, 
‹d
,árch))

	)

	@celt/x86/celt_lpc_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"˚…_Õc.h
"

36 
	~"°ack_Æloc.h
"

37 
	~"m©h›s.h
"

38 
	~"pôch.h
"

39 
	~"x86˝u.h
"

41 #i‡
deföed
(
FIXED_POINT
)

43 
	$˚…_fú_s£4_1
(c⁄° 
›us_vÆ16
 *
x
,

44 c⁄° 
›us_vÆ16
 *
num
,

45 
›us_vÆ16
 *
y
,

46 
N
,

47 
‹d
,

48 
¨ch
)

50 
i
,
j
;

51 
	`VARDECL
(
›us_vÆ16
, 
∫um
);

53 
__m128i
 
vecNoA
;

54 
›us_öt32
 
noA
 ;

55 
SAVE_STACK
;

57 
	`ALLOC
(
∫um
, 
‹d
, 
›us_vÆ16
);

58 
i
=0;i<
‹d
;i++)

59 
∫um
[
i
] = 
num
[
‹d
-i-1];

60 
noA
 = 
	`EXTEND32
(1Ë<< 
SIG_SHIFT
 >> 1;

61 
vecNoA
 = 
	`_mm_£t_ïi32
(
noA
,ÇoA,ÇoA,ÇoA);

63 
i
=0;i<
N
-3;i+=4)

65 
›us_vÆ32
 
sums
[4] = {0};

66 
__m128i
 
vecSum
, 
vecX
;

68 
	`xc‹r_kî√l
(
∫um
, 
x
+
i
-
‹d
, 
sums
, ord, 
¨ch
);

70 
vecSum
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)
sums
);

71 
vecSum
 = 
	`_mm_add_ïi32
(vecSum, 
vecNoA
);

72 
vecSum
 = 
	`_mm_§ai_ïi32
(vecSum, 
SIG_SHIFT
);

73 
vecX
 = 
	`OP_CVTEPI16_EPI32_M64
(
x
 + 
i
);

74 
vecSum
 = 
	`_mm_add_ïi32
(vecSum, 
vecX
);

75 
vecSum
 = 
	`_mm_∑cks_ïi32
(vecSum, vecSum);

76 
	`_mm_°‹ñ_ïi64
((
__m128i
 *)(
y
 + 
i
), 
vecSum
);

78 ;
i
<
N
;i++)

80 
›us_vÆ32
 
sum
 = 0;

81 
j
=0;j<
‹d
;j++)

82 
sum
 = 
	`MAC16_16
(sum, 
∫um
[
j
], 
x
[
i
+j-
‹d
]);

83 
y
[
i
] = 
	`SATURATE16
(
	`ADD32
(
	`EXTEND32
(
x
[i]), 
	`PSHR32
(
sum
, 
SIG_SHIFT
)));

86 
RESTORE_STACK
;

87 
	}
}

	@celt/x86/pitch_sse.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"ma¸os.h
"

33 
	~"˚…_Õc.h
"

34 
	~"°ack_Æloc.h
"

35 
	~"m©h›s.h
"

36 
	~"pôch.h
"

38 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
FIXED_POINT
)

40 
	~<xmmöåö.h
>

41 
	~"¨ch.h
"

43 
	$xc‹r_kî√l_s£
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
, 
›us_vÆ32
 
sum
[4], 
Àn
)

45 
j
;

46 
__m128
 
xsum1
, 
xsum2
;

47 
xsum1
 = 
	`_mm_lﬂdu_ps
(
sum
);

48 
xsum2
 = 
	`_mm_£tzîo_ps
();

50 
j
 = 0; j < 
Àn
-3; j += 4)

52 
__m128
 
x0
 = 
	`_mm_lﬂdu_ps
(
x
+
j
);

53 
__m128
 
yj
 = 
	`_mm_lﬂdu_ps
(
y
+
j
);

54 
__m128
 
y3
 = 
	`_mm_lﬂdu_ps
(
y
+
j
+3);

56 
xsum1
 = 
	`_mm_add_ps
(xsum1,
	`_mm_mul_ps
(
	`_mm_shufÊe_ps
(
x0
,x0,0x00),
yj
));

57 
xsum2
 = 
	`_mm_add_ps
(xsum2,
	`_mm_mul_ps
(
	`_mm_shufÊe_ps
(
x0
,x0,0x55),

58 
	`_mm_shufÊe_ps
(
yj
,
y3
,0x49)));

59 
xsum1
 = 
	`_mm_add_ps
(xsum1,
	`_mm_mul_ps
(
	`_mm_shufÊe_ps
(
x0
,x0,0xaa),

60 
	`_mm_shufÊe_ps
(
yj
,
y3
,0x9e)));

61 
xsum2
 = 
	`_mm_add_ps
(xsum2,
	`_mm_mul_ps
(
	`_mm_shufÊe_ps
(
x0
,x0,0xff),
y3
));

63 i‡(
j
 < 
Àn
)

65 
xsum1
 = 
	`_mm_add_ps
(xsum1,
	`_mm_mul_ps
(
	`_mm_lﬂd1_ps
(
x
+
j
),
	`_mm_lﬂdu_ps
(
y
+j)));

66 i‡(++
j
 < 
Àn
)

68 
xsum2
 = 
	`_mm_add_ps
(xsum2,
	`_mm_mul_ps
(
	`_mm_lﬂd1_ps
(
x
+
j
),
	`_mm_lﬂdu_ps
(
y
+j)));

69 i‡(++
j
 < 
Àn
)

71 
xsum1
 = 
	`_mm_add_ps
(xsum1,
	`_mm_mul_ps
(
	`_mm_lﬂd1_ps
(
x
+
j
),
	`_mm_lﬂdu_ps
(
y
+j)));

75 
	`_mm_°‹eu_ps
(
sum
,
	`_mm_add_ps
(
xsum1
,
xsum2
));

76 
	}
}

79 
	$duÆ_ö√r_¥od_s£
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y01
, c⁄° opus_vÆ16 *
y02
,

80 
N
, 
›us_vÆ32
 *
xy1
, opus_vÆ32 *
xy2
)

82 
i
;

83 
__m128
 
xsum1
, 
xsum2
;

84 
xsum1
 = 
	`_mm_£tzîo_ps
();

85 
xsum2
 = 
	`_mm_£tzîo_ps
();

86 
i
=0;i<
N
-3;i+=4)

88 
__m128
 
xi
 = 
	`_mm_lﬂdu_ps
(
x
+
i
);

89 
__m128
 
y1i
 = 
	`_mm_lﬂdu_ps
(
y01
+
i
);

90 
__m128
 
y2i
 = 
	`_mm_lﬂdu_ps
(
y02
+
i
);

91 
xsum1
 = 
	`_mm_add_ps
(xsum1,
	`_mm_mul_ps
(
xi
, 
y1i
));

92 
xsum2
 = 
	`_mm_add_ps
(xsum2,
	`_mm_mul_ps
(
xi
, 
y2i
));

95 
xsum1
 = 
	`_mm_add_ps
(xsum1, 
	`_mm_movehl_ps
(xsum1, xsum1));

96 
xsum1
 = 
	`_mm_add_ss
(xsum1, 
	`_mm_shufÊe_ps
(xsum1, xsum1, 0x55));

97 
	`_mm_°‹e_ss
(
xy1
, 
xsum1
);

98 
xsum2
 = 
	`_mm_add_ps
(xsum2, 
	`_mm_movehl_ps
(xsum2, xsum2));

99 
xsum2
 = 
	`_mm_add_ss
(xsum2, 
	`_mm_shufÊe_ps
(xsum2, xsum2, 0x55));

100 
	`_mm_°‹e_ss
(
xy2
, 
xsum2
);

101 ;
i
<
N
;i++)

103 *
xy1
 = 
	`MAC16_16
(*xy1, 
x
[
i
], 
y01
[i]);

104 *
xy2
 = 
	`MAC16_16
(*xy2, 
x
[
i
], 
y02
[i]);

106 
	}
}

108 
›us_vÆ32
 
	$˚…_ö√r_¥od_s£
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
,

109 
N
)

111 
i
;

112 
xy
;

113 
__m128
 
sum
;

114 
sum
 = 
	`_mm_£tzîo_ps
();

116 
i
=0;i<
N
-3;i+=4)

118 
__m128
 
xi
 = 
	`_mm_lﬂdu_ps
(
x
+
i
);

119 
__m128
 
yi
 = 
	`_mm_lﬂdu_ps
(
y
+
i
);

120 
sum
 = 
	`_mm_add_ps
(sum,
	`_mm_mul_ps
(
xi
, 
yi
));

123 
sum
 = 
	`_mm_add_ps
(sum, 
	`_mm_movehl_ps
(sum, sum));

124 
sum
 = 
	`_mm_add_ss
(sum, 
	`_mm_shufÊe_ps
(sum, sum, 0x55));

125 
	`_mm_°‹e_ss
(&
xy
, 
sum
);

126 ;
i
<
N
;i++)

128 
xy
 = 
	`MAC16_16
(xy, 
x
[
i
], 
y
[i]);

130  
xy
;

131 
	}
}

133 
	$comb_fûãr_c⁄°_s£
(
›us_vÆ32
 *
y
, opus_vÆ32 *
x
, 
T
, 
N
,

134 
›us_vÆ16
 
g10
, opus_vÆ16 
g11
, opus_vÆ16 
g12
)

136 
i
;

137 
__m128
 
x0v
;

138 
__m128
 
g10v
, 
g11v
, 
g12v
;

139 
g10v
 = 
	`_mm_lﬂd1_ps
(&
g10
);

140 
g11v
 = 
	`_mm_lﬂd1_ps
(&
g11
);

141 
g12v
 = 
	`_mm_lﬂd1_ps
(&
g12
);

142 
x0v
 = 
	`_mm_lﬂdu_ps
(&
x
[-
T
-2]);

143 
i
=0;i<
N
-3;i+=4)

145 
__m128
 
yi
, 
yi2
, 
x1v
, 
x2v
, 
x3v
, 
x4v
;

146 c⁄° 
›us_vÆ32
 *
xp
 = &
x
[
i
-
T
-2];

147 
yi
 = 
	`_mm_lﬂdu_ps
(
x
+
i
);

148 
x4v
 = 
	`_mm_lﬂdu_ps
(
xp
+4);

151 
x1v
 = 
	`_mm_lﬂdu_ps
(
xp
+1);

152 
x2v
 = 
	`_mm_lﬂdu_ps
(
xp
+2);

153 
x3v
 = 
	`_mm_lﬂdu_ps
(
xp
+3);

155 
x2v
 = 
	`_mm_shufÊe_ps
(
x0v
, 
x4v
, 0x4e);

156 
x1v
 = 
	`_mm_shufÊe_ps
(
x0v
, 
x2v
, 0x99);

157 
x3v
 = 
	`_mm_shufÊe_ps
(
x2v
, 
x4v
, 0x99);

160 
yi
 = 
	`_mm_add_ps
(yi, 
	`_mm_mul_ps
(
g10v
,
x2v
));

162 
yi
 = 
	`_mm_add_ps
(yi, 
	`_mm_mul_ps
(
g11v
,_mm_add_ps(
x3v
,
x1v
)));

163 
yi
 = 
	`_mm_add_ps
(yi, 
	`_mm_mul_ps
(
g12v
,_mm_add_ps(
x4v
,
x0v
)));

166 
yi2
 = 
	`_mm_add_ps
(
	`_mm_mul_ps
(
g11v
,_mm_add_ps(
x3v
,
x1v
)),

167 
	`_mm_mul_ps
(
g12v
,
	`_mm_add_ps
(
x4v
,
x0v
)));

168 
yi
 = 
	`_mm_add_ps
(yi, 
yi2
);

170 
x0v
=
x4v
;

171 
	`_mm_°‹eu_ps
(
y
+
i
, 
yi
);

173 #ifde‡
CUSTOM_MODES


174 ;
i
<
N
;i++)

176 
y
[
i
] = 
x
[i]

177 + 
	`MULT16_32_Q15
(
g10
,
x
[
i
-
T
])

178 + 
	`MULT16_32_Q15
(
g11
,
	`ADD32
(
x
[
i
-
T
+1],x[i-T-1]))

179 + 
	`MULT16_32_Q15
(
g12
,
	`ADD32
(
x
[
i
-
T
+2],x[i-T-2]));

182 
	}
}

	@celt/x86/pitch_sse.h

33 #i‚de‡
PITCH_SSE_H


34 
	#PITCH_SSE_H


	)

36 #i‡
deföed
(
HAVE_CONFIG_H
)

37 
	~"c⁄fig.h
"

40 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& deföed(
FIXED_POINT
)

41 
xc‹r_kî√l_s£4_1
(

42 c⁄° 
›us_öt16
 *
x
,

43 c⁄° 
›us_öt16
 *
y
,

44 
›us_vÆ32
 
sum
[4],

45 
Àn
);

48 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
FIXED_POINT
)

49 
xc‹r_kî√l_s£
(

50 c⁄° 
›us_vÆ16
 *
x
,

51 c⁄° 
›us_vÆ16
 *
y
,

52 
›us_vÆ32
 
sum
[4],

53 
Àn
);

56 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
Ë&& deföed(
FIXED_POINT
)

57 
	#OVERRIDE_XCORR_KERNEL


	)

58 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

59 (()
¨ch
, 
	`xc‹r_kî√l_s£4_1
(
x
, 
y
, 
sum
, 
Àn
))

	)

61 #ñi‡
deföed
(
OPUS_X86_PRESUME_SSE
Ë&& !deföed(
FIXED_POINT
)

62 
	#OVERRIDE_XCORR_KERNEL


	)

63 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

64 (()
¨ch
, 
	`xc‹r_kî√l_s£
(
x
, 
y
, 
sum
, 
Àn
))

	)

66 #ñi‡(
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& deföed(
FIXED_POINT
)Ë|| (deföed(
OPUS_X86_MAY_HAVE_SSE
) && !defined(FIXED_POINT))

68 (*c⁄° 
XCORR_KERNEL_IMPL
[
OPUS_ARCHMASK
 + 1])(

69 c⁄° 
›us_vÆ16
 *
x
,

70 c⁄° 
›us_vÆ16
 *
y
,

71 
›us_vÆ32
 
sum
[4],

72 
Àn
);

74 
	#OVERRIDE_XCORR_KERNEL


	)

75 
	#xc‹r_kî√l
(
x
, 
y
, 
sum
, 
Àn
, 
¨ch
) \

76 ((*
XCORR_KERNEL_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
x
, 
y
, 
sum
, 
Àn
))

	)

80 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& deföed(
FIXED_POINT
)

81 
›us_vÆ32
 
˚…_ö√r_¥od_s£4_1
(

82 c⁄° 
›us_öt16
 *
x
,

83 c⁄° 
›us_öt16
 *
y
,

84 
N
);

87 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& deföed(
FIXED_POINT
)

88 
›us_vÆ32
 
˚…_ö√r_¥od_s£2
(

89 c⁄° 
›us_öt16
 *
x
,

90 c⁄° 
›us_öt16
 *
y
,

91 
N
);

94 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
FIXED_POINT
)

95 
›us_vÆ32
 
˚…_ö√r_¥od_s£
(

96 c⁄° 
›us_vÆ16
 *
x
,

97 c⁄° 
›us_vÆ16
 *
y
,

98 
N
);

102 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
Ë&& deföed(
FIXED_POINT
)

103 
	#OVERRIDE_CELT_INNER_PROD


	)

104 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
) \

105 (()
¨ch
, 
	`˚…_ö√r_¥od_s£4_1
(
x
, 
y
, 
N
))

	)

107 #ñi‡
deföed
(
OPUS_X86_PRESUME_SSE2
Ë&& deföed(
FIXED_POINT
Ë&& !deföed(
OPUS_X86_MAY_HAVE_SSE4_1
)

108 
	#OVERRIDE_CELT_INNER_PROD


	)

109 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
) \

110 (()
¨ch
, 
	`˚…_ö√r_¥od_s£2
(
x
, 
y
, 
N
))

	)

112 #ñi‡
deföed
(
OPUS_X86_PRESUME_SSE
Ë&& !deföed(
FIXED_POINT
)

113 
	#OVERRIDE_CELT_INNER_PROD


	)

114 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
) \

115 (()
¨ch
, 
	`˚…_ö√r_¥od_s£
(
x
, 
y
, 
N
))

	)

118 #ñi‡((
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë|| deföed(
OPUS_X86_MAY_HAVE_SSE2
)Ë&& deföed(
FIXED_POINT
)) || \

119 (
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !
	$deföed
(
FIXED_POINT
))

121 
	`›us_vÆ32
 (*c⁄° 
CELT_INNER_PROD_IMPL
[
OPUS_ARCHMASK
 + 1])(

122 c⁄° 
›us_vÆ16
 *
x
,

123 c⁄° 
›us_vÆ16
 *
y
,

124 
N
);

126 
	#OVERRIDE_CELT_INNER_PROD


	)

127 
	#˚…_ö√r_¥od
(
x
, 
y
, 
N
, 
¨ch
) \

128 ((*
CELT_INNER_PROD_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
x
, 
y
, 
N
))

	)

132 #i‡
	`deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
FIXED_POINT
)

134 
	#OVERRIDE_DUAL_INNER_PROD


	)

135 
	#OVERRIDE_COMB_FILTER_CONST


	)

137 #unde‡
duÆ_ö√r_¥od


138 #unde‡
comb_fûãr_c⁄°


140 
	`duÆ_ö√r_¥od_s£
(c⁄° 
›us_vÆ16
 *
x
,

141 c⁄° 
›us_vÆ16
 *
y01
,

142 c⁄° 
›us_vÆ16
 *
y02
,

143 
N
,

144 
›us_vÆ32
 *
xy1
,

145 
›us_vÆ32
 *
xy2
);

147 
	`comb_fûãr_c⁄°_s£
(
›us_vÆ32
 *
y
,

148 
›us_vÆ32
 *
x
,

149 
T
,

150 
N
,

151 
›us_vÆ16
 
g10
,

152 
›us_vÆ16
 
g11
,

153 
›us_vÆ16
 
g12
);

156 #i‡
	`deföed
(
OPUS_X86_PRESUME_SSE
)

157 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
) \

158 (()(
¨ch
),
	`duÆ_ö√r_¥od_s£
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
))

	)

160 
	#comb_fûãr_c⁄°
(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
, 
¨ch
) \

161 (()(
¨ch
),
	`comb_fûãr_c⁄°_s£
(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
))

	)

164 (*c⁄° 
DUAL_INNER_PROD_IMPL
[
OPUS_ARCHMASK
 + 1])(

165 c⁄° 
›us_vÆ16
 *
x
,

166 c⁄° 
›us_vÆ16
 *
y01
,

167 c⁄° 
›us_vÆ16
 *
y02
,

168 
N
,

169 
›us_vÆ32
 *
xy1
,

170 
›us_vÆ32
 *
xy2
);

172 
	#duÆ_ö√r_¥od
(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
, 
¨ch
) \

173 ((*
DUAL_INNER_PROD_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
x
, 
y01
, 
y02
, 
N
, 
xy1
, 
xy2
))

	)

175 (*c⁄° 
COMB_FILTER_CONST_IMPL
[
OPUS_ARCHMASK
 + 1])(

176 
›us_vÆ32
 *
y
,

177 
›us_vÆ32
 *
x
,

178 
T
,

179 
N
,

180 
›us_vÆ16
 
g10
,

181 
›us_vÆ16
 
g11
,

182 
›us_vÆ16
 
g12
);

184 
	#comb_fûãr_c⁄°
(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
, 
¨ch
) \

185 ((*
COMB_FILTER_CONST_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
y
, 
x
, 
T
, 
N
, 
g10
, 
g11
, 
g12
))

	)

187 
	#NON_STATIC_COMB_FILTER_CONST_C


	)

	@celt/x86/pitch_sse2.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

35 
	~"ma¸os.h
"

36 
	~"˚…_Õc.h
"

37 
	~"°ack_Æloc.h
"

38 
	~"m©h›s.h
"

39 
	~"pôch.h
"

41 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& deföed(
FIXED_POINT
)

42 
›us_vÆ32
 
	$˚…_ö√r_¥od_s£2
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
,

43 
N
)

45 
›us_öt
 
i
, 
d©aSize16
;

46 
›us_öt32
 
sum
;

48 
__m128i
 
öVec1_76543210
, 
öVec1_FEDCBA98
, 
acc1
;

49 
__m128i
 
öVec2_76543210
, 
öVec2_FEDCBA98
, 
acc2
;

51 
sum
 = 0;

52 
d©aSize16
 = 
N
 & ~15;

54 
acc1
 = 
	`_mm_£tzîo_si128
();

55 
acc2
 = 
	`_mm_£tzîo_si128
();

57 
i
=0;i<
d©aSize16
;i+=16)

59 
öVec1_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 0]));

60 
öVec2_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 0]));

62 
öVec1_FEDCBA98
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 8]));

63 
öVec2_FEDCBA98
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 8]));

65 
öVec1_76543210
 = 
	`_mm_madd_ïi16
(öVec1_76543210, 
öVec2_76543210
);

66 
öVec1_FEDCBA98
 = 
	`_mm_madd_ïi16
(öVec1_FEDCBA98, 
öVec2_FEDCBA98
);

68 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
öVec1_76543210
);

69 
acc2
 = 
	`_mm_add_ïi32
◊cc2, 
öVec1_FEDCBA98
);

72 
acc1
 = 
	`_mm_add_ïi32
–acc1, 
acc2
 );

74 i‡(
N
 - 
i
 >= 8)

76 
öVec1_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 0]));

77 
öVec2_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 0]));

79 
öVec1_76543210
 = 
	`_mm_madd_ïi16
(öVec1_76543210, 
öVec2_76543210
);

81 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
öVec1_76543210
);

82 
i
 += 8;

85 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
	`_mm_u≈ackhi_ïi64
(ácc1,ácc1));

86 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
	`_mm_shufÊño_ïi16
(ácc1, 0x0E));

87 
sum
 +
	`_mm_cvtsi128_si32
(
acc1
);

89 ;
i
<
N
;i++) {

90 
sum
 = 
	`sûk_SMLABB
(sum, 
x
[
i
], 
y
[i]);

93  
sum
;

94 
	}
}

	@celt/x86/pitch_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

35 
	~"ma¸os.h
"

36 
	~"˚…_Õc.h
"

37 
	~"°ack_Æloc.h
"

38 
	~"m©h›s.h
"

39 
	~"pôch.h
"

41 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& deföed(
FIXED_POINT
)

42 
	~<smmöåö.h
>

43 
	~"x86˝u.h
"

45 
›us_vÆ32
 
	$˚…_ö√r_¥od_s£4_1
(c⁄° 
›us_vÆ16
 *
x
, c⁄° opus_vÆ16 *
y
,

46 
N
)

48 
›us_öt
 
i
, 
d©aSize16
;

49 
›us_öt32
 
sum
;

50 
__m128i
 
öVec1_76543210
, 
öVec1_FEDCBA98
, 
acc1
;

51 
__m128i
 
öVec2_76543210
, 
öVec2_FEDCBA98
, 
acc2
;

52 
__m128i
 
öVec1_3210
, 
öVec2_3210
;

54 
sum
 = 0;

55 
d©aSize16
 = 
N
 & ~15;

57 
acc1
 = 
	`_mm_£tzîo_si128
();

58 
acc2
 = 
	`_mm_£tzîo_si128
();

60 
i
=0;i<
d©aSize16
;i+=16) {

61 
öVec1_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 0]));

62 
öVec2_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 0]));

64 
öVec1_FEDCBA98
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 8]));

65 
öVec2_FEDCBA98
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 8]));

67 
öVec1_76543210
 = 
	`_mm_madd_ïi16
(öVec1_76543210, 
öVec2_76543210
);

68 
öVec1_FEDCBA98
 = 
	`_mm_madd_ïi16
(öVec1_FEDCBA98, 
öVec2_FEDCBA98
);

70 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
öVec1_76543210
);

71 
acc2
 = 
	`_mm_add_ïi32
◊cc2, 
öVec1_FEDCBA98
);

74 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
acc2
);

76 i‡(
N
 - 
i
 >= 8)

78 
öVec1_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
i
 + 0]));

79 
öVec2_76543210
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
i
 + 0]));

81 
öVec1_76543210
 = 
	`_mm_madd_ïi16
(öVec1_76543210, 
öVec2_76543210
);

83 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
öVec1_76543210
);

84 
i
 += 8;

87 i‡(
N
 - 
i
 >= 4)

89 
öVec1_3210
 = 
	`OP_CVTEPI16_EPI32_M64
(&
x
[
i
 + 0]);

90 
öVec2_3210
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
i
 + 0]);

92 
öVec1_3210
 = 
	`_mm_muŒo_ïi32
(öVec1_3210, 
öVec2_3210
);

94 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
öVec1_3210
);

95 
i
 += 4;

98 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
	`_mm_u≈ackhi_ïi64
(acc1,ácc1));

99 
acc1
 = 
	`_mm_add_ïi32
◊cc1, 
	`_mm_shufÊño_ïi16
(acc1, 0x0E));

101 
sum
 +
	`_mm_cvtsi128_si32
(
acc1
);

103 ;
i
<
N
;i++)

105 
sum
 = 
	`sûk_SMLABB
(sum, 
x
[
i
], 
y
[i]);

108  
sum
;

109 
	}
}

111 
	$xc‹r_kî√l_s£4_1
(c⁄° 
›us_vÆ16
 * 
x
, c⁄° opus_vÆ16 * 
y
, 
›us_vÆ32
 
sum
[ 4 ], 
Àn
)

113 
j
;

115 
__m128i
 
vecX
, 
vecX0
, 
vecX1
, 
vecX2
, 
vecX3
;

116 
__m128i
 
vecY0
, 
vecY1
, 
vecY2
, 
vecY3
;

117 
__m128i
 
sum0
, 
sum1
, 
sum2
, 
sum3
, 
vecSum
;

118 
__m128i
 
öôSum
;

120 
	`˚…_as£π
(
Àn
 >= 3);

122 
sum0
 = 
	`_mm_£tzîo_si128
();

123 
sum1
 = 
	`_mm_£tzîo_si128
();

124 
sum2
 = 
	`_mm_£tzîo_si128
();

125 
sum3
 = 
	`_mm_£tzîo_si128
();

127 
j
=0;j<(
Àn
-7);j+=8)

129 
vecX
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
x
[
j
 + 0]));

130 
vecY0
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
j
 + 0]));

131 
vecY1
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
j
 + 1]));

132 
vecY2
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
j
 + 2]));

133 
vecY3
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
y
[
j
 + 3]));

135 
sum0
 = 
	`_mm_add_ïi32
(sum0, 
	`_mm_madd_ïi16
(
vecX
, 
vecY0
));

136 
sum1
 = 
	`_mm_add_ïi32
(sum1, 
	`_mm_madd_ïi16
(
vecX
, 
vecY1
));

137 
sum2
 = 
	`_mm_add_ïi32
(sum2, 
	`_mm_madd_ïi16
(
vecX
, 
vecY2
));

138 
sum3
 = 
	`_mm_add_ïi32
(sum3, 
	`_mm_madd_ïi16
(
vecX
, 
vecY3
));

141 
sum0
 = 
	`_mm_add_ïi32
(sum0, 
	`_mm_u≈ackhi_ïi64
( sum0, sum0));

142 
sum0
 = 
	`_mm_add_ïi32
(sum0, 
	`_mm_shufÊño_ïi16
( sum0, 0x0E));

144 
sum1
 = 
	`_mm_add_ïi32
(sum1, 
	`_mm_u≈ackhi_ïi64
( sum1, sum1));

145 
sum1
 = 
	`_mm_add_ïi32
(sum1, 
	`_mm_shufÊño_ïi16
( sum1, 0x0E));

147 
sum2
 = 
	`_mm_add_ïi32
(sum2, 
	`_mm_u≈ackhi_ïi64
( sum2, sum2));

148 
sum2
 = 
	`_mm_add_ïi32
(sum2, 
	`_mm_shufÊño_ïi16
( sum2, 0x0E));

150 
sum3
 = 
	`_mm_add_ïi32
(sum3, 
	`_mm_u≈ackhi_ïi64
( sum3, sum3));

151 
sum3
 = 
	`_mm_add_ïi32
(sum3, 
	`_mm_shufÊño_ïi16
( sum3, 0x0E));

153 
vecSum
 = 
	`_mm_u≈acklo_ïi64
(
	`_mm_u≈acklo_ïi32
(
sum0
, 
sum1
),

154 
	`_mm_u≈acklo_ïi32
(
sum2
, 
sum3
));

156 ;
j
<(
Àn
-3);j+=4)

158 
vecX
 = 
	`OP_CVTEPI16_EPI32_M64
(&
x
[
j
 + 0]);

159 
vecX0
 = 
	`_mm_shufÊe_ïi32
(
vecX
, 0x00);

160 
vecX1
 = 
	`_mm_shufÊe_ïi32
(
vecX
, 0x55);

161 
vecX2
 = 
	`_mm_shufÊe_ïi32
(
vecX
, 0xaa);

162 
vecX3
 = 
	`_mm_shufÊe_ïi32
(
vecX
, 0xff);

164 
vecY0
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
j
 + 0]);

165 
vecY1
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
j
 + 1]);

166 
vecY2
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
j
 + 2]);

167 
vecY3
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
j
 + 3]);

169 
sum0
 = 
	`_mm_muŒo_ïi32
(
vecX0
, 
vecY0
);

170 
sum1
 = 
	`_mm_muŒo_ïi32
(
vecX1
, 
vecY1
);

171 
sum2
 = 
	`_mm_muŒo_ïi32
(
vecX2
, 
vecY2
);

172 
sum3
 = 
	`_mm_muŒo_ïi32
(
vecX3
, 
vecY3
);

174 
sum0
 = 
	`_mm_add_ïi32
(sum0, 
sum1
);

175 
sum2
 = 
	`_mm_add_ïi32
(sum2, 
sum3
);

176 
vecSum
 = 
	`_mm_add_ïi32
(vecSum, 
sum0
);

177 
vecSum
 = 
	`_mm_add_ïi32
(vecSum, 
sum2
);

180 ;
j
<
Àn
;j++)

182 
vecX
 = 
	`OP_CVTEPI16_EPI32_M64
(&
x
[
j
 + 0]);

183 
vecX0
 = 
	`_mm_shufÊe_ïi32
(
vecX
, 0x00);

185 
vecY0
 = 
	`OP_CVTEPI16_EPI32_M64
(&
y
[
j
 + 0]);

187 
sum0
 = 
	`_mm_muŒo_ïi32
(
vecX0
, 
vecY0
);

188 
vecSum
 = 
	`_mm_add_ïi32
(vecSum, 
sum0
);

191 
öôSum
 = 
	`_mm_lﬂdu_si128
((
__m128i
 *)(&
sum
[0]));

192 
öôSum
 = 
	`_mm_add_ïi32
(öôSum, 
vecSum
);

193 
	`_mm_°‹eu_si128
((
__m128i
 *)
sum
, 
öôSum
);

194 
	}
}

	@celt/x86/vq_sse.h

27 #i‚de‡
VQ_SSE_H


28 
	#VQ_SSE_H


	)

30 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
FIXED_POINT
)

31 
	#OVERRIDE_OP_PVQ_SEARCH


	)

33 
›us_vÆ16
 
›_pvq_£¨ch_s£2
(
˚…_n‹m
 *
_X
, *
iy
, 
K
, 
N
, 
¨ch
);

35 #i‡
deföed
(
OPUS_X86_PRESUME_SSE2
)

36 
	#›_pvq_£¨ch
(
x
, 
iy
, 
K
, 
N
, 
¨ch
) \

37 (
	`›_pvq_£¨ch_s£2
(
x
, 
iy
, 
K
, 
N
, 
¨ch
))

	)

41 
›us_vÆ16
 (*c⁄° 
OP_PVQ_SEARCH_IMPL
[
OPUS_ARCHMASK
 + 1])(

42 
˚…_n‹m
 *
_X
, *
iy
, 
K
, 
N
, 
¨ch
);

44 
	#›_pvq_£¨ch
(
X
, 
iy
, 
K
, 
N
, 
¨ch
) \

45 ((*
OP_PVQ_SEARCH_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
X
, 
iy
, 
K
, 
N
,árch))

	)

	@celt/x86/vq_sse2.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<xmmöåö.h
>

34 
	~<emmöåö.h
>

35 
	~"˚…_Õc.h
"

36 
	~"°ack_Æloc.h
"

37 
	~"m©h›s.h
"

38 
	~"vq.h
"

39 
	~"x86˝u.h
"

42 #i‚de‡
FIXED_POINT


44 
›us_vÆ16
 
	$›_pvq_£¨ch_s£2
(
˚…_n‹m
 *
_X
, *
iy
, 
K
, 
N
, 
¨ch
)

46 
i
, 
j
;

47 
pul£sLe·
;

48 
xy
, 
yy
;

49 
	`VARDECL
(
˚…_n‹m
, 
y
);

50 
	`VARDECL
(
˚…_n‹m
, 
X
);

51 
	`VARDECL
(, 
signy
);

52 
__m128
 
signmask
;

53 
__m128
 
sums
;

54 
__m128i
 
fours
;

55 
SAVE_STACK
;

57 ()
¨ch
;

59 
signmask
 = 
	`_mm_£t_ps1
(-0.f);

60 
fours
 = 
	`_mm_£t_ïi32
(4, 4, 4, 4);

61 
	`ALLOC
(
y
, 
N
+3, 
˚…_n‹m
);

62 
	`ALLOC
(
X
, 
N
+3, 
˚…_n‹m
);

63 
	`ALLOC
(
signy
, 
N
+3, );

65 
	`OPUS_COPY
(
X
, 
_X
, 
N
);

66 
X
[
N
] = X[N+1] = X[N+2] = 0;

67 
sums
 = 
	`_mm_£tzîo_ps
();

68 
j
=0;j<
N
;j+=4)

70 
__m128
 
x4
, 
s4
;

71 
x4
 = 
	`_mm_lﬂdu_ps
(&
X
[
j
]);

72 
s4
 = 
	`_mm_cm∂t_ps
(
x4
, 
	`_mm_£tzîo_ps
());

74 
x4
 = 
	`_mm_™dnŸ_ps
(
signmask
, x4);

75 
sums
 = 
	`_mm_add_ps
(sums, 
x4
);

77 
	`_mm_°‹eu_ps
(&
y
[
j
], 
	`_mm_£tzîo_ps
());

78 
	`_mm_°‹eu_si128
((
__m128i
*)&
iy
[
j
], 
	`_mm_£tzîo_si128
());

79 
	`_mm_°‹eu_ps
(&
X
[
j
], 
x4
);

80 
	`_mm_°‹eu_ps
(&
signy
[
j
], 
s4
);

82 
sums
 = 
	`_mm_add_ps
(sums, 
	`_mm_shufÊe_ps
(sums, sums, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

83 
sums
 = 
	`_mm_add_ps
(sums, 
	`_mm_shufÊe_ps
(sums, sums, 
	`_MM_SHUFFLE
(2, 3, 0, 1)));

85 
xy
 = 
yy
 = 0;

87 
pul£sLe·
 = 
K
;

90 i‡(
K
 > (
N
>>1))

92 
__m128i
 
pul£s_sum
;

93 
__m128
 
yy4
, 
xy4
;

94 
__m128
 
r˝4
;

95 
›us_vÆ32
 
sum
 = 
	`_mm_cvtss_f32
(
sums
);

99 i‡(!(
sum
 > 
EPSILON
 && sum < 64))

101 
X
[0] = 
	`QCONST16
(1.f,14);

102 
j
=1; do

103 
X
[
j
]=0;

104 ++
j
<
N
);

105 
sums
 = 
	`_mm_£t_ps1
(1.f);

108 
r˝4
 = 
	`_mm_mul_ps
(
	`_mm_£t_ps1
(()(
K
+.8)), 
	`_mm_r˝_ps
(
sums
));

109 
xy4
 = 
yy4
 = 
	`_mm_£tzîo_ps
();

110 
pul£s_sum
 = 
	`_mm_£tzîo_si128
();

111 
j
=0;j<
N
;j+=4)

113 
__m128
 
rx4
, 
x4
, 
y4
;

114 
__m128i
 
iy4
;

115 
x4
 = 
	`_mm_lﬂdu_ps
(&
X
[
j
]);

116 
rx4
 = 
	`_mm_mul_ps
(
x4
, 
r˝4
);

117 
iy4
 = 
	`_mm_cvâps_ïi32
(
rx4
);

118 
pul£s_sum
 = 
	`_mm_add_ïi32
’ul£s_sum, 
iy4
);

119 
	`_mm_°‹eu_si128
((
__m128i
*)&
iy
[
j
], 
iy4
);

120 
y4
 = 
	`_mm_cvãpi32_ps
(
iy4
);

121 
xy4
 = 
	`_mm_add_ps
(xy4, 
	`_mm_mul_ps
(
x4
, 
y4
));

122 
yy4
 = 
	`_mm_add_ps
(yy4, 
	`_mm_mul_ps
(
y4
, y4));

124 
	`_mm_°‹eu_ps
(&
y
[
j
], 
	`_mm_add_ps
(
y4
, y4));

126 
pul£s_sum
 = 
	`_mm_add_ïi32
’ul£s_sum, 
	`_mm_shufÊe_ïi32
’ul£s_sum, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

127 
pul£s_sum
 = 
	`_mm_add_ïi32
’ul£s_sum, 
	`_mm_shufÊe_ïi32
’ul£s_sum, 
	`_MM_SHUFFLE
(2, 3, 0, 1)));

128 
pul£sLe·
 -
	`_mm_cvtsi128_si32
(
pul£s_sum
);

129 
xy4
 = 
	`_mm_add_ps
(xy4, 
	`_mm_shufÊe_ps
(xy4, xy4, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

130 
xy4
 = 
	`_mm_add_ps
(xy4, 
	`_mm_shufÊe_ps
(xy4, xy4, 
	`_MM_SHUFFLE
(2, 3, 0, 1)));

131 
xy
 = 
	`_mm_cvtss_f32
(
xy4
);

132 
yy4
 = 
	`_mm_add_ps
(yy4, 
	`_mm_shufÊe_ps
(yy4, yy4, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

133 
yy4
 = 
	`_mm_add_ps
(yy4, 
	`_mm_shufÊe_ps
(yy4, yy4, 
	`_MM_SHUFFLE
(2, 3, 0, 1)));

134 
yy
 = 
	`_mm_cvtss_f32
(
yy4
);

136 
X
[
N
] = X[N+1] = X[N+2] = -100;

137 
y
[
N
] = y[N+1] = y[N+2] = 100;

138 
	`˚…_sig_as£π
(
pul£sLe·
>=0);

142 i‡(
pul£sLe·
 > 
N
+3)

144 
›us_vÆ16
 
tmp
 = (›us_vÆ16)
pul£sLe·
;

145 
yy
 = 
	`MAC16_16
(yy, 
tmp
,Åmp);

146 
yy
 = 
	`MAC16_16
(yy, 
tmp
, 
y
[0]);

147 
iy
[0] +
pul£sLe·
;

148 
pul£sLe·
=0;

151 
i
=0;i<
pul£sLe·
;i++)

153 
be°_id
;

154 
__m128
 
xy4
, 
yy4
;

155 
__m128
 
max
, 
max2
;

156 
__m128i
 
cou¡
;

157 
__m128i
 
pos
;

160 
yy
 = 
	`ADD16
(yy, 1);

161 
xy4
 = 
	`_mm_lﬂd1_ps
(&
xy
);

162 
yy4
 = 
	`_mm_lﬂd1_ps
(&
yy
);

163 
max
 = 
	`_mm_£tzîo_ps
();

164 
pos
 = 
	`_mm_£tzîo_si128
();

165 
cou¡
 = 
	`_mm_£t_ïi32
(3, 2, 1, 0);

166 
j
=0;j<
N
;j+=4)

168 
__m128
 
x4
, 
y4
, 
r4
;

169 
x4
 = 
	`_mm_lﬂdu_ps
(&
X
[
j
]);

170 
y4
 = 
	`_mm_lﬂdu_ps
(&
y
[
j
]);

171 
x4
 = 
	`_mm_add_ps
(x4, 
xy4
);

172 
y4
 = 
	`_mm_add_ps
(y4, 
yy4
);

173 
y4
 = 
	`_mm_rsqπ_ps
(y4);

174 
r4
 = 
	`_mm_mul_ps
(
x4
, 
y4
);

176 
pos
 = 
	`_mm_max_ïi16
’os, 
	`_mm_™d_si128
(
cou¡
, 
	`_mm_ˇ°ps_si128
(
	`_mm_cmpgt_ps
(
r4
, 
max
))));

178 
max
 = 
	`_mm_max_ps
(max, 
r4
);

180 
cou¡
 = 
	`_mm_add_ïi32
(cou¡, 
fours
);

183 
max2
 = 
	`_mm_max_ps
(
max
, 
	`_mm_shufÊe_ps
(max, max, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

184 
max2
 = 
	`_mm_max_ps
(max2, 
	`_mm_shufÊe_ps
(max2, max2, 
	`_MM_SHUFFLE
(2, 3, 0, 1)));

187 
pos
 = 
	`_mm_™d_si128
’os, 
	`_mm_ˇ°ps_si128
(
	`_mm_cm≥q_ps
(
max
, 
max2
)));

188 
pos
 = 
	`_mm_max_ïi16
’os, 
	`_mm_u≈ackhi_ïi64
(pos,Öos));

189 
pos
 = 
	`_mm_max_ïi16
’os, 
	`_mm_shufÊño_ïi16
’os, 
	`_MM_SHUFFLE
(1, 0, 3, 2)));

190 
be°_id
 = 
	`_mm_cvtsi128_si32
(
pos
);

193 
xy
 = 
	`ADD32
(xy, 
	`EXTEND32
(
X
[
be°_id
]));

195 
yy
 = 
	`ADD16
(yy, 
y
[
be°_id
]);

199 
y
[
be°_id
] += 2;

200 
iy
[
be°_id
]++;

204 
j
=0;j<
N
;j+=4)

206 
__m128i
 
y4
;

207 
__m128i
 
s4
;

208 
y4
 = 
	`_mm_lﬂdu_si128
((
__m128i
*)&
iy
[
j
]);

209 
s4
 = 
	`_mm_ˇ°ps_si128
(
	`_mm_lﬂdu_ps
(&
signy
[
j
]));

210 
y4
 = 
	`_mm_x‹_si128
(
	`_mm_add_ïi32
(y4, 
s4
), s4);

211 
	`_mm_°‹eu_si128
((
__m128i
*)&
iy
[
j
], 
y4
);

213 
RESTORE_STACK
;

214  
yy
;

215 
	}
}

	@celt/x86/x86_celt_map.c

28 #i‡
deföed
(
HAVE_CONFIG_H
)

29 
	~"c⁄fig.h
"

32 
	~"x86/x86˝u.h
"

33 
	~"˚…_Õc.h
"

34 
	~"pôch.h
"

35 
	~"pôch_s£.h
"

36 
	~"vq.h
"

38 #i‡
deföed
(
OPUS_HAVE_RTCD
)

40 #i‡
deföed
(
FIXED_POINT
)

42 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& !deföed(
OPUS_X86_PRESUME_SSE4_1
)

44 (*c⁄° 
	gCELT_FIR_IMPL
[
OPUS_ARCHMASK
 + 1])(

45 c⁄° 
›us_vÆ16
 *
	gx
,

46 c⁄° 
›us_vÆ16
 *
	gnum
,

47 
›us_vÆ16
 *
	gy
,

48 
	gN
,

49 
	g‹d
,

50 
	g¨ch


52 
˚…_fú_c
,

53 
˚…_fú_c
,

54 
˚…_fú_c
,

55 
MAY_HAVE_SSE4_1
(
˚…_fú
),

56 
MAY_HAVE_SSE4_1
(
˚…_fú
)

59 (*c⁄° 
	gXCORR_KERNEL_IMPL
[
OPUS_ARCHMASK
 + 1])(

60 c⁄° 
›us_vÆ16
 *
	gx
,

61 c⁄° 
›us_vÆ16
 *
	gy
,

62 
›us_vÆ32
 
	gsum
[4],

63 
	gÀn


65 
xc‹r_kî√l_c
,

66 
xc‹r_kî√l_c
,

67 
xc‹r_kî√l_c
,

68 
MAY_HAVE_SSE4_1
(
xc‹r_kî√l
),

69 
MAY_HAVE_SSE4_1
(
xc‹r_kî√l
)

74 #i‡(
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& !deföed(
OPUS_X86_PRESUME_SSE4_1
)) || \

75 (!
deföed
(
OPUS_X86_MAY_HAVE_SSE_4_1
Ë&& deföed(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !
	$deföed
(
OPUS_X86_PRESUME_SSE2
))

77 
	`›us_vÆ32
 (*c⁄° 
CELT_INNER_PROD_IMPL
[
OPUS_ARCHMASK
 + 1])(

78 c⁄° 
›us_vÆ16
 *
x
,

79 c⁄° 
›us_vÆ16
 *
y
,

80 
N


82 
˚…_ö√r_¥od_c
,

83 
˚…_ö√r_¥od_c
,

84 
	`MAY_HAVE_SSE2
(
˚…_ö√r_¥od
),

85 
	`MAY_HAVE_SSE4_1
(
˚…_ö√r_¥od
),

86 
	`MAY_HAVE_SSE4_1
(
˚…_ö√r_¥od
)

87 
	}
};

93 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
OPUS_X86_PRESUME_SSE
)

95 (*c⁄° 
	gXCORR_KERNEL_IMPL
[
OPUS_ARCHMASK
 + 1])(

96 c⁄° 
›us_vÆ16
 *
	gx
,

97 c⁄° 
›us_vÆ16
 *
	gy
,

98 
›us_vÆ32
 
	gsum
[4],

99 
	gÀn


101 
xc‹r_kî√l_c
,

102 
MAY_HAVE_SSE
(
xc‹r_kî√l
),

103 
MAY_HAVE_SSE
(
xc‹r_kî√l
),

104 
MAY_HAVE_SSE
(
xc‹r_kî√l
),

105 
MAY_HAVE_SSE
(
xc‹r_kî√l
)

108 
›us_vÆ32
 (*c⁄° 
CELT_INNER_PROD_IMPL
[
OPUS_ARCHMASK
 + 1])(

109 c⁄° 
›us_vÆ16
 *
	gx
,

110 c⁄° 
›us_vÆ16
 *
	gy
,

111 
	gN


113 
˚…_ö√r_¥od_c
,

114 
MAY_HAVE_SSE
(
˚…_ö√r_¥od
),

115 
MAY_HAVE_SSE
(
˚…_ö√r_¥od
),

116 
MAY_HAVE_SSE
(
˚…_ö√r_¥od
),

117 
MAY_HAVE_SSE
(
˚…_ö√r_¥od
)

120 (*c⁄° 
	gDUAL_INNER_PROD_IMPL
[
OPUS_ARCHMASK
 + 1])(

121 c⁄° 
›us_vÆ16
 *
	gx
,

122 c⁄° 
›us_vÆ16
 *
	gy01
,

123 c⁄° 
›us_vÆ16
 *
	gy02
,

124 
	gN
,

125 
›us_vÆ32
 *
	gxy1
,

126 
›us_vÆ32
 *
	gxy2


128 
duÆ_ö√r_¥od_c
,

129 
MAY_HAVE_SSE
(
duÆ_ö√r_¥od
),

130 
MAY_HAVE_SSE
(
duÆ_ö√r_¥od
),

131 
MAY_HAVE_SSE
(
duÆ_ö√r_¥od
),

132 
MAY_HAVE_SSE
(
duÆ_ö√r_¥od
)

135 (*c⁄° 
	gCOMB_FILTER_CONST_IMPL
[
OPUS_ARCHMASK
 + 1])(

136 
›us_vÆ32
 *
	gy
,

137 
›us_vÆ32
 *
	gx
,

138 
	gT
,

139 
	gN
,

140 
›us_vÆ16
 
	gg10
,

141 
›us_vÆ16
 
	gg11
,

142 
›us_vÆ16
 
	gg12


144 
comb_fûãr_c⁄°_c
,

145 
MAY_HAVE_SSE
(
comb_fûãr_c⁄°
),

146 
MAY_HAVE_SSE
(
comb_fûãr_c⁄°
),

147 
MAY_HAVE_SSE
(
comb_fûãr_c⁄°
),

148 
MAY_HAVE_SSE
(
comb_fûãr_c⁄°
)

154 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
OPUS_X86_PRESUME_SSE2
)

155 
›us_vÆ16
 (*c⁄° 
OP_PVQ_SEARCH_IMPL
[
OPUS_ARCHMASK
 + 1])(

156 
˚…_n‹m
 *
	g_X
, *
	giy
, 
	gK
, 
	gN
, 
	g¨ch


158 
›_pvq_£¨ch_c
,

159 
›_pvq_£¨ch_c
,

160 
MAY_HAVE_SSE2
(
›_pvq_£¨ch
),

161 
MAY_HAVE_SSE2
(
›_pvq_£¨ch
),

162 
MAY_HAVE_SSE2
(
›_pvq_£¨ch
)

	@celt/x86/x86cpu.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"˝u_suµ‹t.h
"

33 
	~"ma¸os.h
"

34 
	~"maö.h
"

35 
	~"pôch.h
"

36 
	~"x86˝u.h
"

38 #i‡(
deföed
(
OPUS_X86_MAY_HAVE_SSE
Ë&& !deföed(
OPUS_X86_PRESUME_SSE
)) || \

39 (
deföed
(
OPUS_X86_MAY_HAVE_SSE2
Ë&& !deföed(
OPUS_X86_PRESUME_SSE2
)) || \

40 (
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
Ë&& !deföed(
OPUS_X86_PRESUME_SSE4_1
)) || \

41 (
deföed
(
OPUS_X86_MAY_HAVE_AVX
Ë&& !
	$deföed
(
OPUS_X86_PRESUME_AVX
))

44 #i‡
	`deföed
(
_MSC_VER
)

46 
	~<öåö.h
>

47 
_ölöe
 
	$˝uid
(
CPUInfo
[4], 
InfoTy≥
)

49 
	`__˝uid
((*)
CPUInfo
, 
InfoTy≥
);

50 
	}
}

54 #i‡
deföed
(
CPU_INFO_BY_C
)

55 
	~<˝uid.h
>

58 
	$˝uid
(
CPUInfo
[4], 
InfoTy≥
)

60 #i‡
	`deföed
(
CPU_INFO_BY_ASM
)

61 #i‡
	`deföed
(
__i386__
Ë&& deföed(
__PIC__
)

63 
__asm__
 
	`__vﬁ©ûe__
 (

67 "˜" (
CPUInfo
[0]),

68 "Ù" (
CPUInfo
[1]),

69 "=c" (
CPUInfo
[2]),

70 "=d" (
CPUInfo
[3]) :

71 "0" (
InfoTy≥
)

74 
__asm__
 
	`__vﬁ©ûe__
 (

76 "˜" (
CPUInfo
[0]),

77 "=b" (
CPUInfo
[1]),

78 "=c" (
CPUInfo
[2]),

79 "=d" (
CPUInfo
[3]) :

80 "0" (
InfoTy≥
)

83 #ñi‡
	`deföed
(
CPU_INFO_BY_C
)

84 
	`__gë_˝uid
(
InfoTy≥
, &(
CPUInfo
[0]), &(CPUInfo[1]), &(CPUInfo[2]), &(CPUInfo[3]));

86 
	}
}

90 
	sCPU_Fótuª
{

92 
	mHW_SSE
;

93 
	mHW_SSE2
;

94 
	mHW_SSE41
;

96 
	mHW_AVX
;

97 } 
	tCPU_Fótuª
;

99 
	$›us_˝u_„©uª_check
(
CPU_Fótuª
 *
˝u_„©uª
)

101 
öfo
[4] = {0};

102 
nIds
 = 0;

104 
	`˝uid
(
öfo
, 0);

105 
nIds
 = 
öfo
[0];

107 i‡(
nIds
 >= 1){

108 
	`˝uid
(
öfo
, 1);

109 
˝u_„©uª
->
HW_SSE
 = (
öfo
[3] & (1 << 25)) != 0;

110 
˝u_„©uª
->
HW_SSE2
 = (
öfo
[3] & (1 << 26)) != 0;

111 
˝u_„©uª
->
HW_SSE41
 = (
öfo
[2] & (1 << 19)) != 0;

112 
˝u_„©uª
->
HW_AVX
 = (
öfo
[2] & (1 << 28)) != 0;

115 
˝u_„©uª
->
HW_SSE
 = 0;

116 
˝u_„©uª
->
HW_SSE2
 = 0;

117 
˝u_„©uª
->
HW_SSE41
 = 0;

118 
˝u_„©uª
->
HW_AVX
 = 0;

120 
	}
}

122 
	$›us_£À˘_¨ch
()

124 
CPU_Fótuª
 
˝u_„©uª
;

125 
¨ch
;

127 
	`›us_˝u_„©uª_check
(&
˝u_„©uª
);

129 
¨ch
 = 0;

130 i‡(!
˝u_„©uª
.
HW_SSE
)

132  
¨ch
;

134 
¨ch
++;

136 i‡(!
˝u_„©uª
.
HW_SSE2
)

138  
¨ch
;

140 
¨ch
++;

142 i‡(!
˝u_„©uª
.
HW_SSE41
)

144  
¨ch
;

146 
¨ch
++;

148 i‡(!
˝u_„©uª
.
HW_AVX
)

150  
¨ch
;

152 
¨ch
++;

154  
¨ch
;

155 
	}
}

	@celt/x86/x86cpu.h

28 #i‡!
deföed
(
X86CPU_H
)

29 
	#X86CPU_H


	)

31 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE
)

32 
	#MAY_HAVE_SSE
(
«me
Ë«mê## 
_s£


	)

34 
	#MAY_HAVE_SSE
(
«me
Ë«mê## 
_c


	)

37 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE2
)

38 
	#MAY_HAVE_SSE2
(
«me
Ë«mê## 
_s£2


	)

40 
	#MAY_HAVE_SSE2
(
«me
Ë«mê## 
_c


	)

43 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

44 
	#MAY_HAVE_SSE4_1
(
«me
Ë«mê## 
_s£4_1


	)

46 
	#MAY_HAVE_SSE4_1
(
«me
Ë«mê## 
_c


	)

49 #i‡
deföed
(
OPUS_X86_MAY_HAVE_AVX
)

50 
	#MAY_HAVE_AVX
(
«me
Ë«mê## 
_avx


	)

52 
	#MAY_HAVE_AVX
(
«me
Ë«mê## 
_c


	)

55 #i‡
deföed
(
OPUS_HAVE_RTCD
)

56 
›us_£À˘_¨ch
();

77 #i‡
deföed
(
__˛™g__
Ë|| !deföed(
__OPTIMIZE__
)

78 
	#OP_CVTEPI8_EPI32_M32
(
x
) \

79 (
	`_mm_cvãpi8_ïi32
(
	`_mm_cvtsi32_si128
(*(*)(
x
))))

	)

81 
	#OP_CVTEPI8_EPI32_M32
(
x
) \

82 (
	`_mm_cvãpi8_ïi32
(*(
__m128i
 *)(
x
)))

	)

87 #i‡
deföed
(
__˛™g__
Ë|| !deföed(
__OPTIMIZE__
)

88 
	#OP_CVTEPI16_EPI32_M64
(
x
) \

89 (
	`_mm_cvãpi16_ïi32
(
	`_mm_lﬂdl_ïi64
((
__m128i
 *)(
x
))))

	)

91 
	#OP_CVTEPI16_EPI32_M64
(
x
) \

92 (
	`_mm_cvãpi16_ïi32
(*(
__m128i
 *)(
x
)))

	)

	@doc/trivial_example.c

32 
	~<°dlib.h
>

33 
	~<î∫o.h
>

34 
	~<°rög.h
>

35 
	~<›us.h
>

36 
	~<°dio.h
>

39 
	#FRAME_SIZE
 960

	)

40 
	#SAMPLE_RATE
 48000

	)

41 
	#CHANNELS
 2

	)

42 
	#APPLICATION
 
OPUS_APPLICATION_AUDIO


	)

43 
	#BITRATE
 64000

	)

45 
	#MAX_FRAME_SIZE
 6*960

	)

46 
	#MAX_PACKET_SIZE
 (3*1276)

	)

48 
	$maö
(
¨gc
, **
¨gv
)

50 *
öFûe
;

51 
FILE
 *
fö
;

52 *
outFûe
;

53 
FILE
 *
fout
;

54 
›us_öt16
 
ö
[
FRAME_SIZE
*
CHANNELS
];

55 
›us_öt16
 
out
[
MAX_FRAME_SIZE
*
CHANNELS
];

56 
cbôs
[
MAX_PACKET_SIZE
];

57 
nbByãs
;

59 
OpusEncodî
 *
ícodî
;

60 
OpusDecodî
 *
decodî
;

61 
îr
;

63 i‡(
¨gc
 != 3)

65 
	`Ârötf
(
°dîr
, "usage:Årivial_example input.pcm output.pcm\n");

66 
	`Ârötf
(
°dîr
, "inputánd outputáre 16-bitÜittle-endianÑaw files\n");

67  
EXIT_FAILURE
;

71 
ícodî
 = 
	`›us_ícodî_¸óã
(
SAMPLE_RATE
, 
CHANNELS
, 
APPLICATION
, &
îr
);

72 i‡(
îr
<0)

74 
	`Ârötf
(
°dîr
, "ÁûedÅÿ¸óãá¿ícodî: %s\n", 
	`›us_°ªº‹
(
îr
));

75  
EXIT_FAILURE
;

81 
îr
 = 
	`›us_ícodî_˘l
(
ícodî
, 
	`OPUS_SET_BITRATE
(
BITRATE
));

82 i‡(
îr
<0)

84 
	`Ârötf
(
°dîr
, "ÁûedÅÿ£àbôøã: %s\n", 
	`›us_°ªº‹
(
îr
));

85  
EXIT_FAILURE
;

87 
öFûe
 = 
¨gv
[1];

88 
fö
 = 
	`f›í
(
öFûe
, "r");

89 i‡(
fö
==
NULL
)

91 
	`Ârötf
(
°dîr
, "ÁûedÅÿ›í i≈uàfûe: %s\n", 
	`°ªº‹
(
î∫o
));

92  
EXIT_FAILURE
;

97 
decodî
 = 
	`›us_decodî_¸óã
(
SAMPLE_RATE
, 
CHANNELS
, &
îr
);

98 i‡(
îr
<0)

100 
	`Ârötf
(
°dîr
, "ÁûedÅÿ¸óã decodî: %s\n", 
	`›us_°ªº‹
(
îr
));

101  
EXIT_FAILURE
;

103 
outFûe
 = 
¨gv
[2];

104 
fout
 = 
	`f›í
(
outFûe
, "w");

105 i‡(
fout
==
NULL
)

107 
	`Ârötf
(
°dîr
, "ÁûedÅÿ›í ouçuàfûe: %s\n", 
	`°ªº‹
(
î∫o
));

108  
EXIT_FAILURE
;

113 
i
;

114 
pcm_byãs
[
MAX_FRAME_SIZE
*
CHANNELS
*2];

115 
‰ame_size
;

118 
	`‰ód
(
pcm_byãs
, ()*
CHANNELS
, 
FRAME_SIZE
, 
fö
);

119 i‡(
	`„of
(
fö
))

122 
i
=0;i<
CHANNELS
*
FRAME_SIZE
;i++)

123 
ö
[
i
]=
pcm_byãs
[2*i+1]<<8|pcm_bytes[2*i];

126 
nbByãs
 = 
	`›us_ícode
(
ícodî
, 
ö
, 
FRAME_SIZE
, 
cbôs
, 
MAX_PACKET_SIZE
);

127 i‡(
nbByãs
<0)

129 
	`Ârötf
(
°dîr
, "ícodêÁûed: %s\n", 
	`›us_°ªº‹
(
nbByãs
));

130  
EXIT_FAILURE
;

138 
‰ame_size
 = 
	`›us_decode
(
decodî
, 
cbôs
, 
nbByãs
, 
out
, 
MAX_FRAME_SIZE
, 0);

139 i‡(
‰ame_size
<0)

141 
	`Ârötf
(
°dîr
, "decodî faûed: %s\n", 
	`›us_°ªº‹
(
‰ame_size
));

142  
EXIT_FAILURE
;

146 
i
=0;i<
CHANNELS
*
‰ame_size
;i++)

148 
pcm_byãs
[2*
i
]=
out
[i]&0xFF;

149 
pcm_byãs
[2*
i
+1]=(
out
[i]>>8)&0xFF;

152 
	`fwrôe
(
pcm_byãs
, (), 
‰ame_size
*
CHANNELS
, 
fout
);

155 
	`›us_ícodî_de°roy
(
ícodî
);

156 
	`›us_decodî_de°roy
(
decodî
);

157 
	`f˛o£
(
fö
);

158 
	`f˛o£
(
fout
);

159  
EXIT_SUCCESS
;

160 
	}
}

	@include/opus.h

33 #i‚de‡
OPUS_H


34 
	#OPUS_H


	)

36 
	~"›us_ty≥s.h
"

37 
	~"›us_deföes.h
"

39 #ifde‡
__˝lu•lus


164 
OpusEncodî
 
	tOpusEncodî
;

171 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_ícodî_gë_size
(
ch™√ls
);

208 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusEncodî
 *
›us_ícodî_¸óã
(

209 
›us_öt32
 
Fs
,

210 
ch™√ls
,

211 
≠∂iˇti⁄
,

212 *
îr‹


228 
OPUS_EXPORT
 
›us_ícodî_öô
(

229 
OpusEncodî
 *
°
,

230 
›us_öt32
 
Fs
,

231 
ch™√ls
,

232 
≠∂iˇti⁄


233 Ë
OPUS_ARG_NONNULL
(1);

263 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_ícode
(

264 
OpusEncodî
 *
°
,

265 c⁄° 
›us_öt16
 *
pcm
,

266 
‰ame_size
,

267 *
d©a
,

268 
›us_öt32
 
max_d©a_byãs


269 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

304 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_ícode_Êﬂt
(

305 
OpusEncodî
 *
°
,

306 c⁄° *
pcm
,

307 
‰ame_size
,

308 *
d©a
,

309 
›us_öt32
 
max_d©a_byãs


310 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

315 
OPUS_EXPORT
 
›us_ícodî_de°roy
(
OpusEncodî
 *
°
);

328 
OPUS_EXPORT
 
›us_ícodî_˘l
(
OpusEncodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

399 
OpusDecodî
 
	tOpusDecodî
;

406 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_decodî_gë_size
(
ch™√ls
);

423 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusDecodî
 *
›us_decodî_¸óã
(

424 
›us_öt32
 
Fs
,

425 
ch™√ls
,

426 *
îr‹


440 
OPUS_EXPORT
 
›us_decodî_öô
(

441 
OpusDecodî
 *
°
,

442 
›us_öt32
 
Fs
,

443 
ch™√ls


444 Ë
OPUS_ARG_NONNULL
(1);

462 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_decode
(

463 
OpusDecodî
 *
°
,

464 c⁄° *
d©a
,

465 
›us_öt32
 
Àn
,

466 
›us_öt16
 *
pcm
,

467 
‰ame_size
,

468 
decode_„c


469 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

487 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_decode_Êﬂt
(

488 
OpusDecodî
 *
°
,

489 c⁄° *
d©a
,

490 
›us_öt32
 
Àn
,

491 *
pcm
,

492 
‰ame_size
,

493 
decode_„c


494 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

507 
OPUS_EXPORT
 
›us_decodî_˘l
(
OpusDecodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

512 
OPUS_EXPORT
 
›us_decodî_de°roy
(
OpusDecodî
 *
°
);

527 
OPUS_EXPORT
 
›us_∑ckë_∑r£
(

528 c⁄° *
d©a
,

529 
›us_öt32
 
Àn
,

530 *
out_toc
,

531 c⁄° *
‰ames
[48],

532 
›us_öt16
 
size
[48],

533 *
∑ylﬂd_off£t


534 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(5);

545 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_∑ckë_gë_b™dwidth
(c⁄° *
d©a
Ë
OPUS_ARG_NONNULL
(1);

556 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_∑ckë_gë_ßm∂es_≥r_‰ame
(c⁄° *
d©a
, 
›us_öt32
 
Fs
Ë
OPUS_ARG_NONNULL
(1);

563 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_∑ckë_gë_nb_ch™√ls
(c⁄° *
d©a
Ë
OPUS_ARG_NONNULL
(1);

572 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_∑ckë_gë_nb_‰ames
(c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
Ë
OPUS_ARG_NONNULL
(1);

584 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_∑ckë_gë_nb_ßm∂es
(c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
, opus_öt32 
Fs
Ë
OPUS_ARG_NONNULL
(1);

594 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_decodî_gë_nb_ßm∂es
(c⁄° 
OpusDecodî
 *
dec
, c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2);

606 
OPUS_EXPORT
 
›us_pcm_so·_˛ù
(*
pcm
, 
‰ame_size
, 
ch™√ls
, *
so·˛ù_mem
);

754 
OpusRïackëizî
 
	tOpusRïackëizî
;

759 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_ª∑ckëizî_gë_size
();

778 
OPUS_EXPORT
 
OpusRïackëizî
 *
›us_ª∑ckëizî_öô
(OpusRïackëizî *
Ω
Ë
OPUS_ARG_NONNULL
(1);

783 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusRïackëizî
 *
›us_ª∑ckëizî_¸óã
();

789 
OPUS_EXPORT
 
›us_ª∑ckëizî_de°roy
(
OpusRïackëizî
 *
Ω
);

838 
OPUS_EXPORT
 
›us_ª∑ckëizî_ˇt
(
OpusRïackëizî
 *
Ω
, c⁄° *
d©a
, 
›us_öt32
 
Àn
Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2);

872 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_ª∑ckëizî_out_ønge
(
OpusRïackëizî
 *
Ω
, 
begö
, 
íd
, *
d©a
, opus_öt32 
maxÀn
Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

884 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_ª∑ckëizî_gë_nb_‰ames
(
OpusRïackëizî
 *
Ω
Ë
OPUS_ARG_NONNULL
(1);

915 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_ª∑ckëizî_out
(
OpusRïackëizî
 *
Ω
, *
d©a
, opus_öt32 
maxÀn
Ë
OPUS_ARG_NONNULL
(1);

929 
OPUS_EXPORT
 
›us_∑ckë_∑d
(*
d©a
, 
›us_öt32
 
Àn
, opus_öt32 
√w_Àn
);

942 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_∑ckë_u≈ad
(*
d©a
, opus_öt32 
Àn
);

958 
OPUS_EXPORT
 
›us_mu…i°ªam_∑ckë_∑d
(*
d©a
, 
›us_öt32
 
Àn
, opus_öt32 
√w_Àn
, 
nb_°ªams
);

973 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_mu…i°ªam_∑ckë_u≈ad
(*
d©a
, opus_öt32 
Àn
, 
nb_°ªams
);

977 #ifde‡
__˝lu•lus


	@include/opus_custom.h

35 #i‚de‡
OPUS_CUSTOM_H


36 
	#OPUS_CUSTOM_H


	)

38 
	~"›us_deföes.h
"

40 #ifde‡
__˝lu•lus


44 #ifde‡
CUSTOM_MODES


45 
	#OPUS_CUSTOM_EXPORT
 
OPUS_EXPORT


	)

46 
	#OPUS_CUSTOM_EXPORT_STATIC
 
OPUS_EXPORT


	)

48 
	#OPUS_CUSTOM_EXPORT


	)

49 #ifde‡
OPUS_BUILD


50 
	#OPUS_CUSTOM_EXPORT_STATIC
 
OPUS_INLINE


	)

52 
	#OPUS_CUSTOM_EXPORT_STATIC


	)

95 
OpusCu°omEncodî
 
	tOpusCu°omEncodî
;

102 
OpusCu°omDecodî
 
	tOpusCu°omDecodî
;

110 
OpusCu°omMode
 
	tOpusCu°omMode
;

121 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusCu°omMode
 *
›us_cu°om_mode_¸óã
(
›us_öt32
 
Fs
, 
‰ame_size
, *
îr‹
);

127 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_mode_de°roy
(
OpusCu°omMode
 *
mode
);

130 #i‡!
deföed
(
OPUS_BUILD
Ë|| deföed(
CELT_ENCODER_C
)

138 
OPUS_CUSTOM_EXPORT_STATIC
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_ícodî_gë_size
(

139 c⁄° 
OpusCu°omMode
 *
mode
,

140 
ch™√ls


141 Ë
OPUS_ARG_NONNULL
(1);

143 #ifde‡
CUSTOM_MODES


156 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_ícodî_öô
(

157 
OpusCu°omEncodî
 *
°
,

158 c⁄° 
OpusCu°omMode
 *
mode
,

159 
ch™√ls


160 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2);

174 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusCu°omEncodî
 *
›us_cu°om_ícodî_¸óã
(

175 c⁄° 
OpusCu°omMode
 *
mode
,

176 
ch™√ls
,

177 *
îr‹


178 Ë
OPUS_ARG_NONNULL
(1);

184 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_ícodî_de°roy
(
OpusCu°omEncodî
 *
°
);

203 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_ícode_Êﬂt
(

204 
OpusCu°omEncodî
 *
°
,

205 c⁄° *
pcm
,

206 
‰ame_size
,

207 *
com¥es£d
,

208 
maxCom¥es£dByãs


209 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

224 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_ícode
(

225 
OpusCu°omEncodî
 *
°
,

226 c⁄° 
›us_öt16
 *
pcm
,

227 
‰ame_size
,

228 *
com¥es£d
,

229 
maxCom¥es£dByãs


230 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

238 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_ícodî_˘l
(
OpusCu°omEncodî
 * 
OPUS_RESTRICT
 
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

241 #i‡!
deföed
(
OPUS_BUILD
Ë|| deföed(
CELT_DECODER_C
)

249 
OPUS_CUSTOM_EXPORT_STATIC
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_decodî_gë_size
(

250 c⁄° 
OpusCu°omMode
 *
mode
,

251 
ch™√ls


252 Ë
OPUS_ARG_NONNULL
(1);

266 
OPUS_CUSTOM_EXPORT_STATIC
 
›us_cu°om_decodî_öô
(

267 
OpusCu°omDecodî
 *
°
,

268 c⁄° 
OpusCu°omMode
 *
mode
,

269 
ch™√ls


270 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2);

283 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusCu°omDecodî
 *
›us_cu°om_decodî_¸óã
(

284 c⁄° 
OpusCu°omMode
 *
mode
,

285 
ch™√ls
,

286 *
îr‹


287 Ë
OPUS_ARG_NONNULL
(1);

292 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_decodî_de°roy
(
OpusCu°omDecodî
 *
°
);

303 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_decode_Êﬂt
(

304 
OpusCu°omDecodî
 *
°
,

305 c⁄° *
d©a
,

306 
Àn
,

307 *
pcm
,

308 
‰ame_size


309 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

320 
OPUS_CUSTOM_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_cu°om_decode
(

321 
OpusCu°omDecodî
 *
°
,

322 c⁄° *
d©a
,

323 
Àn
,

324 
›us_öt16
 *
pcm
,

325 
‰ame_size


326 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

334 
OPUS_CUSTOM_EXPORT
 
›us_cu°om_decodî_˘l
(
OpusCu°omDecodî
 * 
OPUS_RESTRICT
 
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

338 #ifde‡
__˝lu•lus


	@include/opus_defines.h

33 #i‚de‡
OPUS_DEFINES_H


34 
	#OPUS_DEFINES_H


	)

36 
	~"›us_ty≥s.h
"

38 #ifde‡
__˝lu•lus


46 
	#OPUS_OK
 0

	)

48 
	#OPUS_BAD_ARG
 -1

	)

50 
	#OPUS_BUFFER_TOO_SMALL
 -2

	)

52 
	#OPUS_INTERNAL_ERROR
 -3

	)

54 
	#OPUS_INVALID_PACKET
 -4

	)

56 
	#OPUS_UNIMPLEMENTED
 -5

	)

58 
	#OPUS_INVALID_STATE
 -6

	)

60 
	#OPUS_ALLOC_FAIL
 -7

	)

66 #i‚de‡
OPUS_EXPORT


67 #i‡
deföed
(
WIN32
)

68 #i‡
deföed
(
OPUS_BUILD
Ë&& deföed(
DLL_EXPORT
)

69 
	#OPUS_EXPORT
 
	`__de˛•ec
(
dŒexp‹t
)

	)

71 
	#OPUS_EXPORT


	)

73 #ñi‡
deföed
(
__GNUC__
Ë&& deföed(
OPUS_BUILD
)

74 
	#OPUS_EXPORT
 
	`__©åibuã__
 ((
	`visibûôy
 ("deÁu…")))

	)

76 
	#OPUS_EXPORT


	)

80 #i‡!
deföed
(
OPUS_GNUC_PREREQ
)

81 #i‡
deföed
(
__GNUC__
)&&deföed(
__GNUC_MINOR__
)

82 
	#OPUS_GNUC_PREREQ
(
_maj
,
_mö
) \

83 ((
__GNUC__
<<16)+
__GNUC_MINOR__
>=((
_maj
)<<16)+(
_mö
))

	)

85 
	#OPUS_GNUC_PREREQ
(
_maj
,
_mö
Ë0

	)

89 #i‡(!
deföed
(
__STDC_VERSION__
) || (__STDC_VERSION__ < 199901L) )

90 #i‡
OPUS_GNUC_PREREQ
(3,0)

91 
	#OPUS_RESTRICT
 
__ª°ri˘__


	)

92 #ñi‡(
deföed
(
_MSC_VER
) && _MSC_VER >= 1400)

93 
	#OPUS_RESTRICT
 
__ª°ri˘


	)

95 
	#OPUS_RESTRICT


	)

98 
	#OPUS_RESTRICT
 
ª°ri˘


	)

101 #i‡(!
deföed
(
__STDC_VERSION__
) || (__STDC_VERSION__ < 199901L) )

102 #i‡
OPUS_GNUC_PREREQ
(2,7)

103 
	#OPUS_INLINE
 
__ölöe__


	)

104 #ñi‡(
deföed
(
_MSC_VER
))

105 
	#OPUS_INLINE
 
__ölöe


	)

107 
	#OPUS_INLINE


	)

110 
	#OPUS_INLINE
 
ölöe


	)

116 #i‡
deföed
(
__GNUC__
Ë&& 
OPUS_GNUC_PREREQ
(3, 4)

117 
	#OPUS_WARN_UNUSED_RESULT
 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

119 
	#OPUS_WARN_UNUSED_RESULT


	)

121 #i‡!
deföed
(
OPUS_BUILD
Ë&& deföed(
__GNUC__
Ë&& 
OPUS_GNUC_PREREQ
(3, 4)

122 
	#OPUS_ARG_NONNULL
(
_x
Ë
	`__©åibuã__
 ((
	`__n⁄nuŒ__
(_x)))

	)

124 
	#OPUS_ARG_NONNULL
(
_x
)

	)

130 
	#OPUS_SET_APPLICATION_REQUEST
 4000

	)

131 
	#OPUS_GET_APPLICATION_REQUEST
 4001

	)

132 
	#OPUS_SET_BITRATE_REQUEST
 4002

	)

133 
	#OPUS_GET_BITRATE_REQUEST
 4003

	)

134 
	#OPUS_SET_MAX_BANDWIDTH_REQUEST
 4004

	)

135 
	#OPUS_GET_MAX_BANDWIDTH_REQUEST
 4005

	)

136 
	#OPUS_SET_VBR_REQUEST
 4006

	)

137 
	#OPUS_GET_VBR_REQUEST
 4007

	)

138 
	#OPUS_SET_BANDWIDTH_REQUEST
 4008

	)

139 
	#OPUS_GET_BANDWIDTH_REQUEST
 4009

	)

140 
	#OPUS_SET_COMPLEXITY_REQUEST
 4010

	)

141 
	#OPUS_GET_COMPLEXITY_REQUEST
 4011

	)

142 
	#OPUS_SET_INBAND_FEC_REQUEST
 4012

	)

143 
	#OPUS_GET_INBAND_FEC_REQUEST
 4013

	)

144 
	#OPUS_SET_PACKET_LOSS_PERC_REQUEST
 4014

	)

145 
	#OPUS_GET_PACKET_LOSS_PERC_REQUEST
 4015

	)

146 
	#OPUS_SET_DTX_REQUEST
 4016

	)

147 
	#OPUS_GET_DTX_REQUEST
 4017

	)

148 
	#OPUS_SET_VBR_CONSTRAINT_REQUEST
 4020

	)

149 
	#OPUS_GET_VBR_CONSTRAINT_REQUEST
 4021

	)

150 
	#OPUS_SET_FORCE_CHANNELS_REQUEST
 4022

	)

151 
	#OPUS_GET_FORCE_CHANNELS_REQUEST
 4023

	)

152 
	#OPUS_SET_SIGNAL_REQUEST
 4024

	)

153 
	#OPUS_GET_SIGNAL_REQUEST
 4025

	)

154 
	#OPUS_GET_LOOKAHEAD_REQUEST
 4027

	)

156 
	#OPUS_GET_SAMPLE_RATE_REQUEST
 4029

	)

157 
	#OPUS_GET_FINAL_RANGE_REQUEST
 4031

	)

158 
	#OPUS_GET_PITCH_REQUEST
 4033

	)

159 
	#OPUS_SET_GAIN_REQUEST
 4034

	)

160 
	#OPUS_GET_GAIN_REQUEST
 4045

	)

161 
	#OPUS_SET_LSB_DEPTH_REQUEST
 4036

	)

162 
	#OPUS_GET_LSB_DEPTH_REQUEST
 4037

	)

163 
	#OPUS_GET_LAST_PACKET_DURATION_REQUEST
 4039

	)

164 
	#OPUS_SET_EXPERT_FRAME_DURATION_REQUEST
 4040

	)

165 
	#OPUS_GET_EXPERT_FRAME_DURATION_REQUEST
 4041

	)

166 
	#OPUS_SET_PREDICTION_DISABLED_REQUEST
 4042

	)

167 
	#OPUS_GET_PREDICTION_DISABLED_REQUEST
 4043

	)

169 
	#OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
 4046

	)

170 
	#OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
 4047

	)

171 
	#OPUS_GET_IN_DTX_REQUEST
 4049

	)

174 
	#OPUS_HAVE_OPUS_PROJECTION_H


	)

177 
	#__›us_check_öt
(
x
Ë((()((xË=(
›us_öt32
)0)), (›us_öt32)(x))

	)

178 
	#__›us_check_öt_±r
(
±r
Ë(’åË+ (’åË- (
›us_öt32
*)’å)))

	)

179 
	#__›us_check_uöt_±r
(
±r
Ë(’åË+ (’åË- (
›us_uöt32
*)’å)))

	)

180 
	#__›us_check_vÆ16_±r
(
±r
Ë(’åË+ (’åË- (
›us_vÆ16
*)’å)))

	)

188 
	#OPUS_AUTO
 -1000

	)

189 
	#OPUS_BITRATE_MAX
 -1

	)

193 
	#OPUS_APPLICATION_VOIP
 2048

	)

196 
	#OPUS_APPLICATION_AUDIO
 2049

	)

199 
	#OPUS_APPLICATION_RESTRICTED_LOWDELAY
 2051

	)

201 
	#OPUS_SIGNAL_VOICE
 3001

	)

202 
	#OPUS_SIGNAL_MUSIC
 3002

	)

203 
	#OPUS_BANDWIDTH_NARROWBAND
 1101

	)

204 
	#OPUS_BANDWIDTH_MEDIUMBAND
 1102

	)

205 
	#OPUS_BANDWIDTH_WIDEBAND
 1103

	)

206 
	#OPUS_BANDWIDTH_SUPERWIDEBAND
 1104

	)

207 
	#OPUS_BANDWIDTH_FULLBAND
 1105

	)

209 
	#OPUS_FRAMESIZE_ARG
 5000

	)

210 
	#OPUS_FRAMESIZE_2_5_MS
 5001

	)

211 
	#OPUS_FRAMESIZE_5_MS
 5002

	)

212 
	#OPUS_FRAMESIZE_10_MS
 5003

	)

213 
	#OPUS_FRAMESIZE_20_MS
 5004

	)

214 
	#OPUS_FRAMESIZE_40_MS
 5005

	)

215 
	#OPUS_FRAMESIZE_60_MS
 5006

	)

216 
	#OPUS_FRAMESIZE_80_MS
 5007

	)

217 
	#OPUS_FRAMESIZE_100_MS
 5008

	)

218 
	#OPUS_FRAMESIZE_120_MS
 5009

	)

253 
	#OPUS_SET_COMPLEXITY
(
x
Ë
OPUS_SET_COMPLEXITY_REQUEST
, 
	`__›us_check_öt
(x)

	)

259 
	#OPUS_GET_COMPLEXITY
(
x
Ë
OPUS_GET_COMPLEXITY_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

272 
	#OPUS_SET_BITRATE
(
x
Ë
OPUS_SET_BITRATE_REQUEST
, 
	`__›us_check_öt
(x)

	)

280 
	#OPUS_GET_BITRATE
(
x
Ë
OPUS_GET_BITRATE_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

295 
	#OPUS_SET_VBR
(
x
Ë
OPUS_SET_VBR_REQUEST
, 
	`__›us_check_öt
(x)

	)

306 
	#OPUS_GET_VBR
(
x
Ë
OPUS_GET_VBR_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

324 
	#OPUS_SET_VBR_CONSTRAINT
(
x
Ë
OPUS_SET_VBR_CONSTRAINT_REQUEST
, 
	`__›us_check_öt
(x)

	)

334 
	#OPUS_GET_VBR_CONSTRAINT
(
x
Ë
OPUS_GET_VBR_CONSTRAINT_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

349 
	#OPUS_SET_FORCE_CHANNELS
(
x
Ë
OPUS_SET_FORCE_CHANNELS_REQUEST
, 
	`__›us_check_öt
(x)

	)

359 
	#OPUS_GET_FORCE_CHANNELS
(
x
Ë
OPUS_GET_FORCE_CHANNELS_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

377 
	#OPUS_SET_MAX_BANDWIDTH
(
x
Ë
OPUS_SET_MAX_BANDWIDTH_REQUEST
, 
	`__›us_check_öt
(x)

	)

390 
	#OPUS_GET_MAX_BANDWIDTH
(
x
Ë
OPUS_GET_MAX_BANDWIDTH_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

409 
	#OPUS_SET_BANDWIDTH
(
x
Ë
OPUS_SET_BANDWIDTH_REQUEST
, 
	`__›us_check_öt
(x)

	)

421 
	#OPUS_SET_SIGNAL
(
x
Ë
OPUS_SET_SIGNAL_REQUEST
, 
	`__›us_check_öt
(x)

	)

431 
	#OPUS_GET_SIGNAL
(
x
Ë
OPUS_GET_SIGNAL_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

448 
	#OPUS_SET_APPLICATION
(
x
Ë
OPUS_SET_APPLICATION_REQUEST
, 
	`__›us_check_öt
(x)

	)

462 
	#OPUS_GET_APPLICATION
(
x
Ë
OPUS_GET_APPLICATION_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

477 
	#OPUS_GET_LOOKAHEAD
(
x
Ë
OPUS_GET_LOOKAHEAD_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

488 
	#OPUS_SET_INBAND_FEC
(
x
Ë
OPUS_SET_INBAND_FEC_REQUEST
, 
	`__›us_check_öt
(x)

	)

497 
	#OPUS_GET_INBAND_FEC
(
x
Ë
OPUS_GET_INBAND_FEC_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

506 
	#OPUS_SET_PACKET_LOSS_PERC
(
x
Ë
OPUS_SET_PACKET_LOSS_PERC_REQUEST
, 
	`__›us_check_öt
(x)

	)

512 
	#OPUS_GET_PACKET_LOSS_PERC
(
x
Ë
OPUS_GET_PACKET_LOSS_PERC_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

523 
	#OPUS_SET_DTX
(
x
Ë
OPUS_SET_DTX_REQUEST
, 
	`__›us_check_öt
(x)

	)

532 
	#OPUS_GET_DTX
(
x
Ë
OPUS_GET_DTX_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

551 
	#OPUS_SET_LSB_DEPTH
(
x
Ë
OPUS_SET_LSB_DEPTH_REQUEST
, 
	`__›us_check_öt
(x)

	)

557 
	#OPUS_GET_LSB_DEPTH
(
x
Ë
OPUS_GET_LSB_DEPTH_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

582 
	#OPUS_SET_EXPERT_FRAME_DURATION
(
x
Ë
OPUS_SET_EXPERT_FRAME_DURATION_REQUEST
, 
	`__›us_check_öt
(x)

	)

599 
	#OPUS_GET_EXPERT_FRAME_DURATION
(
x
Ë
OPUS_GET_EXPERT_FRAME_DURATION_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

610 
	#OPUS_SET_PREDICTION_DISABLED
(
x
Ë
OPUS_SET_PREDICTION_DISABLED_REQUEST
, 
	`__›us_check_öt
(x)

	)

619 
	#OPUS_GET_PREDICTION_DISABLED
(
x
Ë
OPUS_GET_PREDICTION_DISABLED_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

662 
	#OPUS_RESET_STATE
 4028

	)

672 
	#OPUS_GET_FINAL_RANGE
(
x
Ë
OPUS_GET_FINAL_RANGE_REQUEST
, 
	`__›us_check_uöt_±r
(x)

	)

686 
	#OPUS_GET_BANDWIDTH
(
x
Ë
OPUS_GET_BANDWIDTH_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

694 
	#OPUS_GET_SAMPLE_RATE
(
x
Ë
OPUS_GET_SAMPLE_RATE_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

709 
	#OPUS_SET_PHASE_INVERSION_DISABLED
(
x
Ë
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
, 
	`__›us_check_öt
(x)

	)

718 
	#OPUS_GET_PHASE_INVERSION_DISABLED
(
x
Ë
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

728 
	#OPUS_GET_IN_DTX
(
x
Ë
OPUS_GET_IN_DTX_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

747 
	#OPUS_SET_GAIN
(
x
Ë
OPUS_SET_GAIN_REQUEST
, 
	`__›us_check_öt
(x)

	)

752 
	#OPUS_GET_GAIN
(
x
Ë
OPUS_GET_GAIN_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

757 
	#OPUS_GET_LAST_PACKET_DURATION
(
x
Ë
OPUS_GET_LAST_PACKET_DURATION_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

769 
	#OPUS_GET_PITCH
(
x
Ë
OPUS_GET_PITCH_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

782 
OPUS_EXPORT
 c⁄° *
›us_°ªº‹
(
îr‹
);

792 
OPUS_EXPORT
 c⁄° *
›us_gë_vîsi⁄_°rög
();

795 #ifde‡
__˝lu•lus


	@include/opus_multistream.h

33 #i‚de‡
OPUS_MULTISTREAM_H


34 
	#OPUS_MULTISTREAM_H


	)

36 
	~"›us.h
"

38 #ifde‡
__˝lu•lus


47 
	#__›us_check_íc°©e_±r
(
±r
Ë(’åË+ (’åË- (
OpusEncodî
**)’å)))

	)

48 
	#__›us_check_dec°©e_±r
(
±r
Ë(’åË+ (’åË- (
OpusDecodî
**)’å)))

	)

55 
	#OPUS_MULTISTREAM_GET_ENCODER_STATE_REQUEST
 5120

	)

56 
	#OPUS_MULTISTREAM_GET_DECODER_STATE_REQUEST
 5122

	)

86 
	#OPUS_MULTISTREAM_GET_ENCODER_STATE
(
x
,
y
Ë
OPUS_MULTISTREAM_GET_ENCODER_STATE_REQUEST
, 
	`__›us_check_öt
(x), 
	`__›us_check_íc°©e_±r
(y)

	)

99 
	#OPUS_MULTISTREAM_GET_DECODER_STATE
(
x
,
y
Ë
OPUS_MULTISTREAM_GET_DECODER_STATE_REQUEST
, 
	`__›us_check_öt
(x), 
	`__›us_check_dec°©e_±r
(y)

	)

175 
OpusMSEncodî
 
	tOpusMSEncodî
;

183 
OpusMSDecodî
 
	tOpusMSDecodî
;

203 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_mu…i°ªam_ícodî_gë_size
(

204 
°ªams
,

205 
cou∂ed_°ªams


208 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_mu…i°ªam_suºound_ícodî_gë_size
(

209 
ch™√ls
,

210 
m≠pög_Ámûy


257 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusMSEncodî
 *
›us_mu…i°ªam_ícodî_¸óã
(

258 
›us_öt32
 
Fs
,

259 
ch™√ls
,

260 
°ªams
,

261 
cou∂ed_°ªams
,

262 c⁄° *
m≠pög
,

263 
≠∂iˇti⁄
,

264 *
îr‹


265 Ë
OPUS_ARG_NONNULL
(5);

267 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusMSEncodî
 *
›us_mu…i°ªam_suºound_ícodî_¸óã
(

268 
›us_öt32
 
Fs
,

269 
ch™√ls
,

270 
m≠pög_Ámûy
,

271 *
°ªams
,

272 *
cou∂ed_°ªams
,

273 *
m≠pög
,

274 
≠∂iˇti⁄
,

275 *
îr‹


276 Ë
OPUS_ARG_NONNULL
(4) OPUS_ARG_NONNULL(5) OPUS_ARG_NONNULL(6);

326 
OPUS_EXPORT
 
›us_mu…i°ªam_ícodî_öô
(

327 
OpusMSEncodî
 *
°
,

328 
›us_öt32
 
Fs
,

329 
ch™√ls
,

330 
°ªams
,

331 
cou∂ed_°ªams
,

332 c⁄° *
m≠pög
,

333 
≠∂iˇti⁄


334 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(6);

336 
OPUS_EXPORT
 
›us_mu…i°ªam_suºound_ícodî_öô
(

337 
OpusMSEncodî
 *
°
,

338 
›us_öt32
 
Fs
,

339 
ch™√ls
,

340 
m≠pög_Ámûy
,

341 *
°ªams
,

342 *
cou∂ed_°ªams
,

343 *
m≠pög
,

344 
≠∂iˇti⁄


345 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(5) OPUS_ARG_NONNULL(6) OPUS_ARG_NONNULL(7);

377 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_mu…i°ªam_ícode
(

378 
OpusMSEncodî
 *
°
,

379 c⁄° 
›us_öt16
 *
pcm
,

380 
‰ame_size
,

381 *
d©a
,

382 
›us_öt32
 
max_d©a_byãs


383 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

422 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_mu…i°ªam_ícode_Êﬂt
(

423 
OpusMSEncodî
 *
°
,

424 c⁄° *
pcm
,

425 
‰ame_size
,

426 *
d©a
,

427 
›us_öt32
 
max_d©a_byãs


428 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

434 
OPUS_EXPORT
 
›us_mu…i°ªam_ícodî_de°roy
(
OpusMSEncodî
 *
°
);

448 
OPUS_EXPORT
 
›us_mu…i°ªam_ícodî_˘l
(
OpusMSEncodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

470 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_mu…i°ªam_decodî_gë_size
(

471 
°ªams
,

472 
cou∂ed_°ªams


504 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusMSDecodî
 *
›us_mu…i°ªam_decodî_¸óã
(

505 
›us_öt32
 
Fs
,

506 
ch™√ls
,

507 
°ªams
,

508 
cou∂ed_°ªams
,

509 c⁄° *
m≠pög
,

510 *
îr‹


511 Ë
OPUS_ARG_NONNULL
(5);

547 
OPUS_EXPORT
 
›us_mu…i°ªam_decodî_öô
(

548 
OpusMSDecodî
 *
°
,

549 
›us_öt32
 
Fs
,

550 
ch™√ls
,

551 
°ªams
,

552 
cou∂ed_°ªams
,

553 c⁄° *
m≠pög


554 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(6);

585 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_mu…i°ªam_decode
(

586 
OpusMSDecodî
 *
°
,

587 c⁄° *
d©a
,

588 
›us_öt32
 
Àn
,

589 
›us_öt16
 *
pcm
,

590 
‰ame_size
,

591 
decode_„c


592 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

623 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_mu…i°ªam_decode_Êﬂt
(

624 
OpusMSDecodî
 *
°
,

625 c⁄° *
d©a
,

626 
›us_öt32
 
Àn
,

627 *
pcm
,

628 
‰ame_size
,

629 
decode_„c


630 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

644 
OPUS_EXPORT
 
›us_mu…i°ªam_decodî_˘l
(
OpusMSDecodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

650 
OPUS_EXPORT
 
›us_mu…i°ªam_decodî_de°roy
(
OpusMSDecodî
 *
°
);

656 #ifde‡
__˝lu•lus


	@include/opus_projection.h

33 #i‚de‡
OPUS_PROJECTION_H


34 
	#OPUS_PROJECTION_H


	)

36 
	~"›us_mu…i°ªam.h
"

38 #ifde‡
__˝lu•lus


48 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX_GAIN_REQUEST
 6001

	)

49 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE_REQUEST
 6003

	)

50 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX_REQUEST
 6005

	)

72 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX_GAIN
(
x
Ë
OPUS_PROJECTION_GET_DEMIXING_MATRIX_GAIN_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

80 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE
(
x
Ë
OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

90 
	#OPUS_PROJECTION_GET_DEMIXING_MATRIX
(
x
,
y
Ë
OPUS_PROJECTION_GET_DEMIXING_MATRIX_REQUEST
, x, 
	`__›us_check_öt
(y)

	)

100 
OpusProje˘i⁄Encodî
 
	tOpusProje˘i⁄Encodî
;

109 
OpusProje˘i⁄Decodî
 
	tOpusProje˘i⁄Decodî
;

123 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_¥oje˘i⁄_ambis⁄ics_ícodî_gë_size
(

124 
ch™√ls
,

125 
m≠pög_Ámûy


161 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusProje˘i⁄Encodî
 *
›us_¥oje˘i⁄_ambis⁄ics_ícodî_¸óã
(

162 
›us_öt32
 
Fs
,

163 
ch™√ls
,

164 
m≠pög_Ámûy
,

165 *
°ªams
,

166 *
cou∂ed_°ªams
,

167 
≠∂iˇti⁄
,

168 *
îr‹


169 Ë
OPUS_ARG_NONNULL
(4) OPUS_ARG_NONNULL(5);

214 
OPUS_EXPORT
 
›us_¥oje˘i⁄_ambis⁄ics_ícodî_öô
(

215 
OpusProje˘i⁄Encodî
 *
°
,

216 
›us_öt32
 
Fs
,

217 
ch™√ls
,

218 
m≠pög_Ámûy
,

219 *
°ªams
,

220 *
cou∂ed_°ªams
,

221 
≠∂iˇti⁄


222 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(5) OPUS_ARG_NONNULL(6);

255 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_¥oje˘i⁄_ícode
(

256 
OpusProje˘i⁄Encodî
 *
°
,

257 c⁄° 
›us_öt16
 *
pcm
,

258 
‰ame_size
,

259 *
d©a
,

260 
›us_öt32
 
max_d©a_byãs


261 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

301 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_¥oje˘i⁄_ícode_Êﬂt
(

302 
OpusProje˘i⁄Encodî
 *
°
,

303 c⁄° *
pcm
,

304 
‰ame_size
,

305 *
d©a
,

306 
›us_öt32
 
max_d©a_byãs


307 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(2) OPUS_ARG_NONNULL(4);

314 
OPUS_EXPORT
 
›us_¥oje˘i⁄_ícodî_de°roy
(
OpusProje˘i⁄Encodî
 *
°
);

331 
OPUS_EXPORT
 
›us_¥oje˘i⁄_ícodî_˘l
(
OpusProje˘i⁄Encodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

356 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_öt32
 
›us_¥oje˘i⁄_decodî_gë_size
(

357 
ch™√ls
,

358 
°ªams
,

359 
cou∂ed_°ªams


397 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
OpusProje˘i⁄Decodî
 *
›us_¥oje˘i⁄_decodî_¸óã
(

398 
›us_öt32
 
Fs
,

399 
ch™√ls
,

400 
°ªams
,

401 
cou∂ed_°ªams
,

402 *
demixög_m©rix
,

403 
›us_öt32
 
demixög_m©rix_size
,

404 *
îr‹


405 Ë
OPUS_ARG_NONNULL
(5);

447 
OPUS_EXPORT
 
›us_¥oje˘i⁄_decodî_öô
(

448 
OpusProje˘i⁄Decodî
 *
°
,

449 
›us_öt32
 
Fs
,

450 
ch™√ls
,

451 
°ªams
,

452 
cou∂ed_°ªams
,

453 *
demixög_m©rix
,

454 
›us_öt32
 
demixög_m©rix_size


455 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(6);

487 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_¥oje˘i⁄_decode
(

488 
OpusProje˘i⁄Decodî
 *
°
,

489 c⁄° *
d©a
,

490 
›us_öt32
 
Àn
,

491 
›us_öt16
 *
pcm
,

492 
‰ame_size
,

493 
decode_„c


494 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

526 
OPUS_EXPORT
 
OPUS_WARN_UNUSED_RESULT
 
›us_¥oje˘i⁄_decode_Êﬂt
(

527 
OpusProje˘i⁄Decodî
 *
°
,

528 c⁄° *
d©a
,

529 
›us_öt32
 
Àn
,

530 *
pcm
,

531 
‰ame_size
,

532 
decode_„c


533 Ë
OPUS_ARG_NONNULL
(1) OPUS_ARG_NONNULL(4);

550 
OPUS_EXPORT
 
›us_¥oje˘i⁄_decodî_˘l
(
OpusProje˘i⁄Decodî
 *
°
, 
ªque°
, ...Ë
OPUS_ARG_NONNULL
(1);

557 
OPUS_EXPORT
 
›us_¥oje˘i⁄_decodî_de°roy
(
OpusProje˘i⁄Decodî
 *
°
);

564 #ifde‡
__˝lu•lus


	@include/opus_types.h

33 #i‚de‡
OPUS_TYPES_H


34 
	#OPUS_TYPES_H


	)

36 
	#›us_öt
 

	)

37 
	#›us_öt64
 

	)

38 
	#›us_öt8
 sig√d 

	)

40 
	#›us_uöt
 

	)

41 
	#›us_uöt64
 

	)

42 
	#›us_uöt8
 

	)

45 #i‡(
deföed
(
__STDC__
Ë&& __STDC__ && deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| (deföed(
__GNUC__
Ë&& (deföed(
_STDINT_H
Ë|| deföed(
_STDINT_H_
)Ë|| deföed (
HAVE_STDINT_H
))

46 
	~<°döt.h
>

47 #unde‡
›us_öt64


48 #unde‡
›us_öt8


49 #unde‡
›us_uöt64


50 #unde‡
›us_uöt8


51 
öt8_t
 
	t›us_öt8
;

52 
uöt8_t
 
	t›us_uöt8
;

53 
öt16_t
 
	t›us_öt16
;

54 
uöt16_t
 
	t›us_uöt16
;

55 
öt32_t
 
	t›us_öt32
;

56 
uöt32_t
 
	t›us_uöt32
;

57 
öt64_t
 
	t›us_öt64
;

58 
uöt64_t
 
	t›us_uöt64
;

59 #ñi‡
deföed
(
_WIN32
)

61 #i‡
deföed
(
__CYGWIN__
)

62 
	~<_G_c⁄fig.h
>

63 
_G_öt32_t
 
	t›us_öt32
;

64 
_G_uöt32_t
 
	t›us_uöt32
;

65 
_G_öt16
 
	t›us_öt16
;

66 
_G_uöt16
 
	t›us_uöt16
;

67 #ñi‡
deföed
(
__MINGW32__
)

68 
	t›us_öt16
;

69 
	t›us_uöt16
;

70 
	t›us_öt32
;

71 
	t›us_uöt32
;

72 #ñi‡
deföed
(
__MWERKS__
)

73 
	t›us_öt32
;

74 
	t›us_uöt32
;

75 
	t›us_öt16
;

76 
	t›us_uöt16
;

79 
__öt32
 
	t›us_öt32
;

80 
	t__öt32
 
	t›us_uöt32
;

81 
__öt16
 
	t›us_öt16
;

82 
	t__öt16
 
	t›us_uöt16
;

85 #ñi‡
deföed
(
__MACOS__
)

87 
	~<sys/ty≥s.h
>

88 
SI¡16
 
	t›us_öt16
;

89 
UI¡16
 
	t›us_uöt16
;

90 
SI¡32
 
	t›us_öt32
;

91 
UI¡32
 
	t›us_uöt32
;

93 #ñi‡(
deföed
(
__APPLE__
Ë&& deföed(
__MACH__
))

95 
	~<sys/ty≥s.h
>

96 
öt16_t
 
	t›us_öt16
;

97 
u_öt16_t
 
	t›us_uöt16
;

98 
öt32_t
 
	t›us_öt32
;

99 
u_öt32_t
 
	t›us_uöt32
;

101 #ñi‡
deföed
(
__BEOS__
)

104 
	~<öây≥s.h
>

105 
öt16
 
	t›us_öt16
;

106 
u_öt16
 
	t›us_uöt16
;

107 
öt32_t
 
	t›us_öt32
;

108 
u_öt32_t
 
	t›us_uöt32
;

110 #ñi‡
deföed
 (
__EMX__
)

113 
	t›us_öt16
;

114 
	t›us_uöt16
;

115 
	t›us_öt32
;

116 
	t›us_uöt32
;

118 #ñi‡
deföed
 (
DJGPP
)

121 
	t›us_öt16
;

122 
	t›us_uöt16
;

123 
	t›us_öt32
;

124 
	t›us_uöt32
;

126 #ñi‡
deföed
(
R5900
)

129 
	t›us_öt32
;

130 
	t›us_uöt32
;

131 
	t›us_öt16
;

132 
	t›us_uöt16
;

134 #ñi‡
deföed
(
__SYMBIAN32__
)

137 sig√d 
	t›us_öt16
;

138 
	t›us_uöt16
;

139 sig√d 
	t›us_öt32
;

140 
	t›us_uöt32
;

142 #ñi‡
deföed
(
CONFIG_TI_C54X
Ë|| deföed (
CONFIG_TI_C55X
)

144 
	t›us_öt16
;

145 
	t›us_uöt16
;

146 
	t›us_öt32
;

147 
	t›us_uöt32
;

149 #ñi‡
deföed
(
CONFIG_TI_C6X
)

151 
	t›us_öt16
;

152 
	t›us_uöt16
;

153 
	t›us_öt32
;

154 
	t›us_uöt32
;

159 
	t›us_öt16
;

160 
	t›us_uöt16
;

161 
	t›us_öt32
;

162 
	t›us_uöt32
;

	@silk/A2NLSF.c

34 #ifde‡
HAVE_CONFIG_H


35 
	~"c⁄fig.h
"

38 
	~"SigProc_FIX.h
"

39 
	~"èbÀs.h
"

42 
	#BIN_DIV_STEPS_A2NLSF_FIX
 3

	)

43 
	#MAX_ITERATIONS_A2NLSF_FIX
 16

	)

47 
OPUS_INLINE
 
	$sûk_A2NLSF_å™s_pﬁy
(

48 
›us_öt32
 *
p
,

49 c⁄° 
›us_öt
 
dd


52 
›us_öt
 
k
, 
n
;

54  
k
 = 2; k <
dd
; k++ ) {

55  
n
 = 
dd
;Ç > 
k
;Ç-- ) {

56 
p
[ 
n
 - 2 ] -=Ö[Ç ];

58 
p
[ 
k
 - 2 ] -
	`sûk_LSHIFT
(Ö[ k ], 1 );

60 
	}
}

63 
OPUS_INLINE
 
›us_öt32
 
	$sûk_A2NLSF_evÆ_pﬁy
(

64 
›us_öt32
 *
p
,

65 c⁄° 
›us_öt32
 
x
,

66 c⁄° 
›us_öt
 
dd


69 
›us_öt
 
n
;

70 
›us_öt32
 
x_Q16
, 
y32
;

72 
y32
 = 
p
[ 
dd
 ];

73 
x_Q16
 = 
	`sûk_LSHIFT
–
x
, 4 );

75 i‡–
	`›us_likñy
–8 =
dd
 ) )

77 
y32
 = 
	`sûk_SMLAWW
–
p
[ 7 ], y32, 
x_Q16
 );

78 
y32
 = 
	`sûk_SMLAWW
–
p
[ 6 ], y32, 
x_Q16
 );

79 
y32
 = 
	`sûk_SMLAWW
–
p
[ 5 ], y32, 
x_Q16
 );

80 
y32
 = 
	`sûk_SMLAWW
–
p
[ 4 ], y32, 
x_Q16
 );

81 
y32
 = 
	`sûk_SMLAWW
–
p
[ 3 ], y32, 
x_Q16
 );

82 
y32
 = 
	`sûk_SMLAWW
–
p
[ 2 ], y32, 
x_Q16
 );

83 
y32
 = 
	`sûk_SMLAWW
–
p
[ 1 ], y32, 
x_Q16
 );

84 
y32
 = 
	`sûk_SMLAWW
–
p
[ 0 ], y32, 
x_Q16
 );

88  
n
 = 
dd
 - 1;Ç >= 0;Ç-- ) {

89 
y32
 = 
	`sûk_SMLAWW
–
p
[ 
n
 ], y32, 
x_Q16
 );

92  
y32
;

93 
	}
}

95 
OPUS_INLINE
 
	$sûk_A2NLSF_öô
(

96 c⁄° 
›us_öt32
 *
a_Q16
,

97 
›us_öt32
 *
P
,

98 
›us_öt32
 *
Q
,

99 c⁄° 
›us_öt
 
dd


102 
›us_öt
 
k
;

105 
P
[
dd
] = 
	`sûk_LSHIFT
( 1, 16 );

106 
Q
[
dd
] = 
	`sûk_LSHIFT
( 1, 16 );

107  
k
 = 0; k < 
dd
; k++ ) {

108 
P
[ 
k
 ] = -
a_Q16
[ 
dd
 - k - 1 ] -á_Q16[ dd + k ];

109 
Q
[ 
k
 ] = -
a_Q16
[ 
dd
 - k - 1 ] +á_Q16[ dd + k ];

115  
k
 = 
dd
; k > 0; k-- ) {

116 
P
[ 
k
 - 1 ] -= P[ k ];

117 
Q
[ 
k
 - 1 ] += Q[ k ];

121 
	`sûk_A2NLSF_å™s_pﬁy
–
P
, 
dd
 );

122 
	`sûk_A2NLSF_å™s_pﬁy
–
Q
, 
dd
 );

123 
	}
}

127 
	$sûk_A2NLSF
(

128 
›us_öt16
 *
NLSF
,

129 
›us_öt32
 *
a_Q16
,

130 c⁄° 
›us_öt
 
d


133 
›us_öt
 
i
, 
k
, 
m
, 
dd
, 
roŸ_ix
, 
f‰ac
;

134 
›us_öt32
 
xlo
, 
xhi
, 
xmid
;

135 
›us_öt32
 
ylo
, 
yhi
, 
ymid
, 
thr
;

136 
›us_öt32
 
nom
, 
dí
;

137 
›us_öt32
 
P
[ 
SILK_MAX_ORDER_LPC
 / 2 + 1 ];

138 
›us_öt32
 
Q
[ 
SILK_MAX_ORDER_LPC
 / 2 + 1 ];

139 
›us_öt32
 *
PQ
[ 2 ];

140 
›us_öt32
 *
p
;

143 
PQ
[ 0 ] = 
P
;

144 
PQ
[ 1 ] = 
Q
;

146 
dd
 = 
	`sûk_RSHIFT
–
d
, 1 );

148 
	`sûk_A2NLSF_öô
–
a_Q16
, 
P
, 
Q
, 
dd
 );

151 
p
 = 
P
;

153 
xlo
 = 
sûk_LSFCosTab_FIX_Q12
[ 0 ];

154 
ylo
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xlo
, 
dd
 );

156 if–
ylo
 < 0 ) {

158 
NLSF
[ 0 ] = 0;

159 
p
 = 
Q
;

160 
ylo
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xlo
, 
dd
 );

161 
roŸ_ix
 = 1;

163 
roŸ_ix
 = 0;

165 
k
 = 1;

166 
i
 = 0;

167 
thr
 = 0;

170 
xhi
 = 
sûk_LSFCosTab_FIX_Q12
[ 
k
 ];

171 
yhi
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xhi
, 
dd
 );

174 if––
ylo
 <0 && 
yhi
 >
thr
 ) || ( ylo >= 0 && yhi <= -thr ) ) {

175 if–
yhi
 == 0 ) {

178 
thr
 = 1;

180 
thr
 = 0;

183 
f‰ac
 = -256;

184  
m
 = 0; m < 
BIN_DIV_STEPS_A2NLSF_FIX
; m++ ) {

186 
xmid
 = 
	`sûk_RSHIFT_ROUND
–
xlo
 + 
xhi
, 1 );

187 
ymid
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xmid
, 
dd
 );

190 if––
ylo
 <0 && 
ymid
 >= 0 ) || ( ylo >= 0 && ymid <= 0 ) ) {

192 
xhi
 = 
xmid
;

193 
yhi
 = 
ymid
;

196 
xlo
 = 
xmid
;

197 
ylo
 = 
ymid
;

198 
f‰ac
 = 
	`sûk_ADD_RSHIFT
–f‰ac, 128, 
m
 );

203 if–
	`sûk_abs
–
ylo
 ) < 65536 ) {

205 
dí
 = 
ylo
 - 
yhi
;

206 
nom
 = 
	`sûk_LSHIFT
–
ylo
, 8 - 
BIN_DIV_STEPS_A2NLSF_FIX
 ) + 
	`sûk_RSHIFT
–
dí
, 1 );

207 if–
dí
 != 0 ) {

208 
f‰ac
 +
	`sûk_DIV32
–
nom
, 
dí
 );

212 
f‰ac
 +
	`sûk_DIV32
–
ylo
, 
	`sûk_RSHIFT
–ylÿ- 
yhi
, 8 - 
BIN_DIV_STEPS_A2NLSF_FIX
 ) );

214 
NLSF
[ 
roŸ_ix
 ] = (
›us_öt16
)
	`sûk_mö_32
–
	`sûk_LSHIFT
–(
›us_öt32
)
k
, 8 ) + 
f‰ac
, 
sûk_öt16_MAX
 );

216 
	`sûk_as£π
–
NLSF
[ 
roŸ_ix
 ] >= 0 );

218 
roŸ_ix
++;

219 if–
roŸ_ix
 >
d
 ) {

224 
p
 = 
PQ
[ 
roŸ_ix
 & 1 ];

227 
xlo
 = 
sûk_LSFCosTab_FIX_Q12
[ 
k
 - 1 ];

228 
ylo
 = 
	`sûk_LSHIFT
–1 - ( 
roŸ_ix
 & 2 ), 12 );

231 
k
++;

232 
xlo
 = 
xhi
;

233 
ylo
 = 
yhi
;

234 
thr
 = 0;

236 if–
k
 > 
LSF_COS_TAB_SZ_FIX
 ) {

237 
i
++;

238 if–
i
 > 
MAX_ITERATIONS_A2NLSF_FIX
 ) {

240 
NLSF
[ 0 ] = (
›us_öt16
)
	`sûk_DIV32_16
–1 << 15, 
d
 + 1 );

241  
k
 = 1; k < 
d
; k++ ) {

242 
NLSF
[ 
k
 ] = (
›us_öt16
)
	`sûk_ADD16
( NLSF[ k-1 ], NLSF[ 0 ] );

248 
	`sûk_bwex∑ndî_32
–
a_Q16
, 
d
, 65536 - 
	`sûk_LSHIFT
–1, 
i
 ) );

250 
	`sûk_A2NLSF_öô
–
a_Q16
, 
P
, 
Q
, 
dd
 );

251 
p
 = 
P
;

252 
xlo
 = 
sûk_LSFCosTab_FIX_Q12
[ 0 ];

253 
ylo
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xlo
, 
dd
 );

254 if–
ylo
 < 0 ) {

256 
NLSF
[ 0 ] = 0;

257 
p
 = 
Q
;

258 
ylo
 = 
	`sûk_A2NLSF_evÆ_pﬁy
–
p
, 
xlo
, 
dd
 );

259 
roŸ_ix
 = 1;

261 
roŸ_ix
 = 0;

263 
k
 = 1;

267 
	}
}

	@silk/API.h

28 #i‚de‡
SILK_API_H


29 
	#SILK_API_H


	)

31 
	~"c⁄åﬁ.h
"

32 
	~"ty≥def.h
"

33 
	~"îr‹s.h
"

34 
	~"íãnc.h
"

35 
	~"ítdec.h
"

37 #ifde‡
__˝lu•lus


42 
	#SILK_MAX_FRAMES_PER_PACKET
 3

	)

46 
›us_öt
 
VADFœg
;

47 
›us_öt
 
VADFœgs
[ 
SILK_MAX_FRAMES_PER_PACKET
 ];

48 
›us_öt
 
öb™dFECFœg
;

49 } 
	tsûk_TOC_°ru˘
;

58 
›us_öt
 
sûk_Gë_Encodî_Size
(

59 
›us_öt
 *
ícSizeByãs


65 
›us_öt
 
sûk_InôEncodî
(

66 *
ícSèã
,

67 
¨ch
,

68 
sûk_EncC⁄åﬁSåu˘
 *
ícSètus


76 
›us_öt
 
sûk_Encode
(

77 *
ícSèã
,

78 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ
,

79 c⁄° 
›us_öt16
 *
ßm∂esIn
,

80 
›us_öt
 
nSam∂esIn
,

81 
ec_íc
 *
psR™geEnc
,

82 
›us_öt32
 *
nByãsOut
,

83 c⁄° 
›us_öt
 
¥efûlFœg
,

84 
a˘ivôy


94 
›us_öt
 
sûk_Gë_Decodî_Size
(

95 
›us_öt
 *
decSizeByãs


101 
›us_öt
 
sûk_InôDecodî
(

102 *
decSèã


108 
›us_öt
 
sûk_Decode
(

109 * 
decSèã
,

110 
sûk_DecC⁄åﬁSåu˘
* 
decC⁄åﬁ
,

111 
›us_öt
 
lo°Fœg
,

112 
›us_öt
 
√wPackëFœg
,

113 
ec_dec
 *
psR™geDec
,

114 
›us_öt16
 *
ßm∂esOut
,

115 
›us_öt32
 *
nSam∂esOut
,

116 
¨ch


123 
›us_öt
 
sûk_gë_TOC
(

124 c⁄° 
›us_uöt8
 *
∑ylﬂd
,

125 c⁄° 
›us_öt
 
nByãsIn
,

126 c⁄° 
›us_öt
 
nFømesPîPaylﬂd
,

127 
sûk_TOC_°ru˘
 *
Sûk_TOC


131 #ifde‡
__˝lu•lus


	@silk/CNG.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

36 
OPUS_INLINE
 
	$sûk_CNG_exc
(

37 
›us_öt32
 
exc_Q14
[],

38 
›us_öt32
 
exc_buf_Q14
[],

39 
›us_öt
 
Àngth
,

40 
›us_öt32
 *
ønd_£ed


43 
›us_öt32
 
£ed
;

44 
›us_öt
 
i
, 
idx
, 
exc_mask
;

46 
exc_mask
 = 
CNG_BUF_MASK_MAX
;

47  
exc_mask
 > 
Àngth
 ) {

48 
exc_mask
 = 
	`sûk_RSHIFT
(Éxc_mask, 1 );

51 
£ed
 = *
ønd_£ed
;

52  
i
 = 0; i < 
Àngth
; i++ ) {

53 
£ed
 = 
	`sûk_RAND
( seed );

54 
idx
 = (
›us_öt
)–
	`sûk_RSHIFT
–
£ed
, 24 ) & 
exc_mask
 );

55 
	`sûk_as£π
–
idx
 >= 0 );

56 
	`sûk_as£π
–
idx
 <
CNG_BUF_MASK_MAX
 );

57 
exc_Q14
[ 
i
 ] = 
exc_buf_Q14
[ 
idx
 ];

59 *
ønd_£ed
 = 
£ed
;

60 
	}
}

62 
	$sûk_CNG_Re£t
(

63 
sûk_decodî_°©e
 *
psDec


66 
›us_öt
 
i
, 
NLSF_°ï_Q15
, 
NLSF_acc_Q15
;

68 
NLSF_°ï_Q15
 = 
	`sûk_DIV32_16
–
sûk_öt16_MAX
, 
psDec
->
LPC_‹dî
 + 1 );

69 
NLSF_acc_Q15
 = 0;

70  
i
 = 0; i < 
psDec
->
LPC_‹dî
; i++ ) {

71 
NLSF_acc_Q15
 +
NLSF_°ï_Q15
;

72 
psDec
->
sCNG
.
CNG_smth_NLSF_Q15
[ 
i
 ] = 
NLSF_acc_Q15
;

74 
psDec
->
sCNG
.
CNG_smth_Gaö_Q16
 = 0;

75 
psDec
->
sCNG
.
ønd_£ed
 = 3176576;

76 
	}
}

79 
	$sûk_CNG
(

80 
sûk_decodî_°©e
 *
psDec
,

81 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

82 
›us_öt16
 
‰ame
[],

83 
›us_öt
 
Àngth


86 
›us_öt
 
i
, 
sub‰
;

87 
›us_öt32
 
LPC_¥ed_Q10
, 
max_Gaö_Q16
, 
gaö_Q16
, 
gaö_Q10
;

88 
›us_öt16
 
A_Q12
[ 
MAX_LPC_ORDER
 ];

89 
sûk_CNG_°ru˘
 *
psCNG
 = &
psDec
->
sCNG
;

90 
SAVE_STACK
;

92 if–
psDec
->
fs_kHz
 !
psCNG
->fs_kHz ) {

94 
	`sûk_CNG_Re£t
–
psDec
 );

96 
psCNG
->
fs_kHz
 = 
psDec
->fs_kHz;

98 if–
psDec
->
lossC¡
 =0 &&ÖsDec->
¥evSig«lTy≥
 =
TYPE_NO_VOICE_ACTIVITY
 ) {

102  
i
 = 0; i < 
psDec
->
LPC_‹dî
; i++ ) {

103 
psCNG
->
CNG_smth_NLSF_Q15
[ 
i
 ] +
	`sûk_SMULWB
–(
›us_öt32
)
psDec
->
¥evNLSF_Q15
[ i ] - (›us_öt32ÌsCNG->CNG_smth_NLSF_Q15[ i ], 
CNG_NLSF_SMTH_Q16
 );

106 
max_Gaö_Q16
 = 0;

107 
sub‰
 = 0;

108  
i
 = 0; i < 
psDec
->
nb_sub‰
; i++ ) {

109 if–
psDecCål
->
Gaös_Q16
[ 
i
 ] > 
max_Gaö_Q16
 ) {

110 
max_Gaö_Q16
 = 
psDecCål
->
Gaös_Q16
[ 
i
 ];

111 
sub‰
 = 
i
;

115 
	`sûk_memmove
–&
psCNG
->
CNG_exc_buf_Q14
[ 
psDec
->
sub‰_Àngth
 ],ÖsCNG->CNG_exc_buf_Q14, (ÖsDec->
nb_sub‰
 - 1 ) *ÖsDec->sub‰_Àngth * –
›us_öt32
 ) );

116 
	`sûk_mem˝y
–
psCNG
->
CNG_exc_buf_Q14
, &
psDec
->
exc_Q14
[ 
sub‰
 *ÖsDec->
sub‰_Àngth
 ],ÖsDec->sub‰_Àngth * –
›us_öt32
 ) );

119  
i
 = 0; i < 
psDec
->
nb_sub‰
; i++ ) {

120 
psCNG
->
CNG_smth_Gaö_Q16
 +
	`sûk_SMULWB
–
psDecCål
->
Gaös_Q16
[ 
i
 ] -ÖsCNG->CNG_smth_Gaö_Q16, 
CNG_GAIN_SMTH_Q16
 );

125 if–
psDec
->
lossC¡
 ) {

126 
	`VARDECL
–
›us_öt32
, 
CNG_sig_Q14
 );

127 
	`ALLOC
–
CNG_sig_Q14
, 
Àngth
 + 
MAX_LPC_ORDER
, 
›us_öt32
 );

130 
gaö_Q16
 = 
	`sûk_SMULWW
–
psDec
->
sPLC
.
øndSˇÀ_Q14
,ÖsDec->sPLC.
¥evGaö_Q16
[1] );

131 if–
gaö_Q16
 >(1 << 21Ë|| 
psCNG
->
CNG_smth_Gaö_Q16
 > (1 << 23) ) {

132 
gaö_Q16
 = 
	`sûk_SMULTT
( gain_Q16, gain_Q16 );

133 
gaö_Q16
 = 
	`sûk_SUB_LSHIFT32
(
	`sûk_SMULTT
–
psCNG
->
CNG_smth_Gaö_Q16
,ÖsCNG->CNG_smth_Gain_Q16 ), gain_Q16, 5 );

134 
gaö_Q16
 = 
	`sûk_LSHIFT32
–
	`sûk_SQRT_APPROX
( gain_Q16 ), 16 );

136 
gaö_Q16
 = 
	`sûk_SMULWW
( gain_Q16, gain_Q16 );

137 
gaö_Q16
 = 
	`sûk_SUB_LSHIFT32
(
	`sûk_SMULWW
–
psCNG
->
CNG_smth_Gaö_Q16
,ÖsCNG->CNG_smth_Gain_Q16 ), gain_Q16, 5 );

138 
gaö_Q16
 = 
	`sûk_LSHIFT32
–
	`sûk_SQRT_APPROX
( gain_Q16 ), 8 );

140 
gaö_Q10
 = 
	`sûk_RSHIFT
–
gaö_Q16
, 6 );

142 
	`sûk_CNG_exc
–
CNG_sig_Q14
 + 
MAX_LPC_ORDER
, 
psCNG
->
CNG_exc_buf_Q14
, 
Àngth
, &psCNG->
ønd_£ed
 );

145 
	`sûk_NLSF2A
–
A_Q12
, 
psCNG
->
CNG_smth_NLSF_Q15
, 
psDec
->
LPC_‹dî
,ÖsDec->
¨ch
 );

148 
	`sûk_mem˝y
–
CNG_sig_Q14
, 
psCNG
->
CNG_sy¡h_°©e
, 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

149 
	`˚…_as£π
–
psDec
->
LPC_‹dî
 == 10 ||ÖsDec->LPC_order == 16 );

150  
i
 = 0; i < 
Àngth
; i++ ) {

152 
LPC_¥ed_Q10
 = 
	`sûk_RSHIFT
–
psDec
->
LPC_‹dî
, 1 );

153 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 1 ], 
A_Q12
[ 0 ] );

154 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 2 ], 
A_Q12
[ 1 ] );

155 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 3 ], 
A_Q12
[ 2 ] );

156 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 4 ], 
A_Q12
[ 3 ] );

157 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 5 ], 
A_Q12
[ 4 ] );

158 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 6 ], 
A_Q12
[ 5 ] );

159 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 7 ], 
A_Q12
[ 6 ] );

160 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 8 ], 
A_Q12
[ 7 ] );

161 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 9 ], 
A_Q12
[ 8 ] );

162 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 10 ], 
A_Q12
[ 9 ] );

163 if–
psDec
->
LPC_‹dî
 == 16 ) {

164 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 11 ], 
A_Q12
[ 10 ] );

165 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 12 ], 
A_Q12
[ 11 ] );

166 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 13 ], 
A_Q12
[ 12 ] );

167 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 14 ], 
A_Q12
[ 13 ] );

168 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 15 ], 
A_Q12
[ 14 ] );

169 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 16 ], 
A_Q12
[ 15 ] );

173 
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + 
i
 ] = 
	`sûk_ADD_SAT32
–CNG_sig_Q14[ MAX_LPC_ORDER + i ], 
	`sûk_LSHIFT_SAT32
–
LPC_¥ed_Q10
, 4 ) );

176 
‰ame
[ 
i
 ] = (
›us_öt16
)
	`sûk_ADD_SAT16
–‰ame[ i ], 
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
CNG_sig_Q14
[ 
MAX_LPC_ORDER
 + i ], 
gaö_Q10
 ), 8 ) ) );

179 
	`sûk_mem˝y
–
psCNG
->
CNG_sy¡h_°©e
, &
CNG_sig_Q14
[ 
Àngth
 ], 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

181 
	`sûk_mem£t
–
psCNG
->
CNG_sy¡h_°©e
, 0, 
psDec
->
LPC_‹dî
 * –
›us_öt32
 ) );

183 
RESTORE_STACK
;

184 
	}
}

	@silk/HP_variable_cutoff.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

31 #ifde‡
FIXED_POINT


32 
	~"maö_FIX.h
"

34 
	~"maö_FLP.h
"

36 
	~"tunög_∑ømëîs.h
"

39 
	$sûk_HP_v¨übÀ_cutoff
(

40 
sûk_ícodî_°©e_Fxx
 
°©e_Fxx
[]

43 
›us_öt
 
quÆôy_Q15
;

44 
›us_öt32
 
pôch_‰eq_Hz_Q16
, 
pôch_‰eq_log_Q7
, 
dñè_‰eq_Q7
;

45 
sûk_ícodî_°©e
 *
psEncC1
 = &
°©e_Fxx
[ 0 ].
sCmn
;

48 if–
psEncC1
->
¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

50 
pôch_‰eq_Hz_Q16
 = 
	`sûk_DIV32_16
–
	`sûk_LSHIFT
–
	`sûk_MUL
–
psEncC1
->
fs_kHz
, 1000 ), 16 ),ÖsEncC1->
¥evLag
 );

51 
pôch_‰eq_log_Q7
 = 
	`sûk_lö2log
–
pôch_‰eq_Hz_Q16
 ) - ( 16 << 7 );

54 
quÆôy_Q15
 = 
psEncC1
->
öput_quÆôy_b™ds_Q15
[ 0 ];

55 
pôch_‰eq_log_Q7
 = 
	`sûk_SMLAWB
–pôch_‰eq_log_Q7, 
	`sûk_SMULWB
–
	`sûk_LSHIFT
–-
quÆôy_Q15
, 2 ), quality_Q15 ),

56 
pôch_‰eq_log_Q7
 - ( 
	`sûk_lö2log
–
	`SILK_FIX_CONST
–
VARIABLE_HP_MIN_CUTOFF_HZ
, 16 ) ) - ( 16 << 7 ) ) );

59 
dñè_‰eq_Q7
 = 
pôch_‰eq_log_Q7
 - 
	`sûk_RSHIFT
–
psEncC1
->
v¨übÀ_HP_smth1_Q15
, 8 );

60 if–
dñè_‰eq_Q7
 < 0 ) {

62 
dñè_‰eq_Q7
 = 
	`sûk_MUL
( delta_freq_Q7, 3 );

66 
dñè_‰eq_Q7
 = 
	`sûk_LIMIT_32
–dñè_‰eq_Q7, -
	`SILK_FIX_CONST
–
VARIABLE_HP_MAX_DELTA_FREQ
, 7 ), SILK_FIX_CONST( VARIABLE_HP_MAX_DELTA_FREQ, 7 ) );

69 
psEncC1
->
v¨übÀ_HP_smth1_Q15
 = 
	`sûk_SMLAWB
(ÖsEncC1->variable_HP_smth1_Q15,

70 
	`sûk_SMULBB
–
psEncC1
->
•ìch_a˘ivôy_Q8
, 
dñè_‰eq_Q7
 ), 
	`SILK_FIX_CONST
–
VARIABLE_HP_SMTH_COEF1
, 16 ) );

73 
psEncC1
->
v¨übÀ_HP_smth1_Q15
 = 
	`sûk_LIMIT_32
(ÖsEncC1->variable_HP_smth1_Q15,

74 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
VARIABLE_HP_MIN_CUTOFF_HZ
 ), 8 ),

75 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
VARIABLE_HP_MAX_CUTOFF_HZ
 ), 8 ) );

77 
	}
}

	@silk/Inlines.h

32 #i‚de‡
SILK_FIX_INLINES_H


33 
	#SILK_FIX_INLINES_H


	)

35 #ifde‡ 
__˝lu•lus


41 
OPUS_INLINE
 
›us_öt32
 
sûk_CLZ64
–
›us_öt64
 
ö
 )

43 
›us_öt32
 
ö_uµî
;

45 
ö_uµî
 = (
›us_öt32
)
sûk_RSHIFT64
(
ö
, 32);

46 i‡(
ö_uµî
 == 0) {

48  32 + 
sûk_CLZ32
–(
›us_öt32
Ë
ö
 );

51  
sûk_CLZ32
–
ö_uµî
 );

56 
OPUS_INLINE
 
sûk_CLZ_FRAC
(

57 
›us_öt32
 
ö
,

58 
›us_öt32
 *
lz
,

59 
›us_öt32
 *
‰ac_Q7


62 
›us_öt32
 
lzîos
 = 
sûk_CLZ32
(
ö
);

64 * 
lz
 = 
lzîos
;

65 * 
‰ac_Q7
 = 
sûk_ROR32
(
ö
, 24 - 
lzîos
) & 0x7f;

71 
OPUS_INLINE
 
›us_öt32
 
sûk_SQRT_APPROX
–›us_öt32 
x
 )

73 
›us_öt32
 
y
, 
lz
, 
‰ac_Q7
;

75 if–
x
 <= 0 ) {

79 
sûk_CLZ_FRAC
(
x
, &
lz
, &
‰ac_Q7
);

81 if–
lz
 & 1 ) {

82 
y
 = 32768;

84 
y
 = 46214;

88 
y
 >>
sûk_RSHIFT
(
lz
, 1);

91 
y
 = 
sûk_SMLAWB
(y, y, 
sûk_SMULBB
(213, 
‰ac_Q7
));

93  
y
;

97 
OPUS_INLINE
 
›us_öt32
 
sûk_DIV32_v¨Q
(

98 c⁄° 
›us_öt32
 
a32
,

99 c⁄° 
›us_öt32
 
b32
,

100 c⁄° 
›us_öt
 
Qªs


103 
›us_öt
 
a_hódrm
, 
b_hódrm
, 
lshi·
;

104 
›us_öt32
 
b32_öv
, 
a32_ƒm
, 
b32_ƒm
, 
ªsu…
;

106 
sûk_as£π
–
b32
 != 0 );

107 
sûk_as£π
–
Qªs
 >= 0 );

110 
a_hódrm
 = 
sûk_CLZ32
–
sûk_abs
(
a32
) ) - 1;

111 
a32_ƒm
 = 
sûk_LSHIFT
(
a32
, 
a_hódrm
);

112 
b_hódrm
 = 
sûk_CLZ32
–
sûk_abs
(
b32
) ) - 1;

113 
b32_ƒm
 = 
sûk_LSHIFT
(
b32
, 
b_hódrm
);

116 
b32_öv
 = 
sûk_DIV32_16
–
sûk_öt32_MAX
 >> 2, 
sûk_RSHIFT
(
b32_ƒm
, 16) );

119 
ªsu…
 = 
sûk_SMULWB
(
a32_ƒm
, 
b32_öv
);

123 
a32_ƒm
 = 
sûk_SUB32_ovÊw
◊32_ƒm, 
sûk_LSHIFT_ovÊw
–
sûk_SMMUL
(
b32_ƒm
, 
ªsu…
), 3 ));

126 
ªsu…
 = 
sûk_SMLAWB
‘esu…, 
a32_ƒm
, 
b32_öv
);

129 
lshi·
 = 29 + 
a_hódrm
 - 
b_hódrm
 - 
Qªs
;

130 if–
lshi·
 < 0 ) {

131  
sûk_LSHIFT_SAT32
(
ªsu…
, -
lshi·
);

133 if–
lshi·
 < 32){

134  
sûk_RSHIFT
(
ªsu…
, 
lshi·
);

143 
OPUS_INLINE
 
›us_öt32
 
sûk_INVERSE32_v¨Q
(

144 c⁄° 
›us_öt32
 
b32
,

145 c⁄° 
›us_öt
 
Qªs


148 
›us_öt
 
b_hódrm
, 
lshi·
;

149 
›us_öt32
 
b32_öv
, 
b32_ƒm
, 
îr_Q32
, 
ªsu…
;

151 
sûk_as£π
–
b32
 != 0 );

152 
sûk_as£π
–
Qªs
 > 0 );

155 
b_hódrm
 = 
sûk_CLZ32
–
sûk_abs
(
b32
) ) - 1;

156 
b32_ƒm
 = 
sûk_LSHIFT
(
b32
, 
b_hódrm
);

159 
b32_öv
 = 
sûk_DIV32_16
–
sûk_öt32_MAX
 >> 2, 
sûk_RSHIFT
(
b32_ƒm
, 16) );

162 
ªsu…
 = 
sûk_LSHIFT
(
b32_öv
, 16);

165 
îr_Q32
 = 
sûk_LSHIFT
–((
›us_öt32
)1<<29Ë- 
sûk_SMULWB
(
b32_ƒm
, 
b32_öv
), 3 );

168 
ªsu…
 = 
sûk_SMLAWW
‘esu…, 
îr_Q32
, 
b32_öv
);

171 
lshi·
 = 61 - 
b_hódrm
 - 
Qªs
;

172 if–
lshi·
 <= 0 ) {

173  
sûk_LSHIFT_SAT32
(
ªsu…
, -
lshi·
);

175 if–
lshi·
 < 32){

176  
sûk_RSHIFT
(
ªsu…
, 
lshi·
);

184 #ifde‡ 
__˝lu•lus


	@silk/LPC_analysis_filter.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"˚…_Õc.h
"

47 
	#USE_CELT_FIR
 0

	)

49 
	$sûk_LPC_™Æysis_fûãr
(

50 
›us_öt16
 *
out
,

51 c⁄° 
›us_öt16
 *
ö
,

52 c⁄° 
›us_öt16
 *
B
,

53 c⁄° 
›us_öt32
 
Àn
,

54 c⁄° 
›us_öt32
 
d
,

55 
¨ch


58 
›us_öt
 
j
;

59 #i‡
	`deföed
(
FIXED_POINT
Ë&& 
USE_CELT_FIR


60 
›us_öt16
 
num
[
SILK_MAX_ORDER_LPC
];

62 
ix
;

63 
›us_öt32
 
out32_Q12
, 
out32
;

64 c⁄° 
›us_öt16
 *
ö_±r
;

67 
	`˚…_as£π
–
d
 >= 6 );

68 
	`˚…_as£π
–(
d
 & 1) == 0 );

69 
	`˚…_as£π
–
d
 <
Àn
 );

71 #i‡
	`deföed
(
FIXED_POINT
Ë&& 
USE_CELT_FIR


72 
	`˚…_as£π
–
d
 <
SILK_MAX_ORDER_LPC
 );

73  
j
 = 0; j < 
d
; j++ ) {

74 
num
[ 
j
 ] = -
B
[ j ];

76 
	`˚…_fú
–
ö
 + 
d
, 
num
, 
out
 + d, 
Àn
 - d, d, 
¨ch
 );

77  
j
 = 0; j < 
d
; j++ ) {

78 
out
[ 
j
 ] = 0;

81 ()
¨ch
;

82  
ix
 = 
d
; ix < 
Àn
; ix++ ) {

83 
ö_±r
 = &
ö
[ 
ix
 - 1 ];

85 
out32_Q12
 = 
	`sûk_SMULBB
–
ö_±r
[ 0 ], 
B
[ 0 ] );

88 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -1 ], 
B
[ 1 ] );

89 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -2 ], 
B
[ 2 ] );

90 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -3 ], 
B
[ 3 ] );

91 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -4 ], 
B
[ 4 ] );

92 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -5 ], 
B
[ 5 ] );

93  
j
 = 6; j < 
d
; j += 2 ) {

94 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -
j
 ], 
B
[ j ] );

95 
out32_Q12
 = 
	`sûk_SMLABB_ovÊw
–out32_Q12, 
ö_±r
[ -
j
 - 1 ], 
B
[ j + 1 ] );

99 
out32_Q12
 = 
	`sûk_SUB32_ovÊw
–
	`sûk_LSHIFT
–(
›us_öt32
)
ö_±r
[ 1 ], 12 ), out32_Q12 );

102 
out32
 = 
	`sûk_RSHIFT_ROUND
–
out32_Q12
, 12 );

105 
out
[ 
ix
 ] = (
›us_öt16
)
	`sûk_SAT16
–
out32
 );

109 
	`sûk_mem£t
–
out
, 0, 
d
 * –
›us_öt16
 ) );

111 
	}
}

	@silk/LPC_fit.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
	$sûk_LPC_fô
(

36 
›us_öt16
 *
a_QOUT
,

37 
›us_öt32
 *
a_QIN
,

38 c⁄° 
›us_öt
 
QOUT
,

39 c⁄° 
›us_öt
 
QIN
,

40 c⁄° 
›us_öt
 
d


43 
›us_öt
 
i
, 
k
, 
idx
 = 0;

44 
›us_öt32
 
maxabs
, 
absvÆ
, 
chúp_Q16
;

47  
i
 = 0; i < 10; i++ ) {

49 
maxabs
 = 0;

50  
k
 = 0; k < 
d
; k++ ) {

51 
absvÆ
 = 
	`sûk_abs
–
a_QIN
[
k
] );

52 if–
absvÆ
 > 
maxabs
 ) {

53 
maxabs
 = 
absvÆ
;

54 
idx
 = 
k
;

57 
maxabs
 = 
	`sûk_RSHIFT_ROUND
–maxabs, 
QIN
 - 
QOUT
 );

59 if–
maxabs
 > 
sûk_öt16_MAX
 ) {

61 
maxabs
 = 
	`sûk_mö
( maxabs, 163838 );

62 
chúp_Q16
 = 
	`SILK_FIX_CONST
–0.999, 16 ) - 
	`sûk_DIV32
–
	`sûk_LSHIFT
–
maxabs
 - 
sûk_öt16_MAX
, 14 ),

63 
	`sûk_RSHIFT32
–
	`sûk_MUL
–
maxabs
, 
idx
 + 1), 2 ) );

64 
	`sûk_bwex∑ndî_32
–
a_QIN
, 
d
, 
chúp_Q16
 );

70 if–
i
 == 10 ) {

72  
k
 = 0; k < 
d
; k++ ) {

73 
a_QOUT
[ 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
a_QIN
[ k ], 
QIN
 - 
QOUT
 ) );

74 
a_QIN
[ 
k
 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
a_QOUT
[ k ], 
QIN
 - 
QOUT
 );

77  
k
 = 0; k < 
d
; k++ ) {

78 
a_QOUT
[ 
k
 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
a_QIN
[ k ], 
QIN
 - 
QOUT
 );

81 
	}
}

	@silk/LPC_inv_pred_gain.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"deföe.h
"

35 
	#QA
 24

	)

36 
	#A_LIMIT
 
	`SILK_FIX_CONST
–0.99975, 
QA
 )

	)

38 
	#MUL32_FRAC_Q
(
a32
, 
b32
, 
Q
Ë((
›us_öt32
)(
	`sûk_RSHIFT_ROUND64
(
	`sûk_SMULL
◊32, b32), Q)))

	)

42 
›us_öt32
 
	$LPC_övî£_¥ed_gaö_QA_c
(

43 
›us_öt32
 
A_QA
[ 
SILK_MAX_ORDER_LPC
 ],

44 c⁄° 
›us_öt
 
‹dî


47 
›us_öt
 
k
, 
n
, 
mu…2Q
;

48 
›us_öt32
 
övGaö_Q30
, 
rc_Q31
, 
rc_mu…1_Q30
, 
rc_mu…2
, 
tmp1
, 
tmp2
;

50 
övGaö_Q30
 = 
	`SILK_FIX_CONST
( 1, 30 );

51  
k
 = 
‹dî
 - 1; k > 0; k-- ) {

53 if––
A_QA
[ 
k
 ] > 
A_LIMIT
 ) || ( A_QA[ k ] < -A_LIMIT ) ) {

58 
rc_Q31
 = -
	`sûk_LSHIFT
–
A_QA
[ 
k
 ], 31 - 
QA
 );

61 
rc_mu…1_Q30
 = 
	`sûk_SUB32
–
	`SILK_FIX_CONST
–1, 30 ), 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 ) );

62 
	`sûk_as£π
–
rc_mu…1_Q30
 > ( 1 << 15 ) );

63 
	`sûk_as£π
–
rc_mu…1_Q30
 <= ( 1 << 30 ) );

67 
övGaö_Q30
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–övGaö_Q30, 
rc_mu…1_Q30
 ), 2 );

68 
	`sûk_as£π
–
övGaö_Q30
 >= 0 );

69 
	`sûk_as£π
–
övGaö_Q30
 <= ( 1 << 30 ) );

70 if–
övGaö_Q30
 < 
	`SILK_FIX_CONST
–1.0‡/ 
MAX_PREDICTION_POWER_GAIN
, 30 ) ) {

75 
mu…2Q
 = 32 - 
	`sûk_CLZ32
–
	`sûk_abs
–
rc_mu…1_Q30
 ) );

76 
rc_mu…2
 = 
	`sûk_INVERSE32_v¨Q
–
rc_mu…1_Q30
, 
mu…2Q
 + 30 );

79  
n
 = 0;Ç < (
k
 + 1) >> 1;Ç++ ) {

80 
›us_öt64
 
tmp64
;

81 
tmp1
 = 
A_QA
[ 
n
 ];

82 
tmp2
 = 
A_QA
[ 
k
 - 
n
 - 1 ];

83 
tmp64
 = 
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
	`sûk_SUB_SAT32
(
tmp1
,

84 
	`MUL32_FRAC_Q
–
tmp2
, 
rc_Q31
, 31 ) ), 
rc_mu…2
 ), 
mu…2Q
);

85 if–
tmp64
 > 
sûk_öt32_MAX
 ||Åmp64 < 
sûk_öt32_MIN
 ) {

88 
A_QA
[ 
n
 ] = ( 
›us_öt32
 )
tmp64
;

89 
tmp64
 = 
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
	`sûk_SUB_SAT32
(
tmp2
,

90 
	`MUL32_FRAC_Q
–
tmp1
, 
rc_Q31
, 31 ) ), 
rc_mu…2
), 
mu…2Q
);

91 if–
tmp64
 > 
sûk_öt32_MAX
 ||Åmp64 < 
sûk_öt32_MIN
 ) {

94 
A_QA
[ 
k
 - 
n
 - 1 ] = ( 
›us_öt32
 )
tmp64
;

99 if––
A_QA
[ 
k
 ] > 
A_LIMIT
 ) || ( A_QA[ k ] < -A_LIMIT ) ) {

104 
rc_Q31
 = -
	`sûk_LSHIFT
–
A_QA
[ 0 ], 31 - 
QA
 );

107 
rc_mu…1_Q30
 = 
	`sûk_SUB32
–
	`SILK_FIX_CONST
–1, 30 ), 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 ) );

111 
övGaö_Q30
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–övGaö_Q30, 
rc_mu…1_Q30
 ), 2 );

112 
	`sûk_as£π
–
övGaö_Q30
 >= 0 );

113 
	`sûk_as£π
–
övGaö_Q30
 <= ( 1 << 30 ) );

114 if–
övGaö_Q30
 < 
	`SILK_FIX_CONST
–1.0‡/ 
MAX_PREDICTION_POWER_GAIN
, 30 ) ) {

118  
övGaö_Q30
;

119 
	}
}

122 
›us_öt32
 
	$sûk_LPC_övî£_¥ed_gaö_c
(

123 c⁄° 
›us_öt16
 *
A_Q12
,

124 c⁄° 
›us_öt
 
‹dî


127 
›us_öt
 
k
;

128 
›us_öt32
 
Atmp_QA
[ 
SILK_MAX_ORDER_LPC
 ];

129 
›us_öt32
 
DC_ª•
 = 0;

132  
k
 = 0; k < 
‹dî
; k++ ) {

133 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 
k
 ];

134 
Atmp_QA
[ 
k
 ] = 
	`sûk_LSHIFT32
–(
›us_öt32
)
A_Q12
[ k ], 
QA
 - 12 );

137 if–
DC_ª•
 >= 4096 ) {

140  
	`LPC_övî£_¥ed_gaö_QA_c
–
Atmp_QA
, 
‹dî
 );

141 
	}
}

	@silk/LP_variable_cutoff.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

38 
	~"maö.h
"

41 
OPUS_INLINE
 
	$sûk_LP_öãΩﬁ©e_fûãr_èps
(

42 
›us_öt32
 
B_Q28
[ 
TRANSITION_NB
 ],

43 
›us_öt32
 
A_Q28
[ 
TRANSITION_NA
 ],

44 c⁄° 
›us_öt
 
öd
,

45 c⁄° 
›us_öt32
 
Ác_Q16


48 
›us_öt
 
nb
, 
«
;

50 if–
öd
 < 
TRANSITION_INT_NUM
 - 1 ) {

51 if–
Ác_Q16
 > 0 ) {

52 if–
Ác_Q16
 < 32768 ) {

54  
nb
 = 0;Çb < 
TRANSITION_NB
;Çb++ ) {

55 
B_Q28
[ 
nb
 ] = 
	`sûk_SMLAWB
(

56 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 ][ 
nb
 ],

57 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 + 1 ][ 
nb
 ] -

58 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 ][ 
nb
 ],

59 
Ác_Q16
 );

61  
«
 = 0;Ç®< 
TRANSITION_NA
;Ça++ ) {

62 
A_Q28
[ 
«
 ] = 
	`sûk_SMLAWB
(

63 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 ][ 
«
 ],

64 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 + 1 ][ 
«
 ] -

65 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 ][ 
«
 ],

66 
Ác_Q16
 );

69 
	`sûk_as£π
–
Ác_Q16
 - ( 1 << 16 ) =
	`sûk_SAT16
( fac_Q16 - ( 1 << 16 ) ) );

71  
nb
 = 0;Çb < 
TRANSITION_NB
;Çb++ ) {

72 
B_Q28
[ 
nb
 ] = 
	`sûk_SMLAWB
(

73 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 + 1 ][ 
nb
 ],

74 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 + 1 ][ 
nb
 ] -

75 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 ][ 
nb
 ],

76 
Ác_Q16
 - ( (
›us_öt32
)1 << 16 ) );

78  
«
 = 0;Ç®< 
TRANSITION_NA
;Ça++ ) {

79 
A_Q28
[ 
«
 ] = 
	`sûk_SMLAWB
(

80 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 + 1 ][ 
«
 ],

81 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 + 1 ][ 
«
 ] -

82 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 ][ 
«
 ],

83 
Ác_Q16
 - ( (
›us_öt32
)1 << 16 ) );

87 
	`sûk_mem˝y
–
B_Q28
, 
sûk_Tønsôi⁄_LP_B_Q28
[ 
öd
 ], 
TRANSITION_NB
 * –
›us_öt32
 ) );

88 
	`sûk_mem˝y
–
A_Q28
, 
sûk_Tønsôi⁄_LP_A_Q28
[ 
öd
 ], 
TRANSITION_NA
 * –
›us_öt32
 ) );

91 
	`sûk_mem˝y
–
B_Q28
, 
sûk_Tønsôi⁄_LP_B_Q28
[ 
TRANSITION_INT_NUM
 - 1 ], 
TRANSITION_NB
 * –
›us_öt32
 ) );

92 
	`sûk_mem˝y
–
A_Q28
, 
sûk_Tønsôi⁄_LP_A_Q28
[ 
TRANSITION_INT_NUM
 - 1 ], 
TRANSITION_NA
 * –
›us_öt32
 ) );

94 
	}
}

100 
	$sûk_LP_v¨übÀ_cutoff
(

101 
sûk_LP_°©e
 *
psLP
,

102 
›us_öt16
 *
‰ame
,

103 c⁄° 
›us_öt
 
‰ame_Àngth


106 
›us_öt32
 
B_Q28
[ 
TRANSITION_NB
 ], 
A_Q28
[ 
TRANSITION_NA
 ], 
Ác_Q16
 = 0;

107 
›us_öt
 
öd
 = 0;

109 
	`sûk_as£π
–
psLP
->
å™sôi⁄_‰ame_no
 >0 &&ÖsLP->å™sôi⁄_‰ame_nÿ<
TRANSITION_FRAMES
 );

112 if–
psLP
->
mode
 != 0 ) {

114 #if–
TRANSITION_INT_STEPS
 == 64 )

115 
Ác_Q16
 = 
	`sûk_LSHIFT
–
TRANSITION_FRAMES
 - 
psLP
->
å™sôi⁄_‰ame_no
, 16 - 6 );

117 
Ác_Q16
 = 
	`sûk_DIV32_16
–
	`sûk_LSHIFT
–
TRANSITION_FRAMES
 - 
psLP
->
å™sôi⁄_‰ame_no
, 16 ), TRANSITION_FRAMES );

119 
öd
 = 
	`sûk_RSHIFT
–
Ác_Q16
, 16 );

120 
Ác_Q16
 -
	`sûk_LSHIFT
–
öd
, 16 );

122 
	`sûk_as£π
–
öd
 >= 0 );

123 
	`sûk_as£π
–
öd
 < 
TRANSITION_INT_NUM
 );

126 
	`sûk_LP_öãΩﬁ©e_fûãr_èps
–
B_Q28
, 
A_Q28
, 
öd
, 
Ác_Q16
 );

129 
psLP
->
å™sôi⁄_‰ame_no
 = 
	`sûk_LIMIT
–psLP->å™sôi⁄_‰ame_nÿ+ÖsLP->
mode
, 0, 
TRANSITION_FRAMES
 );

132 
	`sûk_as£π
–
TRANSITION_NB
 =3 && 
TRANSITION_NA
 == 2 );

133 
	`sûk_biquad_Æt_°ride1
–
‰ame
, 
B_Q28
, 
A_Q28
, 
psLP
->
In_LP_Sèã
, føme, 
‰ame_Àngth
);

135 
	}
}

	@silk/MacroCount.h

28 #i‚de‡
SIGPROCFIX_API_MACROCOUNT_H


29 
	#SIGPROCFIX_API_MACROCOUNT_H


	)

30 
	~<°dio.h
>

32 #ifde‡ 
sûk_MACRO_COUNT


33 
	#v¨Deföe
 
›us_öt64
 
›s_cou¡
 = 0;

	)

35 
›us_öt64
 
›s_cou¡
;

37 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SaveCou¡
(){

38 (
›s_cou¡
);

39 
	}
}

41 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SaveRe£tCou¡
(){

42 
›us_öt64
 
ªt
;

44 
ªt
 = 
›s_cou¡
;

45 
›s_cou¡
 = 0;

46 (
ªt
);

47 
	}
}

49 
OPUS_INLINE
 
	$sûk_PrötCou¡
(){

50 
	`¥ötf
("›s_cou¡ = %d \¿", (
›us_öt32
)
›s_cou¡
);

51 
	}
}

53 #unde‡
sûk_MUL


54 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MUL
(
›us_öt32
 
a32
, opus_öt32 
b32
){

55 
›us_öt32
 
ªt
;

56 
›s_cou¡
 += 4;

57 
ªt
 = 
a32
 * 
b32
;

58  
ªt
;

59 
	}
}

61 #unde‡
sûk_MUL_uöt


62 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_MUL_uöt
(
›us_uöt32
 
a32
, opus_uöt32 
b32
){

63 
›us_uöt32
 
ªt
;

64 
›s_cou¡
 += 4;

65 
ªt
 = 
a32
 * 
b32
;

66  
ªt
;

67 
	}
}

68 #unde‡
sûk_MLA


69 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MLA
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

70 
›us_öt32
 
ªt
;

71 
›s_cou¡
 += 4;

72 
ªt
 = 
a32
 + 
b32
 * 
c32
;

73  
ªt
;

74 
	}
}

76 #unde‡
sûk_MLA_uöt


77 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MLA_uöt
(
›us_uöt32
 
a32
, opus_uöt32 
b32
, opus_uöt32 
c32
){

78 
›us_uöt32
 
ªt
;

79 
›s_cou¡
 += 4;

80 
ªt
 = 
a32
 + 
b32
 * 
c32
;

81  
ªt
;

82 
	}
}

84 #unde‡
sûk_SMULWB


85 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWB
(
›us_öt32
 
a32
, opus_öt32 
b32
){

86 
›us_öt32
 
ªt
;

87 
›s_cou¡
 += 5;

88 
ªt
 = (
a32
 >> 16Ë* (
›us_öt32
)((
›us_öt16
)
b32
) + (((a32 & 0x0000FFFF) * (opus_int32)((opus_int16)b32)) >> 16);

89  
ªt
;

90 
	}
}

91 #unde‡
sûk_SMLAWB


92 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWB
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

93 
›us_öt32
 
ªt
;

94 
›s_cou¡
 += 5;

95 
ªt
 = ((
a32
Ë+ ((((
b32
Ë>> 16Ë* (
›us_öt32
)((
›us_öt16
)(
c32
))) + ((((b32) & 0x0000FFFF) * (opus_int32)((opus_int16)(c32))) >> 16)));

96  
ªt
;

97 
	}
}

99 #unde‡
sûk_SMULWT


100 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWT
(
›us_öt32
 
a32
, opus_öt32 
b32
){

101 
›us_öt32
 
ªt
;

102 
›s_cou¡
 += 4;

103 
ªt
 = (
a32
 >> 16Ë* (
b32
 >> 16) + (((a32 & 0x0000FFFF) * (b32 >> 16)) >> 16);

104  
ªt
;

105 
	}
}

106 #unde‡
sûk_SMLAWT


107 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWT
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

108 
›us_öt32
 
ªt
;

109 
›s_cou¡
 += 4;

110 
ªt
 = 
a32
 + ((
b32
 >> 16Ë* (
c32
 >> 16)) + (((b32 & 0x0000FFFF) * ((c32 >> 16)) >> 16));

111  
ªt
;

112 
	}
}

114 #unde‡
sûk_SMULBB


115 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULBB
(
›us_öt32
 
a32
, opus_öt32 
b32
){

116 
›us_öt32
 
ªt
;

117 
›s_cou¡
 += 1;

118 
ªt
 = (
›us_öt32
)((
›us_öt16
)
a32
Ë* (›us_öt32)((›us_öt16)
b32
);

119  
ªt
;

120 
	}
}

121 #unde‡
sûk_SMLABB


122 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABB
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

123 
›us_öt32
 
ªt
;

124 
›s_cou¡
 += 1;

125 
ªt
 = 
a32
 + (
›us_öt32
)((
›us_öt16
)
b32
Ë* (›us_öt32)((›us_öt16)
c32
);

126  
ªt
;

127 
	}
}

129 #unde‡
sûk_SMULBT


130 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULBT
(
›us_öt32
 
a32
, opus_öt32 
b32
 ){

131 
›us_öt32
 
ªt
;

132 
›s_cou¡
 += 4;

133 
ªt
 = ((
›us_öt32
)((
›us_öt16
)
a32
)Ë* (
b32
 >> 16);

134  
ªt
;

135 
	}
}

137 #unde‡
sûk_SMLABT


138 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABT
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

139 
›us_öt32
 
ªt
;

140 
›s_cou¡
 += 1;

141 
ªt
 = 
a32
 + ((
›us_öt32
)((
›us_öt16
)
b32
)Ë* (
c32
 >> 16);

142  
ªt
;

143 
	}
}

145 #unde‡
sûk_SMULTT


146 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULTT
(
›us_öt32
 
a32
, opus_öt32 
b32
){

147 
›us_öt32
 
ªt
;

148 
›s_cou¡
 += 1;

149 
ªt
 = (
a32
 >> 16Ë* (
b32
 >> 16);

150  
ªt
;

151 
	}
}

153 #unde‡
sûk_SMLATT


154 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLATT
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

155 
›us_öt32
 
ªt
;

156 
›s_cou¡
 += 1;

157 
ªt
 = 
a32
 + (
b32
 >> 16Ë* (
c32
 >> 16);

158  
ªt
;

159 
	}
}

163 #unde‡
sûk_MLA_ovÊw


164 
	#sûk_MLA_ovÊw
 
sûk_MLA


	)

166 #unde‡
sûk_SMLABB_ovÊw


167 
	#sûk_SMLABB_ovÊw
 
sûk_SMLABB


	)

169 #unde‡
sûk_SMLABT_ovÊw


170 
	#sûk_SMLABT_ovÊw
 
sûk_SMLABT


	)

172 #unde‡
sûk_SMLATT_ovÊw


173 
	#sûk_SMLATT_ovÊw
 
sûk_SMLATT


	)

175 #unde‡
sûk_SMLAWB_ovÊw


176 
	#sûk_SMLAWB_ovÊw
 
sûk_SMLAWB


	)

178 #unde‡
sûk_SMLAWT_ovÊw


179 
	#sûk_SMLAWT_ovÊw
 
sûk_SMLAWT


	)

181 #unde‡
sûk_SMULL


182 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SMULL
(
›us_öt32
 
a32
, opus_öt32 
b32
){

183 
›us_öt64
 
ªt
;

184 
›s_cou¡
 += 8;

185 
ªt
 = ((
›us_öt64
)(
a32
Ë* (
b32
));

186  
ªt
;

187 
	}
}

189 #unde‡
sûk_SMLAL


190 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SMLAL
(
›us_öt64
 
a64
, 
›us_öt32
 
b32
, opus_öt32 
c32
){

191 
›us_öt64
 
ªt
;

192 
›s_cou¡
 += 8;

193 
ªt
 = 
a64
 + ((
›us_öt64
)(
b32
Ë* (
c32
));

194  
ªt
;

195 
	}
}

196 #unde‡
sûk_SMLALBB


197 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SMLALBB
(
›us_öt64
 
a64
, 
›us_öt16
 
b16
, opus_öt16 
c16
){

198 
›us_öt64
 
ªt
;

199 
›s_cou¡
 += 4;

200 
ªt
 = 
a64
 + ((
›us_öt64
)(
b16
Ë* (
c16
));

201  
ªt
;

202 
	}
}

204 #unde‡
SigProcFIX_CLZ16


205 
OPUS_INLINE
 
›us_öt32
 
	$SigProcFIX_CLZ16
(
›us_öt16
 
ö16
)

207 
›us_öt32
 
out32
 = 0;

208 
›s_cou¡
 += 10;

209 if–
ö16
 == 0 ) {

213 if–
ö16
 & 0xFF00 ) {

214 if–
ö16
 & 0xF000 ) {

215 
ö16
 >>= 12;

217 
out32
 += 4;

218 
ö16
 >>= 8;

221 if–
ö16
 & 0xFFF0 ) {

222 
out32
 += 8;

223 
ö16
 >>= 4;

225 
out32
 += 12;

229 if–
ö16
 & 0xC ) {

230 if–
ö16
 & 0x8 )

231  
out32
 + 0;

233  
out32
 + 1;

235 if–
ö16
 & 0xE )

236  
out32
 + 2;

238  
out32
 + 3;

240 
	}
}

242 #unde‡
SigProcFIX_CLZ32


243 
OPUS_INLINE
 
›us_öt32
 
	$SigProcFIX_CLZ32
(
›us_öt32
 
ö32
)

246 
›s_cou¡
 += 2;

247 if–
ö32
 & 0xFFFF0000 ) {

248  
	`SigProcFIX_CLZ16
((
›us_öt16
)(
ö32
 >> 16));

250  
	`SigProcFIX_CLZ16
((
›us_öt16
)
ö32
) + 16;

252 
	}
}

254 #unde‡
sûk_DIV32


255 
OPUS_INLINE
 
›us_öt32
 
	$sûk_DIV32
(
›us_öt32
 
a32
, opus_öt32 
b32
){

256 
›s_cou¡
 += 64;

257  
a32
 / 
b32
;

258 
	}
}

260 #unde‡
sûk_DIV32_16


261 
OPUS_INLINE
 
›us_öt32
 
	$sûk_DIV32_16
(
›us_öt32
 
a32
, opus_öt32 
b32
){

262 
›s_cou¡
 += 32;

263  
a32
 / 
b32
;

264 
	}
}

266 #unde‡
sûk_SAT8


267 
OPUS_INLINE
 
›us_öt8
 
	$sûk_SAT8
(
›us_öt64
 
a
){

268 
›us_öt8
 
tmp
;

269 
›s_cou¡
 += 1;

270 
tmp
 = (
›us_öt8
)((
a
Ë> 
sûk_öt8_MAX
 ? silk_int8_MAX : \

271 ((
a
Ë< 
sûk_öt8_MIN
 ? silk_int8_MIN : (a)));

272 (
tmp
);

273 
	}
}

275 #unde‡
sûk_SAT16


276 
OPUS_INLINE
 
›us_öt16
 
	$sûk_SAT16
(
›us_öt64
 
a
){

277 
›us_öt16
 
tmp
;

278 
›s_cou¡
 += 1;

279 
tmp
 = (
›us_öt16
)((
a
Ë> 
sûk_öt16_MAX
 ? silk_int16_MAX : \

280 ((
a
Ë< 
sûk_öt16_MIN
 ? silk_int16_MIN : (a)));

281 (
tmp
);

282 
	}
}

283 #unde‡
sûk_SAT32


284 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SAT32
(
›us_öt64
 
a
){

285 
›us_öt32
 
tmp
;

286 
›s_cou¡
 += 1;

287 
tmp
 = (
›us_öt32
)((
a
Ë> 
sûk_öt32_MAX
 ? silk_int32_MAX : \

288 ((
a
Ë< 
sûk_öt32_MIN
 ? silk_int32_MIN : (a)));

289 (
tmp
);

290 
	}
}

291 #unde‡
sûk_POS_SAT32


292 
OPUS_INLINE
 
›us_öt32
 
	$sûk_POS_SAT32
(
›us_öt64
 
a
){

293 
›us_öt32
 
tmp
;

294 
›s_cou¡
 += 1;

295 
tmp
 = (
›us_öt32
)((
a
Ë> 
sûk_öt32_MAX
 ? silk_int32_MAX : (a));

296 (
tmp
);

297 
	}
}

299 #unde‡
sûk_ADD_POS_SAT8


300 
OPUS_INLINE
 
›us_öt8
 
	$sûk_ADD_POS_SAT8
(
›us_öt64
 
a
, opus_öt64 
b
){

301 
›us_öt8
 
tmp
;

302 
›s_cou¡
 += 1;

303 
tmp
 = (
›us_öt8
)((((
a
)+(
b
)Ë& 0x80Ë? 
sûk_öt8_MAX
 : ((a)+(b)));

304 (
tmp
);

305 
	}
}

306 #unde‡
sûk_ADD_POS_SAT16


307 
OPUS_INLINE
 
›us_öt16
 
	$sûk_ADD_POS_SAT16
(
›us_öt64
 
a
, opus_öt64 
b
){

308 
›us_öt16
 
tmp
;

309 
›s_cou¡
 += 1;

310 
tmp
 = (
›us_öt16
)((((
a
)+(
b
)Ë& 0x8000Ë? 
sûk_öt16_MAX
 : ((a)+(b)));

311 (
tmp
);

312 
	}
}

314 #unde‡
sûk_ADD_POS_SAT32


315 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_POS_SAT32
(
›us_öt64
 
a
, opus_öt64 
b
){

316 
›us_öt32
 
tmp
;

317 
›s_cou¡
 += 1;

318 
tmp
 = (
›us_öt32
)((((
a
)+(
b
)Ë& 0x80000000Ë? 
sûk_öt32_MAX
 : ((a)+(b)));

319 (
tmp
);

320 
	}
}

322 #unde‡
sûk_LSHIFT8


323 
OPUS_INLINE
 
›us_öt8
 
	$sûk_LSHIFT8
(
›us_öt8
 
a
, 
›us_öt32
 
shi·
){

324 
›us_öt8
 
ªt
;

325 
›s_cou¡
 += 1;

326 
ªt
 = 
a
 << 
shi·
;

327  
ªt
;

328 
	}
}

329 #unde‡
sûk_LSHIFT16


330 
OPUS_INLINE
 
›us_öt16
 
	$sûk_LSHIFT16
(
›us_öt16
 
a
, 
›us_öt32
 
shi·
){

331 
›us_öt16
 
ªt
;

332 
›s_cou¡
 += 1;

333 
ªt
 = 
a
 << 
shi·
;

334  
ªt
;

335 
	}
}

336 #unde‡
sûk_LSHIFT32


337 
OPUS_INLINE
 
›us_öt32
 
	$sûk_LSHIFT32
(
›us_öt32
 
a
, opus_öt32 
shi·
){

338 
›us_öt32
 
ªt
;

339 
›s_cou¡
 += 1;

340 
ªt
 = 
a
 << 
shi·
;

341  
ªt
;

342 
	}
}

343 #unde‡
sûk_LSHIFT64


344 
OPUS_INLINE
 
›us_öt64
 
	$sûk_LSHIFT64
(
›us_öt64
 
a
, 
›us_öt
 
shi·
){

345 
›s_cou¡
 += 1;

346  
a
 << 
shi·
;

347 
	}
}

349 #unde‡
sûk_LSHIFT_ovÊw


350 
OPUS_INLINE
 
›us_öt32
 
	$sûk_LSHIFT_ovÊw
(
›us_öt32
 
a
, opus_öt32 
shi·
){

351 
›s_cou¡
 += 1;

352  
a
 << 
shi·
;

353 
	}
}

355 #unde‡
sûk_LSHIFT_uöt


356 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_LSHIFT_uöt
(
›us_uöt32
 
a
, 
›us_öt32
 
shi·
){

357 
›us_uöt32
 
ªt
;

358 
›s_cou¡
 += 1;

359 
ªt
 = 
a
 << 
shi·
;

360  
ªt
;

361 
	}
}

363 #unde‡
sûk_RSHIFT8


364 
OPUS_INLINE
 
›us_öt8
 
	$sûk_RSHIFT8
(
›us_öt8
 
a
, 
›us_öt32
 
shi·
){

365 
›s_cou¡
 += 1;

366  
a
 >> 
shi·
;

367 
	}
}

368 #unde‡
sûk_RSHIFT16


369 
OPUS_INLINE
 
›us_öt16
 
	$sûk_RSHIFT16
(
›us_öt16
 
a
, 
›us_öt32
 
shi·
){

370 
›s_cou¡
 += 1;

371  
a
 >> 
shi·
;

372 
	}
}

373 #unde‡
sûk_RSHIFT32


374 
OPUS_INLINE
 
›us_öt32
 
	$sûk_RSHIFT32
(
›us_öt32
 
a
, opus_öt32 
shi·
){

375 
›s_cou¡
 += 1;

376  
a
 >> 
shi·
;

377 
	}
}

378 #unde‡
sûk_RSHIFT64


379 
OPUS_INLINE
 
›us_öt64
 
	$sûk_RSHIFT64
(
›us_öt64
 
a
, opus_öt64 
shi·
){

380 
›s_cou¡
 += 1;

381  
a
 >> 
shi·
;

382 
	}
}

384 #unde‡
sûk_RSHIFT_uöt


385 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_RSHIFT_uöt
(
›us_uöt32
 
a
, 
›us_öt32
 
shi·
){

386 
›s_cou¡
 += 1;

387  
a
 >> 
shi·
;

388 
	}
}

390 #unde‡
sûk_ADD_LSHIFT


391 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_LSHIFT
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

392 
›us_öt32
 
ªt
;

393 
›s_cou¡
 += 1;

394 
ªt
 = 
a
 + (
b
 << 
shi·
);

395  
ªt
;

396 
	}
}

397 #unde‡
sûk_ADD_LSHIFT32


398 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_LSHIFT32
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

399 
›us_öt32
 
ªt
;

400 
›s_cou¡
 += 1;

401 
ªt
 = 
a
 + (
b
 << 
shi·
);

402  
ªt
;

403 
	}
}

404 #unde‡
sûk_ADD_LSHIFT_uöt


405 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_ADD_LSHIFT_uöt
(
›us_uöt32
 
a
, opus_uöt32 
b
, 
›us_öt32
 
shi·
){

406 
›us_uöt32
 
ªt
;

407 
›s_cou¡
 += 1;

408 
ªt
 = 
a
 + (
b
 << 
shi·
);

409  
ªt
;

410 
	}
}

411 #unde‡
sûk_ADD_RSHIFT


412 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_RSHIFT
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

413 
›us_öt32
 
ªt
;

414 
›s_cou¡
 += 1;

415 
ªt
 = 
a
 + (
b
 >> 
shi·
);

416  
ªt
;

417 
	}
}

418 #unde‡
sûk_ADD_RSHIFT32


419 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_RSHIFT32
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

420 
›us_öt32
 
ªt
;

421 
›s_cou¡
 += 1;

422 
ªt
 = 
a
 + (
b
 >> 
shi·
);

423  
ªt
;

424 
	}
}

425 #unde‡
sûk_ADD_RSHIFT_uöt


426 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_ADD_RSHIFT_uöt
(
›us_uöt32
 
a
, opus_uöt32 
b
, 
›us_öt32
 
shi·
){

427 
›us_uöt32
 
ªt
;

428 
›s_cou¡
 += 1;

429 
ªt
 = 
a
 + (
b
 >> 
shi·
);

430  
ªt
;

431 
	}
}

432 #unde‡
sûk_SUB_LSHIFT32


433 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_LSHIFT32
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

434 
›us_öt32
 
ªt
;

435 
›s_cou¡
 += 1;

436 
ªt
 = 
a
 - (
b
 << 
shi·
);

437  
ªt
;

438 
	}
}

439 #unde‡
sûk_SUB_RSHIFT32


440 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_RSHIFT32
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
){

441 
›us_öt32
 
ªt
;

442 
›s_cou¡
 += 1;

443 
ªt
 = 
a
 - (
b
 >> 
shi·
);

444  
ªt
;

445 
	}
}

447 #unde‡
sûk_RSHIFT_ROUND


448 
OPUS_INLINE
 
›us_öt32
 
	$sûk_RSHIFT_ROUND
(
›us_öt32
 
a
, opus_öt32 
shi·
){

449 
›us_öt32
 
ªt
;

450 
›s_cou¡
 += 3;

451 
ªt
 = 
shi·
 =1 ? (
a
 >> 1) + (a & 1) : ((a >> (shift - 1)) + 1) >> 1;

452  
ªt
;

453 
	}
}

455 #unde‡
sûk_RSHIFT_ROUND64


456 
OPUS_INLINE
 
›us_öt64
 
	$sûk_RSHIFT_ROUND64
(
›us_öt64
 
a
, 
›us_öt32
 
shi·
){

457 
›us_öt64
 
ªt
;

458 
›s_cou¡
 += 6;

459 
ªt
 = 
shi·
 =1 ? (
a
 >> 1) + (a & 1) : ((a >> (shift - 1)) + 1) >> 1;

460  
ªt
;

461 
	}
}

463 #unde‡
sûk_abs_öt64


464 
OPUS_INLINE
 
›us_öt64
 
	$sûk_abs_öt64
(
›us_öt64
 
a
){

465 
›s_cou¡
 += 1;

466  (((
a
) > 0) ? (a) : -(a));

467 
	}
}

469 #unde‡
sûk_abs_öt32


470 
OPUS_INLINE
 
›us_öt32
 
	$sûk_abs_öt32
(
›us_öt32
 
a
){

471 
›s_cou¡
 += 1;

472  
	`sûk_abs
(
a
);

473 
	}
}

476 #unde‡
sûk_mö


477 
	$sûk_mö
(
a
, 
b
){

478 
›s_cou¡
 += 1;

479  (((
a
Ë< (
b
)) ? (a) : (b));

480 
	}
}

481 #unde‡
sûk_max


482 
	$sûk_max
(
a
, 
b
){

483 
›s_cou¡
 += 1;

484  (((
a
Ë> (
b
)) ? (a) : (b));

485 
	}
}

486 #unde‡
sûk_sign


487 
	$sûk_sign
(
a
){

488 
›s_cou¡
 += 1;

489  ((
a
) > 0 ? 1 : ( (a) < 0 ? -1 : 0 ));

490 
	}
}

492 #unde‡
sûk_ADD16


493 
OPUS_INLINE
 
›us_öt16
 
	$sûk_ADD16
(
›us_öt16
 
a
, opus_öt16 
b
){

494 
›us_öt16
 
ªt
;

495 
›s_cou¡
 += 1;

496 
ªt
 = 
a
 + 
b
;

497  
ªt
;

498 
	}
}

500 #unde‡
sûk_ADD32


501 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD32
(
›us_öt32
 
a
, opus_öt32 
b
){

502 
›us_öt32
 
ªt
;

503 
›s_cou¡
 += 1;

504 
ªt
 = 
a
 + 
b
;

505  
ªt
;

506 
	}
}

508 #unde‡
sûk_ADD64


509 
OPUS_INLINE
 
›us_öt64
 
	$sûk_ADD64
(
›us_öt64
 
a
, opus_öt64 
b
){

510 
›us_öt64
 
ªt
;

511 
›s_cou¡
 += 2;

512 
ªt
 = 
a
 + 
b
;

513  
ªt
;

514 
	}
}

516 #unde‡
sûk_SUB16


517 
OPUS_INLINE
 
›us_öt16
 
	$sûk_SUB16
(
›us_öt16
 
a
, opus_öt16 
b
){

518 
›us_öt16
 
ªt
;

519 
›s_cou¡
 += 1;

520 
ªt
 = 
a
 - 
b
;

521  
ªt
;

522 
	}
}

524 #unde‡
sûk_SUB32


525 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB32
(
›us_öt32
 
a
, opus_öt32 
b
){

526 
›us_öt32
 
ªt
;

527 
›s_cou¡
 += 1;

528 
ªt
 = 
a
 - 
b
;

529  
ªt
;

530 
	}
}

532 #unde‡
sûk_SUB64


533 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SUB64
(
›us_öt64
 
a
, opus_öt64 
b
){

534 
›us_öt64
 
ªt
;

535 
›s_cou¡
 += 2;

536 
ªt
 = 
a
 - 
b
;

537  
ªt
;

538 
	}
}

540 #unde‡
sûk_ADD_SAT16


541 
OPUS_INLINE
 
›us_öt16
 
	$sûk_ADD_SAT16
–
›us_öt16
 
a16
, opus_öt16 
b16
 ) {

542 
›us_öt16
 
ªs
;

544 
ªs
 = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_ADD32
–(
›us_öt32
)(
a16
), (
b16
) ) );

545  
ªs
;

546 
	}
}

548 #unde‡
sûk_ADD_SAT32


549 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_SAT32
(
›us_öt32
 
a32
, opus_öt32 
b32
){

550 
›us_öt32
 
ªs
;

551 
›s_cou¡
 += 1;

552 
ªs
 = ((((
a32
Ë+ (
b32
)) & 0x80000000) == 0 ? \

553 ((((
a32
Ë& (
b32
)Ë& 0x80000000Ë!0 ? 
sûk_öt32_MIN
 : (a32)+(b32)) : \

554 ((((
a32
Ë| (
b32
)Ë& 0x80000000Ë=0 ? 
sûk_öt32_MAX
 : (a32)+(b32)) );

555  
ªs
;

556 
	}
}

558 #unde‡
sûk_ADD_SAT64


559 
OPUS_INLINE
 
›us_öt64
 
	$sûk_ADD_SAT64
–
›us_öt64
 
a64
, opus_öt64 
b64
 ) {

560 
›us_öt64
 
ªs
;

561 
›s_cou¡
 += 1;

562 
ªs
 = ((((
a64
Ë+ (
b64
)) & 0x8000000000000000LL) == 0 ? \

563 ((((
a64
Ë& (
b64
)Ë& 0x8000000000000000LLË!0 ? 
sûk_öt64_MIN
 : (a64)+(b64)) : \

564 ((((
a64
Ë| (
b64
)Ë& 0x8000000000000000LLË=0 ? 
sûk_öt64_MAX
 : (a64)+(b64)) );

565  
ªs
;

566 
	}
}

568 #unde‡
sûk_SUB_SAT16


569 
OPUS_INLINE
 
›us_öt16
 
	$sûk_SUB_SAT16
–
›us_öt16
 
a16
, opus_öt16 
b16
 ) {

570 
›us_öt16
 
ªs
;

571 
	`sûk_as£π
(0);

573 
ªs
 = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_SUB32
–(
›us_öt32
)(
a16
), (
b16
) ) );

574  
ªs
;

575 
	}
}

577 #unde‡
sûk_SUB_SAT32


578 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_SAT32
–
›us_öt32
 
a32
, opus_öt32 
b32
 ) {

579 
›us_öt32
 
ªs
;

580 
›s_cou¡
 += 1;

581 
ªs
 = ((((
a32
)-(
b32
)) & 0x80000000) == 0 ? \

582 (–(
a32
Ë& ((
b32
)^0x80000000Ë& 0x80000000Ë? 
sûk_öt32_MIN
 : (a32)-(b32)) : \

583 ((((
a32
)^0x80000000Ë& (
b32
Ë& 0x80000000Ë? 
sûk_öt32_MAX
 : (a32)-(b32)) );

584  
ªs
;

585 
	}
}

587 #unde‡
sûk_SUB_SAT64


588 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SUB_SAT64
–
›us_öt64
 
a64
, opus_öt64 
b64
 ) {

589 
›us_öt64
 
ªs
;

590 
›s_cou¡
 += 1;

591 
ªs
 = ((((
a64
)-(
b64
)) & 0x8000000000000000LL) == 0 ? \

592 (–(
a64
Ë& ((
b64
)^0x8000000000000000LLË& 0x8000000000000000LLË? 
sûk_öt64_MIN
 : (a64)-(b64)) : \

593 ((((
a64
)^0x8000000000000000LLË& (
b64
Ë& 0x8000000000000000LLË? 
sûk_öt64_MAX
 : (a64)-(b64)) );

595  
ªs
;

596 
	}
}

598 #unde‡
sûk_SMULWW


599 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWW
(
›us_öt32
 
a32
, opus_öt32 
b32
){

600 
›us_öt32
 
ªt
;

602 
ªt
 = 
	`sûk_MLA
(
	`sûk_SMULWB
((
a32
), (
b32
)), (a32), 
	`sûk_RSHIFT_ROUND
((b32), 16));

603  
ªt
;

604 
	}
}

606 #unde‡
sûk_SMLAWW


607 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWW
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
){

608 
›us_öt32
 
ªt
;

610 
ªt
 = 
	`sûk_MLA
(
	`sûk_SMLAWB
((
a32
), (
b32
), (
c32
)), (b32), 
	`sûk_RSHIFT_ROUND
((c32), 16));

611  
ªt
;

612 
	}
}

614 #unde‡
sûk_mö_öt


615 
OPUS_INLINE
 
›us_öt
 
	$sûk_mö_öt
(
›us_öt
 
a
, opus_öà
b
)

617 
›s_cou¡
 += 1;

618  (((
a
Ë< (
b
)) ? (a) : (b));

619 
	}
}

621 #unde‡
sûk_mö_16


622 
OPUS_INLINE
 
›us_öt16
 
	$sûk_mö_16
(
›us_öt16
 
a
, opus_öt16 
b
)

624 
›s_cou¡
 += 1;

625  (((
a
Ë< (
b
)) ? (a) : (b));

626 
	}
}

627 #unde‡
sûk_mö_32


628 
OPUS_INLINE
 
›us_öt32
 
	$sûk_mö_32
(
›us_öt32
 
a
, opus_öt32 
b
)

630 
›s_cou¡
 += 1;

631  (((
a
Ë< (
b
)) ? (a) : (b));

632 
	}
}

633 #unde‡
sûk_mö_64


634 
OPUS_INLINE
 
›us_öt64
 
	$sûk_mö_64
(
›us_öt64
 
a
, opus_öt64 
b
)

636 
›s_cou¡
 += 1;

637  (((
a
Ë< (
b
)) ? (a) : (b));

638 
	}
}

641 #unde‡
sûk_max_öt


642 
OPUS_INLINE
 
›us_öt
 
	$sûk_max_öt
(
›us_öt
 
a
, opus_öà
b
)

644 
›s_cou¡
 += 1;

645  (((
a
Ë> (
b
)) ? (a) : (b));

646 
	}
}

647 #unde‡
sûk_max_16


648 
OPUS_INLINE
 
›us_öt16
 
	$sûk_max_16
(
›us_öt16
 
a
, opus_öt16 
b
)

650 
›s_cou¡
 += 1;

651  (((
a
Ë> (
b
)) ? (a) : (b));

652 
	}
}

653 #unde‡
sûk_max_32


654 
OPUS_INLINE
 
›us_öt32
 
	$sûk_max_32
(
›us_öt32
 
a
, opus_öt32 
b
)

656 
›s_cou¡
 += 1;

657  (((
a
Ë> (
b
)) ? (a) : (b));

658 
	}
}

660 #unde‡
sûk_max_64


661 
OPUS_INLINE
 
›us_öt64
 
	$sûk_max_64
(
›us_öt64
 
a
, opus_öt64 
b
)

663 
›s_cou¡
 += 1;

664  (((
a
Ë> (
b
)) ? (a) : (b));

665 
	}
}

668 #unde‡
sûk_LIMIT_öt


669 
OPUS_INLINE
 
›us_öt
 
	$sûk_LIMIT_öt
(
›us_öt
 
a
, opus_öà
limô1
, opus_öà
limô2
)

671 
›us_öt
 
ªt
;

672 
›s_cou¡
 += 6;

674 
ªt
 = ((
limô1
Ë> (
limô2
Ë? ((
a
) > (limit1) ? (limit1) : ((a) < (limit2) ? (limit2) : (a))) \

675 : ((
a
Ë> (
limô2
Ë? (limô2Ë: (◊Ë< (
limô1
) ? (limit1) : (a))));

677 (
ªt
);

678 
	}
}

680 #unde‡
sûk_LIMIT_16


681 
OPUS_INLINE
 
›us_öt16
 
	$sûk_LIMIT_16
(
›us_öt16
 
a
, opus_öt16 
limô1
, opus_öt16 
limô2
)

683 
›us_öt16
 
ªt
;

684 
›s_cou¡
 += 6;

686 
ªt
 = ((
limô1
Ë> (
limô2
Ë? ((
a
) > (limit1) ? (limit1) : ((a) < (limit2) ? (limit2) : (a))) \

687 : ((
a
Ë> (
limô2
Ë? (limô2Ë: (◊Ë< (
limô1
) ? (limit1) : (a))));

689 (
ªt
);

690 
	}
}

693 #unde‡
sûk_LIMIT_32


694 
OPUS_INLINE
 
›us_öt32
 
	$sûk_LIMIT_32
(
›us_öt32
 
a
, opus_öt32 
limô1
, opus_öt32 
limô2
)

696 
›us_öt32
 
ªt
;

697 
›s_cou¡
 += 6;

699 
ªt
 = ((
limô1
Ë> (
limô2
Ë? ((
a
) > (limit1) ? (limit1) : ((a) < (limit2) ? (limit2) : (a))) \

700 : ((
a
Ë> (
limô2
Ë? (limô2Ë: (◊Ë< (
limô1
) ? (limit1) : (a))));

701 (
ªt
);

702 
	}
}

705 
	#v¨Deföe


	)

706 
	#sûk_SaveCou¡
()

	)

	@silk/MacroDebug.h

29 #i‚de‡
MACRO_DEBUG_H


30 
	#MACRO_DEBUG_H


	)

35 #i‡–
deföed
 (
FIXED_DEBUG
Ë|| ( 0 && deföed (
_DEBUG
ËËË&& !deföed (
sûk_MACRO_COUNT
)

37 #unde‡
sûk_ADD16


38 
	#sûk_ADD16
(
a
,
b
Ë
	`sûk_ADD16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

39 
OPUS_INLINE
 
›us_öt16
 
	$sûk_ADD16_
(
›us_öt16
 
a
, opus_öt16 
b
, *
fûe
, 
löe
){

40 
›us_öt16
 
ªt
;

42 
ªt
 = 
a
 + 
b
;

43 i‡–
ªt
 !
	`sûk_ADD_SAT16
–
a
, 
b
 ) )

45 
	`Ârötf
 (
°dîr
, "sûk_ADD16(%d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

46 #ifde‡
FIXED_DEBUG_ASSERT


47 
	`sûk_as£π
( 0 );

50  
ªt
;

51 
	}
}

53 #unde‡
sûk_ADD32


54 
	#sûk_ADD32
(
a
,
b
Ë
	`sûk_ADD32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

55 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD32_
(
›us_öt32
 
a
, opus_öt32 
b
, *
fûe
, 
löe
){

56 
›us_öt32
 
ªt
;

58 
ªt
 = 
a
 + 
b
;

59 i‡–
ªt
 !
	`sûk_ADD_SAT32
–
a
, 
b
 ) )

61 
	`Ârötf
 (
°dîr
, "sûk_ADD32(%d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

62 #ifde‡
FIXED_DEBUG_ASSERT


63 
	`sûk_as£π
( 0 );

66  
ªt
;

67 
	}
}

69 #unde‡
sûk_ADD64


70 
	#sûk_ADD64
(
a
,
b
Ë
	`sûk_ADD64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

71 
OPUS_INLINE
 
›us_öt64
 
	$sûk_ADD64_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
){

72 
›us_öt64
 
ªt
;

74 
ªt
 = 
a
 + 
b
;

75 i‡–
ªt
 !
	`sûk_ADD_SAT64
–
a
, 
b
 ) )

77 
	`Ârötf
 (
°dîr
, "sûk_ADD64(%Œd, %ŒdËö %s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

78 #ifde‡
FIXED_DEBUG_ASSERT


79 
	`sûk_as£π
( 0 );

82  
ªt
;

83 
	}
}

85 #unde‡
sûk_SUB16


86 
	#sûk_SUB16
(
a
,
b
Ë
	`sûk_SUB16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

87 
OPUS_INLINE
 
›us_öt16
 
	$sûk_SUB16_
(
›us_öt16
 
a
, opus_öt16 
b
, *
fûe
, 
löe
){

88 
›us_öt16
 
ªt
;

90 
ªt
 = 
a
 - 
b
;

91 i‡–
ªt
 !
	`sûk_SUB_SAT16
–
a
, 
b
 ) )

93 
	`Ârötf
 (
°dîr
, "sûk_SUB16(%d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

94 #ifde‡
FIXED_DEBUG_ASSERT


95 
	`sûk_as£π
( 0 );

98  
ªt
;

99 
	}
}

101 #unde‡
sûk_SUB32


102 
	#sûk_SUB32
(
a
,
b
Ë
	`sûk_SUB32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

103 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB32_
(
›us_öt32
 
a
, opus_öt32 
b
, *
fûe
, 
löe
){

104 
›us_öt32
 
ªt
;

106 
ªt
 = 
a
 - 
b
;

107 i‡–
ªt
 !
	`sûk_SUB_SAT32
–
a
, 
b
 ) )

109 
	`Ârötf
 (
°dîr
, "sûk_SUB32(%d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
fûe
, 
löe
);

110 #ifde‡
FIXED_DEBUG_ASSERT


111 
	`sûk_as£π
( 0 );

114  
ªt
;

115 
	}
}

117 #unde‡
sûk_SUB64


118 
	#sûk_SUB64
(
a
,
b
Ë
	`sûk_SUB64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

119 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SUB64_
(
›us_öt64
 
a
, opus_öt64 
b
, *
fûe
, 
löe
){

120 
›us_öt64
 
ªt
;

122 
ªt
 = 
a
 - 
b
;

123 i‡–
ªt
 !
	`sûk_SUB_SAT64
–
a
, 
b
 ) )

125 
	`Ârötf
 (
°dîr
, "sûk_SUB64(%Œd, %ŒdËö %s:Üöê%d\n", ()
a
, ()
b
, 
fûe
, 
löe
);

126 #ifde‡
FIXED_DEBUG_ASSERT


127 
	`sûk_as£π
( 0 );

130  
ªt
;

131 
	}
}

133 #unde‡
sûk_ADD_SAT16


134 
	#sûk_ADD_SAT16
(
a
,
b
Ë
	`sûk_ADD_SAT16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

135 
OPUS_INLINE
 
›us_öt16
 
	$sûk_ADD_SAT16_
–
›us_öt16
 
a16
, opus_öt16 
b16
, *
fûe
, 
löe
) {

136 
›us_öt16
 
ªs
;

137 
ªs
 = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_ADD32
–(
›us_öt32
)(
a16
), (
b16
) ) );

138 i‡–
ªs
 !
	`sûk_SAT16
–(
›us_öt32
)
a16
 + (›us_öt32)
b16
 ) )

140 
	`Ârötf
 (
°dîr
, "sûk_ADD_SAT16(%d, %dËö %s:Üöê%d\n", 
a16
, 
b16
, 
fûe
, 
löe
);

141 #ifde‡
FIXED_DEBUG_ASSERT


142 
	`sûk_as£π
( 0 );

145  
ªs
;

146 
	}
}

148 #unde‡
sûk_ADD_SAT32


149 
	#sûk_ADD_SAT32
(
a
,
b
Ë
	`sûk_ADD_SAT32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

150 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_SAT32_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

151 
›us_öt32
 
ªs
;

152 
ªs
 = ((((
›us_uöt32
)(
a32
Ë+ (›us_uöt32)(
b32
)) & 0x80000000) == 0 ? \

153 ((((
a32
Ë& (
b32
)Ë& 0x80000000Ë!0 ? 
sûk_öt32_MIN
 : (a32)+(b32)) : \

154 ((((
a32
Ë| (
b32
)Ë& 0x80000000Ë=0 ? 
sûk_öt32_MAX
 : (a32)+(b32)) );

155 i‡–
ªs
 !
	`sûk_SAT32
–(
›us_öt64
)
a32
 + (›us_öt64)
b32
 ) )

157 
	`Ârötf
 (
°dîr
, "sûk_ADD_SAT32(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

158 #ifde‡
FIXED_DEBUG_ASSERT


159 
	`sûk_as£π
( 0 );

162  
ªs
;

163 
	}
}

165 #unde‡
sûk_ADD_SAT64


166 
	#sûk_ADD_SAT64
(
a
,
b
Ë
	`sûk_ADD_SAT64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

167 
OPUS_INLINE
 
›us_öt64
 
	$sûk_ADD_SAT64_
–
›us_öt64
 
a64
, opus_öt64 
b64
, *
fûe
, 
löe
) {

168 
›us_öt64
 
ªs
;

169 
Áû
 = 0;

170 
ªs
 = ((((
a64
Ë+ (
b64
)) & 0x8000000000000000LL) == 0 ? \

171 ((((
a64
Ë& (
b64
)Ë& 0x8000000000000000LLË!0 ? 
sûk_öt64_MIN
 : (a64)+(b64)) : \

172 ((((
a64
Ë| (
b64
)Ë& 0x8000000000000000LLË=0 ? 
sûk_öt64_MAX
 : (a64)+(b64)) );

173 if–
ªs
 !
a64
 + 
b64
 ) {

175 i‡–!(–
ªs
 =
sûk_öt64_MAX
 && ( ( 
a64
 >> 1 ) + ( 
b64
 >> 1 ) > ( silk_int64_MAX >> 3 ) ) ) ||

176 –
ªs
 =
sûk_öt64_MIN
 && ( ( 
a64
 >> 1 ) + ( 
b64
 >> 1 ) < ( silk_int64_MIN >> 3 ) ) ) ) )

178 
Áû
 = 1;

182 
Áû
 = 
ªs
 !
a64
 + 
b64
;

184 i‡–
Áû
 )

186 
	`Ârötf
 (
°dîr
, "sûk_ADD_SAT64(%Œd, %ŒdËö %s:Üöê%d\n", ()
a64
, ()
b64
, 
fûe
, 
löe
);

187 #ifde‡
FIXED_DEBUG_ASSERT


188 
	`sûk_as£π
( 0 );

191  
ªs
;

192 
	}
}

194 #unde‡
sûk_SUB_SAT16


195 
	#sûk_SUB_SAT16
(
a
,
b
Ë
	`sûk_SUB_SAT16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

196 
OPUS_INLINE
 
›us_öt16
 
	$sûk_SUB_SAT16_
–
›us_öt16
 
a16
, opus_öt16 
b16
, *
fûe
, 
löe
 ) {

197 
›us_öt16
 
ªs
;

198 
ªs
 = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_SUB32
–(
›us_öt32
)(
a16
), (
b16
) ) );

199 i‡–
ªs
 !
	`sûk_SAT16
–(
›us_öt32
)
a16
 - (›us_öt32)
b16
 ) )

201 
	`Ârötf
 (
°dîr
, "sûk_SUB_SAT16(%d, %dËö %s:Üöê%d\n", 
a16
, 
b16
, 
fûe
, 
löe
);

202 #ifde‡
FIXED_DEBUG_ASSERT


203 
	`sûk_as£π
( 0 );

206  
ªs
;

207 
	}
}

209 #unde‡
sûk_SUB_SAT32


210 
	#sûk_SUB_SAT32
(
a
,
b
Ë
	`sûk_SUB_SAT32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

211 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_SAT32_
–
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
 ) {

212 
›us_öt32
 
ªs
;

213 
ªs
 = ((((
›us_uöt32
)(
a32
)-(›us_uöt32)(
b32
)) & 0x80000000) == 0 ? \

214 (–(
a32
Ë& ((
b32
)^0x80000000Ë& 0x80000000Ë? 
sûk_öt32_MIN
 : (a32)-(b32)) : \

215 ((((
a32
)^0x80000000Ë& (
b32
Ë& 0x80000000Ë? 
sûk_öt32_MAX
 : (a32)-(b32)) );

216 i‡–
ªs
 !
	`sûk_SAT32
–(
›us_öt64
)
a32
 - (›us_öt64)
b32
 ) )

218 
	`Ârötf
 (
°dîr
, "sûk_SUB_SAT32(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

219 #ifde‡
FIXED_DEBUG_ASSERT


220 
	`sûk_as£π
( 0 );

223  
ªs
;

224 
	}
}

226 #unde‡
sûk_SUB_SAT64


227 
	#sûk_SUB_SAT64
(
a
,
b
Ë
	`sûk_SUB_SAT64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

228 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SUB_SAT64_
–
›us_öt64
 
a64
, opus_öt64 
b64
, *
fûe
, 
löe
 ) {

229 
›us_öt64
 
ªs
;

230 
Áû
 = 0;

231 
ªs
 = ((((
a64
)-(
b64
)) & 0x8000000000000000LL) == 0 ? \

232 (–(
a64
Ë& ((
b64
)^0x8000000000000000LLË& 0x8000000000000000LLË? 
sûk_öt64_MIN
 : (a64)-(b64)) : \

233 ((((
a64
)^0x8000000000000000LLË& (
b64
Ë& 0x8000000000000000LLË? 
sûk_öt64_MAX
 : (a64)-(b64)) );

234 if–
ªs
 !
a64
 - 
b64
 ) {

236 if–!(–
ªs
 =
sûk_öt64_MAX
 && ( ( 
a64
 >> 1 ) + ( 
b64
 >> 1 ) > ( silk_int64_MAX >> 3 ) ) ) ||

237 –
ªs
 =
sûk_öt64_MIN
 && ( ( 
a64
 >> 1 ) + ( 
b64
 >> 1 ) < ( silk_int64_MIN >> 3 ) ) ) ))

239 
Áû
 = 1;

243 
Áû
 = 
ªs
 !
a64
 - 
b64
;

245 i‡–
Áû
 )

247 
	`Ârötf
 (
°dîr
, "sûk_SUB_SAT64(%Œd, %ŒdËö %s:Üöê%d\n", ()
a64
, ()
b64
, 
fûe
, 
löe
);

248 #ifde‡
FIXED_DEBUG_ASSERT


249 
	`sûk_as£π
( 0 );

252  
ªs
;

253 
	}
}

255 #unde‡
sûk_MUL


256 
	#sûk_MUL
(
a
,
b
Ë
	`sûk_MUL_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

257 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MUL_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

258 
›us_öt32
 
ªt
;

259 
›us_öt64
 
ªt64
;

260 
ªt
 = 
a32
 * 
b32
;

261 
ªt64
 = (
›us_öt64
)
a32
 * (›us_öt64)
b32
;

262 i‡–(
›us_öt64
)
ªt
 !
ªt64
 )

264 
	`Ârötf
 (
°dîr
, "sûk_MUL(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

265 #ifde‡
FIXED_DEBUG_ASSERT


266 
	`sûk_as£π
( 0 );

269  
ªt
;

270 
	}
}

272 #unde‡
sûk_MUL_uöt


273 
	#sûk_MUL_uöt
(
a
,
b
Ë
	`sûk_MUL_uöt_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

274 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_MUL_uöt_
(
›us_uöt32
 
a32
, opus_uöt32 
b32
, *
fûe
, 
löe
){

275 
›us_uöt32
 
ªt
;

276 
ªt
 = 
a32
 * 
b32
;

277 i‡–(
›us_uöt64
)
ªt
 !(›us_uöt64)
a32
 * (›us_uöt64)
b32
 )

279 
	`Ârötf
 (
°dîr
, "sûk_MUL_uöt(%u, %uËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

280 #ifde‡
FIXED_DEBUG_ASSERT


281 
	`sûk_as£π
( 0 );

284  
ªt
;

285 
	}
}

287 #unde‡
sûk_MLA


288 
	#sûk_MLA
(
a
,
b
,
c
Ë
	`sûk_MLA_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

289 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MLA_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

290 
›us_öt32
 
ªt
;

291 
ªt
 = 
a32
 + 
b32
 * 
c32
;

292 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (›us_öt64)
b32
 * (›us_öt64)
c32
 )

294 
	`Ârötf
 (
°dîr
, "sûk_MLA(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

295 #ifde‡
FIXED_DEBUG_ASSERT


296 
	`sûk_as£π
( 0 );

299  
ªt
;

300 
	}
}

302 #unde‡
sûk_MLA_uöt


303 
	#sûk_MLA_uöt
(
a
,
b
,
c
Ë
	`sûk_MLA_uöt_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

304 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MLA_uöt_
(
›us_uöt32
 
a32
, opus_uöt32 
b32
, opus_uöt32 
c32
, *
fûe
, 
löe
){

305 
›us_uöt32
 
ªt
;

306 
ªt
 = 
a32
 + 
b32
 * 
c32
;

307 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (›us_öt64)
b32
 * (›us_öt64)
c32
 )

309 
	`Ârötf
 (
°dîr
, "sûk_MLA_uöt(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

310 #ifde‡
FIXED_DEBUG_ASSERT


311 
	`sûk_as£π
( 0 );

314  
ªt
;

315 
	}
}

317 #unde‡
sûk_SMULWB


318 
	#sûk_SMULWB
(
a
,
b
Ë
	`sûk_SMULWB_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

319 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWB_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

320 
›us_öt32
 
ªt
;

321 
ªt
 = (
a32
 >> 16Ë* (
›us_öt32
)((
›us_öt16
)
b32
) + (((a32 & 0x0000FFFF) * (opus_int32)((opus_int16)b32)) >> 16);

322 i‡–(
›us_öt64
)
ªt
 !((›us_öt64)
a32
 * (
›us_öt16
)
b32
) >> 16 )

324 
	`Ârötf
 (
°dîr
, "sûk_SMULWB(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

325 #ifde‡
FIXED_DEBUG_ASSERT


326 
	`sûk_as£π
( 0 );

329  
ªt
;

330 
	}
}

332 #unde‡
sûk_SMLAWB


333 
	#sûk_SMLAWB
(
a
,
b
,
c
Ë
	`sûk_SMLAWB_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

334 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWB_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

335 
›us_öt32
 
ªt
;

336 
ªt
 = 
	`sûk_ADD32
–
a32
, 
	`sûk_SMULWB
–
b32
, 
c32
 ) );

337 i‡–
	`sûk_ADD32
–
a32
, 
	`sûk_SMULWB
–
b32
, 
c32
 ) ) !
	`sûk_ADD_SAT32
(á32, silk_SMULWB( b32, c32 ) ) )

339 
	`Ârötf
 (
°dîr
, "sûk_SMLAWB(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

340 #ifde‡
FIXED_DEBUG_ASSERT


341 
	`sûk_as£π
( 0 );

344  
ªt
;

345 
	}
}

347 #unde‡
sûk_SMULWT


348 
	#sûk_SMULWT
(
a
,
b
Ë
	`sûk_SMULWT_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

349 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWT_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

350 
›us_öt32
 
ªt
;

351 
ªt
 = (
a32
 >> 16Ë* (
b32
 >> 16) + (((a32 & 0x0000FFFF) * (b32 >> 16)) >> 16);

352 i‡–(
›us_öt64
)
ªt
 !((›us_öt64)
a32
 * (
b32
 >> 16)) >> 16 )

354 
	`Ârötf
 (
°dîr
, "sûk_SMULWT(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

355 #ifde‡
FIXED_DEBUG_ASSERT


356 
	`sûk_as£π
( 0 );

359  
ªt
;

360 
	}
}

362 #unde‡
sûk_SMLAWT


363 
	#sûk_SMLAWT
(
a
,
b
,
c
Ë
	`sûk_SMLAWT_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

364 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWT_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

365 
›us_öt32
 
ªt
;

366 
ªt
 = 
a32
 + ((
b32
 >> 16Ë* (
c32
 >> 16)) + (((b32 & 0x0000FFFF) * ((c32 >> 16)) >> 16));

367 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (((›us_öt64)
b32
 * (
c32
 >> 16)) >> 16) )

369 
	`Ârötf
 (
°dîr
, "sûk_SMLAWT(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

370 #ifde‡
FIXED_DEBUG_ASSERT


371 
	`sûk_as£π
( 0 );

374  
ªt
;

375 
	}
}

377 #unde‡
sûk_SMULL


378 
	#sûk_SMULL
(
a
,
b
Ë
	`sûk_SMULL_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

379 
OPUS_INLINE
 
›us_öt64
 
	$sûk_SMULL_
(
›us_öt64
 
a64
, opus_öt64 
b64
, *
fûe
, 
löe
){

380 
›us_öt64
 
ªt64
;

381 
Áû
 = 0;

382 
ªt64
 = 
a64
 * 
b64
;

383 if–
b64
 != 0 ) {

384 
Áû
 = 
a64
 !(
ªt64
 / 
b64
);

385 } if–
a64
 != 0 ) {

386 
Áû
 = 
b64
 !(
ªt64
 / 
a64
);

388 i‡–
Áû
 )

390 
	`Ârötf
 (
°dîr
, "sûk_SMULL(%Œd, %ŒdËö %s:Üöê%d\n", ()
a64
, ()
b64
, 
fûe
, 
löe
);

391 #ifde‡
FIXED_DEBUG_ASSERT


392 
	`sûk_as£π
( 0 );

395  
ªt64
;

396 
	}
}

399 #unde‡
sûk_SMLABB


400 
	#sûk_SMLABB
(
a
,
b
,
c
Ë
	`sûk_SMLABB_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

401 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABB_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

402 
›us_öt32
 
ªt
;

403 
ªt
 = 
a32
 + (
›us_öt32
)((
›us_öt16
)
b32
Ë* (›us_öt32)((›us_öt16)
c32
);

404 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (›us_öt64)
b32
 * (
›us_öt16
)
c32
 )

406 
	`Ârötf
 (
°dîr
, "sûk_SMLABB(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

407 #ifde‡
FIXED_DEBUG_ASSERT


408 
	`sûk_as£π
( 0 );

411  
ªt
;

412 
	}
}

415 #unde‡
sûk_SMLABT


416 
	#sûk_SMLABT
(
a
,
b
,
c
Ë
	`sûk_SMLABT_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

417 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABT_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

418 
›us_öt32
 
ªt
;

419 
ªt
 = 
a32
 + ((
›us_öt32
)((
›us_öt16
)
b32
)Ë* (
c32
 >> 16);

420 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (›us_öt64)
b32
 * (
c32
 >> 16) )

422 
	`Ârötf
 (
°dîr
, "sûk_SMLABT(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

423 #ifde‡
FIXED_DEBUG_ASSERT


424 
	`sûk_as£π
( 0 );

427  
ªt
;

428 
	}
}

431 #unde‡
sûk_SMLATT


432 
	#sûk_SMLATT
(
a
,
b
,
c
Ë
	`sûk_SMLATT_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

433 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLATT_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

434 
›us_öt32
 
ªt
;

435 
ªt
 = 
a32
 + (
b32
 >> 16Ë* (
c32
 >> 16);

436 i‡–(
›us_öt64
)
ªt
 !(›us_öt64)
a32
 + (
b32
 >> 16Ë* (
c32
 >> 16) )

438 
	`Ârötf
 (
°dîr
, "sûk_SMLATT(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

439 #ifde‡
FIXED_DEBUG_ASSERT


440 
	`sûk_as£π
( 0 );

443  
ªt
;

444 
	}
}

446 #unde‡
sûk_SMULWW


447 
	#sûk_SMULWW
(
a
,
b
Ë
	`sûk_SMULWW_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

448 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWW_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

449 
›us_öt32
 
ªt
, 
tmp1
, 
tmp2
;

450 
›us_öt64
 
ªt64
;

451 
Áû
 = 0;

453 
ªt
 = 
	`sûk_SMULWB
–
a32
, 
b32
 );

454 
tmp1
 = 
	`sûk_RSHIFT_ROUND
–
b32
, 16 );

455 
tmp2
 = 
	`sûk_MUL
–
a32
, 
tmp1
 );

457 
Áû
 |(
›us_öt64
)
tmp2
 !(›us_öt64Ë
a32
 * (›us_öt64Ë
tmp1
;

459 
tmp1
 = 
ªt
;

460 
ªt
 = 
	`sûk_ADD32
–
tmp1
, 
tmp2
 );

461 
Áû
 |
	`sûk_ADD32
–
tmp1
, 
tmp2
 ) !
	`sûk_ADD_SAT32
(Åmp1,Åmp2 );

463 
ªt64
 = 
	`sûk_RSHIFT64
–
	`sûk_SMULL
–
a32
, 
b32
 ), 16 );

464 
Áû
 |(
›us_öt64
)
ªt
 !
ªt64
;

466 i‡–
Áû
 )

468 
	`Ârötf
 (
°dîr
, "sûk_SMULWT(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

469 #ifde‡
FIXED_DEBUG_ASSERT


470 
	`sûk_as£π
( 0 );

474  
ªt
;

475 
	}
}

477 #unde‡
sûk_SMLAWW


478 
	#sûk_SMLAWW
(
a
,
b
,
c
Ë
	`sûk_SMLAWW_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

479 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWW_
(
›us_öt32
 
a32
, opus_öt32 
b32
, opus_öt32 
c32
, *
fûe
, 
löe
){

480 
›us_öt32
 
ªt
, 
tmp
;

482 
tmp
 = 
	`sûk_SMULWW
–
b32
, 
c32
 );

483 
ªt
 = 
	`sûk_ADD32
–
a32
, 
tmp
 );

484 i‡–
ªt
 !
	`sûk_ADD_SAT32
–
a32
, 
tmp
 ) )

486 
	`Ârötf
 (
°dîr
, "sûk_SMLAWW(%d, %d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
c32
, 
fûe
, 
löe
);

487 #ifde‡
FIXED_DEBUG_ASSERT


488 
	`sûk_as£π
( 0 );

491  
ªt
;

492 
	}
}

495 #unde‡
sûk_MLA_ovÊw


496 
	#sûk_MLA_ovÊw
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ ((b32Ë* (c32)))

	)

497 #unde‡
sûk_SMLABB_ovÊw


498 
	#sûk_SMLABB_ovÊw
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ ((
›us_öt32
)((
›us_öt16
)(b32))Ë* (›us_öt32)((›us_öt16)(c32)))

	)

506 #unde‡
sûk_DIV32


507 
	#sûk_DIV32
(
a
,
b
Ë
	`sûk_DIV32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

508 
OPUS_INLINE
 
›us_öt32
 
	$sûk_DIV32_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

509 i‡–
b32
 == 0 )

511 
	`Ârötf
 (
°dîr
, "sûk_DIV32(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

512 #ifde‡
FIXED_DEBUG_ASSERT


513 
	`sûk_as£π
( 0 );

516  
a32
 / 
b32
;

517 
	}
}

519 #unde‡
sûk_DIV32_16


520 
	#sûk_DIV32_16
(
a
,
b
Ë
	`sûk_DIV32_16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

521 
OPUS_INLINE
 
›us_öt32
 
	$sûk_DIV32_16_
(
›us_öt32
 
a32
, opus_öt32 
b32
, *
fûe
, 
löe
){

522 
Áû
 = 0;

523 
Áû
 |
b32
 == 0;

524 
Áû
 |
b32
 > 
sûk_öt16_MAX
;

525 
Áû
 |
b32
 < 
sûk_öt16_MIN
;

526 i‡–
Áû
 )

528 
	`Ârötf
 (
°dîr
, "sûk_DIV32_16(%d, %dËö %s:Üöê%d\n", 
a32
, 
b32
, 
fûe
, 
löe
);

529 #ifde‡
FIXED_DEBUG_ASSERT


530 
	`sûk_as£π
( 0 );

533  
a32
 / 
b32
;

534 
	}
}

544 #unde‡
sûk_LSHIFT8


545 
	#sûk_LSHIFT8
(
a
,
b
Ë
	`sûk_LSHIFT8_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

546 
OPUS_INLINE
 
›us_öt8
 
	$sûk_LSHIFT8_
(
›us_öt8
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

547 
›us_öt8
 
ªt
;

548 
Áû
 = 0;

549 
ªt
 = 
a
 << 
shi·
;

550 
Áû
 |
shi·
 < 0;

551 
Áû
 |
shi·
 >= 8;

552 
Áû
 |(
›us_öt64
)
ªt
 !((›us_öt64)
a
Ë<< 
shi·
;

553 i‡–
Áû
 )

555 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT8(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

556 #ifde‡
FIXED_DEBUG_ASSERT


557 
	`sûk_as£π
( 0 );

560  
ªt
;

561 
	}
}

563 #unde‡
sûk_LSHIFT16


564 
	#sûk_LSHIFT16
(
a
,
b
Ë
	`sûk_LSHIFT16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

565 
OPUS_INLINE
 
›us_öt16
 
	$sûk_LSHIFT16_
(
›us_öt16
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

566 
›us_öt16
 
ªt
;

567 
Áû
 = 0;

568 
ªt
 = 
a
 << 
shi·
;

569 
Áû
 |
shi·
 < 0;

570 
Áû
 |
shi·
 >= 16;

571 
Áû
 |(
›us_öt64
)
ªt
 !((›us_öt64)
a
Ë<< 
shi·
;

572 i‡–
Áû
 )

574 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT16(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

575 #ifde‡
FIXED_DEBUG_ASSERT


576 
	`sûk_as£π
( 0 );

579  
ªt
;

580 
	}
}

582 #unde‡
sûk_LSHIFT32


583 
	#sûk_LSHIFT32
(
a
,
b
Ë
	`sûk_LSHIFT32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

584 
OPUS_INLINE
 
›us_öt32
 
	$sûk_LSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
shi·
, *
fûe
, 
löe
){

585 
›us_öt32
 
ªt
;

586 
Áû
 = 0;

587 
ªt
 = 
a
 << 
shi·
;

588 
Áû
 |
shi·
 < 0;

589 
Áû
 |
shi·
 >= 32;

590 
Áû
 |(
›us_öt64
)
ªt
 !((›us_öt64)
a
Ë<< 
shi·
;

591 i‡–
Áû
 )

593 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT32(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

594 #ifde‡
FIXED_DEBUG_ASSERT


595 
	`sûk_as£π
( 0 );

598  
ªt
;

599 
	}
}

601 #unde‡
sûk_LSHIFT64


602 
	#sûk_LSHIFT64
(
a
,
b
Ë
	`sûk_LSHIFT64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

603 
OPUS_INLINE
 
›us_öt64
 
	$sûk_LSHIFT64_
(
›us_öt64
 
a
, 
›us_öt
 
shi·
, *
fûe
, 
löe
){

604 
›us_öt64
 
ªt
;

605 
Áû
 = 0;

606 
ªt
 = 
a
 << 
shi·
;

607 
Áû
 |
shi·
 < 0;

608 
Áû
 |
shi·
 >= 64;

609 
Áû
 |(
ªt
>>
shi·
Ë!((
›us_öt64
)
a
);

610 i‡–
Áû
 )

612 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT64(%Œd, %dËö %s:Üöê%d\n", ()
a
, 
shi·
, 
fûe
, 
löe
);

613 #ifde‡
FIXED_DEBUG_ASSERT


614 
	`sûk_as£π
( 0 );

617  
ªt
;

618 
	}
}

620 #unde‡
sûk_LSHIFT_ovÊw


621 
	#sûk_LSHIFT_ovÊw
(
a
,
b
Ë
	`sûk_LSHIFT_ovÊw_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

622 
OPUS_INLINE
 
›us_öt32
 
	$sûk_LSHIFT_ovÊw_
(
›us_öt32
 
a
, opus_öt32 
shi·
, *
fûe
, 
löe
){

623 i‡–(
shi·
 < 0) || (shift >= 32) )

625 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT_ovÊw(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

626 #ifde‡
FIXED_DEBUG_ASSERT


627 
	`sûk_as£π
( 0 );

630  
a
 << 
shi·
;

631 
	}
}

633 #unde‡
sûk_LSHIFT_uöt


634 
	#sûk_LSHIFT_uöt
(
a
,
b
Ë
	`sûk_LSHIFT_uöt_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

635 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_LSHIFT_uöt_
(
›us_uöt32
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

636 
›us_uöt32
 
ªt
;

637 
ªt
 = 
a
 << 
shi·
;

638 i‡–(
shi·
 < 0Ë|| ((
›us_öt64
)
ªt
 !((›us_öt64)
a
) << shift))

640 
	`Ârötf
 (
°dîr
, "sûk_LSHIFT_uöt(%u, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

641 #ifde‡
FIXED_DEBUG_ASSERT


642 
	`sûk_as£π
( 0 );

645  
ªt
;

646 
	}
}

648 #unde‡
sûk_RSHIFT8


649 
	#sûk_RSHITF8
(
a
,
b
Ë
	`sûk_RSHIFT8_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

650 
OPUS_INLINE
 
›us_öt8
 
	$sûk_RSHIFT8_
(
›us_öt8
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

651 i‡–(
shi·
 < 0) || (shift>=8) )

653 
	`Ârötf
 (
°dîr
, "sûk_RSHITF8(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

654 #ifde‡
FIXED_DEBUG_ASSERT


655 
	`sûk_as£π
( 0 );

658  
a
 >> 
shi·
;

659 
	}
}

661 #unde‡
sûk_RSHIFT16


662 
	#sûk_RSHITF16
(
a
,
b
Ë
	`sûk_RSHIFT16_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

663 
OPUS_INLINE
 
›us_öt16
 
	$sûk_RSHIFT16_
(
›us_öt16
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

664 i‡–(
shi·
 < 0) || (shift>=16) )

666 
	`Ârötf
 (
°dîr
, "sûk_RSHITF16(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

667 #ifde‡
FIXED_DEBUG_ASSERT


668 
	`sûk_as£π
( 0 );

671  
a
 >> 
shi·
;

672 
	}
}

674 #unde‡
sûk_RSHIFT32


675 
	#sûk_RSHIFT32
(
a
,
b
Ë
	`sûk_RSHIFT32_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

676 
OPUS_INLINE
 
›us_öt32
 
	$sûk_RSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
shi·
, *
fûe
, 
löe
){

677 i‡–(
shi·
 < 0) || (shift>=32) )

679 
	`Ârötf
 (
°dîr
, "sûk_RSHITF32(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

680 #ifde‡
FIXED_DEBUG_ASSERT


681 
	`sûk_as£π
( 0 );

684  
a
 >> 
shi·
;

685 
	}
}

687 #unde‡
sûk_RSHIFT64


688 
	#sûk_RSHIFT64
(
a
,
b
Ë
	`sûk_RSHIFT64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

689 
OPUS_INLINE
 
›us_öt64
 
	$sûk_RSHIFT64_
(
›us_öt64
 
a
, opus_öt64 
shi·
, *
fûe
, 
löe
){

690 i‡–(
shi·
 < 0) || (shift>=64) )

692 
	`Ârötf
 (
°dîr
, "sûk_RSHITF64(%Œd, %ŒdËö %s:Üöê%d\n", ()
a
, ()
shi·
, 
fûe
, 
löe
);

693 #ifde‡
FIXED_DEBUG_ASSERT


694 
	`sûk_as£π
( 0 );

697  
a
 >> 
shi·
;

698 
	}
}

700 #unde‡
sûk_RSHIFT_uöt


701 
	#sûk_RSHIFT_uöt
(
a
,
b
Ë
	`sûk_RSHIFT_uöt_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

702 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_RSHIFT_uöt_
(
›us_uöt32
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

703 i‡–(
shi·
 < 0) || (shift>32) )

705 
	`Ârötf
 (
°dîr
, "sûk_RSHIFT_uöt(%u, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

706 #ifde‡
FIXED_DEBUG_ASSERT


707 
	`sûk_as£π
( 0 );

710  
a
 >> 
shi·
;

711 
	}
}

713 #unde‡
sûk_ADD_LSHIFT


714 
	#sûk_ADD_LSHIFT
(
a
,
b
,
c
Ë
	`sûk_ADD_LSHIFT_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

715 
OPUS_INLINE
 
	$sûk_ADD_LSHIFT_
(
a
, 
b
, 
shi·
, *
fûe
, 
löe
){

716 
›us_öt16
 
ªt
;

717 
ªt
 = 
a
 + (
b
 << 
shi·
);

718 i‡–(
shi·
 < 0Ë|| (shi·>15Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) << shift)) )

720 
	`Ârötf
 (
°dîr
, "sûk_ADD_LSHIFT(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

721 #ifde‡
FIXED_DEBUG_ASSERT


722 
	`sûk_as£π
( 0 );

725  
ªt
;

726 
	}
}

728 #unde‡
sûk_ADD_LSHIFT32


729 
	#sûk_ADD_LSHIFT32
(
a
,
b
,
c
Ë
	`sûk_ADD_LSHIFT32_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

730 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_LSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
, *
fûe
, 
löe
){

731 
›us_öt32
 
ªt
;

732 
ªt
 = 
a
 + (
b
 << 
shi·
);

733 i‡–(
shi·
 < 0Ë|| (shi·>31Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) << shift)) )

735 
	`Ârötf
 (
°dîr
, "sûk_ADD_LSHIFT32(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

736 #ifde‡
FIXED_DEBUG_ASSERT


737 
	`sûk_as£π
( 0 );

740  
ªt
;

741 
	}
}

743 #unde‡
sûk_ADD_LSHIFT_uöt


744 
	#sûk_ADD_LSHIFT_uöt
(
a
,
b
,
c
Ë
	`sûk_ADD_LSHIFT_uöt_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

745 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_ADD_LSHIFT_uöt_
(
›us_uöt32
 
a
, opus_uöt32 
b
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

746 
›us_uöt32
 
ªt
;

747 
ªt
 = 
a
 + (
b
 << 
shi·
);

748 i‡–(
shi·
 < 0Ë|| (shi·>32Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) << shift)) )

750 
	`Ârötf
 (
°dîr
, "sûk_ADD_LSHIFT_uöt(%u, %u, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

751 #ifde‡
FIXED_DEBUG_ASSERT


752 
	`sûk_as£π
( 0 );

755  
ªt
;

756 
	}
}

758 #unde‡
sûk_ADD_RSHIFT


759 
	#sûk_ADD_RSHIFT
(
a
,
b
,
c
Ë
	`sûk_ADD_RSHIFT_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

760 
OPUS_INLINE
 
	$sûk_ADD_RSHIFT_
(
a
, 
b
, 
shi·
, *
fûe
, 
löe
){

761 
›us_öt16
 
ªt
;

762 
ªt
 = 
a
 + (
b
 >> 
shi·
);

763 i‡–(
shi·
 < 0Ë|| (shi·>15Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) >> shift)) )

765 
	`Ârötf
 (
°dîr
, "sûk_ADD_RSHIFT(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

766 #ifde‡
FIXED_DEBUG_ASSERT


767 
	`sûk_as£π
( 0 );

770  
ªt
;

771 
	}
}

773 #unde‡
sûk_ADD_RSHIFT32


774 
	#sûk_ADD_RSHIFT32
(
a
,
b
,
c
Ë
	`sûk_ADD_RSHIFT32_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

775 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_RSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
, *
fûe
, 
löe
){

776 
›us_öt32
 
ªt
;

777 
ªt
 = 
a
 + (
b
 >> 
shi·
);

778 i‡–(
shi·
 < 0Ë|| (shi·>31Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) >> shift)) )

780 
	`Ârötf
 (
°dîr
, "sûk_ADD_RSHIFT32(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

781 #ifde‡
FIXED_DEBUG_ASSERT


782 
	`sûk_as£π
( 0 );

785  
ªt
;

786 
	}
}

788 #unde‡
sûk_ADD_RSHIFT_uöt


789 
	#sûk_ADD_RSHIFT_uöt
(
a
,
b
,
c
Ë
	`sûk_ADD_RSHIFT_uöt_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

790 
OPUS_INLINE
 
›us_uöt32
 
	$sûk_ADD_RSHIFT_uöt_
(
›us_uöt32
 
a
, opus_uöt32 
b
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

791 
›us_uöt32
 
ªt
;

792 
ªt
 = 
a
 + (
b
 >> 
shi·
);

793 i‡–(
shi·
 < 0Ë|| (shi·>32Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 + (((›us_öt64)
b
) >> shift)) )

795 
	`Ârötf
 (
°dîr
, "sûk_ADD_RSHIFT_uöt(%u, %u, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

796 #ifde‡
FIXED_DEBUG_ASSERT


797 
	`sûk_as£π
( 0 );

800  
ªt
;

801 
	}
}

803 #unde‡
sûk_SUB_LSHIFT32


804 
	#sûk_SUB_LSHIFT32
(
a
,
b
,
c
Ë
	`sûk_SUB_LSHIFT32_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

805 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_LSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
, *
fûe
, 
löe
){

806 
›us_öt32
 
ªt
;

807 
ªt
 = 
a
 - (
b
 << 
shi·
);

808 i‡–(
shi·
 < 0Ë|| (shi·>31Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 - (((›us_öt64)
b
) << shift)) )

810 
	`Ârötf
 (
°dîr
, "sûk_SUB_LSHIFT32(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

811 #ifde‡
FIXED_DEBUG_ASSERT


812 
	`sûk_as£π
( 0 );

815  
ªt
;

816 
	}
}

818 #unde‡
sûk_SUB_RSHIFT32


819 
	#sûk_SUB_RSHIFT32
(
a
,
b
,
c
Ë
	`sûk_SUB_RSHIFT32_
(◊), (b), (c), 
__FILE__
, 
__LINE__
)

	)

820 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_RSHIFT32_
(
›us_öt32
 
a
, opus_öt32 
b
, opus_öt32 
shi·
, *
fûe
, 
löe
){

821 
›us_öt32
 
ªt
;

822 
ªt
 = 
a
 - (
b
 >> 
shi·
);

823 i‡–(
shi·
 < 0Ë|| (shi·>31Ë|| ((
›us_öt64
)
ªt
 !(›us_öt64)
a
 - (((›us_öt64)
b
) >> shift)) )

825 
	`Ârötf
 (
°dîr
, "sûk_SUB_RSHIFT32(%d, %d, %dËö %s:Üöê%d\n", 
a
, 
b
, 
shi·
, 
fûe
, 
löe
);

826 #ifde‡
FIXED_DEBUG_ASSERT


827 
	`sûk_as£π
( 0 );

830  
ªt
;

831 
	}
}

833 #unde‡
sûk_RSHIFT_ROUND


834 
	#sûk_RSHIFT_ROUND
(
a
,
b
Ë
	`sûk_RSHIFT_ROUND_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

835 
OPUS_INLINE
 
›us_öt32
 
	$sûk_RSHIFT_ROUND_
(
›us_öt32
 
a
, opus_öt32 
shi·
, *
fûe
, 
löe
){

836 
›us_öt32
 
ªt
;

837 
ªt
 = 
shi·
 =1 ? (
a
 >> 1) + (a & 1) : ((a >> (shift - 1)) + 1) >> 1;

839 i‡–(
shi·
 <0Ë|| (shi·>31Ë|| ((
›us_öt64
)
ªt
 !((›us_öt64)
a
 + ((opus_int64)1 << (shift - 1))) >> shift) )

841 
	`Ârötf
 (
°dîr
, "sûk_RSHIFT_ROUND(%d, %dËö %s:Üöê%d\n", 
a
, 
shi·
, 
fûe
, 
löe
);

842 #ifde‡
FIXED_DEBUG_ASSERT


843 
	`sûk_as£π
( 0 );

846  
ªt
;

847 
	}
}

849 #unde‡
sûk_RSHIFT_ROUND64


850 
	#sûk_RSHIFT_ROUND64
(
a
,
b
Ë
	`sûk_RSHIFT_ROUND64_
(◊), (b), 
__FILE__
, 
__LINE__
)

	)

851 
OPUS_INLINE
 
›us_öt64
 
	$sûk_RSHIFT_ROUND64_
(
›us_öt64
 
a
, 
›us_öt32
 
shi·
, *
fûe
, 
löe
){

852 
›us_öt64
 
ªt
;

854 i‡–(
shi·
 <= 0) || (shift>=64) )

856 
	`Ârötf
 (
°dîr
, "sûk_RSHIFT_ROUND64(%Œd, %dËö %s:Üöê%d\n", ()
a
, 
shi·
, 
fûe
, 
löe
);

857 #ifde‡
FIXED_DEBUG_ASSERT


858 
	`sûk_as£π
( 0 );

861 
ªt
 = 
shi·
 =1 ? (
a
 >> 1) + (a & 1) : ((a >> (shift - 1)) + 1) >> 1;

862  
ªt
;

863 
	}
}

872 #unde‡
sûk_abs_öt64


873 
	#sûk_abs_öt64
(
a
Ë
	`sûk_abs_öt64_
(◊), 
__FILE__
, 
__LINE__
)

	)

874 
OPUS_INLINE
 
›us_öt64
 
	$sûk_abs_öt64_
(
›us_öt64
 
a
, *
fûe
, 
löe
){

875 i‡–
a
 =
sûk_öt64_MIN
 )

877 
	`Ârötf
 (
°dîr
, "sûk_abs_öt64(%ŒdËö %s:Üöê%d\n", ()
a
, 
fûe
, 
löe
);

878 #ifde‡
FIXED_DEBUG_ASSERT


879 
	`sûk_as£π
( 0 );

882  (((
a
) > 0) ? (a) : -(a));

883 
	}
}

885 #unde‡
sûk_abs_öt32


886 
	#sûk_abs_öt32
(
a
Ë
	`sûk_abs_öt32_
(◊), 
__FILE__
, 
__LINE__
)

	)

887 
OPUS_INLINE
 
›us_öt32
 
	$sûk_abs_öt32_
(
›us_öt32
 
a
, *
fûe
, 
löe
){

888 i‡–
a
 =
sûk_öt32_MIN
 )

890 
	`Ârötf
 (
°dîr
, "sûk_abs_öt32(%dËö %s:Üöê%d\n", 
a
, 
fûe
, 
löe
);

891 #ifde‡
FIXED_DEBUG_ASSERT


892 
	`sûk_as£π
( 0 );

895  
	`sûk_abs
(
a
);

896 
	}
}

898 #unde‡
sûk_CHECK_FIT8


899 
	#sûk_CHECK_FIT8
(
a
Ë
	`sûk_CHECK_FIT8_
(◊), 
__FILE__
, 
__LINE__
)

	)

900 
OPUS_INLINE
 
›us_öt8
 
	$sûk_CHECK_FIT8_
–
›us_öt64
 
a
, *
fûe
, 
löe
 ){

901 
›us_öt8
 
ªt
;

902 
ªt
 = (
›us_öt8
)
a
;

903 i‡–(
›us_öt64
)
ªt
 !
a
 )

905 
	`Ârötf
 (
°dîr
, "sûk_CHECK_FIT8(%ŒdËö %s:Üöê%d\n", ()
a
, 
fûe
, 
löe
);

906 #ifde‡
FIXED_DEBUG_ASSERT


907 
	`sûk_as£π
( 0 );

910 –
ªt
 );

911 
	}
}

913 #unde‡
sûk_CHECK_FIT16


914 
	#sûk_CHECK_FIT16
(
a
Ë
	`sûk_CHECK_FIT16_
(◊), 
__FILE__
, 
__LINE__
)

	)

915 
OPUS_INLINE
 
›us_öt16
 
	$sûk_CHECK_FIT16_
–
›us_öt64
 
a
, *
fûe
, 
löe
 ){

916 
›us_öt16
 
ªt
;

917 
ªt
 = (
›us_öt16
)
a
;

918 i‡–(
›us_öt64
)
ªt
 !
a
 )

920 
	`Ârötf
 (
°dîr
, "sûk_CHECK_FIT16(%ŒdËö %s:Üöê%d\n", ()
a
, 
fûe
, 
löe
);

921 #ifde‡
FIXED_DEBUG_ASSERT


922 
	`sûk_as£π
( 0 );

925 –
ªt
 );

926 
	}
}

928 #unde‡
sûk_CHECK_FIT32


929 
	#sûk_CHECK_FIT32
(
a
Ë
	`sûk_CHECK_FIT32_
(◊), 
__FILE__
, 
__LINE__
)

	)

930 
OPUS_INLINE
 
›us_öt32
 
	$sûk_CHECK_FIT32_
–
›us_öt64
 
a
, *
fûe
, 
löe
 ){

931 
›us_öt32
 
ªt
;

932 
ªt
 = (
›us_öt32
)
a
;

933 i‡–(
›us_öt64
)
ªt
 !
a
 )

935 
	`Ârötf
 (
°dîr
, "sûk_CHECK_FIT32(%ŒdËö %s:Üöê%d\n", ()
a
, 
fûe
, 
löe
);

936 #ifde‡
FIXED_DEBUG_ASSERT


937 
	`sûk_as£π
( 0 );

940 –
ªt
 );

941 
	}
}

	@silk/NLSF2A.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

38 
	~"SigProc_FIX.h
"

39 
	~"èbÀs.h
"

41 
	#QA
 16

	)

44 
OPUS_INLINE
 
	$sûk_NLSF2A_föd_pﬁy
(

45 
›us_öt32
 *
out
,

46 c⁄° 
›us_öt32
 *
cLSF
,

47 
›us_öt
 
dd


50 
›us_öt
 
k
, 
n
;

51 
›us_öt32
 
·mp
;

53 
out
[0] = 
	`sûk_LSHIFT
–1, 
QA
 );

54 
out
[1] = -
cLSF
[0];

55  
k
 = 1; k < 
dd
; k++ ) {

56 
·mp
 = 
cLSF
[2*
k
];

57 
out
[
k
+1] = 
	`sûk_LSHIFT
–out[k-1], 1 ) - (
›us_öt32
)
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
·mp
, out[k] ), 
QA
 );

58  
n
 = 
k
;Ç > 1;Ç-- ) {

59 
out
[
n
] +out[n-2] - (
›us_öt32
)
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
·mp
, out[n-1] ), 
QA
 );

61 
out
[1] -
·mp
;

63 
	}
}

66 
	$sûk_NLSF2A
(

67 
›us_öt16
 *
a_Q12
,

68 c⁄° 
›us_öt16
 *
NLSF
,

69 c⁄° 
›us_öt
 
d
,

70 
¨ch


75 c⁄° 
‹dîög16
[16] = {

78 c⁄° 
‹dîög10
[10] = {

81 c⁄° *
‹dîög
;

82 
›us_öt
 
k
, 
i
, 
dd
;

83 
›us_öt32
 
cos_LSF_QA
[ 
SILK_MAX_ORDER_LPC
 ];

84 
›us_öt32
 
P
[ 
SILK_MAX_ORDER_LPC
 / 2 + 1 ], 
Q
[ SILK_MAX_ORDER_LPC / 2 + 1 ];

85 
›us_öt32
 
Ptmp
, 
Qtmp
, 
f_öt
, 
f_‰ac
, 
cos_vÆ
, 
dñè
;

86 
›us_öt32
 
a32_QA1
[ 
SILK_MAX_ORDER_LPC
 ];

88 
	`sûk_as£π
–
LSF_COS_TAB_SZ_FIX
 == 128 );

89 
	`˚…_as£π
–
d
==10 || d==16 );

92 
‹dîög
 = 
d
 =16 ? 
‹dîög16
 : 
‹dîög10
;

93  
k
 = 0; k < 
d
; k++ ) {

94 
	`sûk_as£π
–
NLSF
[
k
] >= 0 );

97 
f_öt
 = 
	`sûk_RSHIFT
–
NLSF
[
k
], 15 - 7 );

100 
f_‰ac
 = 
NLSF
[
k
] - 
	`sûk_LSHIFT
–
f_öt
, 15 - 7 );

102 
	`sûk_as£π
(
f_öt
 >= 0);

103 
	`sûk_as£π
(
f_öt
 < 
LSF_COS_TAB_SZ_FIX
 );

106 
cos_vÆ
 = 
sûk_LSFCosTab_FIX_Q12
[ 
f_öt
 ];

107 
dñè
 = 
sûk_LSFCosTab_FIX_Q12
[ 
f_öt
 + 1 ] - 
cos_vÆ
;

110 
cos_LSF_QA
[
‹dîög
[
k
]] = 
	`sûk_RSHIFT_ROUND
–
	`sûk_LSHIFT
–
cos_vÆ
, 8 ) + 
	`sûk_MUL
–
dñè
, 
f_‰ac
 ), 20 - 
QA
 );

113 
dd
 = 
	`sûk_RSHIFT
–
d
, 1 );

116 
	`sûk_NLSF2A_föd_pﬁy
–
P
, &
cos_LSF_QA
[ 0 ], 
dd
 );

117 
	`sûk_NLSF2A_föd_pﬁy
–
Q
, &
cos_LSF_QA
[ 1 ], 
dd
 );

120  
k
 = 0; k < 
dd
; k++ ) {

121 
Ptmp
 = 
P
[ 
k
+1 ] + P[ k ];

122 
Qtmp
 = 
Q
[ 
k
+1 ] - Q[ k ];

125 
a32_QA1
[ 
k
 ] = -
Qtmp
 - 
Ptmp
;

126 
a32_QA1
[ 
d
-
k
-1 ] = 
Qtmp
 - 
Ptmp
;

130 
	`sûk_LPC_fô
–
a_Q12
, 
a32_QA1
, 12, 
QA
 + 1, 
d
 );

132  
i
 = 0; 
	`sûk_LPC_övî£_¥ed_gaö
–
a_Q12
, 
d
, 
¨ch
 ) =0 && i < 
MAX_LPC_STABILIZE_ITERATIONS
; i++ ) {

135 
	`sûk_bwex∑ndî_32
–
a32_QA1
, 
d
, 65536 - 
	`sûk_LSHIFT
–2, 
i
 ) );

136  
k
 = 0; k < 
d
; k++ ) {

137 
a_Q12
[ 
k
 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
a32_QA1
[ k ], 
QA
 + 1 - 12 );

140 
	}
}

	@silk/NLSF_VQ.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_NLSF_VQ
(

36 
›us_öt32
 
îr_Q24
[],

37 c⁄° 
›us_öt16
 
ö_Q15
[],

38 c⁄° 
›us_uöt8
 
pCB_Q8
[],

39 c⁄° 
›us_öt16
 
pWght_Q9
[],

40 c⁄° 
›us_öt
 
K
,

41 c⁄° 
›us_öt
 
LPC_‹dî


44 
›us_öt
 
i
, 
m
;

45 
›us_öt32
 
diff_Q15
, 
diffw_Q24
, 
sum_îr‹_Q24
, 
¥ed_Q24
;

46 c⁄° 
›us_öt16
 *
w_Q9_±r
;

47 c⁄° 
›us_uöt8
 *
cb_Q8_±r
;

49 
	`˚…_as£π
––
LPC_‹dî
 & 1 ) == 0 );

52 
cb_Q8_±r
 = 
pCB_Q8
;

53 
w_Q9_±r
 = 
pWght_Q9
;

54  
i
 = 0; i < 
K
; i++ ) {

55 
sum_îr‹_Q24
 = 0;

56 
¥ed_Q24
 = 0;

57  
m
 = 
LPC_‹dî
-2; m >= 0; m -= 2 ) {

59 
diff_Q15
 = 
	`sûk_SUB_LSHIFT32
–
ö_Q15
[ 
m
 + 1 ], (
›us_öt32
)
cb_Q8_±r
[ m + 1 ], 7 );

60 
diffw_Q24
 = 
	`sûk_SMULBB
–
diff_Q15
, 
w_Q9_±r
[ 
m
 + 1 ] );

61 
sum_îr‹_Q24
 = 
	`sûk_ADD32
–sum_îr‹_Q24, 
	`sûk_abs
–
	`sûk_SUB_RSHIFT32
–
diffw_Q24
, 
¥ed_Q24
, 1 ) ) );

62 
¥ed_Q24
 = 
diffw_Q24
;

65 
diff_Q15
 = 
	`sûk_SUB_LSHIFT32
–
ö_Q15
[ 
m
 ], (
›us_öt32
)
cb_Q8_±r
[ m ], 7 );

66 
diffw_Q24
 = 
	`sûk_SMULBB
–
diff_Q15
, 
w_Q9_±r
[ 
m
 ] );

67 
sum_îr‹_Q24
 = 
	`sûk_ADD32
–sum_îr‹_Q24, 
	`sûk_abs
–
	`sûk_SUB_RSHIFT32
–
diffw_Q24
, 
¥ed_Q24
, 1 ) ) );

68 
¥ed_Q24
 = 
diffw_Q24
;

70 
	`sûk_as£π
–
sum_îr‹_Q24
 >= 0 );

72 
îr_Q24
[ 
i
 ] = 
sum_îr‹_Q24
;

73 
cb_Q8_±r
 +
LPC_‹dî
;

74 
w_Q9_±r
 +
LPC_‹dî
;

76 
	}
}

	@silk/NLSF_VQ_weights_laroia.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"deföe.h
"

33 
	~"SigProc_FIX.h
"

42 
	$sûk_NLSF_VQ_weights_œroü
(

43 
›us_öt16
 *
pNLSFW_Q_OUT
,

44 c⁄° 
›us_öt16
 *
pNLSF_Q15
,

45 c⁄° 
›us_öt
 
D


48 
›us_öt
 
k
;

49 
›us_öt32
 
tmp1_öt
, 
tmp2_öt
;

51 
	`˚…_as£π
–
D
 > 0 );

52 
	`˚…_as£π
––
D
 & 1 ) == 0 );

55 
tmp1_öt
 = 
	`sûk_max_öt
–
pNLSF_Q15
[ 0 ], 1 );

56 
tmp1_öt
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << ( 15 + 
NLSF_W_Q
 ),Åmp1_int );

57 
tmp2_öt
 = 
	`sûk_max_öt
–
pNLSF_Q15
[ 1 ] -ÖNLSF_Q15[ 0 ], 1 );

58 
tmp2_öt
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << ( 15 + 
NLSF_W_Q
 ),Åmp2_int );

59 
pNLSFW_Q_OUT
[ 0 ] = (
›us_öt16
)
	`sûk_mö_öt
–
tmp1_öt
 + 
tmp2_öt
, 
sûk_öt16_MAX
 );

60 
	`sûk_as£π
–
pNLSFW_Q_OUT
[ 0 ] > 0 );

63  
k
 = 1; k < 
D
 - 1; k += 2 ) {

64 
tmp1_öt
 = 
	`sûk_max_öt
–
pNLSF_Q15
[ 
k
 + 1 ] -ÖNLSF_Q15[ k ], 1 );

65 
tmp1_öt
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << ( 15 + 
NLSF_W_Q
 ),Åmp1_int );

66 
pNLSFW_Q_OUT
[ 
k
 ] = (
›us_öt16
)
	`sûk_mö_öt
–
tmp1_öt
 + 
tmp2_öt
, 
sûk_öt16_MAX
 );

67 
	`sûk_as£π
–
pNLSFW_Q_OUT
[ 
k
 ] > 0 );

69 
tmp2_öt
 = 
	`sûk_max_öt
–
pNLSF_Q15
[ 
k
 + 2 ] -ÖNLSF_Q15[ k + 1 ], 1 );

70 
tmp2_öt
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << ( 15 + 
NLSF_W_Q
 ),Åmp2_int );

71 
pNLSFW_Q_OUT
[ 
k
 + 1 ] = (
›us_öt16
)
	`sûk_mö_öt
–
tmp1_öt
 + 
tmp2_öt
, 
sûk_öt16_MAX
 );

72 
	`sûk_as£π
–
pNLSFW_Q_OUT
[ 
k
 + 1 ] > 0 );

76 
tmp1_öt
 = 
	`sûk_max_öt
––1 << 15 ) - 
pNLSF_Q15
[ 
D
 - 1 ], 1 );

77 
tmp1_öt
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << ( 15 + 
NLSF_W_Q
 ),Åmp1_int );

78 
pNLSFW_Q_OUT
[ 
D
 - 1 ] = (
›us_öt16
)
	`sûk_mö_öt
–
tmp1_öt
 + 
tmp2_öt
, 
sûk_öt16_MAX
 );

79 
	`sûk_as£π
–
pNLSFW_Q_OUT
[ 
D
 - 1 ] > 0 );

80 
	}
}

	@silk/NLSF_decode.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
OPUS_INLINE
 
	$sûk_NLSF_ªsiduÆ_dequ™t
(

36 
›us_öt16
 
x_Q10
[],

37 c⁄° 
›us_öt8
 
ödi˚s
[],

38 c⁄° 
›us_uöt8
 
¥ed_c€f_Q8
[],

39 c⁄° 
›us_öt
 
qu™t_°ï_size_Q16
,

40 c⁄° 
›us_öt16
 
‹dî


43 
›us_öt
 
i
, 
out_Q10
, 
¥ed_Q10
;

45 
out_Q10
 = 0;

46  
i
 = 
‹dî
-1; i >= 0; i-- ) {

47 
¥ed_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
out_Q10
, (
›us_öt16
)
¥ed_c€f_Q8
[ 
i
 ] ), 8 );

48 
out_Q10
 = 
	`sûk_LSHIFT
–
ödi˚s
[ 
i
 ], 10 );

49 if–
out_Q10
 > 0 ) {

50 
out_Q10
 = 
	`sûk_SUB16
–out_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

51 } if–
out_Q10
 < 0 ) {

52 
out_Q10
 = 
	`sûk_ADD16
–out_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

54 
out_Q10
 = 
	`sûk_SMLAWB
–
¥ed_Q10
, (
›us_öt32
)out_Q10, 
qu™t_°ï_size_Q16
 );

55 
x_Q10
[ 
i
 ] = 
out_Q10
;

57 
	}
}

63 
	$sûk_NLSF_decode
(

64 
›us_öt16
 *
pNLSF_Q15
,

65 
›us_öt8
 *
NLSFIndi˚s
,

66 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB


69 
›us_öt
 
i
;

70 
›us_uöt8
 
¥ed_Q8
[ 
MAX_LPC_ORDER
 ];

71 
›us_öt16
 
ec_ix
[ 
MAX_LPC_ORDER
 ];

72 
›us_öt16
 
ªs_Q10
[ 
MAX_LPC_ORDER
 ];

73 
›us_öt32
 
NLSF_Q15_tmp
;

74 c⁄° 
›us_uöt8
 *
pCB_ñemít
;

75 c⁄° 
›us_öt16
 *
pCB_Wght_Q9
;

78 
	`sûk_NLSF_u≈ack
–
ec_ix
, 
¥ed_Q8
, 
psNLSF_CB
, 
NLSFIndi˚s
[ 0 ] );

81 
	`sûk_NLSF_ªsiduÆ_dequ™t
–
ªs_Q10
, &
NLSFIndi˚s
[ 1 ], 
¥ed_Q8
, 
psNLSF_CB
->
qu™tSãpSize_Q16
,ÖsNLSF_CB->
‹dî
 );

84 
pCB_ñemít
 = &
psNLSF_CB
->
CB1_NLSF_Q8
[ 
NLSFIndi˚s
[ 0 ] *ÖsNLSF_CB->
‹dî
 ];

85 
pCB_Wght_Q9
 = &
psNLSF_CB
->
CB1_Wght_Q9
[ 
NLSFIndi˚s
[ 0 ] *ÖsNLSF_CB->
‹dî
 ];

86  
i
 = 0; i < 
psNLSF_CB
->
‹dî
; i++ ) {

87 
NLSF_Q15_tmp
 = 
	`sûk_ADD_LSHIFT32
–
	`sûk_DIV32_16
–
	`sûk_LSHIFT
–(
›us_öt32
)
ªs_Q10
[ 
i
 ], 14 ), 
pCB_Wght_Q9
[ i ] ), (
›us_öt16
)
pCB_ñemít
[ i ], 7 );

88 
pNLSF_Q15
[ 
i
 ] = (
›us_öt16
)
	`sûk_LIMIT
–
NLSF_Q15_tmp
, 0, 32767 );

92 
	`sûk_NLSF_°abûize
–
pNLSF_Q15
, 
psNLSF_CB
->
dñèMö_Q15
,ÖsNLSF_CB->
‹dî
 );

93 
	}
}

	@silk/NLSF_del_dec_quant.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
›us_öt32
 
	$sûk_NLSF_dñ_dec_qu™t
(

36 
›us_öt8
 
ödi˚s
[],

37 c⁄° 
›us_öt16
 
x_Q10
[],

38 c⁄° 
›us_öt16
 
w_Q5
[],

39 c⁄° 
›us_uöt8
 
¥ed_c€f_Q8
[],

40 c⁄° 
›us_öt16
 
ec_ix
[],

41 c⁄° 
›us_uöt8
 
ec_øãs_Q5
[],

42 c⁄° 
›us_öt
 
qu™t_°ï_size_Q16
,

43 c⁄° 
›us_öt16
 
öv_qu™t_°ï_size_Q6
,

44 c⁄° 
›us_öt32
 
mu_Q20
,

45 c⁄° 
›us_öt16
 
‹dî


48 
›us_öt
 
i
, 
j
, 
nSèãs
, 
öd_tmp
, 
öd_mö_max
, 
öd_max_mö
, 
ö_Q10
, 
ªs_Q10
;

49 
›us_öt
 
¥ed_Q10
, 
diff_Q10
, 
øã0_Q5
, 
øã1_Q5
;

50 
›us_öt16
 
out0_Q10
, 
out1_Q10
;

51 
›us_öt32
 
RD_tmp_Q25
, 
mö_Q25
, 
mö_max_Q25
, 
max_mö_Q25
;

52 
›us_öt
 
öd_s‹t
[ 
NLSF_QUANT_DEL_DEC_STATES
 ];

53 
›us_öt8
 
öd
[ 
NLSF_QUANT_DEL_DEC_STATES
 ][ 
MAX_LPC_ORDER
 ];

54 
›us_öt16
 
¥ev_out_Q10
[ 2 * 
NLSF_QUANT_DEL_DEC_STATES
 ];

55 
›us_öt32
 
RD_Q25
[ 2 * 
NLSF_QUANT_DEL_DEC_STATES
 ];

56 
›us_öt32
 
RD_mö_Q25
[ 
NLSF_QUANT_DEL_DEC_STATES
 ];

57 
›us_öt32
 
RD_max_Q25
[ 
NLSF_QUANT_DEL_DEC_STATES
 ];

58 c⁄° 
›us_uöt8
 *
øãs_Q5
;

60 
›us_öt
 
out0_Q10_èbÀ
[2 * 
NLSF_QUANT_MAX_AMPLITUDE_EXT
];

61 
›us_öt
 
out1_Q10_èbÀ
[2 * 
NLSF_QUANT_MAX_AMPLITUDE_EXT
];

63 
i
 = -
NLSF_QUANT_MAX_AMPLITUDE_EXT
; i <= NLSF_QUANT_MAX_AMPLITUDE_EXT-1; i++)

65 
out0_Q10
 = 
	`sûk_LSHIFT
–
i
, 10 );

66 
out1_Q10
 = 
	`sûk_ADD16
–
out0_Q10
, 1024 );

67 if–
i
 > 0 ) {

68 
out0_Q10
 = 
	`sûk_SUB16
–out0_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

69 
out1_Q10
 = 
	`sûk_SUB16
–out1_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

70 } if–
i
 == 0 ) {

71 
out1_Q10
 = 
	`sûk_SUB16
–out1_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

72 } if–
i
 == -1 ) {

73 
out0_Q10
 = 
	`sûk_ADD16
–out0_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

75 
out0_Q10
 = 
	`sûk_ADD16
–out0_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

76 
out1_Q10
 = 
	`sûk_ADD16
–out1_Q10, 
	`SILK_FIX_CONST
–
NLSF_QUANT_LEVEL_ADJ
, 10 ) );

78 
out0_Q10_èbÀ
[ 
i
 + 
NLSF_QUANT_MAX_AMPLITUDE_EXT
 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
out0_Q10
, 
qu™t_°ï_size_Q16
 ), 16 );

79 
out1_Q10_èbÀ
[ 
i
 + 
NLSF_QUANT_MAX_AMPLITUDE_EXT
 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
out1_Q10
, 
qu™t_°ï_size_Q16
 ), 16 );

82 
	`sûk_as£π
–(
NLSF_QUANT_DEL_DEC_STATES
 & (NLSF_QUANT_DEL_DEC_STATES-1)) == 0 );

84 
nSèãs
 = 1;

85 
RD_Q25
[ 0 ] = 0;

86 
¥ev_out_Q10
[ 0 ] = 0;

87  
i
 = 
‹dî
 - 1; i >= 0; i-- ) {

88 
øãs_Q5
 = &
ec_øãs_Q5
[ 
ec_ix
[ 
i
 ] ];

89 
ö_Q10
 = 
x_Q10
[ 
i
 ];

90  
j
 = 0; j < 
nSèãs
; j++ ) {

91 
¥ed_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–(
›us_öt16
)
¥ed_c€f_Q8
[ 
i
 ], 
¥ev_out_Q10
[ 
j
 ] ), 8 );

92 
ªs_Q10
 = 
	`sûk_SUB16
–
ö_Q10
, 
¥ed_Q10
 );

93 
öd_tmp
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
öv_qu™t_°ï_size_Q6
, 
ªs_Q10
 ), 16 );

94 
öd_tmp
 = 
	`sûk_LIMIT
–öd_tmp, -
NLSF_QUANT_MAX_AMPLITUDE_EXT
, NLSF_QUANT_MAX_AMPLITUDE_EXT-1 );

95 
öd
[ 
j
 ][ 
i
 ] = (
›us_öt8
)
öd_tmp
;

98 
out0_Q10
 = 
out0_Q10_èbÀ
[ 
öd_tmp
 + 
NLSF_QUANT_MAX_AMPLITUDE_EXT
 ];

99 
out1_Q10
 = 
out1_Q10_èbÀ
[ 
öd_tmp
 + 
NLSF_QUANT_MAX_AMPLITUDE_EXT
 ];

101 
out0_Q10
 = 
	`sûk_ADD16
–out0_Q10, 
¥ed_Q10
 );

102 
out1_Q10
 = 
	`sûk_ADD16
–out1_Q10, 
¥ed_Q10
 );

103 
¥ev_out_Q10
[ 
j
 ] = 
out0_Q10
;

104 
¥ev_out_Q10
[ 
j
 + 
nSèãs
 ] = 
out1_Q10
;

107 if–
öd_tmp
 + 1 >
NLSF_QUANT_MAX_AMPLITUDE
 ) {

108 if–
öd_tmp
 + 1 =
NLSF_QUANT_MAX_AMPLITUDE
 ) {

109 
øã0_Q5
 = 
øãs_Q5
[ 
öd_tmp
 + 
NLSF_QUANT_MAX_AMPLITUDE
 ];

110 
øã1_Q5
 = 280;

112 
øã0_Q5
 = 
	`sûk_SMLABB
–280 - 43 * 
NLSF_QUANT_MAX_AMPLITUDE
, 43, 
öd_tmp
 );

113 
øã1_Q5
 = 
	`sûk_ADD16
–
øã0_Q5
, 43 );

115 } if–
öd_tmp
 <-
NLSF_QUANT_MAX_AMPLITUDE
 ) {

116 if–
öd_tmp
 =-
NLSF_QUANT_MAX_AMPLITUDE
 ) {

117 
øã0_Q5
 = 280;

118 
øã1_Q5
 = 
øãs_Q5
[ 
öd_tmp
 + 1 + 
NLSF_QUANT_MAX_AMPLITUDE
 ];

120 
øã0_Q5
 = 
	`sûk_SMLABB
–280 - 43 * 
NLSF_QUANT_MAX_AMPLITUDE
, -43, 
öd_tmp
 );

121 
øã1_Q5
 = 
	`sûk_SUB16
–
øã0_Q5
, 43 );

124 
øã0_Q5
 = 
øãs_Q5
[ 
öd_tmp
 + 
NLSF_QUANT_MAX_AMPLITUDE
 ];

125 
øã1_Q5
 = 
øãs_Q5
[ 
öd_tmp
 + 1 + 
NLSF_QUANT_MAX_AMPLITUDE
 ];

127 
RD_tmp_Q25
 = 
RD_Q25
[ 
j
 ];

128 
diff_Q10
 = 
	`sûk_SUB16
–
ö_Q10
, 
out0_Q10
 );

129 
RD_Q25
[ 
j
 ] = 
	`sûk_SMLABB
–
	`sûk_MLA
–
RD_tmp_Q25
, 
	`sûk_SMULBB
–
diff_Q10
, diff_Q10 ), 
w_Q5
[ 
i
 ] ), 
mu_Q20
, 
øã0_Q5
 );

130 
diff_Q10
 = 
	`sûk_SUB16
–
ö_Q10
, 
out1_Q10
 );

131 
RD_Q25
[ 
j
 + 
nSèãs
 ] = 
	`sûk_SMLABB
–
	`sûk_MLA
–
RD_tmp_Q25
, 
	`sûk_SMULBB
–
diff_Q10
, diff_Q10 ), 
w_Q5
[ 
i
 ] ), 
mu_Q20
, 
øã1_Q5
 );

134 if–
nSèãs
 <
NLSF_QUANT_DEL_DEC_STATES
/2 ) {

136  
j
 = 0; j < 
nSèãs
; j++ ) {

137 
öd
[ 
j
 + 
nSèãs
 ][ 
i
 ] = ind[ j ][ i ] + 1;

139 
nSèãs
 = 
	`sûk_LSHIFT
(ÇStates, 1 );

140  
j
 = 
nSèãs
; j < 
NLSF_QUANT_DEL_DEC_STATES
; j++ ) {

141 
öd
[ 
j
 ][ 
i
 ] = ind[ j - 
nSèãs
 ][ i ];

145  
j
 = 0; j < 
NLSF_QUANT_DEL_DEC_STATES
; j++ ) {

146 if–
RD_Q25
[ 
j
 ] > RD_Q25[ j + 
NLSF_QUANT_DEL_DEC_STATES
 ] ) {

147 
RD_max_Q25
[ 
j
 ] = 
RD_Q25
[ j ];

148 
RD_mö_Q25
[ 
j
 ] = 
RD_Q25
[ j + 
NLSF_QUANT_DEL_DEC_STATES
 ];

149 
RD_Q25
[ 
j
 ] = 
RD_mö_Q25
[ j ];

150 
RD_Q25
[ 
j
 + 
NLSF_QUANT_DEL_DEC_STATES
 ] = 
RD_max_Q25
[ j ];

152 
out0_Q10
 = 
¥ev_out_Q10
[ 
j
 ];

153 
¥ev_out_Q10
[ 
j
 ] =Öªv_out_Q10[ j + 
NLSF_QUANT_DEL_DEC_STATES
 ];

154 
¥ev_out_Q10
[ 
j
 + 
NLSF_QUANT_DEL_DEC_STATES
 ] = 
out0_Q10
;

155 
öd_s‹t
[ 
j
 ] = j + 
NLSF_QUANT_DEL_DEC_STATES
;

157 
RD_mö_Q25
[ 
j
 ] = 
RD_Q25
[ j ];

158 
RD_max_Q25
[ 
j
 ] = 
RD_Q25
[ j + 
NLSF_QUANT_DEL_DEC_STATES
 ];

159 
öd_s‹t
[ 
j
 ] = j;

165 
mö_max_Q25
 = 
sûk_öt32_MAX
;

166 
max_mö_Q25
 = 0;

167 
öd_mö_max
 = 0;

168 
öd_max_mö
 = 0;

169  
j
 = 0; j < 
NLSF_QUANT_DEL_DEC_STATES
; j++ ) {

170 if–
mö_max_Q25
 > 
RD_max_Q25
[ 
j
 ] ) {

171 
mö_max_Q25
 = 
RD_max_Q25
[ 
j
 ];

172 
öd_mö_max
 = 
j
;

174 if–
max_mö_Q25
 < 
RD_mö_Q25
[ 
j
 ] ) {

175 
max_mö_Q25
 = 
RD_mö_Q25
[ 
j
 ];

176 
öd_max_mö
 = 
j
;

179 if–
mö_max_Q25
 >
max_mö_Q25
 ) {

183 
öd_s‹t
[ 
öd_max_mö
 ] = ind_s‹t[ 
öd_mö_max
 ] ^ 
NLSF_QUANT_DEL_DEC_STATES
;

184 
RD_Q25
[ 
öd_max_mö
 ] = RD_Q25[ 
öd_mö_max
 + 
NLSF_QUANT_DEL_DEC_STATES
 ];

185 
¥ev_out_Q10
[ 
öd_max_mö
 ] =Öªv_out_Q10[ 
öd_mö_max
 + 
NLSF_QUANT_DEL_DEC_STATES
 ];

186 
RD_mö_Q25
[ 
öd_max_mö
 ] = 0;

187 
RD_max_Q25
[ 
öd_mö_max
 ] = 
sûk_öt32_MAX
;

188 
	`sûk_mem˝y
–
öd
[ 
öd_max_mö
 ], ind[ 
öd_mö_max
 ], 
MAX_LPC_ORDER
 * –
›us_öt8
 ) );

191  
j
 = 0; j < 
NLSF_QUANT_DEL_DEC_STATES
; j++ ) {

192 
öd
[ 
j
 ][ 
i
 ] +
	`sûk_RSHIFT
–
öd_s‹t
[ j ], 
NLSF_QUANT_DEL_DEC_STATES_LOG2
 );

198 
öd_tmp
 = 0;

199 
mö_Q25
 = 
sûk_öt32_MAX
;

200  
j
 = 0; j < 2 * 
NLSF_QUANT_DEL_DEC_STATES
; j++ ) {

201 if–
mö_Q25
 > 
RD_Q25
[ 
j
 ] ) {

202 
mö_Q25
 = 
RD_Q25
[ 
j
 ];

203 
öd_tmp
 = 
j
;

206  
j
 = 0; j < 
‹dî
; j++ ) {

207 
ödi˚s
[ 
j
 ] = 
öd
[ 
öd_tmp
 & ( 
NLSF_QUANT_DEL_DEC_STATES
 - 1 ) ][ j ];

208 
	`sûk_as£π
–
ödi˚s
[ 
j
 ] >-
NLSF_QUANT_MAX_AMPLITUDE_EXT
 );

209 
	`sûk_as£π
–
ödi˚s
[ 
j
 ] <
NLSF_QUANT_MAX_AMPLITUDE_EXT
 );

211 
ödi˚s
[ 0 ] +
	`sûk_RSHIFT
–
öd_tmp
, 
NLSF_QUANT_DEL_DEC_STATES_LOG2
 );

212 
	`sûk_as£π
–
ödi˚s
[ 0 ] <
NLSF_QUANT_MAX_AMPLITUDE_EXT
 );

213 
	`sûk_as£π
–
mö_Q25
 >= 0 );

214  
mö_Q25
;

215 
	}
}

	@silk/NLSF_encode.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

38 
›us_öt32
 
	$sûk_NLSF_ícode
(

39 
›us_öt8
 *
NLSFIndi˚s
,

40 
›us_öt16
 *
pNLSF_Q15
,

41 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
,

42 c⁄° 
›us_öt16
 *
pW_Q2
,

43 c⁄° 
›us_öt
 
NLSF_mu_Q20
,

44 c⁄° 
›us_öt
 
nSurviv‹s
,

45 c⁄° 
›us_öt
 
sig«lTy≥


48 
›us_öt
 
i
, 
s
, 
öd1
, 
be°Index
, 
¥ob_Q8
, 
bôs_q7
;

49 
›us_öt32
 
W_tmp_Q9
, 
ªt
;

50 
	`VARDECL
–
›us_öt32
, 
îr_Q24
 );

51 
	`VARDECL
–
›us_öt32
, 
RD_Q25
 );

52 
	`VARDECL
–
›us_öt
, 
ãmpIndi˚s1
 );

53 
	`VARDECL
–
›us_öt8
, 
ãmpIndi˚s2
 );

54 
›us_öt16
 
ªs_Q10
[ 
MAX_LPC_ORDER
 ];

55 
›us_öt16
 
NLSF_tmp_Q15
[ 
MAX_LPC_ORDER
 ];

56 
›us_öt16
 
W_adj_Q5
[ 
MAX_LPC_ORDER
 ];

57 
›us_uöt8
 
¥ed_Q8
[ 
MAX_LPC_ORDER
 ];

58 
›us_öt16
 
ec_ix
[ 
MAX_LPC_ORDER
 ];

59 c⁄° 
›us_uöt8
 *
pCB_ñemít
, *
iCDF_±r
;

60 c⁄° 
›us_öt16
 *
pCB_Wght_Q9
;

61 
SAVE_STACK
;

63 
	`˚…_as£π
–
sig«lTy≥
 >= 0 && signalType <= 2 );

64 
	`sûk_as£π
–
NLSF_mu_Q20
 <= 32767 && NLSF_mu_Q20 >= 0 );

67 
	`sûk_NLSF_°abûize
–
pNLSF_Q15
, 
psNLSF_CB
->
dñèMö_Q15
,ÖsNLSF_CB->
‹dî
 );

70 
	`ALLOC
–
îr_Q24
, 
psNLSF_CB
->
nVe˘‹s
, 
›us_öt32
 );

71 
	`sûk_NLSF_VQ
–
îr_Q24
, 
pNLSF_Q15
, 
psNLSF_CB
->
CB1_NLSF_Q8
,ÖsNLSF_CB->
CB1_Wght_Q9
,ÖsNLSF_CB->
nVe˘‹s
,ÖsNLSF_CB->
‹dî
 );

74 
	`ALLOC
–
ãmpIndi˚s1
, 
nSurviv‹s
, 
›us_öt
 );

75 
	`sûk_ö£πi⁄_s‹t_ö¸ósög
–
îr_Q24
, 
ãmpIndi˚s1
, 
psNLSF_CB
->
nVe˘‹s
, 
nSurviv‹s
 );

77 
	`ALLOC
–
RD_Q25
, 
nSurviv‹s
, 
›us_öt32
 );

78 
	`ALLOC
–
ãmpIndi˚s2
, 
nSurviv‹s
 * 
MAX_LPC_ORDER
, 
›us_öt8
 );

81  
s
 = 0; s < 
nSurviv‹s
; s++ ) {

82 
öd1
 = 
ãmpIndi˚s1
[ 
s
 ];

85 
pCB_ñemít
 = &
psNLSF_CB
->
CB1_NLSF_Q8
[ 
öd1
 *ÖsNLSF_CB->
‹dî
 ];

86 
pCB_Wght_Q9
 = &
psNLSF_CB
->
CB1_Wght_Q9
[ 
öd1
 *ÖsNLSF_CB->
‹dî
 ];

87  
i
 = 0; i < 
psNLSF_CB
->
‹dî
; i++ ) {

88 
NLSF_tmp_Q15
[ 
i
 ] = 
	`sûk_LSHIFT16
–(
›us_öt16
)
pCB_ñemít
[ i ], 7 );

89 
W_tmp_Q9
 = 
pCB_Wght_Q9
[ 
i
 ];

90 
ªs_Q10
[ 
i
 ] = (
›us_öt16
)
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
pNLSF_Q15
[ i ] - 
NLSF_tmp_Q15
[ i ], 
W_tmp_Q9
 ), 14 );

91 
W_adj_Q5
[ 
i
 ] = 
	`sûk_DIV32_v¨Q
–(
›us_öt32
)
pW_Q2
[ i ], 
	`sûk_SMULBB
–
W_tmp_Q9
, W_tmp_Q9 ), 21 );

95 
	`sûk_NLSF_u≈ack
–
ec_ix
, 
¥ed_Q8
, 
psNLSF_CB
, 
öd1
 );

98 
RD_Q25
[ 
s
 ] = 
	`sûk_NLSF_dñ_dec_qu™t
–&
ãmpIndi˚s2
[ s * 
MAX_LPC_ORDER
 ], 
ªs_Q10
, 
W_adj_Q5
, 
¥ed_Q8
, 
ec_ix
,

99 
psNLSF_CB
->
ec_R©es_Q5
,ÖsNLSF_CB->
qu™tSãpSize_Q16
,ÖsNLSF_CB->
övQu™tSãpSize_Q6
, 
NLSF_mu_Q20
,ÖsNLSF_CB->
‹dî
 );

102 
iCDF_±r
 = &
psNLSF_CB
->
CB1_iCDF
[ ( 
sig«lTy≥
 >> 1 ) *ÖsNLSF_CB->
nVe˘‹s
 ];

103 if–
öd1
 == 0 ) {

104 
¥ob_Q8
 = 256 - 
iCDF_±r
[ 
öd1
 ];

106 
¥ob_Q8
 = 
iCDF_±r
[ 
öd1
 - 1 ] - iCDF_ptr[ ind1 ];

108 
bôs_q7
 = ( 8 << 7 ) - 
	`sûk_lö2log
–
¥ob_Q8
 );

109 
RD_Q25
[ 
s
 ] = 
	`sûk_SMLABB
–RD_Q25[ s ], 
bôs_q7
, 
	`sûk_RSHIFT
–
NLSF_mu_Q20
, 2 ) );

113 
	`sûk_ö£πi⁄_s‹t_ö¸ósög
–
RD_Q25
, &
be°Index
, 
nSurviv‹s
, 1 );

115 
NLSFIndi˚s
[ 0 ] = (
›us_öt8
)
ãmpIndi˚s1
[ 
be°Index
 ];

116 
	`sûk_mem˝y
–&
NLSFIndi˚s
[ 1 ], &
ãmpIndi˚s2
[ 
be°Index
 * 
MAX_LPC_ORDER
 ], 
psNLSF_CB
->
‹dî
 * –
›us_öt8
 ) );

119 
	`sûk_NLSF_decode
–
pNLSF_Q15
, 
NLSFIndi˚s
, 
psNLSF_CB
 );

121 
ªt
 = 
RD_Q25
[ 0 ];

122 
RESTORE_STACK
;

123  
ªt
;

124 
	}
}

	@silk/NLSF_stabilize.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

41 
	~"SigProc_FIX.h
"

44 
	#MAX_LOOPS
 20

	)

47 
	$sûk_NLSF_°abûize
(

48 
›us_öt16
 *
NLSF_Q15
,

49 c⁄° 
›us_öt16
 *
NDñèMö_Q15
,

50 c⁄° 
›us_öt
 
L


53 
›us_öt
 
i
, 
I
=0, 
k
, 
lo›s
;

54 
›us_öt16
 
˚¡î_‰eq_Q15
;

55 
›us_öt32
 
diff_Q15
, 
mö_diff_Q15
, 
mö_˚¡î_Q15
, 
max_˚¡î_Q15
;

58 
	`sûk_as£π
–
NDñèMö_Q15
[
L
] >= 1 );

60  
lo›s
 = 0;Üo›†< 
MAX_LOOPS
;Üoops++ ) {

65 
mö_diff_Q15
 = 
NLSF_Q15
[0] - 
NDñèMö_Q15
[0];

66 
I
 = 0;

68  
i
 = 1; i <
L
-1; i++ ) {

69 
diff_Q15
 = 
NLSF_Q15
[
i
] - ( NLSF_Q15[i-1] + 
NDñèMö_Q15
[i] );

70 if–
diff_Q15
 < 
mö_diff_Q15
 ) {

71 
mö_diff_Q15
 = 
diff_Q15
;

72 
I
 = 
i
;

76 
diff_Q15
 = ( 1 << 15 ) - ( 
NLSF_Q15
[
L
-1] + 
NDñèMö_Q15
[L] );

77 if–
diff_Q15
 < 
mö_diff_Q15
 ) {

78 
mö_diff_Q15
 = 
diff_Q15
;

79 
I
 = 
L
;

85 if–
mö_diff_Q15
 >= 0 ) {

89 if–
I
 == 0 ) {

91 
NLSF_Q15
[0] = 
NDñèMö_Q15
[0];

93 } if–
I
 =
L
) {

95 
NLSF_Q15
[
L
-1] = ( 1 << 15 ) - 
NDñèMö_Q15
[L];

99 
mö_˚¡î_Q15
 = 0;

100  
k
 = 0; k < 
I
; k++ ) {

101 
mö_˚¡î_Q15
 +
NDñèMö_Q15
[
k
];

103 
mö_˚¡î_Q15
 +
	`sûk_RSHIFT
–
NDñèMö_Q15
[
I
], 1 );

106 
max_˚¡î_Q15
 = 1 << 15;

107  
k
 = 
L
; k > 
I
; k-- ) {

108 
max_˚¡î_Q15
 -
NDñèMö_Q15
[
k
];

110 
max_˚¡î_Q15
 -
	`sûk_RSHIFT
–
NDñèMö_Q15
[
I
], 1 );

113 
˚¡î_‰eq_Q15
 = (
›us_öt16
)
	`sûk_LIMIT_32
–
	`sûk_RSHIFT_ROUND
–(
›us_öt32
)
NLSF_Q15
[
I
-1] + (opus_int32)NLSF_Q15[I], 1 ),

114 
mö_˚¡î_Q15
, 
max_˚¡î_Q15
 );

115 
NLSF_Q15
[
I
-1] = 
˚¡î_‰eq_Q15
 - 
	`sûk_RSHIFT
–
NDñèMö_Q15
[I], 1 );

116 
NLSF_Q15
[
I
] = NLSF_Q15[I-1] + 
NDñèMö_Q15
[I];

121 if–
lo›s
 =
MAX_LOOPS
 )

126 
	`sûk_ö£πi⁄_s‹t_ö¸ósög_Æl_vÆues_öt16
–&
NLSF_Q15
[0], 
L
 );

129 
NLSF_Q15
[0] = 
	`sûk_max_öt
–NLSF_Q15[0], 
NDñèMö_Q15
[0] );

132  
i
 = 1; i < 
L
; i++ )

133 
NLSF_Q15
[
i
] = 
	`sûk_max_öt
–NLSF_Q15[i], 
	`sûk_ADD_SAT16
–NLSF_Q15[i-1], 
NDñèMö_Q15
[i] ) );

136 
NLSF_Q15
[
L
-1] = 
	`sûk_mö_öt
–NLSF_Q15[L-1], (1<<15Ë- 
NDñèMö_Q15
[L] );

139  
i
 = 
L
-2; i >= 0; i-- )

140 
NLSF_Q15
[
i
] = 
	`sûk_mö_öt
–NLSF_Q15[i], NLSF_Q15[i+1] - 
NDñèMö_Q15
[i+1] );

142 
	}
}

	@silk/NLSF_unpack.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_NLSF_u≈ack
(

36 
›us_öt16
 
ec_ix
[],

37 
›us_uöt8
 
¥ed_Q8
[],

38 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
,

39 c⁄° 
›us_öt
 
CB1_ödex


42 
›us_öt
 
i
;

43 
›us_uöt8
 
íåy
;

44 c⁄° 
›us_uöt8
 *
ec_£l_±r
;

46 
ec_£l_±r
 = &
psNLSF_CB
->
ec_£l
[ 
CB1_ödex
 *ÖsNLSF_CB->
‹dî
 / 2 ];

47  
i
 = 0; i < 
psNLSF_CB
->
‹dî
; i += 2 ) {

48 
íåy
 = *
ec_£l_±r
++;

49 
ec_ix
 [ 
i
 ] = 
	`sûk_SMULBB
–
	`sûk_RSHIFT
–
íåy
, 1 ) & 7, 2 * 
NLSF_QUANT_MAX_AMPLITUDE
 + 1 );

50 
¥ed_Q8
[ 
i
 ] = 
psNLSF_CB
->¥ed_Q8[ i + ( 
íåy
 & 1 ) * (ÖsNLSF_CB->
‹dî
 - 1 ) ];

51 
ec_ix
 [ 
i
 + 1 ] = 
	`sûk_SMULBB
–
	`sûk_RSHIFT
–
íåy
, 5 ) & 7, 2 * 
NLSF_QUANT_MAX_AMPLITUDE
 + 1 );

52 
¥ed_Q8
[ 
i
 + 1 ] = 
psNLSF_CB
->¥ed_Q8[ i + ( 
	`sûk_RSHIFT
–
íåy
, 4 ) & 1 ) * (ÖsNLSF_CB->
‹dî
 - 1 ) + 1 ];

54 
	}
}

	@silk/NSQ.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"NSQ.h
"

37 
OPUS_INLINE
 
sûk_nsq_sˇÀ_°©es
(

38 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

39 
sûk_nsq_°©e
 *
NSQ
,

40 c⁄° 
›us_öt16
 
x16
[],

41 
›us_öt32
 
x_sc_Q10
[],

42 c⁄° 
›us_öt16
 
sLTP
[],

43 
›us_öt32
 
sLTP_Q15
[],

44 
›us_öt
 
sub‰
,

45 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

46 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

47 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

48 c⁄° 
›us_öt
 
sig«l_ty≥


51 #i‡!
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

52 
OPUS_INLINE
 
sûk_noi£_sh≠e_qu™tizî
(

53 
sûk_nsq_°©e
 *
NSQ
,

54 
›us_öt
 
sig«lTy≥
,

55 c⁄° 
›us_öt32
 
x_sc_Q10
[],

56 
›us_öt8
 
pul£s
[],

57 
›us_öt16
 
xq
[],

58 
›us_öt32
 
sLTP_Q15
[],

59 c⁄° 
›us_öt16
 
a_Q12
[],

60 c⁄° 
›us_öt16
 
b_Q14
[],

61 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

62 
›us_öt
 
œg
,

63 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

64 
›us_öt
 
Tût_Q14
,

65 
›us_öt32
 
LF_shp_Q14
,

66 
›us_öt32
 
Gaö_Q16
,

67 
›us_öt
 
Lambda_Q10
,

68 
›us_öt
 
off£t_Q10
,

69 
›us_öt
 
Àngth
,

70 
›us_öt
 
sh≠ögLPCOrdî
,

71 
›us_öt
 
¥edi˘LPCOrdî
,

72 
¨ch


76 
	gsûk_NSQ_c


78 c⁄° 
sûk_ícodî_°©e
 *
	gpsEncC
,

79 
sûk_nsq_°©e
 *
	gNSQ
,

80 
SideInfoIndi˚s
 *
	gpsIndi˚s
,

81 c⁄° 
›us_öt16
 
	gx16
[],

82 
›us_öt8
 
	gpul£s
[],

83 c⁄° 
›us_öt16
 
	gPªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

84 c⁄° 
›us_öt16
 
	gLTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

85 c⁄° 
›us_öt16
 
	gAR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

86 c⁄° 
›us_öt
 
	gH¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

87 c⁄° 
›us_öt
 
	gTût_Q14
[ 
MAX_NB_SUBFR
 ],

88 c⁄° 
›us_öt32
 
	gLF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

89 c⁄° 
›us_öt32
 
	gGaös_Q16
[ 
MAX_NB_SUBFR
 ],

90 c⁄° 
›us_öt
 
	gpôchL
[ 
MAX_NB_SUBFR
 ],

91 c⁄° 
›us_öt
 
	gLambda_Q10
,

92 c⁄° 
›us_öt
 
	gLTP_sˇÀ_Q14


95 
›us_öt
 
	gk
, 
	gœg
, 
	g°¨t_idx
, 
	gLSF_öãΩﬁ©i⁄_Êag
;

96 c⁄° 
›us_öt16
 *
	gA_Q12
, *
	gB_Q14
, *
	gAR_shp_Q13
;

97 
›us_öt16
 *
	gpxq
;

98 
VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

99 
VARDECL
–
›us_öt16
, 
sLTP
 );

100 
›us_öt32
 
	gH¨mSh≠eFIRPacked_Q14
;

101 
›us_öt
 
	goff£t_Q10
;

102 
VARDECL
–
›us_öt32
, 
x_sc_Q10
 );

103 
	gSAVE_STACK
;

105 
	gNSQ
->
	gønd_£ed
 = 
psIndi˚s
->
Sìd
;

108 
	gœg
 = 
NSQ
->
œgPªv
;

110 
sûk_as£π
–
NSQ
->
¥ev_gaö_Q16
 != 0 );

112 
	goff£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psIndi˚s
->
sig«lTy≥
 >> 1 ][ÖsIndi˚s->
qu™tOff£tTy≥
 ];

114 if–
	gpsIndi˚s
->
	gNLSFI¡îpC€f_Q2
 == 4 ) {

115 
LSF_öãΩﬁ©i⁄_Êag
 = 0;

117 
	gLSF_öãΩﬁ©i⁄_Êag
 = 1;

120 
ALLOC
–
sLTP_Q15
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt32
 );

121 
ALLOC
–
sLTP
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt16
 );

122 
ALLOC
–
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
, 
›us_öt32
 );

124 
	gNSQ
->
	gsLTP_shp_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

125 
	gNSQ
->
	gsLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

126 
	gpxq
 = &
NSQ
->
xq
[ 
psEncC
->
…p_mem_Àngth
 ];

127  
	gk
 = 0; k < 
	gpsEncC
->
	gnb_sub‰
; k++ ) {

128 
	gA_Q12
 = &
PªdC€f_Q12
[ (–
k
 >> 1 ) | ( 1 - 
LSF_öãΩﬁ©i⁄_Êag
 )Ë* 
MAX_LPC_ORDER
 ];

129 
	gB_Q14
 = &
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

130 
	gAR_shp_Q13
 = &
AR_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ];

133 
sûk_as£π
–
H¨mSh≠eGaö_Q14
[ 
k
 ] >= 0 );

134 
	gH¨mSh≠eFIRPacked_Q14
 = 
sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 2 );

135 
	gH¨mSh≠eFIRPacked_Q14
 |
sûk_LSHIFT
–(
›us_öt32
)
sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 1 ), 16 );

137 
	gNSQ
->
	gªwhôe_Êag
 = 0;

138 if–
	gpsIndi˚s
->
	gsig«lTy≥
 =
TYPE_VOICED
 ) {

140 
œg
 = 
pôchL
[ 
k
 ];

143 if––
	gk
 & ( 3 - 
sûk_LSHIFT
–
LSF_öãΩﬁ©i⁄_Êag
, 1 ) ) ) == 0 ) {

145 
°¨t_idx
 = 
psEncC
->
…p_mem_Àngth
 - 
œg
 -ÖsEncC->
¥edi˘LPCOrdî
 - 
LTP_ORDER
 / 2;

146 
˚…_as£π
–
°¨t_idx
 > 0 );

148 
sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
NSQ
->
xq
[ sèπ_idx + 
k
 * 
psEncC
->
sub‰_Àngth
 ],

149 
A_Q12
, 
psEncC
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

151 
	gNSQ
->
	gªwhôe_Êag
 = 1;

152 
	gNSQ
->
	gsLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

156 
sûk_nsq_sˇÀ_°©es
–
psEncC
, 
NSQ
, 
x16
, 
x_sc_Q10
, 
sLTP
, 
sLTP_Q15
, 
k
, 
LTP_sˇÀ_Q14
, 
Gaös_Q16
, 
pôchL
, 
psIndi˚s
->
sig«lTy≥
 );

158 
sûk_noi£_sh≠e_qu™tizî
–
NSQ
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
, 
A_Q12
, 
B_Q14
,

159 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ], 
Gaös_Q16
[ k ], 
Lambda_Q10
,

160 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
,ÖsEncC->
sh≠ögLPCOrdî
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

162 
	gx16
 +
psEncC
->
sub‰_Àngth
;

163 
	gpul£s
 +
psEncC
->
sub‰_Àngth
;

164 
	gpxq
 +
psEncC
->
sub‰_Àngth
;

168 
	gNSQ
->
	gœgPªv
 = 
pôchL
[ 
psEncC
->
nb_sub‰
 - 1 ];

171 
sûk_memmove
–
NSQ
->
xq
, &NSQ->xq[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt16
 ) );

172 
sûk_memmove
–
NSQ
->
sLTP_shp_Q14
, &NSQ->sLTP_shp_Q14[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt32
 ) );

173 
	gRESTORE_STACK
;

180 #i‡!
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

181 
	gOPUS_INLINE


183 
	$sûk_noi£_sh≠e_qu™tizî
(

184 
sûk_nsq_°©e
 *
NSQ
,

185 
›us_öt
 
sig«lTy≥
,

186 c⁄° 
›us_öt32
 
x_sc_Q10
[],

187 
›us_öt8
 
pul£s
[],

188 
›us_öt16
 
xq
[],

189 
›us_öt32
 
sLTP_Q15
[],

190 c⁄° 
›us_öt16
 
a_Q12
[],

191 c⁄° 
›us_öt16
 
b_Q14
[],

192 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

193 
›us_öt
 
œg
,

194 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

195 
›us_öt
 
Tût_Q14
,

196 
›us_öt32
 
LF_shp_Q14
,

197 
›us_öt32
 
Gaö_Q16
,

198 
›us_öt
 
Lambda_Q10
,

199 
›us_öt
 
off£t_Q10
,

200 
›us_öt
 
Àngth
,

201 
›us_öt
 
sh≠ögLPCOrdî
,

202 
›us_öt
 
¥edi˘LPCOrdî
,

203 
¨ch


206 
›us_öt
 
i
;

207 
›us_öt32
 
LTP_¥ed_Q13
, 
LPC_¥ed_Q10
, 
n_AR_Q12
, 
n_LTP_Q13
;

208 
›us_öt32
 
n_LF_Q12
, 
r_Q10
, 
º_Q10
, 
q1_Q0
, 
q1_Q10
, 
q2_Q10
, 
rd1_Q20
, 
rd2_Q20
;

209 
›us_öt32
 
exc_Q14
, 
LPC_exc_Q14
, 
xq_Q14
, 
Gaö_Q10
;

210 
›us_öt32
 
tmp1
, 
tmp2
, 
sLF_AR_shp_Q14
;

211 
›us_öt32
 *
psLPC_Q14
, *
shp_œg_±r
, *
¥ed_œg_±r
;

212 #ifde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


213 
›us_öt32
 
a_Q12_¨ch
[
MAX_LPC_ORDER
];

216 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

217 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

218 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

221 
psLPC_Q14
 = &
NSQ
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 1 ];

223 #ifde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


224 
	`sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f
(
a_Q12_¨ch
, 
a_Q12
, 
¥edi˘LPCOrdî
);

227  
i
 = 0; i < 
Àngth
; i++ ) {

229 
NSQ
->
ønd_£ed
 = 
	`sûk_RAND
( NSQ->rand_seed );

232 
LPC_¥ed_Q10
 = 
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄
(
psLPC_Q14
, 
a_Q12
, 
a_Q12_¨ch
, 
¥edi˘LPCOrdî
, 
¨ch
);

235 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

238 
LTP_¥ed_Q13
 = 2;

239 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ 0 ], 
b_Q14
[ 0 ] );

240 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -1 ], 
b_Q14
[ 1 ] );

241 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -2 ], 
b_Q14
[ 2 ] );

242 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -3 ], 
b_Q14
[ 3 ] );

243 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -4 ], 
b_Q14
[ 4 ] );

244 
¥ed_œg_±r
++;

246 
LTP_¥ed_Q13
 = 0;

250 
	`˚…_as£π
––
sh≠ögLPCOrdî
 & 1 ) == 0 );

251 
n_AR_Q12
 = 
	`sûk_NSQ_noi£_sh≠e_„edback_lo›
(&
NSQ
->
sDiff_shp_Q14
, NSQ->
sAR2_Q14
, 
AR_shp_Q13
, 
sh≠ögLPCOrdî
, 
¨ch
);

253 
n_AR_Q12
 = 
	`sûk_SMLAWB
–n_AR_Q12, 
NSQ
->
sLF_AR_shp_Q14
, 
Tût_Q14
 );

255 
n_LF_Q12
 = 
	`sûk_SMULWB
–
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 1 ], 
LF_shp_Q14
 );

256 
n_LF_Q12
 = 
	`sûk_SMLAWT
–n_LF_Q12, 
NSQ
->
sLF_AR_shp_Q14
, 
LF_shp_Q14
 );

258 
	`˚…_as£π
–
œg
 > 0 || 
sig«lTy≥
 !
TYPE_VOICED
 );

261 
tmp1
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT32
–
LPC_¥ed_Q10
, 2 ), 
n_AR_Q12
 );

262 
tmp1
 = 
	`sûk_SUB32
–tmp1, 
n_LF_Q12
 );

263 if–
œg
 > 0 ) {

265 
n_LTP_Q13
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

266 
n_LTP_Q13
 = 
	`sûk_SMLAWT
–n_LTP_Q13, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

267 
n_LTP_Q13
 = 
	`sûk_LSHIFT
(Ç_LTP_Q13, 1 );

268 
shp_œg_±r
++;

270 
tmp2
 = 
	`sûk_SUB32
–
LTP_¥ed_Q13
, 
n_LTP_Q13
 );

271 
tmp1
 = 
	`sûk_ADD_LSHIFT32
–
tmp2
,Åmp1, 1 );

272 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 3 );

274 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 2 );

277 
r_Q10
 = 
	`sûk_SUB32
–
x_sc_Q10
[ 
i
 ], 
tmp1
 );

280 if–
NSQ
->
ønd_£ed
 < 0 ) {

281 
r_Q10
 = -r_Q10;

283 
r_Q10
 = 
	`sûk_LIMIT_32
(Ñ_Q10, -(31 << 10), 30 << 10 );

286 
q1_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
off£t_Q10
 );

287 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
, 10 );

288 i‡(
Lambda_Q10
 > 2048) {

290 
rdo_off£t
 = 
Lambda_Q10
/2 - 512;

291 i‡(
q1_Q10
 > 
rdo_off£t
) {

292 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
 - 
rdo_off£t
, 10 );

293 } i‡(
q1_Q10
 < -
rdo_off£t
) {

294 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
 + 
rdo_off£t
, 10 );

295 } i‡(
q1_Q10
 < 0) {

296 
q1_Q0
 = -1;

298 
q1_Q0
 = 0;

301 if–
q1_Q0
 > 0 ) {

302 
q1_Q10
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

303 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

304 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

305 
rd1_Q20
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

306 
rd2_Q20
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

307 } if–
q1_Q0
 == 0 ) {

308 
q1_Q10
 = 
off£t_Q10
;

309 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

310 
rd1_Q20
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

311 
rd2_Q20
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

312 } if–
q1_Q0
 == -1 ) {

313 
q2_Q10
 = 
off£t_Q10
;

314 
q1_Q10
 = 
	`sûk_SUB32
–
q2_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

315 
rd1_Q20
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

316 
rd2_Q20
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

318 
q1_Q10
 = 
	`sûk_ADD32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

319 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

320 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

321 
rd1_Q20
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

322 
rd2_Q20
 = 
	`sûk_SMULBB
–-
q2_Q10
, 
Lambda_Q10
 );

324 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q1_Q10
 );

325 
rd1_Q20
 = 
	`sûk_SMLABB
–rd1_Q20, 
º_Q10
,Ñr_Q10 );

326 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q2_Q10
 );

327 
rd2_Q20
 = 
	`sûk_SMLABB
–rd2_Q20, 
º_Q10
,Ñr_Q10 );

329 if–
rd2_Q20
 < 
rd1_Q20
 ) {

330 
q1_Q10
 = 
q2_Q10
;

333 
pul£s
[ 
i
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
q1_Q10
, 10 );

336 
exc_Q14
 = 
	`sûk_LSHIFT
–
q1_Q10
, 4 );

337 i‡–
NSQ
->
ønd_£ed
 < 0 ) {

338 
exc_Q14
 = -exc_Q14;

342 
LPC_exc_Q14
 = 
	`sûk_ADD_LSHIFT32
–
exc_Q14
, 
LTP_¥ed_Q13
, 1 );

343 
xq_Q14
 = 
	`sûk_ADD_LSHIFT32
–
LPC_exc_Q14
, 
LPC_¥ed_Q10
, 4 );

346 
xq
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
xq_Q14
, 
Gaö_Q10
 ), 8 ) );

349 
psLPC_Q14
++;

350 *
psLPC_Q14
 = 
xq_Q14
;

351 
NSQ
->
sDiff_shp_Q14
 = 
	`sûk_SUB_LSHIFT32
–
xq_Q14
, 
x_sc_Q10
[ 
i
 ], 4 );

352 
sLF_AR_shp_Q14
 = 
	`sûk_SUB_LSHIFT32
–
NSQ
->
sDiff_shp_Q14
, 
n_AR_Q12
, 2 );

353 
NSQ
->
sLF_AR_shp_Q14
 = sLF_AR_shp_Q14;

355 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 ] = 
	`sûk_SUB_LSHIFT32
–
sLF_AR_shp_Q14
, 
n_LF_Q12
, 2 );

356 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 ] = 
	`sûk_LSHIFT
–
LPC_exc_Q14
, 1 );

357 
NSQ
->
sLTP_shp_buf_idx
++;

358 
NSQ
->
sLTP_buf_idx
++;

361 
NSQ
->
ønd_£ed
 = 
	`sûk_ADD32_ovÊw
–NSQ->ønd_£ed, 
pul£s
[ 
i
 ] );

365 
	`sûk_mem˝y
–
NSQ
->
sLPC_Q14
, &NSQ->sLPC_Q14[ 
Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

366 
	}
}

368 
OPUS_INLINE
 
	$sûk_nsq_sˇÀ_°©es
(

369 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

370 
sûk_nsq_°©e
 *
NSQ
,

371 c⁄° 
›us_öt16
 
x16
[],

372 
›us_öt32
 
x_sc_Q10
[],

373 c⁄° 
›us_öt16
 
sLTP
[],

374 
›us_öt32
 
sLTP_Q15
[],

375 
›us_öt
 
sub‰
,

376 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

377 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

378 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

379 c⁄° 
›us_öt
 
sig«l_ty≥


382 
›us_öt
 
i
, 
œg
;

383 
›us_öt32
 
gaö_adj_Q16
, 
öv_gaö_Q31
, 
öv_gaö_Q26
;

385 
œg
 = 
pôchL
[ 
sub‰
 ];

386 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
	`sûk_max
–
Gaös_Q16
[ 
sub‰
 ], 1 ), 47 );

387 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

390 
öv_gaö_Q26
 = 
	`sûk_RSHIFT_ROUND
–
öv_gaö_Q31
, 5 );

391  
i
 = 0; i < 
psEncC
->
sub‰_Àngth
; i++ ) {

392 
x_sc_Q10
[ 
i
 ] = 
	`sûk_SMULWW
–
x16
[ i ], 
öv_gaö_Q26
 );

396 if–
NSQ
->
ªwhôe_Êag
 ) {

397 if–
sub‰
 == 0 ) {

399 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
LTP_sˇÀ_Q14
 ), 2 );

401  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

402 
	`sûk_as£π
–
i
 < 
MAX_FRAME_LENGTH
 );

403 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWB
–
öv_gaö_Q31
, 
sLTP
[ i ] );

408 if–
Gaös_Q16
[ 
sub‰
 ] !
NSQ
->
¥ev_gaö_Q16
 ) {

409 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
NSQ
->
¥ev_gaö_Q16
, 
Gaös_Q16
[ 
sub‰
 ], 16 );

412  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx; i++ ) {

413 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

417 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

418  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

419 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

423 
NSQ
->
sLF_AR_shp_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLF_AR_shp_Q14 );

424 
NSQ
->
sDiff_shp_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sDiff_shp_Q14 );

427  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

428 
NSQ
->
sLPC_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLPC_Q14[ i ] );

430  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

431 
NSQ
->
sAR2_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sAR2_Q14[ i ] );

435 
NSQ
->
¥ev_gaö_Q16
 = 
Gaös_Q16
[ 
sub‰
 ];

437 
	}
}

	@silk/NSQ.h

28 #i‚de‡
SILK_NSQ_H


29 
	#SILK_NSQ_H


	)

31 
	~"SigProc_FIX.h
"

33 #unde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


35 
OPUS_INLINE
 
›us_öt32
 
	$sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_c
(c⁄° 
›us_öt32
 *
buf32
, c⁄° 
›us_öt16
 *
c€f16
, 
›us_öt
 
‹dî
)

37 
›us_öt32
 
out
;

38 
	`sûk_as£π
–
‹dî
 == 10 || order == 16 );

41 
out
 = 
	`sûk_RSHIFT
–
‹dî
, 1 );

42 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ 0 ], 
c€f16
[ 0 ] );

43 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -1 ], 
c€f16
[ 1 ] );

44 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -2 ], 
c€f16
[ 2 ] );

45 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -3 ], 
c€f16
[ 3 ] );

46 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -4 ], 
c€f16
[ 4 ] );

47 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -5 ], 
c€f16
[ 5 ] );

48 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -6 ], 
c€f16
[ 6 ] );

49 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -7 ], 
c€f16
[ 7 ] );

50 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -8 ], 
c€f16
[ 8 ] );

51 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -9 ], 
c€f16
[ 9 ] );

53 if–
‹dî
 == 16 )

55 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -10 ], 
c€f16
[ 10 ] );

56 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -11 ], 
c€f16
[ 11 ] );

57 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -12 ], 
c€f16
[ 12 ] );

58 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -13 ], 
c€f16
[ 13 ] );

59 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -14 ], 
c€f16
[ 14 ] );

60 
out
 = 
	`sûk_SMLAWB
–out, 
buf32
[ -15 ], 
c€f16
[ 15 ] );

62  
out
;

63 
	}
}

65 
	#sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄
(
ö
, 
c€f
, 
c€fRev
, 
‹dî
, 
¨ch
Ë((Ôrch,
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_c
(ö, c€f, ordî))

	)

67 
OPUS_INLINE
 
›us_öt32
 
	$sûk_NSQ_noi£_sh≠e_„edback_lo›_c
(c⁄° 
›us_öt32
 *
d©a0
, opus_öt32 *
d©a1
, c⁄° 
›us_öt16
 *
c€f
, 
›us_öt
 
‹dî
)

69 
›us_öt32
 
out
;

70 
›us_öt32
 
tmp1
, 
tmp2
;

71 
›us_öt
 
j
;

73 
tmp2
 = 
d©a0
[0];

74 
tmp1
 = 
d©a1
[0];

75 
d©a1
[0] = 
tmp2
;

77 
out
 = 
	`sûk_RSHIFT
(
‹dî
, 1);

78 
out
 = 
	`sûk_SMLAWB
(out, 
tmp2
, 
c€f
[0]);

80 
j
 = 2; j < 
‹dî
; j += 2) {

81 
tmp2
 = 
d©a1
[
j
 - 1];

82 
d©a1
[
j
 - 1] = 
tmp1
;

83 
out
 = 
	`sûk_SMLAWB
(out, 
tmp1
, 
c€f
[
j
 - 1]);

84 
tmp1
 = 
d©a1
[
j
 + 0];

85 
d©a1
[
j
 + 0] = 
tmp2
;

86 
out
 = 
	`sûk_SMLAWB
(out, 
tmp2
, 
c€f
[
j
]);

88 
d©a1
[
‹dî
 - 1] = 
tmp1
;

89 
out
 = 
	`sûk_SMLAWB
(out, 
tmp1
, 
c€f
[
‹dî
 - 1]);

91 
out
 = 
	`sûk_LSHIFT32
( out, 1 );

92  
out
;

93 
	}
}

95 
	#sûk_NSQ_noi£_sh≠e_„edback_lo›
(
d©a0
, 
d©a1
, 
c€f
, 
‹dî
, 
¨ch
Ë((Ôrch,
	`sûk_NSQ_noi£_sh≠e_„edback_lo›_c
(d©a0, d©a1, c€f, ordî))

	)

97 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

98 
	~"¨m/NSQ_√⁄.h
"

	@silk/NSQ_del_dec.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"NSQ.h
"

38 
›us_öt32
 
	msLPC_Q14
[ 
MAX_SUB_FRAME_LENGTH
 + 
NSQ_LPC_BUF_LENGTH
 ];

39 
›us_öt32
 
	mR™dSèã
[ 
DECISION_DELAY
 ];

40 
›us_öt32
 
	mQ_Q10
[ 
DECISION_DELAY
 ];

41 
›us_öt32
 
	mXq_Q14
[ 
DECISION_DELAY
 ];

42 
›us_öt32
 
	mPªd_Q15
[ 
DECISION_DELAY
 ];

43 
›us_öt32
 
	mSh≠e_Q14
[ 
DECISION_DELAY
 ];

44 
›us_öt32
 
	msAR2_Q14
[ 
MAX_SHAPE_LPC_ORDER
 ];

45 
›us_öt32
 
	mLF_AR_Q14
;

46 
›us_öt32
 
	mDiff_Q14
;

47 
›us_öt32
 
	mSìd
;

48 
›us_öt32
 
	mSìdInô
;

49 
›us_öt32
 
	mRD_Q10
;

50 } 
	tNSQ_dñ_dec_°ru˘
;

53 
›us_öt32
 
	mQ_Q10
;

54 
›us_öt32
 
	mRD_Q10
;

55 
›us_öt32
 
	mxq_Q14
;

56 
›us_öt32
 
	mLF_AR_Q14
;

57 
›us_öt32
 
	mDiff_Q14
;

58 
›us_öt32
 
	msLTP_shp_Q14
;

59 
›us_öt32
 
	mLPC_exc_Q14
;

60 } 
	tNSQ_ßm∂e_°ru˘
;

62 
NSQ_ßm∂e_°ru˘
 
	tNSQ_ßm∂e_∑ú
[ 2 ];

64 #i‡
deföed
(
MIPSr1_ASM
)

65 
	~"mùs/NSQ_dñ_dec_mù§1.h
"

67 
OPUS_INLINE
 
sûk_nsq_dñ_dec_sˇÀ_°©es
(

68 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

69 
sûk_nsq_°©e
 *
NSQ
,

70 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

71 c⁄° 
›us_öt16
 
x16
[],

72 
›us_öt32
 
x_sc_Q10
[],

73 c⁄° 
›us_öt16
 
sLTP
[],

74 
›us_öt32
 
sLTP_Q15
[],

75 
›us_öt
 
sub‰
,

76 
›us_öt
 
nSèãsDñayedDecisi⁄
,

77 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

78 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

79 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

80 c⁄° 
›us_öt
 
sig«l_ty≥
,

81 c⁄° 
›us_öt
 
decisi⁄Dñay


87 
OPUS_INLINE
 
sûk_noi£_sh≠e_qu™tizî_dñ_dec
(

88 
sûk_nsq_°©e
 *
NSQ
,

89 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

90 
›us_öt
 
sig«lTy≥
,

91 c⁄° 
›us_öt32
 
x_Q10
[],

92 
›us_öt8
 
pul£s
[],

93 
›us_öt16
 
xq
[],

94 
›us_öt32
 
sLTP_Q15
[],

95 
›us_öt32
 
dñayedGaö_Q10
[],

96 c⁄° 
›us_öt16
 
a_Q12
[],

97 c⁄° 
›us_öt16
 
b_Q14
[],

98 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

99 
›us_öt
 
œg
,

100 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

101 
›us_öt
 
Tût_Q14
,

102 
›us_öt32
 
LF_shp_Q14
,

103 
›us_öt32
 
Gaö_Q16
,

104 
›us_öt
 
Lambda_Q10
,

105 
›us_öt
 
off£t_Q10
,

106 
›us_öt
 
Àngth
,

107 
›us_öt
 
sub‰
,

108 
›us_öt
 
sh≠ögLPCOrdî
,

109 
›us_öt
 
¥edi˘LPCOrdî
,

110 
›us_öt
 
w¨pög_Q16
,

111 
›us_öt
 
nSèãsDñayedDecisi⁄
,

112 
›us_öt
 *
sm∂_buf_idx
,

113 
›us_öt
 
decisi⁄Dñay
,

114 
¨ch


117 
	$sûk_NSQ_dñ_dec_c
(

118 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

119 
sûk_nsq_°©e
 *
NSQ
,

120 
SideInfoIndi˚s
 *
psIndi˚s
,

121 c⁄° 
›us_öt16
 
x16
[],

122 
›us_öt8
 
pul£s
[],

123 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

124 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

125 c⁄° 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

126 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

127 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

128 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

129 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

130 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

131 c⁄° 
›us_öt
 
Lambda_Q10
,

132 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


135 
›us_öt
 
i
, 
k
, 
œg
, 
°¨t_idx
, 
LSF_öãΩﬁ©i⁄_Êag
, 
Wö√r_öd
, 
sub‰
;

136 
›us_öt
 
œ°_sm∂e_idx
, 
sm∂_buf_idx
, 
decisi⁄Dñay
;

137 c⁄° 
›us_öt16
 *
A_Q12
, *
B_Q14
, *
AR_shp_Q13
;

138 
›us_öt16
 *
pxq
;

139 
	`VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

140 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

141 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
;

142 
›us_öt
 
off£t_Q10
;

143 
›us_öt32
 
RDmö_Q10
, 
Gaö_Q10
;

144 
	`VARDECL
–
›us_öt32
, 
x_sc_Q10
 );

145 
	`VARDECL
–
›us_öt32
, 
dñayedGaö_Q10
 );

146 
	`VARDECL
–
NSQ_dñ_dec_°ru˘
, 
psDñDec
 );

147 
NSQ_dñ_dec_°ru˘
 *
psDD
;

148 
SAVE_STACK
;

151 
œg
 = 
NSQ
->
œgPªv
;

153 
	`sûk_as£π
–
NSQ
->
¥ev_gaö_Q16
 != 0 );

156 
	`ALLOC
–
psDñDec
, 
psEncC
->
nSèãsDñayedDecisi⁄
, 
NSQ_dñ_dec_°ru˘
 );

157 
	`sûk_mem£t
–
psDñDec
, 0, 
psEncC
->
nSèãsDñayedDecisi⁄
 * –
NSQ_dñ_dec_°ru˘
 ) );

158  
k
 = 0; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

159 
psDD
 = &
psDñDec
[ 
k
 ];

160 
psDD
->
Sìd
 = ( 
k
 + 
psIndi˚s
->Seed ) & 3;

161 
psDD
->
SìdInô
 =ÖsDD->
Sìd
;

162 
psDD
->
RD_Q10
 = 0;

163 
psDD
->
LF_AR_Q14
 = 
NSQ
->
sLF_AR_shp_Q14
;

164 
psDD
->
Diff_Q14
 = 
NSQ
->
sDiff_shp_Q14
;

165 
psDD
->
Sh≠e_Q14
[ 0 ] = 
NSQ
->
sLTP_shp_Q14
[ 
psEncC
->
…p_mem_Àngth
 - 1 ];

166 
	`sûk_mem˝y
–
psDD
->
sLPC_Q14
, 
NSQ
->sLPC_Q14, 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

167 
	`sûk_mem˝y
–
psDD
->
sAR2_Q14
, 
NSQ
->sAR2_Q14, ( NSQ->sAR2_Q14 ) );

170 
off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psIndi˚s
->
sig«lTy≥
 >> 1 ][ÖsIndi˚s->
qu™tOff£tTy≥
 ];

171 
sm∂_buf_idx
 = 0;

173 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–
DECISION_DELAY
, 
psEncC
->
sub‰_Àngth
 );

176 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

177  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

178 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
pôchL
[ 
k
 ] - 
LTP_ORDER
 / 2 - 1 );

181 if–
œg
 > 0 ) {

182 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
œg
 - 
LTP_ORDER
 / 2 - 1 );

186 if–
psIndi˚s
->
NLSFI¡îpC€f_Q2
 == 4 ) {

187 
LSF_öãΩﬁ©i⁄_Êag
 = 0;

189 
LSF_öãΩﬁ©i⁄_Êag
 = 1;

192 
	`ALLOC
–
sLTP_Q15
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt32
 );

193 
	`ALLOC
–
sLTP
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt16
 );

194 
	`ALLOC
–
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
, 
›us_öt32
 );

195 
	`ALLOC
–
dñayedGaö_Q10
, 
DECISION_DELAY
, 
›us_öt32
 );

197 
pxq
 = &
NSQ
->
xq
[ 
psEncC
->
…p_mem_Àngth
 ];

198 
NSQ
->
sLTP_shp_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

199 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

200 
sub‰
 = 0;

201  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

202 
A_Q12
 = &
PªdC€f_Q12
[ ( ( 
k
 >> 1 ) | ( 1 - 
LSF_öãΩﬁ©i⁄_Êag
 ) ) * 
MAX_LPC_ORDER
 ];

203 
B_Q14
 = &
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

204 
AR_shp_Q13
 = &
AR_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ];

207 
	`sûk_as£π
–
H¨mSh≠eGaö_Q14
[ 
k
 ] >= 0 );

208 
H¨mSh≠eFIRPacked_Q14
 = 
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 2 );

209 
H¨mSh≠eFIRPacked_Q14
 |
	`sûk_LSHIFT
–(
›us_öt32
)
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 1 ), 16 );

211 
NSQ
->
ªwhôe_Êag
 = 0;

212 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

214 
œg
 = 
pôchL
[ 
k
 ];

217 if––
k
 & ( 3 - 
	`sûk_LSHIFT
–
LSF_öãΩﬁ©i⁄_Êag
, 1 ) ) ) == 0 ) {

218 if–
k
 == 2 ) {

221 
RDmö_Q10
 = 
psDñDec
[ 0 ].
RD_Q10
;

222 
Wö√r_öd
 = 0;

223  
i
 = 1; i < 
psEncC
->
nSèãsDñayedDecisi⁄
; i++ ) {

224 if–
psDñDec
[ 
i
 ].
RD_Q10
 < 
RDmö_Q10
 ) {

225 
RDmö_Q10
 = 
psDñDec
[ 
i
 ].
RD_Q10
;

226 
Wö√r_öd
 = 
i
;

229  
i
 = 0; i < 
psEncC
->
nSèãsDñayedDecisi⁄
; i++ ) {

230 if–
i
 !
Wö√r_öd
 ) {

231 
psDñDec
[ 
i
 ].
RD_Q10
 +–
sûk_öt32_MAX
 >> 4 );

232 
	`sûk_as£π
–
psDñDec
[ 
i
 ].
RD_Q10
 >= 0 );

237 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

238 
œ°_sm∂e_idx
 = 
sm∂_buf_idx
 + 
decisi⁄Dñay
;

239  
i
 = 0; i < 
decisi⁄Dñay
; i++ ) {

240 
œ°_sm∂e_idx
 = (Üa°_sm∂e_idx - 1 ) % 
DECISION_DELAY
;

241 if–
œ°_sm∂e_idx
 < 0 )Üa°_sm∂e_idx +
DECISION_DELAY
;

242 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

243 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

244 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
Gaös_Q16
[ 1 ] ), 14 ) );

245 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

248 
sub‰
 = 0;

252 
°¨t_idx
 = 
psEncC
->
…p_mem_Àngth
 - 
œg
 -ÖsEncC->
¥edi˘LPCOrdî
 - 
LTP_ORDER
 / 2;

253 
	`˚…_as£π
–
°¨t_idx
 > 0 );

255 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
NSQ
->
xq
[ sèπ_idx + 
k
 * 
psEncC
->
sub‰_Àngth
 ],

256 
A_Q12
, 
psEncC
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

258 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

259 
NSQ
->
ªwhôe_Êag
 = 1;

263 
	`sûk_nsq_dñ_dec_sˇÀ_°©es
–
psEncC
, 
NSQ
, 
psDñDec
, 
x16
, 
x_sc_Q10
, 
sLTP
, 
sLTP_Q15
, 
k
,

264 
psEncC
->
nSèãsDñayedDecisi⁄
, 
LTP_sˇÀ_Q14
, 
Gaös_Q16
, 
pôchL
, 
psIndi˚s
->
sig«lTy≥
, 
decisi⁄Dñay
 );

266 
	`sûk_noi£_sh≠e_qu™tizî_dñ_dec
–
NSQ
, 
psDñDec
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
,

267 
dñayedGaö_Q10
, 
A_Q12
, 
B_Q14
, 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ],

268 
Gaös_Q16
[ 
k
 ], 
Lambda_Q10
, 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
, 
sub‰
++,ÖsEncC->
sh≠ögLPCOrdî
,

269 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
w¨pög_Q16
,ÖsEncC->
nSèãsDñayedDecisi⁄
, &
sm∂_buf_idx
, 
decisi⁄Dñay
,ÖsEncC->
¨ch
 );

271 
x16
 +
psEncC
->
sub‰_Àngth
;

272 
pul£s
 +
psEncC
->
sub‰_Àngth
;

273 
pxq
 +
psEncC
->
sub‰_Àngth
;

277 
RDmö_Q10
 = 
psDñDec
[ 0 ].
RD_Q10
;

278 
Wö√r_öd
 = 0;

279  
k
 = 1; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

280 if–
psDñDec
[ 
k
 ].
RD_Q10
 < 
RDmö_Q10
 ) {

281 
RDmö_Q10
 = 
psDñDec
[ 
k
 ].
RD_Q10
;

282 
Wö√r_öd
 = 
k
;

287 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

288 
psIndi˚s
->
Sìd
 = 
psDD
->
SìdInô
;

289 
œ°_sm∂e_idx
 = 
sm∂_buf_idx
 + 
decisi⁄Dñay
;

290 
Gaö_Q10
 = 
	`sûk_RSHIFT32
–
Gaös_Q16
[ 
psEncC
->
nb_sub‰
 - 1 ], 6 );

291  
i
 = 0; i < 
decisi⁄Dñay
; i++ ) {

292 
œ°_sm∂e_idx
 = (Üa°_sm∂e_idx - 1 ) % 
DECISION_DELAY
;

293 if–
œ°_sm∂e_idx
 < 0 )Üa°_sm∂e_idx +
DECISION_DELAY
;

295 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

296 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

297 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
Gaö_Q10
 ), 8 ) );

298 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

300 
	`sûk_mem˝y
–
NSQ
->
sLPC_Q14
, &
psDD
->sLPC_Q14[ 
psEncC
->
sub‰_Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

301 
	`sûk_mem˝y
–
NSQ
->
sAR2_Q14
, 
psDD
->sAR2_Q14, (ÖsDD->sAR2_Q14 ) );

304 
NSQ
->
sLF_AR_shp_Q14
 = 
psDD
->
LF_AR_Q14
;

305 
NSQ
->
sDiff_shp_Q14
 = 
psDD
->
Diff_Q14
;

306 
NSQ
->
œgPªv
 = 
pôchL
[ 
psEncC
->
nb_sub‰
 - 1 ];

309 
	`sûk_memmove
–
NSQ
->
xq
, &NSQ->xq[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt16
 ) );

310 
	`sûk_memmove
–
NSQ
->
sLTP_shp_Q14
, &NSQ->sLTP_shp_Q14[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt32
 ) );

311 
RESTORE_STACK
;

312 
	}
}

317 #i‚de‡
OVERRIDE_sûk_noi£_sh≠e_qu™tizî_dñ_dec


318 
OPUS_INLINE
 
	$sûk_noi£_sh≠e_qu™tizî_dñ_dec
(

319 
sûk_nsq_°©e
 *
NSQ
,

320 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

321 
›us_öt
 
sig«lTy≥
,

322 c⁄° 
›us_öt32
 
x_Q10
[],

323 
›us_öt8
 
pul£s
[],

324 
›us_öt16
 
xq
[],

325 
›us_öt32
 
sLTP_Q15
[],

326 
›us_öt32
 
dñayedGaö_Q10
[],

327 c⁄° 
›us_öt16
 
a_Q12
[],

328 c⁄° 
›us_öt16
 
b_Q14
[],

329 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

330 
›us_öt
 
œg
,

331 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

332 
›us_öt
 
Tût_Q14
,

333 
›us_öt32
 
LF_shp_Q14
,

334 
›us_öt32
 
Gaö_Q16
,

335 
›us_öt
 
Lambda_Q10
,

336 
›us_öt
 
off£t_Q10
,

337 
›us_öt
 
Àngth
,

338 
›us_öt
 
sub‰
,

339 
›us_öt
 
sh≠ögLPCOrdî
,

340 
›us_öt
 
¥edi˘LPCOrdî
,

341 
›us_öt
 
w¨pög_Q16
,

342 
›us_öt
 
nSèãsDñayedDecisi⁄
,

343 
›us_öt
 *
sm∂_buf_idx
,

344 
›us_öt
 
decisi⁄Dñay
,

345 
¨ch


348 
›us_öt
 
i
, 
j
, 
k
, 
Wö√r_öd
, 
RDmö_öd
, 
RDmax_öd
, 
œ°_sm∂e_idx
;

349 
›us_öt32
 
Wö√r_ønd_°©e
;

350 
›us_öt32
 
LTP_¥ed_Q14
, 
LPC_¥ed_Q14
, 
n_AR_Q14
, 
n_LTP_Q14
;

351 
›us_öt32
 
n_LF_Q14
, 
r_Q10
, 
º_Q10
, 
rd1_Q10
, 
rd2_Q10
, 
RDmö_Q10
, 
RDmax_Q10
;

352 
›us_öt32
 
q1_Q0
, 
q1_Q10
, 
q2_Q10
, 
exc_Q14
, 
LPC_exc_Q14
, 
xq_Q14
, 
Gaö_Q10
;

353 
›us_öt32
 
tmp1
, 
tmp2
, 
sLF_AR_shp_Q14
;

354 
›us_öt32
 *
¥ed_œg_±r
, *
shp_œg_±r
, *
psLPC_Q14
;

355 #ifde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


356 
›us_öt32
 
a_Q12_¨ch
[
MAX_LPC_ORDER
];

359 
	`VARDECL
–
NSQ_ßm∂e_∑ú
, 
psSam∂eSèã
 );

360 
NSQ_dñ_dec_°ru˘
 *
psDD
;

361 
NSQ_ßm∂e_°ru˘
 *
psSS
;

362 
SAVE_STACK
;

364 
	`˚…_as£π
–
nSèãsDñayedDecisi⁄
 > 0 );

365 
	`ALLOC
–
psSam∂eSèã
, 
nSèãsDñayedDecisi⁄
, 
NSQ_ßm∂e_∑ú
 );

367 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

368 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

369 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

371 #ifde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


372 
	`sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f
(
a_Q12_¨ch
, 
a_Q12
, 
¥edi˘LPCOrdî
);

375  
i
 = 0; i < 
Àngth
; i++ ) {

379 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

382 
LTP_¥ed_Q14
 = 2;

383 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ 0 ], 
b_Q14
[ 0 ] );

384 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -1 ], 
b_Q14
[ 1 ] );

385 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -2 ], 
b_Q14
[ 2 ] );

386 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -3 ], 
b_Q14
[ 3 ] );

387 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -4 ], 
b_Q14
[ 4 ] );

388 
LTP_¥ed_Q14
 = 
	`sûk_LSHIFT
( LTP_pred_Q14, 1 );

389 
¥ed_œg_±r
++;

391 
LTP_¥ed_Q14
 = 0;

395 if–
œg
 > 0 ) {

397 
n_LTP_Q14
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

398 
n_LTP_Q14
 = 
	`sûk_SMLAWT
–n_LTP_Q14, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

399 
n_LTP_Q14
 = 
	`sûk_SUB_LSHIFT32
–
LTP_¥ed_Q14
,Ç_LTP_Q14, 2 );

400 
shp_œg_±r
++;

402 
n_LTP_Q14
 = 0;

405  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

407 
psDD
 = &
psDñDec
[ 
k
 ];

410 
psSS
 = 
psSam∂eSèã
[ 
k
 ];

413 
psDD
->
Sìd
 = 
	`sûk_RAND
(ÖsDD->Seed );

416 
psLPC_Q14
 = &
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 1 + 
i
 ];

418 
LPC_¥ed_Q14
 = 
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄
(
psLPC_Q14
, 
a_Q12
, 
a_Q12_¨ch
, 
¥edi˘LPCOrdî
, 
¨ch
);

419 
LPC_¥ed_Q14
 = 
	`sûk_LSHIFT
( LPC_pred_Q14, 4 );

422 
	`˚…_as£π
––
sh≠ögLPCOrdî
 & 1 ) == 0 );

424 
tmp2
 = 
	`sûk_SMLAWB
–
psDD
->
Diff_Q14
,ÖsDD->
sAR2_Q14
[ 0 ], 
w¨pög_Q16
 );

426 
tmp1
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 0 ],ÖsDD->sAR2_Q14[ 1 ] - 
tmp2
, 
w¨pög_Q16
 );

427 
psDD
->
sAR2_Q14
[ 0 ] = 
tmp2
;

428 
n_AR_Q14
 = 
	`sûk_RSHIFT
–
sh≠ögLPCOrdî
, 1 );

429 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp2
, 
AR_shp_Q13
[ 0 ] );

431  
j
 = 2; j < 
sh≠ögLPCOrdî
; j += 2 ) {

433 
tmp2
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 
j
 - 1 ],ÖsDD->sAR2_Q14[ j + 0 ] - 
tmp1
, 
w¨pög_Q16
 );

434 
psDD
->
sAR2_Q14
[ 
j
 - 1 ] = 
tmp1
;

435 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp1
, 
AR_shp_Q13
[ 
j
 - 1 ] );

437 
tmp1
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 
j
 + 0 ],ÖsDD->sAR2_Q14[ j + 1 ] - 
tmp2
, 
w¨pög_Q16
 );

438 
psDD
->
sAR2_Q14
[ 
j
 + 0 ] = 
tmp2
;

439 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp2
, 
AR_shp_Q13
[ 
j
 ] );

441 
psDD
->
sAR2_Q14
[ 
sh≠ögLPCOrdî
 - 1 ] = 
tmp1
;

442 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp1
, 
AR_shp_Q13
[ 
sh≠ögLPCOrdî
 - 1 ] );

444 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 1 );

445 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
psDD
->
LF_AR_Q14
, 
Tût_Q14
 );

446 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 2 );

448 
n_LF_Q14
 = 
	`sûk_SMULWB
–
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ], 
LF_shp_Q14
 );

449 
n_LF_Q14
 = 
	`sûk_SMLAWT
–n_LF_Q14, 
psDD
->
LF_AR_Q14
, 
LF_shp_Q14
 );

450 
n_LF_Q14
 = 
	`sûk_LSHIFT
(Ç_LF_Q14, 2 );

454 
tmp1
 = 
	`sûk_ADD32
–
n_AR_Q14
, 
n_LF_Q14
 );

455 
tmp2
 = 
	`sûk_ADD32
–
n_LTP_Q14
, 
LPC_¥ed_Q14
 );

456 
tmp1
 = 
	`sûk_SUB32
–
tmp2
,Åmp1 );

457 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 4 );

459 
r_Q10
 = 
	`sûk_SUB32
–
x_Q10
[ 
i
 ], 
tmp1
 );

462 i‡–
psDD
->
Sìd
 < 0 ) {

463 
r_Q10
 = -r_Q10;

465 
r_Q10
 = 
	`sûk_LIMIT_32
(Ñ_Q10, -(31 << 10), 30 << 10 );

468 
q1_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
off£t_Q10
 );

469 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
, 10 );

470 i‡(
Lambda_Q10
 > 2048) {

472 
rdo_off£t
 = 
Lambda_Q10
/2 - 512;

473 i‡(
q1_Q10
 > 
rdo_off£t
) {

474 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
 - 
rdo_off£t
, 10 );

475 } i‡(
q1_Q10
 < -
rdo_off£t
) {

476 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
 + 
rdo_off£t
, 10 );

477 } i‡(
q1_Q10
 < 0) {

478 
q1_Q0
 = -1;

480 
q1_Q0
 = 0;

483 if–
q1_Q0
 > 0 ) {

484 
q1_Q10
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

485 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

486 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

487 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

488 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

489 } if–
q1_Q0
 == 0 ) {

490 
q1_Q10
 = 
off£t_Q10
;

491 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

492 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

493 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

494 } if–
q1_Q0
 == -1 ) {

495 
q2_Q10
 = 
off£t_Q10
;

496 
q1_Q10
 = 
	`sûk_SUB32
–
q2_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

497 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

498 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

500 
q1_Q10
 = 
	`sûk_ADD32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

501 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

502 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

503 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

504 
rd2_Q10
 = 
	`sûk_SMULBB
–-
q2_Q10
, 
Lambda_Q10
 );

506 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q1_Q10
 );

507 
rd1_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd1_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

508 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q2_Q10
 );

509 
rd2_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd2_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

511 if–
rd1_Q10
 < 
rd2_Q10
 ) {

512 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

513 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

514 
psSS
[ 0 ].
Q_Q10
 = 
q1_Q10
;

515 
psSS
[ 1 ].
Q_Q10
 = 
q2_Q10
;

517 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

518 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

519 
psSS
[ 0 ].
Q_Q10
 = 
q2_Q10
;

520 
psSS
[ 1 ].
Q_Q10
 = 
q1_Q10
;

526 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 0 ].
Q_Q10
, 4 );

527 i‡–
psDD
->
Sìd
 < 0 ) {

528 
exc_Q14
 = -exc_Q14;

532 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

533 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

536 
psSS
[ 0 ].
Diff_Q14
 = 
	`sûk_SUB_LSHIFT32
–
xq_Q14
, 
x_Q10
[ 
i
 ], 4 );

537 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
psSS
[ 0 ].
Diff_Q14
, 
n_AR_Q14
 );

538 
psSS
[ 0 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

539 
psSS
[ 0 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

540 
psSS
[ 0 ].
LPC_exc_Q14
 = LPC_exc_Q14;

541 
psSS
[ 0 ].
xq_Q14
 = xq_Q14;

546 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 1 ].
Q_Q10
, 4 );

547 i‡–
psDD
->
Sìd
 < 0 ) {

548 
exc_Q14
 = -exc_Q14;

552 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

553 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

556 
psSS
[ 1 ].
Diff_Q14
 = 
	`sûk_SUB_LSHIFT32
–
xq_Q14
, 
x_Q10
[ 
i
 ], 4 );

557 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
psSS
[ 1 ].
Diff_Q14
, 
n_AR_Q14
 );

558 
psSS
[ 1 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

559 
psSS
[ 1 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

560 
psSS
[ 1 ].
LPC_exc_Q14
 = LPC_exc_Q14;

561 
psSS
[ 1 ].
xq_Q14
 = xq_Q14;

564 *
sm∂_buf_idx
 = ( *sm∂_buf_idx - 1 ) % 
DECISION_DELAY
;

565 if–*
sm∂_buf_idx
 < 0 ) *sm∂_buf_idx +
DECISION_DELAY
;

566 
œ°_sm∂e_idx
 = ( *
sm∂_buf_idx
 + 
decisi⁄Dñay
 ) % 
DECISION_DELAY
;

569 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

570 
Wö√r_öd
 = 0;

571  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

572 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 < 
RDmö_Q10
 ) {

573 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

574 
Wö√r_öd
 = 
k
;

579 
Wö√r_ønd_°©e
 = 
psDñDec
[ 
Wö√r_öd
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ];

580  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

581 if–
psDñDec
[ 
k
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ] !
Wö√r_ønd_°©e
 ) {

582 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 0 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

583 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 1 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

584 
	`sûk_as£π
–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 >= 0 );

589 
RDmax_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

590 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 1 ].
RD_Q10
;

591 
RDmax_öd
 = 0;

592 
RDmö_öd
 = 0;

593  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

595 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 > 
RDmax_Q10
 ) {

596 
RDmax_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

597 
RDmax_öd
 = 
k
;

600 if–
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 < 
RDmö_Q10
 ) {

601 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
;

602 
RDmö_öd
 = 
k
;

607 if–
RDmö_Q10
 < 
RDmax_Q10
 ) {

608 
	`sûk_mem˝y
––(
›us_öt32
 *)&
psDñDec
[ 
RDmax_öd
 ] ) + 
i
,

609 –(
›us_öt32
 *)&
psDñDec
[ 
RDmö_öd
 ] ) + 
i
, –
NSQ_dñ_dec_°ru˘
 ) - i * ( opus_int32) );

610 
	`sûk_mem˝y
–&
psSam∂eSèã
[ 
RDmax_öd
 ][ 0 ], &psSam∂eSèã[ 
RDmö_öd
 ][ 1 ], –
NSQ_ßm∂e_°ru˘
 ) );

614 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

615 if–
sub‰
 > 0 || 
i
 >
decisi⁄Dñay
 ) {

616 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

617 
xq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

618 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
dñayedGaö_Q10
[Üast_smple_idx ] ), 8 ) );

619 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

620 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Pªd_Q15
[ 
œ°_sm∂e_idx
 ];

622 
NSQ
->
sLTP_shp_buf_idx
++;

623 
NSQ
->
sLTP_buf_idx
++;

626  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

627 
psDD
 = &
psDñDec
[ 
k
 ];

628 
psSS
 = &
psSam∂eSèã
[ 
k
 ][ 0 ];

629 
psDD
->
LF_AR_Q14
 = 
psSS
->LF_AR_Q14;

630 
psDD
->
Diff_Q14
 = 
psSS
->Diff_Q14;

631 
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 + 
i
 ] = 
psSS
->
xq_Q14
;

632 
psDD
->
Xq_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
xq_Q14
;

633 
psDD
->
Q_Q10
[ *
sm∂_buf_idx
 ] = 
psSS
->Q_Q10;

634 
psDD
->
Pªd_Q15
[ *
sm∂_buf_idx
 ] = 
	`sûk_LSHIFT32
–
psSS
->
LPC_exc_Q14
, 1 );

635 
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
sLTP_shp_Q14
;

636 
psDD
->
Sìd
 = 
	`sûk_ADD32_ovÊw
–psDD->Sìd, 
	`sûk_RSHIFT_ROUND
–
psSS
->
Q_Q10
, 10 ) );

637 
psDD
->
R™dSèã
[ *
sm∂_buf_idx
 ] =ÖsDD->
Sìd
;

638 
psDD
->
RD_Q10
 = 
psSS
->RD_Q10;

640 
dñayedGaö_Q10
[ *
sm∂_buf_idx
 ] = 
Gaö_Q10
;

643  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

644 
psDD
 = &
psDñDec
[ 
k
 ];

645 
	`sûk_mem˝y
–
psDD
->
sLPC_Q14
, &psDD->sLPC_Q14[ 
Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

647 
RESTORE_STACK
;

648 
	}
}

651 
OPUS_INLINE
 
	$sûk_nsq_dñ_dec_sˇÀ_°©es
(

652 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

653 
sûk_nsq_°©e
 *
NSQ
,

654 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

655 c⁄° 
›us_öt16
 
x16
[],

656 
›us_öt32
 
x_sc_Q10
[],

657 c⁄° 
›us_öt16
 
sLTP
[],

658 
›us_öt32
 
sLTP_Q15
[],

659 
›us_öt
 
sub‰
,

660 
›us_öt
 
nSèãsDñayedDecisi⁄
,

661 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

662 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

663 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

664 c⁄° 
›us_öt
 
sig«l_ty≥
,

665 c⁄° 
›us_öt
 
decisi⁄Dñay


668 
›us_öt
 
i
, 
k
, 
œg
;

669 
›us_öt32
 
gaö_adj_Q16
, 
öv_gaö_Q31
, 
öv_gaö_Q26
;

670 
NSQ_dñ_dec_°ru˘
 *
psDD
;

672 
œg
 = 
pôchL
[ 
sub‰
 ];

673 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
	`sûk_max
–
Gaös_Q16
[ 
sub‰
 ], 1 ), 47 );

674 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

677 
öv_gaö_Q26
 = 
	`sûk_RSHIFT_ROUND
–
öv_gaö_Q31
, 5 );

678  
i
 = 0; i < 
psEncC
->
sub‰_Àngth
; i++ ) {

679 
x_sc_Q10
[ 
i
 ] = 
	`sûk_SMULWW
–
x16
[ i ], 
öv_gaö_Q26
 );

683 if–
NSQ
->
ªwhôe_Êag
 ) {

684 if–
sub‰
 == 0 ) {

686 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
LTP_sˇÀ_Q14
 ), 2 );

688  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

689 
	`sûk_as£π
–
i
 < 
MAX_FRAME_LENGTH
 );

690 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWB
–
öv_gaö_Q31
, 
sLTP
[ i ] );

695 if–
Gaös_Q16
[ 
sub‰
 ] !
NSQ
->
¥ev_gaö_Q16
 ) {

696 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
NSQ
->
¥ev_gaö_Q16
, 
Gaös_Q16
[ 
sub‰
 ], 16 );

699  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx; i++ ) {

700 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

704 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

705  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx - 
decisi⁄Dñay
; i++ ) {

706 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

710  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

711 
psDD
 = &
psDñDec
[ 
k
 ];

714 
psDD
->
LF_AR_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->LF_AR_Q14 );

715 
psDD
->
Diff_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->Diff_Q14 );

718  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

719 
psDD
->
sLPC_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->sLPC_Q14[ i ] );

721  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

722 
psDD
->
sAR2_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->sAR2_Q14[ i ] );

724  
i
 = 0; i < 
DECISION_DELAY
; i++ ) {

725 
psDD
->
Pªd_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->Pred_Q15[ i ] );

726 
psDD
->
Sh≠e_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->Shape_Q14[ i ] );

731 
NSQ
->
¥ev_gaö_Q16
 = 
Gaös_Q16
[ 
sub‰
 ];

733 
	}
}

	@silk/PLC.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"PLC.h
"

36 
	#NB_ATT
 2

	)

37 c⁄° 
›us_öt16
 
	gHARM_ATT_Q15
[
NB_ATT
] = { 32440, 31130 };

38 c⁄° 
›us_öt16
 
	gPLC_RAND_ATTENUATE_V_Q15
[
NB_ATT
] = { 31130, 26214 };

39 c⁄° 
›us_öt16
 
	gPLC_RAND_ATTENUATE_UV_Q15
[
NB_ATT
] = { 32440, 29491 };

41 
OPUS_INLINE
 
sûk_PLC_upd©e
(

42 
sûk_decodî_°©e
 *
psDec
,

43 
sûk_decodî_c⁄åﬁ
 *
psDecCål


46 
OPUS_INLINE
 
sûk_PLC_c⁄˚Æ
(

47 
sûk_decodî_°©e
 *
psDec
,

48 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

49 
›us_öt16
 
‰ame
[],

50 
¨ch


54 
	$sûk_PLC_Re£t
(

55 
sûk_decodî_°©e
 *
psDec


58 
psDec
->
sPLC
.
pôchL_Q8
 = 
	`sûk_LSHIFT
–psDec->
‰ame_Àngth
, 8 - 1 );

59 
psDec
->
sPLC
.
¥evGaö_Q16
[ 0 ] = 
	`SILK_FIX_CONST
( 1, 16 );

60 
psDec
->
sPLC
.
¥evGaö_Q16
[ 1 ] = 
	`SILK_FIX_CONST
( 1, 16 );

61 
psDec
->
sPLC
.
sub‰_Àngth
 = 20;

62 
psDec
->
sPLC
.
nb_sub‰
 = 2;

63 
	}
}

65 
	$sûk_PLC
(

66 
sûk_decodî_°©e
 *
psDec
,

67 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

68 
›us_öt16
 
‰ame
[],

69 
›us_öt
 
lo°
,

70 
¨ch


74 if–
psDec
->
fs_kHz
 !psDec->
sPLC
.fs_kHz ) {

75 
	`sûk_PLC_Re£t
–
psDec
 );

76 
psDec
->
sPLC
.
fs_kHz
 =ÖsDec->fs_kHz;

79 if–
lo°
 ) {

83 
	`sûk_PLC_c⁄˚Æ
–
psDec
, 
psDecCål
, 
‰ame
, 
¨ch
 );

85 
psDec
->
lossC¡
++;

90 
	`sûk_PLC_upd©e
–
psDec
, 
psDecCål
 );

92 
	}
}

97 
OPUS_INLINE
 
	$sûk_PLC_upd©e
(

98 
sûk_decodî_°©e
 *
psDec
,

99 
sûk_decodî_c⁄åﬁ
 *
psDecCål


102 
›us_öt32
 
LTP_Gaö_Q14
, 
ãmp_LTP_Gaö_Q14
;

103 
›us_öt
 
i
, 
j
;

104 
sûk_PLC_°ru˘
 *
psPLC
;

106 
psPLC
 = &
psDec
->
sPLC
;

109 
psDec
->
¥evSig«lTy≥
 =ÖsDec->
ödi˚s
.
sig«lTy≥
;

110 
LTP_Gaö_Q14
 = 0;

111 if–
psDec
->
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

113  
j
 = 0; j * 
psDec
->
sub‰_Àngth
 < 
psDecCål
->
pôchL
[ÖsDec->
nb_sub‰
 - 1 ]; j++ ) {

114 if–
j
 =
psDec
->
nb_sub‰
 ) {

117 
ãmp_LTP_Gaö_Q14
 = 0;

118  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

119 
ãmp_LTP_Gaö_Q14
 +
psDecCål
->
LTPC€f_Q14
[ ( 
psDec
->
nb_sub‰
 - 1 - 
j
 ) * 
LTP_ORDER
 + 
i
 ];

121 if–
ãmp_LTP_Gaö_Q14
 > 
LTP_Gaö_Q14
 ) {

122 
LTP_Gaö_Q14
 = 
ãmp_LTP_Gaö_Q14
;

123 
	`sûk_mem˝y
–
psPLC
->
LTPC€f_Q14
,

124 &
psDecCål
->
LTPC€f_Q14
[ 
	`sûk_SMULBB
–
psDec
->
nb_sub‰
 - 1 - 
j
, 
LTP_ORDER
 ) ],

125 
LTP_ORDER
 * –
›us_öt16
 ) );

127 
psPLC
->
pôchL_Q8
 = 
	`sûk_LSHIFT
–
psDecCål
->
pôchL
[ 
psDec
->
nb_sub‰
 - 1 - 
j
 ], 8 );

131 
	`sûk_mem£t
–
psPLC
->
LTPC€f_Q14
, 0, 
LTP_ORDER
 * –
›us_öt16
 ) );

132 
psPLC
->
LTPC€f_Q14
[ 
LTP_ORDER
 / 2 ] = 
LTP_Gaö_Q14
;

135 if–
LTP_Gaö_Q14
 < 
V_PITCH_GAIN_START_MIN_Q14
 ) {

136 
›us_öt
 
sˇÀ_Q10
;

137 
›us_öt32
 
tmp
;

139 
tmp
 = 
	`sûk_LSHIFT
–
V_PITCH_GAIN_START_MIN_Q14
, 10 );

140 
sˇÀ_Q10
 = 
	`sûk_DIV32
–
tmp
, 
	`sûk_max
–
LTP_Gaö_Q14
, 1 ) );

141  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

142 
psPLC
->
LTPC€f_Q14
[ 
i
 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–psPLC->LTPC€f_Q14[ i ], 
sˇÀ_Q10
 ), 10 );

144 } if–
LTP_Gaö_Q14
 > 
V_PITCH_GAIN_START_MAX_Q14
 ) {

145 
›us_öt
 
sˇÀ_Q14
;

146 
›us_öt32
 
tmp
;

148 
tmp
 = 
	`sûk_LSHIFT
–
V_PITCH_GAIN_START_MAX_Q14
, 14 );

149 
sˇÀ_Q14
 = 
	`sûk_DIV32
–
tmp
, 
	`sûk_max
–
LTP_Gaö_Q14
, 1 ) );

150  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

151 
psPLC
->
LTPC€f_Q14
[ 
i
 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–psPLC->LTPC€f_Q14[ i ], 
sˇÀ_Q14
 ), 14 );

155 
psPLC
->
pôchL_Q8
 = 
	`sûk_LSHIFT
–
	`sûk_SMULBB
–
psDec
->
fs_kHz
, 18 ), 8 );

156 
	`sûk_mem£t
–
psPLC
->
LTPC€f_Q14
, 0, 
LTP_ORDER
 * –
›us_öt16
 ));

160 
	`sûk_mem˝y
–
psPLC
->
¥evLPC_Q12
, 
psDecCål
->
PªdC€f_Q12
[ 1 ], 
psDec
->
LPC_‹dî
 * –
›us_öt16
 ) );

161 
psPLC
->
¥evLTP_sˇÀ_Q14
 = 
psDecCål
->
LTP_sˇÀ_Q14
;

164 
	`sûk_mem˝y
–
psPLC
->
¥evGaö_Q16
, &
psDecCål
->
Gaös_Q16
[ 
psDec
->
nb_sub‰
 - 2 ], 2 * –
›us_öt32
 ) );

166 
psPLC
->
sub‰_Àngth
 = 
psDec
->subfr_length;

167 
psPLC
->
nb_sub‰
 = 
psDec
->nb_subfr;

168 
	}
}

170 
OPUS_INLINE
 
	$sûk_PLC_íîgy
(
›us_öt32
 *
íîgy1
, 
›us_öt
 *
shi·1
, opus_öt32 *
íîgy2
, opus_öà*
shi·2
,

171 c⁄° 
›us_öt32
 *
exc_Q14
, c⁄° opus_öt32 *
¥evGaö_Q10
, 
sub‰_Àngth
, 
nb_sub‰
)

173 
i
, 
k
;

174 
	`VARDECL
–
›us_öt16
, 
exc_buf
 );

175 
›us_öt16
 *
exc_buf_±r
;

176 
SAVE_STACK
;

177 
	`ALLOC
–
exc_buf
, 2*
sub‰_Àngth
, 
›us_öt16
 );

180 
exc_buf_±r
 = 
exc_buf
;

181  
k
 = 0; k < 2; k++ ) {

182  
i
 = 0; i < 
sub‰_Àngth
; i++ ) {

183 
exc_buf_±r
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT
(

184 
	`sûk_SMULWW
–
exc_Q14
[ 
i
 + ( 
k
 + 
nb_sub‰
 - 2 ) * 
sub‰_Àngth
 ], 
¥evGaö_Q10
[ k ] ), 8 ) );

186 
exc_buf_±r
 +
sub‰_Àngth
;

189 
	`sûk_sum_sqr_shi·
–
íîgy1
, 
shi·1
, 
exc_buf
, 
sub‰_Àngth
 );

190 
	`sûk_sum_sqr_shi·
–
íîgy2
, 
shi·2
, &
exc_buf
[ 
sub‰_Àngth
 ], subfr_length );

191 
RESTORE_STACK
;

192 
	}
}

194 
OPUS_INLINE
 
	$sûk_PLC_c⁄˚Æ
(

195 
sûk_decodî_°©e
 *
psDec
,

196 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

197 
›us_öt16
 
‰ame
[],

198 
¨ch


201 
›us_öt
 
i
, 
j
, 
k
;

202 
›us_öt
 
œg
, 
idx
, 
sLTP_buf_idx
, 
shi·1
, 
shi·2
;

203 
›us_öt32
 
ønd_£ed
, 
h¨m_Gaö_Q15
, 
ønd_Gaö_Q15
, 
öv_gaö_Q30
;

204 
›us_öt32
 
íîgy1
, 
íîgy2
, *
ønd_±r
, *
¥ed_œg_±r
;

205 
›us_öt32
 
LPC_¥ed_Q10
, 
LTP_¥ed_Q12
;

206 
›us_öt16
 
ønd_sˇÀ_Q14
;

207 
›us_öt16
 *
B_Q14
;

208 
›us_öt32
 *
sLPC_Q14_±r
;

209 
›us_öt16
 
A_Q12
[ 
MAX_LPC_ORDER
 ];

210 #ifde‡
SMALL_FOOTPRINT


211 
›us_öt16
 *
sLTP
;

213 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

215 
	`VARDECL
–
›us_öt32
, 
sLTP_Q14
 );

216 
sûk_PLC_°ru˘
 *
psPLC
 = &
psDec
->
sPLC
;

217 
›us_öt32
 
¥evGaö_Q10
[2];

218 
SAVE_STACK
;

220 
	`ALLOC
–
sLTP_Q14
, 
psDec
->
…p_mem_Àngth
 +ÖsDec->
‰ame_Àngth
, 
›us_öt32
 );

221 #ifde‡
SMALL_FOOTPRINT


223 
sLTP
 = ((
›us_öt16
*)&
sLTP_Q14
[
psDec
->
…p_mem_Àngth
 +ÖsDec->
‰ame_Àngth
])-psDec->ltp_mem_length;

225 
	`ALLOC
–
sLTP
, 
psDec
->
…p_mem_Àngth
, 
›us_öt16
 );

228 
¥evGaö_Q10
[0] = 
	`sûk_RSHIFT
–
psPLC
->
¥evGaö_Q16
[ 0 ], 6);

229 
¥evGaö_Q10
[1] = 
	`sûk_RSHIFT
–
psPLC
->
¥evGaö_Q16
[ 1 ], 6);

231 if–
psDec
->
fú°_‰ame_a·î_ª£t
 ) {

232 
	`sûk_mem£t
–
psPLC
->
¥evLPC_Q12
, 0, (ÖsPLC->prevLPC_Q12 ) );

235 
	`sûk_PLC_íîgy
(&
íîgy1
, &
shi·1
, &
íîgy2
, &
shi·2
, 
psDec
->
exc_Q14
, 
¥evGaö_Q10
,ÖsDec->
sub‰_Àngth
,ÖsDec->
nb_sub‰
);

237 if–
	`sûk_RSHIFT
–
íîgy1
, 
shi·2
 ) < sûk_RSHIFT–
íîgy2
, 
shi·1
 ) ) {

239 
ønd_±r
 = &
psDec
->
exc_Q14
[ 
	`sûk_max_öt
–0, ( 
psPLC
->
nb_sub‰
 - 1 ) *ÖsPLC->
sub‰_Àngth
 - 
RAND_BUF_SIZE
 ) ];

242 
ønd_±r
 = &
psDec
->
exc_Q14
[ 
	`sûk_max_öt
–0, 
psPLC
->
nb_sub‰
 *ÖsPLC->
sub‰_Àngth
 - 
RAND_BUF_SIZE
 ) ];

246 
B_Q14
 = 
psPLC
->
LTPC€f_Q14
;

247 
ønd_sˇÀ_Q14
 = 
psPLC
->
øndSˇÀ_Q14
;

250 
h¨m_Gaö_Q15
 = 
HARM_ATT_Q15
[ 
	`sûk_mö_öt
–
NB_ATT
 - 1, 
psDec
->
lossC¡
 ) ];

251 if–
psDec
->
¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

252 
ønd_Gaö_Q15
 = 
PLC_RAND_ATTENUATE_V_Q15
[ 
	`sûk_mö_öt
–
NB_ATT
 - 1, 
psDec
->
lossC¡
 ) ];

254 
ønd_Gaö_Q15
 = 
PLC_RAND_ATTENUATE_UV_Q15
[ 
	`sûk_mö_öt
–
NB_ATT
 - 1, 
psDec
->
lossC¡
 ) ];

258 
	`sûk_bwex∑ndî
–
psPLC
->
¥evLPC_Q12
, 
psDec
->
LPC_‹dî
, 
	`SILK_FIX_CONST
–
BWE_COEF
, 16 ) );

261 
	`sûk_mem˝y
–
A_Q12
, 
psPLC
->
¥evLPC_Q12
, 
psDec
->
LPC_‹dî
 * –
›us_öt16
 ) );

264 if–
psDec
->
lossC¡
 == 0 ) {

265 
ønd_sˇÀ_Q14
 = 1 << 14;

268 if–
psDec
->
¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

269  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

270 
ønd_sˇÀ_Q14
 -
B_Q14
[ 
i
 ];

272 
ønd_sˇÀ_Q14
 = 
	`sûk_max_16
( 3277,Ñand_scale_Q14 );

273 
ønd_sˇÀ_Q14
 = (
›us_öt16
)
	`sûk_RSHIFT
–
	`sûk_SMULBB
–ønd_sˇÀ_Q14, 
psPLC
->
¥evLTP_sˇÀ_Q14
 ), 14 );

276 
›us_öt32
 
övGaö_Q30
, 
down_sˇÀ_Q30
;

278 
övGaö_Q30
 = 
	`sûk_LPC_övî£_¥ed_gaö
–
psPLC
->
¥evLPC_Q12
, 
psDec
->
LPC_‹dî
, 
¨ch
 );

280 
down_sˇÀ_Q30
 = 
	`sûk_mö_32
–
	`sûk_RSHIFT
–(
›us_öt32
)1 << 30, 
LOG2_INV_LPC_GAIN_HIGH_THRES
 ), 
övGaö_Q30
 );

281 
down_sˇÀ_Q30
 = 
	`sûk_max_32
–
	`sûk_RSHIFT
–(
›us_öt32
)1 << 30, 
LOG2_INV_LPC_GAIN_LOW_THRES
 ), down_scale_Q30 );

282 
down_sˇÀ_Q30
 = 
	`sûk_LSHIFT
–down_sˇÀ_Q30, 
LOG2_INV_LPC_GAIN_HIGH_THRES
 );

284 
ønd_Gaö_Q15
 = 
	`sûk_RSHIFT
–
	`sûk_SMULWB
–
down_sˇÀ_Q30
,Ñand_Gain_Q15 ), 14 );

288 
ønd_£ed
 = 
psPLC
->rand_seed;

289 
œg
 = 
	`sûk_RSHIFT_ROUND
–
psPLC
->
pôchL_Q8
, 8 );

290 
sLTP_buf_idx
 = 
psDec
->
…p_mem_Àngth
;

293 
idx
 = 
psDec
->
…p_mem_Àngth
 - 
œg
 -ÖsDec->
LPC_‹dî
 - 
LTP_ORDER
 / 2;

294 
	`˚…_as£π
–
idx
 > 0 );

295 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
idx
 ], &
psDec
->
outBuf
[ idx ], 
A_Q12
,ÖsDec->
…p_mem_Àngth
 - idx,ÖsDec->
LPC_‹dî
, 
¨ch
 );

297 
öv_gaö_Q30
 = 
	`sûk_INVERSE32_v¨Q
–
psPLC
->
¥evGaö_Q16
[ 1 ], 46 );

298 
öv_gaö_Q30
 = 
	`sûk_mö
–öv_gaö_Q30, 
sûk_öt32_MAX
 >> 1 );

299  
i
 = 
idx
 + 
psDec
->
LPC_‹dî
; i <ÖsDec->
…p_mem_Àngth
; i++ ) {

300 
sLTP_Q14
[ 
i
 ] = 
	`sûk_SMULWB
–
öv_gaö_Q30
, 
sLTP
[ i ] );

306  
k
 = 0; k < 
psDec
->
nb_sub‰
; k++ ) {

308 
¥ed_œg_±r
 = &
sLTP_Q14
[ 
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

309  
i
 = 0; i < 
psDec
->
sub‰_Àngth
; i++ ) {

312 
LTP_¥ed_Q12
 = 2;

313 
LTP_¥ed_Q12
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q12, 
¥ed_œg_±r
[ 0 ], 
B_Q14
[ 0 ] );

314 
LTP_¥ed_Q12
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q12, 
¥ed_œg_±r
[ -1 ], 
B_Q14
[ 1 ] );

315 
LTP_¥ed_Q12
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q12, 
¥ed_œg_±r
[ -2 ], 
B_Q14
[ 2 ] );

316 
LTP_¥ed_Q12
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q12, 
¥ed_œg_±r
[ -3 ], 
B_Q14
[ 3 ] );

317 
LTP_¥ed_Q12
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q12, 
¥ed_œg_±r
[ -4 ], 
B_Q14
[ 4 ] );

318 
¥ed_œg_±r
++;

321 
ønd_£ed
 = 
	`sûk_RAND
(Ñand_seed );

322 
idx
 = 
	`sûk_RSHIFT
–
ønd_£ed
, 25 ) & 
RAND_BUF_MASK
;

323 
sLTP_Q14
[ 
sLTP_buf_idx
 ] = 
	`sûk_LSHIFT32
–
	`sûk_SMLAWB
–
LTP_¥ed_Q12
, 
ønd_±r
[ 
idx
 ], 
ønd_sˇÀ_Q14
 ), 2 );

324 
sLTP_buf_idx
++;

328  
j
 = 0; j < 
LTP_ORDER
; j++ ) {

329 
B_Q14
[ 
j
 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
h¨m_Gaö_Q15
, B_Q14[ j ] ), 15 );

331 i‡–
psDec
->
ödi˚s
.
sig«lTy≥
 !
TYPE_NO_VOICE_ACTIVITY
 ) {

333 
ønd_sˇÀ_Q14
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–ønd_sˇÀ_Q14, 
ønd_Gaö_Q15
 ), 15 );

337 
psPLC
->
pôchL_Q8
 = 
	`sûk_SMLAWB
–psPLC->pôchL_Q8,ÖsPLC->pôchL_Q8, 
PITCH_DRIFT_FAC_Q16
 );

338 
psPLC
->
pôchL_Q8
 = 
	`sûk_mö_32
–psPLC->pôchL_Q8, 
	`sûk_LSHIFT
–
	`sûk_SMULBB
–
MAX_PITCH_LAG_MS
, 
psDec
->
fs_kHz
 ), 8 ) );

339 
œg
 = 
	`sûk_RSHIFT_ROUND
–
psPLC
->
pôchL_Q8
, 8 );

345 
sLPC_Q14_±r
 = &
sLTP_Q14
[ 
psDec
->
…p_mem_Àngth
 - 
MAX_LPC_ORDER
 ];

348 
	`sûk_mem˝y
–
sLPC_Q14_±r
, 
psDec
->
sLPC_Q14_buf
, 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

350 
	`˚…_as£π
–
psDec
->
LPC_‹dî
 >= 10 );

351  
i
 = 0; i < 
psDec
->
‰ame_Àngth
; i++ ) {

354 
LPC_¥ed_Q10
 = 
	`sûk_RSHIFT
–
psDec
->
LPC_‹dî
, 1 );

355 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 1 ], 
A_Q12
[ 0 ] );

356 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 2 ], 
A_Q12
[ 1 ] );

357 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 3 ], 
A_Q12
[ 2 ] );

358 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 4 ], 
A_Q12
[ 3 ] );

359 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 5 ], 
A_Q12
[ 4 ] );

360 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 6 ], 
A_Q12
[ 5 ] );

361 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 7 ], 
A_Q12
[ 6 ] );

362 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 8 ], 
A_Q12
[ 7 ] );

363 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 9 ], 
A_Q12
[ 8 ] );

364 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 10 ], 
A_Q12
[ 9 ] );

365  
j
 = 10; j < 
psDec
->
LPC_‹dî
; j++ ) {

366 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 - 
j
 - 1 ], 
A_Q12
[ j ] );

370 
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + 
i
 ] = 
	`sûk_ADD_SAT32
( sLPC_Q14_ptr[ MAX_LPC_ORDER + i ],

371 
	`sûk_LSHIFT_SAT32
–
LPC_¥ed_Q10
, 4 ));

374 
‰ame
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–sûk_SAT16–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
sLPC_Q14_±r
[ 
MAX_LPC_ORDER
 + i ], 
¥evGaö_Q10
[ 1 ] ), 8 ) ) );

378 
	`sûk_mem˝y
–
psDec
->
sLPC_Q14_buf
, &
sLPC_Q14_±r
[ÖsDec->
‰ame_Àngth
 ], 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

383 
psPLC
->
ønd_£ed
 =Ñand_seed;

384 
psPLC
->
øndSˇÀ_Q14
 = 
ønd_sˇÀ_Q14
;

385  
i
 = 0; i < 
MAX_NB_SUBFR
; i++ ) {

386 
psDecCål
->
pôchL
[ 
i
 ] = 
œg
;

388 
RESTORE_STACK
;

389 
	}
}

392 
	$sûk_PLC_glue_‰ames
(

393 
sûk_decodî_°©e
 *
psDec
,

394 
›us_öt16
 
‰ame
[],

395 
›us_öt
 
Àngth


398 
›us_öt
 
i
, 
íîgy_shi·
;

399 
›us_öt32
 
íîgy
;

400 
sûk_PLC_°ru˘
 *
psPLC
;

401 
psPLC
 = &
psDec
->
sPLC
;

403 if–
psDec
->
lossC¡
 ) {

405 
	`sûk_sum_sqr_shi·
–&
psPLC
->
c⁄c_íîgy
, &psPLC->
c⁄c_íîgy_shi·
, 
‰ame
, 
Àngth
 );

407 
psPLC
->
œ°_‰ame_lo°
 = 1;

409 if–
psDec
->
sPLC
.
œ°_‰ame_lo°
 ) {

411 
	`sûk_sum_sqr_shi·
–&
íîgy
, &
íîgy_shi·
, 
‰ame
, 
Àngth
 );

414 if–
íîgy_shi·
 > 
psPLC
->
c⁄c_íîgy_shi·
 ) {

415 
psPLC
->
c⁄c_íîgy
 = 
	`sûk_RSHIFT
–psPLC->c⁄c_íîgy, 
íîgy_shi·
 -ÖsPLC->
c⁄c_íîgy_shi·
 );

416 } if–
íîgy_shi·
 < 
psPLC
->
c⁄c_íîgy_shi·
 ) {

417 
íîgy
 = 
	`sûk_RSHIFT
–íîgy, 
psPLC
->
c⁄c_íîgy_shi·
 - 
íîgy_shi·
 );

421 if–
íîgy
 > 
psPLC
->
c⁄c_íîgy
 ) {

422 
›us_öt32
 
‰ac_Q24
, 
LZ
;

423 
›us_öt32
 
gaö_Q16
, 
¶›e_Q16
;

425 
LZ
 = 
	`sûk_CLZ32
–
psPLC
->
c⁄c_íîgy
 );

426 
LZ
 = LZ - 1;

427 
psPLC
->
c⁄c_íîgy
 = 
	`sûk_LSHIFT
–psPLC->c⁄c_íîgy, 
LZ
 );

428 
íîgy
 = 
	`sûk_RSHIFT
–íîgy, 
	`sûk_max_32
–24 - 
LZ
, 0 ) );

430 
‰ac_Q24
 = 
	`sûk_DIV32
–
psPLC
->
c⁄c_íîgy
, 
	`sûk_max
–
íîgy
, 1 ) );

432 
gaö_Q16
 = 
	`sûk_LSHIFT
–
	`sûk_SQRT_APPROX
–
‰ac_Q24
 ), 4 );

433 
¶›e_Q16
 = 
	`sûk_DIV32_16
––(
›us_öt32
)1 << 16 ) - 
gaö_Q16
, 
Àngth
 );

435 
¶›e_Q16
 = 
	`sûk_LSHIFT
( slope_Q16, 2 );

437  
i
 = 0; i < 
Àngth
; i++ ) {

438 
‰ame
[ 
i
 ] = 
	`sûk_SMULWB
–
gaö_Q16
, frame[ i ] );

439 
gaö_Q16
 +
¶›e_Q16
;

440 if–
gaö_Q16
 > (
›us_öt32
)1 << 16 ) {

446 
psPLC
->
œ°_‰ame_lo°
 = 0;

448 
	}
}

	@silk/PLC.h

28 #i‚de‡
SILK_PLC_H


29 
	#SILK_PLC_H


	)

31 
	~"maö.h
"

33 
	#BWE_COEF
 0.99

	)

34 
	#V_PITCH_GAIN_START_MIN_Q14
 11469

	)

35 
	#V_PITCH_GAIN_START_MAX_Q14
 15565

	)

36 
	#MAX_PITCH_LAG_MS
 18

	)

37 
	#RAND_BUF_SIZE
 128

	)

38 
	#RAND_BUF_MASK
 ( 
RAND_BUF_SIZE
 - 1 )

	)

39 
	#LOG2_INV_LPC_GAIN_HIGH_THRES
 3

	)

40 
	#LOG2_INV_LPC_GAIN_LOW_THRES
 8

	)

41 
	#PITCH_DRIFT_FAC_Q16
 655

	)

43 
sûk_PLC_Re£t
(

44 
sûk_decodî_°©e
 *
psDec


47 
sûk_PLC
(

48 
sûk_decodî_°©e
 *
psDec
,

49 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

50 
›us_öt16
 
‰ame
[],

51 
›us_öt
 
lo°
,

52 
¨ch


55 
sûk_PLC_glue_‰ames
(

56 
sûk_decodî_°©e
 *
psDec
,

57 
›us_öt16
 
‰ame
[],

58 
›us_öt
 
Àngth


	@silk/SigProc_FIX.h

28 #i‚de‡
SILK_SIGPROC_FIX_H


29 
	#SILK_SIGPROC_FIX_H


	)

31 #ifde‡ 
__˝lu•lus


38 
	#SILK_MAX_ORDER_LPC
 24

	)

40 
	~<°rög.h
>

41 
	~"ty≥def.h
"

42 
	~"ªßm∂î_°ru˘s.h
"

43 
	~"ma¸os.h
"

44 
	~"˝u_suµ‹t.h
"

46 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

47 
	~"x86/SigProc_FIX_s£.h
"

50 #i‡(
deföed
(
OPUS_ARM_ASM
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
))

51 
	~"¨m/biquad_Æt_¨m.h
"

52 
	~"¨m/LPC_öv_¥ed_gaö_¨m.h
"

62 
›us_öt
 
sûk_ªßm∂î_öô
(

63 
sûk_ªßm∂î_°©e_°ru˘
 *
S
,

64 
›us_öt32
 
Fs_Hz_ö
,

65 
›us_öt32
 
Fs_Hz_out
,

66 
›us_öt
 
f‹Enc


72 
›us_öt
 
sûk_ªßm∂î
(

73 
sûk_ªßm∂î_°©e_°ru˘
 *
S
,

74 
›us_öt16
 
out
[],

75 c⁄° 
›us_öt16
 
ö
[],

76 
›us_öt32
 
öLí


82 
sûk_ªßm∂î_down2
(

83 
›us_öt32
 *
S
,

84 
›us_öt16
 *
out
,

85 c⁄° 
›us_öt16
 *
ö
,

86 
›us_öt32
 
öLí


92 
sûk_ªßm∂î_down2_3
(

93 
›us_öt32
 *
S
,

94 
›us_öt16
 *
out
,

95 c⁄° 
›us_öt16
 *
ö
,

96 
›us_öt32
 
öLí


104 
sûk_biquad_Æt_°ride1
(

105 c⁄° 
›us_öt16
 *
ö
,

106 c⁄° 
›us_öt32
 *
B_Q28
,

107 c⁄° 
›us_öt32
 *
A_Q28
,

108 
›us_öt32
 *
S
,

109 
›us_öt16
 *
out
,

110 c⁄° 
›us_öt32
 
Àn


113 
sûk_biquad_Æt_°ride2_c
(

114 c⁄° 
›us_öt16
 *
ö
,

115 c⁄° 
›us_öt32
 *
B_Q28
,

116 c⁄° 
›us_öt32
 *
A_Q28
,

117 
›us_öt32
 *
S
,

118 
›us_öt16
 *
out
,

119 c⁄° 
›us_öt32
 
Àn


123 
sûk_LPC_™Æysis_fûãr
(

124 
›us_öt16
 *
out
,

125 c⁄° 
›us_öt16
 *
ö
,

126 c⁄° 
›us_öt16
 *
B
,

127 c⁄° 
›us_öt32
 
Àn
,

128 c⁄° 
›us_öt32
 
d
,

129 
¨ch


133 
sûk_bwex∑ndî
(

134 
›us_öt16
 *
¨
,

135 c⁄° 
›us_öt
 
d
,

136 
›us_öt32
 
chúp_Q16


140 
sûk_bwex∑ndî_32
(

141 
›us_öt32
 *
¨
,

142 c⁄° 
›us_öt
 
d
,

143 
›us_öt32
 
chúp_Q16


148 
›us_öt32
 
sûk_LPC_övî£_¥ed_gaö_c
(

149 c⁄° 
›us_öt16
 *
A_Q12
,

150 c⁄° 
›us_öt
 
‹dî


154 
sûk_™a_fût_b™k_1
(

155 c⁄° 
›us_öt16
 *
ö
,

156 
›us_öt32
 *
S
,

157 
›us_öt16
 *
outL
,

158 
›us_öt16
 *
outH
,

159 c⁄° 
›us_öt32
 
N


162 #i‡!
deföed
(
OVERRIDE_sûk_biquad_Æt_°ride2
)

163 
	#sûk_biquad_Æt_°ride2
(
ö
, 
B_Q28
, 
A_Q28
, 
S
, 
out
, 
Àn
, 
¨ch
Ë(()◊rch), 
	`sûk_biquad_Æt_°ride2_c
(ö, B_Q28, A_Q28, S, out,Üí))

	)

166 #i‡!
deföed
(
OVERRIDE_sûk_LPC_övî£_¥ed_gaö
)

167 
	#sûk_LPC_övî£_¥ed_gaö
(
A_Q12
, 
‹dî
, 
¨ch
Ë(()◊rch), 
	`sûk_LPC_övî£_¥ed_gaö_c
(A_Q12, ordî))

	)

176 
›us_öt32
 
sûk_lö2log
(

177 c⁄° 
›us_öt32
 
öLö


181 
›us_öt
 
sûk_sigm_Q15
(

182 
›us_öt
 
ö_Q5


187 
›us_öt32
 
sûk_log2lö
(

188 c⁄° 
›us_öt32
 
öLog_Q7


193 
sûk_sum_sqr_shi·
(

194 
›us_öt32
 *
íîgy
,

195 
›us_öt
 *
shi·
,

196 c⁄° 
›us_öt16
 *
x
,

197 
›us_öt
 
Àn


203 
›us_öt32
 
sûk_schur
(

204 
›us_öt16
 *
rc_Q15
,

205 c⁄° 
›us_öt32
 *
c
,

206 c⁄° 
›us_öt32
 
‹dî


212 
›us_öt32
 
sûk_schur64
(

213 
›us_öt32
 
rc_Q16
[],

214 c⁄° 
›us_öt32
 
c
[],

215 
›us_öt32
 
‹dî


219 
sûk_k2a
(

220 
›us_öt32
 *
A_Q24
,

221 c⁄° 
›us_öt16
 *
rc_Q15
,

222 c⁄° 
›us_öt32
 
‹dî


226 
sûk_k2a_Q16
(

227 
›us_öt32
 *
A_Q24
,

228 c⁄° 
›us_öt32
 *
rc_Q16
,

229 c⁄° 
›us_öt32
 
‹dî


237 
sûk_≠∂y_söe_wödow
(

238 
›us_öt16
 
px_wö
[],

239 c⁄° 
›us_öt16
 
px
[],

240 c⁄° 
›us_öt
 
wö_ty≥
,

241 c⁄° 
›us_öt
 
Àngth


245 
sûk_autoc‹r
(

246 
›us_öt32
 *
ªsu…s
,

247 
›us_öt
 *
sˇÀ
,

248 c⁄° 
›us_öt16
 *
öputD©a
,

249 c⁄° 
›us_öt
 
öputD©aSize
,

250 c⁄° 
›us_öt
 
c‹ªœti⁄Cou¡
,

251 
¨ch


254 
sûk_decode_pôch
(

255 
›us_öt16
 
œgIndex
,

256 
›us_öt8
 
c⁄tourIndex
,

257 
›us_öt
 
pôch_œgs
[],

258 c⁄° 
›us_öt
 
Fs_kHz
,

259 c⁄° 
›us_öt
 
nb_sub‰


262 
›us_öt
 
sûk_pôch_™Æysis_c‹e
(

263 c⁄° 
›us_öt16
 *
‰ame
,

264 
›us_öt
 *
pôch_out
,

265 
›us_öt16
 *
œgIndex
,

266 
›us_öt8
 *
c⁄tourIndex
,

267 
›us_öt
 *
LTPC‹r_Q15
,

268 
›us_öt
 
¥evLag
,

269 c⁄° 
›us_öt32
 
£¨ch_thªs1_Q16
,

270 c⁄° 
›us_öt
 
£¨ch_thªs2_Q13
,

271 c⁄° 
›us_öt
 
Fs_kHz
,

272 c⁄° 
›us_öt
 
com∂exôy
,

273 c⁄° 
›us_öt
 
nb_sub‰
,

274 
¨ch


279 
sûk_A2NLSF
(

280 
›us_öt16
 *
NLSF
,

281 
›us_öt32
 *
a_Q16
,

282 c⁄° 
›us_öt
 
d


286 
sûk_NLSF2A
(

287 
›us_öt16
 *
a_Q12
,

288 c⁄° 
›us_öt16
 *
NLSF
,

289 c⁄° 
›us_öt
 
d
,

290 
¨ch


294 
sûk_LPC_fô
(

295 
›us_öt16
 *
a_QOUT
,

296 
›us_öt32
 *
a_QIN
,

297 c⁄° 
›us_öt
 
QOUT
,

298 c⁄° 
›us_öt
 
QIN
,

299 c⁄° 
›us_öt
 
d


302 
sûk_ö£πi⁄_s‹t_ö¸ósög
(

303 
›us_öt32
 *
a
,

304 
›us_öt
 *
idx
,

305 c⁄° 
›us_öt
 
L
,

306 c⁄° 
›us_öt
 
K


309 
sûk_ö£πi⁄_s‹t_de¸ósög_öt16
(

310 
›us_öt16
 *
a
,

311 
›us_öt
 *
idx
,

312 c⁄° 
›us_öt
 
L
,

313 c⁄° 
›us_öt
 
K


316 
sûk_ö£πi⁄_s‹t_ö¸ósög_Æl_vÆues_öt16
(

317 
›us_öt16
 *
a
,

318 c⁄° 
›us_öt
 
L


322 
sûk_NLSF_°abûize
(

323 
›us_öt16
 *
NLSF_Q15
,

324 c⁄° 
›us_öt16
 *
NDñèMö_Q15
,

325 c⁄° 
›us_öt
 
L


329 
sûk_NLSF_VQ_weights_œroü
(

330 
›us_öt16
 *
pNLSFW_Q_OUT
,

331 c⁄° 
›us_öt16
 *
pNLSF_Q15
,

332 c⁄° 
›us_öt
 
D


336 
sûk_burg_modifõd_c
(

337 
›us_öt32
 *
ªs_ƒg
,

338 
›us_öt
 *
ªs_ƒg_Q
,

339 
›us_öt32
 
A_Q16
[],

340 c⁄° 
›us_öt16
 
x
[],

341 c⁄° 
›us_öt32
 
möInvGaö_Q30
,

342 c⁄° 
›us_öt
 
sub‰_Àngth
,

343 c⁄° 
›us_öt
 
nb_sub‰
,

344 c⁄° 
›us_öt
 
D
,

345 
¨ch


349 
sûk_sˇÀ_c›y_ve˘‹16
(

350 
›us_öt16
 *
d©a_out
,

351 c⁄° 
›us_öt16
 *
d©a_ö
,

352 
›us_öt32
 
gaö_Q16
,

353 c⁄° 
›us_öt
 
d©aSize


357 
sûk_sˇÀ_ve˘‹32_Q26_lshi·_18
(

358 
›us_öt32
 *
d©a1
,

359 
›us_öt32
 
gaö_Q26
,

360 
›us_öt
 
d©aSize


369 
›us_öt32
 
sûk_ö√r_¥od_Æig√d
(

370 c⁄° 
›us_öt16
 *c⁄° 
öVec1
,

371 c⁄° 
›us_öt16
 *c⁄° 
öVec2
,

372 c⁄° 
›us_öt
 
Àn
,

373 
¨ch


377 
›us_öt32
 
sûk_ö√r_¥od_Æig√d_sˇÀ
(

378 c⁄° 
›us_öt16
 *c⁄° 
öVec1
,

379 c⁄° 
›us_öt16
 *c⁄° 
öVec2
,

380 c⁄° 
›us_öt
 
sˇÀ
,

381 c⁄° 
›us_öt
 
Àn


384 
›us_öt64
 
sûk_ö√r_¥od16_Æig√d_64_c
(

385 c⁄° 
›us_öt16
 *
öVec1
,

386 c⁄° 
›us_öt16
 *
öVec2
,

387 c⁄° 
›us_öt
 
Àn


398 
OPUS_INLINE
 
›us_öt32
 
sûk_ROR32
–›us_öt32 
a32
, 
›us_öt
 
rŸ
 )

400 
›us_uöt32
 
x
 = (›us_uöt32Ë
a32
;

401 
›us_uöt32
 
r
 = (›us_uöt32Ë
rŸ
;

402 
›us_uöt32
 
m
 = (›us_uöt32Ë-
rŸ
;

403 if–
rŸ
 == 0 ) {

404  
a32
;

405 } if–
rŸ
 < 0 ) {

406  (
›us_öt32
Ë((
x
 << 
m
) | (x >> (32 - m)));

408  (
›us_öt32
Ë((
x
 << (32 - 
r
)) | (x >>Ñ));

413 #i‡
EMBEDDED_ARM


414 
	#sûk_DWORD_ALIGN
 
	`__©åibuã__
((
	`Æig√d
(4)))

	)

416 
	#sûk_DWORD_ALIGN


	)

420 
	#sûk_mem˝y
(
de°
, 
§c
, 
size
Ë
	`mem˝y
((de°), (§c), (size))

	)

421 
	#sûk_mem£t
(
de°
, 
§c
, 
size
Ë
	`mem£t
((de°), (§c), (size))

	)

422 
	#sûk_memmove
(
de°
, 
§c
, 
size
Ë
	`memmove
((de°), (§c), (size))

	)

427 
	#sûk_MUL
(
a32
, 
b32
Ë(◊32Ë* (b32))

	)

430 
	#sûk_MUL_uöt
(
a32
, 
b32
Ë
	`sûk_MUL
◊32, b32)

	)

433 
	#sûk_MLA
(
a32
, 
b32
, 
c32
Ë
	`sûk_ADD32
(◊32),((b32Ë* (c32)))

	)

436 
	#sûk_MLA_uöt
(
a32
, 
b32
, 
c32
Ë
	`sûk_MLA
◊32, b32, c32)

	)

439 
	#sûk_SMULTT
(
a32
, 
b32
Ë((◊32Ë>> 16Ë* ((b32Ë>> 16))

	)

442 
	#sûk_SMLATT
(
a32
, 
b32
, 
c32
Ë
	`sûk_ADD32
(◊32),((b32Ë>> 16Ë* ((c32Ë>> 16))

	)

444 
	#sûk_SMLALBB
(
a64
, 
b16
, 
c16
Ë
	`sûk_ADD64
(◊64),(
›us_öt64
)((
›us_öt32
)(b16Ë* (›us_öt32)(c16)))

	)

447 
	#sûk_SMULL
(
a32
, 
b32
Ë((
›us_öt64
)◊32Ë* (b32))

	)

451 
	#sûk_ADD32_ovÊw
(
a
, 
b
Ë((
›us_öt32
)((
›us_uöt32
)◊Ë+ (›us_uöt32)(b)))

	)

454 
	#sûk_SUB32_ovÊw
(
a
, 
b
Ë((
›us_öt32
)((
›us_uöt32
)◊Ë- (›us_uöt32)(b)))

	)

457 
	#sûk_MLA_ovÊw
(
a32
, 
b32
, 
c32
Ë
	`sûk_ADD32_ovÊw
(◊32), (
›us_uöt32
)(b32Ë* (›us_uöt32)(c32))

	)

458 
	#sûk_SMLABB_ovÊw
(
a32
, 
b32
, 
c32
Ë(
	`sûk_ADD32_ovÊw
(◊32Ë, ((
›us_öt32
)((
›us_öt16
)(b32))Ë* (›us_öt32)((›us_öt16)(c32))))

	)

460 
	#sûk_DIV32_16
(
a32
, 
b16
Ë((
›us_öt32
)(◊32Ë/ (b16)))

	)

461 
	#sûk_DIV32
(
a32
, 
b32
Ë((
›us_öt32
)(◊32Ë/ (b32)))

	)

464 
	#sûk_ADD16
(
a
, 
b
Ë(◊Ë+ (b))

	)

465 
	#sûk_ADD32
(
a
, 
b
Ë(◊Ë+ (b))

	)

466 
	#sûk_ADD64
(
a
, 
b
Ë(◊Ë+ (b))

	)

468 
	#sûk_SUB16
(
a
, 
b
Ë(◊Ë- (b))

	)

469 
	#sûk_SUB32
(
a
, 
b
Ë(◊Ë- (b))

	)

470 
	#sûk_SUB64
(
a
, 
b
Ë(◊Ë- (b))

	)

472 
	#sûk_SAT8
(
a
Ë(◊Ë> 
sûk_öt8_MAX
 ? silk_int8_MAX : \

473 ((
a
Ë< 
sûk_öt8_MIN
 ? sûk_öt8_MIN : (a)))

	)

474 
	#sûk_SAT16
(
a
Ë(◊Ë> 
sûk_öt16_MAX
 ? silk_int16_MAX : \

475 ((
a
Ë< 
sûk_öt16_MIN
 ? sûk_öt16_MIN : (a)))

	)

476 
	#sûk_SAT32
(
a
Ë(◊Ë> 
sûk_öt32_MAX
 ? silk_int32_MAX : \

477 ((
a
Ë< 
sûk_öt32_MIN
 ? sûk_öt32_MIN : (a)))

	)

479 
	#sûk_CHECK_FIT8
(
a
Ë◊)

	)

480 
	#sûk_CHECK_FIT16
(
a
Ë◊)

	)

481 
	#sûk_CHECK_FIT32
(
a
Ë◊)

	)

483 
	#sûk_ADD_SAT16
(
a
, 
b
Ë(
›us_öt16
)
	`sûk_SAT16
–
	`sûk_ADD32
–(
›us_öt32
)◊), (bËË)

	)

484 
	#sûk_ADD_SAT64
(
a
, 
b
) ((((a) + (b)) & 0x8000000000000000LL) == 0 ? \

485 ((((
a
Ë& (
b
)Ë& 0x8000000000000000LLË!0 ? 
sûk_öt64_MIN
 : (a)+(b)) : \

486 ((((
a
Ë| (
b
)Ë& 0x8000000000000000LLË=0 ? 
sûk_öt64_MAX
 : (a)+(b)Ë)

	)

488 
	#sûk_SUB_SAT16
(
a
, 
b
Ë(
›us_öt16
)
	`sûk_SAT16
–
	`sûk_SUB32
–(
›us_öt32
)◊), (bËË)

	)

489 
	#sûk_SUB_SAT64
(
a
, 
b
) ((((a)-(b)) & 0x8000000000000000LL) == 0 ? \

490 (–(
a
Ë& ((
b
)^0x8000000000000000LLË& 0x8000000000000000LLË? 
sûk_öt64_MIN
 : (a)-(b)) : \

491 ((((
a
)^0x8000000000000000LLË& (
b
Ë& 0x8000000000000000LLË? 
sûk_öt64_MAX
 : (a)-(b)Ë)

	)

494 
	#sûk_POS_SAT32
(
a
Ë(◊Ë> 
sûk_öt32_MAX
 ? sûk_öt32_MAX : (a))

	)

497 
	#sûk_ADD_POS_SAT8
(
a
, 
b
Ë(((◊)+(b)Ë& 0x80Ë? 
sûk_öt8_MAX
 : (◊)+(b)))

	)

498 
	#sûk_ADD_POS_SAT16
(
a
, 
b
Ë(((◊)+(b)Ë& 0x8000Ë? 
sûk_öt16_MAX
 : (◊)+(b)))

	)

499 
	#sûk_ADD_POS_SAT32
(
a
, 
b
Ë((((
›us_uöt32
)◊)+(›us_uöt32)(b)Ë& 0x80000000Ë? 
sûk_öt32_MAX
 : (◊)+(b)))

	)

501 
	#sûk_LSHIFT8
(
a
, 
shi·
Ë((
›us_öt8
)((
›us_uöt8
)◊)<<(shi·))Ë

	)

502 
	#sûk_LSHIFT16
(
a
, 
shi·
Ë((
›us_öt16
)((
›us_uöt16
)◊)<<(shi·))Ë

	)

503 
	#sûk_LSHIFT32
(
a
, 
shi·
Ë((
›us_öt32
)((
›us_uöt32
)◊)<<(shi·))Ë

	)

504 
	#sûk_LSHIFT64
(
a
, 
shi·
Ë((
›us_öt64
)((
›us_uöt64
)◊)<<(shi·))Ë

	)

505 
	#sûk_LSHIFT
(
a
, 
shi·
Ë
	`sûk_LSHIFT32
◊, shi·Ë

	)

507 
	#sûk_RSHIFT8
(
a
, 
shi·
Ë(◊)>>(shi·)Ë

	)

508 
	#sûk_RSHIFT16
(
a
, 
shi·
Ë(◊)>>(shi·)Ë

	)

509 
	#sûk_RSHIFT32
(
a
, 
shi·
Ë(◊)>>(shi·)Ë

	)

510 
	#sûk_RSHIFT64
(
a
, 
shi·
Ë(◊)>>(shi·)Ë

	)

511 
	#sûk_RSHIFT
(
a
, 
shi·
Ë
	`sûk_RSHIFT32
◊, shi·Ë

	)

514 
	#sûk_LSHIFT_SAT32
(
a
, 
shi·
Ë(
	`sûk_LSHIFT32
–
	`sûk_LIMIT
–◊), 
	`sûk_RSHIFT32
–
sûk_öt32_MIN
, (shift) ), \

515 
	`sûk_RSHIFT32
–
sûk_öt32_MAX
, (
shi·
ËË), (shi·Ë))

	)

517 
	#sûk_LSHIFT_ovÊw
(
a
, 
shi·
Ë((
›us_öt32
)((
›us_uöt32
)◊Ë<< (shi·))Ë

	)

518 
	#sûk_LSHIFT_uöt
(
a
, 
shi·
Ë(◊Ë<< (shi·)Ë

	)

519 
	#sûk_RSHIFT_uöt
(
a
, 
shi·
Ë(◊Ë>> (shi·)Ë

	)

521 
	#sûk_ADD_LSHIFT
(
a
, 
b
, 
shi·
Ë(◊Ë+ 
	`sûk_LSHIFT
((b), (shi·))Ë

	)

522 
	#sûk_ADD_LSHIFT32
(
a
, 
b
, 
shi·
Ë
	`sûk_ADD32
(◊), 
	`sûk_LSHIFT32
((b), (shi·))Ë

	)

523 
	#sûk_ADD_LSHIFT_uöt
(
a
, 
b
, 
shi·
Ë(◊Ë+ 
	`sûk_LSHIFT_uöt
((b), (shi·))Ë

	)

524 
	#sûk_ADD_RSHIFT
(
a
, 
b
, 
shi·
Ë(◊Ë+ 
	`sûk_RSHIFT
((b), (shi·))Ë

	)

525 
	#sûk_ADD_RSHIFT32
(
a
, 
b
, 
shi·
Ë
	`sûk_ADD32
(◊), 
	`sûk_RSHIFT32
((b), (shi·))Ë

	)

526 
	#sûk_ADD_RSHIFT_uöt
(
a
, 
b
, 
shi·
Ë(◊Ë+ 
	`sûk_RSHIFT_uöt
((b), (shi·))Ë

	)

527 
	#sûk_SUB_LSHIFT32
(
a
, 
b
, 
shi·
Ë
	`sûk_SUB32
(◊), 
	`sûk_LSHIFT32
((b), (shi·))Ë

	)

528 
	#sûk_SUB_RSHIFT32
(
a
, 
b
, 
shi·
Ë
	`sûk_SUB32
(◊), 
	`sûk_RSHIFT32
((b), (shi·))Ë

	)

531 
	#sûk_RSHIFT_ROUND
(
a
, 
shi·
Ë((shi·Ë=1 ? (◊Ë>> 1Ë+ (◊Ë& 1Ë: ((◊Ë>> ((shi·Ë- 1)Ë+ 1Ë>> 1)

	)

532 
	#sûk_RSHIFT_ROUND64
(
a
, 
shi·
Ë((shi·Ë=1 ? (◊Ë>> 1Ë+ (◊Ë& 1Ë: ((◊Ë>> ((shi·Ë- 1)Ë+ 1Ë>> 1)

	)

535 
	#sûk_NSHIFT_MUL_32_32
(
a
, 
b
Ë–-(31- (32-
	`sûk_CLZ32
(
	`sûk_abs
◊)Ë+ (32-sûk_CLZ32(sûk_abs(b))))Ë)

	)

536 
	#sûk_NSHIFT_MUL_16_16
(
a
, 
b
Ë–-(15- (16-
	`sûk_CLZ16
(
	`sûk_abs
◊)Ë+ (16-sûk_CLZ16(sûk_abs(b))))Ë)

	)

539 
	#sûk_mö
(
a
, 
b
Ë((◊Ë< (b)Ë? (aË: (b))

	)

540 
	#sûk_max
(
a
, 
b
Ë((◊Ë> (b)Ë? (aË: (b))

	)

543 
	#SILK_FIX_CONST
–
C
, 
Q
 ) ((
›us_öt32
)((CË* ((
›us_öt64
)1 << (Q)Ë+ 0.5))

	)

546 
OPUS_INLINE
 
›us_öt
 
sûk_mö_öt
(›us_öà
a
, opus_öà
b
)

548  (((
a
Ë< (
b
)) ? (a) : (b));

550 
OPUS_INLINE
 
›us_öt16
 
sûk_mö_16
(›us_öt16 
a
, opus_öt16 
b
)

552  (((
a
Ë< (
b
)) ? (a) : (b));

554 
OPUS_INLINE
 
›us_öt32
 
sûk_mö_32
(›us_öt32 
a
, opus_öt32 
b
)

556  (((
a
Ë< (
b
)) ? (a) : (b));

558 
OPUS_INLINE
 
›us_öt64
 
sûk_mö_64
(›us_öt64 
a
, opus_öt64 
b
)

560  (((
a
Ë< (
b
)) ? (a) : (b));

564 
OPUS_INLINE
 
›us_öt
 
sûk_max_öt
(›us_öà
a
, opus_öà
b
)

566  (((
a
Ë> (
b
)) ? (a) : (b));

568 
OPUS_INLINE
 
›us_öt16
 
sûk_max_16
(›us_öt16 
a
, opus_öt16 
b
)

570  (((
a
Ë> (
b
)) ? (a) : (b));

572 
OPUS_INLINE
 
›us_öt32
 
sûk_max_32
(›us_öt32 
a
, opus_öt32 
b
)

574  (((
a
Ë> (
b
)) ? (a) : (b));

576 
OPUS_INLINE
 
›us_öt64
 
sûk_max_64
(›us_öt64 
a
, opus_öt64 
b
)

578  (((
a
Ë> (
b
)) ? (a) : (b));

581 
	#sûk_LIMIT
–
a
, 
limô1
, 
limô2
) ((limit1) > (limit2) ? ((a) > (limit1) ? (limit1) : ((a) < (limit2) ? (limit2) : (a))) \

582 : ((
a
Ë> (
limô2
Ë? (limô2Ë: (◊Ë< (
limô1
Ë? (limô1Ë: (a))))

	)

584 
	#sûk_LIMIT_öt
 
sûk_LIMIT


	)

585 
	#sûk_LIMIT_16
 
sûk_LIMIT


	)

586 
	#sûk_LIMIT_32
 
sûk_LIMIT


	)

588 
	#sûk_abs
(
a
Ë((◊Ë> 0Ë? (aË: -◊)Ë

	)

589 
	#sûk_abs_öt
(
a
Ë((◊Ë^ (◊Ë>> (8 * ◊Ë- 1))Ë- (◊Ë>> (8 * ◊Ë- 1)))

	)

590 
	#sûk_abs_öt32
(
a
Ë((◊Ë^ (◊Ë>> 31)Ë- (◊Ë>> 31))

	)

591 
	#sûk_abs_öt64
(
a
Ë((◊Ë> 0Ë? (aË: -◊))

	)

593 
	#sûk_sign
(
a
Ë(◊Ë> 0 ? 1 : ( (aË< 0 ? -1 : 0 ))

	)

599 
	#RAND_MULTIPLIER
 196314165

	)

600 
	#RAND_INCREMENT
 907633515

	)

601 
	#sûk_RAND
(
£ed
Ë(
	`sûk_MLA_ovÊw
((
RAND_INCREMENT
), (£ed), (
RAND_MULTIPLIER
)))

	)

610 
	#sûk_SMMUL
(
a32
, 
b32
Ë(
›us_öt32
)
	`sûk_RSHIFT64
(
	`sûk_SMULL
(◊32), (b32)), 32)

	)

612 #i‡!
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

613 
	#sûk_burg_modifõd
(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
, 
¨ch
) \

614 (()(
¨ch
), 
	`sûk_burg_modifõd_c
(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
,árch))

	)

616 
	#sûk_ö√r_¥od16_Æig√d_64
(
öVec1
, 
öVec2
, 
Àn
, 
¨ch
) \

617 (()(
¨ch
),
	`sûk_ö√r_¥od16_Æig√d_64_c
(
öVec1
, 
öVec2
, 
Àn
))

	)

620 
	~"I∆öes.h
"

621 
	~"Ma¸oCou¡.h
"

622 
	~"Ma¸oDebug.h
"

624 #ifde‡
OPUS_ARM_INLINE_ASM


625 
	~"¨m/SigProc_FIX_¨mv4.h
"

628 #ifde‡
OPUS_ARM_INLINE_EDSP


629 
	~"¨m/SigProc_FIX_¨mv5e.h
"

632 #i‡
deföed
(
MIPSr1_ASM
)

633 
	~"mùs/sig¥oc_fix_mù§1.h
"

637 #ifde‡ 
__˝lu•lus


	@silk/VAD.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

36 #i‡!
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

37 
OPUS_INLINE
 
sûk_VAD_GëNoi£Levñs
(

38 c⁄° 
›us_öt32
 
pX
[ 
VAD_N_BANDS
 ],

39 
sûk_VAD_°©e
 *
psSûk_VAD


46 
›us_öt
 
	$sûk_VAD_Inô
(

47 
sûk_VAD_°©e
 *
psSûk_VAD


50 
›us_öt
 
b
, 
ªt
 = 0;

53 
	`sûk_mem£t
–
psSûk_VAD
, 0, –
sûk_VAD_°©e
 ) );

57  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

58 
psSûk_VAD
->
Noi£LevñBüs
[ 
b
 ] = 
	`sûk_max_32
–
	`sûk_DIV32_16
–
VAD_NOISE_LEVELS_BIAS
, b + 1 ), 1 );

62  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

63 
psSûk_VAD
->
NL
[ 
b
 ] = 
	`sûk_MUL
–100,ÖsSûk_VAD->
Noi£LevñBüs
[ b ] );

64 
psSûk_VAD
->
öv_NL
[ 
b
 ] = 
	`sûk_DIV32
–
sûk_öt32_MAX
,ÖsSûk_VAD->
NL
[ b ] );

66 
psSûk_VAD
->
cou¡î
 = 15;

69  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

70 
psSûk_VAD
->
NrgR©ioSmth_Q8
[ 
b
 ] = 100 * 256;

73 –
ªt
 );

74 
	}
}

77 c⁄° 
›us_öt32
 
	gtûtWeights
[ 
VAD_N_BANDS
 ] = { 30000, 6000, -12000, -12000 };

82 
›us_öt
 
	$sûk_VAD_GëSA_Q8_c
(

83 
sûk_ícodî_°©e
 *
psEncC
,

84 c⁄° 
›us_öt16
 
pIn
[]

87 
›us_öt
 
SA_Q15
, 
pSNR_dB_Q7
, 
öput_tût
;

88 
›us_öt
 
decim©ed_‰amñígth1
, 
decim©ed_‰amñígth2
;

89 
›us_öt
 
decim©ed_‰amñígth
;

90 
›us_öt
 
dec_sub‰ame_Àngth
, 
dec_sub‰ame_off£t
, 
SNR_Q7
, 
i
, 
b
, 
s
;

91 
›us_öt32
 
sumSqu¨ed
, 
smoŸh_c€f_Q16
;

92 
›us_öt16
 
HP°©eTmp
;

93 
	`VARDECL
–
›us_öt16
, 
X
 );

94 
›us_öt32
 
Xƒg
[ 
VAD_N_BANDS
 ];

95 
›us_öt32
 
NrgToNoi£R©io_Q8
[ 
VAD_N_BANDS
 ];

96 
›us_öt32
 
•ìch_ƒg
, 
x_tmp
;

97 
›us_öt
 
X_off£t
[ 
VAD_N_BANDS
 ];

98 
›us_öt
 
ªt
 = 0;

99 
sûk_VAD_°©e
 *
psSûk_VAD
 = &
psEncC
->
sVAD
;

100 
SAVE_STACK
;

103 
	`sûk_as£π
–
VAD_N_BANDS
 == 4 );

104 
	`˚…_as£π
–
MAX_FRAME_LENGTH
 >
psEncC
->
‰ame_Àngth
 );

105 
	`˚…_as£π
–
psEncC
->
‰ame_Àngth
 <= 512 );

106 
	`˚…_as£π
–
psEncC
->
‰ame_Àngth
 =8 * 
	`sûk_RSHIFT
(ÖsEncC->frame_length, 3 ) );

111 
decim©ed_‰amñígth1
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 1 );

112 
decim©ed_‰amñígth2
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 2 );

113 
decim©ed_‰amñígth
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 3 );

123 
X_off£t
[ 0 ] = 0;

124 
X_off£t
[ 1 ] = 
decim©ed_‰amñígth
 + 
decim©ed_‰amñígth2
;

125 
X_off£t
[ 2 ] = X_off£t[ 1 ] + 
decim©ed_‰amñígth
;

126 
X_off£t
[ 3 ] = X_off£t[ 2 ] + 
decim©ed_‰amñígth2
;

127 
	`ALLOC
–
X
, 
X_off£t
[ 3 ] + 
decim©ed_‰amñígth1
, 
›us_öt16
 );

130 
	`sûk_™a_fût_b™k_1
–
pIn
, &
psSûk_VAD
->
A«Sèã
[ 0 ],

131 
X
, &X[ 
X_off£t
[ 3 ] ], 
psEncC
->
‰ame_Àngth
 );

134 
	`sûk_™a_fût_b™k_1
–
X
, &
psSûk_VAD
->
A«Sèã1
[ 0 ],

135 
X
, &X[ 
X_off£t
[ 2 ] ], 
decim©ed_‰amñígth1
 );

138 
	`sûk_™a_fût_b™k_1
–
X
, &
psSûk_VAD
->
A«Sèã2
[ 0 ],

139 
X
, &X[ 
X_off£t
[ 1 ] ], 
decim©ed_‰amñígth2
 );

144 
X
[ 
decim©ed_‰amñígth
 - 1 ] = 
	`sûk_RSHIFT
( X[ decimated_framelength - 1 ], 1 );

145 
HP°©eTmp
 = 
X
[ 
decim©ed_‰amñígth
 - 1 ];

146  
i
 = 
decim©ed_‰amñígth
 - 1; i > 0; i-- ) {

147 
X
[ 
i
 - 1 ] = 
	`sûk_RSHIFT
( X[ i - 1 ], 1 );

148 
X
[ 
i
 ] -= X[ i - 1 ];

150 
X
[ 0 ] -
psSûk_VAD
->
HP°©e
;

151 
psSûk_VAD
->
HP°©e
 = 
HP°©eTmp
;

156  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

158 
decim©ed_‰amñígth
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 
	`sûk_mö_öt
–
VAD_N_BANDS
 - 
b
, VAD_N_BANDS - 1 ) );

161 
dec_sub‰ame_Àngth
 = 
	`sûk_RSHIFT
–
decim©ed_‰amñígth
, 
VAD_INTERNAL_SUBFRAMES_LOG2
 );

162 
dec_sub‰ame_off£t
 = 0;

166 
Xƒg
[ 
b
 ] = 
psSûk_VAD
->
XƒgSub‰
[ b ];

167  
s
 = 0; s < 
VAD_INTERNAL_SUBFRAMES
; s++ ) {

168 
sumSqu¨ed
 = 0;

169  
i
 = 0; i < 
dec_sub‰ame_Àngth
; i++ ) {

172 
x_tmp
 = 
	`sûk_RSHIFT
(

173 
X
[ 
X_off£t
[ 
b
 ] + 
i
 + 
dec_sub‰ame_off£t
 ], 3 );

174 
sumSqu¨ed
 = 
	`sûk_SMLABB
–sumSqu¨ed, 
x_tmp
, x_tmp );

177 
	`sûk_as£π
–
sumSqu¨ed
 >= 0 );

181 if–
s
 < 
VAD_INTERNAL_SUBFRAMES
 - 1 ) {

182 
Xƒg
[ 
b
 ] = 
	`sûk_ADD_POS_SAT32
–Xƒg[ b ], 
sumSqu¨ed
 );

185 
Xƒg
[ 
b
 ] = 
	`sûk_ADD_POS_SAT32
–Xƒg[ b ], 
	`sûk_RSHIFT
–
sumSqu¨ed
, 1 ) );

188 
dec_sub‰ame_off£t
 +
dec_sub‰ame_Àngth
;

190 
psSûk_VAD
->
XƒgSub‰
[ 
b
 ] = 
sumSqu¨ed
;

196 
	`sûk_VAD_GëNoi£Levñs
–&
Xƒg
[ 0 ], 
psSûk_VAD
 );

201 
sumSqu¨ed
 = 0;

202 
öput_tût
 = 0;

203  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

204 
•ìch_ƒg
 = 
Xƒg
[ 
b
 ] - 
psSûk_VAD
->
NL
[ b ];

205 if–
•ìch_ƒg
 > 0 ) {

207 if––
Xƒg
[ 
b
 ] & 0xFF800000 ) == 0 ) {

208 
NrgToNoi£R©io_Q8
[ 
b
 ] = 
	`sûk_DIV32
–
	`sûk_LSHIFT
–
Xƒg
[ b ], 8 ), 
psSûk_VAD
->
NL
[ b ] + 1 );

210 
NrgToNoi£R©io_Q8
[ 
b
 ] = 
	`sûk_DIV32
–
Xƒg
[ b ], 
	`sûk_RSHIFT
–
psSûk_VAD
->
NL
[ b ], 8 ) + 1 );

214 
SNR_Q7
 = 
	`sûk_lö2log
–
NrgToNoi£R©io_Q8
[ 
b
 ] ) - 8 * 128;

217 
sumSqu¨ed
 = 
	`sûk_SMLABB
–sumSqu¨ed, 
SNR_Q7
, SNR_Q7 );

220 if–
•ìch_ƒg
 < ( (
›us_öt32
)1 << 20 ) ) {

222 
SNR_Q7
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
–
	`sûk_SQRT_APPROX
–
•ìch_ƒg
 ), 6 ), SNR_Q7 );

224 
öput_tût
 = 
	`sûk_SMLAWB
–öput_tût, 
tûtWeights
[ 
b
 ], 
SNR_Q7
 );

226 
NrgToNoi£R©io_Q8
[ 
b
 ] = 256;

231 
sumSqu¨ed
 = 
	`sûk_DIV32_16
–sumSqu¨ed, 
VAD_N_BANDS
 );

234 
pSNR_dB_Q7
 = (
›us_öt16
)–3 * 
	`sûk_SQRT_APPROX
–
sumSqu¨ed
 ) );

239 
SA_Q15
 = 
	`sûk_sigm_Q15
–
	`sûk_SMULWB
–
VAD_SNR_FACTOR_Q16
, 
pSNR_dB_Q7
 ) - 
VAD_NEGATIVE_OFFSET_Q5
 );

244 
psEncC
->
öput_tût_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_sigm_Q15
–
öput_tût
 ) - 16384, 1 );

249 
•ìch_ƒg
 = 0;

250  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

252 
•ìch_ƒg
 +–
b
 + 1 ) * 
	`sûk_RSHIFT
–
Xƒg
[ b ] - 
psSûk_VAD
->
NL
[ b ], 4 );

255 if–
psEncC
->
‰ame_Àngth
 =20 *ÖsEncC->
fs_kHz
 ) {

256 
•ìch_ƒg
 = 
	`sûk_RSHIFT32
( speech_nrg, 1 );

259 if–
•ìch_ƒg
 <= 0 ) {

260 
SA_Q15
 = 
	`sûk_RSHIFT
( SA_Q15, 1 );

261 } if–
•ìch_ƒg
 < 16384 ) {

262 
•ìch_ƒg
 = 
	`sûk_LSHIFT32
( speech_nrg, 16 );

265 
•ìch_ƒg
 = 
	`sûk_SQRT_APPROX
( speech_nrg );

266 
SA_Q15
 = 
	`sûk_SMULWB
–32768 + 
•ìch_ƒg
, SA_Q15 );

270 
psEncC
->
•ìch_a˘ivôy_Q8
 = 
	`sûk_mö_öt
–
	`sûk_RSHIFT
–
SA_Q15
, 7 ), 
sûk_uöt8_MAX
 );

276 
smoŸh_c€f_Q16
 = 
	`sûk_SMULWB
–
VAD_SNR_SMOOTH_COEF_Q18
, sûk_SMULWB–(
›us_öt32
)
SA_Q15
, SA_Q15 ) );

278 if–
psEncC
->
‰ame_Àngth
 =10 *ÖsEncC->
fs_kHz
 ) {

279 
smoŸh_c€f_Q16
 >>= 1;

282  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

284 
psSûk_VAD
->
NrgR©ioSmth_Q8
[ 
b
 ] = 
	`sûk_SMLAWB
(ÖsSilk_VAD->NrgRatioSmth_Q8[ b ],

285 
NrgToNoi£R©io_Q8
[ 
b
 ] - 
psSûk_VAD
->
NrgR©ioSmth_Q8
[ b ], 
smoŸh_c€f_Q16
 );

288 
SNR_Q7
 = 3 * ( 
	`sûk_lö2log
–
psSûk_VAD
->
NrgR©ioSmth_Q8
[
b
] ) - 8 * 128 );

290 
psEncC
->
öput_quÆôy_b™ds_Q15
[ 
b
 ] = 
	`sûk_sigm_Q15
–
	`sûk_RSHIFT
–
SNR_Q7
 - 16 * 128, 4 ) );

293 
RESTORE_STACK
;

294 –
ªt
 );

295 
	}
}

300 #i‡ !
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

301 
	gOPUS_INLINE


303 
	$sûk_VAD_GëNoi£Levñs
(

304 c⁄° 
›us_öt32
 
pX
[ 
VAD_N_BANDS
 ],

305 
sûk_VAD_°©e
 *
psSûk_VAD


308 
›us_öt
 
k
;

309 
›us_öt32
 
∆
, 
ƒg
, 
öv_ƒg
;

310 
›us_öt
 
c€f
, 
mö_c€f
;

313 if–
psSûk_VAD
->
cou¡î
 < 1000 ) {

314 
mö_c€f
 = 
	`sûk_DIV32_16
–
sûk_öt16_MAX
, 
	`sûk_RSHIFT
–
psSûk_VAD
->
cou¡î
, 4 ) + 1 );

316 
psSûk_VAD
->
cou¡î
++;

318 
mö_c€f
 = 0;

321  
k
 = 0; k < 
VAD_N_BANDS
; k++ ) {

323 
∆
 = 
psSûk_VAD
->
NL
[ 
k
 ];

324 
	`sûk_as£π
–
∆
 >= 0 );

327 
ƒg
 = 
	`sûk_ADD_POS_SAT32
–
pX
[ 
k
 ], 
psSûk_VAD
->
Noi£LevñBüs
[ k ] );

328 
	`sûk_as£π
–
ƒg
 > 0 );

331 
öv_ƒg
 = 
	`sûk_DIV32
–
sûk_öt32_MAX
, 
ƒg
 );

332 
	`sûk_as£π
–
öv_ƒg
 >= 0 );

335 if–
ƒg
 > 
	`sûk_LSHIFT
–
∆
, 3 ) ) {

336 
c€f
 = 
VAD_NOISE_LEVEL_SMOOTH_COEF_Q16
 >> 3;

337 } if–
ƒg
 < 
∆
 ) {

338 
c€f
 = 
VAD_NOISE_LEVEL_SMOOTH_COEF_Q16
;

340 
c€f
 = 
	`sûk_SMULWB
–
	`sûk_SMULWW
–
öv_ƒg
, 
∆
 ), 
VAD_NOISE_LEVEL_SMOOTH_COEF_Q16
 << 1 );

344 
c€f
 = 
	`sûk_max_öt
–c€f, 
mö_c€f
 );

347 
psSûk_VAD
->
öv_NL
[ 
k
 ] = 
	`sûk_SMLAWB
–psSûk_VAD->öv_NL[ k ], 
öv_ƒg
 -ÖsSûk_VAD->öv_NL[ k ], 
c€f
 );

348 
	`sûk_as£π
–
psSûk_VAD
->
öv_NL
[ 
k
 ] >= 0 );

351 
∆
 = 
	`sûk_DIV32
–
sûk_öt32_MAX
, 
psSûk_VAD
->
öv_NL
[ 
k
 ] );

352 
	`sûk_as£π
–
∆
 >= 0 );

355 
∆
 = 
	`sûk_mö
(Çl, 0x00FFFFFF );

358 
psSûk_VAD
->
NL
[ 
k
 ] = 
∆
;

360 
	}
}

	@silk/VQ_WMat_EC.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_VQ_WM©_EC_c
(

36 
›us_öt8
 *
öd
,

37 
›us_öt32
 *
ªs_ƒg_Q15
,

38 
›us_öt32
 *
øã_di°_Q8
,

39 
›us_öt
 *
gaö_Q7
,

40 c⁄° 
›us_öt32
 *
XX_Q17
,

41 c⁄° 
›us_öt32
 *
xX_Q17
,

42 c⁄° 
›us_öt8
 *
cb_Q7
,

43 c⁄° 
›us_uöt8
 *
cb_gaö_Q7
,

44 c⁄° 
›us_uöt8
 *
˛_Q5
,

45 c⁄° 
›us_öt
 
sub‰_Àn
,

46 c⁄° 
›us_öt32
 
max_gaö_Q7
,

47 c⁄° 
›us_öt
 
L


50 
›us_öt
 
k
, 
gaö_tmp_Q7
;

51 c⁄° 
›us_öt8
 *
cb_row_Q7
;

52 
›us_öt32
 
√g_xX_Q24
[ 5 ];

53 
›us_öt32
 
sum1_Q15
, 
sum2_Q24
;

54 
›us_öt32
 
bôs_ªs_Q8
, 
bôs_tŸ_Q8
;

57 
√g_xX_Q24
[ 0 ] = -
	`sûk_LSHIFT32
–
xX_Q17
[ 0 ], 7 );

58 
√g_xX_Q24
[ 1 ] = -
	`sûk_LSHIFT32
–
xX_Q17
[ 1 ], 7 );

59 
√g_xX_Q24
[ 2 ] = -
	`sûk_LSHIFT32
–
xX_Q17
[ 2 ], 7 );

60 
√g_xX_Q24
[ 3 ] = -
	`sûk_LSHIFT32
–
xX_Q17
[ 3 ], 7 );

61 
√g_xX_Q24
[ 4 ] = -
	`sûk_LSHIFT32
–
xX_Q17
[ 4 ], 7 );

64 *
øã_di°_Q8
 = 
sûk_öt32_MAX
;

65 *
ªs_ƒg_Q15
 = 
sûk_öt32_MAX
;

66 
cb_row_Q7
 = 
cb_Q7
;

68 *
öd
 = 0;

69  
k
 = 0; k < 
L
; k++ ) {

70 
›us_öt32
 
≥«…y
;

71 
gaö_tmp_Q7
 = 
cb_gaö_Q7
[
k
];

74 
sum1_Q15
 = 
	`SILK_FIX_CONST
( 1.001, 15 );

77 
≥«…y
 = 
	`sûk_LSHIFT32
–
	`sûk_max
–
	`sûk_SUB32
–
gaö_tmp_Q7
, 
max_gaö_Q7
 ), 0 ), 11 );

80 
sum2_Q24
 = 
	`sûk_MLA
–
√g_xX_Q24
[ 0 ], 
XX_Q17
[ 1 ], 
cb_row_Q7
[ 1 ] );

81 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 2 ], 
cb_row_Q7
[ 2 ] );

82 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 3 ], 
cb_row_Q7
[ 3 ] );

83 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 4 ], 
cb_row_Q7
[ 4 ] );

84 
sum2_Q24
 = 
	`sûk_LSHIFT32
( sum2_Q24, 1 );

85 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 0 ], 
cb_row_Q7
[ 0 ] );

86 
sum1_Q15
 = 
	`sûk_SMLAWB
–sum1_Q15, 
sum2_Q24
, 
cb_row_Q7
[ 0 ] );

89 
sum2_Q24
 = 
	`sûk_MLA
–
√g_xX_Q24
[ 1 ], 
XX_Q17
[ 7 ], 
cb_row_Q7
[ 2 ] );

90 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 8 ], 
cb_row_Q7
[ 3 ] );

91 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 9 ], 
cb_row_Q7
[ 4 ] );

92 
sum2_Q24
 = 
	`sûk_LSHIFT32
( sum2_Q24, 1 );

93 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 6 ], 
cb_row_Q7
[ 1 ] );

94 
sum1_Q15
 = 
	`sûk_SMLAWB
–sum1_Q15, 
sum2_Q24
, 
cb_row_Q7
[ 1 ] );

97 
sum2_Q24
 = 
	`sûk_MLA
–
√g_xX_Q24
[ 2 ], 
XX_Q17
[ 13 ], 
cb_row_Q7
[ 3 ] );

98 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 14 ], 
cb_row_Q7
[ 4 ] );

99 
sum2_Q24
 = 
	`sûk_LSHIFT32
( sum2_Q24, 1 );

100 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 12 ], 
cb_row_Q7
[ 2 ] );

101 
sum1_Q15
 = 
	`sûk_SMLAWB
–sum1_Q15, 
sum2_Q24
, 
cb_row_Q7
[ 2 ] );

104 
sum2_Q24
 = 
	`sûk_MLA
–
√g_xX_Q24
[ 3 ], 
XX_Q17
[ 19 ], 
cb_row_Q7
[ 4 ] );

105 
sum2_Q24
 = 
	`sûk_LSHIFT32
( sum2_Q24, 1 );

106 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 18 ], 
cb_row_Q7
[ 3 ] );

107 
sum1_Q15
 = 
	`sûk_SMLAWB
–sum1_Q15, 
sum2_Q24
, 
cb_row_Q7
[ 3 ] );

110 
sum2_Q24
 = 
	`sûk_LSHIFT32
–
√g_xX_Q24
[ 4 ], 1 );

111 
sum2_Q24
 = 
	`sûk_MLA
–sum2_Q24, 
XX_Q17
[ 24 ], 
cb_row_Q7
[ 4 ] );

112 
sum1_Q15
 = 
	`sûk_SMLAWB
–sum1_Q15, 
sum2_Q24
, 
cb_row_Q7
[ 4 ] );

115 if–
sum1_Q15
 >= 0 ) {

117 
bôs_ªs_Q8
 = 
	`sûk_SMULBB
–
sub‰_Àn
, 
	`sûk_lö2log
–
sum1_Q15
 + 
≥«…y
) - (15 << 7) );

119 
bôs_tŸ_Q8
 = 
	`sûk_ADD_LSHIFT32
–
bôs_ªs_Q8
, 
˛_Q5
[ 
k
 ], 3-1 );

120 if–
bôs_tŸ_Q8
 <*
øã_di°_Q8
 ) {

121 *
øã_di°_Q8
 = 
bôs_tŸ_Q8
;

122 *
ªs_ƒg_Q15
 = 
sum1_Q15
 + 
≥«…y
;

123 *
öd
 = (
›us_öt8
)
k
;

124 *
gaö_Q7
 = 
gaö_tmp_Q7
;

129 
cb_row_Q7
 +
LTP_ORDER
;

131 
	}
}

	@silk/ana_filt_bank_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
›us_öt16
 
	gA_fb1_20
 = 5394 << 1;

36 
›us_öt16
 
	gA_fb1_21
 = -24290;

39 
	$sûk_™a_fût_b™k_1
(

40 c⁄° 
›us_öt16
 *
ö
,

41 
›us_öt32
 *
S
,

42 
›us_öt16
 *
outL
,

43 
›us_öt16
 *
outH
,

44 c⁄° 
›us_öt32
 
N


47 
›us_öt
 
k
, 
N2
 = 
	`sûk_RSHIFT
–
N
, 1 );

48 
›us_öt32
 
ö32
, 
X
, 
Y
, 
out_1
, 
out_2
;

51  
k
 = 0; k < 
N2
; k++ ) {

53 
ö32
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
ö
[ 2 * 
k
 ], 10 );

56 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 0 ] );

57 
X
 = 
	`sûk_SMLAWB
–
Y
, Y, 
A_fb1_21
 );

58 
out_1
 = 
	`sûk_ADD32
–
S
[ 0 ], 
X
 );

59 
S
[ 0 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

62 
ö32
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
ö
[ 2 * 
k
 + 1 ], 10 );

65 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 1 ] );

66 
X
 = 
	`sûk_SMULWB
–
Y
, 
A_fb1_20
 );

67 
out_2
 = 
	`sûk_ADD32
–
S
[ 1 ], 
X
 );

68 
S
[ 1 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

71 
outL
[ 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_ADD32
–
out_2
, 
out_1
 ), 11 ) );

72 
outH
[ 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SUB32
–
out_2
, 
out_1
 ), 11 ) );

74 
	}
}

	@silk/arm/LPC_inv_pred_gain_arm.h

28 #i‚de‡
SILK_LPC_INV_PRED_GAIN_ARM_H


29 
	#SILK_LPC_INV_PRED_GAIN_ARM_H


	)

31 
	~"˚…/¨m/¨m˝u.h
"

33 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

34 
›us_öt32
 
sûk_LPC_övî£_¥ed_gaö_√⁄
(

35 c⁄° 
›us_öt16
 *
A_Q12
,

36 c⁄° 
›us_öt
 
‹dî


39 #i‡!
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_PRESUME_NEON
)

40 
	#OVERRIDE_sûk_LPC_övî£_¥ed_gaö
 (1)

	)

41 
	#sûk_LPC_övî£_¥ed_gaö
(
A_Q12
, 
‹dî
, 
¨ch
Ë(()◊rch), 
	`PRESUME_NEON
(
sûk_LPC_övî£_¥ed_gaö
)(A_Q12, ordî))

	)

45 #i‡!
deföed
(
OVERRIDE_sûk_LPC_övî£_¥ed_gaö
)

47 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
))

48 
›us_öt32
 (*c⁄° 
SILK_LPC_INVERSE_PRED_GAIN_IMPL
[
OPUS_ARCHMASK
+1])(c⁄° 
›us_öt16
 *
A_Q12
, c⁄° 
›us_öt
 
‹dî
);

49 
	#OVERRIDE_sûk_LPC_övî£_¥ed_gaö
 (1)

	)

50 
	#sûk_LPC_övî£_¥ed_gaö
(
A_Q12
, 
‹dî
, 
¨ch
Ë((*
SILK_LPC_INVERSE_PRED_GAIN_IMPL
[◊rch)&
OPUS_ARCHMASK
])(A_Q12, ordî))

	)

51 #ñi‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

52 
	#OVERRIDE_sûk_LPC_övî£_¥ed_gaö
 (1)

	)

53 
	#sûk_LPC_övî£_¥ed_gaö
(
A_Q12
, 
‹dî
, 
¨ch
Ë(()◊rch), 
	`sûk_LPC_övî£_¥ed_gaö_√⁄
(A_Q12, ordî))

	)

	@silk/arm/LPC_inv_pred_gain_neon_intr.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<¨m_√⁄.h
>

33 
	~"SigProc_FIX.h
"

34 
	~"deföe.h
"

36 
	#QA
 24

	)

37 
	#A_LIMIT
 
	`SILK_FIX_CONST
–0.99975, 
QA
 )

	)

39 
	#MUL32_FRAC_Q
(
a32
, 
b32
, 
Q
Ë((
›us_öt32
)(
	`sûk_RSHIFT_ROUND64
(
	`sûk_SMULL
◊32, b32), Q)))

	)

55 
OPUS_INLINE
 
›us_öt32
 
	$LPC_övî£_¥ed_gaö_QA_√⁄
(

56 
›us_öt32
 
A_QA
[ 
SILK_MAX_ORDER_LPC
 ],

57 c⁄° 
›us_öt
 
‹dî


60 
›us_öt
 
k
, 
n
, 
mu…2Q
;

61 
›us_öt32
 
övGaö_Q30
, 
rc_Q31
, 
rc_mu…1_Q30
, 
rc_mu…2
, 
tmp1
, 
tmp2
;

62 
›us_öt32
 
max
, 
mö
;

63 
öt32x4_t
 
max_s32x4
, 
mö_s32x4
;

64 
öt32x2_t
 
max_s32x2
, 
mö_s32x2
;

66 
max_s32x4
 = 
	`vdupq_n_s32
–
sûk_öt32_MIN
 );

67 
mö_s32x4
 = 
	`vdupq_n_s32
–
sûk_öt32_MAX
 );

68 
övGaö_Q30
 = 
	`SILK_FIX_CONST
( 1, 30 );

69  
k
 = 
‹dî
 - 1; k > 0; k-- ) {

70 
öt32x2_t
 
rc_Q31_s32x2
, 
rc_mu…2_s32x2
;

71 
öt64x2_t
 
mu…2Q_s64x2
;

74 if––
A_QA
[ 
k
 ] > 
A_LIMIT
 ) || ( A_QA[ k ] < -A_LIMIT ) ) {

79 
rc_Q31
 = -
	`sûk_LSHIFT
–
A_QA
[ 
k
 ], 31 - 
QA
 );

82 
rc_mu…1_Q30
 = 
	`sûk_SUB32
–
	`SILK_FIX_CONST
–1, 30 ), 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 ) );

83 
	`sûk_as£π
–
rc_mu…1_Q30
 > ( 1 << 15 ) );

84 
	`sûk_as£π
–
rc_mu…1_Q30
 <= ( 1 << 30 ) );

88 
övGaö_Q30
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–övGaö_Q30, 
rc_mu…1_Q30
 ), 2 );

89 
	`sûk_as£π
–
övGaö_Q30
 >= 0 );

90 
	`sûk_as£π
–
övGaö_Q30
 <= ( 1 << 30 ) );

91 if–
övGaö_Q30
 < 
	`SILK_FIX_CONST
–1.0‡/ 
MAX_PREDICTION_POWER_GAIN
, 30 ) ) {

96 
mu…2Q
 = 32 - 
	`sûk_CLZ32
–
	`sûk_abs
–
rc_mu…1_Q30
 ) );

97 
rc_mu…2
 = 
	`sûk_INVERSE32_v¨Q
–
rc_mu…1_Q30
, 
mu…2Q
 + 30 );

100 
rc_Q31_s32x2
 = 
	`vdup_n_s32
–
rc_Q31
 );

101 
mu…2Q_s64x2
 = 
	`vdupq_n_s64
–-
mu…2Q
 );

102 
rc_mu…2_s32x2
 = 
	`vdup_n_s32
–
rc_mu…2
 );

104  
n
 = 0;Ç < ( ( 
k
 + 1 ) >> 1 ) - 3;Ç += 4 ) {

106 
öt32x4_t
 
tmp1_s32x4
, 
tmp2_s32x4
, 
t0_s32x4
, 
t1_s32x4
, 
s0_s32x4
, 
s1_s32x4
, 
t_QA0_s32x4
, 
t_QA1_s32x4
;

107 
öt64x2_t
 
t0_s64x2
, 
t1_s64x2
, 
t2_s64x2
, 
t3_s64x2
;

108 
tmp1_s32x4
 = 
	`vld1q_s32
–
A_QA
 + 
n
 );

109 
tmp2_s32x4
 = 
	`vld1q_s32
–
A_QA
 + 
k
 - 
n
 - 4 );

110 
tmp2_s32x4
 = 
	`vªv64q_s32
(Åmp2_s32x4 );

111 
tmp2_s32x4
 = 
	`vcomböe_s32
–
	`vgë_high_s32
–tmp2_s32x4 ), 
	`vgë_low_s32
(Åmp2_s32x4 ) );

112 
t0_s32x4
 = 
	`vqrdmulhq_œ√_s32
–
tmp2_s32x4
, 
rc_Q31_s32x2
, 0 );

113 
t1_s32x4
 = 
	`vqrdmulhq_œ√_s32
–
tmp1_s32x4
, 
rc_Q31_s32x2
, 0 );

114 
t_QA0_s32x4
 = 
	`vqsubq_s32
–
tmp1_s32x4
, 
t0_s32x4
 );

115 
t_QA1_s32x4
 = 
	`vqsubq_s32
–
tmp2_s32x4
, 
t1_s32x4
 );

116 
t0_s64x2
 = 
	`vmuŒ_s32
–
	`vgë_low_s32
 ( 
t_QA0_s32x4
 ), 
rc_mu…2_s32x2
 );

117 
t1_s64x2
 = 
	`vmuŒ_s32
–
	`vgë_high_s32
–
t_QA0_s32x4
 ), 
rc_mu…2_s32x2
 );

118 
t2_s64x2
 = 
	`vmuŒ_s32
–
	`vgë_low_s32
 ( 
t_QA1_s32x4
 ), 
rc_mu…2_s32x2
 );

119 
t3_s64x2
 = 
	`vmuŒ_s32
–
	`vgë_high_s32
–
t_QA1_s32x4
 ), 
rc_mu…2_s32x2
 );

120 
t0_s64x2
 = 
	`vrshlq_s64
–t0_s64x2, 
mu…2Q_s64x2
 );

121 
t1_s64x2
 = 
	`vrshlq_s64
–t1_s64x2, 
mu…2Q_s64x2
 );

122 
t2_s64x2
 = 
	`vrshlq_s64
–t2_s64x2, 
mu…2Q_s64x2
 );

123 
t3_s64x2
 = 
	`vrshlq_s64
–t3_s64x2, 
mu…2Q_s64x2
 );

124 
t0_s32x4
 = 
	`vcomböe_s32
–
	`vmovn_s64
–
t0_s64x2
 ), vmovn_s64–
t1_s64x2
 ) );

125 
t1_s32x4
 = 
	`vcomböe_s32
–
	`vmovn_s64
–
t2_s64x2
 ), vmovn_s64–
t3_s64x2
 ) );

126 
s0_s32x4
 = 
	`vcomböe_s32
–
	`vsh∫_n_s64
–
t0_s64x2
, 31 ), vsh∫_n_s64–
t1_s64x2
, 31 ) );

127 
s1_s32x4
 = 
	`vcomböe_s32
–
	`vsh∫_n_s64
–
t2_s64x2
, 31 ), vsh∫_n_s64–
t3_s64x2
, 31 ) );

128 
max_s32x4
 = 
	`vmaxq_s32
–max_s32x4, 
s0_s32x4
 );

129 
mö_s32x4
 = 
	`vmöq_s32
–mö_s32x4, 
s0_s32x4
 );

130 
max_s32x4
 = 
	`vmaxq_s32
–max_s32x4, 
s1_s32x4
 );

131 
mö_s32x4
 = 
	`vmöq_s32
–mö_s32x4, 
s1_s32x4
 );

132 
t1_s32x4
 = 
	`vªv64q_s32
(Å1_s32x4 );

133 
t1_s32x4
 = 
	`vcomböe_s32
–
	`vgë_high_s32
–t1_s32x4 ), 
	`vgë_low_s32
(Å1_s32x4 ) );

134 
	`v°1q_s32
–
A_QA
 + 
n
, 
t0_s32x4
 );

135 
	`v°1q_s32
–
A_QA
 + 
k
 - 
n
 - 4, 
t1_s32x4
 );

137  ; 
n
 < (
k
 + 1) >> 1;Ç++ ) {

138 
›us_öt64
 
tmp64
;

139 
tmp1
 = 
A_QA
[ 
n
 ];

140 
tmp2
 = 
A_QA
[ 
k
 - 
n
 - 1 ];

141 
tmp64
 = 
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
	`sûk_SUB_SAT32
(
tmp1
,

142 
	`MUL32_FRAC_Q
–
tmp2
, 
rc_Q31
, 31 ) ), 
rc_mu…2
 ), 
mu…2Q
);

143 if–
tmp64
 > 
sûk_öt32_MAX
 ||Åmp64 < 
sûk_öt32_MIN
 ) {

146 
A_QA
[ 
n
 ] = ( 
›us_öt32
 )
tmp64
;

147 
tmp64
 = 
	`sûk_RSHIFT_ROUND64
–
	`sûk_SMULL
–
	`sûk_SUB_SAT32
(
tmp2
,

148 
	`MUL32_FRAC_Q
–
tmp1
, 
rc_Q31
, 31 ) ), 
rc_mu…2
), 
mu…2Q
);

149 if–
tmp64
 > 
sûk_öt32_MAX
 ||Åmp64 < 
sûk_öt32_MIN
 ) {

152 
A_QA
[ 
k
 - 
n
 - 1 ] = ( 
›us_öt32
 )
tmp64
;

157 if––
A_QA
[ 
k
 ] > 
A_LIMIT
 ) || ( A_QA[ k ] < -A_LIMIT ) ) {

161 
max_s32x2
 = 
	`vmax_s32
–
	`vgë_low_s32
–
max_s32x4
 ), 
	`vgë_high_s32
( max_s32x4 ) );

162 
mö_s32x2
 = 
	`vmö_s32
–
	`vgë_low_s32
–
mö_s32x4
 ), 
	`vgë_high_s32
( min_s32x4 ) );

163 
max_s32x2
 = 
	`vmax_s32
–max_s32x2, 
	`vªöãΩªt_s32_s64
–
	`vshr_n_s64
–
	`vªöãΩªt_s64_s32
( max_s32x2 ), 32 ) ) );

164 
mö_s32x2
 = 
	`vmö_s32
–mö_s32x2, 
	`vªöãΩªt_s32_s64
–
	`vshr_n_s64
–
	`vªöãΩªt_s64_s32
( min_s32x2 ), 32 ) ) );

165 
max
 = 
	`vgë_œ√_s32
–
max_s32x2
, 0 );

166 
mö
 = 
	`vgë_œ√_s32
–
mö_s32x2
, 0 );

167 if––
max
 > 0 ) || ( 
mö
 < -1 ) ) {

172 
rc_Q31
 = -
	`sûk_LSHIFT
–
A_QA
[ 0 ], 31 - 
QA
 );

175 
rc_mu…1_Q30
 = 
	`sûk_SUB32
–
	`SILK_FIX_CONST
–1, 30 ), 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 ) );

179 
övGaö_Q30
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–övGaö_Q30, 
rc_mu…1_Q30
 ), 2 );

180 
	`sûk_as£π
–
övGaö_Q30
 >= 0 );

181 
	`sûk_as£π
–
övGaö_Q30
 <= ( 1 << 30 ) );

182 if–
övGaö_Q30
 < 
	`SILK_FIX_CONST
–1.0‡/ 
MAX_PREDICTION_POWER_GAIN
, 30 ) ) {

186  
övGaö_Q30
;

187 
	}
}

190 
›us_öt32
 
	$sûk_LPC_övî£_¥ed_gaö_√⁄
(

191 c⁄° 
›us_öt16
 *
A_Q12
,

192 c⁄° 
›us_öt
 
‹dî


195 #ifde‡
OPUS_CHECK_ASM


196 c⁄° 
›us_öt32
 
övGaö_Q30_c
 = 
	`sûk_LPC_övî£_¥ed_gaö_c
–
A_Q12
, 
‹dî
 );

199 
›us_öt32
 
övGaö_Q30
;

200 if––
SILK_MAX_ORDER_LPC
 !24 ) || ( 
‹dî
 & 1 )) {

201 
övGaö_Q30
 = 
	`sûk_LPC_övî£_¥ed_gaö_c
–
A_Q12
, 
‹dî
 );

204 
›us_öt32
 
Atmp_QA
[ 
SILK_MAX_ORDER_LPC
 ];

205 
›us_öt32
 
DC_ª•
;

206 
öt16x8_t
 
t0_s16x8
, 
t1_s16x8
, 
t2_s16x8
;

207 
öt32x4_t
 
t0_s32x4
;

208 c⁄° 
›us_öt
 
À·ovî
 = 
‹dî
 & 7;

211 
t0_s16x8
 = 
	`vld1q_s16
–
A_Q12
 + 0 );

212 
t1_s16x8
 = 
	`vld1q_s16
–
A_Q12
 + 8 );

213 
t2_s16x8
 = 
	`vld1q_s16
–
A_Q12
 + 16 );

214 
t0_s32x4
 = 
	`v∑ddlq_s16
–
t0_s16x8
 );

216  
‹dî
 - 
À·ovî
 )

219 
t0_s32x4
 = 
	`v∑dÆq_s16
–t0_s32x4, 
t2_s16x8
 );

223 
t0_s32x4
 = 
	`v∑dÆq_s16
–t0_s32x4, 
t1_s16x8
 );

224 
	`v°1q_s32
–
Atmp_QA
 + 16, 
	`vshŒ_n_s16
–
	`vgë_low_s16
 ( 
t2_s16x8
 ), 
QA
 - 12 ) );

225 
	`v°1q_s32
–
Atmp_QA
 + 20, 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t2_s16x8
 ), 
QA
 - 12 ) );

230 c⁄° 
öt32x2_t
 
t_s32x2
 = 
	`v∑dd_s32
–
	`vgë_low_s32
–
t0_s32x4
 ), 
	`vgë_high_s32
(Å0_s32x4 ) );

231 c⁄° 
öt64x1_t
 
t_s64x1
 = 
	`v∑ddl_s32
–
t_s32x2
 );

232 
DC_ª•
 = 
	`vgë_œ√_s32
–
	`vªöãΩªt_s32_s64
–
t_s64x1
 ), 0 );

233 
	`v°1q_s32
–
Atmp_QA
 + 8, 
	`vshŒ_n_s16
–
	`vgë_low_s16
 ( 
t1_s16x8
 ), 
QA
 - 12 ) );

234 
	`v°1q_s32
–
Atmp_QA
 + 12, 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t1_s16x8
 ), 
QA
 - 12 ) );

239 
DC_ª•
 = 0;

242 
A_Q12
 +
‹dî
 - 
À·ovî
;

244  
À·ovî
 )

247 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 5 ];

248 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 4 ];

252 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 3 ];

253 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 2 ];

257 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 1 ];

258 
DC_ª•
 +(
›us_öt32
)
A_Q12
[ 0 ];

266 if–
DC_ª•
 >= 4096 ) {

267 
övGaö_Q30
 = 0;

269 
	`v°1q_s32
–
Atmp_QA
 + 0, 
	`vshŒ_n_s16
–
	`vgë_low_s16
 ( 
t0_s16x8
 ), 
QA
 - 12 ) );

270 
	`v°1q_s32
–
Atmp_QA
 + 4, 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t0_s16x8
 ), 
QA
 - 12 ) );

271 
övGaö_Q30
 = 
	`LPC_övî£_¥ed_gaö_QA_√⁄
–
Atmp_QA
, 
‹dî
 );

275 #ifde‡
OPUS_CHECK_ASM


276 
	`sûk_as£π
–
övGaö_Q30_c
 =
övGaö_Q30
 );

279  
övGaö_Q30
;

280 
	}
}

	@silk/arm/NSQ_del_dec_arm.h

28 #i‚de‡
SILK_NSQ_DEL_DEC_ARM_H


29 
	#SILK_NSQ_DEL_DEC_ARM_H


	)

31 
	~"˚…/¨m/¨m˝u.h
"

33 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

34 
sûk_NSQ_dñ_dec_√⁄
(

35 c⁄° 
sûk_ícodî_°©e
 *
psEncC
, 
sûk_nsq_°©e
 *
NSQ
,

36 
SideInfoIndi˚s
 *
psIndi˚s
, c⁄° 
›us_öt16
 
x16
[], 
›us_öt8
 
pul£s
[],

37 c⁄° 
›us_öt16
 
PªdC€f_Q12
[2 * 
MAX_LPC_ORDER
],

38 c⁄° 
›us_öt16
 
LTPC€f_Q14
[
LTP_ORDER
 * 
MAX_NB_SUBFR
],

39 c⁄° 
›us_öt16
 
AR_Q13
[
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
],

40 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[
MAX_NB_SUBFR
],

41 c⁄° 
›us_öt
 
Tût_Q14
[
MAX_NB_SUBFR
],

42 c⁄° 
›us_öt32
 
LF_shp_Q14
[
MAX_NB_SUBFR
],

43 c⁄° 
›us_öt32
 
Gaös_Q16
[
MAX_NB_SUBFR
],

44 c⁄° 
›us_öt
 
pôchL
[
MAX_NB_SUBFR
], c⁄° opus_öà
Lambda_Q10
,

45 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
);

47 #i‡!
deföed
(
OPUS_HAVE_RTCD
)

48 
	#OVERRIDE_sûk_NSQ_dñ_dec
 (1)

	)

49 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, \

50 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, \

51 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, \

52 
LTP_sˇÀ_Q14
, 
¨ch
) \

53 (()(
¨ch
), \

54 
	`PRESUME_NEON
(
sûk_NSQ_dñ_dec
)( \

55 
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, \

56 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, \

57 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

61 #i‡!
deföed
(
OVERRIDE_sûk_NSQ_dñ_dec
)

63 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
) && \

64 !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
))

65 (*c⁄° 
SILK_NSQ_DEL_DEC_IMPL
[
OPUS_ARCHMASK
 + 1])(

66 c⁄° 
sûk_ícodî_°©e
 *
psEncC
, 
sûk_nsq_°©e
 *
NSQ
,

67 
SideInfoIndi˚s
 *
psIndi˚s
, c⁄° 
›us_öt16
 
x16
[], 
›us_öt8
 
pul£s
[],

68 c⁄° 
›us_öt16
 
PªdC€f_Q12
[2 * 
MAX_LPC_ORDER
],

69 c⁄° 
›us_öt16
 
LTPC€f_Q14
[
LTP_ORDER
 * 
MAX_NB_SUBFR
],

70 c⁄° 
›us_öt16
 
AR_Q13
[
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
],

71 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[
MAX_NB_SUBFR
],

72 c⁄° 
›us_öt
 
Tût_Q14
[
MAX_NB_SUBFR
],

73 c⁄° 
›us_öt32
 
LF_shp_Q14
[
MAX_NB_SUBFR
],

74 c⁄° 
›us_öt32
 
Gaös_Q16
[
MAX_NB_SUBFR
],

75 c⁄° 
›us_öt
 
pôchL
[
MAX_NB_SUBFR
], c⁄° opus_öà
Lambda_Q10
,

76 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
);

77 
	#OVERRIDE_sûk_NSQ_dñ_dec
 (1)

	)

78 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, \

79 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, \

80 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, \

81 
LTP_sˇÀ_Q14
, 
¨ch
) \

82 ((*
SILK_NSQ_DEL_DEC_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])( \

83 
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, \

84 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, \

85 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

86 #ñi‡
	`deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

87 
	#OVERRIDE_sûk_NSQ_dñ_dec
 (1)

	)

88 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, \

89 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, \

90 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, \

91 
LTP_sˇÀ_Q14
, 
¨ch
) \

92 (()(
¨ch
), \

93 
	`sûk_NSQ_dñ_dec_√⁄
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, \

94 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, \

95 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, \

96 
LTP_sˇÀ_Q14
))

	)

	@silk/arm/NSQ_del_dec_neon_intr.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<¨m_√⁄.h
>

33 #ifde‡
OPUS_CHECK_ASM


34 
	~<°rög.h
>

36 
	~"maö.h
"

37 
	~"°ack_Æloc.h
"

41 
	#NEON_MAX_DEL_DEC_STATES
 4

	)

44 
›us_öt32
 
	msLPC_Q14
[ 
MAX_SUB_FRAME_LENGTH
 + 
NSQ_LPC_BUF_LENGTH
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

45 
›us_öt32
 
	mR™dSèã
[ 
DECISION_DELAY
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

46 
›us_öt32
 
	mQ_Q10
[ 
DECISION_DELAY
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

47 
›us_öt32
 
	mXq_Q14
[ 
DECISION_DELAY
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

48 
›us_öt32
 
	mPªd_Q15
[ 
DECISION_DELAY
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

49 
›us_öt32
 
	mSh≠e_Q14
[ 
DECISION_DELAY
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

50 
›us_öt32
 
	msAR2_Q14
[ 
MAX_SHAPE_LPC_ORDER
 ][ 
NEON_MAX_DEL_DEC_STATES
 ];

51 
›us_öt32
 
	mLF_AR_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

52 
›us_öt32
 
	mDiff_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

53 
›us_öt32
 
	mSìd
[ 
NEON_MAX_DEL_DEC_STATES
 ];

54 
›us_öt32
 
	mSìdInô
[ 
NEON_MAX_DEL_DEC_STATES
 ];

55 
›us_öt32
 
	mRD_Q10
[ 
NEON_MAX_DEL_DEC_STATES
 ];

56 } 
	tNSQ_dñ_decs_°ru˘
;

59 
›us_öt32
 
	mQ_Q10
[ 
NEON_MAX_DEL_DEC_STATES
 ];

60 
›us_öt32
 
	mRD_Q10
[ 
NEON_MAX_DEL_DEC_STATES
 ];

61 
›us_öt32
 
	mxq_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

62 
›us_öt32
 
	mLF_AR_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

63 
›us_öt32
 
	mDiff_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

64 
›us_öt32
 
	msLTP_shp_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

65 
›us_öt32
 
	mLPC_exc_Q14
[ 
NEON_MAX_DEL_DEC_STATES
 ];

66 } 
	tNSQ_ßm∂es_°ru˘
;

68 
OPUS_INLINE
 
sûk_nsq_dñ_dec_sˇÀ_°©es_√⁄
(

69 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

70 
sûk_nsq_°©e
 *
NSQ
,

71 
NSQ_dñ_decs_°ru˘
 
psDñDec
[],

72 c⁄° 
›us_öt16
 
x16
[],

73 
›us_öt32
 
x_sc_Q10
[],

74 c⁄° 
›us_öt16
 
sLTP
[],

75 
›us_öt32
 
sLTP_Q15
[],

76 
›us_öt
 
sub‰
,

77 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

78 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

79 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

80 c⁄° 
›us_öt
 
sig«l_ty≥
,

81 c⁄° 
›us_öt
 
decisi⁄Dñay


87 
OPUS_INLINE
 
sûk_noi£_sh≠e_qu™tizî_dñ_dec_√⁄
(

88 
sûk_nsq_°©e
 *
NSQ
,

89 
NSQ_dñ_decs_°ru˘
 
psDñDec
[],

90 
›us_öt
 
sig«lTy≥
,

91 c⁄° 
›us_öt32
 
x_Q10
[],

92 
›us_öt8
 
pul£s
[],

93 
›us_öt16
 
xq
[],

94 
›us_öt32
 
sLTP_Q15
[],

95 
›us_öt32
 
dñayedGaö_Q10
[],

96 c⁄° 
›us_öt16
 
a_Q12
[],

97 c⁄° 
›us_öt16
 
b_Q14
[],

98 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

99 
›us_öt
 
œg
,

100 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

101 
›us_öt
 
Tût_Q14
,

102 
›us_öt32
 
LF_shp_Q14
,

103 
›us_öt32
 
Gaö_Q16
,

104 
›us_öt
 
Lambda_Q10
,

105 
›us_öt
 
off£t_Q10
,

106 
›us_öt
 
Àngth
,

107 
›us_öt
 
sub‰
,

108 
›us_öt
 
sh≠ögLPCOrdî
,

109 
›us_öt
 
¥edi˘LPCOrdî
,

110 
›us_öt
 
w¨pög_Q16
,

111 
›us_öt
 
nSèãsDñayedDecisi⁄
,

112 
›us_öt
 *
sm∂_buf_idx
,

113 
›us_öt
 
decisi⁄Dñay


116 
OPUS_INLINE
 
	$c›y_wö√r_°©e_kî√l
(

117 c⁄° 
NSQ_dñ_decs_°ru˘
 *
psDñDec
,

118 c⁄° 
›us_öt
 
off£t
,

119 c⁄° 
›us_öt
 
œ°_sm∂e_idx
,

120 c⁄° 
›us_öt
 
Wö√r_öd
,

121 c⁄° 
öt32x2_t
 
gaö_lo_s32x2
,

122 c⁄° 
öt32x2_t
 
gaö_hi_s32x2
,

123 c⁄° 
öt32x4_t
 
shi·_s32x4
,

124 
öt32x4_t
 
t0_s32x4
,

125 
öt32x4_t
 
t1_s32x4
,

126 
›us_öt8
 *c⁄° 
pul£s
,

127 
›us_öt16
 *
pxq
,

128 
sûk_nsq_°©e
 *
NSQ


131 
öt16x8_t
 
t_s16x8
;

132 
öt32x4_t
 
o0_s32x4
, 
o1_s32x4
;

134 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 0 ][ 
Wö√r_öd
 ],Å0_s32x4, 0 );

135 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 1 ][ 
Wö√r_öd
 ],Å0_s32x4, 1 );

136 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 2 ][ 
Wö√r_öd
 ],Å0_s32x4, 2 );

137 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 3 ][ 
Wö√r_öd
 ],Å0_s32x4, 3 );

138 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 4 ][ 
Wö√r_öd
 ],Å1_s32x4, 0 );

139 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 5 ][ 
Wö√r_öd
 ],Å1_s32x4, 1 );

140 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 6 ][ 
Wö√r_öd
 ],Å1_s32x4, 2 );

141 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 - 7 ][ 
Wö√r_öd
 ],Å1_s32x4, 3 );

142 
t_s16x8
 = 
	`vcomböe_s16
–
	`vrsh∫_n_s32
–
t0_s32x4
, 10 ), vrsh∫_n_s32–
t1_s32x4
, 10 ) );

143 
	`v°1_s8
–&
pul£s
[ 
off£t
 ], 
	`vmovn_s16
–
t_s16x8
 ) );

145 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 0 ][ 
Wö√r_öd
 ],Å0_s32x4, 0 );

146 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 1 ][ 
Wö√r_öd
 ],Å0_s32x4, 1 );

147 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 2 ][ 
Wö√r_öd
 ],Å0_s32x4, 2 );

148 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 3 ][ 
Wö√r_öd
 ],Å0_s32x4, 3 );

149 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 4 ][ 
Wö√r_öd
 ],Å1_s32x4, 0 );

150 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 5 ][ 
Wö√r_öd
 ],Å1_s32x4, 1 );

151 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 6 ][ 
Wö√r_öd
 ],Å1_s32x4, 2 );

152 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 - 7 ][ 
Wö√r_öd
 ],Å1_s32x4, 3 );

153 
o0_s32x4
 = 
	`vqdmulhq_œ√_s32
–
t0_s32x4
, 
gaö_lo_s32x2
, 0 );

154 
o1_s32x4
 = 
	`vqdmulhq_œ√_s32
–
t1_s32x4
, 
gaö_lo_s32x2
, 0 );

155 
o0_s32x4
 = 
	`vmœq_œ√_s32
–o0_s32x4, 
t0_s32x4
, 
gaö_hi_s32x2
, 0 );

156 
o1_s32x4
 = 
	`vmœq_œ√_s32
–o1_s32x4, 
t1_s32x4
, 
gaö_hi_s32x2
, 0 );

157 
o0_s32x4
 = 
	`vrshlq_s32
–o0_s32x4, 
shi·_s32x4
 );

158 
o1_s32x4
 = 
	`vrshlq_s32
–o1_s32x4, 
shi·_s32x4
 );

159 
	`v°1_s16
–&
pxq
[ 
off£t
 + 0 ], 
	`vqmovn_s32
–
o0_s32x4
 ) );

160 
	`v°1_s16
–&
pxq
[ 
off£t
 + 4 ], 
	`vqmovn_s32
–
o1_s32x4
 ) );

162 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 0 ][ 
Wö√r_öd
 ],Å0_s32x4, 0 );

163 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 1 ][ 
Wö√r_öd
 ],Å0_s32x4, 1 );

164 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 2 ][ 
Wö√r_öd
 ],Å0_s32x4, 2 );

165 
t0_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 3 ][ 
Wö√r_öd
 ],Å0_s32x4, 3 );

166 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 4 ][ 
Wö√r_öd
 ],Å1_s32x4, 0 );

167 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 5 ][ 
Wö√r_öd
 ],Å1_s32x4, 1 );

168 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 6 ][ 
Wö√r_öd
 ],Å1_s32x4, 2 );

169 
t1_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 - 7 ][ 
Wö√r_öd
 ],Å1_s32x4, 3 );

170 
	`v°1q_s32
–&
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 + 
off£t
 + 0 ], 
t0_s32x4
 );

171 
	`v°1q_s32
–&
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 + 
off£t
 + 4 ], 
t1_s32x4
 );

172 
	}
}

174 
OPUS_INLINE
 
	$c›y_wö√r_°©e
(

175 c⁄° 
NSQ_dñ_decs_°ru˘
 *
psDñDec
,

176 c⁄° 
›us_öt
 
decisi⁄Dñay
,

177 c⁄° 
›us_öt
 
sm∂_buf_idx
,

178 c⁄° 
›us_öt
 
Wö√r_öd
,

179 c⁄° 
›us_öt32
 
gaö
,

180 c⁄° 
›us_öt32
 
shi·
,

181 
›us_öt8
 *c⁄° 
pul£s
,

182 
›us_öt16
 *
pxq
,

183 
sûk_nsq_°©e
 *
NSQ


186 
›us_öt
 
i
, 
œ°_sm∂e_idx
;

187 c⁄° 
öt32x2_t
 
gaö_lo_s32x2
 = 
	`vdup_n_s32
–
	`sûk_LSHIFT32
–
gaö
 & 0x0000FFFF, 15 ) );

188 c⁄° 
öt32x2_t
 
gaö_hi_s32x2
 = 
	`vdup_n_s32
–
gaö
 >> 16 );

189 c⁄° 
öt32x4_t
 
shi·_s32x4
 = 
	`vdupq_n_s32
–-
shi·
 );

190 
öt32x4_t
 
t0_s32x4
, 
t1_s32x4
;

192 
t0_s32x4
 = 
t1_s32x4
 = 
	`vdupq_n_s32
( 0 );

193 
œ°_sm∂e_idx
 = 
sm∂_buf_idx
 + 
decisi⁄Dñay
 - 1 + 
DECISION_DELAY
;

194 if–
œ°_sm∂e_idx
 >
DECISION_DELAY
 )Üast_smple_idx -= DECISION_DELAY;

195 if–
œ°_sm∂e_idx
 >
DECISION_DELAY
 )Üast_smple_idx -= DECISION_DELAY;

197  
i
 = 0; ( i < ( 
decisi⁄Dñay
 - 7 ) ) && ( 
œ°_sm∂e_idx
 >= 7 ); i += 8,Üast_smple_idx -= 8 ) {

198 
	`c›y_wö√r_°©e_kî√l
–
psDñDec
, 
i
 - 
decisi⁄Dñay
, 
œ°_sm∂e_idx
, 
Wö√r_öd
, 
gaö_lo_s32x2
, 
gaö_hi_s32x2
, 
shi·_s32x4
, 
t0_s32x4
, 
t1_s32x4
, 
pul£s
, 
pxq
, 
NSQ
 );

200  ; ( 
i
 < 
decisi⁄Dñay
 ) && ( 
œ°_sm∂e_idx
 >= 0 ); i++,Üast_smple_idx-- ) {

201 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 10 );

202 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 
gaö
 ), 
shi·
 ) );

203 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ];

206 
œ°_sm∂e_idx
 +
DECISION_DELAY
;

207  ; 
i
 < ( 
decisi⁄Dñay
 - 7 ); i++, 
œ°_sm∂e_idx
-- ) {

208 
	`c›y_wö√r_°©e_kî√l
–
psDñDec
, 
i
 - 
decisi⁄Dñay
, 
œ°_sm∂e_idx
, 
Wö√r_öd
, 
gaö_lo_s32x2
, 
gaö_hi_s32x2
, 
shi·_s32x4
, 
t0_s32x4
, 
t1_s32x4
, 
pul£s
, 
pxq
, 
NSQ
 );

210  ; 
i
 < 
decisi⁄Dñay
; i++, 
œ°_sm∂e_idx
-- ) {

211 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 10 );

212 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 
gaö
 ), 
shi·
 ) );

213 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ];

215 
	}
}

217 
	$sûk_NSQ_dñ_dec_√⁄
(

218 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

219 
sûk_nsq_°©e
 *
NSQ
,

220 
SideInfoIndi˚s
 *
psIndi˚s
,

221 c⁄° 
›us_öt16
 
x16
[],

222 
›us_öt8
 
pul£s
[],

223 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

224 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

225 c⁄° 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

226 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

227 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

228 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

229 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

230 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

231 c⁄° 
›us_öt
 
Lambda_Q10
,

232 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


235 #ifde‡
OPUS_CHECK_ASM


236 
sûk_nsq_°©e
 
NSQ_c
;

237 
SideInfoIndi˚s
 
psIndi˚s_c
;

238 
›us_öt8
 
pul£s_c
[ 
MAX_FRAME_LENGTH
 ];

239 c⁄° 
›us_öt8
 *c⁄° 
pul£s_a
 = 
pul£s
;

241 –)
pul£s_a
;

242 
	`sûk_mem˝y
–&
NSQ_c
, 
NSQ
, ( NSQ_c ) );

243 
	`sûk_mem˝y
–&
psIndi˚s_c
, 
psIndi˚s
, (ÖsIndices_c ) );

244 
	`sûk_mem˝y
–
pul£s_c
, 
pul£s
, (Öulses_c ) );

245 
	`sûk_NSQ_dñ_dec_c
–
psEncC
, &
NSQ_c
, &
psIndi˚s_c
, 
x16
, 
pul£s_c
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
,

246 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
 );

250 if(–
psEncC
->
nSèãsDñayedDecisi⁄
 > 
NEON_MAX_DEL_DEC_STATES
 ) || (ÖsEncC->nStatesDelayedDecision <= 2 )) {

257 
	`sûk_NSQ_dñ_dec_c
–
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, 
H¨mSh≠eGaö_Q14
,

258 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
 );

260 
›us_öt
 
i
, 
k
, 
œg
, 
°¨t_idx
, 
LSF_öãΩﬁ©i⁄_Êag
, 
Wö√r_öd
, 
sub‰
;

261 
›us_öt
 
sm∂_buf_idx
, 
decisi⁄Dñay
;

262 c⁄° 
›us_öt16
 *
A_Q12
, *
B_Q14
, *
AR_shp_Q13
;

263 
›us_öt16
 *
pxq
;

264 
	`VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

265 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

266 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
;

267 
›us_öt
 
off£t_Q10
;

268 
›us_öt32
 
RDmö_Q10
, 
Gaö_Q10
;

269 
	`VARDECL
–
›us_öt32
, 
x_sc_Q10
 );

270 
	`VARDECL
–
›us_öt32
, 
dñayedGaö_Q10
 );

271 
	`VARDECL
–
NSQ_dñ_decs_°ru˘
, 
psDñDec
 );

272 
öt32x4_t
 
t_s32x4
;

273 
SAVE_STACK
;

276 
œg
 = 
NSQ
->
œgPªv
;

278 
	`sûk_as£π
–
NSQ
->
¥ev_gaö_Q16
 != 0 );

281 
	`ALLOC
–
psDñDec
, 1, 
NSQ_dñ_decs_°ru˘
 );

283 
	`sûk_mem£t
–
psDñDec
->
R™dSèã
, 0, (ÖsDelDec->RandState ) );

284 
	`v°1q_s32
–
psDñDec
->
RD_Q10
, 
	`vdupq_n_s32
( 0 ) );

286  
k
 = 0; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

287 
psDñDec
->
SìdInô
[ 
k
 ] =ÖsDñDec->
Sìd
[ k ] = ( k + 
psIndi˚s
->Seed ) & 3;

289 
	`v°1q_s32
–
psDñDec
->
LF_AR_Q14
, 
	`vld1q_dup_s32
–&
NSQ
->
sLF_AR_shp_Q14
 ) );

290 
	`v°1q_s32
–
psDñDec
->
Diff_Q14
, 
	`vld1q_dup_s32
–&
NSQ
->
sDiff_shp_Q14
 ) );

291 
	`v°1q_s32
–
psDñDec
->
Sh≠e_Q14
[ 0 ], 
	`vld1q_dup_s32
–&
NSQ
->
sLTP_shp_Q14
[ 
psEncC
->
…p_mem_Àngth
 - 1 ] ) );

292  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

293 
	`v°1q_s32
–
psDñDec
->
sLPC_Q14
[ 
i
 ], 
	`vld1q_dup_s32
–&
NSQ
->sLPC_Q14[ i ] ) );

295  
i
 = 0; i < (
›us_öt
)––
NSQ
->
sAR2_Q14
 ) / ( NSQ->sAR2_Q14[ 0 ] ) ); i++ ) {

296 
	`v°1q_s32
–
psDñDec
->
sAR2_Q14
[ 
i
 ], 
	`vld1q_dup_s32
–&
NSQ
->sAR2_Q14[ i ] ) );

299 
off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psIndi˚s
->
sig«lTy≥
 >> 1 ][ÖsIndi˚s->
qu™tOff£tTy≥
 ];

300 
sm∂_buf_idx
 = 0;

302 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–
DECISION_DELAY
, 
psEncC
->
sub‰_Àngth
 );

305 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

306 
›us_öt
 
pôch_mö
 = 
pôchL
[ 0 ];

307  
k
 = 1; k < 
psEncC
->
nb_sub‰
; k++ ) {

308 
pôch_mö
 = 
	`sûk_mö_öt
–pôch_mö, 
pôchL
[ 
k
 ] );

310 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
pôch_mö
 - 
LTP_ORDER
 / 2 - 1 );

312 if–
œg
 > 0 ) {

313 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
œg
 - 
LTP_ORDER
 / 2 - 1 );

317 if–
psIndi˚s
->
NLSFI¡îpC€f_Q2
 == 4 ) {

318 
LSF_öãΩﬁ©i⁄_Êag
 = 0;

320 
LSF_öãΩﬁ©i⁄_Êag
 = 1;

323 
	`ALLOC
–
sLTP_Q15
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt32
 );

324 
	`ALLOC
–
sLTP
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt16
 );

325 
	`ALLOC
–
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
, 
›us_öt32
 );

326 
	`ALLOC
–
dñayedGaö_Q10
, 
DECISION_DELAY
, 
›us_öt32
 );

328 
pxq
 = &
NSQ
->
xq
[ 
psEncC
->
…p_mem_Àngth
 ];

329 
NSQ
->
sLTP_shp_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

330 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

331 
sub‰
 = 0;

332  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

333 
A_Q12
 = &
PªdC€f_Q12
[ ( ( 
k
 >> 1 ) | ( 1 - 
LSF_öãΩﬁ©i⁄_Êag
 ) ) * 
MAX_LPC_ORDER
 ];

334 
B_Q14
 = &
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

335 
AR_shp_Q13
 = &
AR_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ];

338 
	`sûk_as£π
–
H¨mSh≠eGaö_Q14
[ 
k
 ] >= 0 );

339 
H¨mSh≠eFIRPacked_Q14
 = 
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 2 );

340 
H¨mSh≠eFIRPacked_Q14
 |
	`sûk_LSHIFT
–(
›us_öt32
)
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 1 ), 16 );

342 
NSQ
->
ªwhôe_Êag
 = 0;

343 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

345 
œg
 = 
pôchL
[ 
k
 ];

348 if––
k
 & ( 3 - 
	`sûk_LSHIFT
–
LSF_öãΩﬁ©i⁄_Êag
, 1 ) ) ) == 0 ) {

349 if–
k
 == 2 ) {

352 
öt32x4_t
 
RD_Q10_s32x4
;

353 
RDmö_Q10
 = 
psDñDec
->
RD_Q10
[ 0 ];

354 
Wö√r_öd
 = 0;

355  
i
 = 1; i < 
psEncC
->
nSèãsDñayedDecisi⁄
; i++ ) {

356 if–
psDñDec
->
RD_Q10
[ 
i
 ] < 
RDmö_Q10
 ) {

357 
RDmö_Q10
 = 
psDñDec
->
RD_Q10
[ 
i
 ];

358 
Wö√r_öd
 = 
i
;

361 
psDñDec
->
RD_Q10
[ 
Wö√r_öd
 ] -–
sûk_öt32_MAX
 >> 4 );

362 
RD_Q10_s32x4
 = 
	`vld1q_s32
–
psDñDec
->
RD_Q10
 );

363 
RD_Q10_s32x4
 = 
	`vaddq_s32
–RD_Q10_s32x4, 
	`vdupq_n_s32
–
sûk_öt32_MAX
 >> 4 ) );

364 
	`v°1q_s32
–
psDñDec
->
RD_Q10
, 
RD_Q10_s32x4
 );

367 
	`c›y_wö√r_°©e
–
psDñDec
, 
decisi⁄Dñay
, 
sm∂_buf_idx
, 
Wö√r_öd
, 
Gaös_Q16
[ 1 ], 14, 
pul£s
, 
pxq
, 
NSQ
 );

369 
sub‰
 = 0;

373 
°¨t_idx
 = 
psEncC
->
…p_mem_Àngth
 - 
œg
 -ÖsEncC->
¥edi˘LPCOrdî
 - 
LTP_ORDER
 / 2;

374 
	`sûk_as£π
–
°¨t_idx
 > 0 );

376 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
NSQ
->
xq
[ sèπ_idx + 
k
 * 
psEncC
->
sub‰_Àngth
 ],

377 
A_Q12
, 
psEncC
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

379 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

380 
NSQ
->
ªwhôe_Êag
 = 1;

384 
	`sûk_nsq_dñ_dec_sˇÀ_°©es_√⁄
–
psEncC
, 
NSQ
, 
psDñDec
, 
x16
, 
x_sc_Q10
, 
sLTP
, 
sLTP_Q15
, 
k
,

385 
LTP_sˇÀ_Q14
, 
Gaös_Q16
, 
pôchL
, 
psIndi˚s
->
sig«lTy≥
, 
decisi⁄Dñay
 );

387 
	`sûk_noi£_sh≠e_qu™tizî_dñ_dec_√⁄
–
NSQ
, 
psDñDec
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
,

388 
dñayedGaö_Q10
, 
A_Q12
, 
B_Q14
, 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ],

389 
Gaös_Q16
[ 
k
 ], 
Lambda_Q10
, 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
, 
sub‰
++,ÖsEncC->
sh≠ögLPCOrdî
,

390 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
w¨pög_Q16
,ÖsEncC->
nSèãsDñayedDecisi⁄
, &
sm∂_buf_idx
, 
decisi⁄Dñay
 );

392 
x16
 +
psEncC
->
sub‰_Àngth
;

393 
pul£s
 +
psEncC
->
sub‰_Àngth
;

394 
pxq
 +
psEncC
->
sub‰_Àngth
;

398 
RDmö_Q10
 = 
psDñDec
->
RD_Q10
[ 0 ];

399 
Wö√r_öd
 = 0;

400  
k
 = 1; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

401 if–
psDñDec
->
RD_Q10
[ 
k
 ] < 
RDmö_Q10
 ) {

402 
RDmö_Q10
 = 
psDñDec
->
RD_Q10
[ 
k
 ];

403 
Wö√r_öd
 = 
k
;

408 
psIndi˚s
->
Sìd
 = 
psDñDec
->
SìdInô
[ 
Wö√r_öd
 ];

409 
Gaö_Q10
 = 
	`sûk_RSHIFT32
–
Gaös_Q16
[ 
psEncC
->
nb_sub‰
 - 1 ], 6 );

410 
	`c›y_wö√r_°©e
–
psDñDec
, 
decisi⁄Dñay
, 
sm∂_buf_idx
, 
Wö√r_öd
, 
Gaö_Q10
, 8, 
pul£s
, 
pxq
, 
NSQ
 );

412 
t_s32x4
 = 
	`vdupq_n_s32
( 0 );

413  
i
 = 0; i < ( 
NSQ_LPC_BUF_LENGTH
 - 3 ); i += 4 ) {

414 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sLPC_Q14
[ 
i
 + 0 ][ 
Wö√r_öd
 ],Å_s32x4, 0 );

415 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sLPC_Q14
[ 
i
 + 1 ][ 
Wö√r_öd
 ],Å_s32x4, 1 );

416 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sLPC_Q14
[ 
i
 + 2 ][ 
Wö√r_öd
 ],Å_s32x4, 2 );

417 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sLPC_Q14
[ 
i
 + 3 ][ 
Wö√r_öd
 ],Å_s32x4, 3 );

418 
	`v°1q_s32
–&
NSQ
->
sLPC_Q14
[ 
i
 ], 
t_s32x4
 );

421  ; 
i
 < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

422 
NSQ
->
sLPC_Q14
[ 
i
 ] = 
psDñDec
->sLPC_Q14[ i ][ 
Wö√r_öd
 ];

425  
i
 = 0; i < (
›us_öt
)––
NSQ
->
sAR2_Q14
 ) / ( NSQ->sAR2_Q14[ 0 ] ) - 3 ); i += 4 ) {

426 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sAR2_Q14
[ 
i
 + 0 ][ 
Wö√r_öd
 ],Å_s32x4, 0 );

427 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sAR2_Q14
[ 
i
 + 1 ][ 
Wö√r_öd
 ],Å_s32x4, 1 );

428 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sAR2_Q14
[ 
i
 + 2 ][ 
Wö√r_öd
 ],Å_s32x4, 2 );

429 
t_s32x4
 = 
	`vld1q_œ√_s32
–&
psDñDec
->
sAR2_Q14
[ 
i
 + 3 ][ 
Wö√r_öd
 ],Å_s32x4, 3 );

430 
	`v°1q_s32
–&
NSQ
->
sAR2_Q14
[ 
i
 ], 
t_s32x4
 );

433  ; 
i
 < (
›us_öt
)––
NSQ
->
sAR2_Q14
 ) / ( NSQ->sAR2_Q14[ 0 ] ) ); i++ ) {

434 
NSQ
->
sAR2_Q14
[ 
i
 ] = 
psDñDec
->sAR2_Q14[ i ][ 
Wö√r_öd
 ];

438 
NSQ
->
sLF_AR_shp_Q14
 = 
psDñDec
->
LF_AR_Q14
[ 
Wö√r_öd
 ];

439 
NSQ
->
sDiff_shp_Q14
 = 
psDñDec
->
Diff_Q14
[ 
Wö√r_öd
 ];

440 
NSQ
->
œgPªv
 = 
pôchL
[ 
psEncC
->
nb_sub‰
 - 1 ];

443 
	`sûk_memmove
–
NSQ
->
xq
, &NSQ->xq[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt16
 ) );

444 
	`sûk_memmove
–
NSQ
->
sLTP_shp_Q14
, &NSQ->sLTP_shp_Q14[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt32
 ) );

445 
RESTORE_STACK
;

448 #ifde‡
OPUS_CHECK_ASM


449 
	`sûk_as£π
–!
	`memcmp
–&
NSQ_c
, 
NSQ
, ( NSQ_c ) ) );

450 
	`sûk_as£π
–!
	`memcmp
–&
psIndi˚s_c
, 
psIndi˚s
, (ÖsIndices_c ) ) );

451 
	`sûk_as£π
–!
	`memcmp
–
pul£s_c
, 
pul£s_a
, (Öulses_c ) ) );

453 
	}
}

460 
OPUS_INLINE
 
	$sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f_√⁄_loˇl
(
›us_öt32
 *
out
, c⁄° 
›us_öt16
 *
ö
, 
›us_öt
 
‹dî
)

462 
öt16x8_t
 
t_s16x8
;

463 
öt32x4_t
 
t0_s32x4
, 
t1_s32x4
, 
t2_s32x4
, 
t3_s32x4
;

464 
	`sûk_as£π
–
‹dî
 == 10 || order == 16 );

466 
t_s16x8
 = 
	`vld1q_s16
–
ö
 + 0 );

467 
t_s16x8
 = 
	`vªv64q_s16
(Å_s16x8 );

468 
t2_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t_s16x8
 ), 15 );

469 
t3_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_low_s16
–
t_s16x8
 ), 15 );

471 if–
‹dî
 == 16 ) {

472 
t_s16x8
 = 
	`vld1q_s16
–
ö
 + 8 );

473 
t_s16x8
 = 
	`vªv64q_s16
(Å_s16x8 );

474 
t0_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t_s16x8
 ), 15 );

475 
t1_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_low_s16
–
t_s16x8
 ), 15 );

477 
öt16x4_t
 
t_s16x4
;

479 
t0_s32x4
 = 
	`vdupq_n_s32
( 0 );

480 
t_s16x4
 = 
	`vld1_s16
–
ö
 + 6 );

481 
t_s16x4
 = 
	`vªv64_s16
(Å_s16x4 );

482 
t1_s32x4
 = 
	`vshŒ_n_s16
–
t_s16x4
, 15 );

483 
t1_s32x4
 = 
	`vcomböe_s32
–
	`vgë_low_s32
(
t0_s32x4
), vget_low_s32(Å1_s32x4 ) );

485 
	`v°1q_s32
–
out
 + 0, 
t0_s32x4
 );

486 
	`v°1q_s32
–
out
 + 4, 
t1_s32x4
 );

487 
	`v°1q_s32
–
out
 + 8, 
t2_s32x4
 );

488 
	`v°1q_s32
–
out
 + 12, 
t3_s32x4
 );

489 
	}
}

491 
OPUS_INLINE
 
öt32x4_t
 
	$sûk_SMLAWB_œ√0_√⁄
(

492 c⁄° 
öt32x4_t
 
out_s32x4
,

493 c⁄° 
öt32x4_t
 
ö_s32x4
,

494 c⁄° 
öt32x2_t
 
c€f_s32x2


497  
	`vaddq_s32
–
out_s32x4
, 
	`vqdmulhq_œ√_s32
–
ö_s32x4
, 
c€f_s32x2
, 0 ) );

498 
	}
}

500 
OPUS_INLINE
 
öt32x4_t
 
	$sûk_SMLAWB_œ√1_√⁄
(

501 c⁄° 
öt32x4_t
 
out_s32x4
,

502 c⁄° 
öt32x4_t
 
ö_s32x4
,

503 c⁄° 
öt32x2_t
 
c€f_s32x2


506  
	`vaddq_s32
–
out_s32x4
, 
	`vqdmulhq_œ√_s32
–
ö_s32x4
, 
c€f_s32x2
, 1 ) );

507 
	}
}

511 
OPUS_INLINE
 
öt32x4_t
 
	$sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄_loˇl
(c⁄° 
›us_öt32
 *
buf32
, c⁄° opus_öt32 *
a_Q12_¨ch
, 
›us_öt
 
‹dî
)

513 c⁄° 
öt32x4_t
 
a_Q12_¨ch0_s32x4
 = 
	`vld1q_s32
–
a_Q12_¨ch
 + 0 );

514 c⁄° 
öt32x4_t
 
a_Q12_¨ch1_s32x4
 = 
	`vld1q_s32
–
a_Q12_¨ch
 + 4 );

515 c⁄° 
öt32x4_t
 
a_Q12_¨ch2_s32x4
 = 
	`vld1q_s32
–
a_Q12_¨ch
 + 8 );

516 c⁄° 
öt32x4_t
 
a_Q12_¨ch3_s32x4
 = 
	`vld1q_s32
–
a_Q12_¨ch
 + 12 );

517 
öt32x4_t
 
LPC_¥ed_Q14_s32x4
;

519 
	`sûk_as£π
–
‹dî
 == 10 || order == 16 );

521 
LPC_¥ed_Q14_s32x4
 = 
	`vdupq_n_s32
–
	`sûk_RSHIFT
–
‹dî
, 1 ) );

522 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 0 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch0_s32x4
 ) );

523 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 1 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch0_s32x4
 ) );

524 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 2 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch0_s32x4
 ) );

525 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 3 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch0_s32x4
 ) );

526 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 4 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch1_s32x4
 ) );

527 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 5 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch1_s32x4
 ) );

528 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 6 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch1_s32x4
 ) );

529 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 7 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch1_s32x4
 ) );

530 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 8 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch2_s32x4
 ) );

531 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 9 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch2_s32x4
 ) );

532 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 10 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch2_s32x4
 ) );

533 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 11 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch2_s32x4
 ) );

534 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 12 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch3_s32x4
 ) );

535 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 13 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_low_s32
–
a_Q12_¨ch3_s32x4
 ) );

536 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 14 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch3_s32x4
 ) );

537 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_SMLAWB_œ√1_√⁄
–LPC_¥ed_Q14_s32x4, 
	`vld1q_s32
–
buf32
 + 15 * 
NEON_MAX_DEL_DEC_STATES
 ), 
	`vgë_high_s32
–
a_Q12_¨ch3_s32x4
 ) );

539  
LPC_¥ed_Q14_s32x4
;

540 
	}
}

542 
OPUS_INLINE
 
	$sûk_noi£_sh≠e_qu™tizî_dñ_dec_√⁄
(

543 
sûk_nsq_°©e
 *
NSQ
,

544 
NSQ_dñ_decs_°ru˘
 
psDñDec
[],

545 
›us_öt
 
sig«lTy≥
,

546 c⁄° 
›us_öt32
 
x_Q10
[],

547 
›us_öt8
 
pul£s
[],

548 
›us_öt16
 
xq
[],

549 
›us_öt32
 
sLTP_Q15
[],

550 
›us_öt32
 
dñayedGaö_Q10
[],

551 c⁄° 
›us_öt16
 
a_Q12
[],

552 c⁄° 
›us_öt16
 
b_Q14
[],

553 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

554 
›us_öt
 
œg
,

555 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

556 
›us_öt
 
Tût_Q14
,

557 
›us_öt32
 
LF_shp_Q14
,

558 
›us_öt32
 
Gaö_Q16
,

559 
›us_öt
 
Lambda_Q10
,

560 
›us_öt
 
off£t_Q10
,

561 
›us_öt
 
Àngth
,

562 
›us_öt
 
sub‰
,

563 
›us_öt
 
sh≠ögLPCOrdî
,

564 
›us_öt
 
¥edi˘LPCOrdî
,

565 
›us_öt
 
w¨pög_Q16
,

566 
›us_öt
 
nSèãsDñayedDecisi⁄
,

567 
›us_öt
 *
sm∂_buf_idx
,

568 
›us_öt
 
decisi⁄Dñay


571 
›us_öt
 
i
, 
j
, 
k
, 
Wö√r_öd
, 
RDmö_öd
, 
RDmax_öd
, 
œ°_sm∂e_idx
;

572 
›us_öt32
 
Wö√r_ønd_°©e
;

573 
›us_öt32
 
LTP_¥ed_Q14
, 
n_LTP_Q14
;

574 
›us_öt32
 
RDmö_Q10
, 
RDmax_Q10
;

575 
›us_öt32
 
Gaö_Q10
;

576 
›us_öt32
 *
¥ed_œg_±r
, *
shp_œg_±r
;

577 
›us_öt32
 
a_Q12_¨ch
[
MAX_LPC_ORDER
];

578 c⁄° 
öt32x2_t
 
w¨pög_Q16_s32x2
 = 
	`vdup_n_s32
–
	`sûk_LSHIFT32
–
w¨pög_Q16
, 16 ) >> 1 );

579 c⁄° 
›us_öt32
 
LF_shp_Q29
 = 
	`sûk_LSHIFT32
–
LF_shp_Q14
, 16 ) >> 1;

580 
›us_öt32
 
AR_shp_Q28
[ 
MAX_SHAPE_LPC_ORDER
 ];

581 c⁄° 
uöt32x4_t
 
ønd_mu…ùlõr_u32x4
 = 
	`vdupq_n_u32
–
RAND_MULTIPLIER
 );

582 c⁄° 
uöt32x4_t
 
ønd_ö¸emít_u32x4
 = 
	`vdupq_n_u32
–
RAND_INCREMENT
 );

584 
	`VARDECL
–
NSQ_ßm∂es_°ru˘
, 
psSam∂eSèã
 );

585 
SAVE_STACK
;

587 
	`sûk_as£π
–
nSèãsDñayedDecisi⁄
 > 0 );

588 
	`sûk_as£π
––
sh≠ögLPCOrdî
 & 1 ) == 0 );

589 
	`ALLOC
–
psSam∂eSèã
, 2, 
NSQ_ßm∂es_°ru˘
 );

591 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

592 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

593 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

595  
i
 = 0; i < ( 
MAX_SHAPE_LPC_ORDER
 - 7 ); i += 8 ) {

596 c⁄° 
öt16x8_t
 
t_s16x8
 = 
	`vld1q_s16
–
AR_shp_Q13
 + 
i
 );

597 
	`v°1q_s32
–
AR_shp_Q28
 + 
i
 + 0, 
	`vshŒ_n_s16
–
	`vgë_low_s16
–
t_s16x8
 ), 15 ) );

598 
	`v°1q_s32
–
AR_shp_Q28
 + 
i
 + 4, 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t_s16x8
 ), 15 ) );

601  ; 
i
 < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

602 
AR_shp_Q28
[
i
] = 
	`sûk_LSHIFT32
–
AR_shp_Q13
[i], 15 );

605 
	`sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f_√⁄_loˇl
–
a_Q12_¨ch
, 
a_Q12
, 
¥edi˘LPCOrdî
 );

607  
i
 = 0; i < 
Àngth
; i++ ) {

608 
öt32x4_t
 
Sìd_s32x4
, 
LPC_¥ed_Q14_s32x4
;

609 
öt32x4_t
 
sign_s32x4
, 
tmp1_s32x4
, 
tmp2_s32x4
;

610 
öt32x4_t
 
n_AR_Q14_s32x4
, 
n_LF_Q14_s32x4
;

611 
öt32x2_t
 
AR_shp_Q28_s32x2
;

612 
öt16x4_t
 
r_Q10_s16x4
, 
º_Q10_s16x4
;

617 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

620 
LTP_¥ed_Q14
 = 2;

621 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ 0 ], 
b_Q14
[ 0 ] );

622 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -1 ], 
b_Q14
[ 1 ] );

623 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -2 ], 
b_Q14
[ 2 ] );

624 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -3 ], 
b_Q14
[ 3 ] );

625 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -4 ], 
b_Q14
[ 4 ] );

626 
LTP_¥ed_Q14
 = 
	`sûk_LSHIFT
( LTP_pred_Q14, 1 );

627 
¥ed_œg_±r
++;

629 
LTP_¥ed_Q14
 = 0;

633 if–
œg
 > 0 ) {

635 
n_LTP_Q14
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

636 
n_LTP_Q14
 = 
	`sûk_SMLAWT
–n_LTP_Q14, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

637 
n_LTP_Q14
 = 
	`sûk_SUB_LSHIFT32
–
LTP_¥ed_Q14
,Ç_LTP_Q14, 2 );

638 
shp_œg_±r
++;

640 
n_LTP_Q14
 = 0;

644 
Sìd_s32x4
 = 
	`vld1q_s32
–
psDñDec
->
Sìd
 );

645 
Sìd_s32x4
 = 
	`vªöãΩªtq_s32_u32
–
	`vmœq_u32
–
ønd_ö¸emít_u32x4
, 
	`vªöãΩªtq_u32_s32
–Sìd_s32x4 ), 
ønd_mu…ùlõr_u32x4
 ) );

646 
	`v°1q_s32
–
psDñDec
->
Sìd
, 
Sìd_s32x4
 );

649 
LPC_¥ed_Q14_s32x4
 = 
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄_loˇl
(
psDñDec
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 16 + 
i
 ], 
a_Q12_¨ch
, 
¥edi˘LPCOrdî
);

650 
LPC_¥ed_Q14_s32x4
 = 
	`vshlq_n_s32
( LPC_pred_Q14_s32x4, 4 );

654 
tmp2_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–
	`vld1q_s32
–
psDñDec
->
Diff_Q14
 ), vld1q_s32–psDñDec->
sAR2_Q14
[ 0 ] ), 
w¨pög_Q16_s32x2
 );

656 
tmp1_s32x4
 = 
	`vsubq_s32
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 1 ] ), 
tmp2_s32x4
 );

657 
tmp1_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 0 ] ),Åmp1_s32x4, 
w¨pög_Q16_s32x2
 );

658 
	`v°1q_s32
–
psDñDec
->
sAR2_Q14
[ 0 ], 
tmp2_s32x4
 );

659 
AR_shp_Q28_s32x2
 = 
	`vld1_s32
–
AR_shp_Q28
 );

660 
n_AR_Q14_s32x4
 = 
	`vaddq_s32
–
	`vdupq_n_s32
–
	`sûk_RSHIFT
–
sh≠ögLPCOrdî
, 1 ) ), 
	`vqdmulhq_œ√_s32
–
tmp2_s32x4
, 
AR_shp_Q28_s32x2
, 0 ) );

663  
j
 = 2; j < 
sh≠ögLPCOrdî
; j += 2 ) {

665 
tmp2_s32x4
 = 
	`vsubq_s32
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 + 0 ] ), 
tmp1_s32x4
 );

666 
tmp2_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 - 1 ] ),Åmp2_s32x4, 
w¨pög_Q16_s32x2
 );

667 
	`v°1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 - 1 ], 
tmp1_s32x4
 );

668 
n_AR_Q14_s32x4
 = 
	`vaddq_s32
–n_AR_Q14_s32x4, 
	`vqdmulhq_œ√_s32
–
tmp1_s32x4
, 
AR_shp_Q28_s32x2
, 1 ) );

670 
tmp1_s32x4
 = 
	`vsubq_s32
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 + 1 ] ), 
tmp2_s32x4
 );

671 
tmp1_s32x4
 = 
	`sûk_SMLAWB_œ√0_√⁄
–
	`vld1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 + 0 ] ),Åmp1_s32x4, 
w¨pög_Q16_s32x2
 );

672 
	`v°1q_s32
–
psDñDec
->
sAR2_Q14
[ 
j
 + 0 ], 
tmp2_s32x4
 );

673 
AR_shp_Q28_s32x2
 = 
	`vld1_s32
–&
AR_shp_Q28
[ 
j
 ] );

674 
n_AR_Q14_s32x4
 = 
	`vaddq_s32
–n_AR_Q14_s32x4, 
	`vqdmulhq_œ√_s32
–
tmp2_s32x4
, 
AR_shp_Q28_s32x2
, 0 ) );

676 
	`v°1q_s32
–
psDñDec
->
sAR2_Q14
[ 
sh≠ögLPCOrdî
 - 1 ], 
tmp1_s32x4
 );

677 
n_AR_Q14_s32x4
 = 
	`vaddq_s32
–n_AR_Q14_s32x4, 
	`vqdmulhq_œ√_s32
–
tmp1_s32x4
, 
AR_shp_Q28_s32x2
, 1 ) );

678 
n_AR_Q14_s32x4
 = 
	`vshlq_n_s32
(Ç_AR_Q14_s32x4, 1 );

679 
n_AR_Q14_s32x4
 = 
	`vaddq_s32
–n_AR_Q14_s32x4, 
	`vqdmulhq_n_s32
–
	`vld1q_s32
–
psDñDec
->
LF_AR_Q14
 ), 
	`sûk_LSHIFT32
–
Tût_Q14
, 16 ) >> 1 ) );

680 
n_AR_Q14_s32x4
 = 
	`vshlq_n_s32
(Ç_AR_Q14_s32x4, 2 );

681 
n_LF_Q14_s32x4
 = 
	`vqdmulhq_n_s32
–
	`vld1q_s32
–
psDñDec
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ] ), 
LF_shp_Q29
 );

682 
n_LF_Q14_s32x4
 = 
	`vaddq_s32
–n_LF_Q14_s32x4, 
	`vqdmulhq_n_s32
–
	`vld1q_s32
–
psDñDec
->
LF_AR_Q14
 ), 
	`sûk_LSHIFT32
–
LF_shp_Q14
 >> 16 , 15 ) ) );

683 
n_LF_Q14_s32x4
 = 
	`vshlq_n_s32
(Ç_LF_Q14_s32x4, 2 );

687 
tmp1_s32x4
 = 
	`vaddq_s32
–
n_AR_Q14_s32x4
, 
n_LF_Q14_s32x4
 );

688 
tmp2_s32x4
 = 
	`vaddq_s32
–
	`vdupq_n_s32
–
n_LTP_Q14
 ), 
LPC_¥ed_Q14_s32x4
 );

689 
tmp1_s32x4
 = 
	`vsubq_s32
–
tmp2_s32x4
,Åmp1_s32x4 );

690 
tmp1_s32x4
 = 
	`vrshrq_n_s32
(Åmp1_s32x4, 4 );

691 
tmp1_s32x4
 = 
	`vsubq_s32
–
	`vdupq_n_s32
–
x_Q10
[ 
i
 ] ),Åmp1_s32x4 );

694 
sign_s32x4
 = 
	`vªöãΩªtq_s32_u32
–
	`v˛tq_s32
–
Sìd_s32x4
, 
	`vdupq_n_s32
( 0 ) ) );

695 
tmp1_s32x4
 = 
	`ve‹q_s32
–tmp1_s32x4, 
sign_s32x4
 );

696 
tmp1_s32x4
 = 
	`vsubq_s32
–tmp1_s32x4, 
sign_s32x4
 );

697 
tmp1_s32x4
 = 
	`vmaxq_s32
–tmp1_s32x4, 
	`vdupq_n_s32
( -( 31 << 10 ) ) );

698 
tmp1_s32x4
 = 
	`vmöq_s32
–tmp1_s32x4, 
	`vdupq_n_s32
( 30 << 10 ) );

699 
r_Q10_s16x4
 = 
	`vmovn_s32
–
tmp1_s32x4
 );

703 
öt16x4_t
 
q1_Q10_s16x4
 = 
	`vsub_s16
–
r_Q10_s16x4
, 
	`vdup_n_s16
–
off£t_Q10
 ) );

704 
öt16x4_t
 
q1_Q0_s16x4
 = 
	`vshr_n_s16
–
q1_Q10_s16x4
, 10 );

705 
öt16x4_t
 
q2_Q10_s16x4
;

706 
öt32x4_t
 
rd1_Q10_s32x4
, 
rd2_Q10_s32x4
;

707 
uöt32x4_t
 
t_u32x4
;

709 if–
Lambda_Q10
 > 2048 ) {

711 c⁄° 
rdo_off£t
 = 
Lambda_Q10
/2 - 512;

712 c⁄° 
uöt16x4_t
 
gª©îTh™Rdo
 = 
	`vcgt_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
–
rdo_off£t
 ) );

713 c⁄° 
uöt16x4_t
 
ÀssTh™MöusRdo
 = 
	`v˛t_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
–-
rdo_off£t
 ) );

715 
	`sûk_as£π
–
Lambda_Q10
 <= 32767 );

717 
q1_Q0_s16x4
 = 
	`vªöãΩªt_s16_u16
–
	`v˛t_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
( 0 ) ) );

718 
q1_Q0_s16x4
 = 
	`vb¶_s16
–
gª©îTh™Rdo
, 
	`vsub_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
–
rdo_off£t
 ) ), q1_Q0_s16x4 );

719 
q1_Q0_s16x4
 = 
	`vb¶_s16
–
ÀssTh™MöusRdo
, 
	`vadd_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
–
rdo_off£t
 ) ), q1_Q0_s16x4 );

720 
q1_Q0_s16x4
 = 
	`vshr_n_s16
( q1_Q0_s16x4, 10 );

723 c⁄° 
uöt16x4_t
 
equÆ0_u16x4
 = 
	`v˚q_s16
–
q1_Q0_s16x4
, 
	`vdup_n_s16
( 0 ) );

724 c⁄° 
uöt16x4_t
 
equÆMöus1_u16x4
 = 
	`v˚q_s16
–
q1_Q0_s16x4
, 
	`vdup_n_s16
( -1 ) );

725 c⁄° 
uöt16x4_t
 
ÀssTh™Möus1_u16x4
 = 
	`v˛t_s16
–
q1_Q0_s16x4
, 
	`vdup_n_s16
( -1 ) );

726 
öt16x4_t
 
tmp1_s16x4
, 
tmp2_s16x4
;

728 
q1_Q10_s16x4
 = 
	`vshl_n_s16
–
q1_Q0_s16x4
, 10 );

729 
tmp1_s16x4
 = 
	`vadd_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
–
off£t_Q10
 - 
QUANT_LEVEL_ADJUST_Q10
 ) );

730 
q1_Q10_s16x4
 = 
	`vadd_s16
–q1_Q10_s16x4, 
	`vdup_n_s16
–
off£t_Q10
 + 
QUANT_LEVEL_ADJUST_Q10
 ) );

731 
q1_Q10_s16x4
 = 
	`vb¶_s16
–
ÀssTh™Möus1_u16x4
, q1_Q10_s16x4, 
tmp1_s16x4
 );

732 
q1_Q10_s16x4
 = 
	`vb¶_s16
–
equÆ0_u16x4
, 
	`vdup_n_s16
–
off£t_Q10
 ), q1_Q10_s16x4 );

733 
q1_Q10_s16x4
 = 
	`vb¶_s16
–
equÆMöus1_u16x4
, 
	`vdup_n_s16
–
off£t_Q10
 - ( 1024 - 
QUANT_LEVEL_ADJUST_Q10
 ) ), q1_Q10_s16x4 );

734 
q2_Q10_s16x4
 = 
	`vadd_s16
–
q1_Q10_s16x4
, 
	`vdup_n_s16
( 1024 ) );

735 
q2_Q10_s16x4
 = 
	`vb¶_s16
–
equÆ0_u16x4
, 
	`vdup_n_s16
–
off£t_Q10
 + 1024 - 
QUANT_LEVEL_ADJUST_Q10
 ), q2_Q10_s16x4 );

736 
q2_Q10_s16x4
 = 
	`vb¶_s16
–
equÆMöus1_u16x4
, 
	`vdup_n_s16
–
off£t_Q10
 ), q2_Q10_s16x4 );

737 
tmp1_s16x4
 = 
q1_Q10_s16x4
;

738 
tmp2_s16x4
 = 
q2_Q10_s16x4
;

739 
tmp1_s16x4
 = 
	`vb¶_s16
–
	`v‹r_u16
–
equÆMöus1_u16x4
, 
ÀssTh™Möus1_u16x4
 ), 
	`v√g_s16
(Åmp1_s16x4 ),Åmp1_s16x4 );

740 
tmp2_s16x4
 = 
	`vb¶_s16
–
ÀssTh™Möus1_u16x4
, 
	`v√g_s16
(Åmp2_s16x4 ),Åmp2_s16x4 );

741 
rd1_Q10_s32x4
 = 
	`vmuŒ_s16
–
tmp1_s16x4
, 
	`vdup_n_s16
–
Lambda_Q10
 ) );

742 
rd2_Q10_s32x4
 = 
	`vmuŒ_s16
–
tmp2_s16x4
, 
	`vdup_n_s16
–
Lambda_Q10
 ) );

745 
º_Q10_s16x4
 = 
	`vsub_s16
–
r_Q10_s16x4
, 
q1_Q10_s16x4
 );

746 
rd1_Q10_s32x4
 = 
	`vmœl_s16
–rd1_Q10_s32x4, 
º_Q10_s16x4
,Ñr_Q10_s16x4 );

747 
rd1_Q10_s32x4
 = 
	`vshrq_n_s32
(Ñd1_Q10_s32x4, 10 );

749 
º_Q10_s16x4
 = 
	`vsub_s16
–
r_Q10_s16x4
, 
q2_Q10_s16x4
 );

750 
rd2_Q10_s32x4
 = 
	`vmœl_s16
–rd2_Q10_s32x4, 
º_Q10_s16x4
,Ñr_Q10_s16x4 );

751 
rd2_Q10_s32x4
 = 
	`vshrq_n_s32
(Ñd2_Q10_s32x4, 10 );

753 
tmp2_s32x4
 = 
	`vld1q_s32
–
psDñDec
->
RD_Q10
 );

754 
tmp1_s32x4
 = 
	`vaddq_s32
–
tmp2_s32x4
, 
	`vmöq_s32
–
rd1_Q10_s32x4
, 
rd2_Q10_s32x4
 ) );

755 
tmp2_s32x4
 = 
	`vaddq_s32
–tmp2_s32x4, 
	`vmaxq_s32
–
rd1_Q10_s32x4
, 
rd2_Q10_s32x4
 ) );

756 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
RD_Q10
, 
tmp1_s32x4
 );

757 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
RD_Q10
, 
tmp2_s32x4
 );

758 
t_u32x4
 = 
	`v˛tq_s32
–
rd1_Q10_s32x4
, 
rd2_Q10_s32x4
 );

759 
tmp1_s32x4
 = 
	`vb¶q_s32
–
t_u32x4
, 
	`vmovl_s16
–
q1_Q10_s16x4
 ), vmovl_s16–
q2_Q10_s16x4
 ) );

760 
tmp2_s32x4
 = 
	`vb¶q_s32
–
t_u32x4
, 
	`vmovl_s16
–
q2_Q10_s16x4
 ), vmovl_s16–
q1_Q10_s16x4
 ) );

761 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
Q_Q10
, 
tmp1_s32x4
 );

762 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
Q_Q10
, 
tmp2_s32x4
 );

767 
öt32x4_t
 
exc_Q14_s32x4
, 
LPC_exc_Q14_s32x4
, 
xq_Q14_s32x4
, 
sLF_AR_shp_Q14_s32x4
;

770 
exc_Q14_s32x4
 = 
	`vshlq_n_s32
–
tmp1_s32x4
, 4 );

771 
exc_Q14_s32x4
 = 
	`ve‹q_s32
–exc_Q14_s32x4, 
sign_s32x4
 );

772 
exc_Q14_s32x4
 = 
	`vsubq_s32
–exc_Q14_s32x4, 
sign_s32x4
 );

775 
LPC_exc_Q14_s32x4
 = 
	`vaddq_s32
–
exc_Q14_s32x4
, 
	`vdupq_n_s32
–
LTP_¥ed_Q14
 ) );

776 
xq_Q14_s32x4
 = 
	`vaddq_s32
–
LPC_exc_Q14_s32x4
, 
LPC_¥ed_Q14_s32x4
 );

779 
tmp1_s32x4
 = 
	`vsubq_s32
–
xq_Q14_s32x4
, 
	`vshlq_n_s32
–
	`vdupq_n_s32
–
x_Q10
[ 
i
 ] ), 4 ) );

780 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
Diff_Q14
, 
tmp1_s32x4
 );

781 
sLF_AR_shp_Q14_s32x4
 = 
	`vsubq_s32
–
tmp1_s32x4
, 
n_AR_Q14_s32x4
 );

782 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
sLTP_shp_Q14
, 
	`vsubq_s32
–
sLF_AR_shp_Q14_s32x4
, 
n_LF_Q14_s32x4
 ) );

783 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
LF_AR_Q14
, 
sLF_AR_shp_Q14_s32x4
 );

784 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
LPC_exc_Q14
, 
LPC_exc_Q14_s32x4
 );

785 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
xq_Q14
, 
xq_Q14_s32x4
 );

788 
exc_Q14_s32x4
 = 
	`vshlq_n_s32
–
tmp2_s32x4
, 4 );

789 
exc_Q14_s32x4
 = 
	`ve‹q_s32
–exc_Q14_s32x4, 
sign_s32x4
 );

790 
exc_Q14_s32x4
 = 
	`vsubq_s32
–exc_Q14_s32x4, 
sign_s32x4
 );

793 
LPC_exc_Q14_s32x4
 = 
	`vaddq_s32
–
exc_Q14_s32x4
, 
	`vdupq_n_s32
–
LTP_¥ed_Q14
 ) );

794 
xq_Q14_s32x4
 = 
	`vaddq_s32
–
LPC_exc_Q14_s32x4
, 
LPC_¥ed_Q14_s32x4
 );

797 
tmp1_s32x4
 = 
	`vsubq_s32
–
xq_Q14_s32x4
, 
	`vshlq_n_s32
–
	`vdupq_n_s32
–
x_Q10
[ 
i
 ] ), 4 ) );

798 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
Diff_Q14
, 
tmp1_s32x4
 );

799 
sLF_AR_shp_Q14_s32x4
 = 
	`vsubq_s32
–
tmp1_s32x4
, 
n_AR_Q14_s32x4
 );

800 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
sLTP_shp_Q14
, 
	`vsubq_s32
–
sLF_AR_shp_Q14_s32x4
, 
n_LF_Q14_s32x4
 ) );

801 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
LF_AR_Q14
, 
sLF_AR_shp_Q14_s32x4
 );

802 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
LPC_exc_Q14
, 
LPC_exc_Q14_s32x4
 );

803 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
xq_Q14
, 
xq_Q14_s32x4
 );

806 *
sm∂_buf_idx
 = *sm∂_buf_idx ? ( *sm∂_buf_idx - 1 ) : ( 
DECISION_DELAY
 - 1);

807 
œ°_sm∂e_idx
 = *
sm∂_buf_idx
 + 
decisi⁄Dñay
 + 
DECISION_DELAY
;

808 if–
œ°_sm∂e_idx
 >
DECISION_DELAY
 )Üast_smple_idx -= DECISION_DELAY;

809 if–
œ°_sm∂e_idx
 >
DECISION_DELAY
 )Üast_smple_idx -= DECISION_DELAY;

812 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ].
RD_Q10
[ 0 ];

813 
Wö√r_öd
 = 0;

814  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

815 if–
psSam∂eSèã
[ 0 ].
RD_Q10
[ 
k
 ] < 
RDmö_Q10
 ) {

816 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ].
RD_Q10
[ 
k
 ];

817 
Wö√r_öd
 = 
k
;

823 
uöt32x4_t
 
t_u32x4
;

824 
Wö√r_ønd_°©e
 = 
psDñDec
->
R™dSèã
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ];

825 
t_u32x4
 = 
	`v˚qq_s32
–
	`vld1q_s32
–
psDñDec
->
R™dSèã
[ 
œ°_sm∂e_idx
 ] ), 
	`vdupq_n_s32
–
Wö√r_ønd_°©e
 ) );

826 
t_u32x4
 = 
	`vmvnq_u32
(Å_u32x4 );

827 
t_u32x4
 = 
	`vshrq_n_u32
(Å_u32x4, 5 );

828 
tmp1_s32x4
 = 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
RD_Q10
 );

829 
tmp2_s32x4
 = 
	`vld1q_s32
–
psSam∂eSèã
[ 1 ].
RD_Q10
 );

830 
tmp1_s32x4
 = 
	`vaddq_s32
–tmp1_s32x4, 
	`vªöãΩªtq_s32_u32
–
t_u32x4
 ) );

831 
tmp2_s32x4
 = 
	`vaddq_s32
–tmp2_s32x4, 
	`vªöãΩªtq_s32_u32
–
t_u32x4
 ) );

832 
	`v°1q_s32
–
psSam∂eSèã
[ 0 ].
RD_Q10
, 
tmp1_s32x4
 );

833 
	`v°1q_s32
–
psSam∂eSèã
[ 1 ].
RD_Q10
, 
tmp2_s32x4
 );

836 
RDmax_Q10
 = 
psSam∂eSèã
[ 0 ].
RD_Q10
[ 0 ];

837 
RDmö_Q10
 = 
psSam∂eSèã
[ 1 ].
RD_Q10
[ 0 ];

838 
RDmax_öd
 = 0;

839 
RDmö_öd
 = 0;

840  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

842 if–
psSam∂eSèã
[ 0 ].
RD_Q10
[ 
k
 ] > 
RDmax_Q10
 ) {

843 
RDmax_Q10
 = 
psSam∂eSèã
[ 0 ].
RD_Q10
[ 
k
 ];

844 
RDmax_öd
 = 
k
;

847 if–
psSam∂eSèã
[ 1 ].
RD_Q10
[ 
k
 ] < 
RDmö_Q10
 ) {

848 
RDmö_Q10
 = 
psSam∂eSèã
[ 1 ].
RD_Q10
[ 
k
 ];

849 
RDmö_öd
 = 
k
;

855 if–
RDmö_Q10
 < 
RDmax_Q10
 ) {

856 
	`›us_öt32
 (*
±r
)[
NEON_MAX_DEL_DEC_STATES
] = 
psDñDec
->
R™dSèã
;

857 c⁄° 
numOthîs
 = ()–––
NSQ_dñ_decs_°ru˘
 ) - ––(NSQ_dñ_decs_°ru˘ *)0 )->
sLPC_Q14
 ) )

858 / ( 
NEON_MAX_DEL_DEC_STATES
 * –
›us_öt32
 ) ) );

862  
j
 = 
i
 + 1; j < i + 
NSQ_LPC_BUF_LENGTH
; j++ ) {

863 
psDñDec
->
sLPC_Q14
[ 
j
 ][ 
RDmax_öd
 ] =ÖsDñDec->sLPC_Q14[ j ][ 
RDmö_öd
 ];

865  
j
 = 0; j < 
numOthîs
; j++ ) {

866 
±r
[ 
j
 ][ 
RDmax_öd
 ] =Öå[ j ][ 
RDmö_öd
 ];

869 
psSam∂eSèã
[ 0 ].
Q_Q10
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].Q_Q10[ 
RDmö_öd
 ];

870 
psSam∂eSèã
[ 0 ].
RD_Q10
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].RD_Q10[ 
RDmö_öd
 ];

871 
psSam∂eSèã
[ 0 ].
xq_Q14
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].xq_Q14[ 
RDmö_öd
 ];

872 
psSam∂eSèã
[ 0 ].
LF_AR_Q14
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].LF_AR_Q14[ 
RDmö_öd
 ];

873 
psSam∂eSèã
[ 0 ].
Diff_Q14
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].Diff_Q14[ 
RDmö_öd
 ];

874 
psSam∂eSèã
[ 0 ].
sLTP_shp_Q14
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].sLTP_shp_Q14[ 
RDmö_öd
 ];

875 
psSam∂eSèã
[ 0 ].
LPC_exc_Q14
[ 
RDmax_öd
 ] =ÖsSam∂eSèã[ 1 ].LPC_exc_Q14[ 
RDmö_öd
 ];

879 if–
sub‰
 > 0 || 
i
 >
decisi⁄Dñay
 ) {

880 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDñDec
->
Q_Q10
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 10 );

881 
xq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

882 
	`sûk_SMULWW
–
psDñDec
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ], 
dñayedGaö_Q10
[Üast_smple_idx ] ), 8 ) );

883 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDñDec
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ];

884 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDñDec
->
Pªd_Q15
[ 
œ°_sm∂e_idx
 ][ 
Wö√r_öd
 ];

886 
NSQ
->
sLTP_shp_buf_idx
++;

887 
NSQ
->
sLTP_buf_idx
++;

890 
	`v°1q_s32
–
psDñDec
->
LF_AR_Q14
, 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].LF_AR_Q14 ) );

891 
	`v°1q_s32
–
psDñDec
->
Diff_Q14
, 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].Diff_Q14 ) );

892 
	`v°1q_s32
–
psDñDec
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 + 
i
 ], 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
xq_Q14
 ) );

893 
	`v°1q_s32
–
psDñDec
->
Xq_Q14
[ *
sm∂_buf_idx
 ], 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
xq_Q14
 ) );

894 
tmp1_s32x4
 = 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
Q_Q10
 );

895 
	`v°1q_s32
–
psDñDec
->
Q_Q10
[ *
sm∂_buf_idx
 ], 
tmp1_s32x4
 );

896 
	`v°1q_s32
–
psDñDec
->
Pªd_Q15
[ *
sm∂_buf_idx
 ], 
	`vshlq_n_s32
–
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
LPC_exc_Q14
 ), 1 ) );

897 
	`v°1q_s32
–
psDñDec
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ], 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].
sLTP_shp_Q14
 ) );

898 
tmp1_s32x4
 = 
	`vrshrq_n_s32
(Åmp1_s32x4, 10 );

899 
tmp1_s32x4
 = 
	`vaddq_s32
–
	`vld1q_s32
–
psDñDec
->
Sìd
 ),Åmp1_s32x4 );

900 
	`v°1q_s32
–
psDñDec
->
Sìd
, 
tmp1_s32x4
 );

901 
	`v°1q_s32
–
psDñDec
->
R™dSèã
[ *
sm∂_buf_idx
 ], 
tmp1_s32x4
 );

902 
	`v°1q_s32
–
psDñDec
->
RD_Q10
, 
	`vld1q_s32
–
psSam∂eSèã
[ 0 ].RD_Q10 ) );

903 
dñayedGaö_Q10
[ *
sm∂_buf_idx
 ] = 
Gaö_Q10
;

906 
	`sûk_mem˝y
–
psDñDec
->
sLPC_Q14
[ 0 ],ÖsDñDec->sLPC_Q14[ 
Àngth
 ], 
NEON_MAX_DEL_DEC_STATES
 * 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

908 
RESTORE_STACK
;

909 
	}
}

911 
OPUS_INLINE
 
	$sûk_SMULWB_8_√⁄
(

912 c⁄° 
›us_öt16
 *
a
,

913 c⁄° 
öt32x2_t
 
b
,

914 
›us_öt32
 *
o


917 c⁄° 
öt16x8_t
 
a_s16x8
 = 
	`vld1q_s16
–
a
 );

918 
öt32x4_t
 
o0_s32x4
, 
o1_s32x4
;

920 
o0_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_low_s16
–
a_s16x8
 ), 15 );

921 
o1_s32x4
 = 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
a_s16x8
 ), 15 );

922 
o0_s32x4
 = 
	`vqdmulhq_œ√_s32
–o0_s32x4, 
b
, 0 );

923 
o1_s32x4
 = 
	`vqdmulhq_œ√_s32
–o1_s32x4, 
b
, 0 );

924 
	`v°1q_s32
–
o
, 
o0_s32x4
 );

925 
	`v°1q_s32
–
o
 + 4, 
o1_s32x4
 );

926 
	}
}

929 
OPUS_INLINE
 
	$sûk_SMULWW_smÆl_b_4_√⁄
(

930 
›us_öt32
 *
a
,

931 c⁄° 
öt32x2_t
 
b_s32x2
)

933 
öt32x4_t
 
o_s32x4
;

935 
o_s32x4
 = 
	`vld1q_s32
–
a
 );

936 
o_s32x4
 = 
	`vqdmulhq_œ√_s32
–o_s32x4, 
b_s32x2
, 0 );

937 
	`v°1q_s32
–
a
, 
o_s32x4
 );

938 
	}
}

941 
OPUS_INLINE
 
	$sûk_SMULWW_smÆl_b_8_√⁄
(

942 
›us_öt32
 *
a
,

943 c⁄° 
öt32x2_t
 
b_s32x2


946 
öt32x4_t
 
o0_s32x4
, 
o1_s32x4
;

948 
o0_s32x4
 = 
	`vld1q_s32
–
a
 );

949 
o1_s32x4
 = 
	`vld1q_s32
–
a
 + 4 );

950 
o0_s32x4
 = 
	`vqdmulhq_œ√_s32
–o0_s32x4, 
b_s32x2
, 0 );

951 
o1_s32x4
 = 
	`vqdmulhq_œ√_s32
–o1_s32x4, 
b_s32x2
, 0 );

952 
	`v°1q_s32
–
a
, 
o0_s32x4
 );

953 
	`v°1q_s32
–
a
 + 4, 
o1_s32x4
 );

954 
	}
}

956 
OPUS_INLINE
 
	$sûk_SMULWW_4_√⁄
(

957 
›us_öt32
 *
a
,

958 c⁄° 
öt32x2_t
 
b_s32x2
)

960 
öt32x4_t
 
a_s32x4
, 
o_s32x4
;

962 
a_s32x4
 = 
	`vld1q_s32
–
a
 );

963 
o_s32x4
 = 
	`vqdmulhq_œ√_s32
–
a_s32x4
, 
b_s32x2
, 0 );

964 
o_s32x4
 = 
	`vmœq_œ√_s32
–o_s32x4, 
a_s32x4
, 
b_s32x2
, 1 );

965 
	`v°1q_s32
–
a
, 
o_s32x4
 );

966 
	}
}

968 
OPUS_INLINE
 
	$sûk_SMULWW_8_√⁄
(

969 
›us_öt32
 *
a
,

970 c⁄° 
öt32x2_t
 
b_s32x2


973 
öt32x4_t
 
a0_s32x4
, 
a1_s32x4
, 
o0_s32x4
, 
o1_s32x4
;

975 
a0_s32x4
 = 
	`vld1q_s32
–
a
 );

976 
a1_s32x4
 = 
	`vld1q_s32
–
a
 + 4 );

977 
o0_s32x4
 = 
	`vqdmulhq_œ√_s32
–
a0_s32x4
, 
b_s32x2
, 0 );

978 
o1_s32x4
 = 
	`vqdmulhq_œ√_s32
–
a1_s32x4
, 
b_s32x2
, 0 );

979 
o0_s32x4
 = 
	`vmœq_œ√_s32
–o0_s32x4, 
a0_s32x4
, 
b_s32x2
, 1 );

980 
o1_s32x4
 = 
	`vmœq_œ√_s32
–o1_s32x4, 
a1_s32x4
, 
b_s32x2
, 1 );

981 
	`v°1q_s32
–
a
, 
o0_s32x4
 );

982 
	`v°1q_s32
–
a
 + 4, 
o1_s32x4
 );

983 
	}
}

985 
OPUS_INLINE
 
	$sûk_SMULWW_lo›_√⁄
(

986 c⁄° 
›us_öt16
 *
a
,

987 c⁄° 
›us_öt32
 
b
,

988 
›us_öt32
 *
o
,

989 c⁄° 
›us_öt
 
lo›_num


992 
›us_öt
 
i
;

993 
öt32x2_t
 
b_s32x2
;

995 
b_s32x2
 = 
	`vdup_n_s32
–
b
 );

996  
i
 = 0; i < 
lo›_num
 - 7; i += 8 ) {

997 
	`sûk_SMULWB_8_√⁄
–
a
 + 
i
, 
b_s32x2
, 
o
 + i );

999  ; 
i
 < 
lo›_num
; i++ ) {

1000 
o
[ 
i
 ] = 
	`sûk_SMULWW
–
a
[ i ], 
b
 );

1002 
	}
}

1004 
OPUS_INLINE
 
	$sûk_nsq_dñ_dec_sˇÀ_°©es_√⁄
(

1005 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

1006 
sûk_nsq_°©e
 *
NSQ
,

1007 
NSQ_dñ_decs_°ru˘
 
psDñDec
[],

1008 c⁄° 
›us_öt16
 
x16
[],

1009 
›us_öt32
 
x_sc_Q10
[],

1010 c⁄° 
›us_öt16
 
sLTP
[],

1011 
›us_öt32
 
sLTP_Q15
[],

1012 
›us_öt
 
sub‰
,

1013 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

1014 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

1015 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

1016 c⁄° 
›us_öt
 
sig«l_ty≥
,

1017 c⁄° 
›us_öt
 
decisi⁄Dñay


1020 
›us_öt
 
i
, 
œg
;

1021 
›us_öt32
 
gaö_adj_Q16
, 
öv_gaö_Q31
, 
öv_gaö_Q26
;

1023 
œg
 = 
pôchL
[ 
sub‰
 ];

1024 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
	`sûk_max
–
Gaös_Q16
[ 
sub‰
 ], 1 ), 47 );

1025 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

1028 
öv_gaö_Q26
 = 
	`sûk_RSHIFT_ROUND
–
öv_gaö_Q31
, 5 );

1029 
	`sûk_SMULWW_lo›_√⁄
–
x16
, 
öv_gaö_Q26
, 
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
 );

1032 if–
NSQ
->
ªwhôe_Êag
 ) {

1033 if–
sub‰
 == 0 ) {

1035 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
LTP_sˇÀ_Q14
 ), 2 );

1037 
	`sûk_SMULWW_lo›_√⁄
–
sLTP
 + 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2, 
öv_gaö_Q31
, 
sLTP_Q15
 + NSQ->sLTP_buf_idx -Üag - LTP_ORDER / 2,Üag + LTP_ORDER / 2 );

1041 if–
Gaös_Q16
[ 
sub‰
 ] !
NSQ
->
¥ev_gaö_Q16
 ) {

1042 
öt32x2_t
 
gaö_adj_Q16_s32x2
;

1043 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
NSQ
->
¥ev_gaö_Q16
, 
Gaös_Q16
[ 
sub‰
 ], 16 );

1046 if––
gaö_adj_Q16
 >= -65536 ) && ( gain_adj_Q16 < 65536 ) ) {

1047 
gaö_adj_Q16_s32x2
 = 
	`vdup_n_s32
–
	`sûk_LSHIFT32
–
gaö_adj_Q16
, 15 ) );

1048  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx - 7; i += 8 ) {

1049 
	`sûk_SMULWW_smÆl_b_8_√⁄
–
NSQ
->
sLTP_shp_Q14
 + 
i
, 
gaö_adj_Q16_s32x2
 );

1051  ; 
i
 < 
NSQ
->
sLTP_shp_buf_idx
; i++ ) {

1052 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

1056 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

1057  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx - 
decisi⁄Dñay
 - 7; i += 8 ) {

1058 
	`sûk_SMULWW_smÆl_b_8_√⁄
–
sLTP_Q15
 + 
i
, 
gaö_adj_Q16_s32x2
 );

1060  ; 
i
 < 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
; i++ ) {

1061 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

1066 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
LF_AR_Q14
, 
gaö_adj_Q16_s32x2
 );

1067 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
Diff_Q14
, 
gaö_adj_Q16_s32x2
 );

1070  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

1071 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
sLPC_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1074  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

1075 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
sAR2_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1078  
i
 = 0; i < 
DECISION_DELAY
; i++ ) {

1079 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
Pªd_Q15
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1080 
	`sûk_SMULWW_smÆl_b_4_√⁄
–
psDñDec
->
Sh≠e_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1083 
gaö_adj_Q16_s32x2
 = 
	`vdup_n_s32
–
	`sûk_LSHIFT32
–
gaö_adj_Q16
 & 0x0000FFFF, 15 ) );

1084 
gaö_adj_Q16_s32x2
 = 
	`v£t_œ√_s32
–
gaö_adj_Q16
 >> 16, gain_adj_Q16_s32x2, 1 );

1085  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx - 7; i += 8 ) {

1086 
	`sûk_SMULWW_8_√⁄
–
NSQ
->
sLTP_shp_Q14
 + 
i
, 
gaö_adj_Q16_s32x2
 );

1088  ; 
i
 < 
NSQ
->
sLTP_shp_buf_idx
; i++ ) {

1089 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

1093 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

1094  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx - 
decisi⁄Dñay
 - 7; i += 8 ) {

1095 
	`sûk_SMULWW_8_√⁄
–
sLTP_Q15
 + 
i
, 
gaö_adj_Q16_s32x2
 );

1097  ; 
i
 < 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
; i++ ) {

1098 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

1103 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
LF_AR_Q14
, 
gaö_adj_Q16_s32x2
 );

1104 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
Diff_Q14
, 
gaö_adj_Q16_s32x2
 );

1107  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

1108 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
sLPC_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1111  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

1112 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
sAR2_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1115  
i
 = 0; i < 
DECISION_DELAY
; i++ ) {

1116 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
Pªd_Q15
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1117 
	`sûk_SMULWW_4_√⁄
–
psDñDec
->
Sh≠e_Q14
[ 
i
 ], 
gaö_adj_Q16_s32x2
 );

1122 
NSQ
->
¥ev_gaö_Q16
 = 
Gaös_Q16
[ 
sub‰
 ];

1124 
	}
}

	@silk/arm/NSQ_neon.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~"c⁄fig.h
"

31 
	~<¨m_√⁄.h
>

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"NSQ.h
"

35 
	~"˚…/˝u_suµ‹t.h
"

36 
	~"˚…/¨m/¨m˝u.h
"

38 
›us_öt32
 
	$sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄
(c⁄° 
›us_öt32
 *
buf32
, c⁄° opus_öt32 *
c€f32
, 
›us_öt
 
‹dî
)

40 
öt32x4_t
 
c€f0
 = 
	`vld1q_s32
(
c€f32
);

41 
öt32x4_t
 
c€f1
 = 
	`vld1q_s32
(
c€f32
 + 4);

42 
öt32x4_t
 
c€f2
 = 
	`vld1q_s32
(
c€f32
 + 8);

43 
öt32x4_t
 
c€f3
 = 
	`vld1q_s32
(
c€f32
 + 12);

45 
öt32x4_t
 
a0
 = 
	`vld1q_s32
(
buf32
 - 15);

46 
öt32x4_t
 
a1
 = 
	`vld1q_s32
(
buf32
 - 11);

47 
öt32x4_t
 
a2
 = 
	`vld1q_s32
(
buf32
 - 7);

48 
öt32x4_t
 
a3
 = 
	`vld1q_s32
(
buf32
 - 3);

50 
öt32x4_t
 
b0
 = 
	`vqdmulhq_s32
(
c€f0
, 
a0
);

51 
öt32x4_t
 
b1
 = 
	`vqdmulhq_s32
(
c€f1
, 
a1
);

52 
öt32x4_t
 
b2
 = 
	`vqdmulhq_s32
(
c€f2
, 
a2
);

53 
öt32x4_t
 
b3
 = 
	`vqdmulhq_s32
(
c€f3
, 
a3
);

55 
öt32x4_t
 
c0
 = 
	`vaddq_s32
(
b0
, 
b1
);

56 
öt32x4_t
 
c1
 = 
	`vaddq_s32
(
b2
, 
b3
);

58 
öt32x4_t
 
d
 = 
	`vaddq_s32
(
c0
, 
c1
);

60 
öt64x2_t
 
e
 = 
	`v∑ddlq_s32
(
d
);

62 
öt64x1_t
 
f
 = 
	`vadd_s64
(
	`vgë_low_s64
(
e
), 
	`vgë_high_s64
(e));

64 
›us_öt32
 
out
 = 
	`vgë_œ√_s32
(
	`vªöãΩªt_s32_s64
(
f
), 0);

66 
out
 +
	`sûk_RSHIFT
–
‹dî
, 1 );

68  
out
;

69 
	}
}

72 
›us_öt32
 
	$sûk_NSQ_noi£_sh≠e_„edback_lo›_√⁄
(c⁄° 
›us_öt32
 *
d©a0
, opus_öt32 *
d©a1
, c⁄° 
›us_öt16
 *
c€f
, 
›us_öt
 
‹dî
)

74 
›us_öt32
 
out
;

75 i‡(
‹dî
 == 8)

77 
öt32x4_t
 
a00
 = 
	`vdupq_n_s32
(
d©a0
[0]);

78 
öt32x4_t
 
a01
 = 
	`vld1q_s32
(
d©a1
);

80 
öt32x4_t
 
a0
 = 
	`vextq_s32
 (
a00
, 
a01
, 3);

81 
öt32x4_t
 
a1
 = 
	`vld1q_s32
(
d©a1
 + 3);

85 
öt16x8_t
 
c€f16
 = 
	`vld1q_s16
(
c€f
);

86 
öt32x4_t
 
c€f0
 = 
	`vmovl_s16
(
	`vgë_low_s16
(
c€f16
));

87 
öt32x4_t
 
c€f1
 = 
	`vmovl_s16
(
	`vgë_high_s16
(
c€f16
));

97 
öt64x2_t
 
b0
 = 
	`vmuŒ_s32
(
	`vgë_low_s32
(
a0
), vgë_low_s32(
c€f0
));

98 
öt64x2_t
 
b1
 = 
	`vmœl_s32
(
b0
, 
	`vgë_high_s32
(
a0
), vgë_high_s32(
c€f0
));

99 
öt64x2_t
 
b2
 = 
	`vmœl_s32
(
b1
, 
	`vgë_low_s32
(
a1
), vgë_low_s32(
c€f1
));

100 
öt64x2_t
 
b3
 = 
	`vmœl_s32
(
b2
, 
	`vgë_high_s32
(
a1
), vgë_high_s32(
c€f1
));

102 
öt64x1_t
 
c
 = 
	`vadd_s64
(
	`vgë_low_s64
(
b3
), 
	`vgë_high_s64
(b3));

103 
öt64x1_t
 
cS
 = 
	`vrshr_n_s64
(
c
, 15);

104 
öt32x2_t
 
d
 = 
	`vªöãΩªt_s32_s64
(
cS
);

106 
out
 = 
	`vgë_œ√_s32
(
d
, 0);

107 
	`v°1q_s32
(
d©a1
, 
a0
);

108 
	`v°1q_s32
(
d©a1
 + 4, 
a1
);

109  
out
;

111  
	`sûk_NSQ_noi£_sh≠e_„edback_lo›_c
(
d©a0
, 
d©a1
, 
c€f
, 
‹dî
);

112 
	}
}

	@silk/arm/NSQ_neon.h

27 #i‚de‡
SILK_NSQ_NEON_H


28 
	#SILK_NSQ_NEON_H


	)

30 
	~"˝u_suµ‹t.h
"

31 
	~"SigProc_FIX.h
"

33 #unde‡
sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f


35 
OPUS_INLINE
 
	$sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f_√⁄
(
›us_öt32
 *
out
, c⁄° 
›us_öt16
 *
ö
, 
›us_öt
 
‹dî
)

37 
out
[15] = 
	`sûk_LSHIFT32
(
ö
[0], 15);

38 
out
[14] = 
	`sûk_LSHIFT32
(
ö
[1], 15);

39 
out
[13] = 
	`sûk_LSHIFT32
(
ö
[2], 15);

40 
out
[12] = 
	`sûk_LSHIFT32
(
ö
[3], 15);

41 
out
[11] = 
	`sûk_LSHIFT32
(
ö
[4], 15);

42 
out
[10] = 
	`sûk_LSHIFT32
(
ö
[5], 15);

43 
out
[9] = 
	`sûk_LSHIFT32
(
ö
[6], 15);

44 
out
[8] = 
	`sûk_LSHIFT32
(
ö
[7], 15);

45 
out
[7] = 
	`sûk_LSHIFT32
(
ö
[8], 15);

46 
out
[6] = 
	`sûk_LSHIFT32
(
ö
[9], 15);

48 i‡(
‹dî
 == 16)

50 
out
[5] = 
	`sûk_LSHIFT32
(
ö
[10], 15);

51 
out
[4] = 
	`sûk_LSHIFT32
(
ö
[11], 15);

52 
out
[3] = 
	`sûk_LSHIFT32
(
ö
[12], 15);

53 
out
[2] = 
	`sûk_LSHIFT32
(
ö
[13], 15);

54 
out
[1] = 
	`sûk_LSHIFT32
(
ö
[14], 15);

55 
out
[0] = 
	`sûk_LSHIFT32
(
ö
[15], 15);

59 
out
[5] = 0;

60 
out
[4] = 0;

61 
out
[3] = 0;

62 
out
[2] = 0;

63 
out
[1] = 0;

64 
out
[0] = 0;

66 
	}
}

68 #i‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

70 
	#sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f
(
out
, 
ö
, 
‹dî
) \

71 (
	`sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f_√⁄
(
out
, 
ö
, 
‹dî
))

	)

73 #ñi‡
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

75 
	#sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f
(
out
, 
ö
, 
‹dî
) \

76 dÿ{ i‡(
¨ch
 =
OPUS_ARCH_ARM_NEON
Ë{ 
	`sûk_sh‹t_¥edi˘i⁄_¸óã_¨ch_c€f_√⁄
(
out
, 
ö
, 
‹dî
); } } 0)

	)

80 
›us_öt32
 
sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄
(c⁄° opus_öt32 *
buf32
, c⁄° opus_öt32 *
c€f32
, 
›us_öt
 
‹dî
);

82 
›us_öt32
 
sûk_NSQ_noi£_sh≠e_„edback_lo›_√⁄
(c⁄° opus_öt32 *
d©a0
, opus_öt32 *
d©a1
, c⁄° 
›us_öt16
 *
c€f
, 
›us_öt
 
‹dî
);

84 #i‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

85 #unde‡
sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄


86 
	#sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄
(
ö
, 
c€f
, 
c€fRev
, 
‹dî
, 
¨ch
) \

87 (()
¨ch
,
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄
(
ö
, 
c€fRev
, 
‹dî
))

	)

89 #unde‡
sûk_NSQ_noi£_sh≠e_„edback_lo›


90 
	#sûk_NSQ_noi£_sh≠e_„edback_lo›
(
d©a0
, 
d©a1
, 
c€f
, 
‹dî
, 
¨ch
Ë((Ôrch,
	`sûk_NSQ_noi£_sh≠e_„edback_lo›_√⁄
(d©a0, d©a1, c€f, ordî))

	)

92 #ñi‡
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

96 #unde‡
sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄


97 
	#sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄
(
ö
, 
c€f
, 
c€fRev
, 
‹dî
, 
¨ch
) \

98 (
¨ch
 =
OPUS_ARCH_ARM_NEON
 ? \

99 
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_√⁄
(
ö
, 
c€fRev
, 
‹dî
) : \

100 
	`sûk_noi£_sh≠e_qu™tizî_sh‹t_¥edi˘i⁄_c
(
ö
, 
c€f
, 
‹dî
))

	)

102 
›us_öt32


103 (*c⁄° 
SILK_NSQ_NOISE_SHAPE_FEEDBACK_LOOP_IMPL
[
OPUS_ARCHMASK
+1])(

104 c⁄° 
›us_öt32
 *
d©a0
, opus_öt32 *
d©a1
, c⁄° 
›us_öt16
 *
c€f
,

105 
›us_öt
 
‹dî
);

107 #unde‡
sûk_NSQ_noi£_sh≠e_„edback_lo›


108 
	#sûk_NSQ_noi£_sh≠e_„edback_lo›
(
d©a0
, 
d©a1
, 
c€f
, 
‹dî
, 
¨ch
) \

109 (
SILK_NSQ_NOISE_SHAPE_FEEDBACK_LOOP_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
](
d©a0
, 
d©a1
, \

110 
c€f
, 
‹dî
))

	)

	@silk/arm/SigProc_FIX_armv4.h

29 #i‚de‡
SILK_SIGPROC_FIX_ARMv4_H


30 
	#SILK_SIGPROC_FIX_ARMv4_H


	)

32 #unde‡
sûk_MLA


33 
OPUS_INLINE
 
›us_öt32
 
	$sûk_MLA_¨mv4
(
›us_öt32
 
a
, opus_öt32 
b
,

34 
›us_öt32
 
c
)

36 
›us_öt32
 
ªs
;

37 
	`__asm__
(

40 : "=&r"(
ªs
)

41 : "r"(
b
), "r"(
c
), "r"(
a
)

43  
ªs
;

44 
	}
}

45 
	#sûk_MLA
(
a
, 
b
, 
c
Ë(
	`sûk_MLA_¨mv4
◊, b, c))

	)

	@silk/arm/SigProc_FIX_armv5e.h

29 #i‚de‡
SILK_SIGPROC_FIX_ARMv5E_H


30 
	#SILK_SIGPROC_FIX_ARMv5E_H


	)

32 #unde‡
sûk_SMULTT


33 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULTT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

35 
›us_öt32
 
ªs
;

36 
	`__asm__
(

39 : "Ù"(
ªs
)

40 : "%r"(
a
), "r"(
b
)

42  
ªs
;

43 
	}
}

44 
	#sûk_SMULTT
(
a
, 
b
Ë(
	`sûk_SMULTT_¨mv5e
◊, b))

	)

46 #unde‡
sûk_SMLATT


47 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLATT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
,

48 
›us_öt32
 
c
)

50 
›us_öt32
 
ªs
;

51 
	`__asm__
(

54 : "Ù"(
ªs
)

55 : "%r"(
b
), "r"(
c
), "r"(
a
)

57  
ªs
;

58 
	}
}

59 
	#sûk_SMLATT
(
a
, 
b
, 
c
Ë(
	`sûk_SMLATT_¨mv5e
◊, b, c))

	)

	@silk/arm/arm_silk_map.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~"c⁄fig.h
"

31 
	~"maö_FIX.h
"

32 
	~"NSQ.h
"

33 
	~"SigProc_FIX.h
"

35 #i‡
deföed
(
OPUS_HAVE_RTCD
)

37 #i‡(
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
) && \

38 !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
))

40 (*c⁄° 
SILK_BIQUAD_ALT_STRIDE2_IMPL
[
OPUS_ARCHMASK
 + 1])(

41 c⁄° 
›us_öt16
 *
ö
,

42 c⁄° 
›us_öt32
 *
B_Q28
,

43 c⁄° 
›us_öt32
 *
A_Q28
,

44 
›us_öt32
 *
S
,

45 
›us_öt16
 *
out
,

46 c⁄° 
›us_öt32
 
Àn


48 
sûk_biquad_Æt_°ride2_c
,

49 
sûk_biquad_Æt_°ride2_c
,

50 
sûk_biquad_Æt_°ride2_c
,

51 
sûk_biquad_Æt_°ride2_√⁄
,

52 
	}
};

54 
›us_öt32
 (*c⁄° 
SILK_LPC_INVERSE_PRED_GAIN_IMPL
[
OPUS_ARCHMASK
 + 1])(

55 c⁄° 
›us_öt16
 *
	gA_Q12
,

56 c⁄° 
›us_öt
 
	g‹dî


58 
sûk_LPC_övî£_¥ed_gaö_c
,

59 
sûk_LPC_övî£_¥ed_gaö_c
,

60 
sûk_LPC_övî£_¥ed_gaö_c
,

61 
sûk_LPC_övî£_¥ed_gaö_√⁄
,

64 (*c⁄° 
	gSILK_NSQ_DEL_DEC_IMPL
[
OPUS_ARCHMASK
 + 1])(

65 c⁄° 
sûk_ícodî_°©e
 *
	gpsEncC
,

66 
sûk_nsq_°©e
 *
	gNSQ
,

67 
SideInfoIndi˚s
 *
	gpsIndi˚s
,

68 c⁄° 
›us_öt16
 
	gx16
[],

69 
›us_öt8
 
	gpul£s
[],

70 c⁄° 
›us_öt16
 
	gPªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

71 c⁄° 
›us_öt16
 
	gLTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

72 c⁄° 
›us_öt16
 
	gAR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

73 c⁄° 
›us_öt
 
	gH¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

74 c⁄° 
›us_öt
 
	gTût_Q14
[ 
MAX_NB_SUBFR
 ],

75 c⁄° 
›us_öt32
 
	gLF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

76 c⁄° 
›us_öt32
 
	gGaös_Q16
[ 
MAX_NB_SUBFR
 ],

77 c⁄° 
›us_öt
 
	gpôchL
[ 
MAX_NB_SUBFR
 ],

78 c⁄° 
›us_öt
 
	gLambda_Q10
,

79 c⁄° 
›us_öt
 
	gLTP_sˇÀ_Q14


81 
sûk_NSQ_dñ_dec_c
,

82 
sûk_NSQ_dñ_dec_c
,

83 
sûk_NSQ_dñ_dec_c
,

84 
sûk_NSQ_dñ_dec_√⁄
,

92 
	g›us_öt32


93 (*c⁄° 
	gSILK_NSQ_NOISE_SHAPE_FEEDBACK_LOOP_IMPL
[
OPUS_ARCHMASK
+1])(

94 c⁄° 
›us_öt32
 *
	gd©a0
, opus_öt32 *
	gd©a1
, c⁄° 
›us_öt16
 *
	gc€f
,

95 
›us_öt
 
	g‹dî
) = {

96 
sûk_NSQ_noi£_sh≠e_„edback_lo›_c
,

97 
sûk_NSQ_noi£_sh≠e_„edback_lo›_c
,

98 
sûk_NSQ_noi£_sh≠e_„edback_lo›_c
,

99 
sûk_NSQ_noi£_sh≠e_„edback_lo›_√⁄
,

104 #i‡
deföed
(
FIXED_POINT
) && \

105 
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !
	$deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

107 (*c⁄° 
SILK_WARPED_AUTOCORRELATION_FIX_IMPL
[
OPUS_ARCHMASK
 + 1])(

108 
›us_öt32
 *
c‹r
,

109 
›us_öt
 *
sˇÀ
,

110 c⁄° 
›us_öt16
 *
öput
,

111 c⁄° 
›us_öt
 
w¨pög_Q16
,

112 c⁄° 
›us_öt
 
Àngth
,

113 c⁄° 
›us_öt
 
‹dî


115 
sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
,

116 
sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
,

117 
sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
,

118 
sûk_w¨≥d_autoc‹ªœti⁄_FIX_√⁄
,

119 
	}
};

	@silk/arm/biquad_alt_arm.h

28 #i‚de‡
SILK_BIQUAD_ALT_ARM_H


29 
	#SILK_BIQUAD_ALT_ARM_H


	)

31 
	~"˚…/¨m/¨m˝u.h
"

33 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

34 
sûk_biquad_Æt_°ride2_√⁄
(

35 c⁄° 
›us_öt16
 *
ö
,

36 c⁄° 
›us_öt32
 *
B_Q28
,

37 c⁄° 
›us_öt32
 *
A_Q28
,

38 
›us_öt32
 *
S
,

39 
›us_öt16
 *
out
,

40 c⁄° 
›us_öt32
 
Àn


43 #i‡!
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_PRESUME_NEON
)

44 
	#OVERRIDE_sûk_biquad_Æt_°ride2
 (1)

	)

45 
	#sûk_biquad_Æt_°ride2
(
ö
, 
B_Q28
, 
A_Q28
, 
S
, 
out
, 
Àn
, 
¨ch
Ë(()◊rch), 
	`PRESUME_NEON
(
sûk_biquad_Æt_°ride2
)(ö, B_Q28, A_Q28, S, out,Üí))

	)

49 #i‡!
deföed
(
OVERRIDE_sûk_biquad_Æt_°ride2
)

51 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
))

52 (*c⁄° 
SILK_BIQUAD_ALT_STRIDE2_IMPL
[
OPUS_ARCHMASK
+1])(

53 c⁄° 
›us_öt16
 *
ö
,

54 c⁄° 
›us_öt32
 *
B_Q28
,

55 c⁄° 
›us_öt32
 *
A_Q28
,

56 
›us_öt32
 *
S
,

57 
›us_öt16
 *
out
,

58 c⁄° 
›us_öt32
 
Àn


60 
	#OVERRIDE_sûk_biquad_Æt_°ride2
 (1)

	)

61 
	#sûk_biquad_Æt_°ride2
(
ö
, 
B_Q28
, 
A_Q28
, 
S
, 
out
, 
Àn
, 
¨ch
Ë((*
SILK_BIQUAD_ALT_STRIDE2_IMPL
[◊rch)&
OPUS_ARCHMASK
])(ö, B_Q28, A_Q28, S, out,Üí))

	)

62 #ñi‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

63 
	#OVERRIDE_sûk_biquad_Æt_°ride2
 (1)

	)

64 
	#sûk_biquad_Æt_°ride2
(
ö
, 
B_Q28
, 
A_Q28
, 
S
, 
out
, 
Àn
, 
¨ch
Ë(()◊rch), 
	`sûk_biquad_Æt_°ride2_√⁄
(ö, B_Q28, A_Q28, S, out,Üí))

	)

	@silk/arm/biquad_alt_neon_intr.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<¨m_√⁄.h
>

33 #ifde‡
OPUS_CHECK_ASM


34 
	~<°rög.h
>

35 
	~"°ack_Æloc.h
"

37 
	~"SigProc_FIX.h
"

39 
ölöe
 
	$sûk_biquad_Æt_°ride2_kî√l
–c⁄° 
öt32x4_t
 
A_L_s32x4
, c⁄° i¡32x4_à
A_U_s32x4
, c⁄° i¡32x4_à
B_Q28_s32x4
, c⁄° 
öt32x2_t
 
t_s32x2
, c⁄° i¡32x4_à
ö_s32x4
, i¡32x4_à*
S_s32x4
, i¡32x2_à*
out32_Q14_s32x2
 )

41 
öt32x4_t
 
t_s32x4
, 
out32_Q14_s32x4
;

43 *
out32_Q14_s32x2
 = 
	`vadd_s32
–
	`vgë_low_s32
–*
S_s32x4
 ), 
t_s32x2
 );

44 *
S_s32x4
 = 
	`vcomböe_s32
–
	`vgë_high_s32
–*S_s32x4 ), 
	`vdup_n_s32
( 0 ) );

45 *
out32_Q14_s32x2
 = 
	`vshl_n_s32
( *out32_Q14_s32x2, 2 );

46 
out32_Q14_s32x4
 = 
	`vcomböe_s32
–*
out32_Q14_s32x2
, *out32_Q14_s32x2 );

47 
t_s32x4
 = 
	`vqdmulhq_s32
–
out32_Q14_s32x4
, 
A_L_s32x4
 );

48 *
S_s32x4
 = 
	`vr§aq_n_s32
–*S_s32x4, 
t_s32x4
, 14 );

49 
t_s32x4
 = 
	`vqdmulhq_s32
–
out32_Q14_s32x4
, 
A_U_s32x4
 );

50 *
S_s32x4
 = 
	`vaddq_s32
–*S_s32x4, 
t_s32x4
 );

51 
t_s32x4
 = 
	`vqdmulhq_s32
–
ö_s32x4
, 
B_Q28_s32x4
 );

52 *
S_s32x4
 = 
	`vaddq_s32
–*S_s32x4, 
t_s32x4
 );

53 
	}
}

55 
	$sûk_biquad_Æt_°ride2_√⁄
(

56 c⁄° 
›us_öt16
 *
ö
,

57 c⁄° 
›us_öt32
 *
B_Q28
,

58 c⁄° 
›us_öt32
 *
A_Q28
,

59 
›us_öt32
 *
S
,

60 
›us_öt16
 *
out
,

61 c⁄° 
›us_öt32
 
Àn


65 
›us_öt
 
k
 = 0;

66 c⁄° 
öt32x2_t
 
off£t_s32x2
 = 
	`vdup_n_s32
( (1<<14) - 1 );

67 c⁄° 
öt32x4_t
 
off£t_s32x4
 = 
	`vcomböe_s32
–
off£t_s32x2
, offset_s32x2 );

68 
öt16x4_t
 
ö_s16x4
 = 
	`vdup_n_s16
( 0 );

69 
öt16x4_t
 
out_s16x4
;

70 
öt32x2_t
 
A_Q28_s32x2
, 
A_L_s32x2
, 
A_U_s32x2
, 
B_Q28_s32x2
, 
t_s32x2
;

71 
öt32x4_t
 
A_L_s32x4
, 
A_U_s32x4
, 
B_Q28_s32x4
, 
S_s32x4
, 
out32_Q14_s32x4
;

72 
öt32x2x2_t
 
t0_s32x2x2
, 
t1_s32x2x2
, 
t2_s32x2x2
, 
S_s32x2x2
;

74 #ifde‡
OPUS_CHECK_ASM


75 
›us_öt32
 
S_c
[ 4 ];

76 
	`VARDECL
–
›us_öt16
, 
out_c
 );

77 
SAVE_STACK
;

78 
	`ALLOC
–
out_c
, 2 * 
Àn
, 
›us_öt16
 );

80 
	`sûk_mem˝y
–&
S_c
, 
S
, ( S_c ) );

81 
	`sûk_biquad_Æt_°ride2_c
–
ö
, 
B_Q28
, 
A_Q28
, 
S_c
, 
out_c
, 
Àn
 );

85 
A_Q28_s32x2
 = 
	`vld1_s32
–
A_Q28
 );

86 
A_Q28_s32x2
 = 
	`v√g_s32
( A_Q28_s32x2 );

87 
A_L_s32x2
 = 
	`vshl_n_s32
–
A_Q28_s32x2
, 18 );

88 
A_L_s32x2
 = 
	`vªöãΩªt_s32_u32
–
	`vshr_n_u32
–
	`vªöãΩªt_u32_s32
( A_L_s32x2 ), 3 ) );

89 
A_U_s32x2
 = 
	`vshr_n_s32
–
A_Q28_s32x2
, 14 );

90 
A_U_s32x2
 = 
	`vshl_n_s32
( A_U_s32x2, 16 );

91 
A_U_s32x2
 = 
	`vshr_n_s32
( A_U_s32x2, 1 );

93 
B_Q28_s32x2
 = 
	`vld1_s32
–
B_Q28
 );

94 
t_s32x2
 = 
	`vld1_s32
–
B_Q28
 + 1 );

95 
t0_s32x2x2
 = 
	`vzù_s32
–
A_L_s32x2
, A_L_s32x2 );

96 
t1_s32x2x2
 = 
	`vzù_s32
–
A_U_s32x2
, A_U_s32x2 );

97 
t2_s32x2x2
 = 
	`vzù_s32
–
t_s32x2
,Å_s32x2 );

98 
A_L_s32x4
 = 
	`vcomböe_s32
–
t0_s32x2x2
.
vÆ
[ 0 ],Å0_s32x2x2.val[ 1 ] );

99 
A_U_s32x4
 = 
	`vcomböe_s32
–
t1_s32x2x2
.
vÆ
[ 0 ],Å1_s32x2x2.val[ 1 ] );

100 
B_Q28_s32x4
 = 
	`vcomböe_s32
–
t2_s32x2x2
.
vÆ
[ 0 ],Å2_s32x2x2.val[ 1 ] );

101 
S_s32x4
 = 
	`vld1q_s32
–
S
 );

102 
S_s32x2x2
 = 
	`vån_s32
–
	`vgë_low_s32
–
S_s32x4
 ), 
	`vgë_high_s32
( S_s32x4 ) );

103 
S_s32x4
 = 
	`vcomböe_s32
–
S_s32x2x2
.
vÆ
[ 0 ], S_s32x2x2.val[ 1 ] );

105  ; 
k
 < 
Àn
 - 1; k += 2 ) {

106 
öt32x4_t
 
ö_s32x4
[ 2 ], 
t_s32x4
;

107 
öt32x2_t
 
out32_Q14_s32x2
[ 2 ];

110 
ö_s16x4
 = 
	`vld1_s16
–&
ö
[ 2 * 
k
 ] );

111 
ö_s32x4
[ 0 ] = 
	`vshŒ_n_s16
–
ö_s16x4
, 15 );

112 
t_s32x4
 = 
	`vqdmulhq_œ√_s32
–
ö_s32x4
[ 0 ], 
B_Q28_s32x2
, 0 );

113 
ö_s32x4
[ 1 ] = 
	`vcomböe_s32
–
	`vgë_high_s32
( in_s32x4[ 0 ] ), vget_high_s32( in_s32x4[ 0 ] ) );

114 
ö_s32x4
[ 0 ] = 
	`vcomböe_s32
–
	`vgë_low_s32
 ( in_s32x4[ 0 ] ), vget_low_s32 ( in_s32x4[ 0 ] ) );

115 
	`sûk_biquad_Æt_°ride2_kî√l
–
A_L_s32x4
, 
A_U_s32x4
, 
B_Q28_s32x4
, 
	`vgë_low_s32
 ( 
t_s32x4
 ), 
ö_s32x4
[ 0 ], &
S_s32x4
, &
out32_Q14_s32x2
[ 0 ] );

116 
	`sûk_biquad_Æt_°ride2_kî√l
–
A_L_s32x4
, 
A_U_s32x4
, 
B_Q28_s32x4
, 
	`vgë_high_s32
–
t_s32x4
 ), 
ö_s32x4
[ 1 ], &
S_s32x4
, &
out32_Q14_s32x2
[ 1 ] );

119 
out32_Q14_s32x4
 = 
	`vcomböe_s32
–
out32_Q14_s32x2
[ 0 ], out32_Q14_s32x2[ 1 ] );

120 
out32_Q14_s32x4
 = 
	`vaddq_s32
–out32_Q14_s32x4, 
off£t_s32x4
 );

121 
out_s16x4
 = 
	`vqsh∫_n_s32
–
out32_Q14_s32x4
, 14 );

122 
	`v°1_s16
–&
out
[ 2 * 
k
 ], 
out_s16x4
 );

126 if–
k
 < 
Àn
 ) {

127 
öt32x4_t
 
ö_s32x4
;

128 
öt32x2_t
 
out32_Q14_s32x2
;

131 
ö_s16x4
 = 
	`vld1_œ√_s16
–&
ö
[ 2 * 
k
 + 0 ], in_s16x4, 0 );

132 
ö_s16x4
 = 
	`vld1_œ√_s16
–&
ö
[ 2 * 
k
 + 1 ], in_s16x4, 1 );

133 
ö_s32x4
 = 
	`vshŒ_n_s16
–
ö_s16x4
, 15 );

134 
t_s32x2
 = 
	`vqdmulh_œ√_s32
–
	`vgë_low_s32
–
ö_s32x4
 ), 
B_Q28_s32x2
, 0 );

135 
ö_s32x4
 = 
	`vcomböe_s32
–
	`vgë_low_s32
( in_s32x4 ), vget_low_s32( in_s32x4 ) );

136 
	`sûk_biquad_Æt_°ride2_kî√l
–
A_L_s32x4
, 
A_U_s32x4
, 
B_Q28_s32x4
, 
t_s32x2
, 
ö_s32x4
, &
S_s32x4
, &
out32_Q14_s32x2
 );

139 
out32_Q14_s32x2
 = 
	`vadd_s32
–out32_Q14_s32x2, 
off£t_s32x2
 );

140 
out32_Q14_s32x4
 = 
	`vcomböe_s32
–
out32_Q14_s32x2
, out32_Q14_s32x2 );

141 
out_s16x4
 = 
	`vqsh∫_n_s32
–
out32_Q14_s32x4
, 14 );

142 
	`v°1_œ√_s16
–&
out
[ 2 * 
k
 + 0 ], 
out_s16x4
, 0 );

143 
	`v°1_œ√_s16
–&
out
[ 2 * 
k
 + 1 ], 
out_s16x4
, 1 );

146 
	`v°1q_œ√_s32
–&
S
[ 0 ], 
S_s32x4
, 0 );

147 
	`v°1q_œ√_s32
–&
S
[ 1 ], 
S_s32x4
, 2 );

148 
	`v°1q_œ√_s32
–&
S
[ 2 ], 
S_s32x4
, 1 );

149 
	`v°1q_œ√_s32
–&
S
[ 3 ], 
S_s32x4
, 3 );

151 #ifde‡
OPUS_CHECK_ASM


152 
	`sûk_as£π
–!
	`memcmp
–
S_c
, 
S
, ( S_c ) ) );

153 
	`sûk_as£π
–!
	`memcmp
–
out_c
, 
out
, 2 * 
Àn
 * –
›us_öt16
 ) ) );

154 
RESTORE_STACK
;

156 
	}
}

	@silk/arm/macros_arm64.h

28 #i‚de‡
SILK_MACROS_ARM64_H


29 
	#SILK_MACROS_ARM64_H


	)

31 
	~<¨m_√⁄.h
>

33 #unde‡
sûk_ADD_SAT32


34 
	#sûk_ADD_SAT32
(
a
, 
b
Ë(
	`vqadds_s32
(◊), (b)))

	)

36 #unde‡
sûk_SUB_SAT32


37 
	#sûk_SUB_SAT32
(
a
, 
b
Ë(
	`vqsubs_s32
(◊), (b)))

	)

	@silk/arm/macros_armv4.h

28 #i‚de‡
SILK_MACROS_ARMv4_H


29 
	#SILK_MACROS_ARMv4_H


	)

34 
	#SAFE_SHL
(
a
,
b
Ë((
›us_öt32
)((
›us_uöt32
)◊Ë<< (b)))

	)

37 #unde‡
sûk_SMULWB


38 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWB_¨mv4
(
›us_öt32
 
a
, 
›us_öt16
 
b
)

40 
rd_lo
;

41 
rd_hi
;

42 
	`__asm__
(

45 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

46 : "%r"(
a
), "r"(
	`SAFE_SHL
(
b
,16))

48  
rd_hi
;

49 
	}
}

50 
	#sûk_SMULWB
(
a
, 
b
Ë(
	`sûk_SMULWB_¨mv4
◊, b))

	)

53 #unde‡
sûk_SMLAWB


54 
	#sûk_SMLAWB
(
a
, 
b
, 
c
Ë(◊Ë+ 
	`sûk_SMULWB
(b, c))

	)

57 #unde‡
sûk_SMULWT


58 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWT_¨mv4
(
›us_öt32
 
a
, opus_öt32 
b
)

60 
rd_lo
;

61 
rd_hi
;

62 
	`__asm__
(

65 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

66 : "%r"(
a
), "r"(
b
&~0xFFFF)

68  
rd_hi
;

69 
	}
}

70 
	#sûk_SMULWT
(
a
, 
b
Ë(
	`sûk_SMULWT_¨mv4
◊, b))

	)

73 #unde‡
sûk_SMLAWT


74 
	#sûk_SMLAWT
(
a
, 
b
, 
c
Ë(◊Ë+ 
	`sûk_SMULWT
(b, c))

	)

77 #unde‡
sûk_SMULWW


78 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWW_¨mv4
(
›us_öt32
 
a
, opus_öt32 
b
)

80 
rd_lo
;

81 
rd_hi
;

82 
	`__asm__
(

85 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

86 : "%r"(
a
), "r"(
b
)

88  
	`SAFE_SHL
(
rd_hi
,16)+(
rd_lo
>>16);

89 
	}
}

90 
	#sûk_SMULWW
(
a
, 
b
Ë(
	`sûk_SMULWW_¨mv4
◊, b))

	)

92 #unde‡
sûk_SMLAWW


93 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWW_¨mv4
(
›us_öt32
 
a
, opus_öt32 
b
,

94 
›us_öt32
 
c
)

96 
rd_lo
;

97 
rd_hi
;

98 
	`__asm__
(

101 : "=&r"(
rd_lo
), "=&r"(
rd_hi
)

102 : "%r"(
b
), "r"(
c
)

104  
a
+
	`SAFE_SHL
(
rd_hi
,16)+(
rd_lo
>>16);

105 
	}
}

106 
	#sûk_SMLAWW
(
a
, 
b
, 
c
Ë(
	`sûk_SMLAWW_¨mv4
◊, b, c))

	)

108 #unde‡
SAFE_SHL


	@silk/arm/macros_armv5e.h

29 #i‚de‡
SILK_MACROS_ARMv5E_H


30 
	#SILK_MACROS_ARMv5E_H


	)

35 
	#SAFE_SHL
(
a
,
b
Ë((
›us_öt32
)((
›us_uöt32
)◊Ë<< (b)))

	)

38 #unde‡
sûk_SMULWB


39 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWB_¨mv5e
(
›us_öt32
 
a
, 
›us_öt16
 
b
)

41 
ªs
;

42 
	`__asm__
(

45 : "Ù"(
ªs
)

46 : "r"(
a
), "r"(
b
)

48  
ªs
;

49 
	}
}

50 
	#sûk_SMULWB
(
a
, 
b
Ë(
	`sûk_SMULWB_¨mv5e
◊, b))

	)

53 #unde‡
sûk_SMLAWB


54 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWB_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
,

55 
›us_öt16
 
c
)

57 
ªs
;

58 
	`__asm__
(

61 : "Ù"(
ªs
)

62 : "r"(
b
), "r"(
c
), "r"(
a
)

64  
ªs
;

65 
	}
}

66 
	#sûk_SMLAWB
(
a
, 
b
, 
c
Ë(
	`sûk_SMLAWB_¨mv5e
◊, b, c))

	)

69 #unde‡
sûk_SMULWT


70 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULWT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

72 
ªs
;

73 
	`__asm__
(

76 : "Ù"(
ªs
)

77 : "r"(
a
), "r"(
b
)

79  
ªs
;

80 
	}
}

81 
	#sûk_SMULWT
(
a
, 
b
Ë(
	`sûk_SMULWT_¨mv5e
◊, b))

	)

84 #unde‡
sûk_SMLAWT


85 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLAWT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
,

86 
›us_öt32
 
c
)

88 
ªs
;

89 
	`__asm__
(

92 : "Ù"(
ªs
)

93 : "r"(
b
), "r"(
c
), "r"(
a
)

95  
ªs
;

96 
	}
}

97 
	#sûk_SMLAWT
(
a
, 
b
, 
c
Ë(
	`sûk_SMLAWT_¨mv5e
◊, b, c))

	)

100 #unde‡
sûk_SMULBB


101 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULBB_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

103 
ªs
;

104 
	`__asm__
(

107 : "Ù"(
ªs
)

108 : "%r"(
a
), "r"(
b
)

110  
ªs
;

111 
	}
}

112 
	#sûk_SMULBB
(
a
, 
b
Ë(
	`sûk_SMULBB_¨mv5e
◊, b))

	)

115 #unde‡
sûk_SMLABB


116 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABB_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
,

117 
›us_öt32
 
c
)

119 
ªs
;

120 
	`__asm__
(

123 : "Ù"(
ªs
)

124 : "%r"(
b
), "r"(
c
), "r"(
a
)

126  
ªs
;

127 
	}
}

128 
	#sûk_SMLABB
(
a
, 
b
, 
c
Ë(
	`sûk_SMLABB_¨mv5e
◊, b, c))

	)

131 #unde‡
sûk_SMULBT


132 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMULBT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

134 
ªs
;

135 
	`__asm__
(

138 : "Ù"(
ªs
)

139 : "r"(
a
), "r"(
b
)

141  
ªs
;

142 
	}
}

143 
	#sûk_SMULBT
(
a
, 
b
Ë(
	`sûk_SMULBT_¨mv5e
◊, b))

	)

146 #unde‡
sûk_SMLABT


147 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SMLABT_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
,

148 
›us_öt32
 
c
)

150 
ªs
;

151 
	`__asm__
(

154 : "Ù"(
ªs
)

155 : "r"(
b
), "r"(
c
), "r"(
a
)

157  
ªs
;

158 
	}
}

159 
	#sûk_SMLABT
(
a
, 
b
, 
c
Ë(
	`sûk_SMLABT_¨mv5e
◊, b, c))

	)

162 #unde‡
sûk_ADD_SAT32


163 
OPUS_INLINE
 
›us_öt32
 
	$sûk_ADD_SAT32_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

165 
ªs
;

166 
	`__asm__
(

169 : "Ù"(
ªs
)

170 : "%r"(
a
), "r"(
b
)

172  
ªs
;

173 
	}
}

174 
	#sûk_ADD_SAT32
(
a
, 
b
Ë(
	`sûk_ADD_SAT32_¨mv5e
◊, b))

	)

176 #unde‡
sûk_SUB_SAT32


177 
OPUS_INLINE
 
›us_öt32
 
	$sûk_SUB_SAT32_¨mv5e
(
›us_öt32
 
a
, opus_öt32 
b
)

179 
ªs
;

180 
	`__asm__
(

183 : "Ù"(
ªs
)

184 : "r"(
a
), "r"(
b
)

186  
ªs
;

187 
	}
}

188 
	#sûk_SUB_SAT32
(
a
, 
b
Ë(
	`sûk_SUB_SAT32_¨mv5e
◊, b))

	)

190 #unde‡
sûk_CLZ16


191 
OPUS_INLINE
 
›us_öt32
 
	$sûk_CLZ16_¨mv5
(
›us_öt16
 
ö16
)

193 
ªs
;

194 
	`__asm__
(

197 : "Ù"(
ªs
)

198 : "r"(
	`SAFE_SHL
(
ö16
,16)|0x8000)

200  
ªs
;

201 
	}
}

202 
	#sûk_CLZ16
(
ö16
Ë(
	`sûk_CLZ16_¨mv5
(ö16))

	)

204 #unde‡
sûk_CLZ32


205 
OPUS_INLINE
 
›us_öt32
 
	$sûk_CLZ32_¨mv5
(
›us_öt32
 
ö32
)

207 
ªs
;

208 
	`__asm__
(

211 : "Ù"(
ªs
)

212 : "r"(
ö32
)

214  
ªs
;

215 
	}
}

216 
	#sûk_CLZ32
(
ö32
Ë(
	`sûk_CLZ32_¨mv5
(ö32))

	)

218 #unde‡
SAFE_SHL


	@silk/biquad_alt.c

35 #ifde‡
HAVE_CONFIG_H


36 
	~"c⁄fig.h
"

39 
	~"SigProc_FIX.h
"

42 
	$sûk_biquad_Æt_°ride1
(

43 c⁄° 
›us_öt16
 *
ö
,

44 c⁄° 
›us_öt32
 *
B_Q28
,

45 c⁄° 
›us_öt32
 *
A_Q28
,

46 
›us_öt32
 *
S
,

47 
›us_öt16
 *
out
,

48 c⁄° 
›us_öt32
 
Àn


52 
›us_öt
 
k
;

53 
›us_öt32
 
övÆ
, 
A0_U_Q28
, 
A0_L_Q28
, 
A1_U_Q28
, 
A1_L_Q28
, 
out32_Q14
;

56 
A0_L_Q28
 = ( -
A_Q28
[ 0 ] ) & 0x00003FFF;

57 
A0_U_Q28
 = 
	`sûk_RSHIFT
–-
A_Q28
[ 0 ], 14 );

58 
A1_L_Q28
 = ( -
A_Q28
[ 1 ] ) & 0x00003FFF;

59 
A1_U_Q28
 = 
	`sûk_RSHIFT
–-
A_Q28
[ 1 ], 14 );

61  
k
 = 0; k < 
Àn
; k++ ) {

63 
övÆ
 = 
ö
[ 
k
 ];

64 
out32_Q14
 = 
	`sûk_LSHIFT
–
	`sûk_SMLAWB
–
S
[ 0 ], 
B_Q28
[ 0 ], 
övÆ
 ), 2 );

66 
S
[ 0 ] = S[1] + 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
, 
A0_L_Q28
 ), 14 );

67 
S
[ 0 ] = 
	`sûk_SMLAWB
–S[ 0 ], 
out32_Q14
, 
A0_U_Q28
 );

68 
S
[ 0 ] = 
	`sûk_SMLAWB
–S[ 0 ], 
B_Q28
[ 1 ], 
övÆ
);

70 
S
[ 1 ] = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
, 
A1_L_Q28
 ), 14 );

71 
S
[ 1 ] = 
	`sûk_SMLAWB
–S[ 1 ], 
out32_Q14
, 
A1_U_Q28
 );

72 
S
[ 1 ] = 
	`sûk_SMLAWB
–S[ 1 ], 
B_Q28
[ 2 ], 
övÆ
 );

75 
out
[ 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT
–
out32_Q14
 + (1<<14) - 1, 14 ) );

77 
	}
}

79 
	$sûk_biquad_Æt_°ride2_c
(

80 c⁄° 
›us_öt16
 *
ö
,

81 c⁄° 
›us_öt32
 *
B_Q28
,

82 c⁄° 
›us_öt32
 *
A_Q28
,

83 
›us_öt32
 *
S
,

84 
›us_öt16
 *
out
,

85 c⁄° 
›us_öt32
 
Àn


89 
›us_öt
 
k
;

90 
›us_öt32
 
A0_U_Q28
, 
A0_L_Q28
, 
A1_U_Q28
, 
A1_L_Q28
, 
out32_Q14
[ 2 ];

93 
A0_L_Q28
 = ( -
A_Q28
[ 0 ] ) & 0x00003FFF;

94 
A0_U_Q28
 = 
	`sûk_RSHIFT
–-
A_Q28
[ 0 ], 14 );

95 
A1_L_Q28
 = ( -
A_Q28
[ 1 ] ) & 0x00003FFF;

96 
A1_U_Q28
 = 
	`sûk_RSHIFT
–-
A_Q28
[ 1 ], 14 );

98  
k
 = 0; k < 
Àn
; k++ ) {

100 
out32_Q14
[ 0 ] = 
	`sûk_LSHIFT
–
	`sûk_SMLAWB
–
S
[ 0 ], 
B_Q28
[ 0 ], 
ö
[ 2 * 
k
 + 0 ] ), 2 );

101 
out32_Q14
[ 1 ] = 
	`sûk_LSHIFT
–
	`sûk_SMLAWB
–
S
[ 2 ], 
B_Q28
[ 0 ], 
ö
[ 2 * 
k
 + 1 ] ), 2 );

103 
S
[ 0 ] = S[ 1 ] + 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
[ 0 ], 
A0_L_Q28
 ), 14 );

104 
S
[ 2 ] = S[ 3 ] + 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
[ 1 ], 
A0_L_Q28
 ), 14 );

105 
S
[ 0 ] = 
	`sûk_SMLAWB
–S[ 0 ], 
out32_Q14
[ 0 ], 
A0_U_Q28
 );

106 
S
[ 2 ] = 
	`sûk_SMLAWB
–S[ 2 ], 
out32_Q14
[ 1 ], 
A0_U_Q28
 );

107 
S
[ 0 ] = 
	`sûk_SMLAWB
–S[ 0 ], 
B_Q28
[ 1 ], 
ö
[ 2 * 
k
 + 0 ] );

108 
S
[ 2 ] = 
	`sûk_SMLAWB
–S[ 2 ], 
B_Q28
[ 1 ], 
ö
[ 2 * 
k
 + 1 ] );

110 
S
[ 1 ] = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
[ 0 ], 
A1_L_Q28
 ), 14 );

111 
S
[ 3 ] = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWB
–
out32_Q14
[ 1 ], 
A1_L_Q28
 ), 14 );

112 
S
[ 1 ] = 
	`sûk_SMLAWB
–S[ 1 ], 
out32_Q14
[ 0 ], 
A1_U_Q28
 );

113 
S
[ 3 ] = 
	`sûk_SMLAWB
–S[ 3 ], 
out32_Q14
[ 1 ], 
A1_U_Q28
 );

114 
S
[ 1 ] = 
	`sûk_SMLAWB
–S[ 1 ], 
B_Q28
[ 2 ], 
ö
[ 2 * 
k
 + 0 ] );

115 
S
[ 3 ] = 
	`sûk_SMLAWB
–S[ 3 ], 
B_Q28
[ 2 ], 
ö
[ 2 * 
k
 + 1 ] );

118 
out
[ 2 * 
k
 + 0 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT
–
out32_Q14
[ 0 ] + (1<<14) - 1, 14 ) );

119 
out
[ 2 * 
k
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT
–
out32_Q14
[ 1 ] + (1<<14) - 1, 14 ) );

121 
	}
}

	@silk/bwexpander.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
	$sûk_bwex∑ndî
(

36 
›us_öt16
 *
¨
,

37 c⁄° 
›us_öt
 
d
,

38 
›us_öt32
 
chúp_Q16


41 
›us_öt
 
i
;

42 
›us_öt32
 
chúp_möus_⁄e_Q16
 = 
chúp_Q16
 - 65536;

46  
i
 = 0; i < 
d
 - 1; i++ ) {

47 
¨
[ 
i
 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
	`sûk_MUL
–
chúp_Q16
,ár[ i ] ), 16 );

48 
chúp_Q16
 +
	`sûk_RSHIFT_ROUND
–
	`sûk_MUL
–chúp_Q16, 
chúp_möus_⁄e_Q16
 ), 16 );

50 
¨
[ 
d
 - 1 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
	`sûk_MUL
–
chúp_Q16
,ár[ d - 1 ] ), 16 );

51 
	}
}

	@silk/bwexpander_32.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
	$sûk_bwex∑ndî_32
(

36 
›us_öt32
 *
¨
,

37 c⁄° 
›us_öt
 
d
,

38 
›us_öt32
 
chúp_Q16


41 
›us_öt
 
i
;

42 
›us_öt32
 
chúp_möus_⁄e_Q16
 = 
chúp_Q16
 - 65536;

44  
i
 = 0; i < 
d
 - 1; i++ ) {

45 
¨
[ 
i
 ] = 
	`sûk_SMULWW
–
chúp_Q16
,ár[ i ] );

46 
chúp_Q16
 +
	`sûk_RSHIFT_ROUND
–
	`sûk_MUL
–chúp_Q16, 
chúp_möus_⁄e_Q16
 ), 16 );

48 
¨
[ 
d
 - 1 ] = 
	`sûk_SMULWW
–
chúp_Q16
,ár[ d - 1 ] );

49 
	}
}

	@silk/check_control_input.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"c⁄åﬁ.h
"

34 
	~"îr‹s.h
"

37 
›us_öt
 
	$check_c⁄åﬁ_öput
(

38 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


41 
	`˚…_as£π
–
ícC⁄åﬁ
 !
NULL
 );

43 if–––
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 8000 ) &&

44 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 12000 ) &&

45 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 16000 ) &&

46 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 24000 ) &&

47 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 32000 ) &&

48 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 44100 ) &&

49 –
ícC⁄åﬁ
->
API_ßm∂eR©e
 != 48000 ) ) ||

50 ––
ícC⁄åﬁ
->
desúedI¡î«lSam∂eR©e
 != 8000 ) &&

51 –
ícC⁄åﬁ
->
desúedI¡î«lSam∂eR©e
 != 12000 ) &&

52 –
ícC⁄åﬁ
->
desúedI¡î«lSam∂eR©e
 != 16000 ) ) ||

53 ––
ícC⁄åﬁ
->
maxI¡î«lSam∂eR©e
 != 8000 ) &&

54 –
ícC⁄åﬁ
->
maxI¡î«lSam∂eR©e
 != 12000 ) &&

55 –
ícC⁄åﬁ
->
maxI¡î«lSam∂eR©e
 != 16000 ) ) ||

56 ––
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
 != 8000 ) &&

57 –
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
 != 12000 ) &&

58 –
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
 != 16000 ) ) ||

59 –
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
 >ÉncC⁄åﬁ->
desúedI¡î«lSam∂eR©e
 ) ||

60 –
ícC⁄åﬁ
->
maxI¡î«lSam∂eR©e
 <ÉncC⁄åﬁ->
desúedI¡î«lSam∂eR©e
 ) ||

61 –
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
 >ÉncC⁄åﬁ->
maxI¡î«lSam∂eR©e
 ) ) {

62 
	`˚…_as£π
( 0 );

63  
SILK_ENC_FS_NOT_SUPPORTED
;

65 if–
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 != 10 &&

66 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 != 20 &&

67 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 != 40 &&

68 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 != 60 ) {

69 
	`˚…_as£π
( 0 );

70  
SILK_ENC_PACKET_SIZE_NOT_SUPPORTED
;

72 if–
ícC⁄åﬁ
->
∑ckëLossPî˚¡age
 < 0 ||ÉncControl->packetLossPercentage > 100 ) {

73 
	`˚…_as£π
( 0 );

74  
SILK_ENC_INVALID_LOSS_RATE
;

76 if–
ícC⁄åﬁ
->
u£DTX
 < 0 ||ÉncControl->useDTX > 1 ) {

77 
	`˚…_as£π
( 0 );

78  
SILK_ENC_INVALID_DTX_SETTING
;

80 if–
ícC⁄åﬁ
->
u£CBR
 < 0 ||ÉncControl->useCBR > 1 ) {

81 
	`˚…_as£π
( 0 );

82  
SILK_ENC_INVALID_CBR_SETTING
;

84 if–
ícC⁄åﬁ
->
u£InB™dFEC
 < 0 ||ÉncControl->useInBandFEC > 1 ) {

85 
	`˚…_as£π
( 0 );

86  
SILK_ENC_INVALID_INBAND_FEC_SETTING
;

88 if–
ícC⁄åﬁ
->
nCh™√lsAPI
 < 1 ||ÉncC⁄åﬁ->nCh™√lsAPI > 
ENCODER_NUM_CHANNELS
 ) {

89 
	`˚…_as£π
( 0 );

90  
SILK_ENC_INVALID_NUMBER_OF_CHANNELS_ERROR
;

92 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 < 1 ||ÉncC⁄åﬁ->nCh™√lsI¡î«»> 
ENCODER_NUM_CHANNELS
 ) {

93 
	`˚…_as£π
( 0 );

94  
SILK_ENC_INVALID_NUMBER_OF_CHANNELS_ERROR
;

96 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 >ÉncC⁄åﬁ->
nCh™√lsAPI
 ) {

97 
	`˚…_as£π
( 0 );

98  
SILK_ENC_INVALID_NUMBER_OF_CHANNELS_ERROR
;

100 if–
ícC⁄åﬁ
->
com∂exôy
 < 0 ||ÉncControl->complexity > 10 ) {

101 
	`˚…_as£π
( 0 );

102  
SILK_ENC_INVALID_COMPLEXITY_SETTING
;

105  
SILK_NO_ERROR
;

106 
	}
}

	@silk/code_signs.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

37 
	#sûk_íc_m≠
(
a
Ë–
	`sûk_RSHIFT
–◊), 15 ) + 1 )

	)

38 
	#sûk_dec_m≠
(
a
Ë–
	`sûk_LSHIFT
–◊), 1 ) - 1 )

	)

41 
	$sûk_ícode_signs
(

42 
ec_íc
 *
psR™geEnc
,

43 c⁄° 
›us_öt8
 
pul£s
[],

44 
›us_öt
 
Àngth
,

45 c⁄° 
›us_öt
 
sig«lTy≥
,

46 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

47 c⁄° 
›us_öt
 
sum_pul£s
[ 
MAX_NB_SHELL_BLOCKS
 ]

50 
›us_öt
 
i
, 
j
, 
p
;

51 
›us_uöt8
 
icdf
[ 2 ];

52 c⁄° 
›us_öt8
 *
q_±r
;

53 c⁄° 
›us_uöt8
 *
icdf_±r
;

55 
icdf
[ 1 ] = 0;

56 
q_±r
 = 
pul£s
;

57 
i
 = 
	`sûk_SMULBB
–7, 
	`sûk_ADD_LSHIFT
–
qu™tOff£tTy≥
, 
sig«lTy≥
, 1 ) );

58 
icdf_±r
 = &
sûk_sign_iCDF
[ 
i
 ];

59 
Àngth
 = 
	`sûk_RSHIFT
–Àngth + 
SHELL_CODEC_FRAME_LENGTH
/2, 
LOG2_SHELL_CODEC_FRAME_LENGTH
 );

60  
i
 = 0; i < 
Àngth
; i++ ) {

61 
p
 = 
sum_pul£s
[ 
i
 ];

62 if–
p
 > 0 ) {

63 
icdf
[ 0 ] = 
icdf_±r
[ 
	`sûk_mö
–
p
 & 0x1F, 6 ) ];

64  
j
 = 0; j < 
SHELL_CODEC_FRAME_LENGTH
; j++ ) {

65 if–
q_±r
[ 
j
 ] != 0 ) {

66 
	`ec_íc_icdf
–
psR™geEnc
, 
	`sûk_íc_m≠
–
q_±r
[ 
j
 ]), 
icdf
, 8 );

70 
q_±r
 +
SHELL_CODEC_FRAME_LENGTH
;

72 
	}
}

75 
	$sûk_decode_signs
(

76 
ec_dec
 *
psR™geDec
,

77 
›us_öt16
 
pul£s
[],

78 
›us_öt
 
Àngth
,

79 c⁄° 
›us_öt
 
sig«lTy≥
,

80 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

81 c⁄° 
›us_öt
 
sum_pul£s
[ 
MAX_NB_SHELL_BLOCKS
 ]

84 
›us_öt
 
i
, 
j
, 
p
;

85 
›us_uöt8
 
icdf
[ 2 ];

86 
›us_öt16
 *
q_±r
;

87 c⁄° 
›us_uöt8
 *
icdf_±r
;

89 
icdf
[ 1 ] = 0;

90 
q_±r
 = 
pul£s
;

91 
i
 = 
	`sûk_SMULBB
–7, 
	`sûk_ADD_LSHIFT
–
qu™tOff£tTy≥
, 
sig«lTy≥
, 1 ) );

92 
icdf_±r
 = &
sûk_sign_iCDF
[ 
i
 ];

93 
Àngth
 = 
	`sûk_RSHIFT
–Àngth + 
SHELL_CODEC_FRAME_LENGTH
/2, 
LOG2_SHELL_CODEC_FRAME_LENGTH
 );

94  
i
 = 0; i < 
Àngth
; i++ ) {

95 
p
 = 
sum_pul£s
[ 
i
 ];

96 if–
p
 > 0 ) {

97 
icdf
[ 0 ] = 
icdf_±r
[ 
	`sûk_mö
–
p
 & 0x1F, 6 ) ];

98  
j
 = 0; j < 
SHELL_CODEC_FRAME_LENGTH
; j++ ) {

99 if–
q_±r
[ 
j
 ] > 0 ) {

103 if–
	`ec_dec_icdf
–
psR™geDec
, 
icdf
, 8 ) == 0 ) {

104 
q_±r
[ 
j
 ] = -q_ptr[ j ];

108 
q_±r
[ 
j
 ] *
	`sûk_dec_m≠
–
	`ec_dec_icdf
–
psR™geDec
, 
icdf
, 8 ) );

113 
q_±r
 +
SHELL_CODEC_FRAME_LENGTH
;

115 
	}
}

	@silk/control.h

28 #i‚de‡
SILK_CONTROL_H


29 
	#SILK_CONTROL_H


	)

31 
	~"ty≥def.h
"

33 #ifde‡
__˝lu•lus


39 
	#FLAG_DECODE_NORMAL
 0

	)

40 
	#FLAG_PACKET_LOST
 1

	)

41 
	#FLAG_DECODE_LBRR
 2

	)

48 
›us_öt32
 
nCh™√lsAPI
;

51 
›us_öt32
 
nCh™√lsI¡î«l
;

54 
›us_öt32
 
API_ßm∂eR©e
;

57 
›us_öt32
 
maxI¡î«lSam∂eR©e
;

60 
›us_öt32
 
möI¡î«lSam∂eR©e
;

63 
›us_öt32
 
desúedI¡î«lSam∂eR©e
;

66 
›us_öt
 
∑ylﬂdSize_ms
;

69 
›us_öt32
 
bôR©e
;

72 
›us_öt
 
∑ckëLossPî˚¡age
;

75 
›us_öt
 
com∂exôy
;

78 
›us_öt
 
u£InB™dFEC
;

81 
›us_öt
 
LBRR_coded
;

84 
›us_öt
 
u£DTX
;

87 
›us_öt
 
u£CBR
;

90 
›us_öt
 
maxBôs
;

93 
›us_öt
 
toM⁄o
;

96 
›us_öt
 
›usC™Swôch
;

99 
›us_öt
 
ªdu˚dDïídícy
;

102 
›us_öt32
 
öã∫ÆSam∂eR©e
;

105 
›us_öt
 
ÆlowB™dwidthSwôch
;

108 
›us_öt
 
öWBmodeWôhoutV¨übÀLP
;

111 
›us_öt
 
°îeoWidth_Q14
;

114 
›us_öt
 
swôchRódy
;

117 
›us_öt
 
sig«lTy≥
;

120 
›us_öt
 
off£t
;

121 } 
	tsûk_EncC⁄åﬁSåu˘
;

128 
›us_öt32
 
nCh™√lsAPI
;

131 
›us_öt32
 
nCh™√lsI¡î«l
;

134 
›us_öt32
 
API_ßm∂eR©e
;

137 
›us_öt32
 
öã∫ÆSam∂eR©e
;

140 
›us_öt
 
∑ylﬂdSize_ms
;

143 
›us_öt
 
¥evPôchLag
;

144 } 
	tsûk_DecC⁄åﬁSåu˘
;

146 #ifde‡
__˝lu•lus


	@silk/control_SNR.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"tunög_∑ømëîs.h
"

40 c⁄° 
	gsûk_T¨gëR©e_NB_21
[117 - 10] = {

51 c⁄° 
	gsûk_T¨gëR©e_MB_21
[165 - 10] = {

65 c⁄° 
	gsûk_T¨gëR©e_WB_21
[201 - 10] = {

82 
›us_öt
 
	$sûk_c⁄åﬁ_SNR
(

83 
sûk_ícodî_°©e
 *
psEncC
,

84 
›us_öt32
 
T¨gëR©e_bps


87 
id
;

88 
bound
;

89 c⁄° *
¢r_èbÀ
;

91 
psEncC
->
T¨gëR©e_bps
 = TargetRate_bps;

92 if–
psEncC
->
nb_sub‰
 == 2 ) {

93 
T¨gëR©e_bps
 -2000 + 
psEncC
->
fs_kHz
/16;

95 if–
psEncC
->
fs_kHz
 == 8 ) {

96 
bound
 = (
sûk_T¨gëR©e_NB_21
);

97 
¢r_èbÀ
 = 
sûk_T¨gëR©e_NB_21
;

98 } if–
psEncC
->
fs_kHz
 == 12 ) {

99 
bound
 = (
sûk_T¨gëR©e_MB_21
);

100 
¢r_èbÀ
 = 
sûk_T¨gëR©e_MB_21
;

102 
bound
 = (
sûk_T¨gëR©e_WB_21
);

103 
¢r_èbÀ
 = 
sûk_T¨gëR©e_WB_21
;

105 
id
 = (
T¨gëR©e_bps
+200)/400;

106 
id
 = 
	`sûk_mö
(id - 10, 
bound
-1);

107 if–
id
 <= 0 ) {

108 
psEncC
->
SNR_dB_Q7
 = 0;

110 
psEncC
->
SNR_dB_Q7
 = 
¢r_èbÀ
[
id
]*21;

112  
SILK_NO_ERROR
;

113 
	}
}

	@silk/control_audio_bandwidth.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"tunög_∑ømëîs.h
"

36 
›us_öt
 
	$sûk_c⁄åﬁ_audio_b™dwidth
(

37 
sûk_ícodî_°©e
 *
psEncC
,

38 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


41 
›us_öt
 
fs_kHz
;

42 
›us_öt
 
‹ig_kHz
;

43 
›us_öt32
 
fs_Hz
;

45 
‹ig_kHz
 = 
psEncC
->
fs_kHz
;

47 if–
‹ig_kHz
 == 0 ) {

48 
‹ig_kHz
 = 
psEncC
->
sLP
.
ßved_fs_kHz
;

50 
fs_kHz
 = 
‹ig_kHz
;

51 
fs_Hz
 = 
	`sûk_SMULBB
–
fs_kHz
, 1000 );

52 if–
fs_Hz
 == 0 ) {

54 
fs_Hz
 = 
	`sûk_mö
–
psEncC
->
desúedI¡î«l_fs_Hz
,ÖsEncC->
API_fs_Hz
 );

55 
fs_kHz
 = 
	`sûk_DIV32_16
–
fs_Hz
, 1000 );

56 } if–
fs_Hz
 > 
psEncC
->
API_fs_Hz
 || fs_Hz >ÖsEncC->
maxI¡î«l_fs_Hz
 || fs_Hz <ÖsEncC->
möI¡î«l_fs_Hz
 ) {

58 
fs_Hz
 = 
psEncC
->
API_fs_Hz
;

59 
fs_Hz
 = 
	`sûk_mö
–fs_Hz, 
psEncC
->
maxI¡î«l_fs_Hz
 );

60 
fs_Hz
 = 
	`sûk_max
–fs_Hz, 
psEncC
->
möI¡î«l_fs_Hz
 );

61 
fs_kHz
 = 
	`sûk_DIV32_16
–
fs_Hz
, 1000 );

64 if–
psEncC
->
sLP
.
å™sôi⁄_‰ame_no
 >
TRANSITION_FRAMES
 ) {

66 
psEncC
->
sLP
.
mode
 = 0;

68 if–
psEncC
->
Ælow_b™dwidth_swôch
 || 
ícC⁄åﬁ
->
›usC™Swôch
 ) {

70 if–
	`sûk_SMULBB
–
‹ig_kHz
, 1000 ) > 
psEncC
->
desúedI¡î«l_fs_Hz
 )

73 if–
psEncC
->
sLP
.
mode
 == 0 ) {

75 
psEncC
->
sLP
.
å™sôi⁄_‰ame_no
 = 
TRANSITION_FRAMES
;

78 
	`sûk_mem£t
–
psEncC
->
sLP
.
In_LP_Sèã
, 0, (ÖsEncC->sLP.In_LP_State ) );

80 if–
ícC⁄åﬁ
->
›usC™Swôch
 ) {

82 
psEncC
->
sLP
.
mode
 = 0;

85 
fs_kHz
 = 
‹ig_kHz
 == 16 ? 12 : 8;

87 if–
psEncC
->
sLP
.
å™sôi⁄_‰ame_no
 <= 0 ) {

88 
ícC⁄åﬁ
->
swôchRódy
 = 1;

90 
ícC⁄åﬁ
->
maxBôs
 -ícC⁄åﬁ->maxBô†* 5 / (ÉncC⁄åﬁ->
∑ylﬂdSize_ms
 + 5 );

93 
psEncC
->
sLP
.
mode
 = -2;

99 if–
	`sûk_SMULBB
–
‹ig_kHz
, 1000 ) < 
psEncC
->
desúedI¡î«l_fs_Hz
 )

102 if–
ícC⁄åﬁ
->
›usC™Swôch
 ) {

104 
fs_kHz
 = 
‹ig_kHz
 == 8 ? 12 : 16;

107 
psEncC
->
sLP
.
å™sôi⁄_‰ame_no
 = 0;

110 
	`sûk_mem£t
–
psEncC
->
sLP
.
In_LP_Sèã
, 0, (ÖsEncC->sLP.In_LP_State ) );

113 
psEncC
->
sLP
.
mode
 = 1;

115 if–
psEncC
->
sLP
.
mode
 == 0 ) {

116 
ícC⁄åﬁ
->
swôchRódy
 = 1;

118 
ícC⁄åﬁ
->
maxBôs
 -ícC⁄åﬁ->maxBô†* 5 / (ÉncC⁄åﬁ->
∑ylﬂdSize_ms
 + 5 );

121 
psEncC
->
sLP
.
mode
 = 1;

125 i‡(
psEncC
->
sLP
.
mode
<0)

126 
psEncC
->
sLP
.
mode
 = 1;

131  
fs_kHz
;

132 
	}
}

	@silk/control_codec.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

31 #ifde‡
FIXED_POINT


32 
	~"maö_FIX.h
"

33 
	#sûk_ícodî_°©e_Fxx
 
sûk_ícodî_°©e_FIX


	)

35 
	~"maö_FLP.h
"

36 
	#sûk_ícodî_°©e_Fxx
 
sûk_ícodî_°©e_FLP


	)

38 
	~"°ack_Æloc.h
"

39 
	~"tunög_∑ømëîs.h
"

40 
	~"pôch_e°_deföes.h
"

42 
›us_öt
 
sûk_£tup_ªßm∂îs
(

43 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

44 
›us_öt
 
fs_kHz


47 
›us_öt
 
sûk_£tup_fs
(

48 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

49 
›us_öt
 
fs_kHz
,

50 
›us_öt
 
PackëSize_ms


53 
›us_öt
 
sûk_£tup_com∂exôy
(

54 
sûk_ícodî_°©e
 *
psEncC
,

55 
›us_öt
 
Com∂exôy


58 
OPUS_INLINE
 
›us_öt
 
sûk_£tup_LBRR
(

59 
sûk_ícodî_°©e
 *
psEncC
,

60 c⁄° 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


65 
›us_öt
 
	$sûk_c⁄åﬁ_ícodî
(

66 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

67 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ
,

68 c⁄° 
›us_öt
 
Ælow_bw_swôch
,

69 c⁄° 
›us_öt
 
ch™√lNb
,

70 c⁄° 
›us_öt
 
f‹˚_fs_kHz


73 
›us_öt
 
fs_kHz
, 
ªt
 = 0;

75 
psEnc
->
sCmn
.
u£DTX
 = 
ícC⁄åﬁ
->useDTX;

76 
psEnc
->
sCmn
.
u£CBR
 = 
ícC⁄åﬁ
->useCBR;

77 
psEnc
->
sCmn
.
API_fs_Hz
 = 
ícC⁄åﬁ
->
API_ßm∂eR©e
;

78 
psEnc
->
sCmn
.
maxI¡î«l_fs_Hz
 = 
ícC⁄åﬁ
->
maxI¡î«lSam∂eR©e
;

79 
psEnc
->
sCmn
.
möI¡î«l_fs_Hz
 = 
ícC⁄åﬁ
->
möI¡î«lSam∂eR©e
;

80 
psEnc
->
sCmn
.
desúedI¡î«l_fs_Hz
 = 
ícC⁄åﬁ
->
desúedI¡î«lSam∂eR©e
;

81 
psEnc
->
sCmn
.
u£InB™dFEC
 = 
ícC⁄åﬁ
->useInBandFEC;

82 
psEnc
->
sCmn
.
nCh™√lsAPI
 = 
ícC⁄åﬁ
->nChannelsAPI;

83 
psEnc
->
sCmn
.
nCh™√lsI¡î«l
 = 
ícC⁄åﬁ
->nChannelsInternal;

84 
psEnc
->
sCmn
.
Ælow_b™dwidth_swôch
 = 
Ælow_bw_swôch
;

85 
psEnc
->
sCmn
.
ch™√lNb
 = channelNb;

87 if–
psEnc
->
sCmn
.
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
 !0 &&ÖsEnc->sCmn.
¥efûlFœg
 == 0 ) {

88 if–
psEnc
->
sCmn
.
API_fs_Hz
 !psEnc->sCmn.
¥ev_API_fs_Hz
 &&ÖsEnc->sCmn.
fs_kHz
 > 0 ) {

90 
ªt
 +
	`sûk_£tup_ªßm∂îs
–
psEnc
,ÖsEnc->
sCmn
.
fs_kHz
 );

92  
ªt
;

100 
fs_kHz
 = 
	`sûk_c⁄åﬁ_audio_b™dwidth
–&
psEnc
->
sCmn
, 
ícC⁄åﬁ
 );

101 if–
f‹˚_fs_kHz
 ) {

102 
fs_kHz
 = 
f‹˚_fs_kHz
;

107 
ªt
 +
	`sûk_£tup_ªßm∂îs
–
psEnc
, 
fs_kHz
 );

112 
ªt
 +
	`sûk_£tup_fs
–
psEnc
, 
fs_kHz
, 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 );

117 
ªt
 +
	`sûk_£tup_com∂exôy
–&
psEnc
->
sCmn
, 
ícC⁄åﬁ
->
com∂exôy
 );

122 
psEnc
->
sCmn
.
PackëLoss_≥rc
 = 
ícC⁄åﬁ
->
∑ckëLossPî˚¡age
;

127 
ªt
 +
	`sûk_£tup_LBRR
–&
psEnc
->
sCmn
, 
ícC⁄åﬁ
 );

129 
psEnc
->
sCmn
.
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
 = 1;

131  
ªt
;

132 
	}
}

134 
›us_öt
 
	$sûk_£tup_ªßm∂îs
(

135 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

136 
›us_öt
 
fs_kHz


139 
›us_öt
 
ªt
 = 
SILK_NO_ERROR
;

140 
SAVE_STACK
;

142 if–
psEnc
->
sCmn
.
fs_kHz
 !fs_kHz ||ÖsEnc->sCmn.
¥ev_API_fs_Hz
 !psEnc->sCmn.
API_fs_Hz
 )

144 if–
psEnc
->
sCmn
.
fs_kHz
 == 0 ) {

146 
ªt
 +
	`sûk_ªßm∂î_öô
–&
psEnc
->
sCmn
.
ªßm∂î_°©e
,ÖsEnc->sCmn.
API_fs_Hz
, 
fs_kHz
 * 1000, 1 );

148 
	`VARDECL
–
›us_öt16
, 
x_buf_API_fs_Hz
 );

149 
	`VARDECL
–
sûk_ªßm∂î_°©e_°ru˘
, 
ãmp_ªßm∂î_°©e
 );

150 #ifde‡
FIXED_POINT


151 
›us_öt16
 *
x_bufFIX
 = 
psEnc
->
x_buf
;

153 
	`VARDECL
–
›us_öt16
, 
x_bufFIX
 );

154 
›us_öt32
 
√w_buf_ßm∂es
;

156 
›us_öt32
 
≠i_buf_ßm∂es
;

157 
›us_öt32
 
ﬁd_buf_ßm∂es
;

158 
›us_öt32
 
buf_Àngth_ms
;

160 
buf_Àngth_ms
 = 
	`sûk_LSHIFT
–
psEnc
->
sCmn
.
nb_sub‰
 * 5, 1 ) + 
LA_SHAPE_MS
;

161 
ﬁd_buf_ßm∂es
 = 
buf_Àngth_ms
 * 
psEnc
->
sCmn
.
fs_kHz
;

163 #i‚de‡
FIXED_POINT


164 
√w_buf_ßm∂es
 = 
buf_Àngth_ms
 * 
fs_kHz
;

165 
	`ALLOC
–
x_bufFIX
, 
	`sûk_max
–
ﬁd_buf_ßm∂es
, 
√w_buf_ßm∂es
 ),

166 
›us_öt16
 );

167 
	`sûk_Êﬂt2sh‹t_¨øy
–
x_bufFIX
, 
psEnc
->
x_buf
, 
ﬁd_buf_ßm∂es
 );

171 
	`ALLOC
–
ãmp_ªßm∂î_°©e
, 1, 
sûk_ªßm∂î_°©e_°ru˘
 );

172 
ªt
 +
	`sûk_ªßm∂î_öô
–
ãmp_ªßm∂î_°©e
, 
	`sûk_SMULBB
–
psEnc
->
sCmn
.
fs_kHz
, 1000 ),ÖsEnc->sCmn.
API_fs_Hz
, 0 );

175 
≠i_buf_ßm∂es
 = 
buf_Àngth_ms
 * 
	`sûk_DIV32_16
–
psEnc
->
sCmn
.
API_fs_Hz
, 1000 );

178 
	`ALLOC
–
x_buf_API_fs_Hz
, 
≠i_buf_ßm∂es
, 
›us_öt16
 );

179 
ªt
 +
	`sûk_ªßm∂î
–
ãmp_ªßm∂î_°©e
, 
x_buf_API_fs_Hz
, 
x_bufFIX
, 
ﬁd_buf_ßm∂es
 );

182 
ªt
 +
	`sûk_ªßm∂î_öô
–&
psEnc
->
sCmn
.
ªßm∂î_°©e
,ÖsEnc->sCmn.
API_fs_Hz
, 
	`sûk_SMULBB
–
fs_kHz
, 1000 ), 1 );

185 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
sCmn
.
ªßm∂î_°©e
, 
x_bufFIX
, 
x_buf_API_fs_Hz
, 
≠i_buf_ßm∂es
 );

187 #i‚de‡
FIXED_POINT


188 
	`sûk_sh‹t2Êﬂt_¨øy
–
psEnc
->
x_buf
, 
x_bufFIX
, 
√w_buf_ßm∂es
);

193 
psEnc
->
sCmn
.
¥ev_API_fs_Hz
 =ÖsEnc->sCmn.
API_fs_Hz
;

195 
RESTORE_STACK
;

196  
ªt
;

197 
	}
}

199 
›us_öt
 
	$sûk_£tup_fs
(

200 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

201 
›us_öt
 
fs_kHz
,

202 
›us_öt
 
PackëSize_ms


205 
›us_öt
 
ªt
 = 
SILK_NO_ERROR
;

208 if–
PackëSize_ms
 !
psEnc
->
sCmn
.PacketSize_ms ) {

209 if––
PackëSize_ms
 != 10 ) &&

210 –
PackëSize_ms
 != 20 ) &&

211 –
PackëSize_ms
 != 40 ) &&

212 –
PackëSize_ms
 != 60 ) ) {

213 
ªt
 = 
SILK_ENC_PACKET_SIZE_NOT_SUPPORTED
;

215 if–
PackëSize_ms
 <= 10 ) {

216 
psEnc
->
sCmn
.
nFømesPîPackë
 = 1;

217 
psEnc
->
sCmn
.
nb_sub‰
 = 
PackëSize_ms
 == 10 ? 2 : 1;

218 
psEnc
->
sCmn
.
‰ame_Àngth
 = 
	`sûk_SMULBB
–
PackëSize_ms
, 
fs_kHz
 );

219 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 = 
	`sûk_SMULBB
–
FIND_PITCH_LPC_WIN_MS_2_SF
, 
fs_kHz
 );

220 if–
psEnc
->
sCmn
.
fs_kHz
 == 8 ) {

221 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_NB_iCDF
;

223 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_iCDF
;

226 
psEnc
->
sCmn
.
nFømesPîPackë
 = 
	`sûk_DIV32_16
–
PackëSize_ms
, 
MAX_FRAME_LENGTH_MS
 );

227 
psEnc
->
sCmn
.
nb_sub‰
 = 
MAX_NB_SUBFR
;

228 
psEnc
->
sCmn
.
‰ame_Àngth
 = 
	`sûk_SMULBB
–20, 
fs_kHz
 );

229 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 = 
	`sûk_SMULBB
–
FIND_PITCH_LPC_WIN_MS
, 
fs_kHz
 );

230 if–
psEnc
->
sCmn
.
fs_kHz
 == 8 ) {

231 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_NB_iCDF
;

233 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_iCDF
;

236 
psEnc
->
sCmn
.
PackëSize_ms
 = PacketSize_ms;

237 
psEnc
->
sCmn
.
T¨gëR©e_bps
 = 0;

241 
	`˚…_as£π
–
fs_kHz
 == 8 || fs_kHz == 12 || fs_kHz == 16 );

242 
	`˚…_as£π
–
psEnc
->
sCmn
.
nb_sub‰
 == 2 ||ÖsEnc->sCmn.nb_subfr == 4 );

243 if–
psEnc
->
sCmn
.
fs_kHz
 != fs_kHz ) {

245 
	`sûk_mem£t
–&
psEnc
->
sSh≠e
, 0, (ÖsEnc->sShape ) );

246 
	`sûk_mem£t
–&
psEnc
->
sCmn
.
sNSQ
, 0, (ÖsEnc->sCmn.sNSQ ) );

247 
	`sûk_mem£t
–
psEnc
->
sCmn
.
¥ev_NLSFq_Q15
, 0, (ÖsEnc->sCmn.prev_NLSFq_Q15 ) );

248 
	`sûk_mem£t
–&
psEnc
->
sCmn
.
sLP
.
In_LP_Sèã
, 0, (ÖsEnc->sCmn.sLP.In_LP_State ) );

249 
psEnc
->
sCmn
.
öputBufIx
 = 0;

250 
psEnc
->
sCmn
.
nFømesEncoded
 = 0;

251 
psEnc
->
sCmn
.
T¨gëR©e_bps
 = 0;

254 
psEnc
->
sCmn
.
¥evLag
 = 100;

255 
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 = 1;

256 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 10;

257 
psEnc
->
sCmn
.
sNSQ
.
œgPªv
 = 100;

258 
psEnc
->
sCmn
.
sNSQ
.
¥ev_gaö_Q16
 = 65536;

259 
psEnc
->
sCmn
.
¥evSig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

261 
psEnc
->
sCmn
.
fs_kHz
 = fs_kHz;

262 if–
psEnc
->
sCmn
.
fs_kHz
 == 8 ) {

263 if–
psEnc
->
sCmn
.
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

264 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_NB_iCDF
;

266 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_NB_iCDF
;

269 if–
psEnc
->
sCmn
.
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

270 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_iCDF
;

272 
psEnc
->
sCmn
.
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_iCDF
;

275 if–
psEnc
->
sCmn
.
fs_kHz
 == 8 ||ÖsEnc->sCmn.fs_kHz == 12 ) {

276 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
 = 
MIN_LPC_ORDER
;

277 
psEnc
->
sCmn
.
psNLSF_CB
 = &
sûk_NLSF_CB_NB_MB
;

279 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
 = 
MAX_LPC_ORDER
;

280 
psEnc
->
sCmn
.
psNLSF_CB
 = &
sûk_NLSF_CB_WB
;

282 
psEnc
->
sCmn
.
sub‰_Àngth
 = 
SUB_FRAME_LENGTH_MS
 * 
fs_kHz
;

283 
psEnc
->
sCmn
.
‰ame_Àngth
 = 
	`sûk_SMULBB
–psEnc->sCmn.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
 );

284 
psEnc
->
sCmn
.
…p_mem_Àngth
 = 
	`sûk_SMULBB
–
LTP_MEM_LENGTH_MS
, 
fs_kHz
 );

285 
psEnc
->
sCmn
.
œ_pôch
 = 
	`sûk_SMULBB
–
LA_PITCH_MS
, 
fs_kHz
 );

286 
psEnc
->
sCmn
.
max_pôch_œg
 = 
	`sûk_SMULBB
–18, 
fs_kHz
 );

287 if–
psEnc
->
sCmn
.
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

288 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 = 
	`sûk_SMULBB
–
FIND_PITCH_LPC_WIN_MS
, 
fs_kHz
 );

290 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 = 
	`sûk_SMULBB
–
FIND_PITCH_LPC_WIN_MS_2_SF
, 
fs_kHz
 );

292 if–
psEnc
->
sCmn
.
fs_kHz
 == 16 ) {

293 
psEnc
->
sCmn
.
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m8_iCDF
;

294 } if–
psEnc
->
sCmn
.
fs_kHz
 == 12 ) {

295 
psEnc
->
sCmn
.
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m6_iCDF
;

297 
psEnc
->
sCmn
.
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m4_iCDF
;

302 
	`˚…_as£π
––
psEnc
->
sCmn
.
sub‰_Àngth
 *ÖsEnc->sCmn.
nb_sub‰
 ) =psEnc->sCmn.
‰ame_Àngth
 );

304  
ªt
;

305 
	}
}

307 
›us_öt
 
	$sûk_£tup_com∂exôy
(

308 
sûk_ícodî_°©e
 *
psEncC
,

309 
›us_öt
 
Com∂exôy


312 
›us_öt
 
ªt
 = 0;

315 
	`˚…_as£π
–
Com∂exôy
 >= 0 && Complexity <= 10 );

316 if–
Com∂exôy
 < 1 ) {

317 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MIN_COMPLEX
;

318 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.8, 16 );

319 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 6;

320 
psEncC
->
sh≠ögLPCOrdî
 = 12;

321 
psEncC
->
œ_sh≠e
 = 3 *ÖsEncC->
fs_kHz
;

322 
psEncC
->
nSèãsDñayedDecisi⁄
 = 1;

323 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 0;

324 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 2;

325 
psEncC
->
w¨pög_Q16
 = 0;

326 } if–
Com∂exôy
 < 2 ) {

327 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MID_COMPLEX
;

328 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.76, 16 );

329 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 8;

330 
psEncC
->
sh≠ögLPCOrdî
 = 14;

331 
psEncC
->
œ_sh≠e
 = 5 *ÖsEncC->
fs_kHz
;

332 
psEncC
->
nSèãsDñayedDecisi⁄
 = 1;

333 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 0;

334 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 3;

335 
psEncC
->
w¨pög_Q16
 = 0;

336 } if–
Com∂exôy
 < 3 ) {

337 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MIN_COMPLEX
;

338 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.8, 16 );

339 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 6;

340 
psEncC
->
sh≠ögLPCOrdî
 = 12;

341 
psEncC
->
œ_sh≠e
 = 3 *ÖsEncC->
fs_kHz
;

342 
psEncC
->
nSèãsDñayedDecisi⁄
 = 2;

343 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 0;

344 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 2;

345 
psEncC
->
w¨pög_Q16
 = 0;

346 } if–
Com∂exôy
 < 4 ) {

347 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MID_COMPLEX
;

348 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.76, 16 );

349 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 8;

350 
psEncC
->
sh≠ögLPCOrdî
 = 14;

351 
psEncC
->
œ_sh≠e
 = 5 *ÖsEncC->
fs_kHz
;

352 
psEncC
->
nSèãsDñayedDecisi⁄
 = 2;

353 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 0;

354 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 4;

355 
psEncC
->
w¨pög_Q16
 = 0;

356 } if–
Com∂exôy
 < 6 ) {

357 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MID_COMPLEX
;

358 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.74, 16 );

359 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 10;

360 
psEncC
->
sh≠ögLPCOrdî
 = 16;

361 
psEncC
->
œ_sh≠e
 = 5 *ÖsEncC->
fs_kHz
;

362 
psEncC
->
nSèãsDñayedDecisi⁄
 = 2;

363 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 1;

364 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 6;

365 
psEncC
->
w¨pög_Q16
 =ÖsEncC->
fs_kHz
 * 
	`SILK_FIX_CONST
–
WARPING_MULTIPLIER
, 16 );

366 } if–
Com∂exôy
 < 8 ) {

367 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MID_COMPLEX
;

368 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.72, 16 );

369 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 12;

370 
psEncC
->
sh≠ögLPCOrdî
 = 20;

371 
psEncC
->
œ_sh≠e
 = 5 *ÖsEncC->
fs_kHz
;

372 
psEncC
->
nSèãsDñayedDecisi⁄
 = 3;

373 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 1;

374 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 8;

375 
psEncC
->
w¨pög_Q16
 =ÖsEncC->
fs_kHz
 * 
	`SILK_FIX_CONST
–
WARPING_MULTIPLIER
, 16 );

377 
psEncC
->
pôchE°im©i⁄Com∂exôy
 = 
SILK_PE_MAX_COMPLEX
;

378 
psEncC
->
pôchE°im©i⁄Thªshﬁd_Q16
 = 
	`SILK_FIX_CONST
( 0.7, 16 );

379 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 16;

380 
psEncC
->
sh≠ögLPCOrdî
 = 24;

381 
psEncC
->
œ_sh≠e
 = 5 *ÖsEncC->
fs_kHz
;

382 
psEncC
->
nSèãsDñayedDecisi⁄
 = 
MAX_DEL_DEC_STATES
;

383 
psEncC
->
u£I¡îpﬁ©edNLSFs
 = 1;

384 
psEncC
->
NLSF_MSVQ_Surviv‹s
 = 16;

385 
psEncC
->
w¨pög_Q16
 =ÖsEncC->
fs_kHz
 * 
	`SILK_FIX_CONST
–
WARPING_MULTIPLIER
, 16 );

389 
psEncC
->
pôchE°im©i⁄LPCOrdî
 = 
	`sûk_mö_öt
–psEncC->pôchE°im©i⁄LPCOrdî,ÖsEncC->
¥edi˘LPCOrdî
 );

390 
psEncC
->
sh≠eWöLígth
 = 
SUB_FRAME_LENGTH_MS
 *ÖsEncC->
fs_kHz
 + 2 *ÖsEncC->
œ_sh≠e
;

391 
psEncC
->
Com∂exôy
 = Complexity;

393 
	`˚…_as£π
–
psEncC
->
pôchE°im©i⁄LPCOrdî
 <
MAX_FIND_PITCH_LPC_ORDER
 );

394 
	`˚…_as£π
–
psEncC
->
sh≠ögLPCOrdî
 <
MAX_SHAPE_LPC_ORDER
 );

395 
	`˚…_as£π
–
psEncC
->
nSèãsDñayedDecisi⁄
 <
MAX_DEL_DEC_STATES
 );

396 
	`˚…_as£π
–
psEncC
->
w¨pög_Q16
 <= 32767 );

397 
	`˚…_as£π
–
psEncC
->
œ_sh≠e
 <
LA_SHAPE_MAX
 );

398 
	`˚…_as£π
–
psEncC
->
sh≠eWöLígth
 <
SHAPE_LPC_WIN_MAX
 );

400  
ªt
;

401 
	}
}

403 
OPUS_INLINE
 
›us_öt
 
	$sûk_£tup_LBRR
(

404 
sûk_ícodî_°©e
 *
psEncC
,

405 c⁄° 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


408 
›us_öt
 
LBRR_ö_¥evious_∑ckë
, 
ªt
 = 
SILK_NO_ERROR
;

410 
LBRR_ö_¥evious_∑ckë
 = 
psEncC
->
LBRR_íabÀd
;

411 
psEncC
->
LBRR_íabÀd
 = 
ícC⁄åﬁ
->
LBRR_coded
;

412 if–
psEncC
->
LBRR_íabÀd
 ) {

414 if–
LBRR_ö_¥evious_∑ckë
 == 0 ) {

416 
psEncC
->
LBRR_GaöIn¸ó£s
 = 7;

418 
psEncC
->
LBRR_GaöIn¸ó£s
 = 
	`sûk_max_öt
–7 - 
	`sûk_SMULWB
–(
›us_öt32
ÌsEncC->
PackëLoss_≥rc
, 
	`SILK_FIX_CONST
( 0.4, 16 ) ), 2 );

422  
ªt
;

423 
	}
}

	@silk/debug.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"debug.h
"

33 
	~"SigProc_FIX.h
"

35 #i‡
SILK_TIC_TOC


37 #ifde‡
_WIN32


39 #i‡(
deföed
(
_WIN32
Ë|| deföed(
_WINCE
))

40 
	~<wödows.h
>

42 
	~<sys/time.h
>

45 
	$sûk_GëHighResﬁuti⁄Time
()

50 
LARGE_INTEGER
 
ÕPîf‹m™˚Cou¡
;

51 
LARGE_INTEGER
 
ÕFªquícy
;

52 
	`QuîyPîf‹m™˚Cou¡î
(&
ÕPîf‹m™˚Cou¡
);

53 
	`QuîyPîf‹m™˚Fªquícy
(&
ÕFªquícy
);

54  ()((1000000*(
ÕPîf‹m™˚Cou¡
.
QuadP¨t
)Ë/ 
ÕFªquícy
.QuadPart);

55 
	}
}

57 
	$GëHighResﬁuti⁄Time
()

59 
timevÆ
 
tv
;

60 
	`gëtimeofday
(&
tv
, 0);

61 ((
tv
.
tv_£c
*1000000)+—v.
tv_u£c
));

62 
	}
}

65 
	gsûk_Timî_nTimîs
 = 0;

66 
	gsûk_Timî_dïth_˘r
 = 0;

67 
	gsûk_Timî_ègs
[
sûk_NUM_TIMERS_MAX
][
sûk_NUM_TIMERS_MAX_TAG_LEN
];

68 #ifde‡
WIN32


69 
LARGE_INTEGER
 
	gsûk_Timî_°¨t
[
sûk_NUM_TIMERS_MAX
];

71 
	gsûk_Timî_°¨t
[
sûk_NUM_TIMERS_MAX
];

73 
	gsûk_Timî_˙t
[
sûk_NUM_TIMERS_MAX
];

74 
›us_öt64
 
	gsûk_Timî_mö
[
sûk_NUM_TIMERS_MAX
];

75 
›us_öt64
 
	gsûk_Timî_sum
[
sûk_NUM_TIMERS_MAX
];

76 
›us_öt64
 
	gsûk_Timî_max
[
sûk_NUM_TIMERS_MAX
];

77 
›us_öt64
 
	gsûk_Timî_dïth
[
sûk_NUM_TIMERS_MAX
];

79 #ifde‡
WIN32


80 
	$sûk_TimîSave
(*
fûe_«me
)

82 if–
sûk_Timî_nTimîs
 > 0 )

84 
k
;

85 
FILE
 *
Â
;

86 
LARGE_INTEGER
 
ÕFªquícy
;

87 
LARGE_INTEGER
 
ÕPîf‹m™˚Cou¡1
, 
ÕPîf‹m™˚Cou¡2
;

88 
dñ
 = 0x7FFFFFFF;

89 
avg
, 
sum_avg
;

91  
k
 = 0; k < 1000; k++ ) {

92 
	`QuîyPîf‹m™˚Cou¡î
(&
ÕPîf‹m™˚Cou¡1
);

93 
	`QuîyPîf‹m™˚Cou¡î
(&
ÕPîf‹m™˚Cou¡2
);

94 
ÕPîf‹m™˚Cou¡2
.
QuadP¨t
 -
ÕPîf‹m™˚Cou¡1
.QuadPart;

95 if–()
ÕPîf‹m™˚Cou¡2
.
LowP¨t
 < 
dñ
 )

96 
dñ
 = 
ÕPîf‹m™˚Cou¡2
.
LowP¨t
;

98 
	`QuîyPîf‹m™˚Fªquícy
(&
ÕFªquícy
);

100 
sum_avg
 = 0.0f;

101  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) {

102 i‡(
sûk_Timî_dïth
[
k
] == 0) {

103 
sum_avg
 +(1e6 * 
sûk_Timî_sum
[
k
] / 
sûk_Timî_˙t
[k] - 
dñ
Ë/ 
ÕFªquícy
.
QuadP¨t
 * silk_Timer_cnt[k];

106 
Â
 = 
	`f›í
(
fûe_«me
, "w");

107 
	`Ârötf
(
Â
, " minávg %% max count\n");

108  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) {

109 i‡(
sûk_Timî_dïth
[
k
] == 0) {

110 
	`Ârötf
(
Â
, "%-28s", 
sûk_Timî_ègs
[
k
]);

111 } i‡(
sûk_Timî_dïth
[
k
] == 1) {

112 
	`Ârötf
(
Â
, " %-27s", 
sûk_Timî_ègs
[
k
]);

113 } i‡(
sûk_Timî_dïth
[
k
] == 2) {

114 
	`Ârötf
(
Â
, " %-26s", 
sûk_Timî_ègs
[
k
]);

115 } i‡(
sûk_Timî_dïth
[
k
] == 3) {

116 
	`Ârötf
(
Â
, " %-25s", 
sûk_Timî_ègs
[
k
]);

118 
	`Ârötf
(
Â
, " %-24s", 
sûk_Timî_ègs
[
k
]);

120 
avg
 = (1e6 * 
sûk_Timî_sum
[
k
] / 
sûk_Timî_˙t
[k] - 
dñ
Ë/ 
ÕFªquícy
.
QuadP¨t
;

121 
	`Ârötf
(
Â
, "%8.2f", (1e6 * (
	`sûk_max_64
(
sûk_Timî_mö
[
k
] - 
dñ
, 0))Ë/ 
ÕFªquícy
.
QuadP¨t
);

122 
	`Ârötf
(
Â
, "%12.2‡%6.2f", 
avg
, 100.0 *ávg / 
sum_avg
 * 
sûk_Timî_˙t
[
k
]);

123 
	`Ârötf
(
Â
, "%12.2f", (1e6 * (
	`sûk_max_64
(
sûk_Timî_max
[
k
] - 
dñ
, 0))Ë/ 
ÕFªquícy
.
QuadP¨t
);

124 
	`Ârötf
(
Â
, "%10d\n", 
sûk_Timî_˙t
[
k
]);

126 
	`Ârötf
(
Â
, " microseconds\n");

127 
	`f˛o£
(
Â
);

129 
	}
}

131 
	$sûk_TimîSave
(*
fûe_«me
)

133 if–
sûk_Timî_nTimîs
 > 0 )

135 
k
;

136 
FILE
 *
Â
;

138 
Â
 = 
	`f›í
(
fûe_«me
, "w");

139 
	`Ârötf
(
Â
, " minávg max count\n");

140  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ )

142 i‡(
sûk_Timî_dïth
[
k
] == 0) {

143 
	`Ârötf
(
Â
, "%-28s", 
sûk_Timî_ègs
[
k
]);

144 } i‡(
sûk_Timî_dïth
[
k
] == 1) {

145 
	`Ârötf
(
Â
, " %-27s", 
sûk_Timî_ègs
[
k
]);

146 } i‡(
sûk_Timî_dïth
[
k
] == 2) {

147 
	`Ârötf
(
Â
, " %-26s", 
sûk_Timî_ègs
[
k
]);

148 } i‡(
sûk_Timî_dïth
[
k
] == 3) {

149 
	`Ârötf
(
Â
, " %-25s", 
sûk_Timî_ègs
[
k
]);

151 
	`Ârötf
(
Â
, " %-24s", 
sûk_Timî_ègs
[
k
]);

153 
	`Ârötf
(
Â
, "%d ", 
sûk_Timî_mö
[
k
]);

154 
	`Ârötf
(
Â
, "%‡", ()
sûk_Timî_sum
[
k
] / ()
sûk_Timî_˙t
[k]);

155 
	`Ârötf
(
Â
, "%d ", 
sûk_Timî_max
[
k
]);

156 
	`Ârötf
(
Â
, "%10d\n", 
sûk_Timî_˙t
[
k
]);

158 
	`Ârötf
(
Â
, " microseconds\n");

159 
	`f˛o£
(
Â
);

161 
	}
}

166 #i‡
SILK_DEBUG


167 
FILE
 *
	gsûk_debug_°‹e_Â
[ 
sûk_NUM_STORES_MAX
 ];

168 
	gsûk_debug_°‹e_cou¡
 = 0;

	@silk/debug.h

28 #i‚de‡
SILK_DEBUG_H


29 
	#SILK_DEBUG_H


	)

31 
	~"ty≥def.h
"

32 
	~<°dio.h
>

33 
	~<°rög.h
>

35 #ifde‡ 
__˝lu•lus


40 
GëHighResﬁuti⁄Time
();

45 
	#SILK_DEBUG
 0

	)

48 
	#SILK_TIC_TOC
 0

	)

51 #i‡
SILK_TIC_TOC


53 #i‡(
deföed
(
_WIN32
Ë|| deföed(
_WINCE
))

54 
	~<wödows.h
>

56 
	~<sys/time.h
>

74 
sûk_TimîSave
(*
fûe_«me
);

77 
	#sûk_NUM_TIMERS_MAX
 50

	)

79 
	#sûk_NUM_TIMERS_MAX_TAG_LEN
 30

	)

81 
sûk_Timî_nTimîs
;

82 
sûk_Timî_dïth_˘r
;

83 
sûk_Timî_ègs
[
sûk_NUM_TIMERS_MAX
][
sûk_NUM_TIMERS_MAX_TAG_LEN
];

84 #ifde‡
_WIN32


85 
LARGE_INTEGER
 
sûk_Timî_°¨t
[
sûk_NUM_TIMERS_MAX
];

87 
sûk_Timî_°¨t
[
sûk_NUM_TIMERS_MAX
];

89 
sûk_Timî_˙t
[
sûk_NUM_TIMERS_MAX
];

90 
›us_öt64
 
sûk_Timî_sum
[
sûk_NUM_TIMERS_MAX
];

91 
›us_öt64
 
sûk_Timî_max
[
sûk_NUM_TIMERS_MAX
];

92 
›us_öt64
 
sûk_Timî_mö
[
sûk_NUM_TIMERS_MAX
];

93 
›us_öt64
 
sûk_Timî_dïth
[
sûk_NUM_TIMERS_MAX
];

96 #ifde‡
_WIN32


97 
	#TIC
(
TAG_NAME
) { \

98 
öô
 = 0; \

99 
ID
 = -1; \

100 if–
öô
 == 0 ) \

102 
k
; \

103 
öô
 = 1; \

104  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) { \

105 if–
	`°rcmp
(
sûk_Timî_ègs
[
k
], #TAG_NAME) == 0 ) { \

106 
ID
 = 
k
; \

110 i‡(
ID
 == -1) { \

111 
ID
 = 
sûk_Timî_nTimîs
; \

112 
sûk_Timî_nTimîs
++; \

113 
sûk_Timî_dïth
[
ID
] = 
sûk_Timî_dïth_˘r
; \

114 
	`°r˝y
(
sûk_Timî_ègs
[
ID
], #TAG_NAME); \

115 
sûk_Timî_˙t
[
ID
] = 0; \

116 
sûk_Timî_sum
[
ID
] = 0; \

117 
sûk_Timî_mö
[
ID
] = 0xFFFFFFFF; \

118 
sûk_Timî_max
[
ID
] = 0; \

121 
sûk_Timî_dïth_˘r
++; \

122 
	`QuîyPîf‹m™˚Cou¡î
(&
sûk_Timî_°¨t
[
ID
]); \

123 }

	)

125 
	#TIC
(
TAG_NAME
) { \

126 
öô
 = 0; \

127 
ID
 = -1; \

128 if–
öô
 == 0 ) \

130 
k
; \

131 
öô
 = 1; \

132  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) { \

133 if–
	`°rcmp
(
sûk_Timî_ègs
[
k
], #TAG_NAME) == 0 ) { \

134 
ID
 = 
k
; \

138 i‡(
ID
 == -1) { \

139 
ID
 = 
sûk_Timî_nTimîs
; \

140 
sûk_Timî_nTimîs
++; \

141 
sûk_Timî_dïth
[
ID
] = 
sûk_Timî_dïth_˘r
; \

142 
	`°r˝y
(
sûk_Timî_ègs
[
ID
], #TAG_NAME); \

143 
sûk_Timî_˙t
[
ID
] = 0; \

144 
sûk_Timî_sum
[
ID
] = 0; \

145 
sûk_Timî_mö
[
ID
] = 0xFFFFFFFF; \

146 
sûk_Timî_max
[
ID
] = 0; \

149 
sûk_Timî_dïth_˘r
++; \

150 
sûk_Timî_°¨t
[
ID
] = 
	`GëHighResﬁuti⁄Time
(); \

151 }

	)

154 #ifde‡
_WIN32


155 
	#TOC
(
TAG_NAME
) { \

156 
LARGE_INTEGER
 
ÕPîf‹m™˚Cou¡
; \

157 
öô
 = 0; \

158 
ID
 = 0; \

159 if–
öô
 == 0 ) \

161 
k
; \

162 
öô
 = 1; \

163  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) { \

164 if–
	`°rcmp
(
sûk_Timî_ègs
[
k
], #TAG_NAME) == 0 ) { \

165 
ID
 = 
k
; \

170 
	`QuîyPîf‹m™˚Cou¡î
(&
ÕPîf‹m™˚Cou¡
); \

171 
ÕPîf‹m™˚Cou¡
.
QuadP¨t
 -
sûk_Timî_°¨t
[
ID
].QuadPart; \

172 if((
ÕPîf‹m™˚Cou¡
.
QuadP¨t
 < 100000000) && \

173 (
ÕPîf‹m™˚Cou¡
.
QuadP¨t
 >= 0)) { \

174 
sûk_Timî_˙t
[
ID
]++; \

175 
sûk_Timî_sum
[
ID
] +
ÕPîf‹m™˚Cou¡
.
QuadP¨t
; \

176 if–
ÕPîf‹m™˚Cou¡
.
QuadP¨t
 > 
sûk_Timî_max
[
ID
] ) \

177 
sûk_Timî_max
[
ID
] = 
ÕPîf‹m™˚Cou¡
.
QuadP¨t
; \

178 if–
ÕPîf‹m™˚Cou¡
.
QuadP¨t
 < 
sûk_Timî_mö
[
ID
] ) \

179 
sûk_Timî_mö
[
ID
] = 
ÕPîf‹m™˚Cou¡
.
QuadP¨t
; \

181 
sûk_Timî_dïth_˘r
--; \

182 }

	)

184 
	#TOC
(
TAG_NAME
) { \

185 
ídTime
; \

186 
öô
 = 0; \

187 
ID
 = 0; \

188 if–
öô
 == 0 ) \

190 
k
; \

191 
öô
 = 1; \

192  
k
 = 0; k < 
sûk_Timî_nTimîs
; k++ ) { \

193 if–
	`°rcmp
(
sûk_Timî_ègs
[
k
], #TAG_NAME) == 0 ) { \

194 
ID
 = 
k
; \

199 
ídTime
 = 
	`GëHighResﬁuti⁄Time
(); \

200 
ídTime
 -
sûk_Timî_°¨t
[
ID
]; \

201 if((
ídTime
 < 100000000) && \

202 (
ídTime
 >= 0)) { \

203 
sûk_Timî_˙t
[
ID
]++; \

204 
sûk_Timî_sum
[
ID
] +
ídTime
; \

205 if–
ídTime
 > 
sûk_Timî_max
[
ID
] ) \

206 
sûk_Timî_max
[
ID
] = 
ídTime
; \

207 if–
ídTime
 < 
sûk_Timî_mö
[
ID
] ) \

208 
sûk_Timî_mö
[
ID
] = 
ídTime
; \

210 
sûk_Timî_dïth_˘r
--; \

211 }

	)

217 
	#TIC
(
TAG_NAME
)

	)

218 
	#TOC
(
TAG_NAME
)

	)

219 
	#sûk_TimîSave
(
FILE_NAME
)

	)

224 #i‡
SILK_DEBUG


230 
	#sûk_NUM_STORES_MAX
 100

	)

231 
FILE
 *
sûk_debug_°‹e_Â
[ 
sûk_NUM_STORES_MAX
 ];

232 
sûk_debug_°‹e_cou¡
;

235 
	#DEBUG_STORE_DATA
–
FILE_NAME
, 
DATA_PTR
, 
N_BYTES
 ) { \

236 
›us_öt
 
öô
 = 0, 
˙t
 = 0; \

237 
FILE
 **
Â
; \

238 i‡(
öô
 == 0) { \

239 
öô
 = 1; \

240 
˙t
 = 
sûk_debug_°‹e_cou¡
++; \

241 
sûk_debug_°‹e_Â
[ 
˙t
 ] = 
	`f›í
(#FILE_NAME, "wb"); \

243 
	`fwrôe
((
DATA_PTR
), (
N_BYTES
), 1, 
sûk_debug_°‹e_Â
[ 
˙t
 ]); \

244 }

	)

247 
	#SILK_DEBUG_STORE_CLOSE_FILES
 { \

248 
›us_öt
 
i
; \

249  
i
 = 0; i < 
sûk_debug_°‹e_cou¡
; i++ ) { \

250 
	`f˛o£
–
sûk_debug_°‹e_Â
[ 
i
 ] ); \

252 }

	)

257 
	#DEBUG_STORE_DATA
(
FILE_NAME
, 
DATA_PTR
, 
N_BYTES
)

	)

258 
	#SILK_DEBUG_STORE_CLOSE_FILES


	)

262 #ifde‡ 
__˝lu•lus


	@silk/dec_API.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

31 
	~"API.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"os_suµ‹t.h
"

40 
sûk_decodî_°©e
 
	mch™√l_°©e
[ 
DECODER_NUM_CHANNELS
 ];

41 
°îeo_dec_°©e
 
	msSãªo
;

42 
›us_öt
 
	mnCh™√lsAPI
;

43 
›us_öt
 
	mnCh™√lsI¡î«l
;

44 
›us_öt
 
	m¥ev_decode_⁄ly_middÀ
;

45 } 
	tsûk_decodî
;

51 
›us_öt
 
	$sûk_Gë_Decodî_Size
(

52 
›us_öt
 *
decSizeByãs


55 
›us_öt
 
ªt
 = 
SILK_NO_ERROR
;

57 *
decSizeByãs
 = –
sûk_decodî
 );

59  
ªt
;

60 
	}
}

63 
›us_öt
 
	$sûk_InôDecodî
(

64 *
decSèã


67 
›us_öt
 
n
, 
ªt
 = 
SILK_NO_ERROR
;

68 
sûk_decodî_°©e
 *
ch™√l_°©e
 = ((
sûk_decodî
 *)
decSèã
)->channel_state;

70  
n
 = 0;Ç < 
DECODER_NUM_CHANNELS
;Ç++ ) {

71 
ªt
 = 
	`sûk_öô_decodî
–&
ch™√l_°©e
[ 
n
 ] );

73 
	`sûk_mem£t
(&((
sûk_decodî
 *)
decSèã
)->
sSãªo
, 0, (((silk_decoder *)decState)->sStereo));

75 ((
sûk_decodî
 *)
decSèã
)->
¥ev_decode_⁄ly_middÀ
 = 0;

77  
ªt
;

78 
	}
}

81 
›us_öt
 
	$sûk_Decode
(

82 * 
decSèã
,

83 
sûk_DecC⁄åﬁSåu˘
* 
decC⁄åﬁ
,

84 
›us_öt
 
lo°Fœg
,

85 
›us_öt
 
√wPackëFœg
,

86 
ec_dec
 *
psR™geDec
,

87 
›us_öt16
 *
ßm∂esOut
,

88 
›us_öt32
 *
nSam∂esOut
,

89 
¨ch


92 
›us_öt
 
i
, 
n
, 
decode_⁄ly_middÀ
 = 0, 
ªt
 = 
SILK_NO_ERROR
;

93 
›us_öt32
 
nSam∂esOutDec
, 
LBRR_symbﬁ
;

94 
›us_öt16
 *
ßm∂esOut1_tmp
[ 2 ];

95 
	`VARDECL
–
›us_öt16
, 
ßm∂esOut1_tmp_°‹age1
 );

96 
	`VARDECL
–
›us_öt16
, 
ßm∂esOut1_tmp_°‹age2
 );

97 
	`VARDECL
–
›us_öt16
, 
ßm∂esOut2_tmp
 );

98 
›us_öt32
 
MS_¥ed_Q13
[ 2 ] = { 0 };

99 
›us_öt16
 *
ªßm∂e_out_±r
;

100 
sûk_decodî
 *
psDec
 = ( sûk_decodî * )
decSèã
;

101 
sûk_decodî_°©e
 *
ch™√l_°©e
 = 
psDec
->channel_state;

102 
›us_öt
 
has_side
;

103 
›us_öt
 
°îeo_to_m⁄o
;

104 
dñay_°ack_Æloc
;

105 
SAVE_STACK
;

107 
	`˚…_as£π
–
decC⁄åﬁ
->
nCh™√lsI¡î«l
 == 1 || decControl->nChannelsInternal == 2 );

112 if–
√wPackëFœg
 ) {

113  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

114 
ch™√l_°©e
[ 
n
 ].
nFømesDecoded
 = 0;

119 if–
decC⁄åﬁ
->
nCh™√lsI¡î«l
 > 
psDec
->nChannelsInternal ) {

120 
ªt
 +
	`sûk_öô_decodî
–&
ch™√l_°©e
[ 1 ] );

123 
°îeo_to_m⁄o
 = 
decC⁄åﬁ
->
nCh™√lsI¡î«l
 =1 && 
psDec
->nChannelsInternal == 2 &&

124 –
decC⁄åﬁ
->
öã∫ÆSam∂eR©e
 =1000*
ch™√l_°©e
[ 0 ].
fs_kHz
 );

126 if–
ch™√l_°©e
[ 0 ].
nFømesDecoded
 == 0 ) {

127  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

128 
›us_öt
 
fs_kHz_dec
;

129 if–
decC⁄åﬁ
->
∑ylﬂdSize_ms
 == 0 ) {

131 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 = 1;

132 
ch™√l_°©e
[ 
n
 ].
nb_sub‰
 = 2;

133 } if–
decC⁄åﬁ
->
∑ylﬂdSize_ms
 == 10 ) {

134 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 = 1;

135 
ch™√l_°©e
[ 
n
 ].
nb_sub‰
 = 2;

136 } if–
decC⁄åﬁ
->
∑ylﬂdSize_ms
 == 20 ) {

137 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 = 1;

138 
ch™√l_°©e
[ 
n
 ].
nb_sub‰
 = 4;

139 } if–
decC⁄åﬁ
->
∑ylﬂdSize_ms
 == 40 ) {

140 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 = 2;

141 
ch™√l_°©e
[ 
n
 ].
nb_sub‰
 = 4;

142 } if–
decC⁄åﬁ
->
∑ylﬂdSize_ms
 == 60 ) {

143 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 = 3;

144 
ch™√l_°©e
[ 
n
 ].
nb_sub‰
 = 4;

146 
	`˚…_as£π
( 0 );

147 
RESTORE_STACK
;

148  
SILK_DEC_INVALID_FRAME_SIZE
;

150 
fs_kHz_dec
 = ( 
decC⁄åﬁ
->
öã∫ÆSam∂eR©e
 >> 10 ) + 1;

151 if–
fs_kHz_dec
 != 8 && fs_kHz_dec != 12 && fs_kHz_dec != 16 ) {

152 
	`˚…_as£π
( 0 );

153 
RESTORE_STACK
;

154  
SILK_DEC_INVALID_SAMPLING_FREQUENCY
;

156 
ªt
 +
	`sûk_decodî_£t_fs
–&
ch™√l_°©e
[ 
n
 ], 
fs_kHz_dec
, 
decC⁄åﬁ
->
API_ßm∂eR©e
 );

160 if–
decC⁄åﬁ
->
nCh™√lsAPI
 =2 && decC⁄åﬁ->
nCh™√lsI¡î«l
 =2 && ( 
psDec
->nChannelsAPI == 1 ||ÖsDec->nChannelsInternal == 1 ) ) {

161 
	`sûk_mem£t
–
psDec
->
sSãªo
.
¥ed_¥ev_Q13
, 0, (ÖsDec->sStereo.pred_prev_Q13 ) );

162 
	`sûk_mem£t
–
psDec
->
sSãªo
.
sSide
, 0, (ÖsDec->sStereo.sSide ) );

163 
	`sûk_mem˝y
–&
ch™√l_°©e
[ 1 ].
ªßm∂î_°©e
, &ch™√l_°©e[ 0 ].ªßm∂î_°©e, –
sûk_ªßm∂î_°©e_°ru˘
 ) );

165 
psDec
->
nCh™√lsAPI
 = 
decC⁄åﬁ
->nChannelsAPI;

166 
psDec
->
nCh™√lsI¡î«l
 = 
decC⁄åﬁ
->nChannelsInternal;

168 if–
decC⁄åﬁ
->
API_ßm∂eR©e
 > (
›us_öt32
)
MAX_API_FS_KHZ
 * 1000 || decControl->API_sampleRate < 8000 ) {

169 
ªt
 = 
SILK_DEC_INVALID_SAMPLING_FREQUENCY
;

170 
RESTORE_STACK
;

171 –
ªt
 );

174 if–
lo°Fœg
 !
FLAG_PACKET_LOST
 && 
ch™√l_°©e
[ 0 ].
nFømesDecoded
 == 0 ) {

177  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

178  
i
 = 0; i < 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
; i++ ) {

179 
ch™√l_°©e
[ 
n
 ].
VAD_Êags
[ 
i
 ] = 
	`ec_dec_bô_logp
(
psR™geDec
, 1);

181 
ch™√l_°©e
[ 
n
 ].
LBRR_Êag
 = 
	`ec_dec_bô_logp
(
psR™geDec
, 1);

184  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

185 
	`sûk_mem£t
–
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
, 0, ( channel_state[Ç ].LBRR_flags ) );

186 if–
ch™√l_°©e
[ 
n
 ].
LBRR_Êag
 ) {

187 if–
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 == 1 ) {

188 
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
[ 0 ] = 1;

190 
LBRR_symbﬁ
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_LBRR_Êags_iCDF_±r
[ 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
 - 2 ], 8 ) + 1;

191  
i
 = 0; i < 
ch™√l_°©e
[ 
n
 ].
nFømesPîPackë
; i++ ) {

192 
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
[ 
i
 ] = 
	`sûk_RSHIFT
–
LBRR_symbﬁ
, i ) & 1;

198 if–
lo°Fœg
 =
FLAG_DECODE_NORMAL
 ) {

200  
i
 = 0; i < 
ch™√l_°©e
[ 0 ].
nFømesPîPackë
; i++ ) {

201  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

202 if–
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
[ 
i
 ] ) {

203 
›us_öt16
 
pul£s
[ 
MAX_FRAME_LENGTH
 ];

204 
›us_öt
 
c⁄dCodög
;

206 if–
decC⁄åﬁ
->
nCh™√lsI¡î«l
 =2 && 
n
 == 0 ) {

207 
	`sûk_°îeo_decode_¥ed
–
psR™geDec
, 
MS_¥ed_Q13
 );

208 if–
ch™√l_°©e
[ 1 ].
LBRR_Êags
[ 
i
 ] == 0 ) {

209 
	`sûk_°îeo_decode_mid_⁄ly
–
psR™geDec
, &
decode_⁄ly_middÀ
 );

213 if–
i
 > 0 && 
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
[ i - 1 ] ) {

214 
c⁄dCodög
 = 
CODE_CONDITIONALLY
;

216 
c⁄dCodög
 = 
CODE_INDEPENDENTLY
;

218 
	`sûk_decode_ödi˚s
–&
ch™√l_°©e
[ 
n
 ], 
psR™geDec
, 
i
, 1, 
c⁄dCodög
 );

219 
	`sûk_decode_pul£s
–
psR™geDec
, 
pul£s
, 
ch™√l_°©e
[ 
n
 ].
ödi˚s
.
sig«lTy≥
,

220 
ch™√l_°©e
[ 
n
 ].
ödi˚s
.
qu™tOff£tTy≥
, ch™√l_°©e[Ç ].
‰ame_Àngth
 );

228 if–
decC⁄åﬁ
->
nCh™√lsI¡î«l
 == 2 ) {

229 if–
lo°Fœg
 =
FLAG_DECODE_NORMAL
 ||

230 –
lo°Fœg
 =
FLAG_DECODE_LBRR
 && 
ch™√l_°©e
[ 0 ].
LBRR_Êags
[ ch™√l_°©e[ 0 ].
nFømesDecoded
 ] == 1 ) )

232 
	`sûk_°îeo_decode_¥ed
–
psR™geDec
, 
MS_¥ed_Q13
 );

234 if––
lo°Fœg
 =
FLAG_DECODE_NORMAL
 && 
ch™√l_°©e
[ 1 ].
VAD_Êags
[ ch™√l_°©e[ 0 ].
nFømesDecoded
 ] == 0 ) ||

235 –
lo°Fœg
 =
FLAG_DECODE_LBRR
 && 
ch™√l_°©e
[ 1 ].
LBRR_Êags
[ ch™√l_°©e[ 0 ].
nFømesDecoded
 ] == 0 ) )

237 
	`sûk_°îeo_decode_mid_⁄ly
–
psR™geDec
, &
decode_⁄ly_middÀ
 );

239 
decode_⁄ly_middÀ
 = 0;

242  
n
 = 0;Ç < 2;Ç++ ) {

243 
MS_¥ed_Q13
[ 
n
 ] = 
psDec
->
sSãªo
.
¥ed_¥ev_Q13
[Ç ];

249 if–
decC⁄åﬁ
->
nCh™√lsI¡î«l
 =2 && 
decode_⁄ly_middÀ
 =0 && 
psDec
->
¥ev_decode_⁄ly_middÀ
 == 1 ) {

250 
	`sûk_mem£t
–
psDec
->
ch™√l_°©e
[ 1 ].
outBuf
, 0, (psDec->channel_state[ 1 ].outBuf) );

251 
	`sûk_mem£t
–
psDec
->
ch™√l_°©e
[ 1 ].
sLPC_Q14_buf
, 0, (psDec->channel_state[ 1 ].sLPC_Q14_buf) );

252 
psDec
->
ch™√l_°©e
[ 1 ].
œgPªv
 = 100;

253 
psDec
->
ch™√l_°©e
[ 1 ].
La°GaöIndex
 = 10;

254 
psDec
->
ch™√l_°©e
[ 1 ].
¥evSig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

255 
psDec
->
ch™√l_°©e
[ 1 ].
fú°_‰ame_a·î_ª£t
 = 1;

261 
dñay_°ack_Æloc
 = 
decC⁄åﬁ
->
öã∫ÆSam∂eR©e
*decC⁄åﬁ->
nCh™√lsI¡î«l


262 < 
decC⁄åﬁ
->
API_ßm∂eR©e
*decC⁄åﬁ->
nCh™√lsAPI
;

263 
	`ALLOC
–
ßm∂esOut1_tmp_°‹age1
, 
dñay_°ack_Æloc
 ? 
ALLOC_NONE


264 : 
decC⁄åﬁ
->
nCh™√lsI¡î«l
*(
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2 ),

265 
›us_öt16
 );

266 i‡–
dñay_°ack_Æloc
 )

268 
ßm∂esOut1_tmp
[ 0 ] = 
ßm∂esOut
;

269 
ßm∂esOut1_tmp
[ 1 ] = 
ßm∂esOut
 + 
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2;

271 
ßm∂esOut1_tmp
[ 0 ] = 
ßm∂esOut1_tmp_°‹age1
;

272 
ßm∂esOut1_tmp
[ 1 ] = 
ßm∂esOut1_tmp_°‹age1
 + 
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2;

275 if–
lo°Fœg
 =
FLAG_DECODE_NORMAL
 ) {

276 
has_side
 = !
decode_⁄ly_middÀ
;

278 
has_side
 = !
psDec
->
¥ev_decode_⁄ly_middÀ


279 || (
decC⁄åﬁ
->
nCh™√lsI¡î«l
 =2 && 
lo°Fœg
 =
FLAG_DECODE_LBRR
 && 
ch™√l_°©e
[1].
LBRR_Êags
[ ch™√l_°©e[1].
nFømesDecoded
 ] == 1 );

282  
n
 = 0;Ç < 
decC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

283 if–
n
 =0 || 
has_side
 ) {

284 
›us_öt
 
FømeIndex
;

285 
›us_öt
 
c⁄dCodög
;

287 
FømeIndex
 = 
ch™√l_°©e
[ 0 ].
nFømesDecoded
 - 
n
;

289 if–
FømeIndex
 <= 0 ) {

290 
c⁄dCodög
 = 
CODE_INDEPENDENTLY
;

291 } if–
lo°Fœg
 =
FLAG_DECODE_LBRR
 ) {

292 
c⁄dCodög
 = 
ch™√l_°©e
[ 
n
 ].
LBRR_Êags
[ 
FømeIndex
 - 1 ] ? 
CODE_CONDITIONALLY
 : 
CODE_INDEPENDENTLY
;

293 } if–
n
 > 0 && 
psDec
->
¥ev_decode_⁄ly_middÀ
 ) {

296 
c⁄dCodög
 = 
CODE_INDEPENDENTLY_NO_LTP_SCALING
;

298 
c⁄dCodög
 = 
CODE_CONDITIONALLY
;

300 
ªt
 +
	`sûk_decode_‰ame
–&
ch™√l_°©e
[ 
n
 ], 
psR™geDec
, &
ßm∂esOut1_tmp
[Ç ][ 2 ], &
nSam∂esOutDec
, 
lo°Fœg
, 
c⁄dCodög
, 
¨ch
);

302 
	`sûk_mem£t
–&
ßm∂esOut1_tmp
[ 
n
 ][ 2 ], 0, 
nSam∂esOutDec
 * –
›us_öt16
 ) );

304 
ch™√l_°©e
[ 
n
 ].
nFømesDecoded
++;

307 if–
decC⁄åﬁ
->
nCh™√lsAPI
 =2 && decC⁄åﬁ->
nCh™√lsI¡î«l
 == 2 ) {

309 
	`sûk_°îeo_MS_to_LR
–&
psDec
->
sSãªo
, 
ßm∂esOut1_tmp
[ 0 ], sam∂esOut1_tmp[ 1 ], 
MS_¥ed_Q13
, 
ch™√l_°©e
[ 0 ].
fs_kHz
, 
nSam∂esOutDec
 );

312 
	`sûk_mem˝y
–
ßm∂esOut1_tmp
[ 0 ], 
psDec
->
sSãªo
.
sMid
, 2 * –
›us_öt16
 ) );

313 
	`sûk_mem˝y
–
psDec
->
sSãªo
.
sMid
, &
ßm∂esOut1_tmp
[ 0 ][ 
nSam∂esOutDec
 ], 2 * –
›us_öt16
 ) );

317 *
nSam∂esOut
 = 
	`sûk_DIV32
–
nSam∂esOutDec
 * 
decC⁄åﬁ
->
API_ßm∂eR©e
, 
	`sûk_SMULBB
–
ch™√l_°©e
[ 0 ].
fs_kHz
, 1000 ) );

320 
	`ALLOC
–
ßm∂esOut2_tmp
,

321 
decC⁄åﬁ
->
nCh™√lsAPI
 =2 ? *
nSam∂esOut
 : 
ALLOC_NONE
, 
›us_öt16
 );

322 if–
decC⁄åﬁ
->
nCh™√lsAPI
 == 2 ) {

323 
ªßm∂e_out_±r
 = 
ßm∂esOut2_tmp
;

325 
ªßm∂e_out_±r
 = 
ßm∂esOut
;

328 
	`ALLOC
–
ßm∂esOut1_tmp_°‹age2
, 
dñay_°ack_Æloc


329 ? 
decC⁄åﬁ
->
nCh™√lsI¡î«l
*(
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2 )

330 : 
ALLOC_NONE
,

331 
›us_öt16
 );

332 i‡–
dñay_°ack_Æloc
 ) {

333 
	`OPUS_COPY
(
ßm∂esOut1_tmp_°‹age2
, 
ßm∂esOut
, 
decC⁄åﬁ
->
nCh™√lsI¡î«l
*(
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2));

334 
ßm∂esOut1_tmp
[ 0 ] = 
ßm∂esOut1_tmp_°‹age2
;

335 
ßm∂esOut1_tmp
[ 1 ] = 
ßm∂esOut1_tmp_°‹age2
 + 
ch™√l_°©e
[ 0 ].
‰ame_Àngth
 + 2;

337  
n
 = 0;Ç < 
	`sûk_mö
–
decC⁄åﬁ
->
nCh™√lsAPI
, decC⁄åﬁ->
nCh™√lsI¡î«l
 );Ç++ ) {

340 
ªt
 +
	`sûk_ªßm∂î
–&
ch™√l_°©e
[ 
n
 ].
ªßm∂î_°©e
, 
ªßm∂e_out_±r
, &
ßm∂esOut1_tmp
[Ç ][ 1 ], 
nSam∂esOutDec
 );

343 if–
decC⁄åﬁ
->
nCh™√lsAPI
 == 2 ) {

344  
i
 = 0; i < *
nSam∂esOut
; i++ ) {

345 
ßm∂esOut
[ 
n
 + 2 * 
i
 ] = 
ªßm∂e_out_±r
[ i ];

351 if–
decC⁄åﬁ
->
nCh™√lsAPI
 =2 && decC⁄åﬁ->
nCh™√lsI¡î«l
 == 1 ) {

352 i‡–
°îeo_to_m⁄o
 ){

355 
ªt
 +
	`sûk_ªßm∂î
–&
ch™√l_°©e
[ 1 ].
ªßm∂î_°©e
, 
ªßm∂e_out_±r
, &
ßm∂esOut1_tmp
[ 0 ][ 1 ], 
nSam∂esOutDec
 );

357  
i
 = 0; i < *
nSam∂esOut
; i++ ) {

358 
ßm∂esOut
[ 1 + 2 * 
i
 ] = 
ªßm∂e_out_±r
[ i ];

361  
i
 = 0; i < *
nSam∂esOut
; i++ ) {

362 
ßm∂esOut
[ 1 + 2 * 
i
 ] = samplesOut[ 0 + 2 * i ];

368 if–
ch™√l_°©e
[ 0 ].
¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

369 
mu…_èb
[ 3 ] = { 6, 4, 3 };

370 
decC⁄åﬁ
->
¥evPôchLag
 = 
ch™√l_°©e
[ 0 ].
œgPªv
 * 
mu…_èb
[ ( ch™√l_°©e[ 0 ].
fs_kHz
 - 8 ) >> 2 ];

372 
decC⁄åﬁ
->
¥evPôchLag
 = 0;

375 if–
lo°Fœg
 =
FLAG_PACKET_LOST
 ) {

378  
i
 = 0; i < 
psDec
->
nCh™√lsI¡î«l
; i++ )

379 
psDec
->
ch™√l_°©e
[ 
i
 ].
La°GaöIndex
 = 10;

381 
psDec
->
¥ev_decode_⁄ly_middÀ
 = 
decode_⁄ly_middÀ
;

383 
RESTORE_STACK
;

384  
ªt
;

385 
	}
}

389 
›us_öt
 
	$sûk_gë_TOC
(

390 c⁄° 
›us_uöt8
 *
∑ylﬂd
,

391 c⁄° 
›us_öt
 
nByãsIn
,

392 c⁄° 
›us_öt
 
nFømesPîPaylﬂd
,

393 
sûk_TOC_°ru˘
 *
Sûk_TOC


396 
›us_öt
 
i
, 
Êags
, 
ªt
 = 
SILK_NO_ERROR
;

398 if–
nByãsIn
 < 1 ) {

401 if–
nFømesPîPaylﬂd
 < 0 ||ÇFramesPerPayload > 3 ) {

405 
	`sûk_mem£t
–
Sûk_TOC
, 0, ( *Silk_TOC ) );

408 
Êags
 = 
	`sûk_RSHIFT
–
∑ylﬂd
[ 0 ], 7 - 
nFømesPîPaylﬂd
 ) & ( 
	`sûk_LSHIFT
( 1,ÇFramesPerPayload + 1 ) - 1 );

410 
Sûk_TOC
->
öb™dFECFœg
 = 
Êags
 & 1;

411  
i
 = 
nFømesPîPaylﬂd
 - 1; i >= 0 ; i-- ) {

412 
Êags
 = 
	`sûk_RSHIFT
( flags, 1 );

413 
Sûk_TOC
->
VADFœgs
[ 
i
 ] = 
Êags
 & 1;

414 
Sûk_TOC
->
VADFœg
 |
Êags
 & 1;

417  
ªt
;

418 
	}
}

	@silk/decode_core.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

38 
	$sûk_decode_c‹e
(

39 
sûk_decodî_°©e
 *
psDec
,

40 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

41 
›us_öt16
 
xq
[],

42 c⁄° 
›us_öt16
 
pul£s
[ 
MAX_FRAME_LENGTH
 ],

43 
¨ch


46 
›us_öt
 
i
, 
k
, 
œg
 = 0, 
°¨t_idx
, 
sLTP_buf_idx
, 
NLSF_öãΩﬁ©i⁄_Êag
, 
sig«lTy≥
;

47 
›us_öt16
 *
A_Q12
, *
B_Q14
, *
pxq
, 
A_Q12_tmp
[ 
MAX_LPC_ORDER
 ];

48 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

49 
	`VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

50 
›us_öt32
 
LTP_¥ed_Q13
, 
LPC_¥ed_Q10
, 
Gaö_Q10
, 
öv_gaö_Q31
, 
gaö_adj_Q16
, 
ønd_£ed
, 
off£t_Q10
;

51 
›us_öt32
 *
¥ed_œg_±r
, *
≥xc_Q14
, *
¥es_Q14
;

52 
	`VARDECL
–
›us_öt32
, 
ªs_Q14
 );

53 
	`VARDECL
–
›us_öt32
, 
sLPC_Q14
 );

54 
SAVE_STACK
;

56 
	`sûk_as£π
–
psDec
->
¥ev_gaö_Q16
 != 0 );

58 
	`ALLOC
–
sLTP
, 
psDec
->
…p_mem_Àngth
, 
›us_öt16
 );

59 
	`ALLOC
–
sLTP_Q15
, 
psDec
->
…p_mem_Àngth
 +ÖsDec->
‰ame_Àngth
, 
›us_öt32
 );

60 
	`ALLOC
–
ªs_Q14
, 
psDec
->
sub‰_Àngth
, 
›us_öt32
 );

61 
	`ALLOC
–
sLPC_Q14
, 
psDec
->
sub‰_Àngth
 + 
MAX_LPC_ORDER
, 
›us_öt32
 );

63 
off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psDec
->
ödi˚s
.
sig«lTy≥
 >> 1 ][ÖsDec->ödi˚s.
qu™tOff£tTy≥
 ];

65 if–
psDec
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 < 1 << 2 ) {

66 
NLSF_öãΩﬁ©i⁄_Êag
 = 1;

68 
NLSF_öãΩﬁ©i⁄_Êag
 = 0;

72 
ønd_£ed
 = 
psDec
->
ödi˚s
.
Sìd
;

73  
i
 = 0; i < 
psDec
->
‰ame_Àngth
; i++ ) {

74 
ønd_£ed
 = 
	`sûk_RAND
(Ñand_seed );

75 
psDec
->
exc_Q14
[ 
i
 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
pul£s
[ i ], 14 );

76 if–
psDec
->
exc_Q14
[ 
i
 ] > 0 ) {

77 
psDec
->
exc_Q14
[ 
i
 ] -
QUANT_LEVEL_ADJUST_Q10
 << 4;

79 if–
psDec
->
exc_Q14
[ 
i
 ] < 0 ) {

80 
psDec
->
exc_Q14
[ 
i
 ] +
QUANT_LEVEL_ADJUST_Q10
 << 4;

82 
psDec
->
exc_Q14
[ 
i
 ] +
off£t_Q10
 << 4;

83 if–
ønd_£ed
 < 0 ) {

84 
psDec
->
exc_Q14
[ 
i
 ] = -psDec->exc_Q14[ i ];

87 
ønd_£ed
 = 
	`sûk_ADD32_ovÊw
–ønd_£ed, 
pul£s
[ 
i
 ] );

91 
	`sûk_mem˝y
–
sLPC_Q14
, 
psDec
->
sLPC_Q14_buf
, 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

93 
≥xc_Q14
 = 
psDec
->
exc_Q14
;

94 
pxq
 = 
xq
;

95 
sLTP_buf_idx
 = 
psDec
->
…p_mem_Àngth
;

97  
k
 = 0; k < 
psDec
->
nb_sub‰
; k++ ) {

98 
¥es_Q14
 = 
ªs_Q14
;

99 
A_Q12
 = 
psDecCål
->
PªdC€f_Q12
[ 
k
 >> 1 ];

102 
	`sûk_mem˝y
–
A_Q12_tmp
, 
A_Q12
, 
psDec
->
LPC_‹dî
 * –
›us_öt16
 ) );

103 
B_Q14
 = &
psDecCål
->
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

104 
sig«lTy≥
 = 
psDec
->
ödi˚s
.signalType;

106 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
psDecCål
->
Gaös_Q16
[ 
k
 ], 6 );

107 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
psDecCål
->
Gaös_Q16
[ 
k
 ], 47 );

110 if–
psDecCål
->
Gaös_Q16
[ 
k
 ] !
psDec
->
¥ev_gaö_Q16
 ) {

111 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
psDec
->
¥ev_gaö_Q16
, 
psDecCål
->
Gaös_Q16
[ 
k
 ], 16 );

114  
i
 = 0; i < 
MAX_LPC_ORDER
; i++ ) {

115 
sLPC_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLPC_Q14[ i ] );

118 
gaö_adj_Q16
 = (
›us_öt32
)1 << 16;

122 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

123 
psDec
->
¥ev_gaö_Q16
 = 
psDecCål
->
Gaös_Q16
[ 
k
 ];

126 if–
psDec
->
lossC¡
 &&ÖsDec->
¥evSig«lTy≥
 =
TYPE_VOICED
 &&

127 
psDec
->
ödi˚s
.
sig«lTy≥
 !
TYPE_VOICED
 && 
k
 < 
MAX_NB_SUBFR
/2 ) {

129 
	`sûk_mem£t
–
B_Q14
, 0, 
LTP_ORDER
 * –
›us_öt16
 ) );

130 
B_Q14
[ 
LTP_ORDER
/2 ] = 
	`SILK_FIX_CONST
( 0.25, 14 );

132 
sig«lTy≥
 = 
TYPE_VOICED
;

133 
psDecCål
->
pôchL
[ 
k
 ] = 
psDec
->
œgPªv
;

136 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

138 
œg
 = 
psDecCål
->
pôchL
[ 
k
 ];

141 if–
k
 =0 || ( k =2 && 
NLSF_öãΩﬁ©i⁄_Êag
 ) ) {

143 
°¨t_idx
 = 
psDec
->
…p_mem_Àngth
 - 
œg
 -ÖsDec->
LPC_‹dî
 - 
LTP_ORDER
 / 2;

144 
	`˚…_as£π
–
°¨t_idx
 > 0 );

146 if–
k
 == 2 ) {

147 
	`sûk_mem˝y
–&
psDec
->
outBuf
[ÖsDec->
…p_mem_Àngth
 ], 
xq
, 2 *ÖsDec->
sub‰_Àngth
 * –
›us_öt16
 ) );

150 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
psDec
->
outBuf
[ sèπ_idx + 
k
 *ÖsDec->
sub‰_Àngth
 ],

151 
A_Q12
, 
psDec
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsDec->
LPC_‹dî
, 
¨ch
 );

154 if–
k
 == 0 ) {

156 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
psDecCål
->
LTP_sˇÀ_Q14
 ), 2 );

158  
i
 = 0; i < 
œg
 + 
LTP_ORDER
/2; i++ ) {

159 
sLTP_Q15
[ 
sLTP_buf_idx
 - 
i
 - 1 ] = 
	`sûk_SMULWB
–
öv_gaö_Q31
, 
sLTP
[ 
psDec
->
…p_mem_Àngth
 - i - 1 ] );

163 if–
gaö_adj_Q16
 !(
›us_öt32
)1 << 16 ) {

164  
i
 = 0; i < 
œg
 + 
LTP_ORDER
/2; i++ ) {

165 
sLTP_Q15
[ 
sLTP_buf_idx
 - 
i
 - 1 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ sLTP_buf_idx - i - 1 ] );

172 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

174 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

175  
i
 = 0; i < 
psDec
->
sub‰_Àngth
; i++ ) {

178 
LTP_¥ed_Q13
 = 2;

179 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ 0 ], 
B_Q14
[ 0 ] );

180 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -1 ], 
B_Q14
[ 1 ] );

181 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -2 ], 
B_Q14
[ 2 ] );

182 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -3 ], 
B_Q14
[ 3 ] );

183 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -4 ], 
B_Q14
[ 4 ] );

184 
¥ed_œg_±r
++;

187 
¥es_Q14
[ 
i
 ] = 
	`sûk_ADD_LSHIFT32
–
≥xc_Q14
[ i ], 
LTP_¥ed_Q13
, 1 );

190 
sLTP_Q15
[ 
sLTP_buf_idx
 ] = 
	`sûk_LSHIFT
–
¥es_Q14
[ 
i
 ], 1 );

191 
sLTP_buf_idx
++;

194 
¥es_Q14
 = 
≥xc_Q14
;

197  
i
 = 0; i < 
psDec
->
sub‰_Àngth
; i++ ) {

199 
	`˚…_as£π
–
psDec
->
LPC_‹dî
 == 10 ||ÖsDec->LPC_order == 16 );

201 
LPC_¥ed_Q10
 = 
	`sûk_RSHIFT
–
psDec
->
LPC_‹dî
, 1 );

202 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 1 ], 
A_Q12_tmp
[ 0 ] );

203 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 2 ], 
A_Q12_tmp
[ 1 ] );

204 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 3 ], 
A_Q12_tmp
[ 2 ] );

205 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 4 ], 
A_Q12_tmp
[ 3 ] );

206 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 5 ], 
A_Q12_tmp
[ 4 ] );

207 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 6 ], 
A_Q12_tmp
[ 5 ] );

208 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 7 ], 
A_Q12_tmp
[ 6 ] );

209 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 8 ], 
A_Q12_tmp
[ 7 ] );

210 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 9 ], 
A_Q12_tmp
[ 8 ] );

211 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 10 ], 
A_Q12_tmp
[ 9 ] );

212 if–
psDec
->
LPC_‹dî
 == 16 ) {

213 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 11 ], 
A_Q12_tmp
[ 10 ] );

214 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 12 ], 
A_Q12_tmp
[ 11 ] );

215 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 13 ], 
A_Q12_tmp
[ 12 ] );

216 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 14 ], 
A_Q12_tmp
[ 13 ] );

217 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 15 ], 
A_Q12_tmp
[ 14 ] );

218 
LPC_¥ed_Q10
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q10, 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 - 16 ], 
A_Q12_tmp
[ 15 ] );

222 
sLPC_Q14
[ 
MAX_LPC_ORDER
 + 
i
 ] = 
	`sûk_ADD_SAT32
–
¥es_Q14
[ i ], 
	`sûk_LSHIFT_SAT32
–
LPC_¥ed_Q10
, 4 ) );

225 
pxq
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
sLPC_Q14
[ 
MAX_LPC_ORDER
 + i ], 
Gaö_Q10
 ), 8 ) );

229 
	`sûk_mem˝y
–
sLPC_Q14
, &sLPC_Q14[ 
psDec
->
sub‰_Àngth
 ], 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

230 
≥xc_Q14
 +
psDec
->
sub‰_Àngth
;

231 
pxq
 +
psDec
->
sub‰_Àngth
;

235 
	`sûk_mem˝y
–
psDec
->
sLPC_Q14_buf
, 
sLPC_Q14
, 
MAX_LPC_ORDER
 * –
›us_öt32
 ) );

236 
RESTORE_STACK
;

237 
	}
}

	@silk/decode_frame.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"PLC.h
"

39 
›us_öt
 
	$sûk_decode_‰ame
(

40 
sûk_decodî_°©e
 *
psDec
,

41 
ec_dec
 *
psR™geDec
,

42 
›us_öt16
 
pOut
[],

43 
›us_öt32
 *
pN
,

44 
›us_öt
 
lo°Fœg
,

45 
›us_öt
 
c⁄dCodög
,

46 
¨ch


49 
	`VARDECL
–
sûk_decodî_c⁄åﬁ
, 
psDecCål
 );

50 
›us_öt
 
L
, 
mv_Àn
, 
ªt
 = 0;

51 
SAVE_STACK
;

53 
L
 = 
psDec
->
‰ame_Àngth
;

54 
	`ALLOC
–
psDecCål
, 1, 
sûk_decodî_c⁄åﬁ
 );

55 
psDecCål
->
LTP_sˇÀ_Q14
 = 0;

58 
	`˚…_as£π
–
L
 > 0 && L <
MAX_FRAME_LENGTH
 );

60 if–
lo°Fœg
 =
FLAG_DECODE_NORMAL
 ||

61 –
lo°Fœg
 =
FLAG_DECODE_LBRR
 && 
psDec
->
LBRR_Êags
[ÖsDec->
nFømesDecoded
 ] == 1 ) )

63 
	`VARDECL
–
›us_öt16
, 
pul£s
 );

64 
	`ALLOC
–
pul£s
, (
L
 + 
SHELL_CODEC_FRAME_LENGTH
 - 1) &

65 ~(
SHELL_CODEC_FRAME_LENGTH
 - 1), 
›us_öt16
 );

69 
	`sûk_decode_ödi˚s
–
psDec
, 
psR™geDec
,ÖsDec->
nFømesDecoded
, 
lo°Fœg
, 
c⁄dCodög
 );

74 
	`sûk_decode_pul£s
–
psR™geDec
, 
pul£s
, 
psDec
->
ödi˚s
.
sig«lTy≥
,

75 
psDec
->
ödi˚s
.
qu™tOff£tTy≥
,ÖsDec->
‰ame_Àngth
 );

80 
	`sûk_decode_∑ømëîs
–
psDec
, 
psDecCål
, 
c⁄dCodög
 );

85 
	`sûk_decode_c‹e
–
psDec
, 
psDecCål
, 
pOut
, 
pul£s
, 
¨ch
 );

90 
	`sûk_PLC
–
psDec
, 
psDecCål
, 
pOut
, 0, 
¨ch
 );

92 
psDec
->
lossC¡
 = 0;

93 
psDec
->
¥evSig«lTy≥
 =ÖsDec->
ödi˚s
.
sig«lTy≥
;

94 
	`˚…_as£π
–
psDec
->
¥evSig«lTy≥
 >= 0 &&ÖsDec->prevSignalType <= 2 );

97 
psDec
->
fú°_‰ame_a·î_ª£t
 = 0;

100 
psDec
->
ödi˚s
.
sig«lTy≥
 =ÖsDec->
¥evSig«lTy≥
;

101 
	`sûk_PLC
–
psDec
, 
psDecCål
, 
pOut
, 1, 
¨ch
 );

107 
	`˚…_as£π
–
psDec
->
…p_mem_Àngth
 >psDec->
‰ame_Àngth
 );

108 
mv_Àn
 = 
psDec
->
…p_mem_Àngth
 -ÖsDec->
‰ame_Àngth
;

109 
	`sûk_memmove
–
psDec
->
outBuf
, &psDec->outBuf[ÖsDec->
‰ame_Àngth
 ], 
mv_Àn
 * (
›us_öt16
) );

110 
	`sûk_mem˝y
–&
psDec
->
outBuf
[ 
mv_Àn
 ], 
pOut
,ÖsDec->
‰ame_Àngth
 * –
›us_öt16
 ) );

115 
	`sûk_CNG
–
psDec
, 
psDecCål
, 
pOut
, 
L
 );

120 
	`sûk_PLC_glue_‰ames
–
psDec
, 
pOut
, 
L
 );

123 
psDec
->
œgPªv
 = 
psDecCål
->
pôchL
[ÖsDec->
nb_sub‰
 - 1 ];

126 *
pN
 = 
L
;

128 
RESTORE_STACK
;

129  
ªt
;

130 
	}
}

	@silk/decode_indices.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_decode_ödi˚s
(

36 
sûk_decodî_°©e
 *
psDec
,

37 
ec_dec
 *
psR™geDec
,

38 
›us_öt
 
FømeIndex
,

39 
›us_öt
 
decode_LBRR
,

40 
›us_öt
 
c⁄dCodög


43 
›us_öt
 
i
, 
k
, 
Ix
;

44 
›us_öt
 
decode_absﬁuã_œgIndex
, 
dñè_œgIndex
;

45 
›us_öt16
 
ec_ix
[ 
MAX_LPC_ORDER
 ];

46 
›us_uöt8
 
¥ed_Q8
[ 
MAX_LPC_ORDER
 ];

51 if–
decode_LBRR
 || 
psDec
->
VAD_Êags
[ 
FømeIndex
 ] ) {

52 
Ix
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_ty≥_off£t_VAD_iCDF
, 8 ) + 2;

54 
Ix
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_ty≥_off£t_no_VAD_iCDF
, 8 );

56 
psDec
->
ödi˚s
.
sig«lTy≥
 = (
›us_öt8
)
	`sûk_RSHIFT
–
Ix
, 1 );

57 
psDec
->
ödi˚s
.
qu™tOff£tTy≥
 = (
›us_öt8
)–
Ix
 & 1 );

63 if–
c⁄dCodög
 =
CODE_CONDITIONALLY
 ) {

65 
psDec
->
ödi˚s
.
GaösIndi˚s
[ 0 ] = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_dñè_gaö_iCDF
, 8 );

68 
psDec
->
ödi˚s
.
GaösIndi˚s
[ 0 ] = (
›us_öt8
)
	`sûk_LSHIFT
–
	`ec_dec_icdf
–
psR™geDec
, 
sûk_gaö_iCDF
[ÖsDec->ödi˚s.
sig«lTy≥
 ], 8 ), 3 );

69 
psDec
->
ödi˚s
.
GaösIndi˚s
[ 0 ] +(
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_unif‹m8_iCDF
, 8 );

73  
i
 = 1; i < 
psDec
->
nb_sub‰
; i++ ) {

74 
psDec
->
ödi˚s
.
GaösIndi˚s
[ 
i
 ] = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_dñè_gaö_iCDF
, 8 );

80 
psDec
->
ödi˚s
.
NLSFIndi˚s
[ 0 ] = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, &psDec->
psNLSF_CB
->
CB1_iCDF
[ (ÖsDec->ödi˚s.
sig«lTy≥
 >> 1 ) *ÖsDec->psNLSF_CB->
nVe˘‹s
 ], 8 );

81 
	`sûk_NLSF_u≈ack
–
ec_ix
, 
¥ed_Q8
, 
psDec
->
psNLSF_CB
,ÖsDec->
ödi˚s
.
NLSFIndi˚s
[ 0 ] );

82 
	`˚…_as£π
–
psDec
->
psNLSF_CB
->
‹dî
 =psDec->
LPC_‹dî
 );

83  
i
 = 0; i < 
psDec
->
psNLSF_CB
->
‹dî
; i++ ) {

84 
Ix
 = 
	`ec_dec_icdf
–
psR™geDec
, &
psDec
->
psNLSF_CB
->
ec_iCDF
[ 
ec_ix
[ 
i
 ] ], 8 );

85 if–
Ix
 == 0 ) {

86 
Ix
 -
	`ec_dec_icdf
–
psR™geDec
, 
sûk_NLSF_EXT_iCDF
, 8 );

87 } if–
Ix
 =2 * 
NLSF_QUANT_MAX_AMPLITUDE
 ) {

88 
Ix
 +
	`ec_dec_icdf
–
psR™geDec
, 
sûk_NLSF_EXT_iCDF
, 8 );

90 
psDec
->
ödi˚s
.
NLSFIndi˚s
[ 
i
+1 ] = (
›us_öt8
)–
Ix
 - 
NLSF_QUANT_MAX_AMPLITUDE
 );

94 if–
psDec
->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

95 
psDec
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_NLSF_öãΩﬁ©i⁄_Á˘‹_iCDF
, 8 );

97 
psDec
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = 4;

100 if–
psDec
->
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 )

106 
decode_absﬁuã_œgIndex
 = 1;

107 if–
c⁄dCodög
 =
CODE_CONDITIONALLY
 && 
psDec
->
ec_¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

109 
dñè_œgIndex
 = (
›us_öt16
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_pôch_dñè_iCDF
, 8 );

110 if–
dñè_œgIndex
 > 0 ) {

111 
dñè_œgIndex
 = delta_lagIndex - 9;

112 
psDec
->
ödi˚s
.
œgIndex
 = (
›us_öt16
)–psDec->
ec_¥evLagIndex
 + 
dñè_œgIndex
 );

113 
decode_absﬁuã_œgIndex
 = 0;

116 if–
decode_absﬁuã_œgIndex
 ) {

118 
psDec
->
ödi˚s
.
œgIndex
 = (
›us_öt16
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_pôch_œg_iCDF
, 8 ) * 
	`sûk_RSHIFT
–psDec->
fs_kHz
, 1 );

119 
psDec
->
ödi˚s
.
œgIndex
 +(
›us_öt16
)
	`ec_dec_icdf
–
psR™geDec
,ÖsDec->
pôch_œg_low_bôs_iCDF
, 8 );

121 
psDec
->
ec_¥evLagIndex
 =ÖsDec->
ödi˚s
.
œgIndex
;

124 
psDec
->
ödi˚s
.
c⁄tourIndex
 = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
,ÖsDec->
pôch_c⁄tour_iCDF
, 8 );

130 
psDec
->
ödi˚s
.
PERIndex
 = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_LTP_≥r_ödex_iCDF
, 8 );

132  
k
 = 0; k < 
psDec
->
nb_sub‰
; k++ ) {

133 
psDec
->
ödi˚s
.
LTPIndex
[ 
k
 ] = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_LTP_gaö_iCDF_±rs
[ÖsDec->ödi˚s.
PERIndex
 ], 8 );

139 if–
c⁄dCodög
 =
CODE_INDEPENDENTLY
 ) {

140 
psDec
->
ödi˚s
.
LTP_sˇÀIndex
 = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_LTPsˇÀ_iCDF
, 8 );

142 
psDec
->
ödi˚s
.
LTP_sˇÀIndex
 = 0;

145 
psDec
->
ec_¥evSig«lTy≥
 =ÖsDec->
ödi˚s
.
sig«lTy≥
;

150 
psDec
->
ödi˚s
.
Sìd
 = (
›us_öt8
)
	`ec_dec_icdf
–
psR™geDec
, 
sûk_unif‹m4_iCDF
, 8 );

151 
	}
}

	@silk/decode_parameters.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_decode_∑ømëîs
(

36 
sûk_decodî_°©e
 *
psDec
,

37 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

38 
›us_öt
 
c⁄dCodög


41 
›us_öt
 
i
, 
k
, 
Ix
;

42 
›us_öt16
 
pNLSF_Q15
[ 
MAX_LPC_ORDER
 ], 
pNLSF0_Q15
[ MAX_LPC_ORDER ];

43 c⁄° 
›us_öt8
 *
cbk_±r_Q7
;

46 
	`sûk_gaös_dequ™t
–
psDecCål
->
Gaös_Q16
, 
psDec
->
ödi˚s
.
GaösIndi˚s
,

47 &
psDec
->
La°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
,ÖsDec->
nb_sub‰
 );

52 
	`sûk_NLSF_decode
–
pNLSF_Q15
, 
psDec
->
ödi˚s
.
NLSFIndi˚s
,ÖsDec->
psNLSF_CB
 );

55 
	`sûk_NLSF2A
–
psDecCål
->
PªdC€f_Q12
[ 1 ], 
pNLSF_Q15
, 
psDec
->
LPC_‹dî
,ÖsDec->
¨ch
 );

59 if–
psDec
->
fú°_‰ame_a·î_ª£t
 == 1 ) {

60 
psDec
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = 4;

63 if–
psDec
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 < 4 ) {

66  
i
 = 0; i < 
psDec
->
LPC_‹dî
; i++ ) {

67 
pNLSF0_Q15
[ 
i
 ] = 
psDec
->
¥evNLSF_Q15
[ i ] + 
	`sûk_RSHIFT
–
	`sûk_MUL
–psDec->
ödi˚s
.
NLSFI¡îpC€f_Q2
,

68 
pNLSF_Q15
[ 
i
 ] - 
psDec
->
¥evNLSF_Q15
[ i ] ), 2 );

72 
	`sûk_NLSF2A
–
psDecCål
->
PªdC€f_Q12
[ 0 ], 
pNLSF0_Q15
, 
psDec
->
LPC_‹dî
,ÖsDec->
¨ch
 );

75 
	`sûk_mem˝y
–
psDecCål
->
PªdC€f_Q12
[ 0 ],ÖsDecCål->PªdC€f_Q12[ 1 ], 
psDec
->
LPC_‹dî
 * –
›us_öt16
 ) );

78 
	`sûk_mem˝y
–
psDec
->
¥evNLSF_Q15
, 
pNLSF_Q15
,ÖsDec->
LPC_‹dî
 * –
›us_öt16
 ) );

81 if–
psDec
->
lossC¡
 ) {

82 
	`sûk_bwex∑ndî
–
psDecCål
->
PªdC€f_Q12
[ 0 ], 
psDec
->
LPC_‹dî
, 
BWE_AFTER_LOSS_Q16
 );

83 
	`sûk_bwex∑ndî
–
psDecCål
->
PªdC€f_Q12
[ 1 ], 
psDec
->
LPC_‹dî
, 
BWE_AFTER_LOSS_Q16
 );

86 if–
psDec
->
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

92 
	`sûk_decode_pôch
–
psDec
->
ödi˚s
.
œgIndex
,ÖsDec->ödi˚s.
c⁄tourIndex
, 
psDecCål
->
pôchL
,ÖsDec->
fs_kHz
,ÖsDec->
nb_sub‰
 );

95 
cbk_±r_Q7
 = 
sûk_LTP_vq_±rs_Q7
[ 
psDec
->
ödi˚s
.
PERIndex
 ];

97  
k
 = 0; k < 
psDec
->
nb_sub‰
; k++ ) {

98 
Ix
 = 
psDec
->
ödi˚s
.
LTPIndex
[ 
k
 ];

99  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

100 
psDecCål
->
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 + 
i
 ] = 
	`sûk_LSHIFT
–
cbk_±r_Q7
[ 
Ix
 * LTP_ORDER + i ], 7 );

107 
Ix
 = 
psDec
->
ödi˚s
.
LTP_sˇÀIndex
;

108 
psDecCål
->
LTP_sˇÀ_Q14
 = 
sûk_LTPSˇÀs_èbÀ_Q14
[ 
Ix
 ];

110 
	`sûk_mem£t
–
psDecCål
->
pôchL
, 0, 
psDec
->
nb_sub‰
 * –
›us_öt
 ) );

111 
	`sûk_mem£t
–
psDecCål
->
LTPC€f_Q14
, 0, 
LTP_ORDER
 * 
psDec
->
nb_sub‰
 * –
›us_öt16
 ) );

112 
psDec
->
ödi˚s
.
PERIndex
 = 0;

113 
psDecCål
->
LTP_sˇÀ_Q14
 = 0;

115 
	}
}

	@silk/decode_pitch.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

35 
	~"SigProc_FIX.h
"

36 
	~"pôch_e°_deföes.h
"

38 
	$sûk_decode_pôch
(

39 
›us_öt16
 
œgIndex
,

40 
›us_öt8
 
c⁄tourIndex
,

41 
›us_öt
 
pôch_œgs
[],

42 c⁄° 
›us_öt
 
Fs_kHz
,

43 c⁄° 
›us_öt
 
nb_sub‰


46 
›us_öt
 
œg
, 
k
, 
mö_œg
, 
max_œg
, 
cbk_size
;

47 c⁄° 
›us_öt8
 *
Lag_CB_±r
;

49 if–
Fs_kHz
 == 8 ) {

50 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

51 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2
[ 0 ][ 0 ];

52 
cbk_size
 = 
PE_NB_CBKS_STAGE2_EXT
;

54 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1 );

55 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2_10_ms
[ 0 ][ 0 ];

56 
cbk_size
 = 
PE_NB_CBKS_STAGE2_10MS
;

59 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

60 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

61 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

63 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1 );

64 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

65 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

69 
mö_œg
 = 
	`sûk_SMULBB
–
PE_MIN_LAG_MS
, 
Fs_kHz
 );

70 
max_œg
 = 
	`sûk_SMULBB
–
PE_MAX_LAG_MS
, 
Fs_kHz
 );

71 
œg
 = 
mö_œg
 + 
œgIndex
;

73  
k
 = 0; k < 
nb_sub‰
; k++ ) {

74 
pôch_œgs
[ 
k
 ] = 
œg
 + 
	`m©rix_±r
–
Lag_CB_±r
, k, 
c⁄tourIndex
, 
cbk_size
 );

75 
pôch_œgs
[ 
k
 ] = 
	`sûk_LIMIT
–pôch_œgs[ k ], 
mö_œg
, 
max_œg
 );

77 
	}
}

	@silk/decode_pulses.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

37 
	$sûk_decode_pul£s
(

38 
ec_dec
 *
psR™geDec
,

39 
›us_öt16
 
pul£s
[],

40 c⁄° 
›us_öt
 
sig«lTy≥
,

41 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

42 c⁄° 
›us_öt
 
‰ame_Àngth


45 
›us_öt
 
i
, 
j
, 
k
, 
ôî
, 
abs_q
, 
nLS
, 
R©eLevñIndex
;

46 
›us_öt
 
sum_pul£s
[ 
MAX_NB_SHELL_BLOCKS
 ], 
nLshi·s
[ MAX_NB_SHELL_BLOCKS ];

47 
›us_öt16
 *
pul£s_±r
;

48 c⁄° 
›us_uöt8
 *
cdf_±r
;

53 
R©eLevñIndex
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_øã_Àvñs_iCDF
[ 
sig«lTy≥
 >> 1 ], 8 );

56 
	`sûk_as£π
–1 << 
LOG2_SHELL_CODEC_FRAME_LENGTH
 =
SHELL_CODEC_FRAME_LENGTH
 );

57 
ôî
 = 
	`sûk_RSHIFT
–
‰ame_Àngth
, 
LOG2_SHELL_CODEC_FRAME_LENGTH
 );

58 if–
ôî
 * 
SHELL_CODEC_FRAME_LENGTH
 < 
‰ame_Àngth
 ) {

59 
	`˚…_as£π
–
‰ame_Àngth
 == 12 * 10 );

60 
ôî
++;

66 
cdf_±r
 = 
sûk_pul£s_≥r_block_iCDF
[ 
R©eLevñIndex
 ];

67  
i
 = 0; i < 
ôî
; i++ ) {

68 
nLshi·s
[ 
i
 ] = 0;

69 
sum_pul£s
[ 
i
 ] = 
	`ec_dec_icdf
–
psR™geDec
, 
cdf_±r
, 8 );

72  
sum_pul£s
[ 
i
 ] =
SILK_MAX_PULSES
 + 1 ) {

73 
nLshi·s
[ 
i
 ]++;

75 
sum_pul£s
[ 
i
 ] = 
	`ec_dec_icdf
–
psR™geDec
,

76 
sûk_pul£s_≥r_block_iCDF
[ 
N_RATE_LEVELS
 - 1] + ( 
nLshi·s
[ 
i
 ] == 10 ), 8 );

83  
i
 = 0; i < 
ôî
; i++ ) {

84 if–
sum_pul£s
[ 
i
 ] > 0 ) {

85 
	`sûk_shñl_decodî
–&
pul£s
[ 
	`sûk_SMULBB
–
i
, 
SHELL_CODEC_FRAME_LENGTH
 ) ], 
psR™geDec
, 
sum_pul£s
[ i ] );

87 
	`sûk_mem£t
–&
pul£s
[ 
	`sûk_SMULBB
–
i
, 
SHELL_CODEC_FRAME_LENGTH
 ) ], 0, SHELL_CODEC_FRAME_LENGTH * (Öulses[0] ) );

94  
i
 = 0; i < 
ôî
; i++ ) {

95 if–
nLshi·s
[ 
i
 ] > 0 ) {

96 
nLS
 = 
nLshi·s
[ 
i
 ];

97 
pul£s_±r
 = &
pul£s
[ 
	`sûk_SMULBB
–
i
, 
SHELL_CODEC_FRAME_LENGTH
 ) ];

98  
k
 = 0; k < 
SHELL_CODEC_FRAME_LENGTH
; k++ ) {

99 
abs_q
 = 
pul£s_±r
[ 
k
 ];

100  
j
 = 0; j < 
nLS
; j++ ) {

101 
abs_q
 = 
	`sûk_LSHIFT
(ábs_q, 1 );

102 
abs_q
 +
	`ec_dec_icdf
–
psR™geDec
, 
sûk_lsb_iCDF
, 8 );

104 
pul£s_±r
[ 
k
 ] = 
abs_q
;

107 
sum_pul£s
[ 
i
 ] |
nLS
 << 5;

114 
	`sûk_decode_signs
–
psR™geDec
, 
pul£s
, 
‰ame_Àngth
, 
sig«lTy≥
, 
qu™tOff£tTy≥
, 
sum_pul£s
 );

115 
	}
}

	@silk/decoder_set_fs.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
›us_öt
 
	$sûk_decodî_£t_fs
(

36 
sûk_decodî_°©e
 *
psDec
,

37 
›us_öt
 
fs_kHz
,

38 
›us_öt32
 
fs_API_Hz


41 
›us_öt
 
‰ame_Àngth
, 
ªt
 = 0;

43 
	`˚…_as£π
–
fs_kHz
 == 8 || fs_kHz == 12 || fs_kHz == 16 );

44 
	`˚…_as£π
–
psDec
->
nb_sub‰
 =
MAX_NB_SUBFR
 ||ÖsDec->nb_subfr == MAX_NB_SUBFR/2 );

47 
psDec
->
sub‰_Àngth
 = 
	`sûk_SMULBB
–
SUB_FRAME_LENGTH_MS
, 
fs_kHz
 );

48 
‰ame_Àngth
 = 
	`sûk_SMULBB
–
psDec
->
nb_sub‰
,ÖsDec->
sub‰_Àngth
 );

51 if–
psDec
->
fs_kHz
 !fs_kHz ||ÖsDec->
fs_API_hz
 !
fs_API_Hz
 ) {

53 
ªt
 +
	`sûk_ªßm∂î_öô
–&
psDec
->
ªßm∂î_°©e
, 
	`sûk_SMULBB
–
fs_kHz
, 1000 ), 
fs_API_Hz
, 0 );

55 
psDec
->
fs_API_hz
 = 
fs_API_Hz
;

58 if–
psDec
->
fs_kHz
 !fs_kHz || 
‰ame_Àngth
 !=ÖsDec->frame_length ) {

59 if–
fs_kHz
 == 8 ) {

60 if–
psDec
->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

61 
psDec
->
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_NB_iCDF
;

63 
psDec
->
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_NB_iCDF
;

66 if–
psDec
->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

67 
psDec
->
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_iCDF
;

69 
psDec
->
pôch_c⁄tour_iCDF
 = 
sûk_pôch_c⁄tour_10_ms_iCDF
;

72 if–
psDec
->
fs_kHz
 != fs_kHz ) {

73 
psDec
->
…p_mem_Àngth
 = 
	`sûk_SMULBB
–
LTP_MEM_LENGTH_MS
, 
fs_kHz
 );

74 if–
fs_kHz
 == 8 || fs_kHz == 12 ) {

75 
psDec
->
LPC_‹dî
 = 
MIN_LPC_ORDER
;

76 
psDec
->
psNLSF_CB
 = &
sûk_NLSF_CB_NB_MB
;

78 
psDec
->
LPC_‹dî
 = 
MAX_LPC_ORDER
;

79 
psDec
->
psNLSF_CB
 = &
sûk_NLSF_CB_WB
;

81 if–
fs_kHz
 == 16 ) {

82 
psDec
->
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m8_iCDF
;

83 } if–
fs_kHz
 == 12 ) {

84 
psDec
->
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m6_iCDF
;

85 } if–
fs_kHz
 == 8 ) {

86 
psDec
->
pôch_œg_low_bôs_iCDF
 = 
sûk_unif‹m4_iCDF
;

89 
	`˚…_as£π
( 0 );

91 
psDec
->
fú°_‰ame_a·î_ª£t
 = 1;

92 
psDec
->
œgPªv
 = 100;

93 
psDec
->
La°GaöIndex
 = 10;

94 
psDec
->
¥evSig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

95 
	`sûk_mem£t
–
psDec
->
outBuf
, 0, (psDec->outBuf));

96 
	`sûk_mem£t
–
psDec
->
sLPC_Q14_buf
, 0, (psDec->sLPC_Q14_buf) );

99 
psDec
->
fs_kHz
 = fs_kHz;

100 
psDec
->
‰ame_Àngth
 = frame_length;

104 
	`˚…_as£π
–
psDec
->
‰ame_Àngth
 > 0 &&ÖsDec->‰ame_Àngth <
MAX_FRAME_LENGTH
 );

106  
ªt
;

107 
	}
}

	@silk/define.h

28 #i‚de‡
SILK_DEFINE_H


29 
	#SILK_DEFINE_H


	)

31 
	~"îr‹s.h
"

32 
	~"ty≥def.h
"

34 #ifde‡
__˝lu•lus


40 
	#ENCODER_NUM_CHANNELS
 2

	)

42 
	#DECODER_NUM_CHANNELS
 2

	)

44 
	#MAX_FRAMES_PER_PACKET
 3

	)

47 
	#MIN_TARGET_RATE_BPS
 5000

	)

48 
	#MAX_TARGET_RATE_BPS
 80000

	)

51 
	#LBRR_NB_MIN_RATE_BPS
 12000

	)

52 
	#LBRR_MB_MIN_RATE_BPS
 14000

	)

53 
	#LBRR_WB_MIN_RATE_BPS
 16000

	)

56 
	#NB_SPEECH_FRAMES_BEFORE_DTX
 10

	)

57 
	#MAX_CONSECUTIVE_DTX
 20

	)

58 
	#DTX_ACTIVITY_THRESHOLD
 0.1f

	)

61 
	#VAD_NO_DECISION
 -1

	)

62 
	#VAD_NO_ACTIVITY
 0

	)

63 
	#VAD_ACTIVITY
 1

	)

66 
	#MAX_FS_KHZ
 16

	)

67 
	#MAX_API_FS_KHZ
 48

	)

70 
	#TYPE_NO_VOICE_ACTIVITY
 0

	)

71 
	#TYPE_UNVOICED
 1

	)

72 
	#TYPE_VOICED
 2

	)

75 
	#CODE_INDEPENDENTLY
 0

	)

76 
	#CODE_INDEPENDENTLY_NO_LTP_SCALING
 1

	)

77 
	#CODE_CONDITIONALLY
 2

	)

80 
	#STEREO_QUANT_TAB_SIZE
 16

	)

81 
	#STEREO_QUANT_SUB_STEPS
 5

	)

82 
	#STEREO_INTERP_LEN_MS
 8

	)

83 
	#STEREO_RATIO_SMOOTH_COEF
 0.01

	)

86 
	#PITCH_EST_MIN_LAG_MS
 2

	)

87 
	#PITCH_EST_MAX_LAG_MS
 18

	)

90 
	#MAX_NB_SUBFR
 4

	)

93 
	#LTP_MEM_LENGTH_MS
 20

	)

94 
	#SUB_FRAME_LENGTH_MS
 5

	)

95 
	#MAX_SUB_FRAME_LENGTH
 ( 
SUB_FRAME_LENGTH_MS
 * 
MAX_FS_KHZ
 )

	)

96 
	#MAX_FRAME_LENGTH_MS
 ( 
SUB_FRAME_LENGTH_MS
 * 
MAX_NB_SUBFR
 )

	)

97 
	#MAX_FRAME_LENGTH
 ( 
MAX_FRAME_LENGTH_MS
 * 
MAX_FS_KHZ
 )

	)

100 
	#LA_PITCH_MS
 2

	)

101 
	#LA_PITCH_MAX
 ( 
LA_PITCH_MS
 * 
MAX_FS_KHZ
 )

	)

104 
	#MAX_FIND_PITCH_LPC_ORDER
 16

	)

107 
	#FIND_PITCH_LPC_WIN_MS
 ( 20 + (
LA_PITCH_MS
 << 1Ë)

	)

108 
	#FIND_PITCH_LPC_WIN_MS_2_SF
 ( 10 + (
LA_PITCH_MS
 << 1Ë)

	)

109 
	#FIND_PITCH_LPC_WIN_MAX
 ( 
FIND_PITCH_LPC_WIN_MS
 * 
MAX_FS_KHZ
 )

	)

112 
	#LA_SHAPE_MS
 5

	)

113 
	#LA_SHAPE_MAX
 ( 
LA_SHAPE_MS
 * 
MAX_FS_KHZ
 )

	)

116 
	#SHAPE_LPC_WIN_MAX
 ( 15 * 
MAX_FS_KHZ
 )

	)

119 
	#MIN_QGAIN_DB
 2

	)

121 
	#MAX_QGAIN_DB
 88

	)

123 
	#N_LEVELS_QGAIN
 64

	)

125 
	#MAX_DELTA_GAIN_QUANT
 36

	)

127 
	#MIN_DELTA_GAIN_QUANT
 -4

	)

130 
	#OFFSET_VL_Q10
 32

	)

131 
	#OFFSET_VH_Q10
 100

	)

132 
	#OFFSET_UVL_Q10
 100

	)

133 
	#OFFSET_UVH_Q10
 240

	)

135 
	#QUANT_LEVEL_ADJUST_Q10
 80

	)

138 
	#MAX_LPC_STABILIZE_ITERATIONS
 16

	)

139 
	#MAX_PREDICTION_POWER_GAIN
 1e4f

	)

140 
	#MAX_PREDICTION_POWER_GAIN_AFTER_RESET
 1e2f

	)

142 
	#MAX_LPC_ORDER
 16

	)

143 
	#MIN_LPC_ORDER
 10

	)

146 
	#LTP_ORDER
 5

	)

149 
	#NB_LTP_CBKS
 3

	)

152 
	#USE_HARM_SHAPING
 1

	)

155 
	#MAX_SHAPE_LPC_ORDER
 24

	)

157 
	#HARM_SHAPE_FIR_TAPS
 3

	)

160 
	#MAX_DEL_DEC_STATES
 4

	)

162 
	#LTP_BUF_LENGTH
 512

	)

163 
	#LTP_MASK
 ( 
LTP_BUF_LENGTH
 - 1 )

	)

165 
	#DECISION_DELAY
 40

	)

168 
	#SHELL_CODEC_FRAME_LENGTH
 16

	)

169 
	#LOG2_SHELL_CODEC_FRAME_LENGTH
 4

	)

170 
	#MAX_NB_SHELL_BLOCKS
 ( 
MAX_FRAME_LENGTH
 / 
SHELL_CODEC_FRAME_LENGTH
 )

	)

173 
	#N_RATE_LEVELS
 10

	)

176 
	#SILK_MAX_PULSES
 16

	)

178 
	#MAX_MATRIX_SIZE
 
MAX_LPC_ORDER


	)

180 
	#NSQ_LPC_BUF_LENGTH
 
MAX_LPC_ORDER


	)

185 
	#VAD_N_BANDS
 4

	)

187 
	#VAD_INTERNAL_SUBFRAMES_LOG2
 2

	)

188 
	#VAD_INTERNAL_SUBFRAMES
 ( 1 << 
VAD_INTERNAL_SUBFRAMES_LOG2
 )

	)

190 
	#VAD_NOISE_LEVEL_SMOOTH_COEF_Q16
 1024

	)

191 
	#VAD_NOISE_LEVELS_BIAS
 50

	)

194 
	#VAD_NEGATIVE_OFFSET_Q5
 128

	)

195 
	#VAD_SNR_FACTOR_Q16
 45000

	)

198 
	#VAD_SNR_SMOOTH_COEF_Q18
 4096

	)

201 
	#LSF_COS_TAB_SZ_FIX
 128

	)

206 
	#NLSF_W_Q
 2

	)

207 
	#NLSF_VQ_MAX_VECTORS
 32

	)

208 
	#NLSF_QUANT_MAX_AMPLITUDE
 4

	)

209 
	#NLSF_QUANT_MAX_AMPLITUDE_EXT
 10

	)

210 
	#NLSF_QUANT_LEVEL_ADJ
 0.1

	)

211 
	#NLSF_QUANT_DEL_DEC_STATES_LOG2
 2

	)

212 
	#NLSF_QUANT_DEL_DEC_STATES
 ( 1 << 
NLSF_QUANT_DEL_DEC_STATES_LOG2
 )

	)

215 
	#TRANSITION_TIME_MS
 5120

	)

216 
	#TRANSITION_NB
 3

	)

217 
	#TRANSITION_NA
 2

	)

218 
	#TRANSITION_INT_NUM
 5

	)

219 
	#TRANSITION_FRAMES
 ( 
TRANSITION_TIME_MS
 / 
MAX_FRAME_LENGTH_MS
 )

	)

220 
	#TRANSITION_INT_STEPS
 ( 
TRANSITION_FRAMES
 / ( 
TRANSITION_INT_NUM
 - 1 ) )

	)

223 
	#BWE_AFTER_LOSS_Q16
 63570

	)

226 
	#CNG_BUF_MASK_MAX
 255

	)

227 
	#CNG_GAIN_SMTH_Q16
 4634

	)

228 
	#CNG_NLSF_SMTH_Q16
 16348

	)

230 #ifde‡
__˝lu•lus


	@silk/enc_API.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

31 
	~"deföe.h
"

32 
	~"API.h
"

33 
	~"c⁄åﬁ.h
"

34 
	~"ty≥def.h
"

35 
	~"°ack_Æloc.h
"

36 
	~"°ru˘s.h
"

37 
	~"tunög_∑ømëîs.h
"

38 #ifde‡
FIXED_POINT


39 
	~"maö_FIX.h
"

41 
	~"maö_FLP.h
"

47 
›us_öt
 
sûk_QuîyEncodî
(

48 c⁄° *
ícSèã
,

49 
sûk_EncC⁄åﬁSåu˘
 *
ícSètus


56 
›us_öt
 
	$sûk_Gë_Encodî_Size
(

57 
›us_öt
 *
ícSizeByãs


60 
›us_öt
 
ªt
 = 
SILK_NO_ERROR
;

62 *
ícSizeByãs
 = –
sûk_ícodî
 );

64  
ªt
;

65 
	}
}

70 
›us_öt
 
	$sûk_InôEncodî
(

71 *
ícSèã
,

72 
¨ch
,

73 
sûk_EncC⁄åﬁSåu˘
 *
ícSètus


76 
sûk_ícodî
 *
psEnc
;

77 
›us_öt
 
n
, 
ªt
 = 
SILK_NO_ERROR
;

79 
psEnc
 = (
sûk_ícodî
 *)
ícSèã
;

82 
	`sûk_mem£t
–
psEnc
, 0, –
sûk_ícodî
 ) );

83  
n
 = 0;Ç < 
ENCODER_NUM_CHANNELS
;Ç++ ) {

84 if–
ªt
 +
	`sûk_öô_ícodî
–&
psEnc
->
°©e_Fxx
[ 
n
 ], 
¨ch
 ) ) {

85 
	`˚…_as£π
( 0 );

89 
psEnc
->
nCh™√lsAPI
 = 1;

90 
psEnc
->
nCh™√lsI¡î«l
 = 1;

93 if–
ªt
 +
	`sûk_QuîyEncodî
–
ícSèã
, 
ícSètus
 ) ) {

94 
	`˚…_as£π
( 0 );

97  
ªt
;

98 
	}
}

103 
›us_öt
 
	$sûk_QuîyEncodî
(

104 c⁄° *
ícSèã
,

105 
sûk_EncC⁄åﬁSåu˘
 *
ícSètus


108 
›us_öt
 
ªt
 = 
SILK_NO_ERROR
;

109 
sûk_ícodî_°©e_Fxx
 *
°©e_Fxx
;

110 
sûk_ícodî
 *
psEnc
 = (sûk_ícodî *)
ícSèã
;

112 
°©e_Fxx
 = 
psEnc
->state_Fxx;

114 
ícSètus
->
nCh™√lsAPI
 = 
psEnc
->nChannelsAPI;

115 
ícSètus
->
nCh™√lsI¡î«l
 = 
psEnc
->nChannelsInternal;

116 
ícSètus
->
API_ßm∂eR©e
 = 
°©e_Fxx
[ 0 ].
sCmn
.
API_fs_Hz
;

117 
ícSètus
->
maxI¡î«lSam∂eR©e
 = 
°©e_Fxx
[ 0 ].
sCmn
.
maxI¡î«l_fs_Hz
;

118 
ícSètus
->
möI¡î«lSam∂eR©e
 = 
°©e_Fxx
[ 0 ].
sCmn
.
möI¡î«l_fs_Hz
;

119 
ícSètus
->
desúedI¡î«lSam∂eR©e
 = 
°©e_Fxx
[ 0 ].
sCmn
.
desúedI¡î«l_fs_Hz
;

120 
ícSètus
->
∑ylﬂdSize_ms
 = 
°©e_Fxx
[ 0 ].
sCmn
.
PackëSize_ms
;

121 
ícSètus
->
bôR©e
 = 
°©e_Fxx
[ 0 ].
sCmn
.
T¨gëR©e_bps
;

122 
ícSètus
->
∑ckëLossPî˚¡age
 = 
°©e_Fxx
[ 0 ].
sCmn
.
PackëLoss_≥rc
;

123 
ícSètus
->
com∂exôy
 = 
°©e_Fxx
[ 0 ].
sCmn
.
Com∂exôy
;

124 
ícSètus
->
u£InB™dFEC
 = 
°©e_Fxx
[ 0 ].
sCmn
.useInBandFEC;

125 
ícSètus
->
u£DTX
 = 
°©e_Fxx
[ 0 ].
sCmn
.useDTX;

126 
ícSètus
->
u£CBR
 = 
°©e_Fxx
[ 0 ].
sCmn
.useCBR;

127 
ícSètus
->
öã∫ÆSam∂eR©e
 = 
	`sûk_SMULBB
–
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
, 1000 );

128 
ícSètus
->
ÆlowB™dwidthSwôch
 = 
°©e_Fxx
[ 0 ].
sCmn
.
Ælow_b™dwidth_swôch
;

129 
ícSètus
->
öWBmodeWôhoutV¨übÀLP
 = 
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
 =16 && sèã_Fxx[ 0 ].sCmn.
sLP
.
mode
 == 0;

131  
ªt
;

132 
	}
}

140 
›us_öt
 
	$sûk_Encode
(

141 *
ícSèã
,

142 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ
,

143 c⁄° 
›us_öt16
 *
ßm∂esIn
,

144 
›us_öt
 
nSam∂esIn
,

145 
ec_íc
 *
psR™geEnc
,

146 
›us_öt32
 *
nByãsOut
,

147 c⁄° 
›us_öt
 
¥efûlFœg
,

148 
›us_öt
 
a˘ivôy


151 
›us_öt
 
n
, 
i
, 
nBôs
, 
Êags
, 
tmp_∑ylﬂdSize_ms
 = 0, 
tmp_com∂exôy
 = 0, 
ªt
 = 0;

152 
›us_öt
 
nSam∂esToBuf„r
, 
nSam∂esToBuf„rMax
, 
nBlocksOf10ms
;

153 
›us_öt
 
nSam∂esFromI≈ut
 = 0, 
nSam∂esFromI≈utMax
;

154 
›us_öt
 
•ìch_a˘_thr_f‹_swôch_Q8
;

155 
›us_öt32
 
T¨gëR©e_bps
, 
MSèrgëR©es_bps
[ 2 ], 
ch™√lR©e_bps
, 
LBRR_symbﬁ
, 
sum
;

156 
sûk_ícodî
 *
psEnc
 = ( sûk_ícodî * )
ícSèã
;

157 
	`VARDECL
–
›us_öt16
, 
buf
 );

158 
›us_öt
 
å™sôi⁄
, 
cuº_block
, 
tŸ_blocks
;

159 
SAVE_STACK
;

161 i‡(
ícC⁄åﬁ
->
ªdu˚dDïídícy
)

163 
psEnc
->
°©e_Fxx
[0].
sCmn
.
fú°_‰ame_a·î_ª£t
 = 1;

164 
psEnc
->
°©e_Fxx
[1].
sCmn
.
fú°_‰ame_a·î_ª£t
 = 1;

166 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 =ÖsEnc->state_Fxx[ 1 ].sCmn.nFramesEncoded = 0;

169 if––
ªt
 = 
	`check_c⁄åﬁ_öput
–
ícC⁄åﬁ
 ) ) != 0 ) {

170 
	`˚…_as£π
( 0 );

171 
RESTORE_STACK
;

172  
ªt
;

175 
ícC⁄åﬁ
->
swôchRódy
 = 0;

177 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 > 
psEnc
->nChannelsInternal ) {

179 
ªt
 +
	`sûk_öô_ícodî
–&
psEnc
->
°©e_Fxx
[ 1 ],ÖsEnc->°©e_Fxx[ 0 ].
sCmn
.
¨ch
 );

180 
	`sûk_mem£t
–
psEnc
->
sSãªo
.
¥ed_¥ev_Q13
, 0, (ÖsEnc->sStereo.pred_prev_Q13 ) );

181 
	`sûk_mem£t
–
psEnc
->
sSãªo
.
sSide
, 0, (ÖsEnc->sStereo.sSide ) );

182 
psEnc
->
sSãªo
.
mid_side_amp_Q0
[ 0 ] = 0;

183 
psEnc
->
sSãªo
.
mid_side_amp_Q0
[ 1 ] = 1;

184 
psEnc
->
sSãªo
.
mid_side_amp_Q0
[ 2 ] = 0;

185 
psEnc
->
sSãªo
.
mid_side_amp_Q0
[ 3 ] = 1;

186 
psEnc
->
sSãªo
.
width_¥ev_Q14
 = 0;

187 
psEnc
->
sSãªo
.
smth_width_Q14
 = 
	`SILK_FIX_CONST
( 1, 14 );

188 if–
psEnc
->
nCh™√lsAPI
 == 2 ) {

189 
	`sûk_mem˝y
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
ªßm∂î_°©e
, &psEnc->°©e_Fxx[ 0 ].sCmn.ªßm∂î_°©e, –
sûk_ªßm∂î_°©e_°ru˘
 ) );

190 
	`sûk_mem˝y
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
In_HP_Sèã
, &psEnc->state_Fxx[ 0 ].sCmn.In_HP_State, (ÖsEnc->state_Fxx[ 1 ].sCmn.In_HP_State ) );

194 
å™sôi⁄
 = (
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 !
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
PackëSize_ms
Ë|| (psEnc->
nCh™√lsI¡î«l
 !=ÉncControl->nChannelsInternal);

196 
psEnc
->
nCh™√lsAPI
 = 
ícC⁄åﬁ
->nChannelsAPI;

197 
psEnc
->
nCh™√lsI¡î«l
 = 
ícC⁄åﬁ
->nChannelsInternal;

199 
nBlocksOf10ms
 = 
	`sûk_DIV32
–100 * 
nSam∂esIn
, 
ícC⁄åﬁ
->
API_ßm∂eR©e
 );

200 
tŸ_blocks
 = ( 
nBlocksOf10ms
 > 1 ) ?ÇBlocksOf10ms >> 1 : 1;

201 
cuº_block
 = 0;

202 if–
¥efûlFœg
 ) {

203 
sûk_LP_°©e
 
ßve_LP
;

205 if–
nBlocksOf10ms
 != 1 ) {

206 
	`˚…_as£π
( 0 );

207 
RESTORE_STACK
;

208  
SILK_ENC_INPUT_INVALID_NO_OF_SAMPLES
;

210 i‡–
¥efûlFœg
 == 2 ) {

211 
ßve_LP
 = 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
sLP
;

213 
ßve_LP
.
ßved_fs_kHz
 = 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
;

216  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

217 
ªt
 = 
	`sûk_öô_ícodî
–&
psEnc
->
°©e_Fxx
[ 
n
 ],ÖsEnc->°©e_Fxx[Ç ].
sCmn
.
¨ch
 );

219 i‡–
¥efûlFœg
 == 2 ) {

220 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
sLP
 = 
ßve_LP
;

222 
	`˚…_as£π
–!
ªt
 );

224 
tmp_∑ylﬂdSize_ms
 = 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
;

225 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 = 10;

226 
tmp_com∂exôy
 = 
ícC⁄åﬁ
->
com∂exôy
;

227 
ícC⁄åﬁ
->
com∂exôy
 = 0;

228  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

229 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
 = 0;

230 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
¥efûlFœg
 = 1;

234 if–
nBlocksOf10ms
 * 
ícC⁄åﬁ
->
API_ßm∂eR©e
 !100 * 
nSam∂esIn
 ||ÇSamplesIn < 0 ) {

235 
	`˚…_as£π
( 0 );

236 
RESTORE_STACK
;

237  
SILK_ENC_INPUT_INVALID_NO_OF_SAMPLES
;

240 if–1000 * (
›us_öt32
)
nSam∂esIn
 > 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 *ÉncC⁄åﬁ->
API_ßm∂eR©e
 ) {

241 
	`˚…_as£π
( 0 );

242 
RESTORE_STACK
;

243  
SILK_ENC_INPUT_INVALID_NO_OF_SAMPLES
;

247  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

249 
›us_öt
 
f‹˚_fs_kHz
 = (
n
==1Ë? 
psEnc
->
°©e_Fxx
[0].
sCmn
.
fs_kHz
 : 0;

250 if––
ªt
 = 
	`sûk_c⁄åﬁ_ícodî
–&
psEnc
->
°©e_Fxx
[ 
n
 ], 
ícC⁄åﬁ
,ÖsEnc->
ÆlowB™dwidthSwôch
,Ç, 
f‹˚_fs_kHz
 ) ) != 0 ) {

251 
	`sûk_as£π
( 0 );

252 
RESTORE_STACK
;

253  
ªt
;

255 if–
psEnc
->
°©e_Fxx
[
n
].
sCmn
.
fú°_‰ame_a·î_ª£t
 || 
å™sôi⁄
 ) {

256  
i
 = 0; i < 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesPîPackë
; i++ ) {

257 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êags
[ 
i
 ] = 0;

260 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
öDTX
 =ÖsEnc->°©e_Fxx[Ç ].sCmn.
u£DTX
;

262 
	`˚…_as£π
–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 =1 || 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
 ==ÖsEnc->state_Fxx[ 1 ].sCmn.fs_kHz );

265 
nSam∂esToBuf„rMax
 =

266 10 * 
nBlocksOf10ms
 * 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
;

267 
nSam∂esFromI≈utMax
 =

268 
	`sûk_DIV32_16
–
nSam∂esToBuf„rMax
 *

269 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
API_fs_Hz
,

270 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
 * 1000 );

271 
	`ALLOC
–
buf
, 
nSam∂esFromI≈utMax
, 
›us_öt16
 );

273 
nSam∂esToBuf„r
 = 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
‰ame_Àngth
 -ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
;

274 
nSam∂esToBuf„r
 = 
	`sûk_mö
–nSam∂esToBuf„r, 
nSam∂esToBuf„rMax
 );

275 
nSam∂esFromI≈ut
 = 
	`sûk_DIV32_16
–
nSam∂esToBuf„r
 * 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
API_fs_Hz
,ÖsEnc->°©e_Fxx[ 0 ].sCmn.
fs_kHz
 * 1000 );

277 if–
ícC⁄åﬁ
->
nCh™√lsAPI
 =2 &&ÉncC⁄åﬁ->
nCh™√lsI¡î«l
 == 2 ) {

278 
›us_öt
 
id
 = 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
;

279  
n
 = 0;Ç < 
nSam∂esFromI≈ut
;Ç++ ) {

280 
buf
[ 
n
 ] = 
ßm∂esIn
[ 2 *Ç ];

283 if–
psEnc
->
nPªvCh™√lsI¡î«l
 =1 && 
id
==0 ) {

284 
	`sûk_mem˝y
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
ªßm∂î_°©e
, &psEnc->state_Fxx[ 0 ].sCmn.resampler_state, (psEnc->state_Fxx[ 1 ].sCmn.resampler_state));

287 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
ªßm∂î_°©e
,

288 &
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
 + 2 ], 
buf
, 
nSam∂esFromI≈ut
 );

289 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBufIx
 +
nSam∂esToBuf„r
;

291 
nSam∂esToBuf„r
 = 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
‰ame_Àngth
 -ÖsEnc->°©e_Fxx[ 1 ].sCmn.
öputBufIx
;

292 
nSam∂esToBuf„r
 = 
	`sûk_mö
–nSam∂esToBuf„r, 10 * 
nBlocksOf10ms
 * 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
fs_kHz
 );

293  
n
 = 0;Ç < 
nSam∂esFromI≈ut
;Ç++ ) {

294 
buf
[ 
n
 ] = 
ßm∂esIn
[ 2 *Ç + 1 ];

296 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
ªßm∂î_°©e
,

297 &
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 1 ].sCmn.
öputBufIx
 + 2 ], 
buf
, 
nSam∂esFromI≈ut
 );

299 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
öputBufIx
 +
nSam∂esToBuf„r
;

300 } if–
ícC⁄åﬁ
->
nCh™√lsAPI
 =2 &&ÉncC⁄åﬁ->
nCh™√lsI¡î«l
 == 1 ) {

302  
n
 = 0;Ç < 
nSam∂esFromI≈ut
;Ç++ ) {

303 
sum
 = 
ßm∂esIn
[ 2 * 
n
 ] + samplesIn[ 2 *Ç + 1 ];

304 
buf
[ 
n
 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
sum
, 1 );

306 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
ªßm∂î_°©e
,

307 &
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
 + 2 ], 
buf
, 
nSam∂esFromI≈ut
 );

309 if–
psEnc
->
nPªvCh™√lsI¡î«l
 =2 &&ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 == 0 ) {

310 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
ªßm∂î_°©e
,

311 &
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 1 ].sCmn.
öputBufIx
 + 2 ], 
buf
, 
nSam∂esFromI≈ut
 );

312  
n
 = 0;Ç < 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
‰ame_Àngth
;Ç++ ) {

313 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
+
n
+2 ] =

314 
	`sûk_RSHIFT
(
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
+
n
+2 ]

315 + 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 1 ].sCmn.
öputBufIx
+
n
+2 ], 1);

318 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBufIx
 +
nSam∂esToBuf„r
;

320 
	`˚…_as£π
–
ícC⁄åﬁ
->
nCh™√lsAPI
 =1 &&ÉncC⁄åﬁ->
nCh™√lsI¡î«l
 == 1 );

321 
	`sûk_mem˝y
(
buf
, 
ßm∂esIn
, 
nSam∂esFromI≈ut
*(
›us_öt16
));

322 
ªt
 +
	`sûk_ªßm∂î
–&
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
ªßm∂î_°©e
,

323 &
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
öputBufIx
 + 2 ], 
buf
, 
nSam∂esFromI≈ut
 );

324 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBufIx
 +
nSam∂esToBuf„r
;

327 
ßm∂esIn
 +
nSam∂esFromI≈ut
 * 
ícC⁄åﬁ
->
nCh™√lsAPI
;

328 
nSam∂esIn
 -
nSam∂esFromI≈ut
;

331 
psEnc
->
ÆlowB™dwidthSwôch
 = 0;

334 if–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBufIx
 >psEnc->°©e_Fxx[ 0 ].sCmn.
‰ame_Àngth
 ) {

336 
	`˚…_as£π
–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBufIx
 =psEnc->°©e_Fxx[ 0 ].sCmn.
‰ame_Àngth
 );

337 
	`˚…_as£π
–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 =1 || 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
öputBufIx
 =psEnc->°©e_Fxx[ 1 ].sCmn.
‰ame_Àngth
 );

340 if–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 =0 && !
¥efûlFœg
 ) {

342 
›us_uöt8
 
iCDF
[ 2 ] = { 0, 0 };

343 
iCDF
[ 0 ] = 256 - 
	`sûk_RSHIFT
–256, ( 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesPîPackë
 + 1 ) * 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 );

344 
	`ec_íc_icdf
–
psR™geEnc
, 0, 
iCDF
, 8 );

348  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

349 
LBRR_symbﬁ
 = 0;

350  
i
 = 0; i < 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
nFømesPîPackë
; i++ ) {

351 
LBRR_symbﬁ
 |
	`sûk_LSHIFT
–
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êags
[ 
i
 ], i );

353 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êag
 = 
LBRR_symbﬁ
 > 0 ? 1 : 0;

354 if–
LBRR_symbﬁ
 && 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
nFømesPîPackë
 > 1 ) {

355 
	`ec_íc_icdf
–
psR™geEnc
, 
LBRR_symbﬁ
 - 1, 
sûk_LBRR_Êags_iCDF_±r
[ 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
nFømesPîPackë
 - 2 ], 8 );

360  
i
 = 0; i < 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesPîPackë
; i++ ) {

361  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

362 if–
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êags
[ 
i
 ] ) {

363 
›us_öt
 
c⁄dCodög
;

365 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 =2 && 
n
 == 0 ) {

366 
	`sûk_°îeo_ícode_¥ed
–
psR™geEnc
, 
psEnc
->
sSãªo
.
¥edIx
[ 
i
 ] );

368 if–
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
LBRR_Êags
[ 
i
 ] == 0 ) {

369 
	`sûk_°îeo_ícode_mid_⁄ly
–
psR™geEnc
, 
psEnc
->
sSãªo
.
mid_⁄ly_Êags
[ 
i
 ] );

373 if–
i
 > 0 && 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êags
[ i - 1 ] ) {

374 
c⁄dCodög
 = 
CODE_CONDITIONALLY
;

376 
c⁄dCodög
 = 
CODE_INDEPENDENTLY
;

378 
	`sûk_ícode_ödi˚s
–&
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
, 
psR™geEnc
, 
i
, 1, 
c⁄dCodög
 );

379 
	`sûk_ícode_pul£s
–
psR™geEnc
, 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
ödi˚s_LBRR
[
i
].
sig«lTy≥
,ÖsEnc->°©e_Fxx[Ç ].sCmn.ödi˚s_LBRR[i].
qu™tOff£tTy≥
,

380 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
pul£s_LBRR
[ 
i
 ],ÖsEnc->°©e_Fxx[Ç ].sCmn.
‰ame_Àngth
 );

386  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

387 
	`sûk_mem£t
–
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êags
, 0, (ÖsEnc->state_Fxx[Ç ].sCmn.LBRR_flags ) );

390 
psEnc
->
nBôsU£dLBRR
 = 
	`ec_ãŒ
–
psR™geEnc
 );

393 
	`sûk_HP_v¨übÀ_cutoff
–
psEnc
->
°©e_Fxx
 );

396 
nBôs
 = 
	`sûk_DIV32_16
–
	`sûk_MUL
–
ícC⁄åﬁ
->
bôR©e
,ÉncC⁄åﬁ->
∑ylﬂdSize_ms
 ), 1000 );

398 if–!
¥efûlFœg
 ) {

399 
nBôs
 -
psEnc
->
nBôsU£dLBRR
;

402 
nBôs
 = 
	`sûk_DIV32_16
–nBôs, 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesPîPackë
 );

404 if–
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 == 10 ) {

405 
T¨gëR©e_bps
 = 
	`sûk_SMULBB
–
nBôs
, 100 );

407 
T¨gëR©e_bps
 = 
	`sûk_SMULBB
–
nBôs
, 50 );

410 
T¨gëR©e_bps
 -
	`sûk_DIV32_16
–
	`sûk_MUL
–
psEnc
->
nBôsEx˚eded
, 1000 ), 
BITRESERVOIR_DECAY_TIME_MS
 );

411 if–!
¥efûlFœg
 && 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 > 0 ) {

413 
›us_öt32
 
bôsBÆ™˚
 = 
	`ec_ãŒ
–
psR™geEnc
 ) - 
psEnc
->
nBôsU£dLBRR
 - 
nBôs
 *ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
;

414 
T¨gëR©e_bps
 -
	`sûk_DIV32_16
–
	`sûk_MUL
–
bôsBÆ™˚
, 1000 ), 
BITRESERVOIR_DECAY_TIME_MS
 );

417 
T¨gëR©e_bps
 = 
	`sûk_LIMIT
–T¨gëR©e_bps, 
ícC⁄åﬁ
->
bôR©e
, 5000 );

420 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 == 2 ) {

421 
	`sûk_°îeo_LR_to_MS
–&
psEnc
->
sSãªo
, &psEnc->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ 2 ], &psEnc->state_Fxx[ 1 ].sCmn.inputBuf[ 2 ],

422 
psEnc
->
sSãªo
.
¥edIx
[ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 ], &psEnc->sSãªo.
mid_⁄ly_Êags
[ÖsEnc->state_Fxx[ 0 ].sCmn.nFramesEncoded ],

423 
MSèrgëR©es_bps
, 
T¨gëR©e_bps
, 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
•ìch_a˘ivôy_Q8
, 
ícC⁄åﬁ
->
toM⁄o
,

424 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
,ÖsEnc->°©e_Fxx[ 0 ].sCmn.
‰ame_Àngth
 );

425 if–
psEnc
->
sSãªo
.
mid_⁄ly_Êags
[ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 ] == 0 ) {

427 if–
psEnc
->
¥ev_decode_⁄ly_middÀ
 == 1 ) {

428 
	`sûk_mem£t
–&
psEnc
->
°©e_Fxx
[ 1 ].
sSh≠e
, 0, (ÖsEnc->state_Fxx[ 1 ].sShape ) );

429 
	`sûk_mem£t
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
sNSQ
, 0, (ÖsEnc->state_Fxx[ 1 ].sCmn.sNSQ ) );

430 
	`sûk_mem£t
–
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
¥ev_NLSFq_Q15
, 0, (ÖsEnc->state_Fxx[ 1 ].sCmn.prev_NLSFq_Q15 ) );

431 
	`sûk_mem£t
–&
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
sLP
.
In_LP_Sèã
, 0, (ÖsEnc->state_Fxx[ 1 ].sCmn.sLP.In_LP_State ) );

432 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
¥evLag
 = 100;

433 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
sNSQ
.
œgPªv
 = 100;

434 
psEnc
->
°©e_Fxx
[ 1 ].
sSh≠e
.
La°GaöIndex
 = 10;

435 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
¥evSig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

436 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
sNSQ
.
¥ev_gaö_Q16
 = 65536;

437 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
fú°_‰ame_a·î_ª£t
 = 1;

439 
	`sûk_ícode_do_VAD_Fxx
–&
psEnc
->
°©e_Fxx
[ 1 ], 
a˘ivôy
 );

441 
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
VAD_Êags
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
nFømesEncoded
 ] = 0;

443 if–!
¥efûlFœg
 ) {

444 
	`sûk_°îeo_ícode_¥ed
–
psR™geEnc
, 
psEnc
->
sSãªo
.
¥edIx
[ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 ] );

445 if–
psEnc
->
°©e_Fxx
[ 1 ].
sCmn
.
VAD_Êags
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
nFømesEncoded
 ] == 0 ) {

446 
	`sûk_°îeo_ícode_mid_⁄ly
–
psR™geEnc
, 
psEnc
->
sSãªo
.
mid_⁄ly_Êags
[ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 ] );

451 
	`sûk_mem˝y
–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
,ÖsEnc->
sSãªo
.
sMid
, 2 * –
›us_öt16
 ) );

452 
	`sûk_mem˝y
–
psEnc
->
sSãªo
.
sMid
, &psEnc->
°©e_Fxx
[ 0 ].
sCmn
.
öputBuf
[ÖsEnc->°©e_Fxx[ 0 ].sCmn.
‰ame_Àngth
 ], 2 * –
›us_öt16
 ) );

454 
	`sûk_ícode_do_VAD_Fxx
–&
psEnc
->
°©e_Fxx
[ 0 ], 
a˘ivôy
 );

457  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

458 
›us_öt
 
maxBôs
, 
u£CBR
;

461 
maxBôs
 = 
ícC⁄åﬁ
->maxBits;

462 if–
tŸ_blocks
 =2 && 
cuº_block
 == 0 ) {

463 
maxBôs
 = maxBits * 3 / 5;

464 } if–
tŸ_blocks
 == 3 ) {

465 if–
cuº_block
 == 0 ) {

466 
maxBôs
 = maxBits * 2 / 5;

467 } if–
cuº_block
 == 1 ) {

468 
maxBôs
 = maxBits * 3 / 4;

471 
u£CBR
 = 
ícC⁄åﬁ
->u£CBR && 
cuº_block
 =
tŸ_blocks
 - 1;

473 if–
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 == 1 ) {

474 
ch™√lR©e_bps
 = 
T¨gëR©e_bps
;

476 
ch™√lR©e_bps
 = 
MSèrgëR©es_bps
[ 
n
 ];

477 if–
n
 =0 && 
MSèrgëR©es_bps
[ 1 ] > 0 ) {

478 
u£CBR
 = 0;

480 
maxBôs
 -
ícC⁄åﬁ
->maxBô†/ ( 
tŸ_blocks
 * 2 );

484 if–
ch™√lR©e_bps
 > 0 ) {

485 
›us_öt
 
c⁄dCodög
;

487 
	`sûk_c⁄åﬁ_SNR
–&
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
, 
ch™√lR©e_bps
 );

490 if–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 - 
n
 <= 0 ) {

491 
c⁄dCodög
 = 
CODE_INDEPENDENTLY
;

492 } if–
n
 > 0 && 
psEnc
->
¥ev_decode_⁄ly_middÀ
 ) {

495 
c⁄dCodög
 = 
CODE_INDEPENDENTLY_NO_LTP_SCALING
;

497 
c⁄dCodög
 = 
CODE_CONDITIONALLY
;

499 if––
ªt
 = 
	`sûk_ícode_‰ame_Fxx
–&
psEnc
->
°©e_Fxx
[ 
n
 ], 
nByãsOut
, 
psR™geEnc
, 
c⁄dCodög
, 
maxBôs
, 
u£CBR
 ) ) != 0 ) {

500 
	`sûk_as£π
( 0 );

503 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
 = 0;

504 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
öputBufIx
 = 0;

505 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
nFømesEncoded
++;

507 
psEnc
->
¥ev_decode_⁄ly_middÀ
 =ÖsEnc->
sSãªo
.
mid_⁄ly_Êags
[ÖsEnc->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 - 1 ];

510 if–*
nByãsOut
 > 0 && 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesEncoded
 =psEnc->°©e_Fxx[ 0 ].sCmn.
nFømesPîPackë
) {

511 
Êags
 = 0;

512  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

513  
i
 = 0; i < 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
nFømesPîPackë
; i++ ) {

514 
Êags
 = 
	`sûk_LSHIFT
( flags, 1 );

515 
Êags
 |
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
VAD_Êags
[ 
i
 ];

517 
Êags
 = 
	`sûk_LSHIFT
( flags, 1 );

518 
Êags
 |
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
LBRR_Êag
;

520 if–!
¥efûlFœg
 ) {

521 
	`ec_íc_∑tch_öôül_bôs
–
psR™geEnc
, 
Êags
, ( 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
nFømesPîPackë
 + 1 ) * 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 );

525 if–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
öDTX
 && ( 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
 == 1 ||ÖsEnc->state_Fxx[ 1 ].sCmn.inDTX ) ) {

526 *
nByãsOut
 = 0;

529 
psEnc
->
nBôsEx˚eded
 +*
nByãsOut
 * 8;

530 
psEnc
->
nBôsEx˚eded
 -
	`sûk_DIV32_16
–
	`sûk_MUL
–
ícC⁄åﬁ
->
bôR©e
,ÉncC⁄åﬁ->
∑ylﬂdSize_ms
 ), 1000 );

531 
psEnc
->
nBôsEx˚eded
 = 
	`sûk_LIMIT
(ÖsEnc->nBitsExceeded, 0, 10000 );

534 
•ìch_a˘_thr_f‹_swôch_Q8
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–
SPEECH_ACTIVITY_DTX_THRES
, 8 ),

535 
	`SILK_FIX_CONST
––1 - 
SPEECH_ACTIVITY_DTX_THRES
 ) / 
MAX_BANDWIDTH_SWITCH_DELAY_MS
, 16 + 8 ), 
psEnc
->
timeSö˚SwôchAŒowed_ms
 );

536 if–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
•ìch_a˘ivôy_Q8
 < 
•ìch_a˘_thr_f‹_swôch_Q8
 ) {

537 
psEnc
->
ÆlowB™dwidthSwôch
 = 1;

538 
psEnc
->
timeSö˚SwôchAŒowed_ms
 = 0;

540 
psEnc
->
ÆlowB™dwidthSwôch
 = 0;

541 
psEnc
->
timeSö˚SwôchAŒowed_ms
 +
ícC⁄åﬁ
->
∑ylﬂdSize_ms
;

545 if–
nSam∂esIn
 == 0 ) {

551 
cuº_block
++;

554 
psEnc
->
nPªvCh™√lsI¡î«l
 = 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;

556 
ícC⁄åﬁ
->
ÆlowB™dwidthSwôch
 = 
psEnc
->allowBandwidthSwitch;

557 
ícC⁄åﬁ
->
öWBmodeWôhoutV¨übÀLP
 = 
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
 =16 &&ÖsEnc->°©e_Fxx[ 0 ].sCmn.
sLP
.
mode
 == 0;

558 
ícC⁄åﬁ
->
öã∫ÆSam∂eR©e
 = 
	`sûk_SMULBB
–
psEnc
->
°©e_Fxx
[ 0 ].
sCmn
.
fs_kHz
, 1000 );

559 
ícC⁄åﬁ
->
°îeoWidth_Q14
 =ÉncC⁄åﬁ->
toM⁄o
 ? 0 : 
psEnc
->
sSãªo
.
smth_width_Q14
;

560 if–
¥efûlFœg
 ) {

561 
ícC⁄åﬁ
->
∑ylﬂdSize_ms
 = 
tmp_∑ylﬂdSize_ms
;

562 
ícC⁄åﬁ
->
com∂exôy
 = 
tmp_com∂exôy
;

563  
n
 = 0;Ç < 
ícC⁄åﬁ
->
nCh™√lsI¡î«l
;Ç++ ) {

564 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
 = 0;

565 
psEnc
->
°©e_Fxx
[ 
n
 ].
sCmn
.
¥efûlFœg
 = 0;

569 
ícC⁄åﬁ
->
sig«lTy≥
 = 
psEnc
->
°©e_Fxx
[0].
sCmn
.
ödi˚s
.signalType;

570 
ícC⁄åﬁ
->
off£t
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10


571 [ 
psEnc
->
°©e_Fxx
[0].
sCmn
.
ödi˚s
.
sig«lTy≥
 >> 1 ]

572 [ 
psEnc
->
°©e_Fxx
[0].
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 ];

573 
RESTORE_STACK
;

574  
ªt
;

575 
	}
}

	@silk/encode_indices.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_ícode_ödi˚s
(

36 
sûk_ícodî_°©e
 *
psEncC
,

37 
ec_íc
 *
psR™geEnc
,

38 
›us_öt
 
FømeIndex
,

39 
›us_öt
 
ícode_LBRR
,

40 
›us_öt
 
c⁄dCodög


43 
›us_öt
 
i
, 
k
, 
ty≥Off£t
;

44 
›us_öt
 
ícode_absﬁuã_œgIndex
, 
dñè_œgIndex
;

45 
›us_öt16
 
ec_ix
[ 
MAX_LPC_ORDER
 ];

46 
›us_uöt8
 
¥ed_Q8
[ 
MAX_LPC_ORDER
 ];

47 c⁄° 
SideInfoIndi˚s
 *
psIndi˚s
;

49 if–
ícode_LBRR
 ) {

50 
psIndi˚s
 = &
psEncC
->
ödi˚s_LBRR
[ 
FømeIndex
 ];

52 
psIndi˚s
 = &
psEncC
->
ödi˚s
;

58 
ty≥Off£t
 = 2 * 
psIndi˚s
->
sig«lTy≥
 +ÖsIndi˚s->
qu™tOff£tTy≥
;

59 
	`˚…_as£π
–
ty≥Off£t
 >= 0 &&ÅypeOffset < 6 );

60 
	`˚…_as£π
–
ícode_LBRR
 =0 || 
ty≥Off£t
 >= 2 );

61 if–
ícode_LBRR
 || 
ty≥Off£t
 >= 2 ) {

62 
	`ec_íc_icdf
–
psR™geEnc
, 
ty≥Off£t
 - 2, 
sûk_ty≥_off£t_VAD_iCDF
, 8 );

64 
	`ec_íc_icdf
–
psR™geEnc
, 
ty≥Off£t
, 
sûk_ty≥_off£t_no_VAD_iCDF
, 8 );

71 if–
c⁄dCodög
 =
CODE_CONDITIONALLY
 ) {

73 
	`sûk_as£π
–
psIndi˚s
->
GaösIndi˚s
[ 0 ] >0 &&ÖsIndi˚s->GaösIndi˚s[ 0 ] < 
MAX_DELTA_GAIN_QUANT
 - 
MIN_DELTA_GAIN_QUANT
 + 1 );

74 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
GaösIndi˚s
[ 0 ], 
sûk_dñè_gaö_iCDF
, 8 );

77 
	`sûk_as£π
–
psIndi˚s
->
GaösIndi˚s
[ 0 ] >0 &&ÖsIndi˚s->GaösIndi˚s[ 0 ] < 
N_LEVELS_QGAIN
 );

78 
	`ec_íc_icdf
–
psR™geEnc
, 
	`sûk_RSHIFT
–
psIndi˚s
->
GaösIndi˚s
[ 0 ], 3 ), 
sûk_gaö_iCDF
[ÖsIndi˚s->
sig«lTy≥
 ], 8 );

79 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
GaösIndi˚s
[ 0 ] & 7, 
sûk_unif‹m8_iCDF
, 8 );

83  
i
 = 1; i < 
psEncC
->
nb_sub‰
; i++ ) {

84 
	`sûk_as£π
–
psIndi˚s
->
GaösIndi˚s
[ 
i
 ] >0 &&ÖsIndi˚s->GaösIndi˚s[ i ] < 
MAX_DELTA_GAIN_QUANT
 - 
MIN_DELTA_GAIN_QUANT
 + 1 );

85 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
GaösIndi˚s
[ 
i
 ], 
sûk_dñè_gaö_iCDF
, 8 );

91 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
NLSFIndi˚s
[ 0 ], &
psEncC
->
psNLSF_CB
->
CB1_iCDF
[ (ÖsIndi˚s->
sig«lTy≥
 >> 1 ) *ÖsEncC->psNLSF_CB->
nVe˘‹s
 ], 8 );

92 
	`sûk_NLSF_u≈ack
–
ec_ix
, 
¥ed_Q8
, 
psEncC
->
psNLSF_CB
, 
psIndi˚s
->
NLSFIndi˚s
[ 0 ] );

93 
	`˚…_as£π
–
psEncC
->
psNLSF_CB
->
‹dî
 =psEncC->
¥edi˘LPCOrdî
 );

94  
i
 = 0; i < 
psEncC
->
psNLSF_CB
->
‹dî
; i++ ) {

95 if–
psIndi˚s
->
NLSFIndi˚s
[ 
i
+1 ] >
NLSF_QUANT_MAX_AMPLITUDE
 ) {

96 
	`ec_íc_icdf
–
psR™geEnc
, 2 * 
NLSF_QUANT_MAX_AMPLITUDE
, &
psEncC
->
psNLSF_CB
->
ec_iCDF
[ 
ec_ix
[ 
i
 ] ], 8 );

97 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
NLSFIndi˚s
[ 
i
+1 ] - 
NLSF_QUANT_MAX_AMPLITUDE
, 
sûk_NLSF_EXT_iCDF
, 8 );

98 } if–
psIndi˚s
->
NLSFIndi˚s
[ 
i
+1 ] <-
NLSF_QUANT_MAX_AMPLITUDE
 ) {

99 
	`ec_íc_icdf
–
psR™geEnc
, 0, &
psEncC
->
psNLSF_CB
->
ec_iCDF
[ 
ec_ix
[ 
i
 ] ], 8 );

100 
	`ec_íc_icdf
–
psR™geEnc
, -
psIndi˚s
->
NLSFIndi˚s
[ 
i
+1 ] - 
NLSF_QUANT_MAX_AMPLITUDE
, 
sûk_NLSF_EXT_iCDF
, 8 );

102 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
NLSFIndi˚s
[ 
i
+1 ] + 
NLSF_QUANT_MAX_AMPLITUDE
, &
psEncC
->
psNLSF_CB
->
ec_iCDF
[ 
ec_ix
[ i ] ], 8 );

107 if–
psEncC
->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

108 
	`sûk_as£π
–
psIndi˚s
->
NLSFI¡îpC€f_Q2
 >= 0 &&ÖsIndices->NLSFInterpCoef_Q2 < 5 );

109 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
NLSFI¡îpC€f_Q2
, 
sûk_NLSF_öãΩﬁ©i⁄_Á˘‹_iCDF
, 8 );

112 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 )

118 
ícode_absﬁuã_œgIndex
 = 1;

119 if–
c⁄dCodög
 =
CODE_CONDITIONALLY
 && 
psEncC
->
ec_¥evSig«lTy≥
 =
TYPE_VOICED
 ) {

121 
dñè_œgIndex
 = 
psIndi˚s
->
œgIndex
 - 
psEncC
->
ec_¥evLagIndex
;

122 if–
dñè_œgIndex
 < -8 || delta_lagIndex > 11 ) {

123 
dñè_œgIndex
 = 0;

125 
dñè_œgIndex
 = delta_lagIndex + 9;

126 
ícode_absﬁuã_œgIndex
 = 0;

128 
	`sûk_as£π
–
dñè_œgIndex
 >= 0 && delta_lagIndex < 21 );

129 
	`ec_íc_icdf
–
psR™geEnc
, 
dñè_œgIndex
, 
sûk_pôch_dñè_iCDF
, 8 );

131 if–
ícode_absﬁuã_œgIndex
 ) {

133 
›us_öt32
 
pôch_high_bôs
, 
pôch_low_bôs
;

134 
pôch_high_bôs
 = 
	`sûk_DIV32_16
–
psIndi˚s
->
œgIndex
, 
	`sûk_RSHIFT
–
psEncC
->
fs_kHz
, 1 ) );

135 
pôch_low_bôs
 = 
psIndi˚s
->
œgIndex
 - 
	`sûk_SMULBB
–
pôch_high_bôs
, 
	`sûk_RSHIFT
–
psEncC
->
fs_kHz
, 1 ) );

136 
	`sûk_as£π
–
pôch_low_bôs
 < 
psEncC
->
fs_kHz
 / 2 );

137 
	`sûk_as£π
–
pôch_high_bôs
 < 32 );

138 
	`ec_íc_icdf
–
psR™geEnc
, 
pôch_high_bôs
, 
sûk_pôch_œg_iCDF
, 8 );

139 
	`ec_íc_icdf
–
psR™geEnc
, 
pôch_low_bôs
, 
psEncC
->
pôch_œg_low_bôs_iCDF
, 8 );

141 
psEncC
->
ec_¥evLagIndex
 = 
psIndi˚s
->
œgIndex
;

144 
	`sûk_as£π
–
psIndi˚s
->
c⁄tourIndex
 >= 0 );

145 
	`sûk_as£π
––
psIndi˚s
->
c⁄tourIndex
 < 34 && 
psEncC
->
fs_kHz
 > 8 &&ÖsEncC->
nb_sub‰
 == 4 ) ||

146 –
psIndi˚s
->
c⁄tourIndex
 < 11 && 
psEncC
->
fs_kHz
 =8 &&ÖsEncC->
nb_sub‰
 == 4 ) ||

147 –
psIndi˚s
->
c⁄tourIndex
 < 12 && 
psEncC
->
fs_kHz
 > 8 &&ÖsEncC->
nb_sub‰
 == 2 ) ||

148 –
psIndi˚s
->
c⁄tourIndex
 < 3 && 
psEncC
->
fs_kHz
 =8 &&ÖsEncC->
nb_sub‰
 == 2 ) );

149 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
c⁄tourIndex
, 
psEncC
->
pôch_c⁄tour_iCDF
, 8 );

155 
	`sûk_as£π
–
psIndi˚s
->
PERIndex
 >= 0 &&ÖsIndices->PERIndex < 3 );

156 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
PERIndex
, 
sûk_LTP_≥r_ödex_iCDF
, 8 );

159  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

160 
	`sûk_as£π
–
psIndi˚s
->
LTPIndex
[ 
k
 ] >0 &&ÖsIndi˚s->LTPIndex[ k ] < ( 8 <<ÖsIndi˚s->
PERIndex
 ) );

161 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
LTPIndex
[ 
k
 ], 
sûk_LTP_gaö_iCDF_±rs
[ÖsIndi˚s->
PERIndex
 ], 8 );

167 if–
c⁄dCodög
 =
CODE_INDEPENDENTLY
 ) {

168 
	`sûk_as£π
–
psIndi˚s
->
LTP_sˇÀIndex
 >= 0 &&ÖsIndices->LTP_scaleIndex < 3 );

169 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
LTP_sˇÀIndex
, 
sûk_LTPsˇÀ_iCDF
, 8 );

171 
	`sûk_as£π
–!
c⁄dCodög
 || 
psIndi˚s
->
LTP_sˇÀIndex
 == 0 );

174 
psEncC
->
ec_¥evSig«lTy≥
 = 
psIndi˚s
->
sig«lTy≥
;

179 
	`sûk_as£π
–
psIndi˚s
->
Sìd
 >= 0 &&ÖsIndices->Seed < 4 );

180 
	`ec_íc_icdf
–
psR™geEnc
, 
psIndi˚s
->
Sìd
, 
sûk_unif‹m4_iCDF
, 8 );

181 
	}
}

	@silk/encode_pulses.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

39 
OPUS_INLINE
 
›us_öt
 
	$comböe_™d_check
(

40 
›us_öt
 *
pul£s_comb
,

41 c⁄° 
›us_öt
 *
pul£s_ö
,

42 
›us_öt
 
max_pul£s
,

43 
›us_öt
 
Àn


46 
›us_öt
 
k
, 
sum
;

48  
k
 = 0; k < 
Àn
; k++ ) {

49 
sum
 = 
pul£s_ö
[ 2 * 
k
 ] +Öulses_in[ 2 * k + 1 ];

50 if–
sum
 > 
max_pul£s
 ) {

53 
pul£s_comb
[ 
k
 ] = 
sum
;

57 
	}
}

60 
	$sûk_ícode_pul£s
(

61 
ec_íc
 *
psR™geEnc
,

62 c⁄° 
›us_öt
 
sig«lTy≥
,

63 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

64 
›us_öt8
 
pul£s
[],

65 c⁄° 
›us_öt
 
‰ame_Àngth


68 
›us_öt
 
i
, 
k
, 
j
, 
ôî
, 
bô
, 
nLS
, 
sˇÀ_down
, 
R©eLevñIndex
 = 0;

69 
›us_öt32
 
abs_q
, 
möSumBôs_Q5
, 
sumBôs_Q5
;

70 
	`VARDECL
–
›us_öt
, 
abs_pul£s
 );

71 
	`VARDECL
–
›us_öt
, 
sum_pul£s
 );

72 
	`VARDECL
–
›us_öt
, 
nRshi·s
 );

73 
›us_öt
 
pul£s_comb
[ 8 ];

74 
›us_öt
 *
abs_pul£s_±r
;

75 c⁄° 
›us_öt8
 *
pul£s_±r
;

76 c⁄° 
›us_uöt8
 *
cdf_±r
;

77 c⁄° 
›us_uöt8
 *
nBôs_±r
;

78 
SAVE_STACK
;

80 
	`sûk_mem£t
–
pul£s_comb
, 0, 8 * –
›us_öt
 ) );

86 
	`sûk_as£π
–1 << 
LOG2_SHELL_CODEC_FRAME_LENGTH
 =
SHELL_CODEC_FRAME_LENGTH
 );

87 
ôî
 = 
	`sûk_RSHIFT
–
‰ame_Àngth
, 
LOG2_SHELL_CODEC_FRAME_LENGTH
 );

88 if–
ôî
 * 
SHELL_CODEC_FRAME_LENGTH
 < 
‰ame_Àngth
 ) {

89 
	`˚…_as£π
–
‰ame_Àngth
 == 12 * 10 );

90 
ôî
++;

91 
	`sûk_mem£t
–&
pul£s
[ 
‰ame_Àngth
 ], 0, 
SHELL_CODEC_FRAME_LENGTH
 * (
›us_öt8
));

95 
	`ALLOC
–
abs_pul£s
, 
ôî
 * 
SHELL_CODEC_FRAME_LENGTH
, 
›us_öt
 );

96 
	`sûk_as£π
–!–
SHELL_CODEC_FRAME_LENGTH
 & 3 ) );

97  
i
 = 0; i < 
ôî
 * 
SHELL_CODEC_FRAME_LENGTH
; i+=4 ) {

98 
abs_pul£s
[
i
+0] = ( 
›us_öt
 )
	`sûk_abs
–
pul£s
[ i + 0 ] );

99 
abs_pul£s
[
i
+1] = ( 
›us_öt
 )
	`sûk_abs
–
pul£s
[ i + 1 ] );

100 
abs_pul£s
[
i
+2] = ( 
›us_öt
 )
	`sûk_abs
–
pul£s
[ i + 2 ] );

101 
abs_pul£s
[
i
+3] = ( 
›us_öt
 )
	`sûk_abs
–
pul£s
[ i + 3 ] );

105 
	`ALLOC
–
sum_pul£s
, 
ôî
, 
›us_öt
 );

106 
	`ALLOC
–
nRshi·s
, 
ôî
, 
›us_öt
 );

107 
abs_pul£s_±r
 = 
abs_pul£s
;

108  
i
 = 0; i < 
ôî
; i++ ) {

109 
nRshi·s
[ 
i
 ] = 0;

113 
sˇÀ_down
 = 
	`comböe_™d_check
–
pul£s_comb
, 
abs_pul£s_±r
, 
sûk_max_pul£s_èbÀ
[ 0 ], 8 );

115 
sˇÀ_down
 +
	`comböe_™d_check
–
pul£s_comb
,Öul£s_comb, 
sûk_max_pul£s_èbÀ
[ 1 ], 4 );

117 
sˇÀ_down
 +
	`comböe_™d_check
–
pul£s_comb
,Öul£s_comb, 
sûk_max_pul£s_èbÀ
[ 2 ], 2 );

119 
sˇÀ_down
 +
	`comböe_™d_check
–&
sum_pul£s
[ 
i
 ], 
pul£s_comb
, 
sûk_max_pul£s_èbÀ
[ 3 ], 1 );

121 if–
sˇÀ_down
 ) {

123 
nRshi·s
[ 
i
 ]++;

124  
k
 = 0; k < 
SHELL_CODEC_FRAME_LENGTH
; k++ ) {

125 
abs_pul£s_±r
[ 
k
 ] = 
	`sûk_RSHIFT
(ábs_pulses_ptr[ k ], 1 );

132 
abs_pul£s_±r
 +
SHELL_CODEC_FRAME_LENGTH
;

139 
möSumBôs_Q5
 = 
sûk_öt32_MAX
;

140  
k
 = 0; k < 
N_RATE_LEVELS
 - 1; k++ ) {

141 
nBôs_±r
 = 
sûk_pul£s_≥r_block_BITS_Q5
[ 
k
 ];

142 
sumBôs_Q5
 = 
sûk_øã_Àvñs_BITS_Q5
[ 
sig«lTy≥
 >> 1 ][ 
k
 ];

143  
i
 = 0; i < 
ôî
; i++ ) {

144 if–
nRshi·s
[ 
i
 ] > 0 ) {

145 
sumBôs_Q5
 +
nBôs_±r
[ 
SILK_MAX_PULSES
 + 1 ];

147 
sumBôs_Q5
 +
nBôs_±r
[ 
sum_pul£s
[ 
i
 ] ];

150 if–
sumBôs_Q5
 < 
möSumBôs_Q5
 ) {

151 
möSumBôs_Q5
 = 
sumBôs_Q5
;

152 
R©eLevñIndex
 = 
k
;

155 
	`ec_íc_icdf
–
psR™geEnc
, 
R©eLevñIndex
, 
sûk_øã_Àvñs_iCDF
[ 
sig«lTy≥
 >> 1 ], 8 );

160 
cdf_±r
 = 
sûk_pul£s_≥r_block_iCDF
[ 
R©eLevñIndex
 ];

161  
i
 = 0; i < 
ôî
; i++ ) {

162 if–
nRshi·s
[ 
i
 ] == 0 ) {

163 
	`ec_íc_icdf
–
psR™geEnc
, 
sum_pul£s
[ 
i
 ], 
cdf_±r
, 8 );

165 
	`ec_íc_icdf
–
psR™geEnc
, 
SILK_MAX_PULSES
 + 1, 
cdf_±r
, 8 );

166  
k
 = 0; k < 
nRshi·s
[ 
i
 ] - 1; k++ ) {

167 
	`ec_íc_icdf
–
psR™geEnc
, 
SILK_MAX_PULSES
 + 1, 
sûk_pul£s_≥r_block_iCDF
[ 
N_RATE_LEVELS
 - 1 ], 8 );

169 
	`ec_íc_icdf
–
psR™geEnc
, 
sum_pul£s
[ 
i
 ], 
sûk_pul£s_≥r_block_iCDF
[ 
N_RATE_LEVELS
 - 1 ], 8 );

176  
i
 = 0; i < 
ôî
; i++ ) {

177 if–
sum_pul£s
[ 
i
 ] > 0 ) {

178 
	`sûk_shñl_ícodî
–
psR™geEnc
, &
abs_pul£s
[ 
i
 * 
SHELL_CODEC_FRAME_LENGTH
 ] );

185  
i
 = 0; i < 
ôî
; i++ ) {

186 if–
nRshi·s
[ 
i
 ] > 0 ) {

187 
pul£s_±r
 = &
pul£s
[ 
i
 * 
SHELL_CODEC_FRAME_LENGTH
 ];

188 
nLS
 = 
nRshi·s
[ 
i
 ] - 1;

189  
k
 = 0; k < 
SHELL_CODEC_FRAME_LENGTH
; k++ ) {

190 
abs_q
 = (
›us_öt8
)
	`sûk_abs
–
pul£s_±r
[ 
k
 ] );

191  
j
 = 
nLS
; j > 0; j-- ) {

192 
bô
 = 
	`sûk_RSHIFT
–
abs_q
, 
j
 ) & 1;

193 
	`ec_íc_icdf
–
psR™geEnc
, 
bô
, 
sûk_lsb_iCDF
, 8 );

195 
bô
 = 
abs_q
 & 1;

196 
	`ec_íc_icdf
–
psR™geEnc
, 
bô
, 
sûk_lsb_iCDF
, 8 );

204 
	`sûk_ícode_signs
–
psR™geEnc
, 
pul£s
, 
‰ame_Àngth
, 
sig«lTy≥
, 
qu™tOff£tTy≥
, 
sum_pul£s
 );

205 
RESTORE_STACK
;

206 
	}
}

	@silk/errors.h

28 #i‚de‡
SILK_ERRORS_H


29 
	#SILK_ERRORS_H


	)

31 #ifde‡
__˝lu•lus


39 
	#SILK_NO_ERROR
 0

	)

46 
	#SILK_ENC_INPUT_INVALID_NO_OF_SAMPLES
 -101

	)

49 
	#SILK_ENC_FS_NOT_SUPPORTED
 -102

	)

52 
	#SILK_ENC_PACKET_SIZE_NOT_SUPPORTED
 -103

	)

55 
	#SILK_ENC_PAYLOAD_BUF_TOO_SHORT
 -104

	)

58 
	#SILK_ENC_INVALID_LOSS_RATE
 -105

	)

61 
	#SILK_ENC_INVALID_COMPLEXITY_SETTING
 -106

	)

64 
	#SILK_ENC_INVALID_INBAND_FEC_SETTING
 -107

	)

67 
	#SILK_ENC_INVALID_DTX_SETTING
 -108

	)

70 
	#SILK_ENC_INVALID_CBR_SETTING
 -109

	)

73 
	#SILK_ENC_INTERNAL_ERROR
 -110

	)

76 
	#SILK_ENC_INVALID_NUMBER_OF_CHANNELS_ERROR
 -111

	)

83 
	#SILK_DEC_INVALID_SAMPLING_FREQUENCY
 -200

	)

86 
	#SILK_DEC_PAYLOAD_TOO_LARGE
 -201

	)

89 
	#SILK_DEC_PAYLOAD_ERROR
 -202

	)

92 
	#SILK_DEC_INVALID_FRAME_SIZE
 -203

	)

94 #ifde‡
__˝lu•lus


	@silk/fixed/LTP_analysis_filter_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

34 
	$sûk_LTP_™Æysis_fûãr_FIX
(

35 
›us_öt16
 *
LTP_ªs
,

36 c⁄° 
›us_öt16
 *
x
,

37 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

38 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

39 c⁄° 
›us_öt32
 
övGaös_Q16
[ 
MAX_NB_SUBFR
 ],

40 c⁄° 
›us_öt
 
sub‰_Àngth
,

41 c⁄° 
›us_öt
 
nb_sub‰
,

42 c⁄° 
›us_öt
 
¥e_Àngth


45 c⁄° 
›us_öt16
 *
x_±r
, *
x_œg_±r
;

46 
›us_öt16
 
Btmp_Q14
[ 
LTP_ORDER
 ];

47 
›us_öt16
 *
LTP_ªs_±r
;

48 
›us_öt
 
k
, 
i
;

49 
›us_öt32
 
LTP_e°
;

51 
x_±r
 = 
x
;

52 
LTP_ªs_±r
 = 
LTP_ªs
;

53  
k
 = 0; k < 
nb_sub‰
; k++ ) {

55 
x_œg_±r
 = 
x_±r
 - 
pôchL
[ 
k
 ];

57 
Btmp_Q14
[ 0 ] = 
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

58 
Btmp_Q14
[ 1 ] = 
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 + 1 ];

59 
Btmp_Q14
[ 2 ] = 
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 + 2 ];

60 
Btmp_Q14
[ 3 ] = 
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 + 3 ];

61 
Btmp_Q14
[ 4 ] = 
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 + 4 ];

64  
i
 = 0; i < 
sub‰_Àngth
 + 
¥e_Àngth
; i++ ) {

65 
LTP_ªs_±r
[ 
i
 ] = 
x_±r
[ i ];

68 
LTP_e°
 = 
	`sûk_SMULBB
–
x_œg_±r
[ 
LTP_ORDER
 / 2 ], 
Btmp_Q14
[ 0 ] );

69 
LTP_e°
 = 
	`sûk_SMLABB_ovÊw
–LTP_e°, 
x_œg_±r
[ 1 ], 
Btmp_Q14
[ 1 ] );

70 
LTP_e°
 = 
	`sûk_SMLABB_ovÊw
–LTP_e°, 
x_œg_±r
[ 0 ], 
Btmp_Q14
[ 2 ] );

71 
LTP_e°
 = 
	`sûk_SMLABB_ovÊw
–LTP_e°, 
x_œg_±r
[ -1 ], 
Btmp_Q14
[ 3 ] );

72 
LTP_e°
 = 
	`sûk_SMLABB_ovÊw
–LTP_e°, 
x_œg_±r
[ -2 ], 
Btmp_Q14
[ 4 ] );

74 
LTP_e°
 = 
	`sûk_RSHIFT_ROUND
( LTP_est, 14 );

77 
LTP_ªs_±r
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–(
›us_öt32
)
x_±r
[ i ] - 
LTP_e°
 );

80 
LTP_ªs_±r
[ 
i
 ] = 
	`sûk_SMULWB
–
övGaös_Q16
[ 
k
 ], LTP_res_ptr[ i ] );

82 
x_œg_±r
++;

86 
LTP_ªs_±r
 +
sub‰_Àngth
 + 
¥e_Àngth
;

87 
x_±r
 +
sub‰_Àngth
;

89 
	}
}

	@silk/fixed/LTP_scale_ctrl_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

35 
	$sûk_LTP_sˇÀ_˘æ_FIX
(

36 
sûk_ícodî_°©e_FIX
 *
psEnc
,

37 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

38 
›us_öt
 
c⁄dCodög


41 
›us_öt
 
round_loss
;

43 if–
c⁄dCodög
 =
CODE_INDEPENDENTLY
 ) {

45 
round_loss
 = 
psEnc
->
sCmn
.
PackëLoss_≥rc
 +ÖsEnc->sCmn.
nFømesPîPackë
;

46 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 = (
›us_öt8
)
	`sûk_LIMIT
(

47 
	`sûk_SMULWB
–
	`sûk_SMULBB
–
round_loss
, 
psEncCål
->
LTPªdCodGaö_Q7
 ), 
	`SILK_FIX_CONST
( 0.1, 9 ) ), 0, 2 );

50 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 = 0;

52 
psEncCål
->
LTP_sˇÀ_Q14
 = 
sûk_LTPSˇÀs_èbÀ_Q14
[ 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 ];

53 
	}
}

	@silk/fixed/apply_sine_window_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

44 c⁄° 
›us_öt16
 
	g‰eq_èbÀ_Q16
[ 27 ] = {

50 
	$sûk_≠∂y_söe_wödow
(

51 
›us_öt16
 
px_wö
[],

52 c⁄° 
›us_öt16
 
px
[],

53 c⁄° 
›us_öt
 
wö_ty≥
,

54 c⁄° 
›us_öt
 
Àngth


57 
›us_öt
 
k
, 
f_Q16
, 
c_Q16
;

58 
›us_öt32
 
S0_Q16
, 
S1_Q16
;

60 
	`˚…_as£π
–
wö_ty≥
 == 1 || win_type == 2 );

63 
	`˚…_as£π
–
Àngth
 >= 16 &&Üength <= 120 );

64 
	`˚…_as£π
––
Àngth
 & 3 ) == 0 );

67 
k
 = ( 
Àngth
 >> 2 ) - 4;

68 
	`˚…_as£π
–
k
 >= 0 && k <= 26 );

69 
f_Q16
 = (
›us_öt
)
‰eq_èbÀ_Q16
[ 
k
 ];

72 
c_Q16
 = 
	`sûk_SMULWB
–(
›us_öt32
)
f_Q16
, -f_Q16 );

73 
	`sûk_as£π
–
c_Q16
 >= -32768 );

76 if–
wö_ty≥
 == 1 ) {

78 
S0_Q16
 = 0;

80 
S1_Q16
 = 
f_Q16
 + 
	`sûk_RSHIFT
–
Àngth
, 3 );

83 
S0_Q16
 = ( (
›us_öt32
)1 << 16 );

85 
S1_Q16
 = ( (
›us_öt32
)1 << 16 ) + 
	`sûk_RSHIFT
–
c_Q16
, 1 ) + sûk_RSHIFT–
Àngth
, 4 );

90  
k
 = 0; k < 
Àngth
; k += 4 ) {

91 
px_wö
[ 
k
 ] = (
›us_öt16
)
	`sûk_SMULWB
–
	`sûk_RSHIFT
–
S0_Q16
 + 
S1_Q16
, 1 ), 
px
[ k ] );

92 
px_wö
[ 
k
 + 1 ] = (
›us_öt16
)
	`sûk_SMULWB
–
S1_Q16
, 
px
[ k + 1] );

93 
S0_Q16
 = 
	`sûk_SMULWB
–
S1_Q16
, 
c_Q16
 ) + 
	`sûk_LSHIFT
( S1_Q16, 1 ) - S0_Q16 + 1;

94 
S0_Q16
 = 
	`sûk_mö
–S0_Q16, ( (
›us_öt32
)1 << 16 ) );

96 
px_wö
[ 
k
 + 2 ] = (
›us_öt16
)
	`sûk_SMULWB
–
	`sûk_RSHIFT
–
S0_Q16
 + 
S1_Q16
, 1 ), 
px
[ k + 2] );

97 
px_wö
[ 
k
 + 3 ] = (
›us_öt16
)
	`sûk_SMULWB
–
S0_Q16
, 
px
[ k + 3 ] );

98 
S1_Q16
 = 
	`sûk_SMULWB
–
S0_Q16
, 
c_Q16
 ) + 
	`sûk_LSHIFT
( S0_Q16, 1 ) - S1_Q16;

99 
S1_Q16
 = 
	`sûk_mö
–S1_Q16, ( (
›us_öt32
)1 << 16 ) );

101 
	}
}

	@silk/fixed/arm/warped_autocorrelation_FIX_arm.h

28 #i‚de‡
SILK_WARPED_AUTOCORRELATION_FIX_ARM_H


29 
	#SILK_WARPED_AUTOCORRELATION_FIX_ARM_H


	)

31 
	~"˚…/¨m/¨m˝u.h
"

33 #i‡
deföed
(
FIXED_POINT
)

35 #i‡
deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
)

36 
sûk_w¨≥d_autoc‹ªœti⁄_FIX_√⁄
(

37 
›us_öt32
 *
c‹r
,

38 
›us_öt
 *
sˇÀ
,

39 c⁄° 
›us_öt16
 *
öput
,

40 c⁄° 
›us_öt
 
w¨pög_Q16
,

41 c⁄° 
›us_öt
 
Àngth
,

42 c⁄° 
›us_öt
 
‹dî


45 #i‡!
deföed
(
OPUS_HAVE_RTCD
Ë&& deföed(
OPUS_ARM_PRESUME_NEON
)

46 
	#OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX
 (1)

	)

47 
	#sûk_w¨≥d_autoc‹ªœti⁄_FIX
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
, 
¨ch
) \

48 (()(
¨ch
), 
	`PRESUME_NEON
(
sûk_w¨≥d_autoc‹ªœti⁄_FIX
)(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
))

	)

52 #i‡!
deföed
(
OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX
)

54 #i‡
deföed
(
OPUS_HAVE_RTCD
Ë&& (deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
Ë&& !deföed(
OPUS_ARM_PRESUME_NEON_INTR
))

55 (*c⁄° 
SILK_WARPED_AUTOCORRELATION_FIX_IMPL
[
OPUS_ARCHMASK
+1])(
›us_öt32
*, 
›us_öt
*, c⁄° 
›us_öt16
*, const opus_int, const opus_int, const opus_int);

56 
	#OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX
 (1)

	)

57 
	#sûk_w¨≥d_autoc‹ªœti⁄_FIX
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
, 
¨ch
) \

58 ((*
SILK_WARPED_AUTOCORRELATION_FIX_IMPL
[(
¨ch
)&
OPUS_ARCHMASK
])(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
))

	)

59 #ñi‡
deföed
(
OPUS_ARM_PRESUME_NEON_INTR
)

60 
	#OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX
 (1)

	)

61 
	#sûk_w¨≥d_autoc‹ªœti⁄_FIX
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
, 
¨ch
) \

62 (()(
¨ch
), 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX_√⁄
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
))

	)

	@silk/fixed/arm/warped_autocorrelation_FIX_neon_intr.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<¨m_√⁄.h
>

33 #ifde‡
OPUS_CHECK_ASM


34 
	~<°rög.h
>

36 
	~"°ack_Æloc.h
"

37 
	~"maö_FIX.h
"

39 
OPUS_INLINE
 
	$ˇlc_c‹r
–c⁄° 
›us_öt32
 *c⁄° 
öput_QS
, 
›us_öt64
 *c⁄° 
c‹r_QC
, c⁄° 
›us_öt
 
off£t
, c⁄° 
öt32x4_t
 
°©e_QS_s32x4
 )

41 
öt64x2_t
 
c‹r_QC_s64x2
[ 2 ], 
t_s64x2
[ 2 ];

42 c⁄° 
öt32x4_t
 
öput_QS_s32x4
 = 
	`vld1q_s32
–
öput_QS
 + 
off£t
 );

43 
c‹r_QC_s64x2
[ 0 ] = 
	`vld1q_s64
–
c‹r_QC
 + 
off£t
 + 0 );

44 
c‹r_QC_s64x2
[ 1 ] = 
	`vld1q_s64
–
c‹r_QC
 + 
off£t
 + 2 );

45 
t_s64x2
[ 0 ] = 
	`vmuŒ_s32
–
	`vgë_low_s32
–
°©e_QS_s32x4
 ), vgë_low_s32–
öput_QS_s32x4
 ) );

46 
t_s64x2
[ 1 ] = 
	`vmuŒ_s32
–
	`vgë_high_s32
–
°©e_QS_s32x4
 ), vgë_high_s32–
öput_QS_s32x4
 ) );

47 
c‹r_QC_s64x2
[ 0 ] = 
	`v§aq_n_s64
–c‹r_QC_s64x2[ 0 ], 
t_s64x2
[ 0 ], 2 * 
QS
 - 
QC
 );

48 
c‹r_QC_s64x2
[ 1 ] = 
	`v§aq_n_s64
–c‹r_QC_s64x2[ 1 ], 
t_s64x2
[ 1 ], 2 * 
QS
 - 
QC
 );

49 
	`v°1q_s64
–
c‹r_QC
 + 
off£t
 + 0, 
c‹r_QC_s64x2
[ 0 ] );

50 
	`v°1q_s64
–
c‹r_QC
 + 
off£t
 + 2, 
c‹r_QC_s64x2
[ 1 ] );

51 
	}
}

53 
OPUS_INLINE
 
öt32x4_t
 
	$ˇlc_°©e
–c⁄° 
öt32x4_t
 
°©e_QS0_s32x4
, c⁄° i¡32x4_à
°©e_QS0_1_s32x4
, c⁄° i¡32x4_à
°©e_QS1_1_s32x4
, c⁄° i¡32x4_à
w¨pög_Q16_s32x4
 )

55 
öt32x4_t
 
t_s32x4
 = 
	`vsubq_s32
–
°©e_QS0_s32x4
, 
°©e_QS0_1_s32x4
 );

56 
t_s32x4
 = 
	`vqdmulhq_s32
–t_s32x4, 
w¨pög_Q16_s32x4
 );

57  
	`vaddq_s32
–
°©e_QS1_1_s32x4
, 
t_s32x4
 );

58 
	}
}

60 
	$sûk_w¨≥d_autoc‹ªœti⁄_FIX_√⁄
(

61 
›us_öt32
 *
c‹r
,

62 
›us_öt
 *
sˇÀ
,

63 c⁄° 
›us_öt16
 *
öput
,

64 c⁄° 
›us_öt
 
w¨pög_Q16
,

65 c⁄° 
›us_öt
 
Àngth
,

66 c⁄° 
›us_öt
 
‹dî


69 if––
MAX_SHAPE_LPC_ORDER
 > 24 ) || ( 
‹dî
 < 6 ) ) {

70 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
–
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
 );

72 
›us_öt
 
n
, 
i
, 
lsh
;

73 
›us_öt64
 
c‹r_QC
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

74 
›us_öt64
 
c‹r_QC_‹dîT
;

75 
öt64x2_t
 
lsh_s64x2
;

76 c⁄° 
›us_öt
 
‹dîT
 = ( 
‹dî
 + 3 ) & ~3;

77 
›us_öt64
 *
c‹r_QCT
;

78 
›us_öt32
 *
öput_QS
;

79 
	`VARDECL
–
›us_öt32
, 
öput_QST
 );

80 
	`VARDECL
–
›us_öt32
, 
°©e
 );

81 
SAVE_STACK
;

84 
	`sûk_as£π
––
‹dî
 & 1 ) == 0 );

85 
	`sûk_as£π
–2 * 
QS
 - 
QC
 >= 0 );

87 
	`ALLOC
–
öput_QST
, 
Àngth
 + 2 * 
MAX_SHAPE_LPC_ORDER
, 
›us_öt32
 );

89 
öput_QS
 = 
öput_QST
;

91 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

92 
öput_QS
 += 4;

93 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

94 
öput_QS
 += 4;

95 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

96 
öput_QS
 += 4;

97 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

98 
öput_QS
 += 4;

99 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

100 
öput_QS
 += 4;

101 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

102 
öput_QS
 += 4;

105  
n
 = 0;Ç < 
Àngth
 - 7;Ç +8, 
öput_QS
 += 8 ) {

106 c⁄° 
öt16x8_t
 
t0_s16x4
 = 
	`vld1q_s16
–
öput
 + 
n
 );

107 
	`v°1q_s32
–
öput_QS
 + 0, 
	`vshŒ_n_s16
–
	`vgë_low_s16
–
t0_s16x4
 ), 
QS
 ) );

108 
	`v°1q_s32
–
öput_QS
 + 4, 
	`vshŒ_n_s16
–
	`vgë_high_s16
–
t0_s16x4
 ), 
QS
 ) );

110  ; 
n
 < 
Àngth
;Ç++, 
öput_QS
++ ) {

111 
öput_QS
[ 0 ] = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
 ], 
QS
 );

113 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

114 
öput_QS
 += 4;

115 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

116 
öput_QS
 += 4;

117 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

118 
öput_QS
 += 4;

119 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

120 
öput_QS
 += 4;

121 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

122 
öput_QS
 += 4;

123 
	`v°1q_s32
–
öput_QS
, 
	`vdupq_n_s32
( 0 ) );

124 
öput_QS
 = 
öput_QST
 + 
MAX_SHAPE_LPC_ORDER
 - 
‹dîT
;

151 c⁄° 
öt32x4_t
 
w¨pög_Q16_s32x4
 = 
	`vdupq_n_s32
–
w¨pög_Q16
 << 15 );

152 c⁄° 
›us_öt32
 *
ö
 = 
öput_QS
 + 
‹dîT
;

153 
›us_öt
 
o
 = 
‹dîT
;

154 
öt32x4_t
 
°©e_QS_s32x4
[ 3 ][ 2 ];

156 
	`ALLOC
–
°©e
, 
Àngth
 + 
‹dîT
, 
›us_öt32
 );

157 
°©e_QS_s32x4
[ 2 ][ 1 ] = 
	`vdupq_n_s32
( 0 );

161 
°©e_QS_s32x4
[ 0 ][ 0 ] = state_QS_s32x4[ 0 ][ 1 ] =

162 
°©e_QS_s32x4
[ 1 ][ 0 ] = sèã_QS_s32x4[ 1 ][ 1 ] = 
	`vdupq_n_s32
( 0 );

163 
n
 = 0;

165 
	`ˇlc_c‹r
–
öput_QS
 + 
n
, 
c‹r_QC
, 
o
 - 8, 
°©e_QS_s32x4
[ 0 ][ 0 ] );

166 
	`ˇlc_c‹r
–
öput_QS
 + 
n
, 
c‹r_QC
, 
o
 - 4, 
°©e_QS_s32x4
[ 0 ][ 1 ] );

167 
°©e_QS_s32x4
[ 2 ][ 1 ] = 
	`vld1q_s32
–
ö
 + 
n
 );

168 
	`v°1q_œ√_s32
–
°©e
 + 
n
, 
°©e_QS_s32x4
[ 0 ][ 0 ], 0 );

169 
°©e_QS_s32x4
[ 2 ][ 0 ] = 
	`vextq_s32
( state_QS_s32x4[ 0 ][ 0 ], state_QS_s32x4[ 0 ][ 1 ], 1 );

170 
°©e_QS_s32x4
[ 2 ][ 1 ] = 
	`vextq_s32
( state_QS_s32x4[ 0 ][ 1 ], state_QS_s32x4[ 2 ][ 1 ], 1 );

171 
°©e_QS_s32x4
[ 0 ][ 0 ] = 
	`ˇlc_°©e
–°©e_QS_s32x4[ 0 ][ 0 ], sèã_QS_s32x4[ 2 ][ 0 ], sèã_QS_s32x4[ 1 ][ 0 ], 
w¨pög_Q16_s32x4
 );

172 
°©e_QS_s32x4
[ 0 ][ 1 ] = 
	`ˇlc_°©e
–°©e_QS_s32x4[ 0 ][ 1 ], sèã_QS_s32x4[ 2 ][ 1 ], sèã_QS_s32x4[ 1 ][ 1 ], 
w¨pög_Q16_s32x4
 );

173 
°©e_QS_s32x4
[ 1 ][ 0 ] = state_QS_s32x4[ 2 ][ 0 ];

174 
°©e_QS_s32x4
[ 1 ][ 1 ] = state_QS_s32x4[ 2 ][ 1 ];

175 }  ++
n
 < ( 
Àngth
 + 
‹dî
 ) );

176 
ö
 = 
°©e
;

177 
o
 -= 8;

178 }  
o
 > 4 );

180 if–
o
 ) {

182 
›us_öt32
 *
°©eT
 = 
°©e
;

183 
	`sûk_as£π
–
o
 == 4 );

184 
°©e_QS_s32x4
[ 0 ][ 0 ] = sèã_QS_s32x4[ 1 ][ 0 ] = 
	`vdupq_n_s32
( 0 );

185 
n
 = 
Àngth
 + 
‹dî
;

187 
	`ˇlc_c‹r
–
öput_QS
, 
c‹r_QC
, 0, 
°©e_QS_s32x4
[ 0 ][ 0 ] );

188 
°©e_QS_s32x4
[ 2 ][ 0 ] = 
	`vld1q_s32
–
°©eT
 );

189 
	`v°1q_œ√_s32
–
°©eT
, 
°©e_QS_s32x4
[ 0 ][ 0 ], 0 );

190 
°©e_QS_s32x4
[ 2 ][ 0 ] = 
	`vextq_s32
( state_QS_s32x4[ 0 ][ 0 ], state_QS_s32x4[ 2 ][ 0 ], 1 );

191 
°©e_QS_s32x4
[ 0 ][ 0 ] = 
	`ˇlc_°©e
–°©e_QS_s32x4[ 0 ][ 0 ], sèã_QS_s32x4[ 2 ][ 0 ], sèã_QS_s32x4[ 1 ][ 0 ], 
w¨pög_Q16_s32x4
 );

192 
°©e_QS_s32x4
[ 1 ][ 0 ] = state_QS_s32x4[ 2 ][ 0 ];

193 
öput_QS
++;

194 
°©eT
++;

195 }  --
n
 );

200 c⁄° 
›us_öt16
 *
öputT
 = 
öput
;

201 
öt32x4_t
 
t_s32x4
;

202 
öt64x1_t
 
t_s64x1
;

203 
öt64x2_t
 
t_s64x2
 = 
	`vdupq_n_s64
( 0 );

204  
n
 = 0;Ç <
Àngth
 - 8;Ç += 8 ) {

205 
öt16x8_t
 
öput_s16x8
 = 
	`vld1q_s16
–
öputT
 );

206 
t_s32x4
 = 
	`vmuŒ_s16
–
	`vgë_low_s16
–
öput_s16x8
 ), vget_low_s16( input_s16x8 ) );

207 
t_s32x4
 = 
	`vmœl_s16
–t_s32x4, 
	`vgë_high_s16
–
öput_s16x8
 ), vget_high_s16( input_s16x8 ) );

208 
t_s64x2
 = 
	`vaddw_s32
–t_s64x2, 
	`vgë_low_s32
–
t_s32x4
 ) );

209 
t_s64x2
 = 
	`vaddw_s32
–t_s64x2, 
	`vgë_high_s32
–
t_s32x4
 ) );

210 
öputT
 += 8;

212 
t_s64x1
 = 
	`vadd_s64
–
	`vgë_low_s64
–
t_s64x2
 ), 
	`vgë_high_s64
(Å_s64x2 ) );

213 
c‹r_QC_‹dîT
 = 
	`vgë_œ√_s64
–
t_s64x1
, 0 );

214  ; 
n
 < 
Àngth
;Ç++ ) {

215 
c‹r_QC_‹dîT
 +
	`sûk_SMULL
–
öput
[ 
n
 ], input[Ç ] );

217 
c‹r_QC_‹dîT
 = 
	`sûk_LSHIFT64
–c‹r_QC_‹dîT, 
QC
 );

218 
c‹r_QC
[ 
‹dîT
 ] = 
c‹r_QC_‹dîT
;

221 
c‹r_QCT
 = 
c‹r_QC
 + 
‹dîT
 - 
‹dî
;

222 
lsh
 = 
	`sûk_CLZ64
–
c‹r_QC_‹dîT
 ) - 35;

223 
lsh
 = 
	`sûk_LIMIT
–lsh, -12 - 
QC
, 30 - QC );

224 *
sˇÀ
 = -–
QC
 + 
lsh
 );

225 
	`sûk_as£π
–*
sˇÀ
 >= -30 && *scale <= 12 );

226 
lsh_s64x2
 = 
	`vdupq_n_s64
–
lsh
 );

227  
i
 = 0; i <
‹dî
 - 3; i += 4 ) {

228 
öt32x4_t
 
c‹r_s32x4
;

229 
öt64x2_t
 
c‹r_QC0_s64x2
, 
c‹r_QC1_s64x2
;

230 
c‹r_QC0_s64x2
 = 
	`vld1q_s64
–
c‹r_QCT
 + 
i
 );

231 
c‹r_QC1_s64x2
 = 
	`vld1q_s64
–
c‹r_QCT
 + 
i
 + 2 );

232 
c‹r_QC0_s64x2
 = 
	`vshlq_s64
–c‹r_QC0_s64x2, 
lsh_s64x2
 );

233 
c‹r_QC1_s64x2
 = 
	`vshlq_s64
–c‹r_QC1_s64x2, 
lsh_s64x2
 );

234 
c‹r_s32x4
 = 
	`vcomböe_s32
–
	`vmovn_s64
–
c‹r_QC1_s64x2
 ), vmovn_s64–
c‹r_QC0_s64x2
 ) );

235 
c‹r_s32x4
 = 
	`vªv64q_s32
( corr_s32x4 );

236 
	`v°1q_s32
–
c‹r
 + 
‹dî
 - 
i
 - 3, 
c‹r_s32x4
 );

238 if–
lsh
 >= 0 ) {

239  ; 
i
 < 
‹dî
 + 1; i++ ) {

240 
c‹r
[ 
‹dî
 - 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`sûk_LSHIFT64
–
c‹r_QCT
[ i ], 
lsh
 ) );

243  ; 
i
 < 
‹dî
 + 1; i++ ) {

244 
c‹r
[ 
‹dî
 - 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`sûk_RSHIFT64
–
c‹r_QCT
[ i ], -
lsh
 ) );

247 
	`sûk_as£π
–
c‹r_QCT
[ 
‹dî
 ] >= 0 );

248 
RESTORE_STACK
;

251 #ifde‡
OPUS_CHECK_ASM


253 
›us_öt32
 
c‹r_c
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ];

254 
›us_öt
 
sˇÀ_c
;

255 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
–
c‹r_c
, &
sˇÀ_c
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
 );

256 
	`sûk_as£π
–!
	`memcmp
–
c‹r_c
, 
c‹r
, –c‹r_c[ 0 ] ) * ( 
‹dî
 + 1 ) ) );

257 
	`sûk_as£π
–
sˇÀ_c
 =*
sˇÀ
 );

260 
	}
}

	@silk/fixed/autocorr_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"˚…_Õc.h
"

36 
	$sûk_autoc‹r
(

37 
›us_öt32
 *
ªsu…s
,

38 
›us_öt
 *
sˇÀ
,

39 c⁄° 
›us_öt16
 *
öputD©a
,

40 c⁄° 
›us_öt
 
öputD©aSize
,

41 c⁄° 
›us_öt
 
c‹ªœti⁄Cou¡
,

42 
¨ch


45 
›us_öt
 
c‹rCou¡
;

46 
c‹rCou¡
 = 
	`sûk_mö_öt
–
öputD©aSize
, 
c‹ªœti⁄Cou¡
 );

47 *
sˇÀ
 = 
	`_˚…_autoc‹r
(
öputD©a
, 
ªsu…s
, 
NULL
, 0, 
c‹rCou¡
-1, 
öputD©aSize
, 
¨ch
);

48 
	}
}

	@silk/fixed/burg_modified_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"deföe.h
"

34 
	~"tunög_∑ømëîs.h
"

35 
	~"pôch.h
"

37 
	#MAX_FRAME_SIZE
 384

	)

39 
	#QA
 25

	)

40 
	#N_BITS_HEAD_ROOM
 3

	)

41 
	#MIN_RSHIFTS
 -16

	)

42 
	#MAX_RSHIFTS
 (32 - 
QA
)

	)

45 
	$sûk_burg_modifõd_c
(

46 
›us_öt32
 *
ªs_ƒg
,

47 
›us_öt
 *
ªs_ƒg_Q
,

48 
›us_öt32
 
A_Q16
[],

49 c⁄° 
›us_öt16
 
x
[],

50 c⁄° 
›us_öt32
 
möInvGaö_Q30
,

51 c⁄° 
›us_öt
 
sub‰_Àngth
,

52 c⁄° 
›us_öt
 
nb_sub‰
,

53 c⁄° 
›us_öt
 
D
,

54 
¨ch


57 
›us_öt
 
k
, 
n
, 
s
, 
lz
, 
rshi·s
, 
ªached_max_gaö
;

58 
›us_öt32
 
C0
, 
num
, 
ƒg
, 
rc_Q31
, 
övGaö_Q30
, 
Atmp_QA
, 
Atmp1
, 
tmp1
, 
tmp2
, 
x1
, 
x2
;

59 c⁄° 
›us_öt16
 *
x_±r
;

60 
›us_öt32
 
C_fú°_row
[ 
SILK_MAX_ORDER_LPC
 ];

61 
›us_öt32
 
C_œ°_row
[ 
SILK_MAX_ORDER_LPC
 ];

62 
›us_öt32
 
Af_QA
[ 
SILK_MAX_ORDER_LPC
 ];

63 
›us_öt32
 
CAf
[ 
SILK_MAX_ORDER_LPC
 + 1 ];

64 
›us_öt32
 
CAb
[ 
SILK_MAX_ORDER_LPC
 + 1 ];

65 
›us_öt32
 
xc‹r
[ 
SILK_MAX_ORDER_LPC
 ];

66 
›us_öt64
 
C0_64
;

68 
	`˚…_as£π
–
sub‰_Àngth
 * 
nb_sub‰
 <
MAX_FRAME_SIZE
 );

71 
C0_64
 = 
	`sûk_ö√r_¥od16_Æig√d_64
–
x
, x, 
sub‰_Àngth
*
nb_sub‰
, 
¨ch
 );

72 
lz
 = 
	`sûk_CLZ64
(
C0_64
);

73 
rshi·s
 = 32 + 1 + 
N_BITS_HEAD_ROOM
 - 
lz
;

74 i‡(
rshi·s
 > 
MAX_RSHIFTS
)Ñshifts = MAX_RSHIFTS;

75 i‡(
rshi·s
 < 
MIN_RSHIFTS
)Ñshifts = MIN_RSHIFTS;

77 i‡(
rshi·s
 > 0) {

78 
C0
 = (
›us_öt32
)
	`sûk_RSHIFT64
(
C0_64
, 
rshi·s
 );

80 
C0
 = 
	`sûk_LSHIFT32
((
›us_öt32
)
C0_64
, -
rshi·s
 );

83 
CAb
[ 0 ] = 
CAf
[ 0 ] = 
C0
 + 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), C0 ) + 1;

84 
	`sûk_mem£t
–
C_fú°_row
, 0, 
SILK_MAX_ORDER_LPC
 * –
›us_öt32
 ) );

85 if–
rshi·s
 > 0 ) {

86  
s
 = 0; s < 
nb_sub‰
; s++ ) {

87 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

88  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

89 
C_fú°_row
[ 
n
 - 1 ] +(
›us_öt32
)
	`sûk_RSHIFT64
(

90 
	`sûk_ö√r_¥od16_Æig√d_64
–
x_±r
, x_±∏+ 
n
, 
sub‰_Àngth
 -Ç, 
¨ch
 ), 
rshi·s
 );

94  
s
 = 0; s < 
nb_sub‰
; s++ ) {

95 
i
;

96 
›us_öt32
 
d
;

97 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

98 
	`˚…_pôch_xc‹r
(
x_±r
, x_±∏+ 1, 
xc‹r
, 
sub‰_Àngth
 - 
D
, D, 
¨ch
 );

99  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

100  
i
 = 
n
 + 
sub‰_Àngth
 - 
D
, 
d
 = 0; i < subfr_length; i++ )

101 
d
 = 
	`MAC16_16
–d, 
x_±r
[ 
i
 ], x_±r[ i - 
n
 ] );

102 
xc‹r
[ 
n
 - 1 ] +
d
;

104  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

105 
C_fú°_row
[ 
n
 - 1 ] +
	`sûk_LSHIFT32
–
xc‹r
[Ç - 1 ], -
rshi·s
 );

109 
	`sûk_mem˝y
–
C_œ°_row
, 
C_fú°_row
, 
SILK_MAX_ORDER_LPC
 * –
›us_öt32
 ) );

112 
CAb
[ 0 ] = 
CAf
[ 0 ] = 
C0
 + 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), C0 ) + 1;

114 
övGaö_Q30
 = (
›us_öt32
)1 << 30;

115 
ªached_max_gaö
 = 0;

116  
n
 = 0;Ç < 
D
;Ç++ ) {

121 if–
rshi·s
 > -2 ) {

122  
s
 = 0; s < 
nb_sub‰
; s++ ) {

123 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

124 
x1
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 16 - 
rshi·s
 );

125 
x2
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 16 - 
rshi·s
 );

126 
tmp1
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 
QA
 - 16 );

127 
tmp2
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 
QA
 - 16 );

128  
k
 = 0; k < 
n
; k++ ) {

129 
C_fú°_row
[ 
k
 ] = 
	`sûk_SMLAWB
–C_fú°_row[ k ], 
x1
, 
x_±r
[ 
n
 - k - 1 ] );

130 
C_œ°_row
[ 
k
 ] = 
	`sûk_SMLAWB
–C_œ°_row[ k ], 
x2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k ] );

131 
Atmp_QA
 = 
Af_QA
[ 
k
 ];

132 
tmp1
 = 
	`sûk_SMLAWB
–tmp1, 
Atmp_QA
, 
x_±r
[ 
n
 - 
k
 - 1 ] );

133 
tmp2
 = 
	`sûk_SMLAWB
–tmp2, 
Atmp_QA
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ] );

135 
tmp1
 = 
	`sûk_LSHIFT32
–-tmp1, 32 - 
QA
 - 
rshi·s
 );

136 
tmp2
 = 
	`sûk_LSHIFT32
–-tmp2, 32 - 
QA
 - 
rshi·s
 );

137  
k
 = 0; k <
n
; k++ ) {

138 
CAf
[ 
k
 ] = 
	`sûk_SMLAWB
–CAf[ k ], 
tmp1
, 
x_±r
[ 
n
 - k ] );

139 
CAb
[ 
k
 ] = 
	`sûk_SMLAWB
–CAb[ k ], 
tmp2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k - 1 ] );

143  
s
 = 0; s < 
nb_sub‰
; s++ ) {

144 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

145 
x1
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], -
rshi·s
 );

146 
x2
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], -
rshi·s
 );

147 
tmp1
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 17 );

148 
tmp2
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 17 );

149  
k
 = 0; k < 
n
; k++ ) {

150 
C_fú°_row
[ 
k
 ] = 
	`sûk_MLA
–C_fú°_row[ k ], 
x1
, 
x_±r
[ 
n
 - k - 1 ] );

151 
C_œ°_row
[ 
k
 ] = 
	`sûk_MLA
–C_œ°_row[ k ], 
x2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k ] );

152 
Atmp1
 = 
	`sûk_RSHIFT_ROUND
–
Af_QA
[ 
k
 ], 
QA
 - 17 );

156 
tmp1
 = 
	`sûk_MLA_ovÊw
–tmp1, 
x_±r
[ 
n
 - 
k
 - 1 ], 
Atmp1
 );

157 
tmp2
 = 
	`sûk_MLA_ovÊw
–tmp2, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ], 
Atmp1
 );

159 
tmp1
 = -tmp1;

160 
tmp2
 = -tmp2;

161  
k
 = 0; k <
n
; k++ ) {

162 
CAf
[ 
k
 ] = 
	`sûk_SMLAWW
–CAf[ k ], 
tmp1
,

163 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 - 
k
 ], -
rshi·s
 - 1 ) );

164 
CAb
[ 
k
 ] = 
	`sûk_SMLAWW
–CAb[ k ], 
tmp2
,

165 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 - 1 ], -
rshi·s
 - 1 ) );

171 
tmp1
 = 
C_fú°_row
[ 
n
 ];

172 
tmp2
 = 
C_œ°_row
[ 
n
 ];

173 
num
 = 0;

174 
ƒg
 = 
	`sûk_ADD32
–
CAb
[ 0 ], 
CAf
[ 0 ] );

175  
k
 = 0; k < 
n
; k++ ) {

176 
Atmp_QA
 = 
Af_QA
[ 
k
 ];

177 
lz
 = 
	`sûk_CLZ32
–
	`sûk_abs
–
Atmp_QA
 ) ) - 1;

178 
lz
 = 
	`sûk_mö
–32 - 
QA
,Üz );

179 
Atmp1
 = 
	`sûk_LSHIFT32
–
Atmp_QA
, 
lz
 );

181 
tmp1
 = 
	`sûk_ADD_LSHIFT32
–tmp1, 
	`sûk_SMMUL
–
C_œ°_row
[ 
n
 - 
k
 - 1 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

182 
tmp2
 = 
	`sûk_ADD_LSHIFT32
–tmp2, 
	`sûk_SMMUL
–
C_fú°_row
[ 
n
 - 
k
 - 1 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

183 
num
 = 
	`sûk_ADD_LSHIFT32
–num, 
	`sûk_SMMUL
–
CAb
[ 
n
 - 
k
 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

184 
ƒg
 = 
	`sûk_ADD_LSHIFT32
–ƒg, 
	`sûk_SMMUL
–
	`sûk_ADD32
–
CAb
[ 
k
 + 1 ], 
CAf
[ k + 1 ] ),

185 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

187 
CAf
[ 
n
 + 1 ] = 
tmp1
;

188 
CAb
[ 
n
 + 1 ] = 
tmp2
;

189 
num
 = 
	`sûk_ADD32
–num, 
tmp2
 );

190 
num
 = 
	`sûk_LSHIFT32
( -num, 1 );

193 if–
	`sûk_abs
–
num
 ) < 
ƒg
 ) {

194 
rc_Q31
 = 
	`sûk_DIV32_v¨Q
–
num
, 
ƒg
, 31 );

196 
rc_Q31
 = ( 
num
 > 0 ) ? 
sûk_öt32_MAX
 : 
sûk_öt32_MIN
;

200 
tmp1
 = ( (
›us_öt32
)1 << 30 ) - 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 );

201 
tmp1
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–
övGaö_Q30
,Åmp1 ), 2 );

202 if–
tmp1
 <
möInvGaö_Q30
 ) {

204 
tmp2
 = ( (
›us_öt32
)1 << 30 ) - 
	`sûk_DIV32_v¨Q
–
möInvGaö_Q30
, 
övGaö_Q30
, 30 );

205 
rc_Q31
 = 
	`sûk_SQRT_APPROX
–
tmp2
 );

206 if–
rc_Q31
 > 0 ) {

208 
rc_Q31
 = 
	`sûk_RSHIFT32
–rc_Q31 + 
	`sûk_DIV32
–
tmp2
,Ñc_Q31 ), 1 );

209 
rc_Q31
 = 
	`sûk_LSHIFT32
(Ñc_Q31, 16 );

210 if–
num
 < 0 ) {

212 
rc_Q31
 = -rc_Q31;

215 
övGaö_Q30
 = 
möInvGaö_Q30
;

216 
ªached_max_gaö
 = 1;

218 
övGaö_Q30
 = 
tmp1
;

222  
k
 = 0; k < (
n
 + 1) >> 1; k++ ) {

223 
tmp1
 = 
Af_QA
[ 
k
 ];

224 
tmp2
 = 
Af_QA
[ 
n
 - 
k
 - 1 ];

225 
Af_QA
[ 
k
 ] = 
	`sûk_ADD_LSHIFT32
–
tmp1
, 
	`sûk_SMMUL
–
tmp2
, 
rc_Q31
 ), 1 );

226 
Af_QA
[ 
n
 - 
k
 - 1 ] = 
	`sûk_ADD_LSHIFT32
–
tmp2
, 
	`sûk_SMMUL
–
tmp1
, 
rc_Q31
 ), 1 );

228 
Af_QA
[ 
n
 ] = 
	`sûk_RSHIFT32
–
rc_Q31
, 31 - 
QA
 );

230 if–
ªached_max_gaö
 ) {

232  
k
 = 
n
 + 1; k < 
D
; k++ ) {

233 
Af_QA
[ 
k
 ] = 0;

239  
k
 = 0; k <
n
 + 1; k++ ) {

240 
tmp1
 = 
CAf
[ 
k
 ];

241 
tmp2
 = 
CAb
[ 
n
 - 
k
 + 1 ];

242 
CAf
[ 
k
 ] = 
	`sûk_ADD_LSHIFT32
–
tmp1
, 
	`sûk_SMMUL
–
tmp2
, 
rc_Q31
 ), 1 );

243 
CAb
[ 
n
 - 
k
 + 1 ] = 
	`sûk_ADD_LSHIFT32
–
tmp2
, 
	`sûk_SMMUL
–
tmp1
, 
rc_Q31
 ), 1 );

247 if–
ªached_max_gaö
 ) {

248  
k
 = 0; k < 
D
; k++ ) {

250 
A_Q16
[ 
k
 ] = -
	`sûk_RSHIFT_ROUND
–
Af_QA
[ k ], 
QA
 - 16 );

253 if–
rshi·s
 > 0 ) {

254  
s
 = 0; s < 
nb_sub‰
; s++ ) {

255 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

256 
C0
 -(
›us_öt32
)
	`sûk_RSHIFT64
–
	`sûk_ö√r_¥od16_Æig√d_64
–
x_±r
, x_±r, 
D
, 
¨ch
 ), 
rshi·s
 );

259  
s
 = 0; s < 
nb_sub‰
; s++ ) {

260 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

261 
C0
 -
	`sûk_LSHIFT32
–
	`sûk_ö√r_¥od_Æig√d
–
x_±r
, x_±r, 
D
, 
¨ch
), -
rshi·s
);

265 *
ªs_ƒg
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–
övGaö_Q30
, 
C0
 ), 2 );

266 *
ªs_ƒg_Q
 = -
rshi·s
;

269 
ƒg
 = 
CAf
[ 0 ];

270 
tmp1
 = (
›us_öt32
)1 << 16;

271  
k
 = 0; k < 
D
; k++ ) {

272 
Atmp1
 = 
	`sûk_RSHIFT_ROUND
–
Af_QA
[ 
k
 ], 
QA
 - 16 );

273 
ƒg
 = 
	`sûk_SMLAWW
–ƒg, 
CAf
[ 
k
 + 1 ], 
Atmp1
 );

274 
tmp1
 = 
	`sûk_SMLAWW
–tmp1, 
Atmp1
, Atmp1 );

275 
A_Q16
[ 
k
 ] = -
Atmp1
;

277 *
ªs_ƒg
 = 
	`sûk_SMLAWW
–
ƒg
, 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), 
C0
 ), -
tmp1
 );

278 *
ªs_ƒg_Q
 = -
rshi·s
;

280 
	}
}

	@silk/fixed/corrMatrix_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

36 
	~"maö_FIX.h
"

39 
	$sûk_c‹rVe˘‹_FIX
(

40 c⁄° 
›us_öt16
 *
x
,

41 c⁄° 
›us_öt16
 *
t
,

42 c⁄° 
›us_öt
 
L
,

43 c⁄° 
›us_öt
 
‹dî
,

44 
›us_öt32
 *
Xt
,

45 c⁄° 
›us_öt
 
rshi·s
,

46 
¨ch


49 
›us_öt
 
œg
, 
i
;

50 c⁄° 
›us_öt16
 *
±r1
, *
±r2
;

51 
›us_öt32
 
ö√r_¥od
;

53 
±r1
 = &
x
[ 
‹dî
 - 1 ];

54 
±r2
 = 
t
;

56 if–
rshi·s
 > 0 ) {

58  
œg
 = 0;Üag < 
‹dî
;Üag++ ) {

59 
ö√r_¥od
 = 0;

60  
i
 = 0; i < 
L
; i++ ) {

61 
ö√r_¥od
 = 
	`sûk_ADD_RSHIFT32
–ö√r_¥od, 
	`sûk_SMULBB
–
±r1
[ 
i
 ], 
±r2
[i] ), 
rshi·s
 );

63 
Xt
[ 
œg
 ] = 
ö√r_¥od
;

64 
±r1
--;

67 
	`sûk_as£π
–
rshi·s
 == 0 );

68  
œg
 = 0;Üag < 
‹dî
;Üag++ ) {

69 
Xt
[ 
œg
 ] = 
	`sûk_ö√r_¥od_Æig√d
–
±r1
, 
±r2
, 
L
, 
¨ch
 );

70 
±r1
--;

73 
	}
}

76 
	$sûk_c‹rM©rix_FIX
(

77 c⁄° 
›us_öt16
 *
x
,

78 c⁄° 
›us_öt
 
L
,

79 c⁄° 
›us_öt
 
‹dî
,

80 
›us_öt32
 *
XX
,

81 
›us_öt32
 *
ƒg
,

82 
›us_öt
 *
rshi·s
,

83 
¨ch


86 
›us_öt
 
i
, 
j
, 
œg
;

87 
›us_öt32
 
íîgy
;

88 c⁄° 
›us_öt16
 *
±r1
, *
±r2
;

91 
	`sûk_sum_sqr_shi·
–
ƒg
, 
rshi·s
, 
x
, 
L
 + 
‹dî
 - 1 );

92 
íîgy
 = *
ƒg
;

96  
i
 = 0; i < 
‹dî
 - 1; i++ ) {

97 
íîgy
 -
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
x
[ 
i
 ], x[ i ] ), *
rshi·s
 );

102 
	`m©rix_±r
–
XX
, 0, 0, 
‹dî
 ) = 
íîgy
;

103 
	`sûk_as£π
–
íîgy
 >= 0 );

104 
±r1
 = &
x
[ 
‹dî
 - 1 ];

105  
j
 = 1; j < 
‹dî
; j++ ) {

106 
íîgy
 = 
	`sûk_SUB32
–íîgy, 
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
±r1
[ 
L
 - 
j
 ],Öå1[ L - j ] ), *
rshi·s
 ) );

107 
íîgy
 = 
	`sûk_ADD32
–íîgy, 
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
±r1
[ -
j
 ],Öå1[ -j ] ), *
rshi·s
 ) );

108 
	`m©rix_±r
–
XX
, 
j
, j, 
‹dî
 ) = 
íîgy
;

109 
	`sûk_as£π
–
íîgy
 >= 0 );

112 
±r2
 = &
x
[ 
‹dî
 - 2 ];

114 if–*
rshi·s
 > 0 ) {

116  
œg
 = 1;Üag < 
‹dî
;Üag++ ) {

118 
íîgy
 = 0;

119  
i
 = 0; i < 
L
; i++ ) {

120 
íîgy
 +
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
±r1
[ 
i
 ], 
±r2
[i] ), *
rshi·s
 );

123 
	`m©rix_±r
–
XX
, 
œg
, 0, 
‹dî
 ) = 
íîgy
;

124 
	`m©rix_±r
–
XX
, 0, 
œg
, 
‹dî
 ) = 
íîgy
;

125  
j
 = 1; j < ( 
‹dî
 - 
œg
 ); j++ ) {

126 
íîgy
 = 
	`sûk_SUB32
–íîgy, 
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
±r1
[ 
L
 - 
j
 ], 
±r2
[ L - j ] ), *
rshi·s
 ) );

127 
íîgy
 = 
	`sûk_ADD32
–íîgy, 
	`sûk_RSHIFT32
–
	`sûk_SMULBB
–
±r1
[ -
j
 ], 
±r2
[ -j ] ), *
rshi·s
 ) );

128 
	`m©rix_±r
–
XX
, 
œg
 + 
j
, j, 
‹dî
 ) = 
íîgy
;

129 
	`m©rix_±r
–
XX
, 
j
, 
œg
 + j, 
‹dî
 ) = 
íîgy
;

131 
±r2
--;

134  
œg
 = 1;Üag < 
‹dî
;Üag++ ) {

136 
íîgy
 = 
	`sûk_ö√r_¥od_Æig√d
–
±r1
, 
±r2
, 
L
, 
¨ch
 );

137 
	`m©rix_±r
–
XX
, 
œg
, 0, 
‹dî
 ) = 
íîgy
;

138 
	`m©rix_±r
–
XX
, 0, 
œg
, 
‹dî
 ) = 
íîgy
;

140  
j
 = 1; j < ( 
‹dî
 - 
œg
 ); j++ ) {

141 
íîgy
 = 
	`sûk_SUB32
–íîgy, 
	`sûk_SMULBB
–
±r1
[ 
L
 - 
j
 ], 
±r2
[ L - j ] ) );

142 
íîgy
 = 
	`sûk_SMLABB
–íîgy, 
±r1
[ -
j
 ], 
±r2
[ -j ] );

143 
	`m©rix_±r
–
XX
, 
œg
 + 
j
, j, 
‹dî
 ) = 
íîgy
;

144 
	`m©rix_±r
–
XX
, 
j
, 
œg
 + j, 
‹dî
 ) = 
íîgy
;

146 
±r2
--;

149 
	}
}

	@silk/fixed/encode_frame_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dlib.h
>

33 
	~"maö_FIX.h
"

34 
	~"°ack_Æloc.h
"

35 
	~"tunög_∑ømëîs.h
"

38 
OPUS_INLINE
 
sûk_LBRR_ícode_FIX
(

39 
sûk_ícodî_°©e_FIX
 *
psEnc
,

40 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

41 c⁄° 
›us_öt16
 
x16
[],

42 
›us_öt
 
c⁄dCodög


45 
	$sûk_ícode_do_VAD_FIX
(

46 
sûk_ícodî_°©e_FIX
 *
psEnc
,

47 
›us_öt
 
a˘ivôy


50 c⁄° 
›us_öt
 
a˘ivôy_thªshﬁd
 = 
	`SILK_FIX_CONST
–
SPEECH_ACTIVITY_DTX_THRES
, 8 );

55 
	`sûk_VAD_GëSA_Q8
–&
psEnc
->
sCmn
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
¨ch
 );

57 if–
a˘ivôy
 =
VAD_NO_ACTIVITY
 && 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 >
a˘ivôy_thªshﬁd
 ) {

58 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 = 
a˘ivôy_thªshﬁd
 - 1;

64 if–
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 < 
a˘ivôy_thªshﬁd
 ) {

65 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

66 
psEnc
->
sCmn
.
noS≥echCou¡î
++;

67 if–
psEnc
->
sCmn
.
noS≥echCou¡î
 <
NB_SPEECH_FRAMES_BEFORE_DTX
 ) {

68 
psEnc
->
sCmn
.
öDTX
 = 0;

69 } if–
psEnc
->
sCmn
.
noS≥echCou¡î
 > 
MAX_CONSECUTIVE_DTX
 + 
NB_SPEECH_FRAMES_BEFORE_DTX
 ) {

70 
psEnc
->
sCmn
.
noS≥echCou¡î
 = 
NB_SPEECH_FRAMES_BEFORE_DTX
;

71 
psEnc
->
sCmn
.
öDTX
 = 0;

73 
psEnc
->
sCmn
.
VAD_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 0;

75 
psEnc
->
sCmn
.
noS≥echCou¡î
 = 0;

76 
psEnc
->
sCmn
.
öDTX
 = 0;

77 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_UNVOICED
;

78 
psEnc
->
sCmn
.
VAD_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 1;

80 
	}
}

85 
›us_öt
 
	$sûk_ícode_‰ame_FIX
(

86 
sûk_ícodî_°©e_FIX
 *
psEnc
,

87 
›us_öt32
 *
≤ByãsOut
,

88 
ec_íc
 *
psR™geEnc
,

89 
›us_öt
 
c⁄dCodög
,

90 
›us_öt
 
maxBôs
,

91 
›us_öt
 
u£CBR


94 
sûk_ícodî_c⁄åﬁ_FIX
 
sEncCål
;

95 
›us_öt
 
i
, 
ôî
, 
maxIãr
, 
found_uµî
, 
found_lowî
, 
ªt
 = 0;

96 
›us_öt16
 *
x_‰ame
;

97 
ec_íc
 
sR™geEnc_c›y
, 
sR™geEnc_c›y2
;

98 
sûk_nsq_°©e
 
sNSQ_c›y
, 
sNSQ_c›y2
;

99 
›us_öt32
 
£ed_c›y
, 
nBôs
, 
nBôs_lowî
, 
nBôs_uµî
, 
gaöMu…_lowî
, 
gaöMu…_uµî
;

100 
›us_öt32
 
gaösID
, 
gaösID_lowî
, 
gaösID_uµî
;

101 
›us_öt16
 
gaöMu…_Q8
;

102 
›us_öt16
 
ec_¥evLagIndex_c›y
;

103 
›us_öt
 
ec_¥evSig«lTy≥_c›y
;

104 
›us_öt8
 
La°GaöIndex_c›y2
;

105 
›us_öt
 
gaö_lock
[ 
MAX_NB_SUBFR
 ] = {0};

106 
›us_öt16
 
be°_gaö_mu…
[ 
MAX_NB_SUBFR
 ];

107 
›us_öt
 
be°_sum
[ 
MAX_NB_SUBFR
 ];

108 
SAVE_STACK
;

111 
La°GaöIndex_c›y2
 = 
nBôs_lowî
 = 
nBôs_uµî
 = 
gaöMu…_lowî
 = 
gaöMu…_uµî
 = 0;

113 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
 =ÖsEnc->sCmn.
‰ameCou¡î
++ & 3;

119 
x_‰ame
 = 
psEnc
->
x_buf
 +ÖsEnc->
sCmn
.
…p_mem_Àngth
;

124 
	`sûk_LP_v¨übÀ_cutoff
–&
psEnc
->
sCmn
.
sLP
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
‰ame_Àngth
 );

129 
	`sûk_mem˝y
–
x_‰ame
 + 
LA_SHAPE_MS
 * 
psEnc
->
sCmn
.
fs_kHz
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
‰ame_Àngth
 * –
›us_öt16
 ) );

131 if–!
psEnc
->
sCmn
.
¥efûlFœg
 ) {

132 
	`VARDECL
–
›us_öt16
, 
ªs_pôch
 );

133 
	`VARDECL
–
›us_uöt8
, 
ec_buf_c›y
 );

134 
›us_öt16
 *
ªs_pôch_‰ame
;

136 
	`ALLOC
–
ªs_pôch
,

137 
psEnc
->
sCmn
.
œ_pôch
 +ÖsEnc->sCmn.
‰ame_Àngth


138 + 
psEnc
->
sCmn
.
…p_mem_Àngth
, 
›us_öt16
 );

140 
ªs_pôch_‰ame
 = 
ªs_pôch
 + 
psEnc
->
sCmn
.
…p_mem_Àngth
;

145 
	`sûk_föd_pôch_œgs_FIX
–
psEnc
, &
sEncCål
, 
ªs_pôch
, 
x_‰ame
 -ÖsEnc->
sCmn
.
…p_mem_Àngth
,ÖsEnc->sCmn.
¨ch
 );

150 
	`sûk_noi£_sh≠e_™Æysis_FIX
–
psEnc
, &
sEncCål
, 
ªs_pôch_‰ame
, 
x_‰ame
,ÖsEnc->
sCmn
.
¨ch
 );

155 
	`sûk_föd_¥ed_c€fs_FIX
–
psEnc
, &
sEncCål
, 
ªs_pôch_‰ame
, 
x_‰ame
, 
c⁄dCodög
 );

160 
	`sûk_¥o˚ss_gaös_FIX
–
psEnc
, &
sEncCål
, 
c⁄dCodög
 );

165 
	`sûk_LBRR_ícode_FIX
–
psEnc
, &
sEncCål
, 
x_‰ame
, 
c⁄dCodög
 );

168 
maxIãr
 = 6;

169 
gaöMu…_Q8
 = 
	`SILK_FIX_CONST
( 1, 8 );

170 
found_lowî
 = 0;

171 
found_uµî
 = 0;

172 
gaösID
 = 
	`sûk_gaös_ID
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
,ÖsEnc->sCmn.
nb_sub‰
 );

173 
gaösID_lowî
 = -1;

174 
gaösID_uµî
 = -1;

176 
	`sûk_mem˝y
–&
sR™geEnc_c›y
, 
psR™geEnc
, –
ec_íc
 ) );

177 
	`sûk_mem˝y
–&
sNSQ_c›y
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

178 
£ed_c›y
 = 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
;

179 
ec_¥evLagIndex_c›y
 = 
psEnc
->
sCmn
.
ec_¥evLagIndex
;

180 
ec_¥evSig«lTy≥_c›y
 = 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
;

181 
	`ALLOC
–
ec_buf_c›y
, 1275, 
›us_uöt8
 );

182  
ôî
 = 0; ; iter++ ) {

183 if–
gaösID
 =
gaösID_lowî
 ) {

184 
nBôs
 = 
nBôs_lowî
;

185 } if–
gaösID
 =
gaösID_uµî
 ) {

186 
nBôs
 = 
nBôs_uµî
;

189 if–
ôî
 > 0 ) {

190 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y
, –
ec_íc
 ) );

191 
	`sûk_mem˝y
–&
psEnc
->
sCmn
.
sNSQ
, &
sNSQ_c›y
, –
sûk_nsq_°©e
 ) );

192 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
 = 
£ed_c›y
;

193 
psEnc
->
sCmn
.
ec_¥evLagIndex
 = 
ec_¥evLagIndex_c›y
;

194 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
 = 
ec_¥evSig«lTy≥_c›y
;

200 if–
psEnc
->
sCmn
.
nSèãsDñayedDecisi⁄
 > 1 ||ÖsEnc->sCmn.
w¨pög_Q16
 > 0 ) {

201 
	`sûk_NSQ_dñ_dec
–&
psEnc
->
sCmn
, &psEnc->sCmn.
sNSQ
, &psEnc->sCmn.
ödi˚s
, 
x_‰ame
,ÖsEnc->sCmn.
pul£s
,

202 
sEncCål
.
PªdC€f_Q12
[ 0 ], sEncCål.
LTPC€f_Q14
, sEncCål.
AR_Q13
, sEncCål.
H¨mSh≠eGaö_Q14
,

203 
sEncCål
.
Tût_Q14
, sEncCål.
LF_shp_Q14
, sEncCål.
Gaös_Q16
, sEncCål.
pôchL
, sEncCål.
Lambda_Q10
, sEncCål.
LTP_sˇÀ_Q14
,

204 
psEnc
->
sCmn
.
¨ch
 );

206 
	`sûk_NSQ
–&
psEnc
->
sCmn
, &psEnc->sCmn.
sNSQ
, &psEnc->sCmn.
ödi˚s
, 
x_‰ame
,ÖsEnc->sCmn.
pul£s
,

207 
sEncCål
.
PªdC€f_Q12
[ 0 ], sEncCål.
LTPC€f_Q14
, sEncCål.
AR_Q13
, sEncCål.
H¨mSh≠eGaö_Q14
,

208 
sEncCål
.
Tût_Q14
, sEncCål.
LF_shp_Q14
, sEncCål.
Gaös_Q16
, sEncCål.
pôchL
, sEncCål.
Lambda_Q10
, sEncCål.
LTP_sˇÀ_Q14
,

209 
psEnc
->
sCmn
.
¨ch
);

212 i‡–
ôî
 =
maxIãr
 && !
found_lowî
 ) {

213 
	`sûk_mem˝y
–&
sR™geEnc_c›y2
, 
psR™geEnc
, –
ec_íc
 ) );

219 
	`sûk_ícode_ödi˚s
–&
psEnc
->
sCmn
, 
psR™geEnc
,ÖsEnc->sCmn.
nFømesEncoded
, 0, 
c⁄dCodög
 );

224 
	`sûk_ícode_pul£s
–
psR™geEnc
, 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
,ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
,

225 
psEnc
->
sCmn
.
pul£s
,ÖsEnc->sCmn.
‰ame_Àngth
 );

227 
nBôs
 = 
	`ec_ãŒ
–
psR™geEnc
 );

230 i‡–
ôî
 =
maxIãr
 && !
found_lowî
 && 
nBôs
 > 
maxBôs
 ) {

231 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y2
, –
ec_íc
 ) );

234 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
sEncCål
.
œ°GaöIndexPªv
;

235  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

236 
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
[ 
i
 ] = 4;

238 i‡(
c⁄dCodög
 !
CODE_CONDITIONALLY
) {

239 
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
[ 0 ] = 
sEncCål
.
œ°GaöIndexPªv
;

241 
psEnc
->
sCmn
.
ec_¥evLagIndex
 = 
ec_¥evLagIndex_c›y
;

242 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
 = 
ec_¥evSig«lTy≥_c›y
;

244  
i
 = 0; i < 
psEnc
->
sCmn
.
‰ame_Àngth
; i++ ) {

245 
psEnc
->
sCmn
.
pul£s
[ 
i
 ] = 0;

248 
	`sûk_ícode_ödi˚s
–&
psEnc
->
sCmn
, 
psR™geEnc
,ÖsEnc->sCmn.
nFømesEncoded
, 0, 
c⁄dCodög
 );

250 
	`sûk_ícode_pul£s
–
psR™geEnc
, 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
,ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
,

251 
psEnc
->
sCmn
.
pul£s
,ÖsEnc->sCmn.
‰ame_Àngth
 );

253 
nBôs
 = 
	`ec_ãŒ
–
psR™geEnc
 );

256 if–
u£CBR
 =0 && 
ôî
 =0 && 
nBôs
 <
maxBôs
 ) {

261 if–
ôî
 =
maxIãr
 ) {

262 if–
found_lowî
 && ( 
gaösID
 =
gaösID_lowî
 || 
nBôs
 > 
maxBôs
 ) ) {

264 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y2
, –
ec_íc
 ) );

265 
	`˚…_as£π
–
sR™geEnc_c›y2
.
offs
 <= 1275 );

266 
	`sûk_mem˝y
–
psR™geEnc
->
buf
, 
ec_buf_c›y
, 
sR™geEnc_c›y2
.
offs
 );

267 
	`sûk_mem˝y
–&
psEnc
->
sCmn
.
sNSQ
, &
sNSQ_c›y2
, –
sûk_nsq_°©e
 ) );

268 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
La°GaöIndex_c›y2
;

273 if–
nBôs
 > 
maxBôs
 ) {

274 if–
found_lowî
 =0 && 
ôî
 >= 2 ) {

276 
sEncCål
.
Lambda_Q10
 = 
	`sûk_ADD_RSHIFT32
( sEncCtrl.Lambda_Q10, sEncCtrl.Lambda_Q10, 1 );

277 
found_uµî
 = 0;

278 
gaösID_uµî
 = -1;

280 
found_uµî
 = 1;

281 
nBôs_uµî
 = 
nBôs
;

282 
gaöMu…_uµî
 = 
gaöMu…_Q8
;

283 
gaösID_uµî
 = 
gaösID
;

285 } if–
nBôs
 < 
maxBôs
 - 5 ) {

286 
found_lowî
 = 1;

287 
nBôs_lowî
 = 
nBôs
;

288 
gaöMu…_lowî
 = 
gaöMu…_Q8
;

289 if–
gaösID
 !
gaösID_lowî
 ) {

290 
gaösID_lowî
 = 
gaösID
;

292 
	`sûk_mem˝y
–&
sR™geEnc_c›y2
, 
psR™geEnc
, –
ec_íc
 ) );

293 
	`˚…_as£π
–
psR™geEnc
->
offs
 <= 1275 );

294 
	`sûk_mem˝y
–
ec_buf_c›y
, 
psR™geEnc
->
buf
,ÖsR™geEnc->
offs
 );

295 
	`sûk_mem˝y
–&
sNSQ_c›y2
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

296 
La°GaöIndex_c›y2
 = 
psEnc
->
sSh≠e
.
La°GaöIndex
;

303 i‡–!
found_lowî
 && 
nBôs
 > 
maxBôs
 ) {

304 
j
;

305  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

306 
sum
=0;

307  
j
 = 
i
*
psEnc
->
sCmn
.
sub‰_Àngth
; j < (i+1)*psEnc->sCmn.subfr_length; j++ ) {

308 
sum
 +
	`abs
–
psEnc
->
sCmn
.
pul£s
[
j
] );

310 i‡–
ôî
 =0 || (
sum
 < 
be°_sum
[
i
] && !
gaö_lock
[i]) ) {

311 
be°_sum
[
i
] = 
sum
;

312 
be°_gaö_mu…
[
i
] = 
gaöMu…_Q8
;

314 
gaö_lock
[
i
] = 1;

318 if––
found_lowî
 & 
found_uµî
 ) == 0 ) {

320 if–
nBôs
 > 
maxBôs
 ) {

321 i‡(
gaöMu…_Q8
 < 16384) {

322 
gaöMu…_Q8
 *= 2;

324 
gaöMu…_Q8
 = 32767;

327 
›us_öt32
 
gaö_Á˘‹_Q16
;

328 
gaö_Á˘‹_Q16
 = 
	`sûk_log2lö
–
	`sûk_LSHIFT
–
nBôs
 - 
maxBôs
, 7 ) / 
psEnc
->
sCmn
.
‰ame_Àngth
 + 
	`SILK_FIX_CONST
( 16, 7 ) );

329 
gaöMu…_Q8
 = 
	`sûk_SMULWB
–
gaö_Á˘‹_Q16
, gainMult_Q8 );

334 
gaöMu…_Q8
 = 
gaöMu…_lowî
 + 
	`sûk_DIV32_16
–
	`sûk_MUL
–
gaöMu…_uµî
 - gaöMu…_lowî, 
maxBôs
 - 
nBôs_lowî
 ), 
nBôs_uµî
 -ÇBits_lower );

336 if–
gaöMu…_Q8
 > 
	`sûk_ADD_RSHIFT32
–
gaöMu…_lowî
, 
gaöMu…_uµî
 - gainMult_lower, 2 ) ) {

337 
gaöMu…_Q8
 = 
	`sûk_ADD_RSHIFT32
–
gaöMu…_lowî
, 
gaöMu…_uµî
 - gainMult_lower, 2 );

339 if–
gaöMu…_Q8
 < 
	`sûk_SUB_RSHIFT32
–
gaöMu…_uµî
, gaöMu…_uµî - 
gaöMu…_lowî
, 2 ) ) {

340 
gaöMu…_Q8
 = 
	`sûk_SUB_RSHIFT32
–
gaöMu…_uµî
, gaöMu…_uµî - 
gaöMu…_lowî
, 2 );

344  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

345 
›us_öt16
 
tmp
;

346 i‡–
gaö_lock
[
i
] ) {

347 
tmp
 = 
be°_gaö_mu…
[
i
];

349 
tmp
 = 
gaöMu…_Q8
;

351 
sEncCål
.
Gaös_Q16
[ 
i
 ] = 
	`sûk_LSHIFT_SAT32
–
	`sûk_SMULWB
–sEncCål.
GaösUnq_Q16
[ i ], 
tmp
 ), 8 );

355 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
sEncCål
.
œ°GaöIndexPªv
;

356 
	`sûk_gaös_qu™t
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
, 
sEncCål
.
Gaös_Q16
,

357 &
psEnc
->
sSh≠e
.
La°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
,ÖsEnc->
sCmn
.
nb_sub‰
 );

360 
gaösID
 = 
	`sûk_gaös_ID
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
,ÖsEnc->sCmn.
nb_sub‰
 );

365 
	`sûk_memmove
–
psEnc
->
x_buf
, &psEnc->x_buf[ÖsEnc->
sCmn
.
‰ame_Àngth
 ],

366 –
psEnc
->
sCmn
.
…p_mem_Àngth
 + 
LA_SHAPE_MS
 *ÖsEnc->sCmn.
fs_kHz
 ) * –
›us_öt16
 ) );

369 if–
psEnc
->
sCmn
.
¥efûlFœg
 ) {

371 *
≤ByãsOut
 = 0;

372 
RESTORE_STACK
;

373  
ªt
;

377 
psEnc
->
sCmn
.
¥evLag
 = 
sEncCål
.
pôchL
[ÖsEnc->sCmn.
nb_sub‰
 - 1 ];

378 
psEnc
->
sCmn
.
¥evSig«lTy≥
 =ÖsEnc->sCmn.
ödi˚s
.
sig«lTy≥
;

383 
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 = 0;

385 *
≤ByãsOut
 = 
	`sûk_RSHIFT
–
	`ec_ãŒ
–
psR™geEnc
 ) + 7, 3 );

387 
RESTORE_STACK
;

388  
ªt
;

389 
	}
}

392 
OPUS_INLINE
 
	$sûk_LBRR_ícode_FIX
(

393 
sûk_ícodî_°©e_FIX
 *
psEnc
,

394 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

395 c⁄° 
›us_öt16
 
x16
[],

396 
›us_öt
 
c⁄dCodög


399 
›us_öt32
 
TempGaös_Q16
[ 
MAX_NB_SUBFR
 ];

400 
SideInfoIndi˚s
 *
psIndi˚s_LBRR
 = &
psEnc
->
sCmn
.
ödi˚s_LBRR
[ÖsEnc->sCmn.
nFømesEncoded
 ];

401 
sûk_nsq_°©e
 
sNSQ_LBRR
;

406 if–
psEnc
->
sCmn
.
LBRR_íabÀd
 &&ÖsEnc->sCmn.
•ìch_a˘ivôy_Q8
 > 
	`SILK_FIX_CONST
–
LBRR_SPEECH_ACTIVITY_THRES
, 8 ) ) {

407 
psEnc
->
sCmn
.
LBRR_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 1;

410 
	`sûk_mem˝y
–&
sNSQ_LBRR
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

411 
	`sûk_mem˝y
–
psIndi˚s_LBRR
, &
psEnc
->
sCmn
.
ödi˚s
, –
SideInfoIndi˚s
 ) );

414 
	`sûk_mem˝y
–
TempGaös_Q16
, 
psEncCål
->
Gaös_Q16
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
›us_öt32
 ) );

416 if–
psEnc
->
sCmn
.
nFømesEncoded
 =0 ||ÖsEnc->sCmn.
LBRR_Êags
[ÖsEnc->sCmn.nFramesEncoded - 1 ] == 0 ) {

418 
psEnc
->
sCmn
.
LBRR¥evLa°GaöIndex
 =ÖsEnc->
sSh≠e
.
La°GaöIndex
;

421 
psIndi˚s_LBRR
->
GaösIndi˚s
[ 0 ] =ÖsIndi˚s_LBRR->GaösIndi˚s[ 0 ] + 
psEnc
->
sCmn
.
LBRR_GaöIn¸ó£s
;

422 
psIndi˚s_LBRR
->
GaösIndi˚s
[ 0 ] = 
	`sûk_mö_öt
–psIndi˚s_LBRR->GaösIndi˚s[ 0 ], 
N_LEVELS_QGAIN
 - 1 );

427 
	`sûk_gaös_dequ™t
–
psEncCål
->
Gaös_Q16
, 
psIndi˚s_LBRR
->
GaösIndi˚s
,

428 &
psEnc
->
sCmn
.
LBRR¥evLa°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
,ÖsEnc->sCmn.
nb_sub‰
 );

433 if–
psEnc
->
sCmn
.
nSèãsDñayedDecisi⁄
 > 1 ||ÖsEnc->sCmn.
w¨pög_Q16
 > 0 ) {

434 
	`sûk_NSQ_dñ_dec
–&
psEnc
->
sCmn
, &
sNSQ_LBRR
, 
psIndi˚s_LBRR
, 
x16
,

435 
psEnc
->
sCmn
.
pul£s_LBRR
[ÖsEnc->sCmn.
nFømesEncoded
 ], 
psEncCål
->
PªdC€f_Q12
[ 0 ],ÖsEncCål->
LTPC€f_Q14
,

436 
psEncCål
->
AR_Q13
,ÖsEncCål->
H¨mSh≠eGaö_Q14
,ÖsEncCål->
Tût_Q14
,ÖsEncCål->
LF_shp_Q14
,

437 
psEncCål
->
Gaös_Q16
,ÖsEncCål->
pôchL
,ÖsEncCål->
Lambda_Q10
,ÖsEncCål->
LTP_sˇÀ_Q14
, 
psEnc
->
sCmn
.
¨ch
 );

439 
	`sûk_NSQ
–&
psEnc
->
sCmn
, &
sNSQ_LBRR
, 
psIndi˚s_LBRR
, 
x16
,

440 
psEnc
->
sCmn
.
pul£s_LBRR
[ÖsEnc->sCmn.
nFømesEncoded
 ], 
psEncCål
->
PªdC€f_Q12
[ 0 ],ÖsEncCål->
LTPC€f_Q14
,

441 
psEncCål
->
AR_Q13
,ÖsEncCål->
H¨mSh≠eGaö_Q14
,ÖsEncCål->
Tût_Q14
,ÖsEncCål->
LF_shp_Q14
,

442 
psEncCål
->
Gaös_Q16
,ÖsEncCål->
pôchL
,ÖsEncCål->
Lambda_Q10
,ÖsEncCål->
LTP_sˇÀ_Q14
, 
psEnc
->
sCmn
.
¨ch
 );

446 
	`sûk_mem˝y
–
psEncCål
->
Gaös_Q16
, 
TempGaös_Q16
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
›us_öt32
 ) );

448 
	}
}

	@silk/fixed/find_LPC_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"tunög_∑ømëîs.h
"

37 
	$sûk_föd_LPC_FIX
(

38 
sûk_ícodî_°©e
 *
psEncC
,

39 
›us_öt16
 
NLSF_Q15
[],

40 c⁄° 
›us_öt16
 
x
[],

41 c⁄° 
›us_öt32
 
möInvGaö_Q30


44 
›us_öt
 
k
, 
sub‰_Àngth
;

45 
›us_öt32
 
a_Q16
[ 
MAX_LPC_ORDER
 ];

46 
›us_öt
 
isI¡îpLowî
, 
shi·
;

47 
›us_öt32
 
ªs_ƒg0
, 
ªs_ƒg1
;

48 
›us_öt
 
rshi·0
, 
rshi·1
;

51 
›us_öt32
 
a_tmp_Q16
[ 
MAX_LPC_ORDER
 ], 
ªs_ƒg_öãΩ
, 
ªs_ƒg
, 
ªs_tmp_ƒg
;

52 
›us_öt
 
ªs_ƒg_öãΩ_Q
, 
ªs_ƒg_Q
, 
ªs_tmp_ƒg_Q
;

53 
›us_öt16
 
a_tmp_Q12
[ 
MAX_LPC_ORDER
 ];

54 
›us_öt16
 
NLSF0_Q15
[ 
MAX_LPC_ORDER
 ];

55 
SAVE_STACK
;

57 
sub‰_Àngth
 = 
psEncC
->sub‰_Àngth +ÖsEncC->
¥edi˘LPCOrdî
;

60 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = 4;

63 
	`sûk_burg_modifõd
–&
ªs_ƒg
, &
ªs_ƒg_Q
, 
a_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
psEncC
->
nb_sub‰
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

65 if–
psEncC
->
u£I¡îpﬁ©edNLSFs
 && !psEncC->
fú°_‰ame_a·î_ª£t
 &&ÖsEncC->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

66 
	`VARDECL
–
›us_öt16
, 
LPC_ªs
 );

69 
	`sûk_burg_modifõd
–&
ªs_tmp_ƒg
, &
ªs_tmp_ƒg_Q
, 
a_tmp_Q16
, 
x
 + 2 * 
sub‰_Àngth
, 
möInvGaö_Q30
, sub‰_Àngth, 2, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

73 
shi·
 = 
ªs_tmp_ƒg_Q
 - 
ªs_ƒg_Q
;

74 if–
shi·
 >= 0 ) {

75 if–
shi·
 < 32 ) {

76 
ªs_ƒg
 =Ñes_ƒg - 
	`sûk_RSHIFT
–
ªs_tmp_ƒg
, 
shi·
 );

79 
	`sûk_as£π
–
shi·
 > -32 );

80 
ªs_ƒg
 = 
	`sûk_RSHIFT
–ªs_ƒg, -
shi·
 ) - 
ªs_tmp_ƒg
;

81 
ªs_ƒg_Q
 = 
ªs_tmp_ƒg_Q
;

85 
	`sûk_A2NLSF
–
NLSF_Q15
, 
a_tmp_Q16
, 
psEncC
->
¥edi˘LPCOrdî
 );

87 
	`ALLOC
–
LPC_ªs
, 2 * 
sub‰_Àngth
, 
›us_öt16
 );

90  
k
 = 3; k >= 0; k-- ) {

92 
	`sûk_öãΩﬁ©e
–
NLSF0_Q15
, 
psEncC
->
¥ev_NLSFq_Q15
, 
NLSF_Q15
, 
k
,ÖsEncC->
¥edi˘LPCOrdî
 );

95 
	`sûk_NLSF2A
–
a_tmp_Q12
, 
NLSF0_Q15
, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

98 
	`sûk_LPC_™Æysis_fûãr
–
LPC_ªs
, 
x
, 
a_tmp_Q12
, 2 * 
sub‰_Àngth
, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

100 
	`sûk_sum_sqr_shi·
–&
ªs_ƒg0
, &
rshi·0
, 
LPC_ªs
 + 
psEncC
->
¥edi˘LPCOrdî
, 
sub‰_Àngth
 -ÖsEncC->predictLPCOrder );

101 
	`sûk_sum_sqr_shi·
–&
ªs_ƒg1
, &
rshi·1
, 
LPC_ªs
 + 
psEncC
->
¥edi˘LPCOrdî
 + 
sub‰_Àngth
, subfr_length -ÖsEncC->predictLPCOrder );

104 
shi·
 = 
rshi·0
 - 
rshi·1
;

105 if–
shi·
 >= 0 ) {

106 
ªs_ƒg1
 = 
	`sûk_RSHIFT
–ªs_ƒg1, 
shi·
 );

107 
ªs_ƒg_öãΩ_Q
 = -
rshi·0
;

109 
ªs_ƒg0
 = 
	`sûk_RSHIFT
–ªs_ƒg0, -
shi·
 );

110 
ªs_ƒg_öãΩ_Q
 = -
rshi·1
;

112 
ªs_ƒg_öãΩ
 = 
	`sûk_ADD32
–
ªs_ƒg0
, 
ªs_ƒg1
 );

115 
shi·
 = 
ªs_ƒg_öãΩ_Q
 - 
ªs_ƒg_Q
;

116 if–
shi·
 >= 0 ) {

117 if–
	`sûk_RSHIFT
–
ªs_ƒg_öãΩ
, 
shi·
 ) < 
ªs_ƒg
 ) {

118 
isI¡îpLowî
 = 
sûk_TRUE
;

120 
isI¡îpLowî
 = 
sûk_FALSE
;

123 if–-
shi·
 < 32 ) {

124 if–
ªs_ƒg_öãΩ
 < 
	`sûk_RSHIFT
–
ªs_ƒg
, -
shi·
 ) ) {

125 
isI¡îpLowî
 = 
sûk_TRUE
;

127 
isI¡îpLowî
 = 
sûk_FALSE
;

130 
isI¡îpLowî
 = 
sûk_FALSE
;

135 if–
isI¡îpLowî
 =
sûk_TRUE
 ) {

137 
ªs_ƒg
 = 
ªs_ƒg_öãΩ
;

138 
ªs_ƒg_Q
 = 
ªs_ƒg_öãΩ_Q
;

139 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = (
›us_öt8
)
k
;

144 if–
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 == 4 ) {

146 
	`sûk_A2NLSF
–
NLSF_Q15
, 
a_Q16
, 
psEncC
->
¥edi˘LPCOrdî
 );

149 
	`˚…_as£π
–
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 =4 || (ÖsEncC->
u£I¡îpﬁ©edNLSFs
 && !psEncC->
fú°_‰ame_a·î_ª£t
 &&ÖsEncC->
nb_sub‰
 =
MAX_NB_SUBFR
 ) );

150 
RESTORE_STACK
;

151 
	}
}

	@silk/fixed/find_LTP_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"tunög_∑ømëîs.h
"

35 
	$sûk_föd_LTP_FIX
(

36 
›us_öt32
 
XXLTP_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

37 
›us_öt32
 
xXLTP_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

38 c⁄° 
›us_öt16
 
r_±r
[],

39 c⁄° 
›us_öt
 
œg
[ 
MAX_NB_SUBFR
 ],

40 c⁄° 
›us_öt
 
sub‰_Àngth
,

41 c⁄° 
›us_öt
 
nb_sub‰
,

42 
¨ch


45 
›us_öt
 
i
, 
k
, 
exåa_shi·s
;

46 
›us_öt
 
xx_shi·s
, 
xX_shi·s
, 
XX_shi·s
;

47 c⁄° 
›us_öt16
 *
œg_±r
;

48 
›us_öt32
 *
XXLTP_Q17_±r
, *
xXLTP_Q17_±r
;

49 
›us_öt32
 
xx
, 
ƒg
, 
ãmp
;

51 
xXLTP_Q17_±r
 = 
xXLTP_Q17
;

52 
XXLTP_Q17_±r
 = 
XXLTP_Q17
;

53  
k
 = 0; k < 
nb_sub‰
; k++ ) {

54 
œg_±r
 = 
r_±r
 - ( 
œg
[ 
k
 ] + 
LTP_ORDER
 / 2 );

56 
	`sûk_sum_sqr_shi·
–&
xx
, &
xx_shi·s
, 
r_±r
, 
sub‰_Àngth
 + 
LTP_ORDER
 );

57 
	`sûk_c‹rM©rix_FIX
–
œg_±r
, 
sub‰_Àngth
, 
LTP_ORDER
, 
XXLTP_Q17_±r
, &
ƒg
, &
XX_shi·s
, 
¨ch
 );

58 
exåa_shi·s
 = 
xx_shi·s
 - 
XX_shi·s
;

59 if–
exåa_shi·s
 > 0 ) {

61 
xX_shi·s
 = 
xx_shi·s
;

62  
i
 = 0; i < 
LTP_ORDER
 * LTP_ORDER; i++ ) {

63 
XXLTP_Q17_±r
[ 
i
 ] = 
	`sûk_RSHIFT32
–XXLTP_Q17_±r[ i ], 
exåa_shi·s
 );

65 
ƒg
 = 
	`sûk_RSHIFT32
–ƒg, 
exåa_shi·s
 );

66 } if–
exåa_shi·s
 < 0 ) {

68 
xX_shi·s
 = 
XX_shi·s
;

69 
xx
 = 
	`sûk_RSHIFT32
–xx, -
exåa_shi·s
 );

71 
xX_shi·s
 = 
xx_shi·s
;

73 
	`sûk_c‹rVe˘‹_FIX
–
œg_±r
, 
r_±r
, 
sub‰_Àngth
, 
LTP_ORDER
, 
xXLTP_Q17_±r
, 
xX_shi·s
, 
¨ch
 );

76 
ãmp
 = 
	`sûk_SMLAWB
–1, 
ƒg
, 
	`SILK_FIX_CONST
–
LTP_CORR_INV_MAX
, 16 ) );

77 
ãmp
 = 
	`sûk_max
–ãmp, 
xx
 );

78 
	`TIC
(
div
)

80  
i
 = 0; i < 
LTP_ORDER
 * LTP_ORDER; i++ ) {

81 
XXLTP_Q17_±r
[ 
i
 ] = 
	`sûk_DIV32_v¨Q
–XXLTP_Q17_±r[ i ], 
ãmp
, 17 );

83  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

84 
xXLTP_Q17_±r
[ 
i
 ] = 
	`sûk_DIV32_v¨Q
–xXLTP_Q17_±r[ i ], 
ãmp
, 17 );

87  
i
 = 0; i < 
LTP_ORDER
 * LTP_ORDER; i++ ) {

88 
XXLTP_Q17_±r
[ 
i
 ] = (
›us_öt32
)–
	`sûk_LSHIFT64
–(
›us_öt64
)XXLTP_Q17_±r[ i ], 17 ) / 
ãmp
 );

90  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

91 
xXLTP_Q17_±r
[ 
i
 ] = (
›us_öt32
)–
	`sûk_LSHIFT64
–(
›us_öt64
)xXLTP_Q17_±r[ i ], 17 ) / 
ãmp
 );

94 
	`TOC
(
div
)

95 
r_±r
 +
sub‰_Àngth
;

96 
XXLTP_Q17_±r
 +
LTP_ORDER
 * LTP_ORDER;

97 
xXLTP_Q17_±r
 +
LTP_ORDER
;

99 
	}
}

	@silk/fixed/find_pitch_lags_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"tunög_∑ømëîs.h
"

37 
	$sûk_föd_pôch_œgs_FIX
(

38 
sûk_ícodî_°©e_FIX
 *
psEnc
,

39 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

40 
›us_öt16
 
ªs
[],

41 c⁄° 
›us_öt16
 
x
[],

42 
¨ch


45 
›us_öt
 
buf_Àn
, 
i
, 
sˇÀ
;

46 
›us_öt32
 
thrhld_Q13
, 
ªs_ƒg
;

47 c⁄° 
›us_öt16
 *
x_±r
;

48 
	`VARDECL
–
›us_öt16
, 
Wsig
 );

49 
›us_öt16
 *
Wsig_±r
;

50 
›us_öt32
 
auto_c‹r
[ 
MAX_FIND_PITCH_LPC_ORDER
 + 1 ];

51 
›us_öt16
 
rc_Q15
[ 
MAX_FIND_PITCH_LPC_ORDER
 ];

52 
›us_öt32
 
A_Q24
[ 
MAX_FIND_PITCH_LPC_ORDER
 ];

53 
›us_öt16
 
A_Q12
[ 
MAX_FIND_PITCH_LPC_ORDER
 ];

54 
SAVE_STACK
;

59 
buf_Àn
 = 
psEnc
->
sCmn
.
œ_pôch
 +ÖsEnc->sCmn.
‰ame_Àngth
 +ÖsEnc->sCmn.
…p_mem_Àngth
;

62 
	`˚…_as£π
–
buf_Àn
 >
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 );

70 
	`ALLOC
–
Wsig
, 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
, 
›us_öt16
 );

73 
x_±r
 = 
x
 + 
buf_Àn
 - 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
;

74 
Wsig_±r
 = 
Wsig
;

75 
	`sûk_≠∂y_söe_wödow
–
Wsig_±r
, 
x_±r
, 1, 
psEnc
->
sCmn
.
œ_pôch
 );

78 
Wsig_±r
 +
psEnc
->
sCmn
.
œ_pôch
;

79 
x_±r
 +
psEnc
->
sCmn
.
œ_pôch
;

80 
	`sûk_mem˝y
–
Wsig_±r
, 
x_±r
, ( 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - 
	`sûk_LSHIFT
–psEnc->sCmn.
œ_pôch
, 1 ) ) * –
›us_öt16
 ) );

83 
Wsig_±r
 +
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - 
	`sûk_LSHIFT
–psEnc->sCmn.
œ_pôch
, 1 );

84 
x_±r
 +
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - 
	`sûk_LSHIFT
–psEnc->sCmn.
œ_pôch
, 1 );

85 
	`sûk_≠∂y_söe_wödow
–
Wsig_±r
, 
x_±r
, 2, 
psEnc
->
sCmn
.
œ_pôch
 );

88 
	`sûk_autoc‹r
–
auto_c‹r
, &
sˇÀ
, 
Wsig
, 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
,ÖsEnc->sCmn.
pôchE°im©i⁄LPCOrdî
 + 1, 
¨ch
 );

91 
auto_c‹r
[ 0 ] = 
	`sûk_SMLAWB
–auto_c‹r[ 0 ],áuto_c‹r[ 0 ], 
	`SILK_FIX_CONST
–
FIND_PITCH_WHITE_NOISE_FRACTION
, 16 ) ) + 1;

94 
ªs_ƒg
 = 
	`sûk_schur
–
rc_Q15
, 
auto_c‹r
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

97 
psEncCål
->
¥edGaö_Q16
 = 
	`sûk_DIV32_v¨Q
–
auto_c‹r
[ 0 ], 
	`sûk_max_öt
–
ªs_ƒg
, 1 ), 16 );

100 
	`sûk_k2a
–
A_Q24
, 
rc_Q15
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

103  
i
 = 0; i < 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
; i++ ) {

104 
A_Q12
[ 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT
–
A_Q24
[ i ], 12 ) );

108 
	`sûk_bwex∑ndî
–
A_Q12
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
, 
	`SILK_FIX_CONST
–
FIND_PITCH_BANDWIDTH_EXPANSION
, 16 ) );

113 
	`sûk_LPC_™Æysis_fûãr
–
ªs
, 
x
, 
A_Q12
, 
buf_Àn
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
,ÖsEnc->sCmn.
¨ch
 );

115 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 !
TYPE_NO_VOICE_ACTIVITY
 &&ÖsEnc->sCmn.
fú°_‰ame_a·î_ª£t
 == 0 ) {

117 
thrhld_Q13
 = 
	`SILK_FIX_CONST
( 0.6, 13 );

118 
thrhld_Q13
 = 
	`sûk_SMLABB
–thrhld_Q13, 
	`SILK_FIX_CONST
–-0.004, 13 ), 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

119 
thrhld_Q13
 = 
	`sûk_SMLAWB
–thrhld_Q13, 
	`SILK_FIX_CONST
–-0.1, 21 ), 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 );

120 
thrhld_Q13
 = 
	`sûk_SMLABB
–thrhld_Q13, 
	`SILK_FIX_CONST
–-0.15, 13 ), 
	`sûk_RSHIFT
–
psEnc
->
sCmn
.
¥evSig«lTy≥
, 1 ) );

121 
thrhld_Q13
 = 
	`sûk_SMLAWB
–thrhld_Q13, 
	`SILK_FIX_CONST
–-0.1, 14 ), 
psEnc
->
sCmn
.
öput_tût_Q15
 );

122 
thrhld_Q13
 = 
	`sûk_SAT16
(Åhrhld_Q13 );

127 if–
	`sûk_pôch_™Æysis_c‹e
–
ªs
, 
psEncCål
->
pôchL
, &
psEnc
->
sCmn
.
ödi˚s
.
œgIndex
, &psEnc->sCmn.ödi˚s.
c⁄tourIndex
,

128 &
psEnc
->
LTPC‹r_Q15
,ÖsEnc->
sCmn
.
¥evLag
,ÖsEnc->sCmn.
pôchE°im©i⁄Thªshﬁd_Q16
,

129 (
›us_öt
)
thrhld_Q13
, 
psEnc
->
sCmn
.
fs_kHz
,ÖsEnc->sCmn.
pôchE°im©i⁄Com∂exôy
,ÖsEnc->sCmn.
nb_sub‰
,

130 
psEnc
->
sCmn
.
¨ch
) == 0 )

132 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_VOICED
;

134 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_UNVOICED
;

137 
	`sûk_mem£t
–
psEncCål
->
pôchL
, 0, (ÖsEncCtrl->pitchL ) );

138 
psEnc
->
sCmn
.
ödi˚s
.
œgIndex
 = 0;

139 
psEnc
->
sCmn
.
ödi˚s
.
c⁄tourIndex
 = 0;

140 
psEnc
->
LTPC‹r_Q15
 = 0;

142 
RESTORE_STACK
;

143 
	}
}

	@silk/fixed/find_pred_coefs_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"°ack_Æloc.h
"

35 
	$sûk_föd_¥ed_c€fs_FIX
(

36 
sûk_ícodî_°©e_FIX
 *
psEnc
,

37 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

38 c⁄° 
›us_öt16
 
ªs_pôch
[],

39 c⁄° 
›us_öt16
 
x
[],

40 
›us_öt
 
c⁄dCodög


43 
›us_öt
 
i
;

44 
›us_öt32
 
övGaös_Q16
[ 
MAX_NB_SUBFR
 ], 
loˇl_gaös
[ MAX_NB_SUBFR ];

45 
›us_öt16
 
NLSF_Q15
[ 
MAX_LPC_ORDER
 ];

46 c⁄° 
›us_öt16
 *
x_±r
;

47 
›us_öt16
 *
x_¥e_±r
;

48 
	`VARDECL
–
›us_öt16
, 
LPC_ö_¥e
 );

49 
›us_öt32
 
mö_gaö_Q16
, 
möInvGaö_Q30
;

50 
SAVE_STACK
;

53 
mö_gaö_Q16
 = 
sûk_öt32_MAX
 >> 6;

54  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

55 
mö_gaö_Q16
 = 
	`sûk_mö
–mö_gaö_Q16, 
psEncCål
->
Gaös_Q16
[ 
i
 ] );

57  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

59 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
i
 ] > 0 );

61 
övGaös_Q16
[ 
i
 ] = 
	`sûk_DIV32_v¨Q
–
mö_gaö_Q16
, 
psEncCål
->
Gaös_Q16
[ i ], 16 - 2 );

64 
övGaös_Q16
[ 
i
 ] = 
	`sûk_max
( invGains_Q16[ i ], 100 );

67 
	`sûk_as£π
–
övGaös_Q16
[ 
i
 ] =
	`sûk_SAT16
( invGains_Q16[ i ] ) );

70 
loˇl_gaös
[ 
i
 ] = 
	`sûk_DIV32
––(
›us_öt32
)1 << 16 ), 
övGaös_Q16
[ i ] );

73 
	`ALLOC
–
LPC_ö_¥e
,

74 
psEnc
->
sCmn
.
nb_sub‰
 *ÖsEnc->sCmn.
¥edi˘LPCOrdî


75 + 
psEnc
->
sCmn
.
‰ame_Àngth
, 
›us_öt16
 );

76 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

77 
	`VARDECL
–
›us_öt32
, 
xXLTP_Q17
 );

78 
	`VARDECL
–
›us_öt32
, 
XXLTP_Q17
 );

83 
	`˚…_as£π
–
psEnc
->
sCmn
.
…p_mem_Àngth
 -ÖsEnc->sCmn.
¥edi˘LPCOrdî
 >
psEncCål
->
pôchL
[ 0 ] + 
LTP_ORDER
 / 2 );

85 
	`ALLOC
–
xXLTP_Q17
, 
psEnc
->
sCmn
.
nb_sub‰
 * 
LTP_ORDER
, 
›us_öt32
 );

86 
	`ALLOC
–
XXLTP_Q17
, 
psEnc
->
sCmn
.
nb_sub‰
 * 
LTP_ORDER
 * LTP_ORDER, 
›us_öt32
 );

89 
	`sûk_föd_LTP_FIX
–
XXLTP_Q17
, 
xXLTP_Q17
, 
ªs_pôch
,

90 
psEncCål
->
pôchL
, 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¨ch
 );

93 
	`sûk_qu™t_LTP_gaös
–
psEncCål
->
LTPC€f_Q14
, 
psEnc
->
sCmn
.
ödi˚s
.
LTPIndex
, &psEnc->sCmn.ödi˚s.
PERIndex
,

94 &
psEnc
->
sCmn
.
sum_log_gaö_Q7
, &
psEncCål
->
LTPªdCodGaö_Q7
, 
XXLTP_Q17
, 
xXLTP_Q17
,ÖsEnc->sCmn.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¨ch
 );

97 
	`sûk_LTP_sˇÀ_˘æ_FIX
–
psEnc
, 
psEncCål
, 
c⁄dCodög
 );

100 
	`sûk_LTP_™Æysis_fûãr_FIX
–
LPC_ö_¥e
, 
x
 - 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
, 
psEncCål
->
LTPC€f_Q14
,

101 
psEncCål
->
pôchL
, 
övGaös_Q16
, 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¥edi˘LPCOrdî
 );

108 
x_±r
 = 
x
 - 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
;

109 
x_¥e_±r
 = 
LPC_ö_¥e
;

110  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

111 
	`sûk_sˇÀ_c›y_ve˘‹16
–
x_¥e_±r
, 
x_±r
, 
övGaös_Q16
[ 
i
 ],

112 
psEnc
->
sCmn
.
sub‰_Àngth
 +ÖsEnc->sCmn.
¥edi˘LPCOrdî
 );

113 
x_¥e_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
 +ÖsEnc->sCmn.
¥edi˘LPCOrdî
;

114 
x_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
;

117 
	`sûk_mem£t
–
psEncCål
->
LTPC€f_Q14
, 0, 
psEnc
->
sCmn
.
nb_sub‰
 * 
LTP_ORDER
 * –
›us_öt16
 ) );

118 
psEncCål
->
LTPªdCodGaö_Q7
 = 0;

119 
psEnc
->
sCmn
.
sum_log_gaö_Q7
 = 0;

123 if–
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 ) {

124 
möInvGaö_Q30
 = 
	`SILK_FIX_CONST
–1.0‡/ 
MAX_PREDICTION_POWER_GAIN_AFTER_RESET
, 30 );

126 
möInvGaö_Q30
 = 
	`sûk_log2lö
–
	`sûk_SMLAWB
–16 << 7, (
›us_öt32
)
psEncCål
->
LTPªdCodGaö_Q7
, 
	`SILK_FIX_CONST
( 1.0 / 3, 16 ) ) );

127 
möInvGaö_Q30
 = 
	`sûk_DIV32_v¨Q
( minInvGain_Q30,

128 
	`sûk_SMULWW
–
	`SILK_FIX_CONST
–
MAX_PREDICTION_POWER_GAIN
, 0 ),

129 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–0.25, 18 ), SILK_FIX_CONST–0.75, 18 ), 
psEncCål
->
codög_quÆôy_Q14
 ) ), 14 );

133 
	`sûk_föd_LPC_FIX
–&
psEnc
->
sCmn
, 
NLSF_Q15
, 
LPC_ö_¥e
, 
möInvGaö_Q30
 );

136 
	`sûk_¥o˚ss_NLSFs
–&
psEnc
->
sCmn
, 
psEncCål
->
PªdC€f_Q12
, 
NLSF_Q15
,ÖsEnc->sCmn.
¥ev_NLSFq_Q15
 );

139 
	`sûk_ªsiduÆ_íîgy_FIX
–
psEncCål
->
ResNrg
,ÖsEncCål->
ResNrgQ
, 
LPC_ö_¥e
,ÖsEncCål->
PªdC€f_Q12
, 
loˇl_gaös
,

140 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¥edi˘LPCOrdî
,ÖsEnc->sCmn.
¨ch
 );

143 
	`sûk_mem˝y
–
psEnc
->
sCmn
.
¥ev_NLSFq_Q15
, 
NLSF_Q15
, (ÖsEnc->sCmn.prev_NLSFq_Q15 ) );

144 
RESTORE_STACK
;

145 
	}
}

	@silk/fixed/k2a_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
	$sûk_k2a
(

36 
›us_öt32
 *
A_Q24
,

37 c⁄° 
›us_öt16
 *
rc_Q15
,

38 c⁄° 
›us_öt32
 
‹dî


41 
›us_öt
 
k
, 
n
;

42 
›us_öt32
 
rc
, 
tmp1
, 
tmp2
;

44  
k
 = 0; k < 
‹dî
; k++ ) {

45 
rc
 = 
rc_Q15
[ 
k
 ];

46  
n
 = 0;Ç < (
k
 + 1) >> 1;Ç++ ) {

47 
tmp1
 = 
A_Q24
[ 
n
 ];

48 
tmp2
 = 
A_Q24
[ 
k
 - 
n
 - 1 ];

49 
A_Q24
[ 
n
 ] = 
	`sûk_SMLAWB
–
tmp1
, 
	`sûk_LSHIFT
–
tmp2
, 1 ), 
rc
 );

50 
A_Q24
[ 
k
 - 
n
 - 1 ] = 
	`sûk_SMLAWB
–
tmp2
, 
	`sûk_LSHIFT
–
tmp1
, 1 ), 
rc
 );

52 
A_Q24
[ 
k
 ] = -
	`sûk_LSHIFT
–(
›us_öt32
)
rc_Q15
[ k ], 9 );

54 
	}
}

	@silk/fixed/k2a_Q16_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
	$sûk_k2a_Q16
(

36 
›us_öt32
 *
A_Q24
,

37 c⁄° 
›us_öt32
 *
rc_Q16
,

38 c⁄° 
›us_öt32
 
‹dî


41 
›us_öt
 
k
, 
n
;

42 
›us_öt32
 
rc
, 
tmp1
, 
tmp2
;

44  
k
 = 0; k < 
‹dî
; k++ ) {

45 
rc
 = 
rc_Q16
[ 
k
 ];

46  
n
 = 0;Ç < (
k
 + 1) >> 1;Ç++ ) {

47 
tmp1
 = 
A_Q24
[ 
n
 ];

48 
tmp2
 = 
A_Q24
[ 
k
 - 
n
 - 1 ];

49 
A_Q24
[ 
n
 ] = 
	`sûk_SMLAWW
–
tmp1
, 
tmp2
, 
rc
 );

50 
A_Q24
[ 
k
 - 
n
 - 1 ] = 
	`sûk_SMLAWW
–
tmp2
, 
tmp1
, 
rc
 );

52 
A_Q24
[ 
k
 ] = -
	`sûk_LSHIFT
–
rc
, 8 );

54 
	}
}

	@silk/fixed/main_FIX.h

28 #i‚de‡
SILK_MAIN_FIX_H


29 
	#SILK_MAIN_FIX_H


	)

31 
	~"SigProc_FIX.h
"

32 
	~"°ru˘s_FIX.h
"

33 
	~"c⁄åﬁ.h
"

34 
	~"maö.h
"

35 
	~"PLC.h
"

36 
	~"debug.h
"

37 
	~"íãnc.h
"

39 #i‡((
deföed
(
OPUS_ARM_ASM
Ë&& deföed(
FIXED_POINT
)) \

40 || 
	$deföed
(
OPUS_ARM_MAY_HAVE_NEON_INTR
))

41 
	~"fixed/¨m/w¨≥d_autoc‹ªœti⁄_FIX_¨m.h
"

44 #i‚de‡
FORCE_CPP_BUILD


45 #ifde‡
__˝lu•lus


51 
	#sûk_ícodî_°©e_Fxx
 
sûk_ícodî_°©e_FIX


	)

52 
	#sûk_ícode_do_VAD_Fxx
 
sûk_ícode_do_VAD_FIX


	)

53 
	#sûk_ícode_‰ame_Fxx
 
sûk_ícode_‰ame_FIX


	)

55 
	#QC
 10

	)

56 
	#QS
 13

	)

63 
	`sûk_HP_v¨übÀ_cutoff
(

64 
sûk_ícodî_°©e_Fxx
 
°©e_Fxx
[]

68 
	`sûk_ícode_do_VAD_FIX
(

69 
sûk_ícodî_°©e_FIX
 *
psEnc
,

70 
›us_öt
 
a˘ivôy


74 
›us_öt
 
	`sûk_ícode_‰ame_FIX
(

75 
sûk_ícodî_°©e_FIX
 *
psEnc
,

76 
›us_öt32
 *
≤ByãsOut
,

77 
ec_íc
 *
psR™geEnc
,

78 
›us_öt
 
c⁄dCodög
,

79 
›us_öt
 
maxBôs
,

80 
›us_öt
 
u£CBR


84 
›us_öt
 
	`sûk_öô_ícodî
(

85 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

86 
¨ch


90 
›us_öt
 
	`sûk_c⁄åﬁ_ícodî
(

91 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

92 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ
,

93 c⁄° 
›us_öt
 
Ælow_bw_swôch
,

94 c⁄° 
›us_öt
 
ch™√lNb
,

95 c⁄° 
›us_öt
 
f‹˚_fs_kHz


102 
	`sûk_noi£_sh≠e_™Æysis_FIX
(

103 
sûk_ícodî_°©e_FIX
 *
psEnc
,

104 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

105 c⁄° 
›us_öt16
 *
pôch_ªs
,

106 c⁄° 
›us_öt16
 *
x
,

107 
¨ch


111 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
(

112 
›us_öt32
 *
c‹r
,

113 
›us_öt
 *
sˇÀ
,

114 c⁄° 
›us_öt16
 *
öput
,

115 c⁄° 
›us_öt
 
w¨pög_Q16
,

116 c⁄° 
›us_öt
 
Àngth
,

117 c⁄° 
›us_öt
 
‹dî


120 #i‡!
	`deföed
(
OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX
)

121 
	#sûk_w¨≥d_autoc‹ªœti⁄_FIX
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
, 
¨ch
) \

122 (()(
¨ch
), 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
(
c‹r
, 
sˇÀ
, 
öput
, 
w¨pög_Q16
, 
Àngth
, 
‹dî
))

	)

126 
	`sûk_LTP_sˇÀ_˘æ_FIX
(

127 
sûk_ícodî_°©e_FIX
 *
psEnc
,

128 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

129 
›us_öt
 
c⁄dCodög


136 
	`sûk_föd_pôch_œgs_FIX
(

137 
sûk_ícodî_°©e_FIX
 *
psEnc
,

138 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

139 
›us_öt16
 
ªs
[],

140 c⁄° 
›us_öt16
 
x
[],

141 
¨ch


145 
	`sûk_föd_¥ed_c€fs_FIX
(

146 
sûk_ícodî_°©e_FIX
 *
psEnc
,

147 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

148 c⁄° 
›us_öt16
 
ªs_pôch
[],

149 c⁄° 
›us_öt16
 
x
[],

150 
›us_öt
 
c⁄dCodög


154 
	`sûk_föd_LPC_FIX
(

155 
sûk_ícodî_°©e
 *
psEncC
,

156 
›us_öt16
 
NLSF_Q15
[],

157 c⁄° 
›us_öt16
 
x
[],

158 c⁄° 
›us_öt32
 
möInvGaö_Q30


162 
	`sûk_föd_LTP_FIX
(

163 
›us_öt32
 
XXLTP_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

164 
›us_öt32
 
xXLTP_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

165 c⁄° 
›us_öt16
 
r_Õc
[],

166 c⁄° 
›us_öt
 
œg
[ 
MAX_NB_SUBFR
 ],

167 c⁄° 
›us_öt
 
sub‰_Àngth
,

168 c⁄° 
›us_öt
 
nb_sub‰
,

169 
¨ch


172 
	`sûk_LTP_™Æysis_fûãr_FIX
(

173 
›us_öt16
 *
LTP_ªs
,

174 c⁄° 
›us_öt16
 *
x
,

175 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

176 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

177 c⁄° 
›us_öt32
 
övGaös_Q16
[ 
MAX_NB_SUBFR
 ],

178 c⁄° 
›us_öt
 
sub‰_Àngth
,

179 c⁄° 
›us_öt
 
nb_sub‰
,

180 c⁄° 
›us_öt
 
¥e_Àngth


185 
	`sûk_ªsiduÆ_íîgy_FIX
(

186 
›us_öt32
 
ƒgs
[ 
MAX_NB_SUBFR
 ],

187 
›us_öt
 
ƒgsQ
[ 
MAX_NB_SUBFR
 ],

188 c⁄° 
›us_öt16
 
x
[],

189 
›us_öt16
 
a_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ],

190 c⁄° 
›us_öt32
 
gaös
[ 
MAX_NB_SUBFR
 ],

191 c⁄° 
›us_öt
 
sub‰_Àngth
,

192 c⁄° 
›us_öt
 
nb_sub‰
,

193 c⁄° 
›us_öt
 
LPC_‹dî
,

194 
¨ch


198 
›us_öt32
 
	`sûk_ªsiduÆ_íîgy16_cov¨_FIX
(

199 c⁄° 
›us_öt16
 *
c
,

200 c⁄° 
›us_öt32
 *
wXX
,

201 c⁄° 
›us_öt32
 *
wXx
,

202 
›us_öt32
 
wxx
,

203 
›us_öt
 
D
,

204 
›us_öt
 
cQ


208 
	`sûk_¥o˚ss_gaös_FIX
(

209 
sûk_ícodî_°©e_FIX
 *
psEnc
,

210 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

211 
›us_öt
 
c⁄dCodög


218 
	`sûk_c‹rM©rix_FIX
(

219 c⁄° 
›us_öt16
 *
x
,

220 c⁄° 
›us_öt
 
L
,

221 c⁄° 
›us_öt
 
‹dî
,

222 
›us_öt32
 *
XX
,

223 
›us_öt32
 *
ƒg
,

224 
›us_öt
 *
rshi·s
,

225 
¨ch


229 
	`sûk_c‹rVe˘‹_FIX
(

230 c⁄° 
›us_öt16
 *
x
,

231 c⁄° 
›us_öt16
 *
t
,

232 c⁄° 
›us_öt
 
L
,

233 c⁄° 
›us_öt
 
‹dî
,

234 
›us_öt32
 *
Xt
,

235 c⁄° 
›us_öt
 
rshi·s
,

236 
¨ch


239 #i‚de‡
FORCE_CPP_BUILD


240 #ifde‡
__˝lu•lus


241 
	}
}

	@silk/fixed/mips/noise_shape_analysis_FIX_mipsr1.h

32 
	#OVERRIDE_sûk_noi£_sh≠e_™Æysis_FIX


	)

34 
	$sûk_noi£_sh≠e_™Æysis_FIX
(

35 
sûk_ícodî_°©e_FIX
 *
psEnc
,

36 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

37 c⁄° 
›us_öt16
 *
pôch_ªs
,

38 c⁄° 
›us_öt16
 *
x
,

39 
¨ch


42 
sûk_sh≠e_°©e_FIX
 *
psSh≠eSt
 = &
psEnc
->
sSh≠e
;

43 
›us_öt
 
k
, 
i
, 
nSam∂es
, 
Qƒg
, 
b_Q14
, 
w¨pög_Q16
, 
sˇÀ
 = 0;

44 
›us_öt32
 
SNR_adj_dB_Q7
, 
H¨mBoo°_Q16
, 
H¨mSh≠eGaö_Q16
, 
Tût_Q16
, 
tmp32
;

45 
›us_öt32
 
ƒg
, 
¥e_ƒg_Q30
, 
log_íîgy_Q7
, 
log_íîgy_¥ev_Q7
, 
íîgy_v¨üti⁄_Q7
;

46 
›us_öt32
 
dñè_Q16
, 
BWExp1_Q16
, 
BWExp2_Q16
, 
gaö_mu…_Q16
, 
gaö_add_Q16
, 
°ªngth_Q16
, 
b_Q8
;

47 
›us_öt32
 
auto_c‹r
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ];

48 
›us_öt32
 
ªÊ_c€f_Q16
[ 
MAX_SHAPE_LPC_ORDER
 ];

49 
›us_öt32
 
AR1_Q24
[ 
MAX_SHAPE_LPC_ORDER
 ];

50 
›us_öt32
 
AR2_Q24
[ 
MAX_SHAPE_LPC_ORDER
 ];

51 
	`VARDECL
–
›us_öt16
, 
x_wödowed
 );

52 c⁄° 
›us_öt16
 *
x_±r
, *
pôch_ªs_±r
;

53 
SAVE_STACK
;

56 
x_±r
 = 
x
 - 
psEnc
->
sCmn
.
œ_sh≠e
;

61 
SNR_adj_dB_Q7
 = 
psEnc
->
sCmn
.
SNR_dB_Q7
;

64 
psEncCål
->
öput_quÆôy_Q14
 = ( 
›us_öt
 )
	`sûk_RSHIFT
–(
›us_öt32
)
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ]

65 + 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 1 ], 2 );

68 
psEncCål
->
codög_quÆôy_Q14
 = 
	`sûk_RSHIFT
–
	`sûk_sigm_Q15
–
	`sûk_RSHIFT_ROUND
–
SNR_adj_dB_Q7
 -

69 
	`SILK_FIX_CONST
( 20.0, 7 ), 4 ) ), 1 );

72 if–
psEnc
->
sCmn
.
u£CBR
 == 0 ) {

73 
b_Q8
 = 
	`SILK_FIX_CONST
–1.0, 8 ) - 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
;

74 
b_Q8
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
( b_Q8, 8 ), b_Q8 );

75 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
( SNR_adj_dB_Q7,

76 
	`sûk_SMULBB
–
	`SILK_FIX_CONST
–-
BG_SNR_DECR_dB
, 7 ) >> ( 4 + 1 ), 
b_Q8
 ),

77 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1.0, 14 ) + 
psEncCål
->
öput_quÆôy_Q14
,ÖsEncCål->
codög_quÆôy_Q14
 ) );

80 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

82 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
–SNR_adj_dB_Q7, 
	`SILK_FIX_CONST
–
HARM_SNR_INCR_dB
, 8 ), 
psEnc
->
LTPC‹r_Q15
 );

85 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
( SNR_adj_dB_Q7,

86 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–6.0, 9 ), -SILK_FIX_CONST–0.4, 18 ), 
psEnc
->
sCmn
.
SNR_dB_Q7
 ),

87 
	`SILK_FIX_CONST
–1.0, 14 ) - 
psEncCål
->
öput_quÆôy_Q14
 );

94 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

96 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

97 
psEncCål
->
•¨£√ss_Q8
 = 0;

100 
nSam∂es
 = 
	`sûk_LSHIFT
–
psEnc
->
sCmn
.
fs_kHz
, 1 );

101 
íîgy_v¨üti⁄_Q7
 = 0;

102 
log_íîgy_¥ev_Q7
 = 0;

103 
pôch_ªs_±r
 = 
pôch_ªs
;

104  
k
 = 0; k < 
	`sûk_SMULBB
–
SUB_FRAME_LENGTH_MS
, 
psEnc
->
sCmn
.
nb_sub‰
 ) / 2; k++ ) {

105 
	`sûk_sum_sqr_shi·
–&
ƒg
, &
sˇÀ
, 
pôch_ªs_±r
, 
nSam∂es
 );

106 
ƒg
 +
	`sûk_RSHIFT
–
nSam∂es
, 
sˇÀ
 );

108 
log_íîgy_Q7
 = 
	`sûk_lö2log
–
ƒg
 );

109 if–
k
 > 0 ) {

110 
íîgy_v¨üti⁄_Q7
 +
	`sûk_abs
–
log_íîgy_Q7
 - 
log_íîgy_¥ev_Q7
 );

112 
log_íîgy_¥ev_Q7
 = 
log_íîgy_Q7
;

113 
pôch_ªs_±r
 +
nSam∂es
;

116 
psEncCål
->
•¨£√ss_Q8
 = 
	`sûk_RSHIFT
–
	`sûk_sigm_Q15
–
	`sûk_SMULWB
–
íîgy_v¨üti⁄_Q7
 -

117 
	`SILK_FIX_CONST
( 5.0, 7 ), SILK_FIX_CONST( 0.1, 16 ) ) ), 7 );

120 if–
psEncCål
->
•¨£√ss_Q8
 > 
	`SILK_FIX_CONST
–
SPARSENESS_THRESHOLD_QNT_OFFSET
, 8 ) ) {

121 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

123 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 1;

127 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
–SNR_adj_dB_Q7, 
	`SILK_FIX_CONST
–
SPARSE_SNR_INCR_dB
, 15 ), 
psEncCål
->
•¨£√ss_Q8
 - SILK_FIX_CONST( 0.5, 8 ) );

134 
°ªngth_Q16
 = 
	`sûk_SMULWB
–
psEncCål
->
¥edGaö_Q16
, 
	`SILK_FIX_CONST
–
FIND_PITCH_WHITE_NOISE_FRACTION
, 16 ) );

135 
BWExp1_Q16
 = 
BWExp2_Q16
 = 
	`sûk_DIV32_v¨Q
–
	`SILK_FIX_CONST
–
BANDWIDTH_EXPANSION
, 16 ),

136 
	`sûk_SMLAWW
–
	`SILK_FIX_CONST
–1.0, 16 ), 
°ªngth_Q16
, strength_Q16 ), 16 );

137 
dñè_Q16
 = 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1.0, 16 ) - 
	`sûk_SMULBB
–3, 
psEncCål
->
codög_quÆôy_Q14
 ),

138 
	`SILK_FIX_CONST
–
LOW_RATE_BANDWIDTH_EXPANSION_DELTA
, 16 ) );

139 
BWExp1_Q16
 = 
	`sûk_SUB32
–BWExp1_Q16, 
dñè_Q16
 );

140 
BWExp2_Q16
 = 
	`sûk_ADD32
–BWExp2_Q16, 
dñè_Q16
 );

142 
BWExp1_Q16
 = 
	`sûk_DIV32_16
–
	`sûk_LSHIFT
–BWExp1_Q16, 14 ), 
	`sûk_RSHIFT
–
BWExp2_Q16
, 2 ) );

144 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

146 
w¨pög_Q16
 = 
	`sûk_SMLAWB
–
psEnc
->
sCmn
.w¨pög_Q16, (
›us_öt32
)
psEncCål
->
codög_quÆôy_Q14
, 
	`SILK_FIX_CONST
( 0.01, 18 ) );

148 
w¨pög_Q16
 = 0;

154 
	`ALLOC
–
x_wödowed
, 
psEnc
->
sCmn
.
sh≠eWöLígth
, 
›us_öt16
 );

155  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

157 
›us_öt
 
shi·
, 
¶›e_∑π
, 
Ê©_∑π
;

158 
Ê©_∑π
 = 
psEnc
->
sCmn
.
fs_kHz
 * 3;

159 
¶›e_∑π
 = 
	`sûk_RSHIFT
–
psEnc
->
sCmn
.
sh≠eWöLígth
 - 
Ê©_∑π
, 1 );

161 
	`sûk_≠∂y_söe_wödow
–
x_wödowed
, 
x_±r
, 1, 
¶›e_∑π
 );

162 
shi·
 = 
¶›e_∑π
;

163 
	`sûk_mem˝y
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 
Ê©_∑π
 * (
›us_öt16
) );

164 
shi·
 +
Ê©_∑π
;

165 
	`sûk_≠∂y_söe_wödow
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 2, 
¶›e_∑π
 );

168 
x_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
;

170 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

172 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX
–
auto_c‹r
, &
sˇÀ
, 
x_wödowed
, 
w¨pög_Q16
, 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
, 
¨ch
 );

175 
	`sûk_autoc‹r
–
auto_c‹r
, &
sˇÀ
, 
x_wödowed
, 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
 + 1, 
¨ch
 );

179 
auto_c‹r
[0] = 
	`sûk_ADD32
–auto_c‹r[0], 
	`sûk_max_32
–
	`sûk_SMULWB
–
	`sûk_RSHIFT
(áuto_corr[ 0 ], 4 ),

180 
	`SILK_FIX_CONST
–
SHAPE_WHITE_NOISE_FRACTION
, 20 ) ), 1 ) );

183 
ƒg
 = 
	`sûk_schur64
–
ªÊ_c€f_Q16
, 
auto_c‹r
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

184 
	`sûk_as£π
–
ƒg
 >= 0 );

187 
	`sûk_k2a_Q16
–
AR2_Q24
, 
ªÊ_c€f_Q16
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

189 
Qƒg
 = -
sˇÀ
;

190 
	`sûk_as£π
–
Qƒg
 >= -12 );

191 
	`sûk_as£π
–
Qƒg
 <= 30 );

194 if–
Qƒg
 & 1 ) {

195 
Qƒg
 -= 1;

196 
ƒg
 >>= 1;

199 
tmp32
 = 
	`sûk_SQRT_APPROX
–
ƒg
 );

200 
Qƒg
 >>= 1;

202 
psEncCål
->
Gaös_Q16
[ 
k
 ] = (
	`sûk_LSHIFT32
–
	`sûk_LIMIT
–(
tmp32
), 
	`sûk_RSHIFT32
–
sûk_öt32_MIN
, (16 - 
Qƒg
) ), \

203 
	`sûk_RSHIFT32
–
sûk_öt32_MAX
, (16 - 
Qƒg
) ) ), (16 - Qnrg) ));

205 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

207 
gaö_mu…_Q16
 = 
	`w¨≥d_gaö
–
AR2_Q24
, 
w¨pög_Q16
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

208 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
k
 ] >= 0 );

209 i‡–
	`sûk_SMULWW
–
	`sûk_RSHIFT_ROUND
–
psEncCål
->
Gaös_Q16
[ 
k
 ], 1 ), 
gaö_mu…_Q16
 ) >–
sûk_öt32_MAX
 >> 1 ) ) {

210 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
sûk_öt32_MAX
;

212 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMULWW
–psEncCål->Gaös_Q16[ k ], 
gaö_mu…_Q16
 );

217 
	`sûk_bwex∑ndî_32
–
AR2_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
BWExp2_Q16
 );

220 
	`sûk_mem˝y
–
AR1_Q24
, 
AR2_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 * –
›us_öt32
 ) );

223 
	`sûk_as£π
–
BWExp1_Q16
 <
	`SILK_FIX_CONST
( 1.0, 16 ) );

224 
	`sûk_bwex∑ndî_32
–
AR1_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
BWExp1_Q16
 );

227 
¥e_ƒg_Q30
 = 
	`sûk_LPC_övî£_¥ed_gaö_Q24
–
AR2_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
¨ch
 );

228 
ƒg
 = 
	`sûk_LPC_övî£_¥ed_gaö_Q24
–
AR1_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
¨ch
 );

231 
¥e_ƒg_Q30
 = 
	`sûk_LSHIFT32
–
	`sûk_SMULWB
–¥e_ƒg_Q30, 
	`SILK_FIX_CONST
( 0.7, 15 ) ), 1 );

232 
psEncCål
->
GaösPª_Q14
[ 
k
 ] = ( 
›us_öt
 ) 
	`SILK_FIX_CONST
–0.3, 14 ) + 
	`sûk_DIV32_v¨Q
–
¥e_ƒg_Q30
, 
ƒg
, 14 );

235 
	`limô_w¨≥d_c€fs
–
AR2_Q24
, 
AR1_Q24
, 
w¨pög_Q16
, 
	`SILK_FIX_CONST
–3.999, 24 ), 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

238  
i
 = 0; i < 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
; i++ ) {

239 
psEncCål
->
AR1_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 + 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
AR1_Q24
[ i ], 11 ) );

240 
psEncCål
->
AR2_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 + 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
AR2_Q24
[ i ], 11 ) );

248 
gaö_mu…_Q16
 = 
	`sûk_log2lö
–-
	`sûk_SMLAWB
–-
	`SILK_FIX_CONST
–16.0, 7 ), 
SNR_adj_dB_Q7
, SILK_FIX_CONST( 0.16, 16 ) ) );

249 
gaö_add_Q16
 = 
	`sûk_log2lö
–
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–16.0, 7 ), SILK_FIX_CONST–
MIN_QGAIN_DB
, 7 ), SILK_FIX_CONST( 0.16, 16 ) ) );

250 
	`sûk_as£π
–
gaö_mu…_Q16
 > 0 );

251  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

252 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMULWW
–psEncCål->Gaös_Q16[ k ], 
gaö_mu…_Q16
 );

253 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
k
 ] >= 0 );

254 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_ADD_POS_SAT32
–psEncCål->Gaös_Q16[ k ], 
gaö_add_Q16
 );

257 
gaö_mu…_Q16
 = 
	`SILK_FIX_CONST
–1.0, 16 ) + 
	`sûk_RSHIFT_ROUND
–
	`sûk_MLA
–SILK_FIX_CONST–
INPUT_TILT
, 26 ),

258 
psEncCål
->
codög_quÆôy_Q14
, 
	`SILK_FIX_CONST
–
HIGH_RATE_INPUT_TILT
, 12 ) ), 10 );

259  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

260 
psEncCål
->
GaösPª_Q14
[ 
k
 ] = 
	`sûk_SMULWB
–
gaö_mu…_Q16
,ÖsEncCtrl->GainsPre_Q14[ k ] );

267 
°ªngth_Q16
 = 
	`sûk_MUL
–
	`SILK_FIX_CONST
–
LOW_FREQ_SHAPING
, 4 ), 
	`sûk_SMLAWB
( SILK_FIX_CONST( 1.0, 12 ),

268 
	`SILK_FIX_CONST
–
LOW_QUALITY_LOW_FREQ_SHAPING_DECR
, 13 ), 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ] - SILK_FIX_CONST( 1.0, 15 ) ) );

269 
°ªngth_Q16
 = 
	`sûk_RSHIFT
–
	`sûk_MUL
–°ªngth_Q16, 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 ), 8 );

270 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

273 
›us_öt
 
fs_kHz_öv
 = 
	`sûk_DIV32_16
–
	`SILK_FIX_CONST
–0.2, 14 ), 
psEnc
->
sCmn
.
fs_kHz
 );

274  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

275 
b_Q14
 = 
fs_kHz_öv
 + 
	`sûk_DIV32_16
–
	`SILK_FIX_CONST
–3.0, 14 ), 
psEncCål
->
pôchL
[ 
k
 ] );

277 
psEncCål
->
LF_shp_Q14
[ 
k
 ] = 
	`sûk_LSHIFT
–
	`SILK_FIX_CONST
–1.0, 14 ) - 
b_Q14
 - 
	`sûk_SMULWB
–
°ªngth_Q16
, b_Q14 ), 16 );

278 
psEncCål
->
LF_shp_Q14
[ 
k
 ] |(
›us_uöt16
)–
b_Q14
 - 
	`SILK_FIX_CONST
( 1.0, 14 ) );

280 
	`sûk_as£π
–
	`SILK_FIX_CONST
–
HARM_HP_NOISE_COEF
, 24 ) < SILK_FIX_CONST( 0.5, 24 ) );

281 
Tût_Q16
 = - 
	`SILK_FIX_CONST
–
HP_NOISE_COEF
, 16 ) -

282 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1.0, 16 ) - SILK_FIX_CONST–
HP_NOISE_COEF
, 16 ),

283 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
HARM_HP_NOISE_COEF
, 24 ), 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 ) );

285 
b_Q14
 = 
	`sûk_DIV32_16
–21299, 
psEnc
->
sCmn
.
fs_kHz
 );

287 
psEncCål
->
LF_shp_Q14
[ 0 ] = 
	`sûk_LSHIFT
–
	`SILK_FIX_CONST
–1.0, 14 ) - 
b_Q14
 -

288 
	`sûk_SMULWB
–
°ªngth_Q16
, sûk_SMULWB–
	`SILK_FIX_CONST
–0.6, 16 ), 
b_Q14
 ) ), 16 );

289 
psEncCål
->
LF_shp_Q14
[ 0 ] |(
›us_uöt16
)–
b_Q14
 - 
	`SILK_FIX_CONST
( 1.0, 14 ) );

290  
k
 = 1; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

291 
psEncCål
->
LF_shp_Q14
[ 
k
 ] =ÖsEncCtrl->LF_shp_Q14[ 0 ];

293 
Tût_Q16
 = -
	`SILK_FIX_CONST
–
HP_NOISE_COEF
, 16 );

300 
H¨mBoo°_Q16
 = 
	`sûk_SMULWB
–sûk_SMULWB–
	`SILK_FIX_CONST
–1.0, 17 ) - 
	`sûk_LSHIFT
–
psEncCål
->
codög_quÆôy_Q14
, 3 ),

301 
psEnc
->
LTPC‹r_Q15
 ), 
	`SILK_FIX_CONST
–
LOW_RATE_HARMONIC_BOOST
, 16 ) );

304 
H¨mBoo°_Q16
 = 
	`sûk_SMLAWB
( HarmBoost_Q16,

305 
	`SILK_FIX_CONST
–1.0, 16 ) - 
	`sûk_LSHIFT
–
psEncCål
->
öput_quÆôy_Q14
, 2 ), SILK_FIX_CONST–
LOW_INPUT_QUALITY_HARMONIC_BOOST
, 16 ) );

307 if–
USE_HARM_SHAPING
 && 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

309 
H¨mSh≠eGaö_Q16
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–
HARMONIC_SHAPING
, 16 ),

310 
	`SILK_FIX_CONST
–1.0, 16 ) - 
	`sûk_SMULWB
–SILK_FIX_CONST–1.0, 18 ) - 
	`sûk_LSHIFT
–
psEncCål
->
codög_quÆôy_Q14
, 4 ),

311 
psEncCål
->
öput_quÆôy_Q14
 ), 
	`SILK_FIX_CONST
–
HIGH_RATE_OR_LOW_QUALITY_HARMONIC_SHAPING
, 16 ) );

314 
H¨mSh≠eGaö_Q16
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
( HarmShapeGain_Q16, 1 ),

315 
	`sûk_SQRT_APPROX
–
	`sûk_LSHIFT
–
psEnc
->
LTPC‹r_Q15
, 15 ) ) );

317 
H¨mSh≠eGaö_Q16
 = 0;

323  
k
 = 0; k < 
MAX_NB_SUBFR
; k++ ) {

324 
psSh≠eSt
->
H¨mBoo°_smth_Q16
 =

325 
	`sûk_SMLAWB
–
psSh≠eSt
->
H¨mBoo°_smth_Q16
, 
H¨mBoo°_Q16
 -ÖsSh≠eSt->H¨mBoo°_smth_Q16, 
	`SILK_FIX_CONST
–
SUBFR_SMTH_COEF
, 16 ) );

326 
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
 =

327 
	`sûk_SMLAWB
–
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
, 
H¨mSh≠eGaö_Q16
 -ÖsSh≠eSt->H¨mSh≠eGaö_smth_Q16, 
	`SILK_FIX_CONST
–
SUBFR_SMTH_COEF
, 16 ) );

328 
psSh≠eSt
->
Tût_smth_Q16
 =

329 
	`sûk_SMLAWB
–
psSh≠eSt
->
Tût_smth_Q16
, 
Tût_Q16
 -ÖsSh≠eSt->Tût_smth_Q16, 
	`SILK_FIX_CONST
–
SUBFR_SMTH_COEF
, 16 ) );

331 
psEncCål
->
H¨mBoo°_Q14
[ 
k
 ] = ( 
›us_öt
 )
	`sûk_RSHIFT_ROUND
–
psSh≠eSt
->
H¨mBoo°_smth_Q16
, 2 );

332 
psEncCål
->
H¨mSh≠eGaö_Q14
[ 
k
 ] = ( 
›us_öt
 )
	`sûk_RSHIFT_ROUND
–
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
, 2 );

333 
psEncCål
->
Tût_Q14
[ 
k
 ] = ( 
›us_öt
 )
	`sûk_RSHIFT_ROUND
–
psSh≠eSt
->
Tût_smth_Q16
, 2 );

335 
RESTORE_STACK
;

336 
	}
}

	@silk/fixed/mips/prefilter_FIX_mipsr1.h

27 #i‚de‡
__PREFILTER_FIX_MIPSR1_H__


28 
	#__PREFILTER_FIX_MIPSR1_H__


	)

30 #ifde‡
HAVE_CONFIG_H


31 
	~"c⁄fig.h
"

34 
	~"maö_FIX.h
"

35 
	~"°ack_Æloc.h
"

36 
	~"tunög_∑ømëîs.h
"

38 
	#OVERRIDE_sûk_w¨≥d_LPC_™Æysis_fûãr_FIX


	)

39 
	$sûk_w¨≥d_LPC_™Æysis_fûãr_FIX
(

40 
›us_öt32
 
°©e
[],

41 
›us_öt32
 
ªs_Q2
[],

42 c⁄° 
›us_öt16
 
c€f_Q13
[],

43 c⁄° 
›us_öt16
 
öput
[],

44 c⁄° 
›us_öt16
 
œmbda_Q16
,

45 c⁄° 
›us_öt
 
Àngth
,

46 c⁄° 
›us_öt
 
‹dî
,

47 
¨ch


50 
›us_öt
 
n
, 
i
;

51 
›us_öt32
 
acc_Q11
, 
acc_Q22
, 
tmp1
, 
tmp2
, 
tmp3
, 
tmp4
;

52 
›us_öt32
 
°©e_cur
, 
°©e_√xt
;

54 ()
¨ch
;

59 
	`sûk_as£π
––
‹dî
 & 1 ) == 0 );

60 
	`sûk_as£π
––
Àngth
 & 1 ) == 0 );

62  
n
 = 0;Ç < 
Àngth
;Ç+=2 ) {

64 
tmp2
 = 
	`sûk_SMLAWB
–
°©e
[ 0 ], sèã[ 1 ], 
œmbda_Q16
 );

65 
°©e_cur
 = 
	`sûk_LSHIFT
–
öput
[ 
n
 ], 14 );

67 
tmp1
 = 
	`sûk_SMLAWB
–
°©e
[ 1 ], sèã[ 2 ] - 
tmp2
, 
œmbda_Q16
 );

68 
°©e_√xt
 = 
tmp2
;

69 
acc_Q11
 = 
	`sûk_RSHIFT
–
‹dî
, 1 );

70 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp2
, 
c€f_Q13
[ 0 ] );

74 
tmp4
 = 
	`sûk_SMLAWB
–
°©e_cur
, 
°©e_√xt
, 
œmbda_Q16
 );

75 
°©e
[ 0 ] = 
	`sûk_LSHIFT
–
öput
[ 
n
+1 ], 14 );

77 
tmp3
 = 
	`sûk_SMLAWB
–
°©e_√xt
, 
tmp1
 - 
tmp4
, 
œmbda_Q16
 );

78 
°©e
[ 1 ] = 
tmp4
;

79 
acc_Q22
 = 
	`sûk_RSHIFT
–
‹dî
, 1 );

80 
acc_Q22
 = 
	`sûk_SMLAWB
–acc_Q22, 
tmp4
, 
c€f_Q13
[ 0 ] );

83  
i
 = 2; i < 
‹dî
; i += 2 ) {

85 
tmp2
 = 
	`sûk_SMLAWB
–
°©e
[ 
i
 ], sèã[ i + 1 ] - 
tmp1
, 
œmbda_Q16
 );

86 
°©e_cur
 = 
tmp1
;

87 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp1
, 
c€f_Q13
[ 
i
 - 1 ] );

89 
tmp1
 = 
	`sûk_SMLAWB
–
°©e
[ 
i
 + 1 ], sèã[ i + 2 ] - 
tmp2
, 
œmbda_Q16
 );

90 
°©e_√xt
 = 
tmp2
;

91 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp2
, 
c€f_Q13
[ 
i
 ] );

95 
tmp4
 = 
	`sûk_SMLAWB
–
°©e_cur
, 
°©e_√xt
 - 
tmp3
, 
œmbda_Q16
 );

96 
°©e
[ 
i
 ] = 
tmp3
;

97 
acc_Q22
 = 
	`sûk_SMLAWB
–acc_Q22, 
tmp3
, 
c€f_Q13
[ 
i
 - 1 ] );

99 
tmp3
 = 
	`sûk_SMLAWB
–
°©e_√xt
, 
tmp1
 - 
tmp4
, 
œmbda_Q16
 );

100 
°©e
[ 
i
 + 1 ] = 
tmp4
;

101 
acc_Q22
 = 
	`sûk_SMLAWB
–acc_Q22, 
tmp4
, 
c€f_Q13
[ 
i
 ] );

103 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp1
, 
c€f_Q13
[ 
‹dî
 - 1 ] );

104 
ªs_Q2
[ 
n
 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
öput
[Ç ], 2 ) - 
	`sûk_RSHIFT_ROUND
–
acc_Q11
, 9 );

106 
°©e
[ 
‹dî
 ] = 
tmp3
;

107 
acc_Q22
 = 
	`sûk_SMLAWB
–acc_Q22, 
tmp3
, 
c€f_Q13
[ 
‹dî
 - 1 ] );

108 
ªs_Q2
[ 
n
+1 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
öput
[Ç+1 ], 2 ) - 
	`sûk_RSHIFT_ROUND
–
acc_Q22
, 9 );

110 
	}
}

115 
	#OVERRIDE_sûk_¥efût_FIX


	)

116 
ölöe
 
	$sûk_¥efût_FIX
(

117 
sûk_¥efûãr_°©e_FIX
 *
P
,

118 
›us_öt32
 
°_ªs_Q12
[],

119 
›us_öt32
 
xw_Q3
[],

120 
›us_öt32
 
H¨mSh≠eFIRPacked_Q12
,

121 
›us_öt
 
Tût_Q14
,

122 
›us_öt32
 
LF_shp_Q14
,

123 
›us_öt
 
œg
,

124 
›us_öt
 
Àngth


127 
›us_öt
 
i
, 
idx
, 
LTP_shp_buf_idx
;

128 
›us_öt32
 
n_LTP_Q12
, 
n_Tût_Q10
, 
n_LF_Q10
;

129 
›us_öt32
 
sLF_MA_shp_Q12
, 
sLF_AR_shp_Q12
;

130 
›us_öt16
 *
LTP_shp_buf
;

133 
LTP_shp_buf
 = 
P
->
sLTP_shp
;

134 
LTP_shp_buf_idx
 = 
P
->
sLTP_shp_buf_idx
;

135 
sLF_AR_shp_Q12
 = 
P
->sLF_AR_shp_Q12;

136 
sLF_MA_shp_Q12
 = 
P
->sLF_MA_shp_Q12;

138 if–
œg
 > 0 ) {

139  
i
 = 0; i < 
Àngth
; i++ ) {

141 
	`sûk_as£π
–
HARM_SHAPE_FIR_TAPS
 == 3 );

142 
idx
 = 
œg
 + 
LTP_shp_buf_idx
;

143 
n_LTP_Q12
 = 
	`sûk_SMULBB
–
LTP_shp_buf
[ ( 
idx
 - 
HARM_SHAPE_FIR_TAPS
 / 2 - 1Ë& 
LTP_MASK
 ], 
H¨mSh≠eFIRPacked_Q12
 );

144 
n_LTP_Q12
 = 
	`sûk_SMLABT
–n_LTP_Q12, 
LTP_shp_buf
[ ( 
idx
 - 
HARM_SHAPE_FIR_TAPS
 / 2 ) & 
LTP_MASK
 ], 
H¨mSh≠eFIRPacked_Q12
 );

145 
n_LTP_Q12
 = 
	`sûk_SMLABB
–n_LTP_Q12, 
LTP_shp_buf
[ ( 
idx
 - 
HARM_SHAPE_FIR_TAPS
 / 2 + 1Ë& 
LTP_MASK
 ], 
H¨mSh≠eFIRPacked_Q12
 );

147 
n_Tût_Q10
 = 
	`sûk_SMULWB
–
sLF_AR_shp_Q12
, 
Tût_Q14
 );

148 
n_LF_Q10
 = 
	`sûk_SMLAWB
–
	`sûk_SMULWT
–
sLF_AR_shp_Q12
, 
LF_shp_Q14
 ), 
sLF_MA_shp_Q12
, LF_shp_Q14 );

150 
sLF_AR_shp_Q12
 = 
	`sûk_SUB32
–
°_ªs_Q12
[ 
i
 ], 
	`sûk_LSHIFT
–
n_Tût_Q10
, 2 ) );

151 
sLF_MA_shp_Q12
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q12
, 
	`sûk_LSHIFT
–
n_LF_Q10
, 2 ) );

153 
LTP_shp_buf_idx
 = ( LTP_shp_buf_idx - 1 ) & 
LTP_MASK
;

154 
LTP_shp_buf
[ 
LTP_shp_buf_idx
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sLF_MA_shp_Q12
, 12 ) );

156 
xw_Q3
[
i
] = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SUB32
–
sLF_MA_shp_Q12
, 
n_LTP_Q12
 ), 9 );

161  
i
 = 0; i < 
Àngth
; i++ ) {

163 
n_LTP_Q12
 = 0;

165 
n_Tût_Q10
 = 
	`sûk_SMULWB
–
sLF_AR_shp_Q12
, 
Tût_Q14
 );

166 
n_LF_Q10
 = 
	`sûk_SMLAWB
–
	`sûk_SMULWT
–
sLF_AR_shp_Q12
, 
LF_shp_Q14
 ), 
sLF_MA_shp_Q12
, LF_shp_Q14 );

168 
sLF_AR_shp_Q12
 = 
	`sûk_SUB32
–
°_ªs_Q12
[ 
i
 ], 
	`sûk_LSHIFT
–
n_Tût_Q10
, 2 ) );

169 
sLF_MA_shp_Q12
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q12
, 
	`sûk_LSHIFT
–
n_LF_Q10
, 2 ) );

171 
LTP_shp_buf_idx
 = ( LTP_shp_buf_idx - 1 ) & 
LTP_MASK
;

172 
LTP_shp_buf
[ 
LTP_shp_buf_idx
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sLF_MA_shp_Q12
, 12 ) );

174 
xw_Q3
[
i
] = 
	`sûk_RSHIFT_ROUND
–
sLF_MA_shp_Q12
, 9 );

179 
P
->
sLF_AR_shp_Q12
 = sLF_AR_shp_Q12;

180 
P
->
sLF_MA_shp_Q12
 = sLF_MA_shp_Q12;

181 
P
->
sLTP_shp_buf_idx
 = 
LTP_shp_buf_idx
;

182 
	}
}

	@silk/fixed/mips/warped_autocorrelation_FIX_mipsr1.h

28 #i‚de‡
__WARPED_AUTOCORRELATION_FIX_MIPSR1_H__


29 
	#__WARPED_AUTOCORRELATION_FIX_MIPSR1_H__


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 
	~"maö_FIX.h
"

37 #unde‡
QC


38 
	#QC
 10

	)

40 #unde‡
QS


41 
	#QS
 14

	)

44 
	#OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX_c


	)

45 
	$sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
(

46 
›us_öt32
 *
c‹r
,

47 
›us_öt
 *
sˇÀ
,

48 c⁄° 
›us_öt16
 *
öput
,

49 c⁄° 
›us_öt
 
w¨pög_Q16
,

50 c⁄° 
›us_öt
 
Àngth
,

51 c⁄° 
›us_öt
 
‹dî


54 
›us_öt
 
n
, 
i
, 
lsh
;

55 
›us_öt32
 
tmp1_QS
=0, 
tmp2_QS
=0, 
tmp3_QS
=0, 
tmp4_QS
=0, 
tmp5_QS
=0, 
tmp6_QS
=0, 
tmp7_QS
=0, 
tmp8_QS
=0, 
°¨t_1
=0, 
°¨t_2
=0, 
°¨t_3
=0;

56 
›us_öt32
 
°©e_QS
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

57 
›us_öt64
 
c‹r_QC
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

58 
›us_öt64
 
ãmp64
;

60 
›us_öt32
 
vÆ
;

61 
vÆ
 = 2 * 
QS
 - 
QC
;

64 
	`sûk_as£π
––
‹dî
 & 1 ) == 0 );

65 
	`sûk_as£π
–2 * 
QS
 - 
QC
 >= 0 );

68  
n
 = 0;Ç < 
Àngth
;Ç=n+4 ) {

70 
tmp1_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
 ], 
QS
 );

71 
°¨t_1
 = 
tmp1_QS
;

72 
tmp3_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
+1], 
QS
 );

73 
°¨t_2
 = 
tmp3_QS
;

74 
tmp5_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
+2], 
QS
 );

75 
°¨t_3
 = 
tmp5_QS
;

76 
tmp7_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
+3], 
QS
 );

79  
i
 = 0; i < 
‹dî
; i += 2 ) {

81 
tmp2_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 ], sèã_QS[ i + 1 ] - 
tmp1_QS
, 
w¨pög_Q16
 );

82 
c‹r_QC
[ 
i
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i ], 
tmp1_QS
, 
°¨t_1
);

84 
tmp4_QS
 = 
	`sûk_SMLAWB
–
tmp1_QS
, 
tmp2_QS
 - 
tmp3_QS
, 
w¨pög_Q16
 );

85 
c‹r_QC
[ 
i
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i ], 
tmp3_QS
, 
°¨t_2
);

87 
tmp6_QS
 = 
	`sûk_SMLAWB
–
tmp3_QS
, 
tmp4_QS
 - 
tmp5_QS
, 
w¨pög_Q16
 );

88 
c‹r_QC
[ 
i
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i ], 
tmp5_QS
, 
°¨t_3
);

90 
tmp8_QS
 = 
	`sûk_SMLAWB
–
tmp5_QS
, 
tmp6_QS
 - 
tmp7_QS
, 
w¨pög_Q16
 );

91 
°©e_QS
[ 
i
 ] = 
tmp7_QS
;

92 
c‹r_QC
[ 
i
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i ], 
tmp7_QS
, 
°©e_QS
[0]);

95 
tmp1_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 + 1 ], sèã_QS[ i + 2 ] - 
tmp2_QS
, 
w¨pög_Q16
 );

96 
c‹r_QC
[ 
i
+1 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i+1 ], 
tmp2_QS
, 
°¨t_1
);

98 
tmp3_QS
 = 
	`sûk_SMLAWB
–
tmp2_QS
, 
tmp1_QS
 - 
tmp4_QS
, 
w¨pög_Q16
 );

99 
c‹r_QC
[ 
i
+1 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i+1 ], 
tmp4_QS
, 
°¨t_2
);

101 
tmp5_QS
 = 
	`sûk_SMLAWB
–
tmp4_QS
, 
tmp3_QS
 - 
tmp6_QS
, 
w¨pög_Q16
 );

102 
c‹r_QC
[ 
i
+1 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i+1 ], 
tmp6_QS
, 
°¨t_3
);

104 
tmp7_QS
 = 
	`sûk_SMLAWB
–
tmp6_QS
, 
tmp5_QS
 - 
tmp8_QS
, 
w¨pög_Q16
 );

105 
°©e_QS
[ 
i
 + 1 ] = 
tmp8_QS
;

106 
c‹r_QC
[ 
i
+1 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i+1 ], 
tmp8_QS
, 
°©e_QS
[ 0 ]);

109 
°©e_QS
[ 
‹dî
 ] = 
tmp7_QS
;

111 
c‹r_QC
[ 
‹dî
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ ordî ], 
tmp1_QS
, 
°¨t_1
);

112 
c‹r_QC
[ 
‹dî
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ ordî ], 
tmp3_QS
, 
°¨t_2
);

113 
c‹r_QC
[ 
‹dî
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ ordî ], 
tmp5_QS
, 
°¨t_3
);

114 
c‹r_QC
[ 
‹dî
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ ordî ], 
tmp7_QS
, 
°©e_QS
[ 0 ]);

117 ;
n
< 
Àngth
;Ç++ ) {

119 
tmp1_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
 ], 
QS
 );

122  
i
 = 0; i < 
‹dî
; i += 2 ) {

125 
tmp2_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 ], sèã_QS[ i + 1 ] - 
tmp1_QS
, 
w¨pög_Q16
 );

126 
°©e_QS
[ 
i
 ] = 
tmp1_QS
;

127 
c‹r_QC
[ 
i
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i ], 
tmp1_QS
, 
°©e_QS
[ 0 ]);

130 
tmp1_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 + 1 ], sèã_QS[ i + 2 ] - 
tmp2_QS
, 
w¨pög_Q16
 );

131 
°©e_QS
[ 
i
 + 1 ] = 
tmp2_QS
;

132 
c‹r_QC
[ 
i
+1 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ i+1 ], 
tmp2_QS
, 
°©e_QS
[ 0 ]);

134 
°©e_QS
[ 
‹dî
 ] = 
tmp1_QS
;

135 
c‹r_QC
[ 
‹dî
 ] = 
	`__buûtö_mùs_madd
–c‹r_QC[ ordî ], 
tmp1_QS
, 
°©e_QS
[ 0 ]);

138 
ãmp64
 = 
c‹r_QC
[ 0 ];

139 
ãmp64
 = 
	`__buûtö_mùs_shûo
—emp64, 
vÆ
);

141 
lsh
 = 
	`sûk_CLZ64
–
ãmp64
 ) - 35;

142 
lsh
 = 
	`sûk_LIMIT
–lsh, -12 - 
QC
, 30 - QC );

143 *
sˇÀ
 = -–
QC
 + 
lsh
 );

144 
	`sûk_as£π
–*
sˇÀ
 >= -30 && *scale <= 12 );

145 if–
lsh
 >= 0 ) {

146  
i
 = 0; i < 
‹dî
 + 1; i++ ) {

147 
ãmp64
 = 
c‹r_QC
[ 
i
 ];

149 
ãmp64
 = (
vÆ
 >= 0) ? (temp64 >> val) : (temp64 << -val);

150 
c‹r
[ 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`__buûtö_mùs_shûo
–
ãmp64
, -
lsh
 ) );

153  
i
 = 0; i < 
‹dî
 + 1; i++ ) {

154 
ãmp64
 = 
c‹r_QC
[ 
i
 ];

156 
ãmp64
 = (
vÆ
 >= 0) ? (temp64 >> val) : (temp64 << -val);

157 
c‹r
[ 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`__buûtö_mùs_shûo
–
ãmp64
, -
lsh
 ) );

161 
c‹r_QC
[ 0 ] = 
	`__buûtö_mùs_shûo
(c‹r_QC[ 0 ], 
vÆ
);

163 
	`sûk_as£π
–
c‹r_QC
[ 0 ] >= 0 );

164 
	}
}

	@silk/fixed/noise_shape_analysis_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"°ack_Æloc.h
"

34 
	~"tunög_∑ømëîs.h
"

40 
OPUS_INLINE
 
›us_öt32
 
	$w¨≥d_gaö
(

41 c⁄° 
›us_öt32
 *
c€fs_Q24
,

42 
›us_öt
 
œmbda_Q16
,

43 
›us_öt
 
‹dî


45 
›us_öt
 
i
;

46 
›us_öt32
 
gaö_Q24
;

48 
œmbda_Q16
 = -lambda_Q16;

49 
gaö_Q24
 = 
c€fs_Q24
[ 
‹dî
 - 1 ];

50  
i
 = 
‹dî
 - 2; i >= 0; i-- ) {

51 
gaö_Q24
 = 
	`sûk_SMLAWB
–
c€fs_Q24
[ 
i
 ], gaö_Q24, 
œmbda_Q16
 );

53 
gaö_Q24
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–1.0, 24 ), gaö_Q24, -
œmbda_Q16
 );

54  
	`sûk_INVERSE32_v¨Q
–
gaö_Q24
, 40 );

55 
	}
}

59 
OPUS_INLINE
 
	$limô_w¨≥d_c€fs
(

60 
›us_öt32
 *
c€fs_Q24
,

61 
›us_öt
 
œmbda_Q16
,

62 
›us_öt32
 
limô_Q24
,

63 
›us_öt
 
‹dî


65 
›us_öt
 
i
, 
ôî
, 
öd
 = 0;

66 
›us_öt32
 
tmp
, 
maxabs_Q24
, 
chúp_Q16
, 
gaö_Q16
;

67 
›us_öt32
 
nom_Q16
, 
dí_Q24
;

68 
›us_öt32
 
limô_Q20
, 
maxabs_Q20
;

71 
œmbda_Q16
 = -lambda_Q16;

72  
i
 = 
‹dî
 - 1; i > 0; i-- ) {

73 
c€fs_Q24
[ 
i
 - 1 ] = 
	`sûk_SMLAWB
–c€fs_Q24[ i - 1 ], c€fs_Q24[ i ], 
œmbda_Q16
 );

75 
œmbda_Q16
 = -lambda_Q16;

76 
nom_Q16
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–1.0, 16 ), -(
›us_öt32
)
œmbda_Q16
,Üambda_Q16 );

77 
dí_Q24
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–1.0, 24 ), 
c€fs_Q24
[ 0 ], 
œmbda_Q16
 );

78 
gaö_Q16
 = 
	`sûk_DIV32_v¨Q
–
nom_Q16
, 
dí_Q24
, 24 );

79  
i
 = 0; i < 
‹dî
; i++ ) {

80 
c€fs_Q24
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_Q16
, coefs_Q24[ i ] );

82 
limô_Q20
 = 
	`sûk_RSHIFT
(
limô_Q24
, 4);

83  
ôî
 = 0; iter < 10; iter++ ) {

85 
maxabs_Q24
 = -1;

86  
i
 = 0; i < 
‹dî
; i++ ) {

87 
tmp
 = 
	`sûk_abs_öt32
–
c€fs_Q24
[ 
i
 ] );

88 if–
tmp
 > 
maxabs_Q24
 ) {

89 
maxabs_Q24
 = 
tmp
;

90 
öd
 = 
i
;

94 
maxabs_Q20
 = 
	`sûk_RSHIFT
(
maxabs_Q24
, 4);

95 if–
maxabs_Q20
 <
limô_Q20
 ) {

101  
i
 = 1; i < 
‹dî
; i++ ) {

102 
c€fs_Q24
[ 
i
 - 1 ] = 
	`sûk_SMLAWB
–c€fs_Q24[ i - 1 ], c€fs_Q24[ i ], 
œmbda_Q16
 );

104 
gaö_Q16
 = 
	`sûk_INVERSE32_v¨Q
( gain_Q16, 32 );

105  
i
 = 0; i < 
‹dî
; i++ ) {

106 
c€fs_Q24
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_Q16
, coefs_Q24[ i ] );

110 
chúp_Q16
 = 
	`SILK_FIX_CONST
–0.99, 16 ) - 
	`sûk_DIV32_v¨Q
(

111 
	`sûk_SMULWB
–
maxabs_Q20
 - 
limô_Q20
, 
	`sûk_SMLABB
–
	`SILK_FIX_CONST
–0.8, 10 ), SILK_FIX_CONST–0.1, 10 ), 
ôî
 ) ),

112 
	`sûk_MUL
–
maxabs_Q20
, 
öd
 + 1 ), 22 );

113 
	`sûk_bwex∑ndî_32
–
c€fs_Q24
, 
‹dî
, 
chúp_Q16
 );

116 
œmbda_Q16
 = -lambda_Q16;

117  
i
 = 
‹dî
 - 1; i > 0; i-- ) {

118 
c€fs_Q24
[ 
i
 - 1 ] = 
	`sûk_SMLAWB
–c€fs_Q24[ i - 1 ], c€fs_Q24[ i ], 
œmbda_Q16
 );

120 
œmbda_Q16
 = -lambda_Q16;

121 
nom_Q16
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–1.0, 16 ), -(
›us_öt32
)
œmbda_Q16
,Üambda_Q16 );

122 
dí_Q24
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–1.0, 24 ), 
c€fs_Q24
[ 0 ], 
œmbda_Q16
 );

123 
gaö_Q16
 = 
	`sûk_DIV32_v¨Q
–
nom_Q16
, 
dí_Q24
, 24 );

124  
i
 = 0; i < 
‹dî
; i++ ) {

125 
c€fs_Q24
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_Q16
, coefs_Q24[ i ] );

128 
	`sûk_as£π
( 0 );

129 
	}
}

132 #i‡0 && 
deföed
(
MIPSr1_ASM
)

133 
	~"mùs/noi£_sh≠e_™Æysis_FIX_mù§1.h
"

139 #i‚de‡
OVERRIDE_sûk_noi£_sh≠e_™Æysis_FIX


140 
	$sûk_noi£_sh≠e_™Æysis_FIX
(

141 
sûk_ícodî_°©e_FIX
 *
psEnc
,

142 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

143 c⁄° 
›us_öt16
 *
pôch_ªs
,

144 c⁄° 
›us_öt16
 *
x
,

145 
¨ch


148 
sûk_sh≠e_°©e_FIX
 *
psSh≠eSt
 = &
psEnc
->
sSh≠e
;

149 
›us_öt
 
k
, 
i
, 
nSam∂es
, 
nSegs
, 
Qƒg
, 
b_Q14
, 
w¨pög_Q16
, 
sˇÀ
 = 0;

150 
›us_öt32
 
SNR_adj_dB_Q7
, 
H¨mSh≠eGaö_Q16
, 
Tût_Q16
, 
tmp32
;

151 
›us_öt32
 
ƒg
, 
log_íîgy_Q7
, 
log_íîgy_¥ev_Q7
, 
íîgy_v¨üti⁄_Q7
;

152 
›us_öt32
 
BWExp_Q16
, 
gaö_mu…_Q16
, 
gaö_add_Q16
, 
°ªngth_Q16
, 
b_Q8
;

153 
›us_öt32
 
auto_c‹r
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ];

154 
›us_öt32
 
ªÊ_c€f_Q16
[ 
MAX_SHAPE_LPC_ORDER
 ];

155 
›us_öt32
 
AR_Q24
[ 
MAX_SHAPE_LPC_ORDER
 ];

156 
	`VARDECL
–
›us_öt16
, 
x_wödowed
 );

157 c⁄° 
›us_öt16
 *
x_±r
, *
pôch_ªs_±r
;

158 
SAVE_STACK
;

161 
x_±r
 = 
x
 - 
psEnc
->
sCmn
.
œ_sh≠e
;

166 
SNR_adj_dB_Q7
 = 
psEnc
->
sCmn
.
SNR_dB_Q7
;

169 
psEncCål
->
öput_quÆôy_Q14
 = ( 
›us_öt
 )
	`sûk_RSHIFT
–(
›us_öt32
)
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ]

170 + 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 1 ], 2 );

173 
psEncCål
->
codög_quÆôy_Q14
 = 
	`sûk_RSHIFT
–
	`sûk_sigm_Q15
–
	`sûk_RSHIFT_ROUND
–
SNR_adj_dB_Q7
 -

174 
	`SILK_FIX_CONST
( 20.0, 7 ), 4 ) ), 1 );

177 if–
psEnc
->
sCmn
.
u£CBR
 == 0 ) {

178 
b_Q8
 = 
	`SILK_FIX_CONST
–1.0, 8 ) - 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
;

179 
b_Q8
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
( b_Q8, 8 ), b_Q8 );

180 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
( SNR_adj_dB_Q7,

181 
	`sûk_SMULBB
–
	`SILK_FIX_CONST
–-
BG_SNR_DECR_dB
, 7 ) >> ( 4 + 1 ), 
b_Q8
 ),

182 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1.0, 14 ) + 
psEncCål
->
öput_quÆôy_Q14
,ÖsEncCål->
codög_quÆôy_Q14
 ) );

185 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

187 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
–SNR_adj_dB_Q7, 
	`SILK_FIX_CONST
–
HARM_SNR_INCR_dB
, 8 ), 
psEnc
->
LTPC‹r_Q15
 );

190 
SNR_adj_dB_Q7
 = 
	`sûk_SMLAWB
( SNR_adj_dB_Q7,

191 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–6.0, 9 ), -SILK_FIX_CONST–0.4, 18 ), 
psEnc
->
sCmn
.
SNR_dB_Q7
 ),

192 
	`SILK_FIX_CONST
–1.0, 14 ) - 
psEncCål
->
öput_quÆôy_Q14
 );

199 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

201 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

204 
nSam∂es
 = 
	`sûk_LSHIFT
–
psEnc
->
sCmn
.
fs_kHz
, 1 );

205 
íîgy_v¨üti⁄_Q7
 = 0;

206 
log_íîgy_¥ev_Q7
 = 0;

207 
pôch_ªs_±r
 = 
pôch_ªs
;

208 
nSegs
 = 
	`sûk_SMULBB
–
SUB_FRAME_LENGTH_MS
, 
psEnc
->
sCmn
.
nb_sub‰
 ) / 2;

209  
k
 = 0; k < 
nSegs
; k++ ) {

210 
	`sûk_sum_sqr_shi·
–&
ƒg
, &
sˇÀ
, 
pôch_ªs_±r
, 
nSam∂es
 );

211 
ƒg
 +
	`sûk_RSHIFT
–
nSam∂es
, 
sˇÀ
 );

213 
log_íîgy_Q7
 = 
	`sûk_lö2log
–
ƒg
 );

214 if–
k
 > 0 ) {

215 
íîgy_v¨üti⁄_Q7
 +
	`sûk_abs
–
log_íîgy_Q7
 - 
log_íîgy_¥ev_Q7
 );

217 
log_íîgy_¥ev_Q7
 = 
log_íîgy_Q7
;

218 
pôch_ªs_±r
 +
nSam∂es
;

222 if–
íîgy_v¨üti⁄_Q7
 > 
	`SILK_FIX_CONST
–
ENERGY_VARIATION_THRESHOLD_QNT_OFFSET
, 7 ) * (
nSegs
-1) ) {

223 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

225 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 1;

233 
°ªngth_Q16
 = 
	`sûk_SMULWB
–
psEncCål
->
¥edGaö_Q16
, 
	`SILK_FIX_CONST
–
FIND_PITCH_WHITE_NOISE_FRACTION
, 16 ) );

234 
BWExp_Q16
 = 
	`sûk_DIV32_v¨Q
–
	`SILK_FIX_CONST
–
BANDWIDTH_EXPANSION
, 16 ),

235 
	`sûk_SMLAWW
–
	`SILK_FIX_CONST
–1.0, 16 ), 
°ªngth_Q16
, strength_Q16 ), 16 );

237 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

239 
w¨pög_Q16
 = 
	`sûk_SMLAWB
–
psEnc
->
sCmn
.w¨pög_Q16, (
›us_öt32
)
psEncCål
->
codög_quÆôy_Q14
, 
	`SILK_FIX_CONST
( 0.01, 18 ) );

241 
w¨pög_Q16
 = 0;

247 
	`ALLOC
–
x_wödowed
, 
psEnc
->
sCmn
.
sh≠eWöLígth
, 
›us_öt16
 );

248  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

250 
›us_öt
 
shi·
, 
¶›e_∑π
, 
Ê©_∑π
;

251 
Ê©_∑π
 = 
psEnc
->
sCmn
.
fs_kHz
 * 3;

252 
¶›e_∑π
 = 
	`sûk_RSHIFT
–
psEnc
->
sCmn
.
sh≠eWöLígth
 - 
Ê©_∑π
, 1 );

254 
	`sûk_≠∂y_söe_wödow
–
x_wödowed
, 
x_±r
, 1, 
¶›e_∑π
 );

255 
shi·
 = 
¶›e_∑π
;

256 
	`sûk_mem˝y
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 
Ê©_∑π
 * (
›us_öt16
) );

257 
shi·
 +
Ê©_∑π
;

258 
	`sûk_≠∂y_söe_wödow
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 2, 
¶›e_∑π
 );

261 
x_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
;

263 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

265 
	`sûk_w¨≥d_autoc‹ªœti⁄_FIX
–
auto_c‹r
, &
sˇÀ
, 
x_wödowed
, 
w¨pög_Q16
, 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
, 
¨ch
 );

268 
	`sûk_autoc‹r
–
auto_c‹r
, &
sˇÀ
, 
x_wödowed
, 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
 + 1, 
¨ch
 );

272 
auto_c‹r
[0] = 
	`sûk_ADD32
–auto_c‹r[0], 
	`sûk_max_32
–
	`sûk_SMULWB
–
	`sûk_RSHIFT
(áuto_corr[ 0 ], 4 ),

273 
	`SILK_FIX_CONST
–
SHAPE_WHITE_NOISE_FRACTION
, 20 ) ), 1 ) );

276 
ƒg
 = 
	`sûk_schur64
–
ªÊ_c€f_Q16
, 
auto_c‹r
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

277 
	`sûk_as£π
–
ƒg
 >= 0 );

280 
	`sûk_k2a_Q16
–
AR_Q24
, 
ªÊ_c€f_Q16
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

282 
Qƒg
 = -
sˇÀ
;

283 
	`sûk_as£π
–
Qƒg
 >= -12 );

284 
	`sûk_as£π
–
Qƒg
 <= 30 );

287 if–
Qƒg
 & 1 ) {

288 
Qƒg
 -= 1;

289 
ƒg
 >>= 1;

292 
tmp32
 = 
	`sûk_SQRT_APPROX
–
ƒg
 );

293 
Qƒg
 >>= 1;

295 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_LSHIFT_SAT32
–
tmp32
, 16 - 
Qƒg
 );

297 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

299 
gaö_mu…_Q16
 = 
	`w¨≥d_gaö
–
AR_Q24
, 
w¨pög_Q16
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

300 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
k
 ] > 0 );

301 if–
psEncCål
->
Gaös_Q16
[ 
k
 ] < 
	`SILK_FIX_CONST
( 0.25, 16 ) ) {

302 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMULWW
–psEncCål->Gaös_Q16[ k ], 
gaö_mu…_Q16
 );

304 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMULWW
–
	`sûk_RSHIFT_ROUND
–psEncCål->Gaös_Q16[ k ], 1 ), 
gaö_mu…_Q16
 );

305 i‡–
psEncCål
->
Gaös_Q16
[ 
k
 ] >–
sûk_öt32_MAX
 >> 1 ) ) {

306 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
sûk_öt32_MAX
;

308 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_LSHIFT32
(ÖsEncCtrl->Gains_Q16[ k ], 1 );

311 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
k
 ] > 0 );

315 
	`sûk_bwex∑ndî_32
–
AR_Q24
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
BWExp_Q16
 );

317 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

319 
	`limô_w¨≥d_c€fs
–
AR_Q24
, 
w¨pög_Q16
, 
	`SILK_FIX_CONST
–3.999, 24 ), 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

322  
i
 = 0; i < 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
; i++ ) {

323 
psEncCål
->
AR_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 + 
i
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
AR_Q24
[ i ], 11 ) );

326 
	`sûk_LPC_fô
–&
psEncCål
->
AR_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ], 
AR_Q24
, 13, 24, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

334 
gaö_mu…_Q16
 = 
	`sûk_log2lö
–-
	`sûk_SMLAWB
–-
	`SILK_FIX_CONST
–16.0, 7 ), 
SNR_adj_dB_Q7
, SILK_FIX_CONST( 0.16, 16 ) ) );

335 
gaö_add_Q16
 = 
	`sûk_log2lö
–
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–16.0, 7 ), SILK_FIX_CONST–
MIN_QGAIN_DB
, 7 ), SILK_FIX_CONST( 0.16, 16 ) ) );

336 
	`sûk_as£π
–
gaö_mu…_Q16
 > 0 );

337  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

338 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMULWW
–psEncCål->Gaös_Q16[ k ], 
gaö_mu…_Q16
 );

339 
	`sûk_as£π
–
psEncCål
->
Gaös_Q16
[ 
k
 ] >= 0 );

340 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_ADD_POS_SAT32
–psEncCål->Gaös_Q16[ k ], 
gaö_add_Q16
 );

348 
°ªngth_Q16
 = 
	`sûk_MUL
–
	`SILK_FIX_CONST
–
LOW_FREQ_SHAPING
, 4 ), 
	`sûk_SMLAWB
( SILK_FIX_CONST( 1.0, 12 ),

349 
	`SILK_FIX_CONST
–
LOW_QUALITY_LOW_FREQ_SHAPING_DECR
, 13 ), 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ] - SILK_FIX_CONST( 1.0, 15 ) ) );

350 
°ªngth_Q16
 = 
	`sûk_RSHIFT
–
	`sûk_MUL
–°ªngth_Q16, 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 ), 8 );

351 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

354 
›us_öt
 
fs_kHz_öv
 = 
	`sûk_DIV32_16
–
	`SILK_FIX_CONST
–0.2, 14 ), 
psEnc
->
sCmn
.
fs_kHz
 );

355  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

356 
b_Q14
 = 
fs_kHz_öv
 + 
	`sûk_DIV32_16
–
	`SILK_FIX_CONST
–3.0, 14 ), 
psEncCål
->
pôchL
[ 
k
 ] );

358 
psEncCål
->
LF_shp_Q14
[ 
k
 ] = 
	`sûk_LSHIFT
–
	`SILK_FIX_CONST
–1.0, 14 ) - 
b_Q14
 - 
	`sûk_SMULWB
–
°ªngth_Q16
, b_Q14 ), 16 );

359 
psEncCål
->
LF_shp_Q14
[ 
k
 ] |(
›us_uöt16
)–
b_Q14
 - 
	`SILK_FIX_CONST
( 1.0, 14 ) );

361 
	`sûk_as£π
–
	`SILK_FIX_CONST
–
HARM_HP_NOISE_COEF
, 24 ) < SILK_FIX_CONST( 0.5, 24 ) );

362 
Tût_Q16
 = - 
	`SILK_FIX_CONST
–
HP_NOISE_COEF
, 16 ) -

363 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1.0, 16 ) - SILK_FIX_CONST–
HP_NOISE_COEF
, 16 ),

364 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
HARM_HP_NOISE_COEF
, 24 ), 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 ) );

366 
b_Q14
 = 
	`sûk_DIV32_16
–21299, 
psEnc
->
sCmn
.
fs_kHz
 );

368 
psEncCål
->
LF_shp_Q14
[ 0 ] = 
	`sûk_LSHIFT
–
	`SILK_FIX_CONST
–1.0, 14 ) - 
b_Q14
 -

369 
	`sûk_SMULWB
–
°ªngth_Q16
, sûk_SMULWB–
	`SILK_FIX_CONST
–0.6, 16 ), 
b_Q14
 ) ), 16 );

370 
psEncCål
->
LF_shp_Q14
[ 0 ] |(
›us_uöt16
)–
b_Q14
 - 
	`SILK_FIX_CONST
( 1.0, 14 ) );

371  
k
 = 1; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

372 
psEncCål
->
LF_shp_Q14
[ 
k
 ] =ÖsEncCtrl->LF_shp_Q14[ 0 ];

374 
Tût_Q16
 = -
	`SILK_FIX_CONST
–
HP_NOISE_COEF
, 16 );

380 if–
USE_HARM_SHAPING
 && 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

382 
H¨mSh≠eGaö_Q16
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–
HARMONIC_SHAPING
, 16 ),

383 
	`SILK_FIX_CONST
–1.0, 16 ) - 
	`sûk_SMULWB
–SILK_FIX_CONST–1.0, 18 ) - 
	`sûk_LSHIFT
–
psEncCål
->
codög_quÆôy_Q14
, 4 ),

384 
psEncCål
->
öput_quÆôy_Q14
 ), 
	`SILK_FIX_CONST
–
HIGH_RATE_OR_LOW_QUALITY_HARMONIC_SHAPING
, 16 ) );

387 
H¨mSh≠eGaö_Q16
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
( HarmShapeGain_Q16, 1 ),

388 
	`sûk_SQRT_APPROX
–
	`sûk_LSHIFT
–
psEnc
->
LTPC‹r_Q15
, 15 ) ) );

390 
H¨mSh≠eGaö_Q16
 = 0;

396  
k
 = 0; k < 
MAX_NB_SUBFR
; k++ ) {

397 
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
 =

398 
	`sûk_SMLAWB
–
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
, 
H¨mSh≠eGaö_Q16
 -ÖsSh≠eSt->H¨mSh≠eGaö_smth_Q16, 
	`SILK_FIX_CONST
–
SUBFR_SMTH_COEF
, 16 ) );

399 
psSh≠eSt
->
Tût_smth_Q16
 =

400 
	`sûk_SMLAWB
–
psSh≠eSt
->
Tût_smth_Q16
, 
Tût_Q16
 -ÖsSh≠eSt->Tût_smth_Q16, 
	`SILK_FIX_CONST
–
SUBFR_SMTH_COEF
, 16 ) );

402 
psEncCål
->
H¨mSh≠eGaö_Q14
[ 
k
 ] = ( 
›us_öt
 )
	`sûk_RSHIFT_ROUND
–
psSh≠eSt
->
H¨mSh≠eGaö_smth_Q16
, 2 );

403 
psEncCål
->
Tût_Q14
[ 
k
 ] = ( 
›us_öt
 )
	`sûk_RSHIFT_ROUND
–
psSh≠eSt
->
Tût_smth_Q16
, 2 );

405 
RESTORE_STACK
;

406 
	}
}

	@silk/fixed/pitch_analysis_core_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

35 
	~"SigProc_FIX.h
"

36 
	~"pôch_e°_deföes.h
"

37 
	~"°ack_Æloc.h
"

38 
	~"debug.h
"

39 
	~"pôch.h
"

41 
	#SCRATCH_SIZE
 22

	)

42 
	#SF_LENGTH_4KHZ
 ( 
PE_SUBFR_LENGTH_MS
 * 4 )

	)

43 
	#SF_LENGTH_8KHZ
 ( 
PE_SUBFR_LENGTH_MS
 * 8 )

	)

44 
	#MIN_LAG_4KHZ
 ( 
PE_MIN_LAG_MS
 * 4 )

	)

45 
	#MIN_LAG_8KHZ
 ( 
PE_MIN_LAG_MS
 * 8 )

	)

46 
	#MAX_LAG_4KHZ
 ( 
PE_MAX_LAG_MS
 * 4 )

	)

47 
	#MAX_LAG_8KHZ
 ( 
PE_MAX_LAG_MS
 * 8 - 1 )

	)

48 
	#CSTRIDE_4KHZ
 ( 
MAX_LAG_4KHZ
 + 1 - 
MIN_LAG_4KHZ
 )

	)

49 
	#CSTRIDE_8KHZ
 ( 
MAX_LAG_8KHZ
 + 3 - ( 
MIN_LAG_8KHZ
 - 2 ) )

	)

50 
	#D_COMP_MIN
 ( 
MIN_LAG_8KHZ
 - 3 )

	)

51 
	#D_COMP_MAX
 ( 
MAX_LAG_8KHZ
 + 4 )

	)

52 
	#D_COMP_STRIDE
 ( 
D_COMP_MAX
 - 
D_COMP_MIN
 )

	)

54 
›us_öt32
 
	tsûk_≥_°age3_vÆs
[ 
PE_NB_STAGE3_LAGS
 ];

59 
sûk_P_A«_ˇlc_c‹r_°3
(

60 
sûk_≥_°age3_vÆs
 
¸oss_c‹r_°3
[],

61 c⁄° 
›us_öt16
 
‰ame
[],

62 
›us_öt
 
°¨t_œg
,

63 
›us_öt
 
sf_Àngth
,

64 
›us_öt
 
nb_sub‰
,

65 
›us_öt
 
com∂exôy
,

66 
¨ch


69 
sûk_P_A«_ˇlc_íîgy_°3
(

70 
sûk_≥_°age3_vÆs
 
íîgõs_°3
[],

71 c⁄° 
›us_öt16
 
‰ame
[],

72 
›us_öt
 
°¨t_œg
,

73 
›us_öt
 
sf_Àngth
,

74 
›us_öt
 
nb_sub‰
,

75 
›us_öt
 
com∂exôy
,

76 
¨ch


82 
›us_öt
 
	$sûk_pôch_™Æysis_c‹e
(

83 c⁄° 
›us_öt16
 *
‰ame_unsˇÀd
,

84 
›us_öt
 *
pôch_out
,

85 
›us_öt16
 *
œgIndex
,

86 
›us_öt8
 *
c⁄tourIndex
,

87 
›us_öt
 *
LTPC‹r_Q15
,

88 
›us_öt
 
¥evLag
,

89 c⁄° 
›us_öt32
 
£¨ch_thªs1_Q16
,

90 c⁄° 
›us_öt
 
£¨ch_thªs2_Q13
,

91 c⁄° 
›us_öt
 
Fs_kHz
,

92 c⁄° 
›us_öt
 
com∂exôy
,

93 c⁄° 
›us_öt
 
nb_sub‰
,

94 
¨ch


97 
	`VARDECL
–
›us_öt16
, 
‰ame_8kHz_buf
 );

98 
	`VARDECL
–
›us_öt16
, 
‰ame_4kHz
 );

99 
	`VARDECL
–
›us_öt16
, 
‰ame_sˇÀd
 );

100 
›us_öt32
 
fût_°©e
[ 6 ];

101 c⁄° 
›us_öt16
 *
‰ame
, *
‰ame_8kHz
;

102 
›us_öt
 
i
, 
k
, 
d
, 
j
;

103 
	`VARDECL
–
›us_öt16
, 
C
 );

104 
	`VARDECL
–
›us_öt32
, 
xc‹r32
 );

105 c⁄° 
›us_öt16
 *
èrgë_±r
, *
basis_±r
;

106 
›us_öt32
 
¸oss_c‹r
, 
n‹mÆizî
, 
íîgy
, 
íîgy_basis
, 
íîgy_èrgë
;

107 
›us_öt
 
d_§ch
[ 
PE_D_SRCH_LENGTH
 ], 
Cmax
, 
Àngth_d_§ch
, 
Àngth_d_comp
, 
shi·
;

108 
	`VARDECL
–
›us_öt16
, 
d_comp
 );

109 
›us_öt32
 
sum
, 
thªshﬁd
, 
œg_cou¡î
;

110 
›us_öt
 
CBimax
, 
CBimax_√w
, 
CBimax_ﬁd
, 
œg
, 
°¨t_œg
, 
íd_œg
, 
œg_√w
;

111 
›us_öt32
 
CC
[ 
PE_NB_CBKS_STAGE2_EXT
 ], 
CCmax
, 
CCmax_b
, 
CCmax_√w_b
, 
CCmax_√w
;

112 
	`VARDECL
–
sûk_≥_°age3_vÆs
, 
íîgõs_°3
 );

113 
	`VARDECL
–
sûk_≥_°age3_vÆs
, 
¸oss_c‹r_°3
 );

114 
›us_öt
 
‰ame_Àngth
, 
‰ame_Àngth_8kHz
, 
‰ame_Àngth_4kHz
;

115 
›us_öt
 
sf_Àngth
;

116 
›us_öt
 
mö_œg
;

117 
›us_öt
 
max_œg
;

118 
›us_öt32
 
c⁄tour_büs_Q15
, 
diff
;

119 
›us_öt
 
nb_cbk_£¨ch
, 
cbk_size
;

120 
›us_öt32
 
dñè_œg_log2_sqr_Q7
, 
œg_log2_Q7
, 
¥evLag_log2_Q7
, 
¥ev_œg_büs_Q13
;

121 c⁄° 
›us_öt8
 *
Lag_CB_±r
;

122 
SAVE_STACK
;

125 
	`˚…_as£π
–
Fs_kHz
 == 8 || Fs_kHz == 12 || Fs_kHz == 16 );

128 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

129 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

131 
	`sûk_as£π
–
£¨ch_thªs1_Q16
 >= 0 && search_thres1_Q16 <= (1<<16) );

132 
	`sûk_as£π
–
£¨ch_thªs2_Q13
 >= 0 && search_thres2_Q13 <= (1<<13) );

135 
‰ame_Àngth
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 
Fs_kHz
;

136 
‰ame_Àngth_4kHz
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 4;

137 
‰ame_Àngth_8kHz
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 8;

138 
sf_Àngth
 = 
PE_SUBFR_LENGTH_MS
 * 
Fs_kHz
;

139 
mö_œg
 = 
PE_MIN_LAG_MS
 * 
Fs_kHz
;

140 
max_œg
 = 
PE_MAX_LAG_MS
 * 
Fs_kHz
 - 1;

143 
	`sûk_sum_sqr_shi·
–&
íîgy
, &
shi·
, 
‰ame_unsˇÀd
, 
‰ame_Àngth
 );

144 
shi·
 +3 - 
	`sûk_CLZ32
–
íîgy
 );

145 
	`ALLOC
–
‰ame_sˇÀd
, 
‰ame_Àngth
, 
›us_öt16
 );

146 if–
shi·
 > 0 ) {

147 
shi·
 = 
	`sûk_RSHIFT
( shift + 1, 1 );

148  
i
 = 0; i < 
‰ame_Àngth
; i++ ) {

149 
‰ame_sˇÀd
[ 
i
 ] = 
	`sûk_RSHIFT
–
‰ame_unsˇÀd
[ i ], 
shi·
 );

151 
‰ame
 = 
‰ame_sˇÀd
;

153 
‰ame
 = 
‰ame_unsˇÀd
;

156 
	`ALLOC
–
‰ame_8kHz_buf
, ( 
Fs_kHz
 =8 ) ? 1 : 
‰ame_Àngth_8kHz
, 
›us_öt16
 );

158 if–
Fs_kHz
 == 16 ) {

159 
	`sûk_mem£t
–
fût_°©e
, 0, 2 * –
›us_öt32
 ) );

160 
	`sûk_ªßm∂î_down2
–
fût_°©e
, 
‰ame_8kHz_buf
, 
‰ame
, 
‰ame_Àngth
 );

161 
‰ame_8kHz
 = 
‰ame_8kHz_buf
;

162 } if–
Fs_kHz
 == 12 ) {

163 
	`sûk_mem£t
–
fût_°©e
, 0, 6 * –
›us_öt32
 ) );

164 
	`sûk_ªßm∂î_down2_3
–
fût_°©e
, 
‰ame_8kHz_buf
, 
‰ame
, 
‰ame_Àngth
 );

165 
‰ame_8kHz
 = 
‰ame_8kHz_buf
;

167 
	`˚…_as£π
–
Fs_kHz
 == 8 );

168 
‰ame_8kHz
 = 
‰ame
;

172 
	`sûk_mem£t
–
fût_°©e
, 0, 2 * –
›us_öt32
 ) );

173 
	`ALLOC
–
‰ame_4kHz
, 
‰ame_Àngth_4kHz
, 
›us_öt16
 );

174 
	`sûk_ªßm∂î_down2
–
fût_°©e
, 
‰ame_4kHz
, 
‰ame_8kHz
, 
‰ame_Àngth_8kHz
 );

177  
i
 = 
‰ame_Àngth_4kHz
 - 1; i > 0; i-- ) {

178 
‰ame_4kHz
[ 
i
 ] = 
	`sûk_ADD_SAT16
( frame_4kHz[ i ], frame_4kHz[ i - 1 ] );

185 
	`ALLOC
–
C
, 
nb_sub‰
 * 
CSTRIDE_8KHZ
, 
›us_öt16
 );

186 
	`ALLOC
–
xc‹r32
, 
MAX_LAG_4KHZ
-
MIN_LAG_4KHZ
+1, 
›us_öt32
 );

187 
	`sûk_mem£t
–
C
, 0, (
nb_sub‰
 >> 1Ë* 
CSTRIDE_4KHZ
 * –
›us_öt16
 ) );

188 
èrgë_±r
 = &
‰ame_4kHz
[ 
	`sûk_LSHIFT
–
SF_LENGTH_4KHZ
, 2 ) ];

189  
k
 = 0; k < 
nb_sub‰
 >> 1; k++ ) {

191 
	`˚…_as£π
–
èrgë_±r
 >
‰ame_4kHz
 );

192 
	`˚…_as£π
–
èrgë_±r
 + 
SF_LENGTH_8KHZ
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

194 
basis_±r
 = 
èrgë_±r
 - 
MIN_LAG_4KHZ
;

197 
	`˚…_as£π
–
basis_±r
 >
‰ame_4kHz
 );

198 
	`˚…_as£π
–
basis_±r
 + 
SF_LENGTH_8KHZ
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

200 
	`˚…_pôch_xc‹r
–
èrgë_±r
,Å¨gë_±∏- 
MAX_LAG_4KHZ
, 
xc‹r32
, 
SF_LENGTH_8KHZ
, MAX_LAG_4KHZ - 
MIN_LAG_4KHZ
 + 1, 
¨ch
 );

203 
¸oss_c‹r
 = 
xc‹r32
[ 
MAX_LAG_4KHZ
 - 
MIN_LAG_4KHZ
 ];

204 
n‹mÆizî
 = 
	`sûk_ö√r_¥od_Æig√d
–
èrgë_±r
,Å¨gë_±r, 
SF_LENGTH_8KHZ
, 
¨ch
 );

205 
n‹mÆizî
 = 
	`sûk_ADD32
–n‹mÆizî, 
	`sûk_ö√r_¥od_Æig√d
–
basis_±r
, basis_±r, 
SF_LENGTH_8KHZ
, 
¨ch
 ) );

206 
n‹mÆizî
 = 
	`sûk_ADD32
–n‹mÆizî, 
	`sûk_SMULBB
–
SF_LENGTH_8KHZ
, 4000 ) );

208 
	`m©rix_±r
–
C
, 
k
, 0, 
CSTRIDE_4KHZ
 ) =

209 (
›us_öt16
)
	`sûk_DIV32_v¨Q
–
¸oss_c‹r
, 
n‹mÆizî
, 13 + 1 );

212  
d
 = 
MIN_LAG_4KHZ
 + 1; d <
MAX_LAG_4KHZ
; d++ ) {

213 
basis_±r
--;

216 
	`sûk_as£π
–
basis_±r
 >
‰ame_4kHz
 );

217 
	`sûk_as£π
–
basis_±r
 + 
SF_LENGTH_8KHZ
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

219 
¸oss_c‹r
 = 
xc‹r32
[ 
MAX_LAG_4KHZ
 - 
d
 ];

222 
n‹mÆizî
 = 
	`sûk_ADD32
(Çormalizer,

223 
	`sûk_SMULBB
–
basis_±r
[ 0 ], basis_ptr[ 0 ] ) -

224 
	`sûk_SMULBB
–
basis_±r
[ 
SF_LENGTH_8KHZ
 ], basis_ptr[ SF_LENGTH_8KHZ ] ) );

226 
	`m©rix_±r
–
C
, 
k
, 
d
 - 
MIN_LAG_4KHZ
, 
CSTRIDE_4KHZ
) =

227 (
›us_öt16
)
	`sûk_DIV32_v¨Q
–
¸oss_c‹r
, 
n‹mÆizî
, 13 + 1 );

230 
èrgë_±r
 +
SF_LENGTH_8KHZ
;

234 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

235  
i
 = 
MAX_LAG_4KHZ
; i >
MIN_LAG_4KHZ
; i-- ) {

236 
sum
 = (
›us_öt32
)
	`m©rix_±r
–
C
, 0, 
i
 - 
MIN_LAG_4KHZ
, 
CSTRIDE_4KHZ
 )

237 + (
›us_öt32
)
	`m©rix_±r
–
C
, 1, 
i
 - 
MIN_LAG_4KHZ
, 
CSTRIDE_4KHZ
 );

238 
sum
 = 
	`sûk_SMLAWB
–sum, sum, 
	`sûk_LSHIFT
–-
i
, 4 ) );

239 
C
[ 
i
 - 
MIN_LAG_4KHZ
 ] = (
›us_öt16
)
sum
;

243  
i
 = 
MAX_LAG_4KHZ
; i >
MIN_LAG_4KHZ
; i-- ) {

244 
sum
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
C
[ 
i
 - 
MIN_LAG_4KHZ
 ], 1 );

245 
sum
 = 
	`sûk_SMLAWB
–sum, sum, 
	`sûk_LSHIFT
–-
i
, 4 ) );

246 
C
[ 
i
 - 
MIN_LAG_4KHZ
 ] = (
›us_öt16
)
sum
;

251 
Àngth_d_§ch
 = 
	`sûk_ADD_LSHIFT32
–4, 
com∂exôy
, 1 );

252 
	`˚…_as£π
–3 * 
Àngth_d_§ch
 <
PE_D_SRCH_LENGTH
 );

253 
	`sûk_ö£πi⁄_s‹t_de¸ósög_öt16
–
C
, 
d_§ch
, 
CSTRIDE_4KHZ
,

254 
Àngth_d_§ch
 );

257 
Cmax
 = (
›us_öt
)
C
[ 0 ];

258 if–
Cmax
 < 
	`SILK_FIX_CONST
( 0.2, 14 ) ) {

259 
	`sûk_mem£t
–
pôch_out
, 0, 
nb_sub‰
 * –
›us_öt
 ) );

260 *
LTPC‹r_Q15
 = 0;

261 *
œgIndex
 = 0;

262 *
c⁄tourIndex
 = 0;

263 
RESTORE_STACK
;

267 
thªshﬁd
 = 
	`sûk_SMULWB
–
£¨ch_thªs1_Q16
, 
Cmax
 );

268  
i
 = 0; i < 
Àngth_d_§ch
; i++ ) {

270 if–
C
[ 
i
 ] > 
thªshﬁd
 ) {

271 
d_§ch
[ 
i
 ] = 
	`sûk_LSHIFT
–d_§ch[ i ] + 
MIN_LAG_4KHZ
, 1 );

273 
Àngth_d_§ch
 = 
i
;

277 
	`˚…_as£π
–
Àngth_d_§ch
 > 0 );

279 
	`ALLOC
–
d_comp
, 
D_COMP_STRIDE
, 
›us_öt16
 );

280  
i
 = 
D_COMP_MIN
; i < 
D_COMP_MAX
; i++ ) {

281 
d_comp
[ 
i
 - 
D_COMP_MIN
 ] = 0;

283  
i
 = 0; i < 
Àngth_d_§ch
; i++ ) {

284 
d_comp
[ 
d_§ch
[ 
i
 ] - 
D_COMP_MIN
 ] = 1;

288  
i
 = 
D_COMP_MAX
 - 1; i >
MIN_LAG_8KHZ
; i-- ) {

289 
d_comp
[ 
i
 - 
D_COMP_MIN
 ] +=

290 
d_comp
[ 
i
 - 1 - 
D_COMP_MIN
 ] + d_comp[ i - 2 - D_COMP_MIN ];

293 
Àngth_d_§ch
 = 0;

294  
i
 = 
MIN_LAG_8KHZ
; i < 
MAX_LAG_8KHZ
 + 1; i++ ) {

295 if–
d_comp
[ 
i
 + 1 - 
D_COMP_MIN
 ] > 0 ) {

296 
d_§ch
[ 
Àngth_d_§ch
 ] = 
i
;

297 
Àngth_d_§ch
++;

302  
i
 = 
D_COMP_MAX
 - 1; i >
MIN_LAG_8KHZ
; i-- ) {

303 
d_comp
[ 
i
 - 
D_COMP_MIN
 ] += d_comp[ i - 1 - D_COMP_MIN ]

304 + 
d_comp
[ 
i
 - 2 - 
D_COMP_MIN
 ] + d_comp[ i - 3 - D_COMP_MIN ];

307 
Àngth_d_comp
 = 0;

308  
i
 = 
MIN_LAG_8KHZ
; i < 
D_COMP_MAX
; i++ ) {

309 if–
d_comp
[ 
i
 - 
D_COMP_MIN
 ] > 0 ) {

310 
d_comp
[ 
Àngth_d_comp
 ] = 
i
 - 2;

311 
Àngth_d_comp
++;

322 
	`sûk_mem£t
–
C
, 0, 
nb_sub‰
 * 
CSTRIDE_8KHZ
 * –
›us_öt16
 ) );

324 
èrgë_±r
 = &
‰ame_8kHz
[ 
PE_LTP_MEM_LENGTH_MS
 * 8 ];

325  
k
 = 0; k < 
nb_sub‰
; k++ ) {

328 
	`˚…_as£π
–
èrgë_±r
 >
‰ame_8kHz
 );

329 
	`˚…_as£π
–
èrgë_±r
 + 
SF_LENGTH_8KHZ
 <
‰ame_8kHz
 + 
‰ame_Àngth_8kHz
 );

331 
íîgy_èrgë
 = 
	`sûk_ADD32
–
	`sûk_ö√r_¥od_Æig√d
–
èrgë_±r
,Å¨gë_±r, 
SF_LENGTH_8KHZ
, 
¨ch
 ), 1 );

332  
j
 = 0; j < 
Àngth_d_comp
; j++ ) {

333 
d
 = 
d_comp
[ 
j
 ];

334 
basis_±r
 = 
èrgë_±r
 - 
d
;

337 
	`sûk_as£π
–
basis_±r
 >
‰ame_8kHz
 );

338 
	`sûk_as£π
–
basis_±r
 + 
SF_LENGTH_8KHZ
 <
‰ame_8kHz
 + 
‰ame_Àngth_8kHz
 );

340 
¸oss_c‹r
 = 
	`sûk_ö√r_¥od_Æig√d
–
èrgë_±r
, 
basis_±r
, 
SF_LENGTH_8KHZ
, 
¨ch
 );

341 if–
¸oss_c‹r
 > 0 ) {

342 
íîgy_basis
 = 
	`sûk_ö√r_¥od_Æig√d
–
basis_±r
, basis_±r, 
SF_LENGTH_8KHZ
, 
¨ch
 );

343 
	`m©rix_±r
–
C
, 
k
, 
d
 - ( 
MIN_LAG_8KHZ
 - 2 ), 
CSTRIDE_8KHZ
 ) =

344 (
›us_öt16
)
	`sûk_DIV32_v¨Q
–
¸oss_c‹r
,

345 
	`sûk_ADD32
–
íîgy_èrgë
,

346 
íîgy_basis
 ),

349 
	`m©rix_±r
–
C
, 
k
, 
d
 - ( 
MIN_LAG_8KHZ
 - 2 ), 
CSTRIDE_8KHZ
 ) = 0;

352 
èrgë_±r
 +
SF_LENGTH_8KHZ
;

358 
CCmax
 = 
sûk_öt32_MIN
;

359 
CCmax_b
 = 
sûk_öt32_MIN
;

361 
CBimax
 = 0;

362 
œg
 = -1;

364 if–
¥evLag
 > 0 ) {

365 if–
Fs_kHz
 == 12 ) {

366 
¥evLag
 = 
	`sûk_DIV32_16
–
	`sûk_LSHIFT
(ÖrevLag, 1 ), 3 );

367 } if–
Fs_kHz
 == 16 ) {

368 
¥evLag
 = 
	`sûk_RSHIFT
(ÖrevLag, 1 );

370 
¥evLag_log2_Q7
 = 
	`sûk_lö2log
–(
›us_öt32
)
¥evLag
 );

372 
¥evLag_log2_Q7
 = 0;

374 
	`sûk_as£π
–
£¨ch_thªs2_Q13
 =
	`sûk_SAT16
( search_thres2_Q13 ) );

376 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

377 
cbk_size
 = 
PE_NB_CBKS_STAGE2_EXT
;

378 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2
[ 0 ][ 0 ];

379 if–
Fs_kHz
 =8 && 
com∂exôy
 > 
SILK_PE_MIN_COMPLEX
 ) {

381 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2_EXT
;

383 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2
;

386 
cbk_size
 = 
PE_NB_CBKS_STAGE2_10MS
;

387 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2_10_ms
[ 0 ][ 0 ];

388 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2_10MS
;

391  
k
 = 0; k < 
Àngth_d_§ch
; k++ ) {

392 
d
 = 
d_§ch
[ 
k
 ];

393  
j
 = 0; j < 
nb_cbk_£¨ch
; j++ ) {

394 
CC
[ 
j
 ] = 0;

395  
i
 = 0; i < 
nb_sub‰
; i++ ) {

396 
›us_öt
 
d_sub‰
;

398 
d_sub‰
 = 
d
 + 
	`m©rix_±r
–
Lag_CB_±r
, 
i
, 
j
, 
cbk_size
 );

399 
CC
[ 
j
 ] = CC[ j ]

400 + (
›us_öt32
)
	`m©rix_±r
–
C
, 
i
,

401 
d_sub‰
 - ( 
MIN_LAG_8KHZ
 - 2 ),

402 
CSTRIDE_8KHZ
 );

406 
CCmax_√w
 = 
sûk_öt32_MIN
;

407 
CBimax_√w
 = 0;

408  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

409 if–
CC
[ 
i
 ] > 
CCmax_√w
 ) {

410 
CCmax_√w
 = 
CC
[ 
i
 ];

411 
CBimax_√w
 = 
i
;

416 
œg_log2_Q7
 = 
	`sûk_lö2log
–
d
 );

417 
	`sûk_as£π
–
œg_log2_Q7
 =
	`sûk_SAT16
(Üag_log2_Q7 ) );

418 
	`sûk_as£π
–
nb_sub‰
 * 
	`SILK_FIX_CONST
–
PE_SHORTLAG_BIAS
, 13 ) =
	`sûk_SAT16
(Çb_subfr * SILK_FIX_CONST( PE_SHORTLAG_BIAS, 13 ) ) );

419 
CCmax_√w_b
 = 
CCmax_√w
 - 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
nb_sub‰
 * 
	`SILK_FIX_CONST
–
PE_SHORTLAG_BIAS
, 13 ), 
œg_log2_Q7
 ), 7 );

422 
	`sûk_as£π
–
nb_sub‰
 * 
	`SILK_FIX_CONST
–
PE_PREVLAG_BIAS
, 13 ) =
	`sûk_SAT16
(Çb_subfr * SILK_FIX_CONST( PE_PREVLAG_BIAS, 13 ) ) );

423 if–
¥evLag
 > 0 ) {

424 
dñè_œg_log2_sqr_Q7
 = 
œg_log2_Q7
 - 
¥evLag_log2_Q7
;

425 
	`sûk_as£π
–
dñè_œg_log2_sqr_Q7
 =
	`sûk_SAT16
( delta_lag_log2_sqr_Q7 ) );

426 
dñè_œg_log2_sqr_Q7
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
( delta_lag_log2_sqr_Q7, delta_lag_log2_sqr_Q7 ), 7 );

427 
¥ev_œg_büs_Q13
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
nb_sub‰
 * 
	`SILK_FIX_CONST
–
PE_PREVLAG_BIAS
, 13 ), *
LTPC‹r_Q15
 ), 15 );

428 
¥ev_œg_büs_Q13
 = 
	`sûk_DIV32
–
	`sûk_MUL
–¥ev_œg_büs_Q13, 
dñè_œg_log2_sqr_Q7
 ), dñè_œg_log2_sqr_Q7 + 
	`SILK_FIX_CONST
( 0.5, 7 ) );

429 
CCmax_√w_b
 -
¥ev_œg_büs_Q13
;

432 if–
CCmax_√w_b
 > 
CCmax_b
 &&

433 
CCmax_√w
 > 
	`sûk_SMULBB
–
nb_sub‰
, 
£¨ch_thªs2_Q13
 ) &&

434 
sûk_CB_œgs_°age2
[ 0 ][ 
CBimax_√w
 ] <
MIN_LAG_8KHZ


436 
CCmax_b
 = 
CCmax_√w_b
;

437 
CCmax
 = 
CCmax_√w
;

438 
œg
 = 
d
;

439 
CBimax
 = 
CBimax_√w
;

443 if–
œg
 == -1 ) {

445 
	`sûk_mem£t
–
pôch_out
, 0, 
nb_sub‰
 * –
›us_öt
 ) );

446 *
LTPC‹r_Q15
 = 0;

447 *
œgIndex
 = 0;

448 *
c⁄tourIndex
 = 0;

449 
RESTORE_STACK
;

454 *
LTPC‹r_Q15
 = (
›us_öt
)
	`sûk_LSHIFT
–
	`sûk_DIV32_16
–
CCmax
, 
nb_sub‰
 ), 2 );

455 
	`sûk_as£π
–*
LTPC‹r_Q15
 >= 0 );

457 if–
Fs_kHz
 > 8 ) {

460 
CBimax_ﬁd
 = 
CBimax
;

462 
	`sûk_as£π
–
œg
 =
	`sûk_SAT16
(Üag ) );

463 if–
Fs_kHz
 == 12 ) {

464 
œg
 = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
(Üag, 3 ), 1 );

465 } if–
Fs_kHz
 == 16 ) {

466 
œg
 = 
	`sûk_LSHIFT
(Üag, 1 );

468 
œg
 = 
	`sûk_SMULBB
(Üag, 3 );

471 
œg
 = 
	`sûk_LIMIT_öt
–œg, 
mö_œg
, 
max_œg
 );

472 
°¨t_œg
 = 
	`sûk_max_öt
–
œg
 - 2, 
mö_œg
 );

473 
íd_œg
 = 
	`sûk_mö_öt
–
œg
 + 2, 
max_œg
 );

474 
œg_√w
 = 
œg
;

475 
CBimax
 = 0;

477 
CCmax
 = 
sûk_öt32_MIN
;

479  
k
 = 0; k < 
nb_sub‰
; k++ ) {

480 
pôch_out
[ 
k
 ] = 
œg
 + 2 * 
sûk_CB_œgs_°age2
[ k ][ 
CBimax_ﬁd
 ];

484 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

485 
nb_cbk_£¨ch
 = (
›us_öt
)
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

486 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

487 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

489 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

490 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

491 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

495 
	`ALLOC
–
íîgõs_°3
, 
nb_sub‰
 * 
nb_cbk_£¨ch
, 
sûk_≥_°age3_vÆs
 );

496 
	`ALLOC
–
¸oss_c‹r_°3
, 
nb_sub‰
 * 
nb_cbk_£¨ch
, 
sûk_≥_°age3_vÆs
 );

497 
	`sûk_P_A«_ˇlc_c‹r_°3
–
¸oss_c‹r_°3
, 
‰ame
, 
°¨t_œg
, 
sf_Àngth
, 
nb_sub‰
, 
com∂exôy
, 
¨ch
 );

498 
	`sûk_P_A«_ˇlc_íîgy_°3
–
íîgõs_°3
, 
‰ame
, 
°¨t_œg
, 
sf_Àngth
, 
nb_sub‰
, 
com∂exôy
, 
¨ch
 );

500 
œg_cou¡î
 = 0;

501 
	`sûk_as£π
–
œg
 =
	`sûk_SAT16
(Üag ) );

502 
c⁄tour_büs_Q15
 = 
	`sûk_DIV32_16
–
	`SILK_FIX_CONST
–
PE_FLATCONTOUR_BIAS
, 15 ), 
œg
 );

504 
èrgë_±r
 = &
‰ame
[ 
PE_LTP_MEM_LENGTH_MS
 * 
Fs_kHz
 ];

505 
íîgy_èrgë
 = 
	`sûk_ADD32
–
	`sûk_ö√r_¥od_Æig√d
–
èrgë_±r
,Å¨gë_±r, 
nb_sub‰
 * 
sf_Àngth
, 
¨ch
 ), 1 );

506  
d
 = 
°¨t_œg
; d <
íd_œg
; d++ ) {

507  
j
 = 0; j < 
nb_cbk_£¨ch
; j++ ) {

508 
¸oss_c‹r
 = 0;

509 
íîgy
 = 
íîgy_èrgë
;

510  
k
 = 0; k < 
nb_sub‰
; k++ ) {

511 
¸oss_c‹r
 = 
	`sûk_ADD32
( cross_corr,

512 
	`m©rix_±r
–
¸oss_c‹r_°3
, 
k
, 
j
,

513 
nb_cbk_£¨ch
 )[ 
œg_cou¡î
 ] );

514 
íîgy
 = 
	`sûk_ADD32
(Énergy,

515 
	`m©rix_±r
–
íîgõs_°3
, 
k
, 
j
,

516 
nb_cbk_£¨ch
 )[ 
œg_cou¡î
 ] );

517 
	`sûk_as£π
–
íîgy
 >= 0 );

519 if–
¸oss_c‹r
 > 0 ) {

520 
CCmax_√w
 = 
	`sûk_DIV32_v¨Q
–
¸oss_c‹r
, 
íîgy
, 13 + 1 );

522 
diff
 = 
sûk_öt16_MAX
 - 
	`sûk_MUL
–
c⁄tour_büs_Q15
, 
j
 );

523 
	`sûk_as£π
–
diff
 =
	`sûk_SAT16
( diff ) );

524 
CCmax_√w
 = 
	`sûk_SMULWB
–CCmax_√w, 
diff
 );

526 
CCmax_√w
 = 0;

529 if–
CCmax_√w
 > 
CCmax
 && ( 
d
 + 
sûk_CB_œgs_°age3
[ 0 ][ 
j
 ] ) <
max_œg
 ) {

530 
CCmax
 = 
CCmax_√w
;

531 
œg_√w
 = 
d
;

532 
CBimax
 = 
j
;

535 
œg_cou¡î
++;

538  
k
 = 0; k < 
nb_sub‰
; k++ ) {

539 
pôch_out
[ 
k
 ] = 
œg_√w
 + 
	`m©rix_±r
–
Lag_CB_±r
, k, 
CBimax
, 
cbk_size
 );

540 
pôch_out
[ 
k
 ] = 
	`sûk_LIMIT
–pôch_out[ k ], 
mö_œg
, 
PE_MAX_LAG_MS
 * 
Fs_kHz
 );

542 *
œgIndex
 = (
›us_öt16
)–
œg_√w
 - 
mö_œg
);

543 *
c⁄tourIndex
 = (
›us_öt8
)
CBimax
;

546  
k
 = 0; k < 
nb_sub‰
; k++ ) {

547 
pôch_out
[ 
k
 ] = 
œg
 + 
	`m©rix_±r
–
Lag_CB_±r
, k, 
CBimax
, 
cbk_size
 );

548 
pôch_out
[ 
k
 ] = 
	`sûk_LIMIT
–pôch_out[ k ], 
MIN_LAG_8KHZ
, 
PE_MAX_LAG_MS
 * 8 );

550 *
œgIndex
 = (
›us_öt16
)–
œg
 - 
MIN_LAG_8KHZ
 );

551 *
c⁄tourIndex
 = (
›us_öt8
)
CBimax
;

553 
	`˚…_as£π
–*
œgIndex
 >= 0 );

555 
RESTORE_STACK
;

557 
	}
}

572 
	$sûk_P_A«_ˇlc_c‹r_°3
(

573 
sûk_≥_°age3_vÆs
 
¸oss_c‹r_°3
[],

574 c⁄° 
›us_öt16
 
‰ame
[],

575 
›us_öt
 
°¨t_œg
,

576 
›us_öt
 
sf_Àngth
,

577 
›us_öt
 
nb_sub‰
,

578 
›us_öt
 
com∂exôy
,

579 
¨ch


582 c⁄° 
›us_öt16
 *
èrgë_±r
;

583 
›us_öt
 
i
, 
j
, 
k
, 
œg_cou¡î
, 
œg_low
, 
œg_high
;

584 
›us_öt
 
nb_cbk_£¨ch
, 
dñè
, 
idx
, 
cbk_size
;

585 
	`VARDECL
–
›us_öt32
, 
s¸©ch_mem
 );

586 
	`VARDECL
–
›us_öt32
, 
xc‹r32
 );

587 c⁄° 
›us_öt8
 *
Lag_ønge_±r
, *
Lag_CB_±r
;

588 
SAVE_STACK
;

590 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

591 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

593 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

594 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3
[ 
com∂exôy
 ][ 0 ][ 0 ];

595 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

596 
nb_cbk_£¨ch
 = 
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

597 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

599 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1);

600 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3_10_ms
[ 0 ][ 0 ];

601 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

602 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

603 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

605 
	`ALLOC
–
s¸©ch_mem
, 
SCRATCH_SIZE
, 
›us_öt32
 );

606 
	`ALLOC
–
xc‹r32
, 
SCRATCH_SIZE
, 
›us_öt32
 );

608 
èrgë_±r
 = &
‰ame
[ 
	`sûk_LSHIFT
–
sf_Àngth
, 2 ) ];

609  
k
 = 0; k < 
nb_sub‰
; k++ ) {

610 
œg_cou¡î
 = 0;

613 
œg_low
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

614 
œg_high
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 1, 2 );

615 
	`˚…_as£π
(
œg_high
-
œg_low
+1 <
SCRATCH_SIZE
);

616 
	`˚…_pôch_xc‹r
–
èrgë_±r
,Å¨gë_±∏- 
°¨t_œg
 - 
œg_high
, 
xc‹r32
, 
sf_Àngth
,Üag_high - 
œg_low
 + 1, 
¨ch
 );

617  
j
 = 
œg_low
; j <
œg_high
; j++ ) {

618 
	`sûk_as£π
–
œg_cou¡î
 < 
SCRATCH_SIZE
 );

619 
s¸©ch_mem
[ 
œg_cou¡î
 ] = 
xc‹r32
[ 
œg_high
 - 
j
 ];

620 
œg_cou¡î
++;

623 
dñè
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

624  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

627 
idx
 = 
	`m©rix_±r
–
Lag_CB_±r
, 
k
, 
i
, 
cbk_size
 ) - 
dñè
;

628  
j
 = 0; j < 
PE_NB_STAGE3_LAGS
; j++ ) {

629 
	`sûk_as£π
–
idx
 + 
j
 < 
SCRATCH_SIZE
 );

630 
	`sûk_as£π
–
idx
 + 
j
 < 
œg_cou¡î
 );

631 
	`m©rix_±r
–
¸oss_c‹r_°3
, 
k
, 
i
, 
nb_cbk_£¨ch
 )[ 
j
 ] =

632 
s¸©ch_mem
[ 
idx
 + 
j
 ];

635 
èrgë_±r
 +
sf_Àngth
;

637 
RESTORE_STACK
;

638 
	}
}

644 
	$sûk_P_A«_ˇlc_íîgy_°3
(

645 
sûk_≥_°age3_vÆs
 
íîgõs_°3
[],

646 c⁄° 
›us_öt16
 
‰ame
[],

647 
›us_öt
 
°¨t_œg
,

648 
›us_öt
 
sf_Àngth
,

649 
›us_öt
 
nb_sub‰
,

650 
›us_öt
 
com∂exôy
,

651 
¨ch


654 c⁄° 
›us_öt16
 *
èrgë_±r
, *
basis_±r
;

655 
›us_öt32
 
íîgy
;

656 
›us_öt
 
k
, 
i
, 
j
, 
œg_cou¡î
;

657 
›us_öt
 
nb_cbk_£¨ch
, 
dñè
, 
idx
, 
cbk_size
, 
œg_diff
;

658 
	`VARDECL
–
›us_öt32
, 
s¸©ch_mem
 );

659 c⁄° 
›us_öt8
 *
Lag_ønge_±r
, *
Lag_CB_±r
;

660 
SAVE_STACK
;

662 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

663 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

665 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

666 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3
[ 
com∂exôy
 ][ 0 ][ 0 ];

667 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

668 
nb_cbk_£¨ch
 = 
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

669 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

671 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1);

672 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3_10_ms
[ 0 ][ 0 ];

673 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

674 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

675 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

677 
	`ALLOC
–
s¸©ch_mem
, 
SCRATCH_SIZE
, 
›us_öt32
 );

679 
èrgë_±r
 = &
‰ame
[ 
	`sûk_LSHIFT
–
sf_Àngth
, 2 ) ];

680  
k
 = 0; k < 
nb_sub‰
; k++ ) {

681 
œg_cou¡î
 = 0;

684 
basis_±r
 = 
èrgë_±r
 - ( 
°¨t_œg
 + 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 ) );

685 
íîgy
 = 
	`sûk_ö√r_¥od_Æig√d
–
basis_±r
, basis_±r, 
sf_Àngth
, 
¨ch
 );

686 
	`sûk_as£π
–
íîgy
 >= 0 );

687 
s¸©ch_mem
[ 
œg_cou¡î
 ] = 
íîgy
;

688 
œg_cou¡î
++;

690 
œg_diff
 = ( 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 1, 2 ) - matrix_ptr( Lag_range_ptr, k, 0, 2 ) + 1 );

691  
i
 = 1; i < 
œg_diff
; i++ ) {

693 
íîgy
 -
	`sûk_SMULBB
–
basis_±r
[ 
sf_Àngth
 - 
i
 ], basis_ptr[ sf_length - i ] );

694 
	`sûk_as£π
–
íîgy
 >= 0 );

697 
íîgy
 = 
	`sûk_ADD_SAT32
–íîgy, 
	`sûk_SMULBB
–
basis_±r
[ -
i
 ], basis_ptr[ -i ] ) );

698 
	`sûk_as£π
–
íîgy
 >= 0 );

699 
	`sûk_as£π
–
œg_cou¡î
 < 
SCRATCH_SIZE
 );

700 
s¸©ch_mem
[ 
œg_cou¡î
 ] = 
íîgy
;

701 
œg_cou¡î
++;

704 
dñè
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

705  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

708 
idx
 = 
	`m©rix_±r
–
Lag_CB_±r
, 
k
, 
i
, 
cbk_size
 ) - 
dñè
;

709  
j
 = 0; j < 
PE_NB_STAGE3_LAGS
; j++ ) {

710 
	`sûk_as£π
–
idx
 + 
j
 < 
SCRATCH_SIZE
 );

711 
	`sûk_as£π
–
idx
 + 
j
 < 
œg_cou¡î
 );

712 
	`m©rix_±r
–
íîgõs_°3
, 
k
, 
i
, 
nb_cbk_£¨ch
 )[ 
j
 ] =

713 
s¸©ch_mem
[ 
idx
 + 
j
 ];

714 
	`sûk_as£π
(

715 
	`m©rix_±r
–
íîgõs_°3
, 
k
, 
i
, 
nb_cbk_£¨ch
 )[ 
j
 ] >= 0 );

718 
èrgë_±r
 +
sf_Àngth
;

720 
RESTORE_STACK
;

721 
	}
}

	@silk/fixed/process_gains_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"tunög_∑ømëîs.h
"

36 
	$sûk_¥o˚ss_gaös_FIX
(

37 
sûk_ícodî_°©e_FIX
 *
psEnc
,

38 
sûk_ícodî_c⁄åﬁ_FIX
 *
psEncCål
,

39 
›us_öt
 
c⁄dCodög


42 
sûk_sh≠e_°©e_FIX
 *
psSh≠eSt
 = &
psEnc
->
sSh≠e
;

43 
›us_öt
 
k
;

44 
›us_öt32
 
s_Q16
, 
InvMaxSqrVÆ_Q16
, 
gaö
, 
gaö_squ¨ed
, 
ResNrg
, 
ResNrgP¨t
, 
qu™t_off£t_Q10
;

47 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

49 
s_Q16
 = -
	`sûk_sigm_Q15
–
	`sûk_RSHIFT_ROUND
–
psEncCål
->
LTPªdCodGaö_Q7
 - 
	`SILK_FIX_CONST
( 12.0, 7 ), 4 ) );

50  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

51 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_SMLAWB
–psEncCål->Gaös_Q16[ k ],ÖsEncCål->Gaös_Q16[ k ], 
s_Q16
 );

57 
InvMaxSqrVÆ_Q16
 = 
	`sûk_DIV32_16
–
	`sûk_log2lö
(

58 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–21 + 16 / 0.33, 7 ) - 
psEnc
->
sCmn
.
SNR_dB_Q7
, SILK_FIX_CONST–0.33, 16 ) ) ),ÖsEnc->sCmn.
sub‰_Àngth
 );

60  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

62 
ResNrg
 = 
psEncCål
->ResNrg[ 
k
 ];

63 
ResNrgP¨t
 = 
	`sûk_SMULWW
–
ResNrg
, 
InvMaxSqrVÆ_Q16
 );

64 if–
psEncCål
->
ResNrgQ
[ 
k
 ] > 0 ) {

65 
ResNrgP¨t
 = 
	`sûk_RSHIFT_ROUND
–ResNrgP¨t, 
psEncCål
->
ResNrgQ
[ 
k
 ] );

67 if–
ResNrgP¨t
 >
	`sûk_RSHIFT
–
sûk_öt32_MAX
, -
psEncCål
->
ResNrgQ
[ 
k
 ] ) ) {

68 
ResNrgP¨t
 = 
sûk_öt32_MAX
;

70 
ResNrgP¨t
 = 
	`sûk_LSHIFT
–ResNrgP¨t, -
psEncCål
->
ResNrgQ
[ 
k
 ] );

73 
gaö
 = 
psEncCål
->
Gaös_Q16
[ 
k
 ];

74 
gaö_squ¨ed
 = 
	`sûk_ADD_SAT32
–
ResNrgP¨t
, 
	`sûk_SMMUL
–
gaö
, gain ) );

75 if–
gaö_squ¨ed
 < 
sûk_öt16_MAX
 ) {

77 
gaö_squ¨ed
 = 
	`sûk_SMLAWW
–
	`sûk_LSHIFT
–
ResNrgP¨t
, 16 ), 
gaö
, gain );

78 
	`sûk_as£π
–
gaö_squ¨ed
 > 0 );

79 
gaö
 = 
	`sûk_SQRT_APPROX
–
gaö_squ¨ed
 );

80 
gaö
 = 
	`sûk_mö
–gaö, 
sûk_öt32_MAX
 >> 8 );

81 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_LSHIFT_SAT32
–
gaö
, 8 );

83 
gaö
 = 
	`sûk_SQRT_APPROX
–
gaö_squ¨ed
 );

84 
gaö
 = 
	`sûk_mö
–gaö, 
sûk_öt32_MAX
 >> 16 );

85 
psEncCål
->
Gaös_Q16
[ 
k
 ] = 
	`sûk_LSHIFT_SAT32
–
gaö
, 16 );

90 
	`sûk_mem˝y
–
psEncCål
->
GaösUnq_Q16
,ÖsEncCål->
Gaös_Q16
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
›us_öt32
 ) );

91 
psEncCål
->
œ°GaöIndexPªv
 = 
psSh≠eSt
->
La°GaöIndex
;

94 
	`sûk_gaös_qu™t
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
, 
psEncCål
->
Gaös_Q16
,

95 &
psSh≠eSt
->
La°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
, 
psEnc
->
sCmn
.
nb_sub‰
 );

98 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

99 if–
psEncCål
->
LTPªdCodGaö_Q7
 + 
	`sûk_RSHIFT
–
psEnc
->
sCmn
.
öput_tût_Q15
, 8 ) > 
	`SILK_FIX_CONST
( 1.0, 7 ) ) {

100 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

102 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 1;

107 
qu™t_off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 >> 1 ][ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
 ];

108 
psEncCål
->
Lambda_Q10
 = 
	`SILK_FIX_CONST
–
LAMBDA_OFFSET
, 10 )

109 + 
	`sûk_SMULBB
–
	`SILK_FIX_CONST
–
LAMBDA_DELAYED_DECISIONS
, 10 ), 
psEnc
->
sCmn
.
nSèãsDñayedDecisi⁄
 )

110 + 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
LAMBDA_SPEECH_ACT
, 18 ), 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 )

111 + 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
LAMBDA_INPUT_QUALITY
, 12 ), 
psEncCål
->
öput_quÆôy_Q14
 )

112 + 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
LAMBDA_CODING_QUALITY
, 12 ), 
psEncCål
->
codög_quÆôy_Q14
 )

113 + 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–
LAMBDA_QUANT_OFFSET
, 16 ), 
qu™t_off£t_Q10
 );

115 
	`sûk_as£π
–
psEncCål
->
Lambda_Q10
 > 0 );

116 
	`sûk_as£π
–
psEncCål
->
Lambda_Q10
 < 
	`SILK_FIX_CONST
( 2, 10 ) );

117 
	}
}

	@silk/fixed/regularize_correlations_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

35 
	$sûk_ªguœrize_c‹ªœti⁄s_FIX
(

36 
›us_öt32
 *
XX
,

37 
›us_öt32
 *
xx
,

38 
›us_öt32
 
noi£
,

39 
›us_öt
 
D


42 
›us_öt
 
i
;

43  
i
 = 0; i < 
D
; i++ ) {

44 
	`m©rix_±r
–&
XX
[ 0 ], 
i
, i, 
D
 ) = 
	`sûk_ADD32
–m©rix_±r–&XX[ 0 ], i, i, D ), 
noi£
 );

46 
xx
[ 0 ] +
noi£
;

47 
	}
}

	@silk/fixed/residual_energy16_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

35 
›us_öt32
 
	$sûk_ªsiduÆ_íîgy16_cov¨_FIX
(

36 c⁄° 
›us_öt16
 *
c
,

37 c⁄° 
›us_öt32
 *
wXX
,

38 c⁄° 
›us_öt32
 *
wXx
,

39 
›us_öt32
 
wxx
,

40 
›us_öt
 
D
,

41 
›us_öt
 
cQ


44 
›us_öt
 
i
, 
j
, 
lshi·s
, 
Qxåa
;

45 
›us_öt32
 
c_max
, 
w_max
, 
tmp
, 
tmp2
, 
ƒg
;

46 
›us_öt
 
˙
[ 
MAX_MATRIX_SIZE
 ];

47 c⁄° 
›us_öt32
 *
pRow
;

50 
	`˚…_as£π
–
D
 >= 0 );

51 
	`˚…_as£π
–
D
 <= 16 );

52 
	`˚…_as£π
–
cQ
 > 0 );

53 
	`˚…_as£π
–
cQ
 < 16 );

55 
lshi·s
 = 16 - 
cQ
;

56 
Qxåa
 = 
lshi·s
;

58 
c_max
 = 0;

59  
i
 = 0; i < 
D
; i++ ) {

60 
c_max
 = 
	`sûk_max_32
–c_max, 
	`sûk_abs
–(
›us_öt32
)
c
[ 
i
 ] ) );

62 
Qxåa
 = 
	`sûk_mö_öt
–Qxåa, 
	`sûk_CLZ32
–
c_max
 ) - 17 );

64 
w_max
 = 
	`sûk_max_32
–
wXX
[ 0 ], wXX[ 
D
 * D - 1 ] );

65 
Qxåa
 = 
	`sûk_mö_öt
–Qxåa, 
	`sûk_CLZ32
–
	`sûk_MUL
–
D
, 
	`sûk_RSHIFT
–
	`sûk_SMULWB
–
w_max
, 
c_max
 ), 4 ) ) ) - 5 );

66 
Qxåa
 = 
	`sûk_max_öt
( Qxtra, 0 );

67  
i
 = 0; i < 
D
; i++ ) {

68 
˙
[ 
i
 ] = 
	`sûk_LSHIFT
––
›us_öt
 )
c
[ i ], 
Qxåa
 );

69 
	`sûk_as£π
–
	`sûk_abs
(
˙
[
i
]Ë<–
sûk_öt16_MAX
 + 1 ) );

71 
lshi·s
 -
Qxåa
;

74 
tmp
 = 0;

75  
i
 = 0; i < 
D
; i++ ) {

76 
tmp
 = 
	`sûk_SMLAWB
–tmp, 
wXx
[ 
i
 ], 
˙
[ i ] );

78 
ƒg
 = 
	`sûk_RSHIFT
–
wxx
, 1 + 
lshi·s
 ) - 
tmp
;

81 
tmp2
 = 0;

82  
i
 = 0; i < 
D
; i++ ) {

83 
tmp
 = 0;

84 
pRow
 = &
wXX
[ 
i
 * 
D
 ];

85  
j
 = 
i
 + 1; j < 
D
; j++ ) {

86 
tmp
 = 
	`sûk_SMLAWB
–tmp, 
pRow
[ 
j
 ], 
˙
[ j ] );

88 
tmp
 = 
	`sûk_SMLAWB
–tmp, 
	`sûk_RSHIFT
–
pRow
[ 
i
 ], 1 ), 
˙
[ i ] );

89 
tmp2
 = 
	`sûk_SMLAWB
–tmp2, 
tmp
, 
˙
[ 
i
 ] );

91 
ƒg
 = 
	`sûk_ADD_LSHIFT32
–ƒg, 
tmp2
, 
lshi·s
 );

94 if–
ƒg
 < 1 ) {

95 
ƒg
 = 1;

96 } if–
ƒg
 > 
	`sûk_RSHIFT
–
sûk_öt32_MAX
, 
lshi·s
 + 2 ) ) {

97 
ƒg
 = 
sûk_öt32_MAX
 >> 1;

99 
ƒg
 = 
	`sûk_LSHIFT
–ƒg, 
lshi·s
 + 1 );

101  
ƒg
;

103 
	}
}

	@silk/fixed/residual_energy_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

33 
	~"°ack_Æloc.h
"

37 
	$sûk_ªsiduÆ_íîgy_FIX
(

38 
›us_öt32
 
ƒgs
[ 
MAX_NB_SUBFR
 ],

39 
›us_öt
 
ƒgsQ
[ 
MAX_NB_SUBFR
 ],

40 c⁄° 
›us_öt16
 
x
[],

41 
›us_öt16
 
a_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ],

42 c⁄° 
›us_öt32
 
gaös
[ 
MAX_NB_SUBFR
 ],

43 c⁄° 
›us_öt
 
sub‰_Àngth
,

44 c⁄° 
›us_öt
 
nb_sub‰
,

45 c⁄° 
›us_öt
 
LPC_‹dî
,

46 
¨ch


49 
›us_öt
 
off£t
, 
i
, 
j
, 
rshi·
, 
lz1
, 
lz2
;

50 
›us_öt16
 *
LPC_ªs_±r
;

51 
	`VARDECL
–
›us_öt16
, 
LPC_ªs
 );

52 c⁄° 
›us_öt16
 *
x_±r
;

53 
›us_öt32
 
tmp32
;

54 
SAVE_STACK
;

56 
x_±r
 = 
x
;

57 
off£t
 = 
LPC_‹dî
 + 
sub‰_Àngth
;

60 
	`ALLOC
–
LPC_ªs
, ( 
MAX_NB_SUBFR
 >> 1 ) * 
off£t
, 
›us_öt16
 );

61 
	`˚…_as£π
––
nb_sub‰
 >> 1 ) * ( 
MAX_NB_SUBFR
 >> 1 ) ==Çb_subfr );

62  
i
 = 0; i < 
nb_sub‰
 >> 1; i++ ) {

64 
	`sûk_LPC_™Æysis_fûãr
–
LPC_ªs
, 
x_±r
, 
a_Q12
[ 
i
 ], ( 
MAX_NB_SUBFR
 >> 1 ) * 
off£t
, 
LPC_‹dî
, 
¨ch
 );

67 
LPC_ªs_±r
 = 
LPC_ªs
 + 
LPC_‹dî
;

68  
j
 = 0; j < ( 
MAX_NB_SUBFR
 >> 1 ); j++ ) {

70 
	`sûk_sum_sqr_shi·
–&
ƒgs
[ 
i
 * ( 
MAX_NB_SUBFR
 >> 1 ) + 
j
 ], &
rshi·
, 
LPC_ªs_±r
, 
sub‰_Àngth
 );

73 
ƒgsQ
[ 
i
 * ( 
MAX_NB_SUBFR
 >> 1 ) + 
j
 ] = -
rshi·
;

76 
LPC_ªs_±r
 +
off£t
;

79 
x_±r
 +–
MAX_NB_SUBFR
 >> 1 ) * 
off£t
;

83  
i
 = 0; i < 
nb_sub‰
; i++ ) {

85 
lz1
 = 
	`sûk_CLZ32
–
ƒgs
[ 
i
 ] ) - 1;

86 
lz2
 = 
	`sûk_CLZ32
–
gaös
[ 
i
 ] ) - 1;

88 
tmp32
 = 
	`sûk_LSHIFT32
–
gaös
[ 
i
 ], 
lz2
 );

91 
tmp32
 = 
	`sûk_SMMUL
(Åmp32,Åmp32 );

94 
ƒgs
[ 
i
 ] = 
	`sûk_SMMUL
–
tmp32
, 
	`sûk_LSHIFT32
–ƒgs[ i ], 
lz1
 ) );

95 
ƒgsQ
[ 
i
 ] +
lz1
 + 2 * 
lz2
 - 32 - 32;

97 
RESTORE_STACK
;

98 
	}
}

	@silk/fixed/schur64_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

36 
›us_öt32
 
	$sûk_schur64
(

37 
›us_öt32
 
rc_Q16
[],

38 c⁄° 
›us_öt32
 
c
[],

39 
›us_öt32
 
‹dî


42 
›us_öt
 
k
, 
n
;

43 
›us_öt32
 
C
[ 
SILK_MAX_ORDER_LPC
 + 1 ][ 2 ];

44 
›us_öt32
 
Ctmp1_Q30
, 
Ctmp2_Q30
, 
rc_tmp_Q31
;

46 
	`˚…_as£π
–
‹dî
 >0 && ordî <
SILK_MAX_ORDER_LPC
 );

49 if–
c
[ 0 ] <= 0 ) {

50 
	`sûk_mem£t
–
rc_Q16
, 0, 
‹dî
 * –
›us_öt32
 ) );

54 
k
 = 0;

56 
C
[ 
k
 ][ 0 ] = C[ k ][ 1 ] = 
c
[ k ];

57 }  ++
k
 <
‹dî
 );

59  
k
 = 0; k < 
‹dî
; k++ ) {

61 i‡(
	`sûk_abs_öt32
(
C
[ 
k
 + 1 ][ 0 ]) >= C[ 0 ][ 1 ]) {

62 i‡–
C
[ 
k
 + 1 ][ 0 ] > 0 ) {

63 
rc_Q16
[ 
k
 ] = -
	`SILK_FIX_CONST
( .99f, 16 );

65 
rc_Q16
[ 
k
 ] = 
	`SILK_FIX_CONST
( .99f, 16 );

67 
k
++;

72 
rc_tmp_Q31
 = 
	`sûk_DIV32_v¨Q
–-
C
[ 
k
 + 1 ][ 0 ], C[ 0 ][ 1 ], 31 );

75 
rc_Q16
[ 
k
 ] = 
	`sûk_RSHIFT_ROUND
–
rc_tmp_Q31
, 15 );

78  
n
 = 0;Ç < 
‹dî
 - 
k
;Ç++ ) {

79 
Ctmp1_Q30
 = 
C
[ 
n
 + 
k
 + 1 ][ 0 ];

80 
Ctmp2_Q30
 = 
C
[ 
n
 ][ 1 ];

83 
C
[ 
n
 + 
k
 + 1 ][ 0 ] = 
Ctmp1_Q30
 + 
	`sûk_SMMUL
–
	`sûk_LSHIFT
–
Ctmp2_Q30
, 1 ), 
rc_tmp_Q31
 );

84 
C
[ 
n
 ][ 1 ] = 
Ctmp2_Q30
 + 
	`sûk_SMMUL
–
	`sûk_LSHIFT
–
Ctmp1_Q30
, 1 ), 
rc_tmp_Q31
 );

88 ; 
k
 < 
‹dî
; k++ ) {

89 
rc_Q16
[ 
k
 ] = 0;

92  
	`sûk_max_32
–1, 
C
[ 0 ][ 1 ] );

93 
	}
}

	@silk/fixed/schur_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

36 
›us_öt32
 
	$sûk_schur
(

37 
›us_öt16
 *
rc_Q15
,

38 c⁄° 
›us_öt32
 *
c
,

39 c⁄° 
›us_öt32
 
‹dî


42 
›us_öt
 
k
, 
n
, 
lz
;

43 
›us_öt32
 
C
[ 
SILK_MAX_ORDER_LPC
 + 1 ][ 2 ];

44 
›us_öt32
 
Ctmp1
, 
Ctmp2
, 
rc_tmp_Q15
;

46 
	`˚…_as£π
–
‹dî
 >0 && ordî <
SILK_MAX_ORDER_LPC
 );

49 
lz
 = 
	`sûk_CLZ32
–
c
[ 0 ] );

52 
k
 = 0;

53 if–
lz
 < 2 ) {

56 
C
[ 
k
 ][ 0 ] = C[ k ][ 1 ] = 
	`sûk_RSHIFT
–
c
[ k ], 1 );

57 }  ++
k
 <
‹dî
 );

58 } if–
lz
 > 2 ) {

60 
lz
 -= 2;

62 
C
[ 
k
 ][ 0 ] = C[ k ][ 1 ] = 
	`sûk_LSHIFT
–
c
[ k ], 
lz
 );

63 }  ++
k
 <
‹dî
 );

67 
C
[ 
k
 ][ 0 ] = C[ k ][ 1 ] = 
c
[ k ];

68 }  ++
k
 <
‹dî
 );

71  
k
 = 0; k < 
‹dî
; k++ ) {

73 i‡(
	`sûk_abs_öt32
(
C
[ 
k
 + 1 ][ 0 ]) >= C[ 0 ][ 1 ]) {

74 i‡–
C
[ 
k
 + 1 ][ 0 ] > 0 ) {

75 
rc_Q15
[ 
k
 ] = -
	`SILK_FIX_CONST
( .99f, 15 );

77 
rc_Q15
[ 
k
 ] = 
	`SILK_FIX_CONST
( .99f, 15 );

79 
k
++;

84 
rc_tmp_Q15
 = -
	`sûk_DIV32_16
–
C
[ 
k
 + 1 ][ 0 ], 
	`sûk_max_32
–
	`sûk_RSHIFT
( C[ 0 ][ 1 ], 15 ), 1 ) );

87 
rc_tmp_Q15
 = 
	`sûk_SAT16
(Ñc_tmp_Q15 );

90 
rc_Q15
[ 
k
 ] = (
›us_öt16
)
rc_tmp_Q15
;

93  
n
 = 0;Ç < 
‹dî
 - 
k
;Ç++ ) {

94 
Ctmp1
 = 
C
[ 
n
 + 
k
 + 1 ][ 0 ];

95 
Ctmp2
 = 
C
[ 
n
 ][ 1 ];

96 
C
[ 
n
 + 
k
 + 1 ][ 0 ] = 
	`sûk_SMLAWB
–
Ctmp1
, 
	`sûk_LSHIFT
–
Ctmp2
, 1 ), 
rc_tmp_Q15
 );

97 
C
[ 
n
 ][ 1 ] = 
	`sûk_SMLAWB
–
Ctmp2
, 
	`sûk_LSHIFT
–
Ctmp1
, 1 ), 
rc_tmp_Q15
 );

101 ; 
k
 < 
‹dî
; k++ ) {

102 
rc_Q15
[ 
k
 ] = 0;

106  
	`sûk_max_32
–1, 
C
[ 0 ][ 1 ] );

107 
	}
}

	@silk/fixed/structs_FIX.h

28 #i‚de‡
SILK_STRUCTS_FIX_H


29 
	#SILK_STRUCTS_FIX_H


	)

31 
	~"ty≥def.h
"

32 
	~"maö.h
"

33 
	~"°ru˘s.h
"

35 #ifde‡
__˝lu•lus


44 
›us_öt8
 
La°GaöIndex
;

45 
›us_öt32
 
H¨mBoo°_smth_Q16
;

46 
›us_öt32
 
H¨mSh≠eGaö_smth_Q16
;

47 
›us_öt32
 
Tût_smth_Q16
;

48 } 
	tsûk_sh≠e_°©e_FIX
;

54 
sûk_ícodî_°©e
 
sCmn
;

55 
sûk_sh≠e_°©e_FIX
 
sSh≠e
;

58 
sûk_DWORD_ALIGN
 
›us_öt16
 
x_buf
[ 2 * 
MAX_FRAME_LENGTH
 + 
LA_SHAPE_MAX
 ];

59 
›us_öt
 
LTPC‹r_Q15
;

60 
›us_öt32
 
ªsNrgSmth
;

61 } 
	tsûk_ícodî_°©e_FIX
;

68 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ];

69 
sûk_DWORD_ALIGN
 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ];

70 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ];

71 
›us_öt
 
LTP_sˇÀ_Q14
;

72 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ];

76 
sûk_DWORD_ALIGN
 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ];

77 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ];

78 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ];

79 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ];

80 
›us_öt
 
Lambda_Q10
;

81 
›us_öt
 
öput_quÆôy_Q14
;

82 
›us_öt
 
codög_quÆôy_Q14
;

85 
›us_öt32
 
¥edGaö_Q16
;

86 
›us_öt
 
LTPªdCodGaö_Q7
;

87 
›us_öt32
 
ResNrg
[ 
MAX_NB_SUBFR
 ];

88 
›us_öt
 
ResNrgQ
[ 
MAX_NB_SUBFR
 ];

91 
›us_öt32
 
GaösUnq_Q16
[ 
MAX_NB_SUBFR
 ];

92 
›us_öt8
 
œ°GaöIndexPªv
;

93 } 
	tsûk_ícodî_c⁄åﬁ_FIX
;

99 
sûk_ícodî_°©e_FIX
 
°©e_Fxx
[ 
ENCODER_NUM_CHANNELS
 ];

100 
°îeo_íc_°©e
 
sSãªo
;

101 
›us_öt32
 
nBôsU£dLBRR
;

102 
›us_öt32
 
nBôsEx˚eded
;

103 
›us_öt
 
nCh™√lsAPI
;

104 
›us_öt
 
nCh™√lsI¡î«l
;

105 
›us_öt
 
nPªvCh™√lsI¡î«l
;

106 
›us_öt
 
timeSö˚SwôchAŒowed_ms
;

107 
›us_öt
 
ÆlowB™dwidthSwôch
;

108 
›us_öt
 
¥ev_decode_⁄ly_middÀ
;

109 } 
	tsûk_ícodî
;

112 #ifde‡
__˝lu•lus


	@silk/fixed/vector_ops_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"pôch.h
"

36 
	$sûk_sˇÀ_c›y_ve˘‹16
(

37 
›us_öt16
 *
d©a_out
,

38 c⁄° 
›us_öt16
 *
d©a_ö
,

39 
›us_öt32
 
gaö_Q16
,

40 c⁄° 
›us_öt
 
d©aSize


43 
›us_öt
 
i
;

44 
›us_öt32
 
tmp32
;

46  
i
 = 0; i < 
d©aSize
; i++ ) {

47 
tmp32
 = 
	`sûk_SMULWB
–
gaö_Q16
, 
d©a_ö
[ 
i
 ] );

48 
d©a_out
[ 
i
 ] = (
›us_öt16
)
	`sûk_CHECK_FIT16
–
tmp32
 );

50 
	}
}

53 
	$sûk_sˇÀ_ve˘‹32_Q26_lshi·_18
(

54 
›us_öt32
 *
d©a1
,

55 
›us_öt32
 
gaö_Q26
,

56 
›us_öt
 
d©aSize


59 
›us_öt
 
i
;

61  
i
 = 0; i < 
d©aSize
; i++ ) {

62 
d©a1
[ 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`sûk_RSHIFT64
–
	`sûk_SMULL
–d©a1[ i ], 
gaö_Q26
 ), 8 ) );

64 
	}
}

71 
›us_öt32
 
	$sûk_ö√r_¥od_Æig√d
(

72 c⁄° 
›us_öt16
 *c⁄° 
öVec1
,

73 c⁄° 
›us_öt16
 *c⁄° 
öVec2
,

74 c⁄° 
›us_öt
 
Àn
,

75 
¨ch


78 #ifde‡
FIXED_POINT


79  
	`˚…_ö√r_¥od
(
öVec1
, 
öVec2
, 
Àn
, 
¨ch
);

81 
›us_öt
 
i
;

82 
›us_öt32
 
sum
 = 0;

83  
i
 = 0; i < 
Àn
; i++ ) {

84 
sum
 = 
	`sûk_SMLABB
–sum, 
öVec1
[ 
i
 ], 
öVec2
[ i ] );

86  
sum
;

88 
	}
}

90 
›us_öt64
 
	$sûk_ö√r_¥od16_Æig√d_64_c
(

91 c⁄° 
›us_öt16
 *
öVec1
,

92 c⁄° 
›us_öt16
 *
öVec2
,

93 c⁄° 
›us_öt
 
Àn


96 
›us_öt
 
i
;

97 
›us_öt64
 
sum
 = 0;

98  
i
 = 0; i < 
Àn
; i++ ) {

99 
sum
 = 
	`sûk_SMLALBB
–sum, 
öVec1
[ 
i
 ], 
öVec2
[ i ] );

101  
sum
;

102 
	}
}

	@silk/fixed/warped_autocorrelation_FIX.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FIX.h
"

34 #i‡
deföed
(
MIPSr1_ASM
)

35 
	~"mùs/w¨≥d_autoc‹ªœti⁄_FIX_mù§1.h
"

40 #i‚de‡
OVERRIDE_sûk_w¨≥d_autoc‹ªœti⁄_FIX_c


41 
	$sûk_w¨≥d_autoc‹ªœti⁄_FIX_c
(

42 
›us_öt32
 *
c‹r
,

43 
›us_öt
 *
sˇÀ
,

44 c⁄° 
›us_öt16
 *
öput
,

45 c⁄° 
›us_öt
 
w¨pög_Q16
,

46 c⁄° 
›us_öt
 
Àngth
,

47 c⁄° 
›us_öt
 
‹dî


50 
›us_öt
 
n
, 
i
, 
lsh
;

51 
›us_öt32
 
tmp1_QS
, 
tmp2_QS
;

52 
›us_öt32
 
°©e_QS
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

53 
›us_öt64
 
c‹r_QC
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

56 
	`˚…_as£π
––
‹dî
 & 1 ) == 0 );

57 
	`sûk_as£π
–2 * 
QS
 - 
QC
 >= 0 );

60  
n
 = 0;Ç < 
Àngth
;Ç++ ) {

61 
tmp1_QS
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
öput
[ 
n
 ], 
QS
 );

63  
i
 = 0; i < 
‹dî
; i += 2 ) {

65 
tmp2_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 ], sèã_QS[ i + 1 ] - 
tmp1_QS
, 
w¨pög_Q16
 );

66 
°©e_QS
[ 
i
 ] = 
tmp1_QS
;

67 
c‹r_QC
[ 
i
 ] +
	`sûk_RSHIFT64
–
	`sûk_SMULL
–
tmp1_QS
, 
°©e_QS
[ 0 ] ), 2 * 
QS
 - 
QC
 );

69 
tmp1_QS
 = 
	`sûk_SMLAWB
–
°©e_QS
[ 
i
 + 1 ], sèã_QS[ i + 2 ] - 
tmp2_QS
, 
w¨pög_Q16
 );

70 
°©e_QS
[ 
i
 + 1 ] = 
tmp2_QS
;

71 
c‹r_QC
[ 
i
 + 1 ] +
	`sûk_RSHIFT64
–
	`sûk_SMULL
–
tmp2_QS
, 
°©e_QS
[ 0 ] ), 2 * 
QS
 - 
QC
 );

73 
°©e_QS
[ 
‹dî
 ] = 
tmp1_QS
;

74 
c‹r_QC
[ 
‹dî
 ] +
	`sûk_RSHIFT64
–
	`sûk_SMULL
–
tmp1_QS
, 
°©e_QS
[ 0 ] ), 2 * 
QS
 - 
QC
 );

77 
lsh
 = 
	`sûk_CLZ64
–
c‹r_QC
[ 0 ] ) - 35;

78 
lsh
 = 
	`sûk_LIMIT
–lsh, -12 - 
QC
, 30 - QC );

79 *
sˇÀ
 = -–
QC
 + 
lsh
 );

80 
	`sûk_as£π
–*
sˇÀ
 >= -30 && *scale <= 12 );

81 if–
lsh
 >= 0 ) {

82  
i
 = 0; i < 
‹dî
 + 1; i++ ) {

83 
c‹r
[ 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`sûk_LSHIFT64
–
c‹r_QC
[ i ], 
lsh
 ) );

86  
i
 = 0; i < 
‹dî
 + 1; i++ ) {

87 
c‹r
[ 
i
 ] = (
›us_öt32
)
	`sûk_CHECK_FIT32
–
	`sûk_RSHIFT64
–
c‹r_QC
[ i ], -
lsh
 ) );

90 
	`sûk_as£π
–
c‹r_QC
[ 0 ] >= 0 );

91 
	}
}

	@silk/fixed/x86/burg_modified_FIX_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

36 
	~"SigProc_FIX.h
"

37 
	~"deföe.h
"

38 
	~"tunög_∑ømëîs.h
"

39 
	~"pôch.h
"

40 
	~"˚…/x86/x86˝u.h
"

42 
	#MAX_FRAME_SIZE
 384

	)

44 
	#QA
 25

	)

45 
	#N_BITS_HEAD_ROOM
 2

	)

46 
	#MIN_RSHIFTS
 -16

	)

47 
	#MAX_RSHIFTS
 (32 - 
QA
)

	)

50 
	$sûk_burg_modifõd_s£4_1
(

51 
›us_öt32
 *
ªs_ƒg
,

52 
›us_öt
 *
ªs_ƒg_Q
,

53 
›us_öt32
 
A_Q16
[],

54 c⁄° 
›us_öt16
 
x
[],

55 c⁄° 
›us_öt32
 
möInvGaö_Q30
,

56 c⁄° 
›us_öt
 
sub‰_Àngth
,

57 c⁄° 
›us_öt
 
nb_sub‰
,

58 c⁄° 
›us_öt
 
D
,

59 
¨ch


62 
›us_öt
 
k
, 
n
, 
s
, 
lz
, 
rshi·s
, 
rshi·s_exåa
, 
ªached_max_gaö
;

63 
›us_öt32
 
C0
, 
num
, 
ƒg
, 
rc_Q31
, 
övGaö_Q30
, 
Atmp_QA
, 
Atmp1
, 
tmp1
, 
tmp2
, 
x1
, 
x2
;

64 c⁄° 
›us_öt16
 *
x_±r
;

65 
›us_öt32
 
C_fú°_row
[ 
SILK_MAX_ORDER_LPC
 ];

66 
›us_öt32
 
C_œ°_row
[ 
SILK_MAX_ORDER_LPC
 ];

67 
›us_öt32
 
Af_QA
[ 
SILK_MAX_ORDER_LPC
 ];

68 
›us_öt32
 
CAf
[ 
SILK_MAX_ORDER_LPC
 + 1 ];

69 
›us_öt32
 
CAb
[ 
SILK_MAX_ORDER_LPC
 + 1 ];

70 
›us_öt32
 
xc‹r
[ 
SILK_MAX_ORDER_LPC
 ];

72 
__m128i
 
FIRST_3210
, 
LAST_3210
, 
ATMP_3210
, 
TMP1_3210
, 
TMP2_3210
, 
T1_3210
, 
T2_3210
, 
PTR_3210
, 
SUBFR_3210
, 
X1_3210
, 
X2_3210
;

73 
__m128i
 
CONST1
 = 
	`_mm_£t1_ïi32
(1);

75 
	`˚…_as£π
–
sub‰_Àngth
 * 
nb_sub‰
 <
MAX_FRAME_SIZE
 );

78 
	`sûk_sum_sqr_shi·
–&
C0
, &
rshi·s
, 
x
, 
nb_sub‰
 * 
sub‰_Àngth
 );

79 if–
rshi·s
 > 
MAX_RSHIFTS
 ) {

80 
C0
 = 
	`sûk_LSHIFT32
–C0, 
rshi·s
 - 
MAX_RSHIFTS
 );

81 
	`sûk_as£π
–
C0
 > 0 );

82 
rshi·s
 = 
MAX_RSHIFTS
;

84 
lz
 = 
	`sûk_CLZ32
–
C0
 ) - 1;

85 
rshi·s_exåa
 = 
N_BITS_HEAD_ROOM
 - 
lz
;

86 if–
rshi·s_exåa
 > 0 ) {

87 
rshi·s_exåa
 = 
	`sûk_mö
–rshi·s_exåa, 
MAX_RSHIFTS
 - 
rshi·s
 );

88 
C0
 = 
	`sûk_RSHIFT32
–C0, 
rshi·s_exåa
 );

90 
rshi·s_exåa
 = 
	`sûk_max
–rshi·s_exåa, 
MIN_RSHIFTS
 - 
rshi·s
 );

91 
C0
 = 
	`sûk_LSHIFT32
–C0, -
rshi·s_exåa
 );

93 
rshi·s
 +
rshi·s_exåa
;

95 
CAb
[ 0 ] = 
CAf
[ 0 ] = 
C0
 + 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), C0 ) + 1;

96 
	`sûk_mem£t
–
C_fú°_row
, 0, 
SILK_MAX_ORDER_LPC
 * –
›us_öt32
 ) );

97 if–
rshi·s
 > 0 ) {

98  
s
 = 0; s < 
nb_sub‰
; s++ ) {

99 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

100  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

101 
C_fú°_row
[ 
n
 - 1 ] +(
›us_öt32
)
	`sûk_RSHIFT64
(

102 
	`sûk_ö√r_¥od16_Æig√d_64
–
x_±r
, x_±∏+ 
n
, 
sub‰_Àngth
 -Ç, 
¨ch
 ), 
rshi·s
 );

106  
s
 = 0; s < 
nb_sub‰
; s++ ) {

107 
i
;

108 
›us_öt32
 
d
;

109 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

110 
	`˚…_pôch_xc‹r
(
x_±r
, x_±∏+ 1, 
xc‹r
, 
sub‰_Àngth
 - 
D
, D, 
¨ch
 );

111  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

112  
i
 = 
n
 + 
sub‰_Àngth
 - 
D
, 
d
 = 0; i < subfr_length; i++ )

113 
d
 = 
	`MAC16_16
–d, 
x_±r
[ 
i
 ], x_±r[ i - 
n
 ] );

114 
xc‹r
[ 
n
 - 1 ] +
d
;

116  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

117 
C_fú°_row
[ 
n
 - 1 ] +
	`sûk_LSHIFT32
–
xc‹r
[Ç - 1 ], -
rshi·s
 );

121 
	`sûk_mem˝y
–
C_œ°_row
, 
C_fú°_row
, 
SILK_MAX_ORDER_LPC
 * –
›us_öt32
 ) );

124 
CAb
[ 0 ] = 
CAf
[ 0 ] = 
C0
 + 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), C0 ) + 1;

126 
övGaö_Q30
 = (
›us_öt32
)1 << 30;

127 
ªached_max_gaö
 = 0;

128  
n
 = 0;Ç < 
D
;Ç++ ) {

133 if–
rshi·s
 > -2 ) {

134  
s
 = 0; s < 
nb_sub‰
; s++ ) {

135 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

136 
x1
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 16 - 
rshi·s
 );

137 
x2
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 16 - 
rshi·s
 );

138 
tmp1
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 
QA
 - 16 );

139 
tmp2
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 
QA
 - 16 );

140  
k
 = 0; k < 
n
; k++ ) {

141 
C_fú°_row
[ 
k
 ] = 
	`sûk_SMLAWB
–C_fú°_row[ k ], 
x1
, 
x_±r
[ 
n
 - k - 1 ] );

142 
C_œ°_row
[ 
k
 ] = 
	`sûk_SMLAWB
–C_œ°_row[ k ], 
x2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k ] );

143 
Atmp_QA
 = 
Af_QA
[ 
k
 ];

144 
tmp1
 = 
	`sûk_SMLAWB
–tmp1, 
Atmp_QA
, 
x_±r
[ 
n
 - 
k
 - 1 ] );

145 
tmp2
 = 
	`sûk_SMLAWB
–tmp2, 
Atmp_QA
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ] );

147 
tmp1
 = 
	`sûk_LSHIFT32
–-tmp1, 32 - 
QA
 - 
rshi·s
 );

148 
tmp2
 = 
	`sûk_LSHIFT32
–-tmp2, 32 - 
QA
 - 
rshi·s
 );

149  
k
 = 0; k <
n
; k++ ) {

150 
CAf
[ 
k
 ] = 
	`sûk_SMLAWB
–CAf[ k ], 
tmp1
, 
x_±r
[ 
n
 - k ] );

151 
CAb
[ 
k
 ] = 
	`sûk_SMLAWB
–CAb[ k ], 
tmp2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k - 1 ] );

155  
s
 = 0; s < 
nb_sub‰
; s++ ) {

156 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

157 
x1
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], -
rshi·s
 );

158 
x2
 = -
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], -
rshi·s
 );

159 
tmp1
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 ], 17 );

160 
tmp2
 = 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ], 17 );

162 
X1_3210
 = 
	`_mm_£t1_ïi32
–
x1
 );

163 
X2_3210
 = 
	`_mm_£t1_ïi32
–
x2
 );

164 
TMP1_3210
 = 
	`_mm_£tzîo_si128
();

165 
TMP2_3210
 = 
	`_mm_£tzîo_si128
();

166  
k
 = 0; k < 
n
 - 3; k += 4 ) {

167 
PTR_3210
 = 
	`OP_CVTEPI16_EPI32_M64
–&
x_±r
[ 
n
 - 
k
 - 1 - 3 ] );

168 
SUBFR_3210
 = 
	`OP_CVTEPI16_EPI32_M64
–&
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ] );

169 
FIRST_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&
C_fú°_row
[ 
k
 ] );

170 
PTR_3210
 = 
	`_mm_shufÊe_ïi32
–PTR_3210, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

171 
LAST_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&
C_œ°_row
[ 
k
 ] );

172 
ATMP_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&
Af_QA
[ 
k
 ] );

174 
T1_3210
 = 
	`_mm_muŒo_ïi32
–
PTR_3210
, 
X1_3210
 );

175 
T2_3210
 = 
	`_mm_muŒo_ïi32
–
SUBFR_3210
, 
X2_3210
 );

177 
ATMP_3210
 = 
	`_mm_§ai_ïi32
( ATMP_3210, 7 );

178 
ATMP_3210
 = 
	`_mm_add_ïi32
–ATMP_3210, 
CONST1
 );

179 
ATMP_3210
 = 
	`_mm_§ai_ïi32
( ATMP_3210, 1 );

181 
FIRST_3210
 = 
	`_mm_add_ïi32
–FIRST_3210, 
T1_3210
 );

182 
LAST_3210
 = 
	`_mm_add_ïi32
–LAST_3210, 
T2_3210
 );

184 
PTR_3210
 = 
	`_mm_muŒo_ïi32
–
ATMP_3210
, PTR_3210 );

185 
SUBFR_3210
 = 
	`_mm_muŒo_ïi32
–
ATMP_3210
, SUBFR_3210 );

187 
	`_mm_°‹eu_si128
–(
__m128i
 *)&
C_fú°_row
[ 
k
 ], 
FIRST_3210
 );

188 
	`_mm_°‹eu_si128
–(
__m128i
 *)&
C_œ°_row
[ 
k
 ], 
LAST_3210
 );

190 
TMP1_3210
 = 
	`_mm_add_ïi32
–TMP1_3210, 
PTR_3210
 );

191 
TMP2_3210
 = 
	`_mm_add_ïi32
–TMP2_3210, 
SUBFR_3210
 );

194 
TMP1_3210
 = 
	`_mm_add_ïi32
–TMP1_3210, 
	`_mm_u≈ackhi_ïi64
(TMP1_3210, TMP1_3210 ) );

195 
TMP2_3210
 = 
	`_mm_add_ïi32
–TMP2_3210, 
	`_mm_u≈ackhi_ïi64
(TMP2_3210, TMP2_3210 ) );

196 
TMP1_3210
 = 
	`_mm_add_ïi32
–TMP1_3210, 
	`_mm_shufÊño_ïi16
(TMP1_3210, 0x0E ) );

197 
TMP2_3210
 = 
	`_mm_add_ïi32
–TMP2_3210, 
	`_mm_shufÊño_ïi16
(TMP2_3210, 0x0E ) );

199 
tmp1
 +
	`_mm_cvtsi128_si32
–
TMP1_3210
 );

200 
tmp2
 +
	`_mm_cvtsi128_si32
–
TMP2_3210
 );

202  ; 
k
 < 
n
; k++ ) {

203 
C_fú°_row
[ 
k
 ] = 
	`sûk_MLA
–C_fú°_row[ k ], 
x1
, 
x_±r
[ 
n
 - k - 1 ] );

204 
C_œ°_row
[ 
k
 ] = 
	`sûk_MLA
–C_œ°_row[ k ], 
x2
, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k ] );

205 
Atmp1
 = 
	`sûk_RSHIFT_ROUND
–
Af_QA
[ 
k
 ], 
QA
 - 17 );

206 
tmp1
 = 
	`sûk_MLA
–tmp1, 
x_±r
[ 
n
 - 
k
 - 1 ], 
Atmp1
 );

207 
tmp2
 = 
	`sûk_MLA
–tmp2, 
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ], 
Atmp1
 );

210 
tmp1
 = -tmp1;

211 
tmp2
 = -tmp2;

214 
__m128i
 
xmm_tmp1
, 
xmm_tmp2
;

215 
__m128i
 
xmm_x_±r_n_k_x2x0
, 
xmm_x_±r_n_k_x3x1
;

216 
__m128i
 
xmm_x_±r_sub_x2x0
, 
xmm_x_±r_sub_x3x1
;

218 
xmm_tmp1
 = 
	`_mm_£t1_ïi32
–
tmp1
 );

219 
xmm_tmp2
 = 
	`_mm_£t1_ïi32
–
tmp2
 );

221  
k
 = 0; k <
n
 - 3; k += 4 ) {

222 
xmm_x_±r_n_k_x2x0
 = 
	`OP_CVTEPI16_EPI32_M64
–&
x_±r
[ 
n
 - 
k
 - 3 ] );

223 
xmm_x_±r_sub_x2x0
 = 
	`OP_CVTEPI16_EPI32_M64
–&
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 - 1 ] );

225 
xmm_x_±r_n_k_x2x0
 = 
	`_mm_shufÊe_ïi32
–xmm_x_±r_n_k_x2x0, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

227 
xmm_x_±r_n_k_x2x0
 = 
	`_mm_¶li_ïi32
–xmm_x_±r_n_k_x2x0, -
rshi·s
 - 1 );

228 
xmm_x_±r_sub_x2x0
 = 
	`_mm_¶li_ïi32
–xmm_x_±r_sub_x2x0, -
rshi·s
 - 1 );

231 
xmm_x_±r_n_k_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_x_±r_n_k_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

232 
xmm_x_±r_sub_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_x_±r_sub_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

234 
xmm_x_±r_n_k_x2x0
 = 
	`_mm_mul_ïi32
–xmm_x_±r_n_k_x2x0, 
xmm_tmp1
 );

235 
xmm_x_±r_n_k_x3x1
 = 
	`_mm_mul_ïi32
–xmm_x_±r_n_k_x3x1, 
xmm_tmp1
 );

236 
xmm_x_±r_sub_x2x0
 = 
	`_mm_mul_ïi32
–xmm_x_±r_sub_x2x0, 
xmm_tmp2
 );

237 
xmm_x_±r_sub_x3x1
 = 
	`_mm_mul_ïi32
–xmm_x_±r_sub_x3x1, 
xmm_tmp2
 );

239 
xmm_x_±r_n_k_x2x0
 = 
	`_mm_§li_ïi64
( xmm_x_ptr_n_k_x2x0, 16 );

240 
xmm_x_±r_n_k_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_x_ptr_n_k_x3x1, 16 );

241 
xmm_x_±r_sub_x2x0
 = 
	`_mm_§li_ïi64
( xmm_x_ptr_sub_x2x0, 16 );

242 
xmm_x_±r_sub_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_x_ptr_sub_x3x1, 16 );

244 
xmm_x_±r_n_k_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_x_±r_n_k_x2x0, 
xmm_x_±r_n_k_x3x1
, 0xCC );

245 
xmm_x_±r_sub_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_x_±r_sub_x2x0, 
xmm_x_±r_sub_x3x1
, 0xCC );

247 
X1_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&
CAf
[ 
k
 ] );

248 
PTR_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&
CAb
[ 
k
 ] );

250 
X1_3210
 = 
	`_mm_add_ïi32
–X1_3210, 
xmm_x_±r_n_k_x2x0
 );

251 
PTR_3210
 = 
	`_mm_add_ïi32
–PTR_3210, 
xmm_x_±r_sub_x2x0
 );

253 
	`_mm_°‹eu_si128
–(
__m128i
 *)&
CAf
[ 
k
 ], 
X1_3210
 );

254 
	`_mm_°‹eu_si128
–(
__m128i
 *)&
CAb
[ 
k
 ], 
PTR_3210
 );

257  ; 
k
 <
n
; k++ ) {

258 
CAf
[ 
k
 ] = 
	`sûk_SMLAWW
–CAf[ k ], 
tmp1
,

259 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
n
 - 
k
 ], -
rshi·s
 - 1 ) );

260 
CAb
[ 
k
 ] = 
	`sûk_SMLAWW
–CAb[ k ], 
tmp2
,

261 
	`sûk_LSHIFT32
–(
›us_öt32
)
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 - 1 ], -
rshi·s
 - 1 ) );

268 
tmp1
 = 
C_fú°_row
[ 
n
 ];

269 
tmp2
 = 
C_œ°_row
[ 
n
 ];

270 
num
 = 0;

271 
ƒg
 = 
	`sûk_ADD32
–
CAb
[ 0 ], 
CAf
[ 0 ] );

272  
k
 = 0; k < 
n
; k++ ) {

273 
Atmp_QA
 = 
Af_QA
[ 
k
 ];

274 
lz
 = 
	`sûk_CLZ32
–
	`sûk_abs
–
Atmp_QA
 ) ) - 1;

275 
lz
 = 
	`sûk_mö
–32 - 
QA
,Üz );

276 
Atmp1
 = 
	`sûk_LSHIFT32
–
Atmp_QA
, 
lz
 );

278 
tmp1
 = 
	`sûk_ADD_LSHIFT32
–tmp1, 
	`sûk_SMMUL
–
C_œ°_row
[ 
n
 - 
k
 - 1 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

279 
tmp2
 = 
	`sûk_ADD_LSHIFT32
–tmp2, 
	`sûk_SMMUL
–
C_fú°_row
[ 
n
 - 
k
 - 1 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

280 
num
 = 
	`sûk_ADD_LSHIFT32
–num, 
	`sûk_SMMUL
–
CAb
[ 
n
 - 
k
 ], 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

281 
ƒg
 = 
	`sûk_ADD_LSHIFT32
–ƒg, 
	`sûk_SMMUL
–
	`sûk_ADD32
–
CAb
[ 
k
 + 1 ], 
CAf
[ k + 1 ] ),

282 
Atmp1
 ), 32 - 
QA
 - 
lz
 );

284 
CAf
[ 
n
 + 1 ] = 
tmp1
;

285 
CAb
[ 
n
 + 1 ] = 
tmp2
;

286 
num
 = 
	`sûk_ADD32
–num, 
tmp2
 );

287 
num
 = 
	`sûk_LSHIFT32
( -num, 1 );

290 if–
	`sûk_abs
–
num
 ) < 
ƒg
 ) {

291 
rc_Q31
 = 
	`sûk_DIV32_v¨Q
–
num
, 
ƒg
, 31 );

293 
rc_Q31
 = ( 
num
 > 0 ) ? 
sûk_öt32_MAX
 : 
sûk_öt32_MIN
;

297 
tmp1
 = ( (
›us_öt32
)1 << 30 ) - 
	`sûk_SMMUL
–
rc_Q31
,Ñc_Q31 );

298 
tmp1
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–
övGaö_Q30
,Åmp1 ), 2 );

299 if–
tmp1
 <
möInvGaö_Q30
 ) {

301 
tmp2
 = ( (
›us_öt32
)1 << 30 ) - 
	`sûk_DIV32_v¨Q
–
möInvGaö_Q30
, 
övGaö_Q30
, 30 );

302 
rc_Q31
 = 
	`sûk_SQRT_APPROX
–
tmp2
 );

303 if–
rc_Q31
 > 0 ) {

305 
rc_Q31
 = 
	`sûk_RSHIFT32
–rc_Q31 + 
	`sûk_DIV32
–
tmp2
,Ñc_Q31 ), 1 );

306 
rc_Q31
 = 
	`sûk_LSHIFT32
(Ñc_Q31, 16 );

307 if–
num
 < 0 ) {

309 
rc_Q31
 = -rc_Q31;

312 
övGaö_Q30
 = 
möInvGaö_Q30
;

313 
ªached_max_gaö
 = 1;

315 
övGaö_Q30
 = 
tmp1
;

319  
k
 = 0; k < (
n
 + 1) >> 1; k++ ) {

320 
tmp1
 = 
Af_QA
[ 
k
 ];

321 
tmp2
 = 
Af_QA
[ 
n
 - 
k
 - 1 ];

322 
Af_QA
[ 
k
 ] = 
	`sûk_ADD_LSHIFT32
–
tmp1
, 
	`sûk_SMMUL
–
tmp2
, 
rc_Q31
 ), 1 );

323 
Af_QA
[ 
n
 - 
k
 - 1 ] = 
	`sûk_ADD_LSHIFT32
–
tmp2
, 
	`sûk_SMMUL
–
tmp1
, 
rc_Q31
 ), 1 );

325 
Af_QA
[ 
n
 ] = 
	`sûk_RSHIFT32
–
rc_Q31
, 31 - 
QA
 );

327 if–
ªached_max_gaö
 ) {

329  
k
 = 
n
 + 1; k < 
D
; k++ ) {

330 
Af_QA
[ 
k
 ] = 0;

336  
k
 = 0; k <
n
 + 1; k++ ) {

337 
tmp1
 = 
CAf
[ 
k
 ];

338 
tmp2
 = 
CAb
[ 
n
 - 
k
 + 1 ];

339 
CAf
[ 
k
 ] = 
	`sûk_ADD_LSHIFT32
–
tmp1
, 
	`sûk_SMMUL
–
tmp2
, 
rc_Q31
 ), 1 );

340 
CAb
[ 
n
 - 
k
 + 1 ] = 
	`sûk_ADD_LSHIFT32
–
tmp2
, 
	`sûk_SMMUL
–
tmp1
, 
rc_Q31
 ), 1 );

344 if–
ªached_max_gaö
 ) {

345  
k
 = 0; k < 
D
; k++ ) {

347 
A_Q16
[ 
k
 ] = -
	`sûk_RSHIFT_ROUND
–
Af_QA
[ k ], 
QA
 - 16 );

350 if–
rshi·s
 > 0 ) {

351  
s
 = 0; s < 
nb_sub‰
; s++ ) {

352 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

353 
C0
 -(
›us_öt32
)
	`sûk_RSHIFT64
–
	`sûk_ö√r_¥od16_Æig√d_64
–
x_±r
, x_±r, 
D
, 
¨ch
 ), 
rshi·s
 );

356  
s
 = 0; s < 
nb_sub‰
; s++ ) {

357 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

358 
C0
 -
	`sûk_LSHIFT32
–
	`sûk_ö√r_¥od_Æig√d
–
x_±r
, x_±r, 
D
, 
¨ch
 ), -
rshi·s
 );

362 *
ªs_ƒg
 = 
	`sûk_LSHIFT
–
	`sûk_SMMUL
–
övGaö_Q30
, 
C0
 ), 2 );

363 *
ªs_ƒg_Q
 = -
rshi·s
;

366 
ƒg
 = 
CAf
[ 0 ];

367 
tmp1
 = (
›us_öt32
)1 << 16;

368  
k
 = 0; k < 
D
; k++ ) {

369 
Atmp1
 = 
	`sûk_RSHIFT_ROUND
–
Af_QA
[ 
k
 ], 
QA
 - 16 );

370 
ƒg
 = 
	`sûk_SMLAWW
–ƒg, 
CAf
[ 
k
 + 1 ], 
Atmp1
 );

371 
tmp1
 = 
	`sûk_SMLAWW
–tmp1, 
Atmp1
, Atmp1 );

372 
A_Q16
[ 
k
 ] = -
Atmp1
;

374 *
ªs_ƒg
 = 
	`sûk_SMLAWW
–
ƒg
, 
	`sûk_SMMUL
–
	`SILK_FIX_CONST
–
FIND_LPC_COND_FAC
, 32 ), 
C0
 ), -
tmp1
 );

375 *
ªs_ƒg_Q
 = -
rshi·s
;

377 
	}
}

	@silk/fixed/x86/prefilter_FIX_sse.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"maö.h
"

36 
	~"˚…/x86/x86˝u.h
"

38 
	$sûk_w¨≥d_LPC_™Æysis_fûãr_FIX_s£4_1
(

39 
›us_öt32
 
°©e
[],

40 
›us_öt32
 
ªs_Q2
[],

41 c⁄° 
›us_öt16
 
c€f_Q13
[],

42 c⁄° 
›us_öt16
 
öput
[],

43 c⁄° 
›us_öt16
 
œmbda_Q16
,

44 c⁄° 
›us_öt
 
Àngth
,

45 c⁄° 
›us_öt
 
‹dî


48 
›us_öt
 
n
, 
i
;

49 
›us_öt32
 
acc_Q11
, 
tmp1
, 
tmp2
;

52 
	`˚…_as£π
––
‹dî
 & 1 ) == 0 );

54 i‡(
‹dî
 == 10)

56 i‡(0 =
œmbda_Q16
)

58 
__m128i
 
c€f_Q13_3210
, 
c€f_Q13_7654
;

59 
__m128i
 
c€f_Q13_0123
, 
c€f_Q13_4567
;

60 
__m128i
 
°©e_0123
, 
°©e_4567
;

61 
__m128i
 
xmm_¥odu˘1
, 
xmm_¥odu˘2
;

62 
__m128i
 
xmm_ãm∑
, 
xmm_ãmpb
;

64 
›us_öt32
 
sum
;

65 
›us_öt32
 
°©e_8
, 
°©e_9
, 
°©e_a
;

66 
›us_öt64
 
c€f_Q13_8
, 
c€f_Q13_9
;

68 
	`˚…_as£π
–
Àngth
 > 0 );

70 
c€f_Q13_3210
 = 
	`OP_CVTEPI16_EPI32_M64
–&
c€f_Q13
[ 0 ] );

71 
c€f_Q13_7654
 = 
	`OP_CVTEPI16_EPI32_M64
–&
c€f_Q13
[ 4 ] );

73 
c€f_Q13_0123
 = 
	`_mm_shufÊe_ïi32
–
c€f_Q13_3210
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

74 
c€f_Q13_4567
 = 
	`_mm_shufÊe_ïi32
–
c€f_Q13_7654
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

76 
c€f_Q13_8
 = (
›us_öt64
Ë
c€f_Q13
[ 8 ];

77 
c€f_Q13_9
 = (
›us_öt64
Ë
c€f_Q13
[ 9 ];

79 
°©e_0123
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
°©e
[ 0 ] ) );

80 
°©e_4567
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
°©e
[ 4 ] ) );

82 
°©e_0123
 = 
	`_mm_shufÊe_ïi32
–°©e_0123, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

83 
°©e_4567
 = 
	`_mm_shufÊe_ïi32
–°©e_4567, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

85 
°©e_8
 = 
°©e
[ 8 ];

86 
°©e_9
 = 
°©e
[ 9 ];

87 
°©e_a
 = 0;

89  
n
 = 0;Ç < 
Àngth
;Ç++ )

91 
xmm_¥odu˘1
 = 
	`_mm_mul_ïi32
–
c€f_Q13_0123
, 
°©e_0123
 );

92 
xmm_¥odu˘2
 = 
	`_mm_mul_ïi32
–
c€f_Q13_4567
, 
°©e_4567
 );

94 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi32
–
°©e_0123
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

95 
xmm_ãmpb
 = 
	`_mm_shufÊe_ïi32
–
°©e_4567
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) );

97 
xmm_¥odu˘1
 = 
	`_mm_§li_ïi64
( xmm_product1, 16 );

98 
xmm_¥odu˘2
 = 
	`_mm_§li_ïi64
( xmm_product2, 16 );

100 
xmm_ãm∑
 = 
	`_mm_mul_ïi32
–
c€f_Q13_3210
, xmm_tempa );

101 
xmm_ãmpb
 = 
	`_mm_mul_ïi32
–
c€f_Q13_7654
, xmm_tempb );

103 
xmm_ãm∑
 = 
	`_mm_§li_ïi64
( xmm_tempa, 16 );

104 
xmm_ãmpb
 = 
	`_mm_§li_ïi64
( xmm_tempb, 16 );

106 
xmm_ãm∑
 = 
	`_mm_add_ïi32
–xmm_ãm∑, 
xmm_¥odu˘1
 );

107 
xmm_ãmpb
 = 
	`_mm_add_ïi32
–xmm_ãmpb, 
xmm_¥odu˘2
 );

108 
xmm_ãm∑
 = 
	`_mm_add_ïi32
–xmm_ãm∑, 
xmm_ãmpb
 );

110 
sum
 = (
›us_öt32
)((
c€f_Q13_8
 * 
°©e_8
) >> 16);

111 
sum
 +(
›us_öt32
)((
c€f_Q13_9
 * 
°©e_9
) >> 16);

113 
xmm_ãm∑
 = 
	`_mm_add_ïi32
–xmm_ãm∑, 
	`_mm_shufÊe_ïi32
–xmm_ãm∑, 
	`_MM_SHUFFLE
( 0, 0, 0, 2 ) ) );

114 
sum
 +
	`_mm_cvtsi128_si32
–
xmm_ãm∑
);

115 
ªs_Q2
[ 
n
 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
öput
[Ç ], 2 ) - 
	`sûk_RSHIFT_ROUND
––5 + 
sum
 ), 9);

118 
°©e_a
 = 
°©e_9
;

119 
°©e_9
 = 
°©e_8
;

120 
°©e_8
 = 
	`_mm_cvtsi128_si32
–
°©e_4567
 );

121 
°©e_4567
 = 
	`_mm_Æigƒ_ïi8
–
°©e_0123
, state_4567, 4 );

123 
°©e_0123
 = 
	`_mm_Æigƒ_ïi8
–
	`_mm_cvtsi32_si128
–
	`sûk_LSHIFT
–
öput
[ 
n
 ], 14 ) ), state_0123, 4 );

126 
	`_mm_°‹eu_si128
–(
__m128i
 *)–&
°©e
[ 0 ] ), 
	`_mm_shufÊe_ïi32
–
°©e_0123
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) ) );

127 
	`_mm_°‹eu_si128
–(
__m128i
 *)–&
°©e
[ 4 ] ), 
	`_mm_shufÊe_ïi32
–
°©e_4567
, 
	`_MM_SHUFFLE
( 0, 1, 2, 3 ) ) );

128 
°©e
[ 8 ] = 
°©e_8
;

129 
°©e
[ 9 ] = 
°©e_9
;

130 
°©e
[ 10 ] = 
°©e_a
;

136  
n
 = 0;Ç < 
Àngth
;Ç++ ) {

138 
tmp2
 = 
	`sûk_SMLAWB
–
°©e
[ 0 ], sèã[ 1 ], 
œmbda_Q16
 );

139 
°©e
[ 0 ] = 
	`sûk_LSHIFT
–
öput
[ 
n
 ], 14 );

141 
tmp1
 = 
	`sûk_SMLAWB
–
°©e
[ 1 ], sèã[ 2 ] - 
tmp2
, 
œmbda_Q16
 );

142 
°©e
[ 1 ] = 
tmp2
;

143 
acc_Q11
 = 
	`sûk_RSHIFT
–
‹dî
, 1 );

144 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp2
, 
c€f_Q13
[ 0 ] );

146  
i
 = 2; i < 
‹dî
; i += 2 ) {

148 
tmp2
 = 
	`sûk_SMLAWB
–
°©e
[ 
i
 ], sèã[ i + 1 ] - 
tmp1
, 
œmbda_Q16
 );

149 
°©e
[ 
i
 ] = 
tmp1
;

150 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp1
, 
c€f_Q13
[ 
i
 - 1 ] );

152 
tmp1
 = 
	`sûk_SMLAWB
–
°©e
[ 
i
 + 1 ], sèã[ i + 2 ] - 
tmp2
, 
œmbda_Q16
 );

153 
°©e
[ 
i
 + 1 ] = 
tmp2
;

154 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp2
, 
c€f_Q13
[ 
i
 ] );

156 
°©e
[ 
‹dî
 ] = 
tmp1
;

157 
acc_Q11
 = 
	`sûk_SMLAWB
–acc_Q11, 
tmp1
, 
c€f_Q13
[ 
‹dî
 - 1 ] );

158 
ªs_Q2
[ 
n
 ] = 
	`sûk_LSHIFT
–(
›us_öt32
)
öput
[Ç ], 2 ) - 
	`sûk_RSHIFT_ROUND
–
acc_Q11
, 9 );

160 
	}
}

	@silk/fixed/x86/vector_ops_FIX_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"maö.h
"

37 
	~"SigProc_FIX.h
"

38 
	~"pôch.h
"

40 
›us_öt64
 
	$sûk_ö√r_¥od16_Æig√d_64_s£4_1
(

41 c⁄° 
›us_öt16
 *
öVec1
,

42 c⁄° 
›us_öt16
 *
öVec2
,

43 c⁄° 
›us_öt
 
Àn


46 
›us_öt
 
i
, 
d©aSize8
;

47 
›us_öt64
 
sum
;

49 
__m128i
 
xmm_ãm∑
;

50 
__m128i
 
öVec1_76543210
, 
acc1
;

51 
__m128i
 
öVec2_76543210
, 
acc2
;

53 
sum
 = 0;

54 
d©aSize8
 = 
Àn
 & ~7;

56 
acc1
 = 
	`_mm_£tzîo_si128
();

57 
acc2
 = 
	`_mm_£tzîo_si128
();

59  
i
 = 0; i < 
d©aSize8
; i += 8 ) {

60 
öVec1_76543210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
öVec1
[
i
 + 0] ) );

61 
öVec2_76543210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
öVec2
[
i
 + 0] ) );

64 
öVec1_76543210
 = 
	`_mm_madd_ïi16
–öVec1_76543210, 
öVec2_76543210
 );

66 
xmm_ãm∑
 = 
	`_mm_cvãpi32_ïi64
–
öVec1_76543210
 );

68 
öVec1_76543210
 = 
	`_mm_shufÊe_ïi32
–öVec1_76543210, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

69 
öVec1_76543210
 = 
	`_mm_cvãpi32_ïi64
( inVec1_76543210 );

71 
acc1
 = 
	`_mm_add_ïi64
–acc1, 
xmm_ãm∑
 );

72 
acc2
 = 
	`_mm_add_ïi64
–acc2, 
öVec1_76543210
 );

75 
acc1
 = 
	`_mm_add_ïi64
–acc1, 
acc2
 );

78 
acc2
 = 
	`_mm_shufÊe_ïi32
–
acc1
, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

79 
acc1
 = 
	`_mm_add_ïi64
–acc1, 
acc2
 );

81 
	`_mm_°‹ñ_ïi64
–(
__m128i
 *)&
sum
, 
acc1
 );

83  ; 
i
 < 
Àn
; i++ ) {

84 
sum
 = 
	`sûk_SMLABB
–sum, 
öVec1
[ 
i
 ], 
öVec2
[ i ] );

87  
sum
;

88 
	}
}

	@silk/float/LPC_analysis_filter_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dlib.h
>

33 
	~"maö_FLP.h
"

43 
OPUS_INLINE
 
	$sûk_LPC_™Æysis_fûãr16_FLP
(

44 
sûk_Êﬂt
 
r_LPC
[],

45 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

46 c⁄° 
sûk_Êﬂt
 
s
[],

47 c⁄° 
›us_öt
 
Àngth


50 
›us_öt
 
ix
;

51 
sûk_Êﬂt
 
LPC_¥ed
;

52 c⁄° 
sûk_Êﬂt
 *
s_±r
;

54  
ix
 = 16; ix < 
Àngth
; ix++ ) {

55 
s_±r
 = &
s
[
ix
 - 1];

58 
LPC_¥ed
 = 
s_±r
[ 0 ] * 
PªdC€f
[ 0 ] +

59 
s_±r
[ -1 ] * 
PªdC€f
[ 1 ] +

60 
s_±r
[ -2 ] * 
PªdC€f
[ 2 ] +

61 
s_±r
[ -3 ] * 
PªdC€f
[ 3 ] +

62 
s_±r
[ -4 ] * 
PªdC€f
[ 4 ] +

63 
s_±r
[ -5 ] * 
PªdC€f
[ 5 ] +

64 
s_±r
[ -6 ] * 
PªdC€f
[ 6 ] +

65 
s_±r
[ -7 ] * 
PªdC€f
[ 7 ] +

66 
s_±r
[ -8 ] * 
PªdC€f
[ 8 ] +

67 
s_±r
[ -9 ] * 
PªdC€f
[ 9 ] +

68 
s_±r
[ -10 ] * 
PªdC€f
[ 10 ] +

69 
s_±r
[ -11 ] * 
PªdC€f
[ 11 ] +

70 
s_±r
[ -12 ] * 
PªdC€f
[ 12 ] +

71 
s_±r
[ -13 ] * 
PªdC€f
[ 13 ] +

72 
s_±r
[ -14 ] * 
PªdC€f
[ 14 ] +

73 
s_±r
[ -15 ] * 
PªdC€f
[ 15 ];

76 
r_LPC
[
ix
] = 
s_±r
[ 1 ] - 
LPC_¥ed
;

78 
	}
}

81 
OPUS_INLINE
 
	$sûk_LPC_™Æysis_fûãr12_FLP
(

82 
sûk_Êﬂt
 
r_LPC
[],

83 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

84 c⁄° 
sûk_Êﬂt
 
s
[],

85 c⁄° 
›us_öt
 
Àngth


88 
›us_öt
 
ix
;

89 
sûk_Êﬂt
 
LPC_¥ed
;

90 c⁄° 
sûk_Êﬂt
 *
s_±r
;

92  
ix
 = 12; ix < 
Àngth
; ix++ ) {

93 
s_±r
 = &
s
[
ix
 - 1];

96 
LPC_¥ed
 = 
s_±r
[ 0 ] * 
PªdC€f
[ 0 ] +

97 
s_±r
[ -1 ] * 
PªdC€f
[ 1 ] +

98 
s_±r
[ -2 ] * 
PªdC€f
[ 2 ] +

99 
s_±r
[ -3 ] * 
PªdC€f
[ 3 ] +

100 
s_±r
[ -4 ] * 
PªdC€f
[ 4 ] +

101 
s_±r
[ -5 ] * 
PªdC€f
[ 5 ] +

102 
s_±r
[ -6 ] * 
PªdC€f
[ 6 ] +

103 
s_±r
[ -7 ] * 
PªdC€f
[ 7 ] +

104 
s_±r
[ -8 ] * 
PªdC€f
[ 8 ] +

105 
s_±r
[ -9 ] * 
PªdC€f
[ 9 ] +

106 
s_±r
[ -10 ] * 
PªdC€f
[ 10 ] +

107 
s_±r
[ -11 ] * 
PªdC€f
[ 11 ];

110 
r_LPC
[
ix
] = 
s_±r
[ 1 ] - 
LPC_¥ed
;

112 
	}
}

115 
OPUS_INLINE
 
	$sûk_LPC_™Æysis_fûãr10_FLP
(

116 
sûk_Êﬂt
 
r_LPC
[],

117 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

118 c⁄° 
sûk_Êﬂt
 
s
[],

119 c⁄° 
›us_öt
 
Àngth


122 
›us_öt
 
ix
;

123 
sûk_Êﬂt
 
LPC_¥ed
;

124 c⁄° 
sûk_Êﬂt
 *
s_±r
;

126  
ix
 = 10; ix < 
Àngth
; ix++ ) {

127 
s_±r
 = &
s
[
ix
 - 1];

130 
LPC_¥ed
 = 
s_±r
[ 0 ] * 
PªdC€f
[ 0 ] +

131 
s_±r
[ -1 ] * 
PªdC€f
[ 1 ] +

132 
s_±r
[ -2 ] * 
PªdC€f
[ 2 ] +

133 
s_±r
[ -3 ] * 
PªdC€f
[ 3 ] +

134 
s_±r
[ -4 ] * 
PªdC€f
[ 4 ] +

135 
s_±r
[ -5 ] * 
PªdC€f
[ 5 ] +

136 
s_±r
[ -6 ] * 
PªdC€f
[ 6 ] +

137 
s_±r
[ -7 ] * 
PªdC€f
[ 7 ] +

138 
s_±r
[ -8 ] * 
PªdC€f
[ 8 ] +

139 
s_±r
[ -9 ] * 
PªdC€f
[ 9 ];

142 
r_LPC
[
ix
] = 
s_±r
[ 1 ] - 
LPC_¥ed
;

144 
	}
}

147 
OPUS_INLINE
 
	$sûk_LPC_™Æysis_fûãr8_FLP
(

148 
sûk_Êﬂt
 
r_LPC
[],

149 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

150 c⁄° 
sûk_Êﬂt
 
s
[],

151 c⁄° 
›us_öt
 
Àngth


154 
›us_öt
 
ix
;

155 
sûk_Êﬂt
 
LPC_¥ed
;

156 c⁄° 
sûk_Êﬂt
 *
s_±r
;

158  
ix
 = 8; ix < 
Àngth
; ix++ ) {

159 
s_±r
 = &
s
[
ix
 - 1];

162 
LPC_¥ed
 = 
s_±r
[ 0 ] * 
PªdC€f
[ 0 ] +

163 
s_±r
[ -1 ] * 
PªdC€f
[ 1 ] +

164 
s_±r
[ -2 ] * 
PªdC€f
[ 2 ] +

165 
s_±r
[ -3 ] * 
PªdC€f
[ 3 ] +

166 
s_±r
[ -4 ] * 
PªdC€f
[ 4 ] +

167 
s_±r
[ -5 ] * 
PªdC€f
[ 5 ] +

168 
s_±r
[ -6 ] * 
PªdC€f
[ 6 ] +

169 
s_±r
[ -7 ] * 
PªdC€f
[ 7 ];

172 
r_LPC
[
ix
] = 
s_±r
[ 1 ] - 
LPC_¥ed
;

174 
	}
}

177 
OPUS_INLINE
 
	$sûk_LPC_™Æysis_fûãr6_FLP
(

178 
sûk_Êﬂt
 
r_LPC
[],

179 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

180 c⁄° 
sûk_Êﬂt
 
s
[],

181 c⁄° 
›us_öt
 
Àngth


184 
›us_öt
 
ix
;

185 
sûk_Êﬂt
 
LPC_¥ed
;

186 c⁄° 
sûk_Êﬂt
 *
s_±r
;

188  
ix
 = 6; ix < 
Àngth
; ix++ ) {

189 
s_±r
 = &
s
[
ix
 - 1];

192 
LPC_¥ed
 = 
s_±r
[ 0 ] * 
PªdC€f
[ 0 ] +

193 
s_±r
[ -1 ] * 
PªdC€f
[ 1 ] +

194 
s_±r
[ -2 ] * 
PªdC€f
[ 2 ] +

195 
s_±r
[ -3 ] * 
PªdC€f
[ 3 ] +

196 
s_±r
[ -4 ] * 
PªdC€f
[ 4 ] +

197 
s_±r
[ -5 ] * 
PªdC€f
[ 5 ];

200 
r_LPC
[
ix
] = 
s_±r
[ 1 ] - 
LPC_¥ed
;

202 
	}
}

210 
	$sûk_LPC_™Æysis_fûãr_FLP
(

211 
sûk_Êﬂt
 
r_LPC
[],

212 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

213 c⁄° 
sûk_Êﬂt
 
s
[],

214 c⁄° 
›us_öt
 
Àngth
,

215 c⁄° 
›us_öt
 
Ordî


218 
	`˚…_as£π
–
Ordî
 <
Àngth
 );

220  
Ordî
 ) {

222 
	`sûk_LPC_™Æysis_fûãr6_FLP
–
r_LPC
, 
PªdC€f
, 
s
, 
Àngth
 );

226 
	`sûk_LPC_™Æysis_fûãr8_FLP
–
r_LPC
, 
PªdC€f
, 
s
, 
Àngth
 );

230 
	`sûk_LPC_™Æysis_fûãr10_FLP
–
r_LPC
, 
PªdC€f
, 
s
, 
Àngth
 );

234 
	`sûk_LPC_™Æysis_fûãr12_FLP
–
r_LPC
, 
PªdC€f
, 
s
, 
Àngth
 );

238 
	`sûk_LPC_™Æysis_fûãr16_FLP
–
r_LPC
, 
PªdC€f
, 
s
, 
Àngth
 );

242 
	`˚…_as£π
( 0 );

247 
	`sûk_mem£t
–
r_LPC
, 0, 
Ordî
 * –
sûk_Êﬂt
 ) );

248 
	}
}

	@silk/float/LPC_inv_pred_gain_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"SigProc_FLP.h
"

34 
	~"deföe.h
"

39 
sûk_Êﬂt
 
	$sûk_LPC_övî£_¥ed_gaö_FLP
(

40 c⁄° 
sûk_Êﬂt
 *
A
,

41 
›us_öt32
 
‹dî


44 
›us_öt
 
k
, 
n
;

45 
övGaö
, 
rc
, 
rc_mu…1
, 
rc_mu…2
, 
tmp1
, 
tmp2
;

46 
sûk_Êﬂt
 
Atmp
[ 
SILK_MAX_ORDER_LPC
 ];

48 
	`sûk_mem˝y
–
Atmp
, 
A
, 
‹dî
 * (
sûk_Êﬂt
) );

50 
övGaö
 = 1.0;

51  
k
 = 
‹dî
 - 1; k > 0; k-- ) {

52 
rc
 = -
Atmp
[ 
k
 ];

53 
rc_mu…1
 = 1.0‡- 
rc
 *Ñc;

54 
övGaö
 *
rc_mu…1
;

55 if–
övGaö
 * 
MAX_PREDICTION_POWER_GAIN
 < 1.0f ) {

58 
rc_mu…2
 = 1.0‡/ 
rc_mu…1
;

59  
n
 = 0;Ç < (
k
 + 1) >> 1;Ç++ ) {

60 
tmp1
 = 
Atmp
[ 
n
 ];

61 
tmp2
 = 
Atmp
[ 
k
 - 
n
 - 1 ];

62 
Atmp
[ 
n
 ] = (
sûk_Êﬂt
)––
tmp1
 - 
tmp2
 * 
rc
 ) * 
rc_mu…2
 );

63 
Atmp
[ 
k
 - 
n
 - 1 ] = (
sûk_Êﬂt
)––
tmp2
 - 
tmp1
 * 
rc
 ) * 
rc_mu…2
 );

66 
rc
 = -
Atmp
[ 0 ];

67 
rc_mu…1
 = 1.0‡- 
rc
 *Ñc;

68 
övGaö
 *
rc_mu…1
;

69 if–
övGaö
 * 
MAX_PREDICTION_POWER_GAIN
 < 1.0f ) {

72  (
sûk_Êﬂt
)
övGaö
;

73 
	}
}

	@silk/float/LTP_analysis_filter_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

34 
	$sûk_LTP_™Æysis_fûãr_FLP
(

35 
sûk_Êﬂt
 *
LTP_ªs
,

36 c⁄° 
sûk_Êﬂt
 *
x
,

37 c⁄° 
sûk_Êﬂt
 
B
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

38 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

39 c⁄° 
sûk_Êﬂt
 
övGaös
[ 
MAX_NB_SUBFR
 ],

40 c⁄° 
›us_öt
 
sub‰_Àngth
,

41 c⁄° 
›us_öt
 
nb_sub‰
,

42 c⁄° 
›us_öt
 
¥e_Àngth


45 c⁄° 
sûk_Êﬂt
 *
x_±r
, *
x_œg_±r
;

46 
sûk_Êﬂt
 
Btmp
[ 
LTP_ORDER
 ];

47 
sûk_Êﬂt
 *
LTP_ªs_±r
;

48 
sûk_Êﬂt
 
öv_gaö
;

49 
›us_öt
 
k
, 
i
, 
j
;

51 
x_±r
 = 
x
;

52 
LTP_ªs_±r
 = 
LTP_ªs
;

53  
k
 = 0; k < 
nb_sub‰
; k++ ) {

54 
x_œg_±r
 = 
x_±r
 - 
pôchL
[ 
k
 ];

55 
öv_gaö
 = 
övGaös
[ 
k
 ];

56  
i
 = 0; i < 
LTP_ORDER
; i++ ) {

57 
Btmp
[ 
i
 ] = 
B
[ 
k
 * 
LTP_ORDER
 + i ];

61  
i
 = 0; i < 
sub‰_Àngth
 + 
¥e_Àngth
; i++ ) {

62 
LTP_ªs_±r
[ 
i
 ] = 
x_±r
[ i ];

64  
j
 = 0; j < 
LTP_ORDER
; j++ ) {

65 
LTP_ªs_±r
[ 
i
 ] -
Btmp
[ 
j
 ] * 
x_œg_±r
[ 
LTP_ORDER
 / 2 - j ];

67 
LTP_ªs_±r
[ 
i
 ] *
öv_gaö
;

68 
x_œg_±r
++;

72 
LTP_ªs_±r
 +
sub‰_Àngth
 + 
¥e_Àngth
;

73 
x_±r
 +
sub‰_Àngth
;

75 
	}
}

	@silk/float/LTP_scale_ctrl_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

34 
	$sûk_LTP_sˇÀ_˘æ_FLP
(

35 
sûk_ícodî_°©e_FLP
 *
psEnc
,

36 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

37 
›us_öt
 
c⁄dCodög


40 
›us_öt
 
round_loss
;

42 if–
c⁄dCodög
 =
CODE_INDEPENDENTLY
 ) {

44 
round_loss
 = 
psEnc
->
sCmn
.
PackëLoss_≥rc
 +ÖsEnc->sCmn.
nFømesPîPackë
;

45 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 = (
›us_öt8
)
	`sûk_LIMIT
–
round_loss
 * 
psEncCål
->
LTPªdCodGaö
 * 0.1f, 0.0f, 2.0f );

48 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 = 0;

51 
psEncCål
->
LTP_sˇÀ
 = (
sûk_Êﬂt
)
sûk_LTPSˇÀs_èbÀ_Q14
[ 
psEnc
->
sCmn
.
ödi˚s
.
LTP_sˇÀIndex
 ] / 16384.0f;

52 
	}
}

	@silk/float/SigProc_FLP.h

28 #i‚de‡
SILK_SIGPROC_FLP_H


29 
	#SILK_SIGPROC_FLP_H


	)

31 
	~"SigProc_FIX.h
"

32 
	~"Êﬂt_ˇ°.h
"

33 
	~<m©h.h
>

35 #ifde‡ 
__˝lu•lus


45 
sûk_bwex∑ndî_FLP
(

46 
sûk_Êﬂt
 *
¨
,

47 c⁄° 
›us_öt
 
d
,

48 c⁄° 
sûk_Êﬂt
 
chúp


54 
sûk_Êﬂt
 
sûk_LPC_övî£_¥ed_gaö_FLP
(

55 c⁄° 
sûk_Êﬂt
 *
A
,

56 
›us_öt32
 
‹dî


59 
sûk_Êﬂt
 
sûk_schur_FLP
(

60 
sûk_Êﬂt
 
ªÊ_c€f
[],

61 c⁄° 
sûk_Êﬂt
 
auto_c‹r
[],

62 
›us_öt
 
‹dî


65 
sûk_k2a_FLP
(

66 
sûk_Êﬂt
 *
A
,

67 c⁄° 
sûk_Êﬂt
 *
rc
,

68 
›us_öt32
 
‹dî


72 
sûk_autoc‹ªœti⁄_FLP
(

73 
sûk_Êﬂt
 *
ªsu…s
,

74 c⁄° 
sûk_Êﬂt
 *
öputD©a
,

75 
›us_öt
 
öputD©aSize
,

76 
›us_öt
 
c‹ªœti⁄Cou¡


79 
›us_öt
 
sûk_pôch_™Æysis_c‹e_FLP
(

80 c⁄° 
sûk_Êﬂt
 *
‰ame
,

81 
›us_öt
 *
pôch_out
,

82 
›us_öt16
 *
œgIndex
,

83 
›us_öt8
 *
c⁄tourIndex
,

84 
sûk_Êﬂt
 *
LTPC‹r
,

85 
›us_öt
 
¥evLag
,

86 c⁄° 
sûk_Êﬂt
 
£¨ch_thªs1
,

87 c⁄° 
sûk_Êﬂt
 
£¨ch_thªs2
,

88 c⁄° 
›us_öt
 
Fs_kHz
,

89 c⁄° 
›us_öt
 
com∂exôy
,

90 c⁄° 
›us_öt
 
nb_sub‰
,

91 
¨ch


94 
sûk_ö£πi⁄_s‹t_de¸ósög_FLP
(

95 
sûk_Êﬂt
 *
a
,

96 
›us_öt
 *
idx
,

97 c⁄° 
›us_öt
 
L
,

98 c⁄° 
›us_öt
 
K


102 
sûk_Êﬂt
 
sûk_burg_modifõd_FLP
(

103 
sûk_Êﬂt
 
A
[],

104 c⁄° 
sûk_Êﬂt
 
x
[],

105 c⁄° 
sûk_Êﬂt
 
möInvGaö
,

106 c⁄° 
›us_öt
 
sub‰_Àngth
,

107 c⁄° 
›us_öt
 
nb_sub‰
,

108 c⁄° 
›us_öt
 
D


112 
sûk_sˇÀ_ve˘‹_FLP
(

113 
sûk_Êﬂt
 *
d©a1
,

114 
sûk_Êﬂt
 
gaö
,

115 
›us_öt
 
d©aSize


119 
sûk_sˇÀ_c›y_ve˘‹_FLP
(

120 
sûk_Êﬂt
 *
d©a_out
,

121 c⁄° 
sûk_Êﬂt
 *
d©a_ö
,

122 
sûk_Êﬂt
 
gaö
,

123 
›us_öt
 
d©aSize


127 
sûk_ö√r_¥odu˘_FLP
(

128 c⁄° 
sûk_Êﬂt
 *
d©a1
,

129 c⁄° 
sûk_Êﬂt
 *
d©a2
,

130 
›us_öt
 
d©aSize


134 
sûk_íîgy_FLP
(

135 c⁄° 
sûk_Êﬂt
 *
d©a
,

136 
›us_öt
 
d©aSize


143 
	#PI
 (3.1415926536f)

	)

145 
	#sûk_mö_Êﬂt
–
a
, 
b
 ) ((◊Ë< (b)Ë? (aË: (b))

	)

146 
	#sûk_max_Êﬂt
–
a
, 
b
 ) ((◊Ë> (b)Ë? (aË: (b))

	)

147 
	#sûk_abs_Êﬂt
–
a
 ) ((
sûk_Êﬂt
)
	`Ábs
◊))

	)

150 
OPUS_INLINE
 
sûk_Êﬂt
 
sûk_sigmoid
–sûk_Êﬂà
x
 )

152  (
sûk_Êﬂt
)(1.0 / (1.0 + 
exp
(-
x
)));

156 
OPUS_INLINE
 
›us_öt32
 
sûk_Êﬂt2öt
–
sûk_Êﬂt
 
x
 )

158  (
›us_öt32
)
Êﬂt2öt
–
x
 );

162 
OPUS_INLINE
 
sûk_Êﬂt2sh‹t_¨øy
(

163 
›us_öt16
 *
out
,

164 c⁄° 
sûk_Êﬂt
 *
ö
,

165 
›us_öt32
 
Àngth


168 
›us_öt32
 
k
;

169  
k
 = 
Àngth
 - 1; k >= 0; k-- ) {

170 
out
[
k
] = 
sûk_SAT16
–(
›us_öt32
)
Êﬂt2öt
–
ö
[k] ) );

175 
OPUS_INLINE
 
sûk_sh‹t2Êﬂt_¨øy
(

176 
sûk_Êﬂt
 *
out
,

177 c⁄° 
›us_öt16
 *
ö
,

178 
›us_öt32
 
Àngth


181 
›us_öt32
 
k
;

182  
k
 = 
Àngth
 - 1; k >= 0; k-- ) {

183 
out
[
k
] = (
sûk_Êﬂt
)
ö
[k];

188 
OPUS_INLINE
 
sûk_Êﬂt
 
sûk_log2
–
x
 )

190  ( 
sûk_Êﬂt
 )–3.32192809488736 * 
log10
–
x
 ) );

193 #ifde‡ 
__˝lu•lus


	@silk/float/apply_sine_window_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

38 
	$sûk_≠∂y_söe_wödow_FLP
(

39 
sûk_Êﬂt
 
px_wö
[],

40 c⁄° 
sûk_Êﬂt
 
px
[],

41 c⁄° 
›us_öt
 
wö_ty≥
,

42 c⁄° 
›us_öt
 
Àngth


45 
›us_öt
 
k
;

46 
sûk_Êﬂt
 
‰eq
, 
c
, 
S0
, 
S1
;

48 
	`˚…_as£π
–
wö_ty≥
 == 1 || win_type == 2 );

51 
	`˚…_as£π
––
Àngth
 & 3 ) == 0 );

53 
‰eq
 = 
PI
 / ( 
Àngth
 + 1 );

56 
c
 = 2.0‡- 
‰eq
 * freq;

59 if–
wö_ty≥
 < 2 ) {

61 
S0
 = 0.0f;

63 
S1
 = 
‰eq
;

66 
S0
 = 1.0f;

68 
S1
 = 0.5‡* 
c
;

73  
k
 = 0; k < 
Àngth
; k += 4 ) {

74 
px_wö
[ 
k
 + 0 ] = 
px
[ k + 0 ] * 0.5‡* ( 
S0
 + 
S1
 );

75 
px_wö
[ 
k
 + 1 ] = 
px
[ k + 1 ] * 
S1
;

76 
S0
 = 
c
 * 
S1
 - S0;

77 
px_wö
[ 
k
 + 2 ] = 
px
[ k + 2 ] * 0.5‡* ( 
S1
 + 
S0
 );

78 
px_wö
[ 
k
 + 3 ] = 
px
[ k + 3 ] * 
S0
;

79 
S1
 = 
c
 * 
S0
 - S1;

81 
	}
}

	@silk/float/autocorrelation_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"ty≥def.h
"

33 
	~"SigProc_FLP.h
"

36 
	$sûk_autoc‹ªœti⁄_FLP
(

37 
sûk_Êﬂt
 *
ªsu…s
,

38 c⁄° 
sûk_Êﬂt
 *
öputD©a
,

39 
›us_öt
 
öputD©aSize
,

40 
›us_öt
 
c‹ªœti⁄Cou¡


43 
›us_öt
 
i
;

45 if–
c‹ªœti⁄Cou¡
 > 
öputD©aSize
 ) {

46 
c‹ªœti⁄Cou¡
 = 
öputD©aSize
;

49  
i
 = 0; i < 
c‹ªœti⁄Cou¡
; i++ ) {

50 
ªsu…s
[ 
i
 ] = (
sûk_Êﬂt
)
	`sûk_ö√r_¥odu˘_FLP
–
öputD©a
, i≈utD©®+ i, 
öputD©aSize
 - i );

52 
	}
}

	@silk/float/burg_modified_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

33 
	~"tunög_∑ømëîs.h
"

34 
	~"deföe.h
"

36 
	#MAX_FRAME_SIZE
 384

	)

39 
sûk_Êﬂt
 
	$sûk_burg_modifõd_FLP
(

40 
sûk_Êﬂt
 
A
[],

41 c⁄° 
sûk_Êﬂt
 
x
[],

42 c⁄° 
sûk_Êﬂt
 
möInvGaö
,

43 c⁄° 
›us_öt
 
sub‰_Àngth
,

44 c⁄° 
›us_öt
 
nb_sub‰
,

45 c⁄° 
›us_öt
 
D


48 
›us_öt
 
k
, 
n
, 
s
, 
ªached_max_gaö
;

49 
C0
, 
övGaö
, 
num
, 
ƒg_f
, 
ƒg_b
, 
rc
, 
Atmp
, 
tmp1
, 
tmp2
;

50 c⁄° 
sûk_Êﬂt
 *
x_±r
;

51 
C_fú°_row
[ 
SILK_MAX_ORDER_LPC
 ], 
C_œ°_row
[ SILK_MAX_ORDER_LPC ];

52 
CAf
[ 
SILK_MAX_ORDER_LPC
 + 1 ], 
CAb
[ SILK_MAX_ORDER_LPC + 1 ];

53 
Af
[ 
SILK_MAX_ORDER_LPC
 ];

55 
	`˚…_as£π
–
sub‰_Àngth
 * 
nb_sub‰
 <
MAX_FRAME_SIZE
 );

58 
C0
 = 
	`sûk_íîgy_FLP
–
x
, 
nb_sub‰
 * 
sub‰_Àngth
 );

59 
	`sûk_mem£t
–
C_fú°_row
, 0, 
SILK_MAX_ORDER_LPC
 * ( ) );

60  
s
 = 0; s < 
nb_sub‰
; s++ ) {

61 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

62  
n
 = 1;Ç < 
D
 + 1;Ç++ ) {

63 
C_fú°_row
[ 
n
 - 1 ] +
	`sûk_ö√r_¥odu˘_FLP
–
x_±r
, x_±∏+Ç, 
sub‰_Àngth
 -Ç );

66 
	`sûk_mem˝y
–
C_œ°_row
, 
C_fú°_row
, 
SILK_MAX_ORDER_LPC
 * ( ) );

69 
CAb
[ 0 ] = 
CAf
[ 0 ] = 
C0
 + 
FIND_LPC_COND_FAC
 * C0 + 1e-9f;

70 
övGaö
 = 1.0f;

71 
ªached_max_gaö
 = 0;

72  
n
 = 0;Ç < 
D
;Ç++ ) {

77  
s
 = 0; s < 
nb_sub‰
; s++ ) {

78 
x_±r
 = 
x
 + 
s
 * 
sub‰_Àngth
;

79 
tmp1
 = 
x_±r
[ 
n
 ];

80 
tmp2
 = 
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ];

81  
k
 = 0; k < 
n
; k++ ) {

82 
C_fú°_row
[ 
k
 ] -
x_±r
[ 
n
 ] * x_ptr[Ç - k - 1 ];

83 
C_œ°_row
[ 
k
 ] -
x_±r
[ 
sub‰_Àngth
 - 
n
 - 1 ] * x_ptr[ subfr_length -Ç + k ];

84 
Atmp
 = 
Af
[ 
k
 ];

85 
tmp1
 +
x_±r
[ 
n
 - 
k
 - 1 ] * 
Atmp
;

86 
tmp2
 +
x_±r
[ 
sub‰_Àngth
 - 
n
 + 
k
 ] * 
Atmp
;

88  
k
 = 0; k <
n
; k++ ) {

89 
CAf
[ 
k
 ] -
tmp1
 * 
x_±r
[ 
n
 - k ];

90 
CAb
[ 
k
 ] -
tmp2
 * 
x_±r
[ 
sub‰_Àngth
 - 
n
 + k - 1 ];

93 
tmp1
 = 
C_fú°_row
[ 
n
 ];

94 
tmp2
 = 
C_œ°_row
[ 
n
 ];

95  
k
 = 0; k < 
n
; k++ ) {

96 
Atmp
 = 
Af
[ 
k
 ];

97 
tmp1
 +
C_œ°_row
[ 
n
 - 
k
 - 1 ] * 
Atmp
;

98 
tmp2
 +
C_fú°_row
[ 
n
 - 
k
 - 1 ] * 
Atmp
;

100 
CAf
[ 
n
 + 1 ] = 
tmp1
;

101 
CAb
[ 
n
 + 1 ] = 
tmp2
;

104 
num
 = 
CAb
[ 
n
 + 1 ];

105 
ƒg_b
 = 
CAb
[ 0 ];

106 
ƒg_f
 = 
CAf
[ 0 ];

107  
k
 = 0; k < 
n
; k++ ) {

108 
Atmp
 = 
Af
[ 
k
 ];

109 
num
 +
CAb
[ 
n
 - 
k
 ] * 
Atmp
;

110 
ƒg_b
 +
CAb
[ 
k
 + 1 ] * 
Atmp
;

111 
ƒg_f
 +
CAf
[ 
k
 + 1 ] * 
Atmp
;

113 
	`sûk_as£π
–
ƒg_f
 > 0.0 );

114 
	`sûk_as£π
–
ƒg_b
 > 0.0 );

117 
rc
 = -2.0 * 
num
 / ( 
ƒg_f
 + 
ƒg_b
 );

118 
	`sûk_as£π
–
rc
 > -1.0 &&Ñc < 1.0 );

121 
tmp1
 = 
övGaö
 * ( 1.0 - 
rc
 *Ñc );

122 if–
tmp1
 <
möInvGaö
 ) {

124 
rc
 = 
	`sqπ
–1.0 - 
möInvGaö
 / 
övGaö
 );

125 if–
num
 > 0 ) {

127 
rc
 = -rc;

129 
övGaö
 = 
möInvGaö
;

130 
ªached_max_gaö
 = 1;

132 
övGaö
 = 
tmp1
;

136  
k
 = 0; k < (
n
 + 1) >> 1; k++ ) {

137 
tmp1
 = 
Af
[ 
k
 ];

138 
tmp2
 = 
Af
[ 
n
 - 
k
 - 1 ];

139 
Af
[ 
k
 ] = 
tmp1
 + 
rc
 * 
tmp2
;

140 
Af
[ 
n
 - 
k
 - 1 ] = 
tmp2
 + 
rc
 * 
tmp1
;

142 
Af
[ 
n
 ] = 
rc
;

144 if–
ªached_max_gaö
 ) {

146  
k
 = 
n
 + 1; k < 
D
; k++ ) {

147 
Af
[ 
k
 ] = 0.0;

153  
k
 = 0; k <
n
 + 1; k++ ) {

154 
tmp1
 = 
CAf
[ 
k
 ];

155 
CAf
[ 
k
 ] +
rc
 * 
CAb
[ 
n
 - k + 1 ];

156 
CAb
[ 
n
 - 
k
 + 1 ] +
rc
 * 
tmp1
;

160 if–
ªached_max_gaö
 ) {

162  
k
 = 0; k < 
D
; k++ ) {

163 
A
[ 
k
 ] = (
sûk_Êﬂt
)–-
Af
[ k ] );

166  
s
 = 0; s < 
nb_sub‰
; s++ ) {

167 
C0
 -
	`sûk_íîgy_FLP
–
x
 + 
s
 * 
sub‰_Àngth
, 
D
 );

170 
ƒg_f
 = 
C0
 * 
övGaö
;

173 
ƒg_f
 = 
CAf
[ 0 ];

174 
tmp1
 = 1.0;

175  
k
 = 0; k < 
D
; k++ ) {

176 
Atmp
 = 
Af
[ 
k
 ];

177 
ƒg_f
 +
CAf
[ 
k
 + 1 ] * 
Atmp
;

178 
tmp1
 +
Atmp
 * Atmp;

179 
A
[ 
k
 ] = (
sûk_Êﬂt
)(-
Atmp
);

181 
ƒg_f
 -
FIND_LPC_COND_FAC
 * 
C0
 * 
tmp1
;

185  (
sûk_Êﬂt
)
ƒg_f
;

186 
	}
}

	@silk/float/bwexpander_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_bwex∑ndî_FLP
(

36 
sûk_Êﬂt
 *
¨
,

37 c⁄° 
›us_öt
 
d
,

38 c⁄° 
sûk_Êﬂt
 
chúp


41 
›us_öt
 
i
;

42 
sûk_Êﬂt
 
cÁc
 = 
chúp
;

44  
i
 = 0; i < 
d
 - 1; i++ ) {

45 
¨
[ 
i
 ] *
cÁc
;

46 
cÁc
 *
chúp
;

48 
¨
[ 
d
 - 1 ] *
cÁc
;

49 
	}
}

	@silk/float/corrMatrix_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

36 
	~"maö_FLP.h
"

39 
	$sûk_c‹rVe˘‹_FLP
(

40 c⁄° 
sûk_Êﬂt
 *
x
,

41 c⁄° 
sûk_Êﬂt
 *
t
,

42 c⁄° 
›us_öt
 
L
,

43 c⁄° 
›us_öt
 
Ordî
,

44 
sûk_Êﬂt
 *
Xt


47 
›us_öt
 
œg
;

48 c⁄° 
sûk_Êﬂt
 *
±r1
;

50 
±r1
 = &
x
[ 
Ordî
 - 1 ];

51  
œg
 = 0;Üag < 
Ordî
;Üag++ ) {

53 
Xt
[ 
œg
 ] = (
sûk_Êﬂt
)
	`sûk_ö√r_¥odu˘_FLP
–
±r1
, 
t
, 
L
 );

54 
±r1
--;

56 
	}
}

59 
	$sûk_c‹rM©rix_FLP
(

60 c⁄° 
sûk_Êﬂt
 *
x
,

61 c⁄° 
›us_öt
 
L
,

62 c⁄° 
›us_öt
 
Ordî
,

63 
sûk_Êﬂt
 *
XX


66 
›us_öt
 
j
, 
œg
;

67 
íîgy
;

68 c⁄° 
sûk_Êﬂt
 *
±r1
, *
±r2
;

70 
±r1
 = &
x
[ 
Ordî
 - 1 ];

71 
íîgy
 = 
	`sûk_íîgy_FLP
–
±r1
, 
L
 );

72 
	`m©rix_±r
–
XX
, 0, 0, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

73  
j
 = 1; j < 
Ordî
; j++ ) {

75 
íîgy
 +
±r1
[ -
j
 ] *Öå1[ -j ] -Öå1[ 
L
 - j ] *Ötr1[ L - j ];

76 
	`m©rix_±r
–
XX
, 
j
, j, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

79 
±r2
 = &
x
[ 
Ordî
 - 2 ];

80  
œg
 = 1;Üag < 
Ordî
;Üag++ ) {

82 
íîgy
 = 
	`sûk_ö√r_¥odu˘_FLP
–
±r1
, 
±r2
, 
L
 );

83 
	`m©rix_±r
–
XX
, 
œg
, 0, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

84 
	`m©rix_±r
–
XX
, 0, 
œg
, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

86  
j
 = 1; j < ( 
Ordî
 - 
œg
 ); j++ ) {

87 
íîgy
 +
±r1
[ -
j
 ] * 
±r2
[ -j ] -Öå1[ 
L
 - j ] *Ötr2[ L - j ];

88 
	`m©rix_±r
–
XX
, 
œg
 + 
j
, j, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

89 
	`m©rix_±r
–
XX
, 
j
, 
œg
 + j, 
Ordî
 ) = ( 
sûk_Êﬂt
 )
íîgy
;

91 
±r2
--;

93 
	}
}

	@silk/float/encode_frame_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dlib.h
>

33 
	~"maö_FLP.h
"

34 
	~"tunög_∑ømëîs.h
"

37 
OPUS_INLINE
 
sûk_LBRR_ícode_FLP
(

38 
sûk_ícodî_°©e_FLP
 *
psEnc
,

39 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

40 c⁄° 
sûk_Êﬂt
 
xfw
[],

41 
›us_öt
 
c⁄dCodög


44 
	$sûk_ícode_do_VAD_FLP
(

45 
sûk_ícodî_°©e_FLP
 *
psEnc
,

46 
›us_öt
 
a˘ivôy


49 c⁄° 
›us_öt
 
a˘ivôy_thªshﬁd
 = 
	`SILK_FIX_CONST
–
SPEECH_ACTIVITY_DTX_THRES
, 8 );

54 
	`sûk_VAD_GëSA_Q8
–&
psEnc
->
sCmn
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
¨ch
 );

56 if–
a˘ivôy
 =
VAD_NO_ACTIVITY
 && 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 >
a˘ivôy_thªshﬁd
 ) {

57 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 = 
a˘ivôy_thªshﬁd
 - 1;

63 if–
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 < 
a˘ivôy_thªshﬁd
 ) {

64 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_NO_VOICE_ACTIVITY
;

65 
psEnc
->
sCmn
.
noS≥echCou¡î
++;

66 if–
psEnc
->
sCmn
.
noS≥echCou¡î
 <
NB_SPEECH_FRAMES_BEFORE_DTX
 ) {

67 
psEnc
->
sCmn
.
öDTX
 = 0;

68 } if–
psEnc
->
sCmn
.
noS≥echCou¡î
 > 
MAX_CONSECUTIVE_DTX
 + 
NB_SPEECH_FRAMES_BEFORE_DTX
 ) {

69 
psEnc
->
sCmn
.
noS≥echCou¡î
 = 
NB_SPEECH_FRAMES_BEFORE_DTX
;

70 
psEnc
->
sCmn
.
öDTX
 = 0;

72 
psEnc
->
sCmn
.
VAD_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 0;

74 
psEnc
->
sCmn
.
noS≥echCou¡î
 = 0;

75 
psEnc
->
sCmn
.
öDTX
 = 0;

76 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_UNVOICED
;

77 
psEnc
->
sCmn
.
VAD_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 1;

79 
	}
}

84 
›us_öt
 
	$sûk_ícode_‰ame_FLP
(

85 
sûk_ícodî_°©e_FLP
 *
psEnc
,

86 
›us_öt32
 *
≤ByãsOut
,

87 
ec_íc
 *
psR™geEnc
,

88 
›us_öt
 
c⁄dCodög
,

89 
›us_öt
 
maxBôs
,

90 
›us_öt
 
u£CBR


93 
sûk_ícodî_c⁄åﬁ_FLP
 
sEncCål
;

94 
›us_öt
 
i
, 
ôî
, 
maxIãr
, 
found_uµî
, 
found_lowî
, 
ªt
 = 0;

95 
sûk_Êﬂt
 *
x_‰ame
, *
ªs_pôch_‰ame
;

96 
sûk_Êﬂt
 
ªs_pôch
[ 2 * 
MAX_FRAME_LENGTH
 + 
LA_PITCH_MAX
 ];

97 
ec_íc
 
sR™geEnc_c›y
, 
sR™geEnc_c›y2
;

98 
sûk_nsq_°©e
 
sNSQ_c›y
, 
sNSQ_c›y2
;

99 
›us_öt32
 
£ed_c›y
, 
nBôs
, 
nBôs_lowî
, 
nBôs_uµî
, 
gaöMu…_lowî
, 
gaöMu…_uµî
;

100 
›us_öt32
 
gaösID
, 
gaösID_lowî
, 
gaösID_uµî
;

101 
›us_öt16
 
gaöMu…_Q8
;

102 
›us_öt16
 
ec_¥evLagIndex_c›y
;

103 
›us_öt
 
ec_¥evSig«lTy≥_c›y
;

104 
›us_öt8
 
La°GaöIndex_c›y2
;

105 
›us_öt32
 
pGaös_Q16
[ 
MAX_NB_SUBFR
 ];

106 
›us_uöt8
 
ec_buf_c›y
[ 1275 ];

107 
›us_öt
 
gaö_lock
[ 
MAX_NB_SUBFR
 ] = {0};

108 
›us_öt16
 
be°_gaö_mu…
[ 
MAX_NB_SUBFR
 ];

109 
›us_öt
 
be°_sum
[ 
MAX_NB_SUBFR
 ];

112 
La°GaöIndex_c›y2
 = 
nBôs_lowî
 = 
nBôs_uµî
 = 
gaöMu…_lowî
 = 
gaöMu…_uµî
 = 0;

114 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
 =ÖsEnc->sCmn.
‰ameCou¡î
++ & 3;

120 
x_‰ame
 = 
psEnc
->
x_buf
 +ÖsEnc->
sCmn
.
…p_mem_Àngth
;

121 
ªs_pôch_‰ame
 = 
ªs_pôch
 + 
psEnc
->
sCmn
.
…p_mem_Àngth
;

126 
	`sûk_LP_v¨übÀ_cutoff
–&
psEnc
->
sCmn
.
sLP
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
‰ame_Àngth
 );

131 
	`sûk_sh‹t2Êﬂt_¨øy
–
x_‰ame
 + 
LA_SHAPE_MS
 * 
psEnc
->
sCmn
.
fs_kHz
,ÖsEnc->sCmn.
öputBuf
 + 1,ÖsEnc->sCmn.
‰ame_Àngth
 );

134  
i
 = 0; i < 8; i++ ) {

135 
x_‰ame
[ 
LA_SHAPE_MS
 * 
psEnc
->
sCmn
.
fs_kHz
 + 
i
 * (ÖsEnc->sCmn.
‰ame_Àngth
 >> 3 ) ] += ( 1 - ( i & 2 ) ) * 1e-6f;

138 if–!
psEnc
->
sCmn
.
¥efûlFœg
 ) {

142 
	`sûk_föd_pôch_œgs_FLP
–
psEnc
, &
sEncCål
, 
ªs_pôch
, 
x_‰ame
,ÖsEnc->
sCmn
.
¨ch
 );

147 
	`sûk_noi£_sh≠e_™Æysis_FLP
–
psEnc
, &
sEncCål
, 
ªs_pôch_‰ame
, 
x_‰ame
 );

152 
	`sûk_föd_¥ed_c€fs_FLP
–
psEnc
, &
sEncCål
, 
ªs_pôch_‰ame
, 
x_‰ame
, 
c⁄dCodög
 );

157 
	`sûk_¥o˚ss_gaös_FLP
–
psEnc
, &
sEncCål
, 
c⁄dCodög
 );

162 
	`sûk_LBRR_ícode_FLP
–
psEnc
, &
sEncCål
, 
x_‰ame
, 
c⁄dCodög
 );

165 
maxIãr
 = 6;

166 
gaöMu…_Q8
 = 
	`SILK_FIX_CONST
( 1, 8 );

167 
found_lowî
 = 0;

168 
found_uµî
 = 0;

169 
gaösID
 = 
	`sûk_gaös_ID
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
,ÖsEnc->sCmn.
nb_sub‰
 );

170 
gaösID_lowî
 = -1;

171 
gaösID_uµî
 = -1;

173 
	`sûk_mem˝y
–&
sR™geEnc_c›y
, 
psR™geEnc
, –
ec_íc
 ) );

174 
	`sûk_mem˝y
–&
sNSQ_c›y
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

175 
£ed_c›y
 = 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
;

176 
ec_¥evLagIndex_c›y
 = 
psEnc
->
sCmn
.
ec_¥evLagIndex
;

177 
ec_¥evSig«lTy≥_c›y
 = 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
;

178  
ôî
 = 0; ; iter++ ) {

179 if–
gaösID
 =
gaösID_lowî
 ) {

180 
nBôs
 = 
nBôs_lowî
;

181 } if–
gaösID
 =
gaösID_uµî
 ) {

182 
nBôs
 = 
nBôs_uµî
;

185 if–
ôî
 > 0 ) {

186 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y
, –
ec_íc
 ) );

187 
	`sûk_mem˝y
–&
psEnc
->
sCmn
.
sNSQ
, &
sNSQ_c›y
, –
sûk_nsq_°©e
 ) );

188 
psEnc
->
sCmn
.
ödi˚s
.
Sìd
 = 
£ed_c›y
;

189 
psEnc
->
sCmn
.
ec_¥evLagIndex
 = 
ec_¥evLagIndex_c›y
;

190 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
 = 
ec_¥evSig«lTy≥_c›y
;

196 
	`sûk_NSQ_wøµî_FLP
–
psEnc
, &
sEncCål
, &psEnc->
sCmn
.
ödi˚s
, &psEnc->sCmn.
sNSQ
,ÖsEnc->sCmn.
pul£s
, 
x_‰ame
 );

198 i‡–
ôî
 =
maxIãr
 && !
found_lowî
 ) {

199 
	`sûk_mem˝y
–&
sR™geEnc_c›y2
, 
psR™geEnc
, –
ec_íc
 ) );

205 
	`sûk_ícode_ödi˚s
–&
psEnc
->
sCmn
, 
psR™geEnc
,ÖsEnc->sCmn.
nFømesEncoded
, 0, 
c⁄dCodög
 );

210 
	`sûk_ícode_pul£s
–
psR™geEnc
, 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
,ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
,

211 
psEnc
->
sCmn
.
pul£s
,ÖsEnc->sCmn.
‰ame_Àngth
 );

213 
nBôs
 = 
	`ec_ãŒ
–
psR™geEnc
 );

216 i‡–
ôî
 =
maxIãr
 && !
found_lowî
 && 
nBôs
 > 
maxBôs
 ) {

217 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y2
, –
ec_íc
 ) );

220 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
sEncCål
.
œ°GaöIndexPªv
;

221  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

222 
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
[ 
i
 ] = 4;

224 i‡(
c⁄dCodög
 !
CODE_CONDITIONALLY
) {

225 
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
[ 0 ] = 
sEncCål
.
œ°GaöIndexPªv
;

227 
psEnc
->
sCmn
.
ec_¥evLagIndex
 = 
ec_¥evLagIndex_c›y
;

228 
psEnc
->
sCmn
.
ec_¥evSig«lTy≥
 = 
ec_¥evSig«lTy≥_c›y
;

230  
i
 = 0; i < 
psEnc
->
sCmn
.
‰ame_Àngth
; i++ ) {

231 
psEnc
->
sCmn
.
pul£s
[ 
i
 ] = 0;

234 
	`sûk_ícode_ödi˚s
–&
psEnc
->
sCmn
, 
psR™geEnc
,ÖsEnc->sCmn.
nFømesEncoded
, 0, 
c⁄dCodög
 );

236 
	`sûk_ícode_pul£s
–
psR™geEnc
, 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
,ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
,

237 
psEnc
->
sCmn
.
pul£s
,ÖsEnc->sCmn.
‰ame_Àngth
 );

239 
nBôs
 = 
	`ec_ãŒ
–
psR™geEnc
 );

242 if–
u£CBR
 =0 && 
ôî
 =0 && 
nBôs
 <
maxBôs
 ) {

247 if–
ôî
 =
maxIãr
 ) {

248 if–
found_lowî
 && ( 
gaösID
 =
gaösID_lowî
 || 
nBôs
 > 
maxBôs
 ) ) {

250 
	`sûk_mem˝y
–
psR™geEnc
, &
sR™geEnc_c›y2
, –
ec_íc
 ) );

251 
	`˚…_as£π
–
sR™geEnc_c›y2
.
offs
 <= 1275 );

252 
	`sûk_mem˝y
–
psR™geEnc
->
buf
, 
ec_buf_c›y
, 
sR™geEnc_c›y2
.
offs
 );

253 
	`sûk_mem˝y
–&
psEnc
->
sCmn
.
sNSQ
, &
sNSQ_c›y2
, –
sûk_nsq_°©e
 ) );

254 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
La°GaöIndex_c›y2
;

259 if–
nBôs
 > 
maxBôs
 ) {

260 if–
found_lowî
 =0 && 
ôî
 >= 2 ) {

262 
sEncCål
.
Lambda
 = 
	`sûk_max_Êﬂt
(sEncCtrl.Lambda*1.5f, 1.5f);

264 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

265 
found_uµî
 = 0;

266 
gaösID_uµî
 = -1;

268 
found_uµî
 = 1;

269 
nBôs_uµî
 = 
nBôs
;

270 
gaöMu…_uµî
 = 
gaöMu…_Q8
;

271 
gaösID_uµî
 = 
gaösID
;

273 } if–
nBôs
 < 
maxBôs
 - 5 ) {

274 
found_lowî
 = 1;

275 
nBôs_lowî
 = 
nBôs
;

276 
gaöMu…_lowî
 = 
gaöMu…_Q8
;

277 if–
gaösID
 !
gaösID_lowî
 ) {

278 
gaösID_lowî
 = 
gaösID
;

280 
	`sûk_mem˝y
–&
sR™geEnc_c›y2
, 
psR™geEnc
, –
ec_íc
 ) );

281 
	`˚…_as£π
–
psR™geEnc
->
offs
 <= 1275 );

282 
	`sûk_mem˝y
–
ec_buf_c›y
, 
psR™geEnc
->
buf
,ÖsR™geEnc->
offs
 );

283 
	`sûk_mem˝y
–&
sNSQ_c›y2
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

284 
La°GaöIndex_c›y2
 = 
psEnc
->
sSh≠e
.
La°GaöIndex
;

291 i‡–!
found_lowî
 && 
nBôs
 > 
maxBôs
 ) {

292 
j
;

293  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

294 
sum
=0;

295  
j
 = 
i
*
psEnc
->
sCmn
.
sub‰_Àngth
; j < (i+1)*psEnc->sCmn.subfr_length; j++ ) {

296 
sum
 +
	`abs
–
psEnc
->
sCmn
.
pul£s
[
j
] );

298 i‡–
ôî
 =0 || (
sum
 < 
be°_sum
[
i
] && !
gaö_lock
[i]) ) {

299 
be°_sum
[
i
] = 
sum
;

300 
be°_gaö_mu…
[
i
] = 
gaöMu…_Q8
;

302 
gaö_lock
[
i
] = 1;

306 if––
found_lowî
 & 
found_uµî
 ) == 0 ) {

308 if–
nBôs
 > 
maxBôs
 ) {

309 i‡(
gaöMu…_Q8
 < 16384) {

310 
gaöMu…_Q8
 *= 2;

312 
gaöMu…_Q8
 = 32767;

315 
›us_öt32
 
gaö_Á˘‹_Q16
;

316 
gaö_Á˘‹_Q16
 = 
	`sûk_log2lö
–
	`sûk_LSHIFT
–
nBôs
 - 
maxBôs
, 7 ) / 
psEnc
->
sCmn
.
‰ame_Àngth
 + 
	`SILK_FIX_CONST
( 16, 7 ) );

317 
gaöMu…_Q8
 = 
	`sûk_SMULWB
–
gaö_Á˘‹_Q16
, gainMult_Q8 );

321 
gaöMu…_Q8
 = 
gaöMu…_lowî
 + ( ( 
gaöMu…_uµî
 - gaöMu…_lowî ) * ( 
maxBôs
 - 
nBôs_lowî
 ) ) / ( 
nBôs_uµî
 -ÇBits_lower );

323 if–
gaöMu…_Q8
 > 
	`sûk_ADD_RSHIFT32
–
gaöMu…_lowî
, 
gaöMu…_uµî
 - gainMult_lower, 2 ) ) {

324 
gaöMu…_Q8
 = 
	`sûk_ADD_RSHIFT32
–
gaöMu…_lowî
, 
gaöMu…_uµî
 - gainMult_lower, 2 );

326 if–
gaöMu…_Q8
 < 
	`sûk_SUB_RSHIFT32
–
gaöMu…_uµî
, gaöMu…_uµî - 
gaöMu…_lowî
, 2 ) ) {

327 
gaöMu…_Q8
 = 
	`sûk_SUB_RSHIFT32
–
gaöMu…_uµî
, gaöMu…_uµî - 
gaöMu…_lowî
, 2 );

331  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

332 
›us_öt16
 
tmp
;

333 i‡–
gaö_lock
[
i
] ) {

334 
tmp
 = 
be°_gaö_mu…
[
i
];

336 
tmp
 = 
gaöMu…_Q8
;

338 
pGaös_Q16
[ 
i
 ] = 
	`sûk_LSHIFT_SAT32
–
	`sûk_SMULWB
–
sEncCål
.
GaösUnq_Q16
[ i ], 
tmp
 ), 8 );

342 
psEnc
->
sSh≠e
.
La°GaöIndex
 = 
sEncCål
.
œ°GaöIndexPªv
;

343 
	`sûk_gaös_qu™t
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
, 
pGaös_Q16
,

344 &
psEnc
->
sSh≠e
.
La°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
,ÖsEnc->
sCmn
.
nb_sub‰
 );

347 
gaösID
 = 
	`sûk_gaös_ID
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
,ÖsEnc->sCmn.
nb_sub‰
 );

350  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

351 
sEncCål
.
Gaös
[ 
i
 ] = 
pGaös_Q16
[ i ] / 65536.0f;

357 
	`sûk_memmove
–
psEnc
->
x_buf
, &psEnc->x_buf[ÖsEnc->
sCmn
.
‰ame_Àngth
 ],

358 –
psEnc
->
sCmn
.
…p_mem_Àngth
 + 
LA_SHAPE_MS
 *ÖsEnc->sCmn.
fs_kHz
 ) * –
sûk_Êﬂt
 ) );

361 if–
psEnc
->
sCmn
.
¥efûlFœg
 ) {

363 *
≤ByãsOut
 = 0;

364  
ªt
;

368 
psEnc
->
sCmn
.
¥evLag
 = 
sEncCål
.
pôchL
[ÖsEnc->sCmn.
nb_sub‰
 - 1 ];

369 
psEnc
->
sCmn
.
¥evSig«lTy≥
 =ÖsEnc->sCmn.
ödi˚s
.
sig«lTy≥
;

374 
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 = 0;

376 *
≤ByãsOut
 = 
	`sûk_RSHIFT
–
	`ec_ãŒ
–
psR™geEnc
 ) + 7, 3 );

378  
ªt
;

379 
	}
}

382 
OPUS_INLINE
 
	$sûk_LBRR_ícode_FLP
(

383 
sûk_ícodî_°©e_FLP
 *
psEnc
,

384 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

385 c⁄° 
sûk_Êﬂt
 
xfw
[],

386 
›us_öt
 
c⁄dCodög


389 
›us_öt
 
k
;

390 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ];

391 
sûk_Êﬂt
 
TempGaös
[ 
MAX_NB_SUBFR
 ];

392 
SideInfoIndi˚s
 *
psIndi˚s_LBRR
 = &
psEnc
->
sCmn
.
ödi˚s_LBRR
[ÖsEnc->sCmn.
nFømesEncoded
 ];

393 
sûk_nsq_°©e
 
sNSQ_LBRR
;

398 if–
psEnc
->
sCmn
.
LBRR_íabÀd
 &&ÖsEnc->sCmn.
•ìch_a˘ivôy_Q8
 > 
	`SILK_FIX_CONST
–
LBRR_SPEECH_ACTIVITY_THRES
, 8 ) ) {

399 
psEnc
->
sCmn
.
LBRR_Êags
[ÖsEnc->sCmn.
nFømesEncoded
 ] = 1;

402 
	`sûk_mem˝y
–&
sNSQ_LBRR
, &
psEnc
->
sCmn
.
sNSQ
, –
sûk_nsq_°©e
 ) );

403 
	`sûk_mem˝y
–
psIndi˚s_LBRR
, &
psEnc
->
sCmn
.
ödi˚s
, –
SideInfoIndi˚s
 ) );

406 
	`sûk_mem˝y
–
TempGaös
, 
psEncCål
->
Gaös
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
sûk_Êﬂt
 ) );

408 if–
psEnc
->
sCmn
.
nFømesEncoded
 =0 ||ÖsEnc->sCmn.
LBRR_Êags
[ÖsEnc->sCmn.nFramesEncoded - 1 ] == 0 ) {

410 
psEnc
->
sCmn
.
LBRR¥evLa°GaöIndex
 =ÖsEnc->
sSh≠e
.
La°GaöIndex
;

413 
psIndi˚s_LBRR
->
GaösIndi˚s
[ 0 ] +
psEnc
->
sCmn
.
LBRR_GaöIn¸ó£s
;

414 
psIndi˚s_LBRR
->
GaösIndi˚s
[ 0 ] = 
	`sûk_mö_öt
–psIndi˚s_LBRR->GaösIndi˚s[ 0 ], 
N_LEVELS_QGAIN
 - 1 );

418 
	`sûk_gaös_dequ™t
–
Gaös_Q16
, 
psIndi˚s_LBRR
->
GaösIndi˚s
,

419 &
psEnc
->
sCmn
.
LBRR¥evLa°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
,ÖsEnc->sCmn.
nb_sub‰
 );

422  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

423 
psEncCål
->
Gaös
[ 
k
 ] = 
Gaös_Q16
[ k ] * ( 1.0f / 65536.0f );

429 
	`sûk_NSQ_wøµî_FLP
–
psEnc
, 
psEncCål
, 
psIndi˚s_LBRR
, &
sNSQ_LBRR
,

430 
psEnc
->
sCmn
.
pul£s_LBRR
[ÖsEnc->sCmn.
nFømesEncoded
 ], 
xfw
 );

433 
	`sûk_mem˝y
–
psEncCål
->
Gaös
, 
TempGaös
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
sûk_Êﬂt
 ) );

435 
	}
}

	@silk/float/energy_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_íîgy_FLP
(

36 c⁄° 
sûk_Êﬂt
 *
d©a
,

37 
›us_öt
 
d©aSize


40 
›us_öt
 
i
;

41 
ªsu…
;

44 
ªsu…
 = 0.0;

45  
i
 = 0; i < 
d©aSize
 - 3; i += 4 ) {

46 
ªsu…
 +
d©a
[ 
i
 + 0 ] * ()data[ i + 0 ] +

47 
d©a
[ 
i
 + 1 ] * ()data[ i + 1 ] +

48 
d©a
[ 
i
 + 2 ] * ()data[ i + 2 ] +

49 
d©a
[ 
i
 + 3 ] * ()data[ i + 3 ];

53  ; 
i
 < 
d©aSize
; i++ ) {

54 
ªsu…
 +
d©a
[ 
i
 ] * ()data[ i ];

57 
	`sûk_as£π
–
ªsu…
 >= 0.0 );

58  
ªsu…
;

59 
	}
}

	@silk/float/find_LPC_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"deföe.h
"

33 
	~"maö_FLP.h
"

34 
	~"tunög_∑ømëîs.h
"

37 
	$sûk_föd_LPC_FLP
(

38 
sûk_ícodî_°©e
 *
psEncC
,

39 
›us_öt16
 
NLSF_Q15
[],

40 c⁄° 
sûk_Êﬂt
 
x
[],

41 c⁄° 
sûk_Êﬂt
 
möInvGaö


44 
›us_öt
 
k
, 
sub‰_Àngth
;

45 
sûk_Êﬂt
 
a
[ 
MAX_LPC_ORDER
 ];

48 
sûk_Êﬂt
 
ªs_ƒg
, 
ªs_ƒg_2nd
, 
ªs_ƒg_öãΩ
;

49 
›us_öt16
 
NLSF0_Q15
[ 
MAX_LPC_ORDER
 ];

50 
sûk_Êﬂt
 
a_tmp
[ 
MAX_LPC_ORDER
 ];

51 
sûk_Êﬂt
 
LPC_ªs
[ 
MAX_FRAME_LENGTH
 + 
MAX_NB_SUBFR
 * 
MAX_LPC_ORDER
 ];

53 
sub‰_Àngth
 = 
psEncC
->sub‰_Àngth +ÖsEncC->
¥edi˘LPCOrdî
;

56 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = 4;

59 
ªs_ƒg
 = 
	`sûk_burg_modifõd_FLP
–
a
, 
x
, 
möInvGaö
, 
sub‰_Àngth
, 
psEncC
->
nb_sub‰
,ÖsEncC->
¥edi˘LPCOrdî
 );

61 if–
psEncC
->
u£I¡îpﬁ©edNLSFs
 && !psEncC->
fú°_‰ame_a·î_ª£t
 &&ÖsEncC->
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

64 
ªs_ƒg
 -
	`sûk_burg_modifõd_FLP
–
a_tmp
, 
x
 + ( 
MAX_NB_SUBFR
 / 2 ) * 
sub‰_Àngth
, 
möInvGaö
, sub‰_Àngth, MAX_NB_SUBFR / 2, 
psEncC
->
¥edi˘LPCOrdî
 );

67 
	`sûk_A2NLSF_FLP
–
NLSF_Q15
, 
a_tmp
, 
psEncC
->
¥edi˘LPCOrdî
 );

70 
ªs_ƒg_2nd
 = 
sûk_Êﬂt_MAX
;

71  
k
 = 3; k >= 0; k-- ) {

73 
	`sûk_öãΩﬁ©e
–
NLSF0_Q15
, 
psEncC
->
¥ev_NLSFq_Q15
, 
NLSF_Q15
, 
k
,ÖsEncC->
¥edi˘LPCOrdî
 );

76 
	`sûk_NLSF2A_FLP
–
a_tmp
, 
NLSF0_Q15
, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

79 
	`sûk_LPC_™Æysis_fûãr_FLP
–
LPC_ªs
, 
a_tmp
, 
x
, 2 * 
sub‰_Àngth
, 
psEncC
->
¥edi˘LPCOrdî
 );

80 
ªs_ƒg_öãΩ
 = (
sûk_Êﬂt
)(

81 
	`sûk_íîgy_FLP
–
LPC_ªs
 + 
psEncC
->
¥edi˘LPCOrdî
, 
sub‰_Àngth
 -ÖsEncC->predictLPCOrder ) +

82 
	`sûk_íîgy_FLP
–
LPC_ªs
 + 
psEncC
->
¥edi˘LPCOrdî
 + 
sub‰_Àngth
, subfr_length -ÖsEncC->predictLPCOrder ) );

85 if–
ªs_ƒg_öãΩ
 < 
ªs_ƒg
 ) {

87 
ªs_ƒg
 = 
ªs_ƒg_öãΩ
;

88 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 = (
›us_öt8
)
k
;

89 } if–
ªs_ƒg_öãΩ
 > 
ªs_ƒg_2nd
 ) {

93 
ªs_ƒg_2nd
 = 
ªs_ƒg_öãΩ
;

97 if–
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 == 4 ) {

99 
	`sûk_A2NLSF_FLP
–
NLSF_Q15
, 
a
, 
psEncC
->
¥edi˘LPCOrdî
 );

102 
	`˚…_as£π
–
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
 == 4 ||

103 –
psEncC
->
u£I¡îpﬁ©edNLSFs
 && !psEncC->
fú°_‰ame_a·î_ª£t
 &&ÖsEncC->
nb_sub‰
 =
MAX_NB_SUBFR
 ) );

104 
	}
}

	@silk/float/find_LTP_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

33 
	~"tunög_∑ømëîs.h
"

35 
	$sûk_föd_LTP_FLP
(

36 
sûk_Êﬂt
 
XX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

37 
sûk_Êﬂt
 
xX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

38 c⁄° 
sûk_Êﬂt
 
r_±r
[],

39 c⁄° 
›us_öt
 
œg
[ 
MAX_NB_SUBFR
 ],

40 c⁄° 
›us_öt
 
sub‰_Àngth
,

41 c⁄° 
›us_öt
 
nb_sub‰


44 
›us_öt
 
k
;

45 
sûk_Êﬂt
 *
xX_±r
, *
XX_±r
;

46 c⁄° 
sûk_Êﬂt
 *
œg_±r
;

47 
sûk_Êﬂt
 
xx
, 
ãmp
;

49 
xX_±r
 = 
xX
;

50 
XX_±r
 = 
XX
;

51  
k
 = 0; k < 
nb_sub‰
; k++ ) {

52 
œg_±r
 = 
r_±r
 - ( 
œg
[ 
k
 ] + 
LTP_ORDER
 / 2 );

53 
	`sûk_c‹rM©rix_FLP
–
œg_±r
, 
sub‰_Àngth
, 
LTP_ORDER
, 
XX_±r
 );

54 
	`sûk_c‹rVe˘‹_FLP
–
œg_±r
, 
r_±r
, 
sub‰_Àngth
, 
LTP_ORDER
, 
xX_±r
 );

55 
xx
 = ( 
sûk_Êﬂt
 )
	`sûk_íîgy_FLP
–
r_±r
, 
sub‰_Àngth
 + 
LTP_ORDER
 );

56 
ãmp
 = 1.0‡/ 
	`sûk_max
–
xx
, 
LTP_CORR_INV_MAX
 * 0.5‡* ( 
XX_±r
[ 0 ] + XX_ptr[ 24 ] ) + 1.0f );

57 
	`sûk_sˇÀ_ve˘‹_FLP
–
XX_±r
, 
ãmp
, 
LTP_ORDER
 * LTP_ORDER );

58 
	`sûk_sˇÀ_ve˘‹_FLP
–
xX_±r
, 
ãmp
, 
LTP_ORDER
 );

60 
r_±r
 +
sub‰_Àngth
;

61 
XX_±r
 +
LTP_ORDER
 * LTP_ORDER;

62 
xX_±r
 +
LTP_ORDER
;

64 
	}
}

	@silk/float/find_pitch_lags_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dlib.h
>

33 
	~"maö_FLP.h
"

34 
	~"tunög_∑ømëîs.h
"

36 
	$sûk_föd_pôch_œgs_FLP
(

37 
sûk_ícodî_°©e_FLP
 *
psEnc
,

38 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

39 
sûk_Êﬂt
 
ªs
[],

40 c⁄° 
sûk_Êﬂt
 
x
[],

41 
¨ch


44 
›us_öt
 
buf_Àn
;

45 
sûk_Êﬂt
 
thrhld
, 
ªs_ƒg
;

46 c⁄° 
sûk_Êﬂt
 *
x_buf_±r
, *
x_buf
;

47 
sûk_Êﬂt
 
auto_c‹r
[ 
MAX_FIND_PITCH_LPC_ORDER
 + 1 ];

48 
sûk_Êﬂt
 
A
[ 
MAX_FIND_PITCH_LPC_ORDER
 ];

49 
sûk_Êﬂt
 
ªÊ_c€f
[ 
MAX_FIND_PITCH_LPC_ORDER
 ];

50 
sûk_Êﬂt
 
Wsig
[ 
FIND_PITCH_LPC_WIN_MAX
 ];

51 
sûk_Êﬂt
 *
Wsig_±r
;

56 
buf_Àn
 = 
psEnc
->
sCmn
.
œ_pôch
 +ÖsEnc->sCmn.
‰ame_Àngth
 +ÖsEnc->sCmn.
…p_mem_Àngth
;

59 
	`˚…_as£π
–
buf_Àn
 >
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 );

61 
x_buf
 = 
x
 - 
psEnc
->
sCmn
.
…p_mem_Àngth
;

70 
x_buf_±r
 = 
x_buf
 + 
buf_Àn
 - 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
;

71 
Wsig_±r
 = 
Wsig
;

72 
	`sûk_≠∂y_söe_wödow_FLP
–
Wsig_±r
, 
x_buf_±r
, 1, 
psEnc
->
sCmn
.
œ_pôch
 );

75 
Wsig_±r
 +
psEnc
->
sCmn
.
œ_pôch
;

76 
x_buf_±r
 +
psEnc
->
sCmn
.
œ_pôch
;

77 
	`sûk_mem˝y
–
Wsig_±r
, 
x_buf_±r
, ( 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - (ÖsEnc->sCmn.
œ_pôch
 << 1 ) ) * –
sûk_Êﬂt
 ) );

80 
Wsig_±r
 +
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - (ÖsEnc->sCmn.
œ_pôch
 << 1 );

81 
x_buf_±r
 +
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
 - (ÖsEnc->sCmn.
œ_pôch
 << 1 );

82 
	`sûk_≠∂y_söe_wödow_FLP
–
Wsig_±r
, 
x_buf_±r
, 2, 
psEnc
->
sCmn
.
œ_pôch
 );

85 
	`sûk_autoc‹ªœti⁄_FLP
–
auto_c‹r
, 
Wsig
, 
psEnc
->
sCmn
.
pôch_LPC_wö_Àngth
,ÖsEnc->sCmn.
pôchE°im©i⁄LPCOrdî
 + 1 );

88 
auto_c‹r
[ 0 ] +auto_c‹r[ 0 ] * 
FIND_PITCH_WHITE_NOISE_FRACTION
 + 1;

91 
ªs_ƒg
 = 
	`sûk_schur_FLP
–
ªÊ_c€f
, 
auto_c‹r
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

94 
psEncCål
->
¥edGaö
 = 
auto_c‹r
[ 0 ] / 
	`sûk_max_Êﬂt
–
ªs_ƒg
, 1.0f );

97 
	`sûk_k2a_FLP
–
A
, 
ªÊ_c€f
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

100 
	`sûk_bwex∑ndî_FLP
–
A
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
, 
FIND_PITCH_BANDWIDTH_EXPANSION
 );

105 
	`sûk_LPC_™Æysis_fûãr_FLP
–
ªs
, 
A
, 
x_buf
, 
buf_Àn
, 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
 );

107 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 !
TYPE_NO_VOICE_ACTIVITY
 &&ÖsEnc->sCmn.
fú°_‰ame_a·î_ª£t
 == 0 ) {

109 
thrhld
 = 0.6f;

110 
thrhld
 -0.004‡* 
psEnc
->
sCmn
.
pôchE°im©i⁄LPCOrdî
;

111 
thrhld
 -0.1‡* 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 * ( 1.0f / 256.0f );

112 
thrhld
 -0.15‡* (
psEnc
->
sCmn
.
¥evSig«lTy≥
 >> 1);

113 
thrhld
 -0.1‡* 
psEnc
->
sCmn
.
öput_tût_Q15
 * ( 1.0f / 32768.0f );

118 if–
	`sûk_pôch_™Æysis_c‹e_FLP
–
ªs
, 
psEncCål
->
pôchL
, &
psEnc
->
sCmn
.
ödi˚s
.
œgIndex
,

119 &
psEnc
->
sCmn
.
ödi˚s
.
c⁄tourIndex
, &psEnc->
LTPC‹r
,ÖsEnc->sCmn.
¥evLag
,ÖsEnc->sCmn.
pôchE°im©i⁄Thªshﬁd_Q16
 / 65536.0f,

120 
thrhld
, 
psEnc
->
sCmn
.
fs_kHz
,ÖsEnc->sCmn.
pôchE°im©i⁄Com∂exôy
,ÖsEnc->sCmn.
nb_sub‰
, 
¨ch
 ) == 0 )

122 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_VOICED
;

124 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 = 
TYPE_UNVOICED
;

127 
	`sûk_mem£t
–
psEncCål
->
pôchL
, 0, (ÖsEncCtrl->pitchL ) );

128 
psEnc
->
sCmn
.
ödi˚s
.
œgIndex
 = 0;

129 
psEnc
->
sCmn
.
ödi˚s
.
c⁄tourIndex
 = 0;

130 
psEnc
->
LTPC‹r
 = 0;

132 
	}
}

	@silk/float/find_pred_coefs_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

35 
	$sûk_föd_¥ed_c€fs_FLP
(

36 
sûk_ícodî_°©e_FLP
 *
psEnc
,

37 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

38 c⁄° 
sûk_Êﬂt
 
ªs_pôch
[],

39 c⁄° 
sûk_Êﬂt
 
x
[],

40 
›us_öt
 
c⁄dCodög


43 
›us_öt
 
i
;

44 
sûk_Êﬂt
 
XXLTP
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ];

45 
sûk_Êﬂt
 
xXLTP
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ];

46 
sûk_Êﬂt
 
övGaös
[ 
MAX_NB_SUBFR
 ];

47 
›us_öt16
 
NLSF_Q15
[ 
MAX_LPC_ORDER
 ];

48 c⁄° 
sûk_Êﬂt
 *
x_±r
;

49 
sûk_Êﬂt
 *
x_¥e_±r
, 
LPC_ö_¥e
[ 
MAX_NB_SUBFR
 * 
MAX_LPC_ORDER
 + 
MAX_FRAME_LENGTH
 ];

50 
sûk_Êﬂt
 
möInvGaö
;

53  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

54 
	`sûk_as£π
–
psEncCål
->
Gaös
[ 
i
 ] > 0.0f );

55 
övGaös
[ 
i
 ] = 1.0‡/ 
psEncCål
->
Gaös
[ i ];

58 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

62 
	`˚…_as£π
–
psEnc
->
sCmn
.
…p_mem_Àngth
 -ÖsEnc->sCmn.
¥edi˘LPCOrdî
 >
psEncCål
->
pôchL
[ 0 ] + 
LTP_ORDER
 / 2 );

65 
	`sûk_föd_LTP_FLP
–
XXLTP
, 
xXLTP
, 
ªs_pôch
, 
psEncCål
->
pôchL
, 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
 );

68 
	`sûk_qu™t_LTP_gaös_FLP
–
psEncCål
->
LTPC€f
, 
psEnc
->
sCmn
.
ödi˚s
.
LTPIndex
, &psEnc->sCmn.ödi˚s.
PERIndex
,

69 &
psEnc
->
sCmn
.
sum_log_gaö_Q7
, &
psEncCål
->
LTPªdCodGaö
, 
XXLTP
, 
xXLTP
,ÖsEnc->sCmn.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¨ch
 );

72 
	`sûk_LTP_sˇÀ_˘æ_FLP
–
psEnc
, 
psEncCål
, 
c⁄dCodög
 );

75 
	`sûk_LTP_™Æysis_fûãr_FLP
–
LPC_ö_¥e
, 
x
 - 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
, 
psEncCål
->
LTPC€f
,

76 
psEncCål
->
pôchL
, 
övGaös
, 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¥edi˘LPCOrdî
 );

82 
x_±r
 = 
x
 - 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
;

83 
x_¥e_±r
 = 
LPC_ö_¥e
;

84  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

85 
	`sûk_sˇÀ_c›y_ve˘‹_FLP
–
x_¥e_±r
, 
x_±r
, 
övGaös
[ 
i
 ],

86 
psEnc
->
sCmn
.
sub‰_Àngth
 +ÖsEnc->sCmn.
¥edi˘LPCOrdî
 );

87 
x_¥e_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
 +ÖsEnc->sCmn.
¥edi˘LPCOrdî
;

88 
x_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
;

90 
	`sûk_mem£t
–
psEncCål
->
LTPC€f
, 0, 
psEnc
->
sCmn
.
nb_sub‰
 * 
LTP_ORDER
 * –
sûk_Êﬂt
 ) );

91 
psEncCål
->
LTPªdCodGaö
 = 0.0f;

92 
psEnc
->
sCmn
.
sum_log_gaö_Q7
 = 0;

96 if–
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 ) {

97 
möInvGaö
 = 1.0‡/ 
MAX_PREDICTION_POWER_GAIN_AFTER_RESET
;

99 
möInvGaö
 = (
sûk_Êﬂt
)
	`pow
–2, 
psEncCål
->
LTPªdCodGaö
 / 3 ) / 
MAX_PREDICTION_POWER_GAIN
;

100 
möInvGaö
 /0.25‡+ 0.75‡* 
psEncCål
->
codög_quÆôy
;

104 
	`sûk_föd_LPC_FLP
–&
psEnc
->
sCmn
, 
NLSF_Q15
, 
LPC_ö_¥e
, 
möInvGaö
 );

107 
	`sûk_¥o˚ss_NLSFs_FLP
–&
psEnc
->
sCmn
, 
psEncCål
->
PªdC€f
, 
NLSF_Q15
,ÖsEnc->sCmn.
¥ev_NLSFq_Q15
 );

110 
	`sûk_ªsiduÆ_íîgy_FLP
–
psEncCål
->
ResNrg
, 
LPC_ö_¥e
,ÖsEncCål->
PªdC€f
,ÖsEncCål->
Gaös
,

111 
psEnc
->
sCmn
.
sub‰_Àngth
,ÖsEnc->sCmn.
nb_sub‰
,ÖsEnc->sCmn.
¥edi˘LPCOrdî
 );

114 
	`sûk_mem˝y
–
psEnc
->
sCmn
.
¥ev_NLSFq_Q15
, 
NLSF_Q15
, (ÖsEnc->sCmn.prev_NLSFq_Q15 ) );

115 
	}
}

	@silk/float/inner_product_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_ö√r_¥odu˘_FLP
(

36 c⁄° 
sûk_Êﬂt
 *
d©a1
,

37 c⁄° 
sûk_Êﬂt
 *
d©a2
,

38 
›us_öt
 
d©aSize


41 
›us_öt
 
i
;

42 
ªsu…
;

45 
ªsu…
 = 0.0;

46  
i
 = 0; i < 
d©aSize
 - 3; i += 4 ) {

47 
ªsu…
 +
d©a1
[ 
i
 + 0 ] * ()
d©a2
[ i + 0 ] +

48 
d©a1
[ 
i
 + 1 ] * ()
d©a2
[ i + 1 ] +

49 
d©a1
[ 
i
 + 2 ] * ()
d©a2
[ i + 2 ] +

50 
d©a1
[ 
i
 + 3 ] * ()
d©a2
[ i + 3 ];

54  ; 
i
 < 
d©aSize
; i++ ) {

55 
ªsu…
 +
d©a1
[ 
i
 ] * ()
d©a2
[ i ];

58  
ªsu…
;

59 
	}
}

	@silk/float/k2a_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_k2a_FLP
(

36 
sûk_Êﬂt
 *
A
,

37 c⁄° 
sûk_Êﬂt
 *
rc
,

38 
›us_öt32
 
‹dî


41 
›us_öt
 
k
, 
n
;

42 
sûk_Êﬂt
 
rck
, 
tmp1
, 
tmp2
;

44  
k
 = 0; k < 
‹dî
; k++ ) {

45 
rck
 = 
rc
[ 
k
 ];

46  
n
 = 0;Ç < (
k
 + 1) >> 1;Ç++ ) {

47 
tmp1
 = 
A
[ 
n
 ];

48 
tmp2
 = 
A
[ 
k
 - 
n
 - 1 ];

49 
A
[ 
n
 ] = 
tmp1
 + 
tmp2
 * 
rck
;

50 
A
[ 
k
 - 
n
 - 1 ] = 
tmp2
 + 
tmp1
 * 
rck
;

52 
A
[ 
k
 ] = -
rck
;

54 
	}
}

	@silk/float/main_FLP.h

28 #i‚de‡
SILK_MAIN_FLP_H


29 
	#SILK_MAIN_FLP_H


	)

31 
	~"SigProc_FLP.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"°ru˘s_FLP.h
"

34 
	~"maö.h
"

35 
	~"deföe.h
"

36 
	~"debug.h
"

37 
	~"íãnc.h
"

39 #ifde‡
__˝lu•lus


44 
	#sûk_ícodî_°©e_Fxx
 
sûk_ícodî_°©e_FLP


	)

45 
	#sûk_ícode_do_VAD_Fxx
 
sûk_ícode_do_VAD_FLP


	)

46 
	#sûk_ícode_‰ame_Fxx
 
sûk_ícode_‰ame_FLP


	)

53 
sûk_HP_v¨übÀ_cutoff
(

54 
sûk_ícodî_°©e_Fxx
 
°©e_Fxx
[]

58 
sûk_ícode_do_VAD_FLP
(

59 
sûk_ícodî_°©e_FLP
 *
psEnc
,

60 
›us_öt
 
a˘ivôy


64 
›us_öt
 
sûk_ícode_‰ame_FLP
(

65 
sûk_ícodî_°©e_FLP
 *
psEnc
,

66 
›us_öt32
 *
≤ByãsOut
,

67 
ec_íc
 *
psR™geEnc
,

68 
›us_öt
 
c⁄dCodög
,

69 
›us_öt
 
maxBôs
,

70 
›us_öt
 
u£CBR


74 
›us_öt
 
sûk_öô_ícodî
(

75 
sûk_ícodî_°©e_FLP
 *
psEnc
,

76 
¨ch


80 
›us_öt
 
sûk_c⁄åﬁ_ícodî
(

81 
sûk_ícodî_°©e_FLP
 *
psEnc
,

82 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ
,

83 c⁄° 
›us_öt
 
Ælow_bw_swôch
,

84 c⁄° 
›us_öt
 
ch™√lNb
,

85 c⁄° 
›us_öt
 
f‹˚_fs_kHz


92 
sûk_noi£_sh≠e_™Æysis_FLP
(

93 
sûk_ícodî_°©e_FLP
 *
psEnc
,

94 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

95 c⁄° 
sûk_Êﬂt
 *
pôch_ªs
,

96 c⁄° 
sûk_Êﬂt
 *
x


100 
sûk_w¨≥d_autoc‹ªœti⁄_FLP
(

101 
sûk_Êﬂt
 *
c‹r
,

102 c⁄° 
sûk_Êﬂt
 *
öput
,

103 c⁄° 
sûk_Êﬂt
 
w¨pög
,

104 c⁄° 
›us_öt
 
Àngth
,

105 c⁄° 
›us_öt
 
‹dî


109 
sûk_LTP_sˇÀ_˘æ_FLP
(

110 
sûk_ícodî_°©e_FLP
 *
psEnc
,

111 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

112 
›us_öt
 
c⁄dCodög


119 
sûk_föd_pôch_œgs_FLP
(

120 
sûk_ícodî_°©e_FLP
 *
psEnc
,

121 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

122 
sûk_Êﬂt
 
ªs
[],

123 c⁄° 
sûk_Êﬂt
 
x
[],

124 
¨ch


128 
sûk_föd_¥ed_c€fs_FLP
(

129 
sûk_ícodî_°©e_FLP
 *
psEnc
,

130 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

131 c⁄° 
sûk_Êﬂt
 
ªs_pôch
[],

132 c⁄° 
sûk_Êﬂt
 
x
[],

133 
›us_öt
 
c⁄dCodög


137 
sûk_föd_LPC_FLP
(

138 
sûk_ícodî_°©e
 *
psEncC
,

139 
›us_öt16
 
NLSF_Q15
[],

140 c⁄° 
sûk_Êﬂt
 
x
[],

141 c⁄° 
sûk_Êﬂt
 
möInvGaö


145 
sûk_föd_LTP_FLP
(

146 
sûk_Êﬂt
 
XX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

147 
sûk_Êﬂt
 
xX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

148 c⁄° 
sûk_Êﬂt
 
r_±r
[],

149 c⁄° 
›us_öt
 
œg
[ 
MAX_NB_SUBFR
 ],

150 c⁄° 
›us_öt
 
sub‰_Àngth
,

151 c⁄° 
›us_öt
 
nb_sub‰


154 
sûk_LTP_™Æysis_fûãr_FLP
(

155 
sûk_Êﬂt
 *
LTP_ªs
,

156 c⁄° 
sûk_Êﬂt
 *
x
,

157 c⁄° 
sûk_Êﬂt
 
B
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

158 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

159 c⁄° 
sûk_Êﬂt
 
övGaös
[ 
MAX_NB_SUBFR
 ],

160 c⁄° 
›us_öt
 
sub‰_Àngth
,

161 c⁄° 
›us_öt
 
nb_sub‰
,

162 c⁄° 
›us_öt
 
¥e_Àngth


167 
sûk_ªsiduÆ_íîgy_FLP
(

168 
sûk_Êﬂt
 
ƒgs
[ 
MAX_NB_SUBFR
 ],

169 c⁄° 
sûk_Êﬂt
 
x
[],

170 
sûk_Êﬂt
 
a
[ 2 ][ 
MAX_LPC_ORDER
 ],

171 c⁄° 
sûk_Êﬂt
 
gaös
[],

172 c⁄° 
›us_öt
 
sub‰_Àngth
,

173 c⁄° 
›us_öt
 
nb_sub‰
,

174 c⁄° 
›us_öt
 
LPC_‹dî


178 
sûk_LPC_™Æysis_fûãr_FLP
(

179 
sûk_Êﬂt
 
r_LPC
[],

180 c⁄° 
sûk_Êﬂt
 
PªdC€f
[],

181 c⁄° 
sûk_Êﬂt
 
s
[],

182 c⁄° 
›us_öt
 
Àngth
,

183 c⁄° 
›us_öt
 
Ordî


187 
sûk_qu™t_LTP_gaös_FLP
(

188 
sûk_Êﬂt
 
B
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

189 
›us_öt8
 
cbk_ödex
[ 
MAX_NB_SUBFR
 ],

190 
›us_öt8
 *
≥riodicôy_ödex
,

191 
›us_öt32
 *
sum_log_gaö_Q7
,

192 
sûk_Êﬂt
 *
¥ed_gaö_dB
,

193 c⁄° 
sûk_Êﬂt
 
XX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

194 c⁄° 
sûk_Êﬂt
 
xX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

195 c⁄° 
›us_öt
 
sub‰_Àn
,

196 c⁄° 
›us_öt
 
nb_sub‰
,

197 
¨ch


201 
sûk_Êﬂt
 
sûk_ªsiduÆ_íîgy_cov¨_FLP
(

202 c⁄° 
sûk_Êﬂt
 *
c
,

203 
sûk_Êﬂt
 *
wXX
,

204 c⁄° 
sûk_Êﬂt
 *
wXx
,

205 c⁄° 
sûk_Êﬂt
 
wxx
,

206 c⁄° 
›us_öt
 
D


210 
sûk_¥o˚ss_gaös_FLP
(

211 
sûk_ícodî_°©e_FLP
 *
psEnc
,

212 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

213 
›us_öt
 
c⁄dCodög


220 
sûk_c‹rM©rix_FLP
(

221 c⁄° 
sûk_Êﬂt
 *
x
,

222 c⁄° 
›us_öt
 
L
,

223 c⁄° 
›us_öt
 
Ordî
,

224 
sûk_Êﬂt
 *
XX


228 
sûk_c‹rVe˘‹_FLP
(

229 c⁄° 
sûk_Êﬂt
 *
x
,

230 c⁄° 
sûk_Êﬂt
 *
t
,

231 c⁄° 
›us_öt
 
L
,

232 c⁄° 
›us_öt
 
Ordî
,

233 
sûk_Êﬂt
 *
Xt


240 
sûk_≠∂y_söe_wödow_FLP
(

241 
sûk_Êﬂt
 
px_wö
[],

242 c⁄° 
sûk_Êﬂt
 
px
[],

243 c⁄° 
›us_öt
 
wö_ty≥
,

244 c⁄° 
›us_öt
 
Àngth


250 
sûk_A2NLSF_FLP
(

251 
›us_öt16
 *
NLSF_Q15
,

252 c⁄° 
sûk_Êﬂt
 *
pAR
,

253 c⁄° 
›us_öt
 
LPC_‹dî


257 
sûk_NLSF2A_FLP
(

258 
sûk_Êﬂt
 *
pAR
,

259 c⁄° 
›us_öt16
 *
NLSF_Q15
,

260 c⁄° 
›us_öt
 
LPC_‹dî
,

261 
¨ch


265 
sûk_¥o˚ss_NLSFs_FLP
(

266 
sûk_ícodî_°©e
 *
psEncC
,

267 
sûk_Êﬂt
 
PªdC€f
[ 2 ][ 
MAX_LPC_ORDER
 ],

268 
›us_öt16
 
NLSF_Q15
[ 
MAX_LPC_ORDER
 ],

269 c⁄° 
›us_öt16
 
¥ev_NLSF_Q15
[ 
MAX_LPC_ORDER
 ]

273 
sûk_NSQ_wøµî_FLP
(

274 
sûk_ícodî_°©e_FLP
 *
psEnc
,

275 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

276 
SideInfoIndi˚s
 *
psIndi˚s
,

277 
sûk_nsq_°©e
 *
psNSQ
,

278 
›us_öt8
 
pul£s
[],

279 c⁄° 
sûk_Êﬂt
 
x
[]

282 #ifde‡
__˝lu•lus


	@silk/float/noise_shape_analysis_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

33 
	~"tunög_∑ømëîs.h
"

39 
OPUS_INLINE
 
sûk_Êﬂt
 
	$w¨≥d_gaö
(

40 c⁄° 
sûk_Êﬂt
 *
c€fs
,

41 
sûk_Êﬂt
 
œmbda
,

42 
›us_öt
 
‹dî


44 
›us_öt
 
i
;

45 
sûk_Êﬂt
 
gaö
;

47 
œmbda
 = -lambda;

48 
gaö
 = 
c€fs
[ 
‹dî
 - 1 ];

49  
i
 = 
‹dî
 - 2; i >= 0; i-- ) {

50 
gaö
 = 
œmbda
 * gaö + 
c€fs
[ 
i
 ];

52  (
sûk_Êﬂt
)–1.0‡/ ( 1.0‡- 
œmbda
 * 
gaö
 ) );

53 
	}
}

57 
OPUS_INLINE
 
	$w¨≥d_åue2m⁄ic_c€fs
(

58 
sûk_Êﬂt
 *
c€fs
,

59 
sûk_Êﬂt
 
œmbda
,

60 
sûk_Êﬂt
 
limô
,

61 
›us_öt
 
‹dî


63 
›us_öt
 
i
, 
ôî
, 
öd
 = 0;

64 
sûk_Êﬂt
 
tmp
, 
maxabs
, 
chúp
, 
gaö
;

67  
i
 = 
‹dî
 - 1; i > 0; i-- ) {

68 
c€fs
[ 
i
 - 1 ] -
œmbda
 * coefs[ i ];

70 
gaö
 = ( 1.0‡- 
œmbda
 *Üambd®Ë/ ( 1.0‡+Üambd®* 
c€fs
[ 0 ] );

71  
i
 = 0; i < 
‹dî
; i++ ) {

72 
c€fs
[ 
i
 ] *
gaö
;

76  
ôî
 = 0; iter < 10; iter++ ) {

78 
maxabs
 = -1.0f;

79  
i
 = 0; i < 
‹dî
; i++ ) {

80 
tmp
 = 
	`sûk_abs_Êﬂt
–
c€fs
[ 
i
 ] );

81 if–
tmp
 > 
maxabs
 ) {

82 
maxabs
 = 
tmp
;

83 
öd
 = 
i
;

86 if–
maxabs
 <
limô
 ) {

92  
i
 = 1; i < 
‹dî
; i++ ) {

93 
c€fs
[ 
i
 - 1 ] +
œmbda
 * coefs[ i ];

95 
gaö
 = 1.0f / gain;

96  
i
 = 0; i < 
‹dî
; i++ ) {

97 
c€fs
[ 
i
 ] *
gaö
;

101 
chúp
 = 0.99‡- ( 0.8‡+ 0.1‡* 
ôî
 ) * ( 
maxabs
 - 
limô
 ) / ( maxab†* ( 
öd
 + 1 ) );

102 
	`sûk_bwex∑ndî_FLP
–
c€fs
, 
‹dî
, 
chúp
 );

105  
i
 = 
‹dî
 - 1; i > 0; i-- ) {

106 
c€fs
[ 
i
 - 1 ] -
œmbda
 * coefs[ i ];

108 
gaö
 = ( 1.0‡- 
œmbda
 *Üambd®Ë/ ( 1.0‡+Üambd®* 
c€fs
[ 0 ] );

109  
i
 = 0; i < 
‹dî
; i++ ) {

110 
c€fs
[ 
i
 ] *
gaö
;

113 
	`sûk_as£π
( 0 );

114 
	}
}

116 
OPUS_INLINE
 
	$limô_c€fs
(

117 
sûk_Êﬂt
 *
c€fs
,

118 
sûk_Êﬂt
 
limô
,

119 
›us_öt
 
‹dî


121 
›us_öt
 
i
, 
ôî
, 
öd
 = 0;

122 
sûk_Êﬂt
 
tmp
, 
maxabs
, 
chúp
;

124  
ôî
 = 0; iter < 10; iter++ ) {

126 
maxabs
 = -1.0f;

127  
i
 = 0; i < 
‹dî
; i++ ) {

128 
tmp
 = 
	`sûk_abs_Êﬂt
–
c€fs
[ 
i
 ] );

129 if–
tmp
 > 
maxabs
 ) {

130 
maxabs
 = 
tmp
;

131 
öd
 = 
i
;

134 if–
maxabs
 <
limô
 ) {

140 
chúp
 = 0.99‡- ( 0.8‡+ 0.1‡* 
ôî
 ) * ( 
maxabs
 - 
limô
 ) / ( maxab†* ( 
öd
 + 1 ) );

141 
	`sûk_bwex∑ndî_FLP
–
c€fs
, 
‹dî
, 
chúp
 );

143 
	`sûk_as£π
( 0 );

144 
	}
}

147 
	$sûk_noi£_sh≠e_™Æysis_FLP
(

148 
sûk_ícodî_°©e_FLP
 *
psEnc
,

149 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

150 c⁄° 
sûk_Êﬂt
 *
pôch_ªs
,

151 c⁄° 
sûk_Êﬂt
 *
x


154 
sûk_sh≠e_°©e_FLP
 *
psSh≠eSt
 = &
psEnc
->
sSh≠e
;

155 
›us_öt
 
k
, 
nSam∂es
, 
nSegs
;

156 
sûk_Êﬂt
 
SNR_adj_dB
, 
H¨mSh≠eGaö
, 
Tût
;

157 
sûk_Êﬂt
 
ƒg
, 
log_íîgy
, 
log_íîgy_¥ev
, 
íîgy_v¨üti⁄
;

158 
sûk_Êﬂt
 
BWExp
, 
gaö_mu…
, 
gaö_add
, 
°ªngth
, 
b
, 
w¨pög
;

159 
sûk_Êﬂt
 
x_wödowed
[ 
SHAPE_LPC_WIN_MAX
 ];

160 
sûk_Êﬂt
 
auto_c‹r
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ];

161 
sûk_Êﬂt
 
rc
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ];

162 c⁄° 
sûk_Êﬂt
 *
x_±r
, *
pôch_ªs_±r
;

165 
x_±r
 = 
x
 - 
psEnc
->
sCmn
.
œ_sh≠e
;

170 
SNR_adj_dB
 = 
psEnc
->
sCmn
.
SNR_dB_Q7
 * ( 1 / 128.0f );

173 
psEncCål
->
öput_quÆôy
 = 0.5‡* ( 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ] +ÖsEnc->sCmn.input_quality_bands_Q15[ 1 ] ) * ( 1.0f / 32768.0f );

176 
psEncCål
->
codög_quÆôy
 = 
	`sûk_sigmoid
–0.25‡* ( 
SNR_adj_dB
 - 20.0f ) );

178 if–
psEnc
->
sCmn
.
u£CBR
 == 0 ) {

180 
b
 = 1.0‡- 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 * ( 1.0f / 256.0f );

181 
SNR_adj_dB
 -
BG_SNR_DECR_dB
 * 
psEncCål
->
codög_quÆôy
 * ( 0.5‡+ 0.5‡*ÖsEncCål->
öput_quÆôy
 ) * 
b
 * b;

184 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

186 
SNR_adj_dB
 +
HARM_SNR_INCR_dB
 * 
psEnc
->
LTPC‹r
;

189 
SNR_adj_dB
 +–-0.4‡* 
psEnc
->
sCmn
.
SNR_dB_Q7
 * ( 1 / 128.0‡Ë+ 6.0‡Ë* ( 1.0‡- 
psEncCål
->
öput_quÆôy
 );

196 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

198 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

201 
nSam∂es
 = 2 * 
psEnc
->
sCmn
.
fs_kHz
;

202 
íîgy_v¨üti⁄
 = 0.0f;

203 
log_íîgy_¥ev
 = 0.0f;

204 
pôch_ªs_±r
 = 
pôch_ªs
;

205 
nSegs
 = 
	`sûk_SMULBB
–
SUB_FRAME_LENGTH_MS
, 
psEnc
->
sCmn
.
nb_sub‰
 ) / 2;

206  
k
 = 0; k < 
nSegs
; k++ ) {

207 
ƒg
 = ( 
sûk_Êﬂt
 )
nSam∂es
 + ( sûk_Êﬂà)
	`sûk_íîgy_FLP
–
pôch_ªs_±r
,ÇSamples );

208 
log_íîgy
 = 
	`sûk_log2
–
ƒg
 );

209 if–
k
 > 0 ) {

210 
íîgy_v¨üti⁄
 +
	`sûk_abs_Êﬂt
–
log_íîgy
 - 
log_íîgy_¥ev
 );

212 
log_íîgy_¥ev
 = 
log_íîgy
;

213 
pôch_ªs_±r
 +
nSam∂es
;

217 if–
íîgy_v¨üti⁄
 > 
ENERGY_VARIATION_THRESHOLD_QNT_OFFSET
 * (
nSegs
-1) ) {

218 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

220 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 1;

228 
°ªngth
 = 
FIND_PITCH_WHITE_NOISE_FRACTION
 * 
psEncCål
->
¥edGaö
;

229 
BWExp
 = 
BANDWIDTH_EXPANSION
 / ( 1.0‡+ 
°ªngth
 * strength );

232 
w¨pög
 = (
sûk_Êﬂt
)
psEnc
->
sCmn
.
w¨pög_Q16
 / 65536.0‡+ 0.01‡* 
psEncCål
->
codög_quÆôy
;

237  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

239 
›us_öt
 
shi·
, 
¶›e_∑π
, 
Ê©_∑π
;

240 
Ê©_∑π
 = 
psEnc
->
sCmn
.
fs_kHz
 * 3;

241 
¶›e_∑π
 = ( 
psEnc
->
sCmn
.
sh≠eWöLígth
 - 
Ê©_∑π
 ) / 2;

243 
	`sûk_≠∂y_söe_wödow_FLP
–
x_wödowed
, 
x_±r
, 1, 
¶›e_∑π
 );

244 
shi·
 = 
¶›e_∑π
;

245 
	`sûk_mem˝y
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 
Ê©_∑π
 * (
sûk_Êﬂt
) );

246 
shi·
 +
Ê©_∑π
;

247 
	`sûk_≠∂y_söe_wödow_FLP
–
x_wödowed
 + 
shi·
, 
x_±r
 + shi·, 2, 
¶›e_∑π
 );

250 
x_±r
 +
psEnc
->
sCmn
.
sub‰_Àngth
;

252 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

254 
	`sûk_w¨≥d_autoc‹ªœti⁄_FLP
–
auto_c‹r
, 
x_wödowed
, 
w¨pög
,

255 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
 );

258 
	`sûk_autoc‹ªœti⁄_FLP
–
auto_c‹r
, 
x_wödowed
, 
psEnc
->
sCmn
.
sh≠eWöLígth
,ÖsEnc->sCmn.
sh≠ögLPCOrdî
 + 1 );

262 
auto_c‹r
[ 0 ] +auto_c‹r[ 0 ] * 
SHAPE_WHITE_NOISE_FRACTION
 + 1.0f;

265 
ƒg
 = 
	`sûk_schur_FLP
–
rc
, 
auto_c‹r
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

266 
	`sûk_k2a_FLP
–&
psEncCål
->
AR
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ], 
rc
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

267 
psEncCål
->
Gaös
[ 
k
 ] = ( 
sûk_Êﬂt
 )
	`sqπ
–
ƒg
 );

269 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

271 
psEncCål
->
Gaös
[ 
k
 ] *
	`w¨≥d_gaö
–&psEncCål->
AR
[ k * 
MAX_SHAPE_LPC_ORDER
 ], 
w¨pög
, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

275 
	`sûk_bwex∑ndî_FLP
–&
psEncCål
->
AR
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ], 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
, 
BWExp
 );

277 if–
psEnc
->
sCmn
.
w¨pög_Q16
 > 0 ) {

279 
	`w¨≥d_åue2m⁄ic_c€fs
–&
psEncCål
->
AR
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ], 
w¨pög
, 3.999f, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

282 
	`limô_c€fs
–&
psEncCål
->
AR
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ], 3.999f, 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
 );

290 
gaö_mu…
 = (
sûk_Êﬂt
)
	`pow
–2.0f, -0.16‡* 
SNR_adj_dB
 );

291 
gaö_add
 = (
sûk_Êﬂt
)
	`pow
–2.0f, 0.16‡* 
MIN_QGAIN_DB
 );

292  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

293 
psEncCål
->
Gaös
[ 
k
 ] *
gaö_mu…
;

294 
psEncCål
->
Gaös
[ 
k
 ] +
gaö_add
;

301 
°ªngth
 = 
LOW_FREQ_SHAPING
 * ( 1.0‡+ 
LOW_QUALITY_LOW_FREQ_SHAPING_DECR
 * ( 
psEnc
->
sCmn
.
öput_quÆôy_b™ds_Q15
[ 0 ] * ( 1.0f / 32768.0f ) - 1.0f ) );

302 
°ªngth
 *
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 * ( 1.0f / 256.0f );

303 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

306  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

307 
b
 = 0.2‡/ 
psEnc
->
sCmn
.
fs_kHz
 + 3.0‡/ 
psEncCål
->
pôchL
[ 
k
 ];

308 
psEncCål
->
LF_MA_shp
[ 
k
 ] = -1.0‡+ 
b
;

309 
psEncCål
->
LF_AR_shp
[ 
k
 ] = 1.0‡- 
b
 - b * 
°ªngth
;

311 
Tût
 = - 
HP_NOISE_COEF
 -

312 (1 - 
HP_NOISE_COEF
Ë* 
HARM_HP_NOISE_COEF
 * 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 * ( 1.0f / 256.0f );

314 
b
 = 1.3‡/ 
psEnc
->
sCmn
.
fs_kHz
;

315 
psEncCål
->
LF_MA_shp
[ 0 ] = -1.0‡+ 
b
;

316 
psEncCål
->
LF_AR_shp
[ 0 ] = 1.0‡- 
b
 - b * 
°ªngth
 * 0.6f;

317  
k
 = 1; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

318 
psEncCål
->
LF_MA_shp
[ 
k
 ] =ÖsEncCtrl->LF_MA_shp[ 0 ];

319 
psEncCål
->
LF_AR_shp
[ 
k
 ] =ÖsEncCtrl->LF_AR_shp[ 0 ];

321 
Tût
 = -
HP_NOISE_COEF
;

327 if–
USE_HARM_SHAPING
 && 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

329 
H¨mSh≠eGaö
 = 
HARMONIC_SHAPING
;

332 
H¨mSh≠eGaö
 +
HIGH_RATE_OR_LOW_QUALITY_HARMONIC_SHAPING
 *

333 –1.0‡- ( 1.0‡- 
psEncCål
->
codög_quÆôy
 ) *ÖsEncCål->
öput_quÆôy
 );

336 
H¨mSh≠eGaö
 *–
sûk_Êﬂt
 )
	`sqπ
–
psEnc
->
LTPC‹r
 );

338 
H¨mSh≠eGaö
 = 0.0f;

344  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

345 
psSh≠eSt
->
H¨mSh≠eGaö_smth
 +
SUBFR_SMTH_COEF
 * ( 
H¨mSh≠eGaö
 -ÖsShapeSt->HarmShapeGain_smth );

346 
psEncCål
->
H¨mSh≠eGaö
[ 
k
 ] = 
psSh≠eSt
->
H¨mSh≠eGaö_smth
;

347 
psSh≠eSt
->
Tût_smth
 +
SUBFR_SMTH_COEF
 * ( 
Tût
 -ÖsShapeSt->Tilt_smth );

348 
psEncCål
->
Tût
[ 
k
 ] = 
psSh≠eSt
->
Tût_smth
;

350 
	}
}

	@silk/float/pitch_analysis_core_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

35 
	~"SigProc_FLP.h
"

36 
	~"SigProc_FIX.h
"

37 
	~"pôch_e°_deföes.h
"

38 
	~"pôch.h
"

40 
	#SCRATCH_SIZE
 22

	)

45 
sûk_P_A«_ˇlc_c‹r_°3
(

46 
sûk_Êﬂt
 
¸oss_c‹r_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ],

47 c⁄° 
sûk_Êﬂt
 
‰ame
[],

48 
›us_öt
 
°¨t_œg
,

49 
›us_öt
 
sf_Àngth
,

50 
›us_öt
 
nb_sub‰
,

51 
›us_öt
 
com∂exôy
,

52 
¨ch


55 
sûk_P_A«_ˇlc_íîgy_°3
(

56 
sûk_Êﬂt
 
íîgõs_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ],

57 c⁄° 
sûk_Êﬂt
 
‰ame
[],

58 
›us_öt
 
°¨t_œg
,

59 
›us_öt
 
sf_Àngth
,

60 
›us_öt
 
nb_sub‰
,

61 
›us_öt
 
com∂exôy


67 
›us_öt
 
	$sûk_pôch_™Æysis_c‹e_FLP
(

68 c⁄° 
sûk_Êﬂt
 *
‰ame
,

69 
›us_öt
 *
pôch_out
,

70 
›us_öt16
 *
œgIndex
,

71 
›us_öt8
 *
c⁄tourIndex
,

72 
sûk_Êﬂt
 *
LTPC‹r
,

73 
›us_öt
 
¥evLag
,

74 c⁄° 
sûk_Êﬂt
 
£¨ch_thªs1
,

75 c⁄° 
sûk_Êﬂt
 
£¨ch_thªs2
,

76 c⁄° 
›us_öt
 
Fs_kHz
,

77 c⁄° 
›us_öt
 
com∂exôy
,

78 c⁄° 
›us_öt
 
nb_sub‰
,

79 
¨ch


82 
›us_öt
 
i
, 
k
, 
d
, 
j
;

83 
sûk_Êﬂt
 
‰ame_8kHz
[ 
PE_MAX_FRAME_LENGTH_MS
 * 8 ];

84 
sûk_Êﬂt
 
‰ame_4kHz
[ 
PE_MAX_FRAME_LENGTH_MS
 * 4 ];

85 
›us_öt16
 
‰ame_8_FIX
[ 
PE_MAX_FRAME_LENGTH_MS
 * 8 ];

86 
›us_öt16
 
‰ame_4_FIX
[ 
PE_MAX_FRAME_LENGTH_MS
 * 4 ];

87 
›us_öt32
 
fût_°©e
[ 6 ];

88 
sûk_Êﬂt
 
thªshﬁd
, 
c⁄tour_büs
;

89 
sûk_Êﬂt
 
C
[ 
PE_MAX_NB_SUBFR
][ (
PE_MAX_LAG
 >> 1) + 5 ];

90 
›us_vÆ32
 
xc‹r
[ 
PE_MAX_LAG_MS
 * 4 - 
PE_MIN_LAG_MS
 * 4 + 1 ];

91 
sûk_Êﬂt
 
CC
[ 
PE_NB_CBKS_STAGE2_EXT
 ];

92 c⁄° 
sûk_Êﬂt
 *
èrgë_±r
, *
basis_±r
;

93 
¸oss_c‹r
, 
n‹mÆizî
, 
íîgy
, 
íîgy_tmp
;

94 
›us_öt
 
d_§ch
[ 
PE_D_SRCH_LENGTH
 ];

95 
›us_öt16
 
d_comp
[ (
PE_MAX_LAG
 >> 1) + 5 ];

96 
›us_öt
 
Àngth_d_§ch
, 
Àngth_d_comp
;

97 
sûk_Êﬂt
 
Cmax
, 
CCmax
, 
CCmax_b
, 
CCmax_√w_b
, 
CCmax_√w
;

98 
›us_öt
 
CBimax
, 
CBimax_√w
, 
œg
, 
°¨t_œg
, 
íd_œg
, 
œg_√w
;

99 
›us_öt
 
cbk_size
;

100 
sûk_Êﬂt
 
œg_log2
, 
¥evLag_log2
, 
dñè_œg_log2_sqr
;

101 
sûk_Êﬂt
 
íîgõs_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ];

102 
sûk_Êﬂt
 
¸oss_c‹r_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ];

103 
›us_öt
 
œg_cou¡î
;

104 
›us_öt
 
‰ame_Àngth
, 
‰ame_Àngth_8kHz
, 
‰ame_Àngth_4kHz
;

105 
›us_öt
 
sf_Àngth
, 
sf_Àngth_8kHz
, 
sf_Àngth_4kHz
;

106 
›us_öt
 
mö_œg
, 
mö_œg_8kHz
, 
mö_œg_4kHz
;

107 
›us_öt
 
max_œg
, 
max_œg_8kHz
, 
max_œg_4kHz
;

108 
›us_öt
 
nb_cbk_£¨ch
;

109 c⁄° 
›us_öt8
 *
Lag_CB_±r
;

112 
	`˚…_as£π
–
Fs_kHz
 == 8 || Fs_kHz == 12 || Fs_kHz == 16 );

115 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

116 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

118 
	`sûk_as£π
–
£¨ch_thªs1
 >= 0.0f && search_thres1 <= 1.0f );

119 
	`sûk_as£π
–
£¨ch_thªs2
 >= 0.0f && search_thres2 <= 1.0f );

122 
‰ame_Àngth
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 
Fs_kHz
;

123 
‰ame_Àngth_4kHz
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 4;

124 
‰ame_Àngth_8kHz
 = ( 
PE_LTP_MEM_LENGTH_MS
 + 
nb_sub‰
 * 
PE_SUBFR_LENGTH_MS
 ) * 8;

125 
sf_Àngth
 = 
PE_SUBFR_LENGTH_MS
 * 
Fs_kHz
;

126 
sf_Àngth_4kHz
 = 
PE_SUBFR_LENGTH_MS
 * 4;

127 
sf_Àngth_8kHz
 = 
PE_SUBFR_LENGTH_MS
 * 8;

128 
mö_œg
 = 
PE_MIN_LAG_MS
 * 
Fs_kHz
;

129 
mö_œg_4kHz
 = 
PE_MIN_LAG_MS
 * 4;

130 
mö_œg_8kHz
 = 
PE_MIN_LAG_MS
 * 8;

131 
max_œg
 = 
PE_MAX_LAG_MS
 * 
Fs_kHz
 - 1;

132 
max_œg_4kHz
 = 
PE_MAX_LAG_MS
 * 4;

133 
max_œg_8kHz
 = 
PE_MAX_LAG_MS
 * 8 - 1;

136 if–
Fs_kHz
 == 16 ) {

138 
›us_öt16
 
‰ame_16_FIX
[ 16 * 
PE_MAX_FRAME_LENGTH_MS
 ];

139 
	`sûk_Êﬂt2sh‹t_¨øy
–
‰ame_16_FIX
, 
‰ame
, 
‰ame_Àngth
 );

140 
	`sûk_mem£t
–
fût_°©e
, 0, 2 * –
›us_öt32
 ) );

141 
	`sûk_ªßm∂î_down2
–
fût_°©e
, 
‰ame_8_FIX
, 
‰ame_16_FIX
, 
‰ame_Àngth
 );

142 
	`sûk_sh‹t2Êﬂt_¨øy
–
‰ame_8kHz
, 
‰ame_8_FIX
, 
‰ame_Àngth_8kHz
 );

143 } if–
Fs_kHz
 == 12 ) {

145 
›us_öt16
 
‰ame_12_FIX
[ 12 * 
PE_MAX_FRAME_LENGTH_MS
 ];

146 
	`sûk_Êﬂt2sh‹t_¨øy
–
‰ame_12_FIX
, 
‰ame
, 
‰ame_Àngth
 );

147 
	`sûk_mem£t
–
fût_°©e
, 0, 6 * –
›us_öt32
 ) );

148 
	`sûk_ªßm∂î_down2_3
–
fût_°©e
, 
‰ame_8_FIX
, 
‰ame_12_FIX
, 
‰ame_Àngth
 );

149 
	`sûk_sh‹t2Êﬂt_¨øy
–
‰ame_8kHz
, 
‰ame_8_FIX
, 
‰ame_Àngth_8kHz
 );

151 
	`˚…_as£π
–
Fs_kHz
 == 8 );

152 
	`sûk_Êﬂt2sh‹t_¨øy
–
‰ame_8_FIX
, 
‰ame
, 
‰ame_Àngth_8kHz
 );

156 
	`sûk_mem£t
–
fût_°©e
, 0, 2 * –
›us_öt32
 ) );

157 
	`sûk_ªßm∂î_down2
–
fût_°©e
, 
‰ame_4_FIX
, 
‰ame_8_FIX
, 
‰ame_Àngth_8kHz
 );

158 
	`sûk_sh‹t2Êﬂt_¨øy
–
‰ame_4kHz
, 
‰ame_4_FIX
, 
‰ame_Àngth_4kHz
 );

161  
i
 = 
‰ame_Àngth_4kHz
 - 1; i > 0; i-- ) {

162 
‰ame_4kHz
[ 
i
 ] = 
	`sûk_ADD_SAT16
( frame_4kHz[ i ], frame_4kHz[ i - 1 ] );

168 
	`sûk_mem£t
(
C
, 0, (
sûk_Êﬂt
Ë* 
nb_sub‰
 * ((
PE_MAX_LAG
 >> 1) + 5));

169 
èrgë_±r
 = &
‰ame_4kHz
[ 
	`sûk_LSHIFT
–
sf_Àngth_4kHz
, 2 ) ];

170  
k
 = 0; k < 
nb_sub‰
 >> 1; k++ ) {

172 
	`˚…_as£π
–
èrgë_±r
 >
‰ame_4kHz
 );

173 
	`˚…_as£π
–
èrgë_±r
 + 
sf_Àngth_8kHz
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

175 
basis_±r
 = 
èrgë_±r
 - 
mö_œg_4kHz
;

178 
	`˚…_as£π
–
basis_±r
 >
‰ame_4kHz
 );

179 
	`˚…_as£π
–
basis_±r
 + 
sf_Àngth_8kHz
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

181 
	`˚…_pôch_xc‹r
–
èrgë_±r
,Å¨gë_±r-
max_œg_4kHz
, 
xc‹r
, 
sf_Àngth_8kHz
, max_œg_4kHz - 
mö_œg_4kHz
 + 1, 
¨ch
 );

184 
¸oss_c‹r
 = 
xc‹r
[ 
max_œg_4kHz
 - 
mö_œg_4kHz
 ];

185 
n‹mÆizî
 = 
	`sûk_íîgy_FLP
–
èrgë_±r
, 
sf_Àngth_8kHz
 ) +

186 
	`sûk_íîgy_FLP
–
basis_±r
, 
sf_Àngth_8kHz
 ) +

187 
sf_Àngth_8kHz
 * 4000.0f;

189 
C
[ 0 ][ 
mö_œg_4kHz
 ] +(
sûk_Êﬂt
)–2 * 
¸oss_c‹r
 / 
n‹mÆizî
 );

192  
d
 = 
mö_œg_4kHz
 + 1; d <
max_œg_4kHz
; d++ ) {

193 
basis_±r
--;

196 
	`sûk_as£π
–
basis_±r
 >
‰ame_4kHz
 );

197 
	`sûk_as£π
–
basis_±r
 + 
sf_Àngth_8kHz
 <
‰ame_4kHz
 + 
‰ame_Àngth_4kHz
 );

199 
¸oss_c‹r
 = 
xc‹r
[ 
max_œg_4kHz
 - 
d
 ];

202 
n‹mÆizî
 +=

203 
basis_±r
[ 0 ] * ()basis_ptr[ 0 ] -

204 
basis_±r
[ 
sf_Àngth_8kHz
 ] * ()basis_ptr[ sf_length_8kHz ];

205 
C
[ 0 ][ 
d
 ] +(
sûk_Êﬂt
)–2 * 
¸oss_c‹r
 / 
n‹mÆizî
 );

208 
èrgë_±r
 +
sf_Àngth_8kHz
;

212  
i
 = 
max_œg_4kHz
; i >
mö_œg_4kHz
; i-- ) {

213 
C
[ 0 ][ 
i
 ] -= C[ 0 ][ i ] * i / 4096.0f;

217 
Àngth_d_§ch
 = 4 + 2 * 
com∂exôy
;

218 
	`˚…_as£π
–3 * 
Àngth_d_§ch
 <
PE_D_SRCH_LENGTH
 );

219 
	`sûk_ö£πi⁄_s‹t_de¸ósög_FLP
–&
C
[ 0 ][ 
mö_œg_4kHz
 ], 
d_§ch
, 
max_œg_4kHz
 - mö_œg_4kHz + 1, 
Àngth_d_§ch
 );

222 
Cmax
 = 
C
[ 0 ][ 
mö_œg_4kHz
 ];

223 if–
Cmax
 < 0.2f ) {

224 
	`sûk_mem£t
–
pôch_out
, 0, 
nb_sub‰
 * –
›us_öt
 ) );

225 *
LTPC‹r
 = 0.0f;

226 *
œgIndex
 = 0;

227 *
c⁄tourIndex
 = 0;

231 
thªshﬁd
 = 
£¨ch_thªs1
 * 
Cmax
;

232  
i
 = 0; i < 
Àngth_d_§ch
; i++ ) {

234 if–
C
[ 0 ][ 
mö_œg_4kHz
 + 
i
 ] > 
thªshﬁd
 ) {

235 
d_§ch
[ 
i
 ] = 
	`sûk_LSHIFT
–d_§ch[ i ] + 
mö_œg_4kHz
, 1 );

237 
Àngth_d_§ch
 = 
i
;

241 
	`˚…_as£π
–
Àngth_d_§ch
 > 0 );

243  
i
 = 
mö_œg_8kHz
 - 5; i < 
max_œg_8kHz
 + 5; i++ ) {

244 
d_comp
[ 
i
 ] = 0;

246  
i
 = 0; i < 
Àngth_d_§ch
; i++ ) {

247 
d_comp
[ 
d_§ch
[ 
i
 ] ] = 1;

251  
i
 = 
max_œg_8kHz
 + 3; i >
mö_œg_8kHz
; i-- ) {

252 
d_comp
[ 
i
 ] += d_comp[ i - 1 ] + d_comp[ i - 2 ];

255 
Àngth_d_§ch
 = 0;

256  
i
 = 
mö_œg_8kHz
; i < 
max_œg_8kHz
 + 1; i++ ) {

257 if–
d_comp
[ 
i
 + 1 ] > 0 ) {

258 
d_§ch
[ 
Àngth_d_§ch
 ] = 
i
;

259 
Àngth_d_§ch
++;

264  
i
 = 
max_œg_8kHz
 + 3; i >
mö_œg_8kHz
; i-- ) {

265 
d_comp
[ 
i
 ] += d_comp[ i - 1 ] + d_comp[ i - 2 ] + d_comp[ i - 3 ];

268 
Àngth_d_comp
 = 0;

269  
i
 = 
mö_œg_8kHz
; i < 
max_œg_8kHz
 + 4; i++ ) {

270 if–
d_comp
[ 
i
 ] > 0 ) {

271 
d_comp
[ 
Àngth_d_comp
 ] = (
›us_öt16
)–
i
 - 2 );

272 
Àngth_d_comp
++;

282 
	`sûk_mem£t
–
C
, 0, 
PE_MAX_NB_SUBFR
*((
PE_MAX_LAG
 >> 1Ë+ 5Ë* (
sûk_Êﬂt
));

284 if–
Fs_kHz
 == 8 ) {

285 
èrgë_±r
 = &
‰ame
[ 
PE_LTP_MEM_LENGTH_MS
 * 8 ];

287 
èrgë_±r
 = &
‰ame_8kHz
[ 
PE_LTP_MEM_LENGTH_MS
 * 8 ];

289  
k
 = 0; k < 
nb_sub‰
; k++ ) {

290 
íîgy_tmp
 = 
	`sûk_íîgy_FLP
–
èrgë_±r
, 
sf_Àngth_8kHz
 ) + 1.0;

291  
j
 = 0; j < 
Àngth_d_comp
; j++ ) {

292 
d
 = 
d_comp
[ 
j
 ];

293 
basis_±r
 = 
èrgë_±r
 - 
d
;

294 
¸oss_c‹r
 = 
	`sûk_ö√r_¥odu˘_FLP
–
basis_±r
, 
èrgë_±r
, 
sf_Àngth_8kHz
 );

295 if–
¸oss_c‹r
 > 0.0f ) {

296 
íîgy
 = 
	`sûk_íîgy_FLP
–
basis_±r
, 
sf_Àngth_8kHz
 );

297 
C
[ 
k
 ][ 
d
 ] = (
sûk_Êﬂt
)–2 * 
¸oss_c‹r
 / ( 
íîgy
 + 
íîgy_tmp
 ) );

299 
C
[ 
k
 ][ 
d
 ] = 0.0f;

302 
èrgë_±r
 +
sf_Àngth_8kHz
;

308 
CCmax
 = 0.0f;

309 
CCmax_b
 = -1000.0f;

311 
CBimax
 = 0;

312 
œg
 = -1;

314 if–
¥evLag
 > 0 ) {

315 if–
Fs_kHz
 == 12 ) {

316 
¥evLag
 = 
	`sûk_LSHIFT
(ÖrevLag, 1 ) / 3;

317 } if–
Fs_kHz
 == 16 ) {

318 
¥evLag
 = 
	`sûk_RSHIFT
(ÖrevLag, 1 );

320 
¥evLag_log2
 = 
	`sûk_log2
–(
sûk_Êﬂt
)
¥evLag
 );

322 
¥evLag_log2
 = 0;

326 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

327 
cbk_size
 = 
PE_NB_CBKS_STAGE2_EXT
;

328 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2
[ 0 ][ 0 ];

329 if–
Fs_kHz
 =8 && 
com∂exôy
 > 
SILK_PE_MIN_COMPLEX
 ) {

331 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2_EXT
;

333 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2
;

336 
cbk_size
 = 
PE_NB_CBKS_STAGE2_10MS
;

337 
Lag_CB_±r
 = &
sûk_CB_œgs_°age2_10_ms
[ 0 ][ 0 ];

338 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE2_10MS
;

341  
k
 = 0; k < 
Àngth_d_§ch
; k++ ) {

342 
d
 = 
d_§ch
[ 
k
 ];

343  
j
 = 0; j < 
nb_cbk_£¨ch
; j++ ) {

344 
CC
[
j
] = 0.0f;

345  
i
 = 0; i < 
nb_sub‰
; i++ ) {

347 
CC
[ 
j
 ] +
C
[ 
i
 ][ 
d
 + 
	`m©rix_±r
–
Lag_CB_±r
, i, j, 
cbk_size
 )];

351 
CCmax_√w
 = -1000.0f;

352 
CBimax_√w
 = 0;

353  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

354 if–
CC
[ 
i
 ] > 
CCmax_√w
 ) {

355 
CCmax_√w
 = 
CC
[ 
i
 ];

356 
CBimax_√w
 = 
i
;

361 
œg_log2
 = 
	`sûk_log2
–(
sûk_Êﬂt
)
d
 );

362 
CCmax_√w_b
 = 
CCmax_√w
 - 
PE_SHORTLAG_BIAS
 * 
nb_sub‰
 * 
œg_log2
;

365 if–
¥evLag
 > 0 ) {

366 
dñè_œg_log2_sqr
 = 
œg_log2
 - 
¥evLag_log2
;

367 
dñè_œg_log2_sqr
 *= delta_lag_log2_sqr;

368 
CCmax_√w_b
 -
PE_PREVLAG_BIAS
 * 
nb_sub‰
 * (*
LTPC‹r
Ë* 
dñè_œg_log2_sqr
 / ( delta_lag_log2_sqr + 0.5f );

371 if–
CCmax_√w_b
 > 
CCmax_b
 &&

372 
CCmax_√w
 > 
nb_sub‰
 * 
£¨ch_thªs2


374 
CCmax_b
 = 
CCmax_√w_b
;

375 
CCmax
 = 
CCmax_√w
;

376 
œg
 = 
d
;

377 
CBimax
 = 
CBimax_√w
;

381 if–
œg
 == -1 ) {

383 
	`sûk_mem£t
–
pôch_out
, 0, 
PE_MAX_NB_SUBFR
 * (
›us_öt
) );

384 *
LTPC‹r
 = 0.0f;

385 *
œgIndex
 = 0;

386 *
c⁄tourIndex
 = 0;

391 *
LTPC‹r
 = (
sûk_Êﬂt
)–
CCmax
 / 
nb_sub‰
 );

392 
	`sûk_as£π
–*
LTPC‹r
 >= 0.0f );

394 if–
Fs_kHz
 > 8 ) {

398 
	`sûk_as£π
–
œg
 =
	`sûk_SAT16
(Üag ) );

399 if–
Fs_kHz
 == 12 ) {

400 
œg
 = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULBB
(Üag, 3 ), 1 );

402 
œg
 = 
	`sûk_LSHIFT
(Üag, 1 );

405 
œg
 = 
	`sûk_LIMIT_öt
–œg, 
mö_œg
, 
max_œg
 );

406 
°¨t_œg
 = 
	`sûk_max_öt
–
œg
 - 2, 
mö_œg
 );

407 
íd_œg
 = 
	`sûk_mö_öt
–
œg
 + 2, 
max_œg
 );

408 
œg_√w
 = 
œg
;

409 
CBimax
 = 0;

411 
CCmax
 = -1000.0f;

414 
	`sûk_P_A«_ˇlc_c‹r_°3
–
¸oss_c‹r_°3
, 
‰ame
, 
°¨t_œg
, 
sf_Àngth
, 
nb_sub‰
, 
com∂exôy
, 
¨ch
 );

415 
	`sûk_P_A«_ˇlc_íîgy_°3
–
íîgõs_°3
, 
‰ame
, 
°¨t_œg
, 
sf_Àngth
, 
nb_sub‰
, 
com∂exôy
 );

417 
œg_cou¡î
 = 0;

418 
	`sûk_as£π
–
œg
 =
	`sûk_SAT16
(Üag ) );

419 
c⁄tour_büs
 = 
PE_FLATCONTOUR_BIAS
 / 
œg
;

422 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

423 
nb_cbk_£¨ch
 = (
›us_öt
)
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

424 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

425 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

427 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

428 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

429 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

432 
èrgë_±r
 = &
‰ame
[ 
PE_LTP_MEM_LENGTH_MS
 * 
Fs_kHz
 ];

433 
íîgy_tmp
 = 
	`sûk_íîgy_FLP
–
èrgë_±r
, 
nb_sub‰
 * 
sf_Àngth
 ) + 1.0;

434  
d
 = 
°¨t_œg
; d <
íd_œg
; d++ ) {

435  
j
 = 0; j < 
nb_cbk_£¨ch
; j++ ) {

436 
¸oss_c‹r
 = 0.0;

437 
íîgy
 = 
íîgy_tmp
;

438  
k
 = 0; k < 
nb_sub‰
; k++ ) {

439 
¸oss_c‹r
 +
¸oss_c‹r_°3
[ 
k
 ][ 
j
 ][ 
œg_cou¡î
 ];

440 
íîgy
 +
íîgõs_°3
[ 
k
 ][ 
j
 ][ 
œg_cou¡î
 ];

442 if–
¸oss_c‹r
 > 0.0 ) {

443 
CCmax_√w
 = (
sûk_Êﬂt
)–2 * 
¸oss_c‹r
 / 
íîgy
 );

445 
CCmax_√w
 *1.0‡- 
c⁄tour_büs
 * 
j
;

447 
CCmax_√w
 = 0.0f;

450 if–
CCmax_√w
 > 
CCmax
 && ( 
d
 + (
›us_öt
)
sûk_CB_œgs_°age3
[ 0 ][ 
j
 ] ) <
max_œg
 ) {

451 
CCmax
 = 
CCmax_√w
;

452 
œg_√w
 = 
d
;

453 
CBimax
 = 
j
;

456 
œg_cou¡î
++;

459  
k
 = 0; k < 
nb_sub‰
; k++ ) {

460 
pôch_out
[ 
k
 ] = 
œg_√w
 + 
	`m©rix_±r
–
Lag_CB_±r
, k, 
CBimax
, 
cbk_size
 );

461 
pôch_out
[ 
k
 ] = 
	`sûk_LIMIT
–pôch_out[ k ], 
mö_œg
, 
PE_MAX_LAG_MS
 * 
Fs_kHz
 );

463 *
œgIndex
 = (
›us_öt16
)–
œg_√w
 - 
mö_œg
 );

464 *
c⁄tourIndex
 = (
›us_öt8
)
CBimax
;

467  
k
 = 0; k < 
nb_sub‰
; k++ ) {

468 
pôch_out
[ 
k
 ] = 
œg
 + 
	`m©rix_±r
–
Lag_CB_±r
, k, 
CBimax
, 
cbk_size
 );

469 
pôch_out
[ 
k
 ] = 
	`sûk_LIMIT
–pôch_out[ k ], 
mö_œg_8kHz
, 
PE_MAX_LAG_MS
 * 8 );

471 *
œgIndex
 = (
›us_öt16
)–
œg
 - 
mö_œg_8kHz
 );

472 *
c⁄tourIndex
 = (
›us_öt8
)
CBimax
;

474 
	`˚…_as£π
–*
œgIndex
 >= 0 );

477 
	}
}

492 
	$sûk_P_A«_ˇlc_c‹r_°3
(

493 
sûk_Êﬂt
 
¸oss_c‹r_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ],

494 c⁄° 
sûk_Êﬂt
 
‰ame
[],

495 
›us_öt
 
°¨t_œg
,

496 
›us_öt
 
sf_Àngth
,

497 
›us_öt
 
nb_sub‰
,

498 
›us_öt
 
com∂exôy
,

499 
¨ch


502 c⁄° 
sûk_Êﬂt
 *
èrgë_±r
;

503 
›us_öt
 
i
, 
j
, 
k
, 
œg_cou¡î
, 
œg_low
, 
œg_high
;

504 
›us_öt
 
nb_cbk_£¨ch
, 
dñè
, 
idx
, 
cbk_size
;

505 
sûk_Êﬂt
 
s¸©ch_mem
[ 
SCRATCH_SIZE
 ];

506 
›us_vÆ32
 
xc‹r
[ 
SCRATCH_SIZE
 ];

507 c⁄° 
›us_öt8
 *
Lag_ønge_±r
, *
Lag_CB_±r
;

509 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

510 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

512 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

513 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3
[ 
com∂exôy
 ][ 0 ][ 0 ];

514 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

515 
nb_cbk_£¨ch
 = 
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

516 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

518 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1);

519 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3_10_ms
[ 0 ][ 0 ];

520 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

521 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

522 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

525 
èrgë_±r
 = &
‰ame
[ 
	`sûk_LSHIFT
–
sf_Àngth
, 2 ) ];

526  
k
 = 0; k < 
nb_sub‰
; k++ ) {

527 
œg_cou¡î
 = 0;

530 
œg_low
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

531 
œg_high
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 1, 2 );

532 
	`sûk_as£π
(
œg_high
-
œg_low
+1 <
SCRATCH_SIZE
);

533 
	`˚…_pôch_xc‹r
–
èrgë_±r
,Å¨gë_±∏- 
°¨t_œg
 - 
œg_high
, 
xc‹r
, 
sf_Àngth
,Üag_high - 
œg_low
 + 1, 
¨ch
 );

534  
j
 = 
œg_low
; j <
œg_high
; j++ ) {

535 
	`sûk_as£π
–
œg_cou¡î
 < 
SCRATCH_SIZE
 );

536 
s¸©ch_mem
[ 
œg_cou¡î
 ] = 
xc‹r
[ 
œg_high
 - 
j
 ];

537 
œg_cou¡î
++;

540 
dñè
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

541  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

544 
idx
 = 
	`m©rix_±r
–
Lag_CB_±r
, 
k
, 
i
, 
cbk_size
 ) - 
dñè
;

545  
j
 = 0; j < 
PE_NB_STAGE3_LAGS
; j++ ) {

546 
	`sûk_as£π
–
idx
 + 
j
 < 
SCRATCH_SIZE
 );

547 
	`sûk_as£π
–
idx
 + 
j
 < 
œg_cou¡î
 );

548 
¸oss_c‹r_°3
[ 
k
 ][ 
i
 ][ 
j
 ] = 
s¸©ch_mem
[ 
idx
 + j ];

551 
èrgë_±r
 +
sf_Àngth
;

553 
	}
}

559 
	$sûk_P_A«_ˇlc_íîgy_°3
(

560 
sûk_Êﬂt
 
íîgõs_°3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ][ 
PE_NB_STAGE3_LAGS
 ],

561 c⁄° 
sûk_Êﬂt
 
‰ame
[],

562 
›us_öt
 
°¨t_œg
,

563 
›us_öt
 
sf_Àngth
,

564 
›us_öt
 
nb_sub‰
,

565 
›us_öt
 
com∂exôy


568 c⁄° 
sûk_Êﬂt
 *
èrgë_±r
, *
basis_±r
;

569 
íîgy
;

570 
›us_öt
 
k
, 
i
, 
j
, 
œg_cou¡î
;

571 
›us_öt
 
nb_cbk_£¨ch
, 
dñè
, 
idx
, 
cbk_size
, 
œg_diff
;

572 
sûk_Êﬂt
 
s¸©ch_mem
[ 
SCRATCH_SIZE
 ];

573 c⁄° 
›us_öt8
 *
Lag_ønge_±r
, *
Lag_CB_±r
;

575 
	`˚…_as£π
–
com∂exôy
 >
SILK_PE_MIN_COMPLEX
 );

576 
	`˚…_as£π
–
com∂exôy
 <
SILK_PE_MAX_COMPLEX
 );

578 if–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 ) {

579 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3
[ 
com∂exôy
 ][ 0 ][ 0 ];

580 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3
[ 0 ][ 0 ];

581 
nb_cbk_£¨ch
 = 
sûk_nb_cbk_£¨chs_°age3
[ 
com∂exôy
 ];

582 
cbk_size
 = 
PE_NB_CBKS_STAGE3_MAX
;

584 
	`˚…_as£π
–
nb_sub‰
 =
PE_MAX_NB_SUBFR
 >> 1);

585 
Lag_ønge_±r
 = &
sûk_Lag_ønge_°age3_10_ms
[ 0 ][ 0 ];

586 
Lag_CB_±r
 = &
sûk_CB_œgs_°age3_10_ms
[ 0 ][ 0 ];

587 
nb_cbk_£¨ch
 = 
PE_NB_CBKS_STAGE3_10MS
;

588 
cbk_size
 = 
PE_NB_CBKS_STAGE3_10MS
;

591 
èrgë_±r
 = &
‰ame
[ 
	`sûk_LSHIFT
–
sf_Àngth
, 2 ) ];

592  
k
 = 0; k < 
nb_sub‰
; k++ ) {

593 
œg_cou¡î
 = 0;

596 
basis_±r
 = 
èrgë_±r
 - ( 
°¨t_œg
 + 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 ) );

597 
íîgy
 = 
	`sûk_íîgy_FLP
–
basis_±r
, 
sf_Àngth
 ) + 1e-3;

598 
	`sûk_as£π
–
íîgy
 >= 0.0 );

599 
s¸©ch_mem
[
œg_cou¡î
] = (
sûk_Êﬂt
)
íîgy
;

600 
œg_cou¡î
++;

602 
œg_diff
 = ( 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 1, 2 ) - matrix_ptr( Lag_range_ptr, k, 0, 2 ) + 1 );

603  
i
 = 1; i < 
œg_diff
; i++ ) {

605 
íîgy
 -
basis_±r
[
sf_Àngth
 - 
i
] * ()basis_ptr[sf_length - i];

606 
	`sûk_as£π
–
íîgy
 >= 0.0 );

609 
íîgy
 +
basis_±r
[ -
i
 ] * ()basis_ptr[ -i ];

610 
	`sûk_as£π
–
íîgy
 >= 0.0 );

611 
	`sûk_as£π
–
œg_cou¡î
 < 
SCRATCH_SIZE
 );

612 
s¸©ch_mem
[
œg_cou¡î
] = (
sûk_Êﬂt
)
íîgy
;

613 
œg_cou¡î
++;

616 
dñè
 = 
	`m©rix_±r
–
Lag_ønge_±r
, 
k
, 0, 2 );

617  
i
 = 0; i < 
nb_cbk_£¨ch
; i++ ) {

620 
idx
 = 
	`m©rix_±r
–
Lag_CB_±r
, 
k
, 
i
, 
cbk_size
 ) - 
dñè
;

621  
j
 = 0; j < 
PE_NB_STAGE3_LAGS
; j++ ) {

622 
	`sûk_as£π
–
idx
 + 
j
 < 
SCRATCH_SIZE
 );

623 
	`sûk_as£π
–
idx
 + 
j
 < 
œg_cou¡î
 );

624 
íîgõs_°3
[ 
k
 ][ 
i
 ][ 
j
 ] = 
s¸©ch_mem
[ 
idx
 + j ];

625 
	`sûk_as£π
–
íîgõs_°3
[ 
k
 ][ 
i
 ][ 
j
 ] >= 0.0f );

628 
èrgë_±r
 +
sf_Àngth
;

630 
	}
}

	@silk/float/process_gains_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

33 
	~"tunög_∑ømëîs.h
"

36 
	$sûk_¥o˚ss_gaös_FLP
(

37 
sûk_ícodî_°©e_FLP
 *
psEnc
,

38 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

39 
›us_öt
 
c⁄dCodög


42 
sûk_sh≠e_°©e_FLP
 *
psSh≠eSt
 = &
psEnc
->
sSh≠e
;

43 
›us_öt
 
k
;

44 
›us_öt32
 
pGaös_Q16
[ 
MAX_NB_SUBFR
 ];

45 
sûk_Êﬂt
 
s
, 
InvMaxSqrVÆ
, 
gaö
, 
qu™t_off£t
;

48 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

49 
s
 = 1.0‡- 0.5‡* 
	`sûk_sigmoid
–0.25‡* ( 
psEncCål
->
LTPªdCodGaö
 - 12.0f ) );

50  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

51 
psEncCål
->
Gaös
[ 
k
 ] *
s
;

56 
InvMaxSqrVÆ
 = ( 
sûk_Êﬂt
 )–
	`pow
–2.0f, 0.33‡* ( 21.0‡- 
psEnc
->
sCmn
.
SNR_dB_Q7
 * ( 1 / 128.0‡ËËË/ÖsEnc->sCmn.
sub‰_Àngth
 );

58  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

60 
gaö
 = 
psEncCål
->
Gaös
[ 
k
 ];

61 
gaö
 = ( 
sûk_Êﬂt
 )
	`sqπ
–gaö * gaö + 
psEncCål
->
ResNrg
[ 
k
 ] * 
InvMaxSqrVÆ
 );

62 
psEncCål
->
Gaös
[ 
k
 ] = 
	`sûk_mö_Êﬂt
–
gaö
, 32767.0f );

66  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

67 
pGaös_Q16
[ 
k
 ] = (
›us_öt32
)–
psEncCål
->
Gaös
[ k ] * 65536.0f );

71 
	`sûk_mem˝y
–
psEncCål
->
GaösUnq_Q16
, 
pGaös_Q16
, 
psEnc
->
sCmn
.
nb_sub‰
 * –
›us_öt32
 ) );

72 
psEncCål
->
œ°GaöIndexPªv
 = 
psSh≠eSt
->
La°GaöIndex
;

75 
	`sûk_gaös_qu™t
–
psEnc
->
sCmn
.
ödi˚s
.
GaösIndi˚s
, 
pGaös_Q16
,

76 &
psSh≠eSt
->
La°GaöIndex
, 
c⁄dCodög
 =
CODE_CONDITIONALLY
, 
psEnc
->
sCmn
.
nb_sub‰
 );

79  
k
 = 0; k < 
psEnc
->
sCmn
.
nb_sub‰
; k++ ) {

80 
psEncCål
->
Gaös
[ 
k
 ] = 
pGaös_Q16
[ k ] / 65536.0f;

84 if–
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 =
TYPE_VOICED
 ) {

85 if–
psEncCål
->
LTPªdCodGaö
 + 
psEnc
->
sCmn
.
öput_tût_Q15
 * ( 1.0f / 32768.0f ) > 1.0f ) {

86 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 0;

88 
psEnc
->
sCmn
.
ödi˚s
.
qu™tOff£tTy≥
 = 1;

93 
qu™t_off£t
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psEnc
->
sCmn
.
ödi˚s
.
sig«lTy≥
 >> 1 ][ÖsEnc->sCmn.ödi˚s.
qu™tOff£tTy≥
 ] / 1024.0f;

94 
psEncCål
->
Lambda
 = 
LAMBDA_OFFSET


95 + 
LAMBDA_DELAYED_DECISIONS
 * 
psEnc
->
sCmn
.
nSèãsDñayedDecisi⁄


96 + 
LAMBDA_SPEECH_ACT
 * 
psEnc
->
sCmn
.
•ìch_a˘ivôy_Q8
 * ( 1.0f / 256.0f )

97 + 
LAMBDA_INPUT_QUALITY
 * 
psEncCål
->
öput_quÆôy


98 + 
LAMBDA_CODING_QUALITY
 * 
psEncCål
->
codög_quÆôy


99 + 
LAMBDA_QUANT_OFFSET
 * 
qu™t_off£t
;

101 
	`sûk_as£π
–
psEncCål
->
Lambda
 > 0.0f );

102 
	`sûk_as£π
–
psEncCål
->
Lambda
 < 2.0f );

103 
	}
}

	@silk/float/regularize_correlations_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

35 
	$sûk_ªguœrize_c‹ªœti⁄s_FLP
(

36 
sûk_Êﬂt
 *
XX
,

37 
sûk_Êﬂt
 *
xx
,

38 c⁄° 
sûk_Êﬂt
 
noi£
,

39 c⁄° 
›us_öt
 
D


42 
›us_öt
 
i
;

44  
i
 = 0; i < 
D
; i++ ) {

45 
	`m©rix_±r
–&
XX
[ 0 ], 
i
, i, 
D
 ) +
noi£
;

47 
xx
[ 0 ] +
noi£
;

48 
	}
}

	@silk/float/residual_energy_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

34 
	#MAX_ITERATIONS_RESIDUAL_NRG
 10

	)

35 
	#REGULARIZATION_FACTOR
 1e-8f

	)

38 
sûk_Êﬂt
 
	$sûk_ªsiduÆ_íîgy_cov¨_FLP
(

39 c⁄° 
sûk_Êﬂt
 *
c
,

40 
sûk_Êﬂt
 *
wXX
,

41 c⁄° 
sûk_Êﬂt
 *
wXx
,

42 c⁄° 
sûk_Êﬂt
 
wxx
,

43 c⁄° 
›us_öt
 
D


46 
›us_öt
 
i
, 
j
, 
k
;

47 
sûk_Êﬂt
 
tmp
, 
ƒg
 = 0.0f, 
ªguœriz©i⁄
;

50 
	`˚…_as£π
–
D
 >= 0 );

52 
ªguœriz©i⁄
 = 
REGULARIZATION_FACTOR
 * ( 
wXX
[ 0 ] + wXX[ 
D
 * D - 1 ] );

53  
k
 = 0; k < 
MAX_ITERATIONS_RESIDUAL_NRG
; k++ ) {

54 
ƒg
 = 
wxx
;

56 
tmp
 = 0.0f;

57  
i
 = 0; i < 
D
; i++ ) {

58 
tmp
 +
wXx
[ 
i
 ] * 
c
[ i ];

60 
ƒg
 -2.0‡* 
tmp
;

63  
i
 = 0; i < 
D
; i++ ) {

64 
tmp
 = 0.0f;

65  
j
 = 
i
 + 1; j < 
D
; j++ ) {

66 
tmp
 +
	`m©rix_c_±r
–
wXX
, 
i
, 
j
, 
D
 ) * 
c
[ j ];

68 
ƒg
 +
c
[ 
i
 ] * ( 2.0‡* 
tmp
 + 
	`m©rix_c_±r
–
wXX
, i, i, 
D
 ) * c[ i ] );

70 if–
ƒg
 > 0 ) {

74  
i
 = 0; i < 
D
; i++ ) {

75 
	`m©rix_c_±r
–
wXX
, 
i
, i, 
D
 ) +
ªguœriz©i⁄
;

78 
ªguœriz©i⁄
 *= 2.0f;

81 if–
k
 =
MAX_ITERATIONS_RESIDUAL_NRG
 ) {

82 
	`sûk_as£π
–
ƒg
 == 0 );

83 
ƒg
 = 1.0f;

86  
ƒg
;

87 
	}
}

91 
	$sûk_ªsiduÆ_íîgy_FLP
(

92 
sûk_Êﬂt
 
ƒgs
[ 
MAX_NB_SUBFR
 ],

93 c⁄° 
sûk_Êﬂt
 
x
[],

94 
sûk_Êﬂt
 
a
[ 2 ][ 
MAX_LPC_ORDER
 ],

95 c⁄° 
sûk_Êﬂt
 
gaös
[],

96 c⁄° 
›us_öt
 
sub‰_Àngth
,

97 c⁄° 
›us_öt
 
nb_sub‰
,

98 c⁄° 
›us_öt
 
LPC_‹dî


101 
›us_öt
 
shi·
;

102 
sûk_Êﬂt
 *
LPC_ªs_±r
, 
LPC_ªs
[ ( 
MAX_FRAME_LENGTH
 + 
MAX_NB_SUBFR
 * 
MAX_LPC_ORDER
 ) / 2 ];

104 
LPC_ªs_±r
 = 
LPC_ªs
 + 
LPC_‹dî
;

105 
shi·
 = 
LPC_‹dî
 + 
sub‰_Àngth
;

108 
	`sûk_LPC_™Æysis_fûãr_FLP
–
LPC_ªs
, 
a
[ 0 ], 
x
 + 0 * 
shi·
, 2 * shi·, 
LPC_‹dî
 );

109 
ƒgs
[ 0 ] = ( 
sûk_Êﬂt
 )–
gaös
[ 0 ] * gaös[ 0 ] * 
	`sûk_íîgy_FLP
–
LPC_ªs_±r
 + 0 * 
shi·
, 
sub‰_Àngth
 ) );

110 
ƒgs
[ 1 ] = ( 
sûk_Êﬂt
 )–
gaös
[ 1 ] * gaös[ 1 ] * 
	`sûk_íîgy_FLP
–
LPC_ªs_±r
 + 1 * 
shi·
, 
sub‰_Àngth
 ) );

112 if–
nb_sub‰
 =
MAX_NB_SUBFR
 ) {

113 
	`sûk_LPC_™Æysis_fûãr_FLP
–
LPC_ªs
, 
a
[ 1 ], 
x
 + 2 * 
shi·
, 2 * shi·, 
LPC_‹dî
 );

114 
ƒgs
[ 2 ] = ( 
sûk_Êﬂt
 )–
gaös
[ 2 ] * gaös[ 2 ] * 
	`sûk_íîgy_FLP
–
LPC_ªs_±r
 + 0 * 
shi·
, 
sub‰_Àngth
 ) );

115 
ƒgs
[ 3 ] = ( 
sûk_Êﬂt
 )–
gaös
[ 3 ] * gaös[ 3 ] * 
	`sûk_íîgy_FLP
–
LPC_ªs_±r
 + 1 * 
shi·
, 
sub‰_Àngth
 ) );

117 
	}
}

	@silk/float/scale_copy_vector_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_sˇÀ_c›y_ve˘‹_FLP
(

36 
sûk_Êﬂt
 *
d©a_out
,

37 c⁄° 
sûk_Êﬂt
 *
d©a_ö
,

38 
sûk_Êﬂt
 
gaö
,

39 
›us_öt
 
d©aSize


42 
›us_öt
 
i
, 
d©aSize4
;

45 
d©aSize4
 = 
d©aSize
 & 0xFFFC;

46  
i
 = 0; i < 
d©aSize4
; i += 4 ) {

47 
d©a_out
[ 
i
 + 0 ] = 
gaö
 * 
d©a_ö
[ i + 0 ];

48 
d©a_out
[ 
i
 + 1 ] = 
gaö
 * 
d©a_ö
[ i + 1 ];

49 
d©a_out
[ 
i
 + 2 ] = 
gaö
 * 
d©a_ö
[ i + 2 ];

50 
d©a_out
[ 
i
 + 3 ] = 
gaö
 * 
d©a_ö
[ i + 3 ];

54  ; 
i
 < 
d©aSize
; i++ ) {

55 
d©a_out
[ 
i
 ] = 
gaö
 * 
d©a_ö
[ i ];

57 
	}
}

	@silk/float/scale_vector_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

35 
	$sûk_sˇÀ_ve˘‹_FLP
(

36 
sûk_Êﬂt
 *
d©a1
,

37 
sûk_Êﬂt
 
gaö
,

38 
›us_öt
 
d©aSize


41 
›us_öt
 
i
, 
d©aSize4
;

44 
d©aSize4
 = 
d©aSize
 & 0xFFFC;

45  
i
 = 0; i < 
d©aSize4
; i += 4 ) {

46 
d©a1
[ 
i
 + 0 ] *
gaö
;

47 
d©a1
[ 
i
 + 1 ] *
gaö
;

48 
d©a1
[ 
i
 + 2 ] *
gaö
;

49 
d©a1
[ 
i
 + 3 ] *
gaö
;

53  ; 
i
 < 
d©aSize
; i++ ) {

54 
d©a1
[ 
i
 ] *
gaö
;

56 
	}
}

	@silk/float/schur_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FLP.h
"

34 
sûk_Êﬂt
 
	$sûk_schur_FLP
(

35 
sûk_Êﬂt
 
ªÊ_c€f
[],

36 c⁄° 
sûk_Êﬂt
 
auto_c‹r
[],

37 
›us_öt
 
‹dî


40 
›us_öt
 
k
, 
n
;

41 
C
[ 
SILK_MAX_ORDER_LPC
 + 1 ][ 2 ];

42 
Ctmp1
, 
Ctmp2
, 
rc_tmp
;

44 
	`˚…_as£π
–
‹dî
 >0 && ordî <
SILK_MAX_ORDER_LPC
 );

47 
k
 = 0;

49 
C
[ 
k
 ][ 0 ] = C[ k ][ 1 ] = 
auto_c‹r
[ k ];

50 }  ++
k
 <
‹dî
 );

52  
k
 = 0; k < 
‹dî
; k++ ) {

54 
rc_tmp
 = -
C
[ 
k
 + 1 ][ 0 ] / 
	`sûk_max_Êﬂt
( C[ 0 ][ 1 ], 1e-9f );

57 
ªÊ_c€f
[ 
k
 ] = (
sûk_Êﬂt
)
rc_tmp
;

60  
n
 = 0;Ç < 
‹dî
 - 
k
;Ç++ ) {

61 
Ctmp1
 = 
C
[ 
n
 + 
k
 + 1 ][ 0 ];

62 
Ctmp2
 = 
C
[ 
n
 ][ 1 ];

63 
C
[ 
n
 + 
k
 + 1 ][ 0 ] = 
Ctmp1
 + 
Ctmp2
 * 
rc_tmp
;

64 
C
[ 
n
 ][ 1 ] = 
Ctmp2
 + 
Ctmp1
 * 
rc_tmp
;

69  (
sûk_Êﬂt
)
C
[ 0 ][ 1 ];

70 
	}
}

	@silk/float/sort_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

36 
	~"ty≥def.h
"

37 
	~"SigProc_FLP.h
"

39 
	$sûk_ö£πi⁄_s‹t_de¸ósög_FLP
(

40 
sûk_Êﬂt
 *
a
,

41 
›us_öt
 *
idx
,

42 c⁄° 
›us_öt
 
L
,

43 c⁄° 
›us_öt
 
K


46 
sûk_Êﬂt
 
vÆue
;

47 
›us_öt
 
i
, 
j
;

50 
	`˚…_as£π
–
K
 > 0 );

51 
	`˚…_as£π
–
L
 > 0 );

52 
	`˚…_as£π
–
L
 >
K
 );

55  
i
 = 0; i < 
K
; i++ ) {

56 
idx
[ 
i
 ] = i;

60  
i
 = 1; i < 
K
; i++ ) {

61 
vÆue
 = 
a
[ 
i
 ];

62  
j
 = 
i
 - 1; ( j >0 ) && ( 
vÆue
 > 
a
[ j ] ); j-- ) {

63 
a
[ 
j
 + 1 ] =á[ j ];

64 
idx
[ 
j
 + 1 ] = idx[ j ];

66 
a
[ 
j
 + 1 ] = 
vÆue
;

67 
idx
[ 
j
 + 1 ] = 
i
;

72  
i
 = 
K
; i < 
L
; i++ ) {

73 
vÆue
 = 
a
[ 
i
 ];

74 if–
vÆue
 > 
a
[ 
K
 - 1 ] ) {

75  
j
 = 
K
 - 2; ( j >0 ) && ( 
vÆue
 > 
a
[ j ] ); j-- ) {

76 
a
[ 
j
 + 1 ] =á[ j ];

77 
idx
[ 
j
 + 1 ] = idx[ j ];

79 
a
[ 
j
 + 1 ] = 
vÆue
;

80 
idx
[ 
j
 + 1 ] = 
i
;

83 
	}
}

	@silk/float/structs_FLP.h

28 #i‚de‡
SILK_STRUCTS_FLP_H


29 
	#SILK_STRUCTS_FLP_H


	)

31 
	~"ty≥def.h
"

32 
	~"maö.h
"

33 
	~"°ru˘s.h
"

35 #ifde‡
__˝lu•lus


44 
›us_öt8
 
La°GaöIndex
;

45 
sûk_Êﬂt
 
H¨mSh≠eGaö_smth
;

46 
sûk_Êﬂt
 
Tût_smth
;

47 } 
	tsûk_sh≠e_°©e_FLP
;

53 
sûk_ícodî_°©e
 
sCmn
;

54 
sûk_sh≠e_°©e_FLP
 
sSh≠e
;

57 
sûk_Êﬂt
 
x_buf
[ 2 * 
MAX_FRAME_LENGTH
 + 
LA_SHAPE_MAX
 ];

58 
sûk_Êﬂt
 
LTPC‹r
;

59 } 
	tsûk_ícodî_°©e_FLP
;

66 
sûk_Êﬂt
 
Gaös
[ 
MAX_NB_SUBFR
 ];

67 
sûk_Êﬂt
 
PªdC€f
[ 2 ][ 
MAX_LPC_ORDER
 ];

68 
sûk_Êﬂt
 
LTPC€f
[
LTP_ORDER
 * 
MAX_NB_SUBFR
];

69 
sûk_Êﬂt
 
LTP_sˇÀ
;

70 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ];

73 
sûk_Êﬂt
 
AR
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ];

74 
sûk_Êﬂt
 
LF_MA_shp
[ 
MAX_NB_SUBFR
 ];

75 
sûk_Êﬂt
 
LF_AR_shp
[ 
MAX_NB_SUBFR
 ];

76 
sûk_Êﬂt
 
Tût
[ 
MAX_NB_SUBFR
 ];

77 
sûk_Êﬂt
 
H¨mSh≠eGaö
[ 
MAX_NB_SUBFR
 ];

78 
sûk_Êﬂt
 
Lambda
;

79 
sûk_Êﬂt
 
öput_quÆôy
;

80 
sûk_Êﬂt
 
codög_quÆôy
;

83 
sûk_Êﬂt
 
¥edGaö
;

84 
sûk_Êﬂt
 
LTPªdCodGaö
;

85 
sûk_Êﬂt
 
ResNrg
[ 
MAX_NB_SUBFR
 ];

88 
›us_öt32
 
GaösUnq_Q16
[ 
MAX_NB_SUBFR
 ];

89 
›us_öt8
 
œ°GaöIndexPªv
;

90 } 
	tsûk_ícodî_c⁄åﬁ_FLP
;

96 
sûk_ícodî_°©e_FLP
 
°©e_Fxx
[ 
ENCODER_NUM_CHANNELS
 ];

97 
°îeo_íc_°©e
 
sSãªo
;

98 
›us_öt32
 
nBôsU£dLBRR
;

99 
›us_öt32
 
nBôsEx˚eded
;

100 
›us_öt
 
nCh™√lsAPI
;

101 
›us_öt
 
nCh™√lsI¡î«l
;

102 
›us_öt
 
nPªvCh™√lsI¡î«l
;

103 
›us_öt
 
timeSö˚SwôchAŒowed_ms
;

104 
›us_öt
 
ÆlowB™dwidthSwôch
;

105 
›us_öt
 
¥ev_decode_⁄ly_middÀ
;

106 } 
	tsûk_ícodî
;

108 #ifde‡
__˝lu•lus


	@silk/float/warped_autocorrelation_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

35 
	$sûk_w¨≥d_autoc‹ªœti⁄_FLP
(

36 
sûk_Êﬂt
 *
c‹r
,

37 c⁄° 
sûk_Êﬂt
 *
öput
,

38 c⁄° 
sûk_Êﬂt
 
w¨pög
,

39 c⁄° 
›us_öt
 
Àngth
,

40 c⁄° 
›us_öt
 
‹dî


43 
›us_öt
 
n
, 
i
;

44 
tmp1
, 
tmp2
;

45 
°©e
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

46 
C
[ 
MAX_SHAPE_LPC_ORDER
 + 1 ] = { 0 };

49 
	`˚…_as£π
––
‹dî
 & 1 ) == 0 );

52  
n
 = 0;Ç < 
Àngth
;Ç++ ) {

53 
tmp1
 = 
öput
[ 
n
 ];

55  
i
 = 0; i < 
‹dî
; i += 2 ) {

57 
tmp2
 = 
°©e
[ 
i
 ] + 
w¨pög
 * ( sèã[ i + 1 ] - 
tmp1
 );

58 
°©e
[ 
i
 ] = 
tmp1
;

59 
C
[ 
i
 ] +
°©e
[ 0 ] * 
tmp1
;

61 
tmp1
 = 
°©e
[ 
i
 + 1 ] + 
w¨pög
 * ( sèã[ i + 2 ] - 
tmp2
 );

62 
°©e
[ 
i
 + 1 ] = 
tmp2
;

63 
C
[ 
i
 + 1 ] +
°©e
[ 0 ] * 
tmp2
;

65 
°©e
[ 
‹dî
 ] = 
tmp1
;

66 
C
[ 
‹dî
 ] +
°©e
[ 0 ] * 
tmp1
;

70  
i
 = 0; i < 
‹dî
 + 1; i++ ) {

71 
c‹r
[ 
i
 ] = ( 
sûk_Êﬂt
 )
C
[ i ];

73 
	}
}

	@silk/float/wrappers_FLP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö_FLP.h
"

37 
	$sûk_A2NLSF_FLP
(

38 
›us_öt16
 *
NLSF_Q15
,

39 c⁄° 
sûk_Êﬂt
 *
pAR
,

40 c⁄° 
›us_öt
 
LPC_‹dî


43 
›us_öt
 
i
;

44 
›us_öt32
 
a_fix_Q16
[ 
MAX_LPC_ORDER
 ];

46  
i
 = 0; i < 
LPC_‹dî
; i++ ) {

47 
a_fix_Q16
[ 
i
 ] = 
	`sûk_Êﬂt2öt
–
pAR
[ i ] * 65536.0f );

50 
	`sûk_A2NLSF
–
NLSF_Q15
, 
a_fix_Q16
, 
LPC_‹dî
 );

51 
	}
}

54 
	$sûk_NLSF2A_FLP
(

55 
sûk_Êﬂt
 *
pAR
,

56 c⁄° 
›us_öt16
 *
NLSF_Q15
,

57 c⁄° 
›us_öt
 
LPC_‹dî
,

58 
¨ch


61 
›us_öt
 
i
;

62 
›us_öt16
 
a_fix_Q12
[ 
MAX_LPC_ORDER
 ];

64 
	`sûk_NLSF2A
–
a_fix_Q12
, 
NLSF_Q15
, 
LPC_‹dî
, 
¨ch
 );

66  
i
 = 0; i < 
LPC_‹dî
; i++ ) {

67 
pAR
[ 
i
 ] = ( 
sûk_Êﬂt
 )
a_fix_Q12
[ i ] * ( 1.0f / 4096.0f );

69 
	}
}

74 
	$sûk_¥o˚ss_NLSFs_FLP
(

75 
sûk_ícodî_°©e
 *
psEncC
,

76 
sûk_Êﬂt
 
PªdC€f
[ 2 ][ 
MAX_LPC_ORDER
 ],

77 
›us_öt16
 
NLSF_Q15
[ 
MAX_LPC_ORDER
 ],

78 c⁄° 
›us_öt16
 
¥ev_NLSF_Q15
[ 
MAX_LPC_ORDER
 ]

81 
›us_öt
 
i
, 
j
;

82 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ];

84 
	`sûk_¥o˚ss_NLSFs
–
psEncC
, 
PªdC€f_Q12
, 
NLSF_Q15
, 
¥ev_NLSF_Q15
);

86  
j
 = 0; j < 2; j++ ) {

87  
i
 = 0; i < 
psEncC
->
¥edi˘LPCOrdî
; i++ ) {

88 
PªdC€f
[ 
j
 ][ 
i
 ] = ( 
sûk_Êﬂt
 )
PªdC€f_Q12
[ j ][ i ] * ( 1.0f / 4096.0f );

91 
	}
}

96 
	$sûk_NSQ_wøµî_FLP
(

97 
sûk_ícodî_°©e_FLP
 *
psEnc
,

98 
sûk_ícodî_c⁄åﬁ_FLP
 *
psEncCål
,

99 
SideInfoIndi˚s
 *
psIndi˚s
,

100 
sûk_nsq_°©e
 *
psNSQ
,

101 
›us_öt8
 
pul£s
[],

102 c⁄° 
sûk_Êﬂt
 
x
[]

105 
›us_öt
 
i
, 
j
;

106 
›us_öt16
 
x16
[ 
MAX_FRAME_LENGTH
 ];

107 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ];

108 
sûk_DWORD_ALIGN
 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ];

109 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ];

110 
›us_öt
 
LTP_sˇÀ_Q14
;

113 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ];

114 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ];

115 
›us_öt
 
Lambda_Q10
;

116 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ];

117 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ];

121  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

122  
j
 = 0; j < 
psEnc
->
sCmn
.
sh≠ögLPCOrdî
; j++ ) {

123 
AR_Q13
[ 
i
 * 
MAX_SHAPE_LPC_ORDER
 + 
j
 ] = 
	`sûk_Êﬂt2öt
–
psEncCål
->
AR
[ i * MAX_SHAPE_LPC_ORDER + j ] * 8192.0f );

127  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

128 
LF_shp_Q14
[ 
i
 ] = 
	`sûk_LSHIFT32
–
	`sûk_Êﬂt2öt
–
psEncCål
->
LF_AR_shp
[ i ] * 16384.0f ), 16 ) |

129 (
›us_uöt16
)
	`sûk_Êﬂt2öt
–
psEncCål
->
LF_MA_shp
[ 
i
 ] * 16384.0f );

130 
Tût_Q14
[ 
i
 ] = (
›us_öt
)
	`sûk_Êﬂt2öt
–
psEncCål
->
Tût
[ i ] * 16384.0f );

131 
H¨mSh≠eGaö_Q14
[ 
i
 ] = (
›us_öt
)
	`sûk_Êﬂt2öt
–
psEncCål
->
H¨mSh≠eGaö
[ i ] * 16384.0f );

133 
Lambda_Q10
 = ( 
›us_öt
 )
	`sûk_Êﬂt2öt
–
psEncCål
->
Lambda
 * 1024.0f );

136  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
 * 
LTP_ORDER
; i++ ) {

137 
LTPC€f_Q14
[ 
i
 ] = (
›us_öt16
)
	`sûk_Êﬂt2öt
–
psEncCål
->
LTPC€f
[ i ] * 16384.0f );

140  
j
 = 0; j < 2; j++ ) {

141  
i
 = 0; i < 
psEnc
->
sCmn
.
¥edi˘LPCOrdî
; i++ ) {

142 
PªdC€f_Q12
[ 
j
 ][ 
i
 ] = (
›us_öt16
)
	`sûk_Êﬂt2öt
–
psEncCål
->
PªdC€f
[ j ][ i ] * 4096.0f );

146  
i
 = 0; i < 
psEnc
->
sCmn
.
nb_sub‰
; i++ ) {

147 
Gaös_Q16
[ 
i
 ] = 
	`sûk_Êﬂt2öt
–
psEncCål
->
Gaös
[ i ] * 65536.0f );

148 
	`sûk_as£π
–
Gaös_Q16
[ 
i
 ] > 0 );

151 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

152 
LTP_sˇÀ_Q14
 = 
sûk_LTPSˇÀs_èbÀ_Q14
[ 
psIndi˚s
->
LTP_sˇÀIndex
 ];

154 
LTP_sˇÀ_Q14
 = 0;

158  
i
 = 0; i < 
psEnc
->
sCmn
.
‰ame_Àngth
; i++ ) {

159 
x16
[ 
i
 ] = 
	`sûk_Êﬂt2öt
–
x
[ i ] );

163 if–
psEnc
->
sCmn
.
nSèãsDñayedDecisi⁄
 > 1 ||ÖsEnc->sCmn.
w¨pög_Q16
 > 0 ) {

164 
	`sûk_NSQ_dñ_dec
–&
psEnc
->
sCmn
, 
psNSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
[ 0 ], 
LTPC€f_Q14
,

165 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
psEncCål
->
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
psEnc
->
sCmn
.
¨ch
 );

167 
	`sûk_NSQ
–&
psEnc
->
sCmn
, 
psNSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
[ 0 ], 
LTPC€f_Q14
,

168 
AR_Q13
, 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
psEncCål
->
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
psEnc
->
sCmn
.
¨ch
 );

170 
	}
}

175 
	$sûk_qu™t_LTP_gaös_FLP
(

176 
sûk_Êﬂt
 
B
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

177 
›us_öt8
 
cbk_ödex
[ 
MAX_NB_SUBFR
 ],

178 
›us_öt8
 *
≥riodicôy_ödex
,

179 
›us_öt32
 *
sum_log_gaö_Q7
,

180 
sûk_Êﬂt
 *
¥ed_gaö_dB
,

181 c⁄° 
sûk_Êﬂt
 
XX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ],

182 c⁄° 
sûk_Êﬂt
 
xX
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

183 c⁄° 
›us_öt
 
sub‰_Àn
,

184 c⁄° 
›us_öt
 
nb_sub‰
,

185 
¨ch


188 
›us_öt
 
i
, 
¥ed_gaö_dB_Q7
;

189 
›us_öt16
 
B_Q14
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ];

190 
›us_öt32
 
XX_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 * LTP_ORDER ];

191 
›us_öt32
 
xX_Q17
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ];

193  
i
 = 0; i < 
nb_sub‰
 * 
LTP_ORDER
 * LTP_ORDER; i++ ) {

194 
XX_Q17
[ 
i
 ] = (
›us_öt32
)
	`sûk_Êﬂt2öt
–
XX
[ i ] * 131072.0f );

196  
i
 = 0; i < 
nb_sub‰
 * 
LTP_ORDER
; i++ ) {

197 
xX_Q17
[ 
i
 ] = (
›us_öt32
)
	`sûk_Êﬂt2öt
–
xX
[ i ] * 131072.0f );

200 
	`sûk_qu™t_LTP_gaös
–
B_Q14
, 
cbk_ödex
, 
≥riodicôy_ödex
, 
sum_log_gaö_Q7
, &
¥ed_gaö_dB_Q7
, 
XX_Q17
, 
xX_Q17
, 
sub‰_Àn
, 
nb_sub‰
, 
¨ch
 );

202  
i
 = 0; i < 
nb_sub‰
 * 
LTP_ORDER
; i++ ) {

203 
B
[ 
i
 ] = (
sûk_Êﬂt
)
B_Q14
[ i ] * ( 1.0f / 16384.0f );

206 *
¥ed_gaö_dB
 = (
sûk_Êﬂt
)
¥ed_gaö_dB_Q7
 * ( 1.0f / 128.0f );

207 
	}
}

	@silk/gain_quant.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

34 
	#OFFSET
 ( ( 
MIN_QGAIN_DB
 * 128 ) / 6 + 16 * 128 )

	)

35 
	#SCALE_Q16
 ( ( 65536 * ( 
N_LEVELS_QGAIN
 - 1 ) ) / ( ( ( 
MAX_QGAIN_DB
 - 
MIN_QGAIN_DB
 ) * 128 ) / 6 ) )

	)

36 
	#INV_SCALE_Q16
 ( ( 65536 * ( ( ( 
MAX_QGAIN_DB
 - 
MIN_QGAIN_DB
 ) * 128 ) / 6 ) ) / ( 
N_LEVELS_QGAIN
 - 1 ) )

	)

39 
	$sûk_gaös_qu™t
(

40 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

41 
›us_öt32
 
gaö_Q16
[ 
MAX_NB_SUBFR
 ],

42 
›us_öt8
 *
¥ev_öd
,

43 c⁄° 
›us_öt
 
c⁄dôi⁄Æ
,

44 c⁄° 
›us_öt
 
nb_sub‰


47 
›us_öt
 
k
, 
doubÀ_°ï_size_thªshﬁd
;

49  
k
 = 0; k < 
nb_sub‰
; k++ ) {

51 
öd
[ 
k
 ] = 
	`sûk_SMULWB
–
SCALE_Q16
, 
	`sûk_lö2log
–
gaö_Q16
[ k ] ) - 
OFFSET
 );

54 if–
öd
[ 
k
 ] < *
¥ev_öd
 ) {

55 
öd
[ 
k
 ]++;

57 
öd
[ 
k
 ] = 
	`sûk_LIMIT_öt
–öd[ k ], 0, 
N_LEVELS_QGAIN
 - 1 );

60 if–
k
 =0 && 
c⁄dôi⁄Æ
 == 0 ) {

62 
öd
[ 
k
 ] = 
	`sûk_LIMIT_öt
–öd[ k ], *
¥ev_öd
 + 
MIN_DELTA_GAIN_QUANT
, 
N_LEVELS_QGAIN
 - 1 );

63 *
¥ev_öd
 = 
öd
[ 
k
 ];

66 
öd
[ 
k
 ] = ind[ k ] - *
¥ev_öd
;

69 
doubÀ_°ï_size_thªshﬁd
 = 2 * 
MAX_DELTA_GAIN_QUANT
 - 
N_LEVELS_QGAIN
 + *
¥ev_öd
;

70 if–
öd
[ 
k
 ] > 
doubÀ_°ï_size_thªshﬁd
 ) {

71 
öd
[ 
k
 ] = 
doubÀ_°ï_size_thªshﬁd
 + 
	`sûk_RSHIFT
( ind[ k ] - double_step_size_threshold + 1, 1 );

74 
öd
[ 
k
 ] = 
	`sûk_LIMIT_öt
–öd[ k ], 
MIN_DELTA_GAIN_QUANT
, 
MAX_DELTA_GAIN_QUANT
 );

77 if–
öd
[ 
k
 ] > 
doubÀ_°ï_size_thªshﬁd
 ) {

78 *
¥ev_öd
 +
	`sûk_LSHIFT
–
öd
[ 
k
 ], 1 ) - 
doubÀ_°ï_size_thªshﬁd
;

79 *
¥ev_öd
 = 
	`sûk_mö_öt
–*¥ev_öd, 
N_LEVELS_QGAIN
 - 1 );

81 *
¥ev_öd
 +
öd
[ 
k
 ];

85 
öd
[ 
k
 ] -
MIN_DELTA_GAIN_QUANT
;

89 
gaö_Q16
[ 
k
 ] = 
	`sûk_log2lö
–
	`sûk_mö_32
–
	`sûk_SMULWB
–
INV_SCALE_Q16
, *
¥ev_öd
 ) + 
OFFSET
, 3967 ) );

91 
	}
}

94 
	$sûk_gaös_dequ™t
(

95 
›us_öt32
 
gaö_Q16
[ 
MAX_NB_SUBFR
 ],

96 c⁄° 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

97 
›us_öt8
 *
¥ev_öd
,

98 c⁄° 
›us_öt
 
c⁄dôi⁄Æ
,

99 c⁄° 
›us_öt
 
nb_sub‰


102 
›us_öt
 
k
, 
öd_tmp
, 
doubÀ_°ï_size_thªshﬁd
;

104  
k
 = 0; k < 
nb_sub‰
; k++ ) {

105 if–
k
 =0 && 
c⁄dôi⁄Æ
 == 0 ) {

107 *
¥ev_öd
 = 
	`sûk_max_öt
–
öd
[ 
k
 ], *prev_ind - 16 );

110 
öd_tmp
 = 
öd
[ 
k
 ] + 
MIN_DELTA_GAIN_QUANT
;

113 
doubÀ_°ï_size_thªshﬁd
 = 2 * 
MAX_DELTA_GAIN_QUANT
 - 
N_LEVELS_QGAIN
 + *
¥ev_öd
;

114 if–
öd_tmp
 > 
doubÀ_°ï_size_thªshﬁd
 ) {

115 *
¥ev_öd
 +
	`sûk_LSHIFT
–
öd_tmp
, 1 ) - 
doubÀ_°ï_size_thªshﬁd
;

117 *
¥ev_öd
 +
öd_tmp
;

120 *
¥ev_öd
 = 
	`sûk_LIMIT_öt
–*¥ev_öd, 0, 
N_LEVELS_QGAIN
 - 1 );

123 
gaö_Q16
[ 
k
 ] = 
	`sûk_log2lö
–
	`sûk_mö_32
–
	`sûk_SMULWB
–
INV_SCALE_Q16
, *
¥ev_öd
 ) + 
OFFSET
, 3967 ) );

125 
	}
}

128 
›us_öt32
 
	$sûk_gaös_ID
(

129 c⁄° 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

130 c⁄° 
›us_öt
 
nb_sub‰


133 
›us_öt
 
k
;

134 
›us_öt32
 
gaösID
;

136 
gaösID
 = 0;

137  
k
 = 0; k < 
nb_sub‰
; k++ ) {

138 
gaösID
 = 
	`sûk_ADD_LSHIFT32
–
öd
[ 
k
 ], gainsID, 8 );

141  
gaösID
;

142 
	}
}

	@silk/init_decoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

37 
›us_öt
 
	$sûk_öô_decodî
(

38 
sûk_decodî_°©e
 *
psDec


42 
	`sûk_mem£t
–
psDec
, 0, –
sûk_decodî_°©e
 ) );

45 
psDec
->
fú°_‰ame_a·î_ª£t
 = 1;

46 
psDec
->
¥ev_gaö_Q16
 = 65536;

47 
psDec
->
¨ch
 = 
	`›us_£À˘_¨ch
();

50 
	`sûk_CNG_Re£t
–
psDec
 );

53 
	`sûk_PLC_Re£t
–
psDec
 );

56 
	}
}

	@silk/init_encoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

31 #ifde‡
FIXED_POINT


32 
	~"maö_FIX.h
"

34 
	~"maö_FLP.h
"

36 
	~"tunög_∑ømëîs.h
"

37 
	~"˝u_suµ‹t.h
"

42 
›us_öt
 
	$sûk_öô_ícodî
(

43 
sûk_ícodî_°©e_Fxx
 *
psEnc
,

44 
¨ch


47 
›us_öt
 
ªt
 = 0;

50 
	`sûk_mem£t
–
psEnc
, 0, –
sûk_ícodî_°©e_Fxx
 ) );

52 
psEnc
->
sCmn
.
¨ch
 =árch;

54 
psEnc
->
sCmn
.
v¨übÀ_HP_smth1_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
	`SILK_FIX_CONST
–
VARIABLE_HP_MIN_CUTOFF_HZ
, 16 ) ) - ( 16 << 7 ), 8 );

55 
psEnc
->
sCmn
.
v¨übÀ_HP_smth2_Q15
 =ÖsEnc->sCmn.
v¨übÀ_HP_smth1_Q15
;

58 
psEnc
->
sCmn
.
fú°_‰ame_a·î_ª£t
 = 1;

61 
ªt
 +
	`sûk_VAD_Inô
–&
psEnc
->
sCmn
.
sVAD
 );

63  
ªt
;

64 
	}
}

	@silk/inner_prod_aligned.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

34 
›us_öt32
 
	$sûk_ö√r_¥od_Æig√d_sˇÀ
(

35 c⁄° 
›us_öt16
 *c⁄° 
öVec1
,

36 c⁄° 
›us_öt16
 *c⁄° 
öVec2
,

37 c⁄° 
›us_öt
 
sˇÀ
,

38 c⁄° 
›us_öt
 
Àn


41 
›us_öt
 
i
;

42 
›us_öt32
 
sum
 = 0;

43  
i
 = 0; i < 
Àn
; i++ ) {

44 
sum
 = 
	`sûk_ADD_RSHIFT32
–sum, 
	`sûk_SMULBB
–
öVec1
[ 
i
 ], 
öVec2
[ i ] ), 
sˇÀ
 );

46  
sum
;

47 
	}
}

	@silk/interpolate.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_öãΩﬁ©e
(

36 
›us_öt16
 
xi
[ 
MAX_LPC_ORDER
 ],

37 c⁄° 
›us_öt16
 
x0
[ 
MAX_LPC_ORDER
 ],

38 c⁄° 
›us_öt16
 
x1
[ 
MAX_LPC_ORDER
 ],

39 c⁄° 
›us_öt
 
iÁ˘_Q2
,

40 c⁄° 
›us_öt
 
d


43 
›us_öt
 
i
;

45 
	`˚…_as£π
–
iÁ˘_Q2
 >= 0 );

46 
	`˚…_as£π
–
iÁ˘_Q2
 <= 4 );

48  
i
 = 0; i < 
d
; i++ ) {

49 
xi
[ 
i
 ] = (
›us_öt16
)
	`sûk_ADD_RSHIFT
–
x0
[ i ], 
	`sûk_SMULBB
–
x1
[ i ] - x0[ i ], 
iÁ˘_Q2
 ), 2 );

51 
	}
}

	@silk/lin2log.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

35 
›us_öt32
 
	$sûk_lö2log
(

36 c⁄° 
›us_öt32
 
öLö


39 
›us_öt32
 
lz
, 
‰ac_Q7
;

41 
	`sûk_CLZ_FRAC
–
öLö
, &
lz
, &
‰ac_Q7
 );

44  
	`sûk_ADD_LSHIFT32
–
	`sûk_SMLAWB
–
‰ac_Q7
, 
	`sûk_MUL
–‰ac_Q7, 128 - føc_Q7 ), 179 ), 31 - 
lz
, 7 );

45 
	}
}

	@silk/log2lin.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

36 
›us_öt32
 
	$sûk_log2lö
(

37 c⁄° 
›us_öt32
 
öLog_Q7


40 
›us_öt32
 
out
, 
‰ac_Q7
;

42 if–
öLog_Q7
 < 0 ) {

44 } i‡–
öLog_Q7
 >= 3967 ) {

45  
sûk_öt32_MAX
;

48 
out
 = 
	`sûk_LSHIFT
–1, 
	`sûk_RSHIFT
–
öLog_Q7
, 7 ) );

49 
‰ac_Q7
 = 
öLog_Q7
 & 0x7F;

50 if–
öLog_Q7
 < 2048 ) {

52 
out
 = 
	`sûk_ADD_RSHIFT32
–out, 
	`sûk_MUL
–out, 
	`sûk_SMLAWB
–
‰ac_Q7
, 
	`sûk_SMULBB
( frac_Q7, 128 - frac_Q7 ), -174 ) ), 7 );

55 
out
 = 
	`sûk_MLA
–out, 
	`sûk_RSHIFT
–out, 7 ), 
	`sûk_SMLAWB
–
‰ac_Q7
, 
	`sûk_SMULBB
( frac_Q7, 128 - frac_Q7 ), -174 ) );

57  
out
;

58 
	}
}

	@silk/macros.h

28 #i‚de‡
SILK_MACROS_H


29 
	#SILK_MACROS_H


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 
	~"›us_ty≥s.h
"

36 
	~"›us_deföes.h
"

37 
	~"¨ch.h
"

42 #i‡
OPUS_FAST_INT64


43 
	#sûk_SMULWB
(
a32
, 
b32
Ë((
›us_öt32
)((◊32Ë* (
›us_öt64
)((
›us_öt16
)(b32))Ë>> 16))

	)

45 
	#sûk_SMULWB
(
a32
, 
b32
Ë(((◊32Ë>> 16Ë* (
›us_öt32
)((
›us_öt16
)(b32))Ë+ (((◊32Ë& 0x0000FFFFË* (›us_öt32)((›us_öt16)(b32))Ë>> 16))

	)

49 #i‡
OPUS_FAST_INT64


50 
	#sûk_SMLAWB
(
a32
, 
b32
, 
c32
Ë((
›us_öt32
)(◊32Ë+ (((b32Ë* (
›us_öt64
)((
›us_öt16
)(c32))Ë>> 16)))

	)

52 
	#sûk_SMLAWB
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ ((((b32Ë>> 16Ë* (
›us_öt32
)((
›us_öt16
)(c32))Ë+ ((((b32Ë& 0x0000FFFFË* (›us_öt32)((›us_öt16)(c32))Ë>> 16)))

	)

56 #i‡
OPUS_FAST_INT64


57 
	#sûk_SMULWT
(
a32
, 
b32
Ë((
›us_öt32
)((◊32Ë* (
›us_öt64
)((b32Ë>> 16)Ë>> 16))

	)

59 
	#sûk_SMULWT
(
a32
, 
b32
Ë((◊32Ë>> 16Ë* ((b32Ë>> 16Ë+ (((◊32Ë& 0x0000FFFFË* ((b32Ë>> 16)Ë>> 16))

	)

63 #i‡
OPUS_FAST_INT64


64 
	#sûk_SMLAWT
(
a32
, 
b32
, 
c32
Ë((
›us_öt32
)(◊32Ë+ (((b32Ë* ((
›us_öt64
)(c32Ë>> 16)Ë>> 16)))

	)

66 
	#sûk_SMLAWT
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ (((b32Ë>> 16Ë* ((c32Ë>> 16)Ë+ ((((b32Ë& 0x0000FFFFË* ((c32Ë>> 16)Ë>> 16))

	)

70 
	#sûk_SMULBB
(
a32
, 
b32
Ë((
›us_öt32
)((
›us_öt16
)◊32)Ë* (›us_öt32)((›us_öt16)(b32)))

	)

73 
	#sûk_SMLABB
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ ((
›us_öt32
)((
›us_öt16
)(b32))Ë* (›us_öt32)((›us_öt16)(c32)))

	)

76 
	#sûk_SMULBT
(
a32
, 
b32
Ë((
›us_öt32
)((
›us_öt16
)◊32)Ë* ((b32Ë>> 16))

	)

79 
	#sûk_SMLABT
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ ((
›us_öt32
)((
›us_öt16
)(b32))Ë* ((c32Ë>> 16))

	)

82 
	#sûk_SMLAL
(
a64
, 
b32
, 
c32
Ë(
	`sûk_ADD64
(◊64), ((
›us_öt64
)(b32Ë* (›us_öt64)(c32))))

	)

85 #i‡
OPUS_FAST_INT64


86 
	#sûk_SMULWW
(
a32
, 
b32
Ë((
›us_öt32
)(((
›us_öt64
)◊32Ë* (b32)Ë>> 16))

	)

88 
	#sûk_SMULWW
(
a32
, 
b32
Ë
	`sûk_MLA
(
	`sûk_SMULWB
(◊32), (b32)), (a32), 
	`sûk_RSHIFT_ROUND
((b32), 16))

	)

92 #i‡
OPUS_FAST_INT64


93 
	#sûk_SMLAWW
(
a32
, 
b32
, 
c32
Ë((
›us_öt32
)(◊32Ë+ (((
›us_öt64
)(b32Ë* (c32)Ë>> 16)))

	)

95 
	#sûk_SMLAWW
(
a32
, 
b32
, 
c32
Ë
	`sûk_MLA
(
	`sûk_SMLAWB
(◊32), (b32), (c32)), (b32), 
	`sûk_RSHIFT_ROUND
((c32), 16))

	)

99 
	#sûk_ADD_SAT32
(
a
, 
b
Ë((((
›us_uöt32
)(a) + (opus_uint32)(b)) & 0x80000000) == 0 ? \

100 ((((
a
Ë& (
b
)Ë& 0x80000000Ë!0 ? 
sûk_öt32_MIN
 : (a)+(b)) : \

101 ((((
a
Ë| (
b
)Ë& 0x80000000Ë=0 ? 
sûk_öt32_MAX
 : (a)+(b)Ë)

	)

103 
	#sûk_SUB_SAT32
(
a
, 
b
Ë((((
›us_uöt32
)(a)-(opus_uint32)(b)) & 0x80000000) == 0 ? \

104 (–(
a
Ë& ((
b
)^0x80000000Ë& 0x80000000Ë? 
sûk_öt32_MIN
 : (a)-(b)) : \

105 ((((
a
)^0x80000000Ë& (
b
Ë& 0x80000000Ë? 
sûk_öt32_MAX
 : (a)-(b)Ë)

	)

107 #i‡
deföed
(
MIPSr1_ASM
)

108 
	~"mùs/ma¸os_mù§1.h
"

111 
	~"ecöåö.h
"

112 #i‚de‡
OVERRIDE_sûk_CLZ16


113 
OPUS_INLINE
 
›us_öt32
 
	$sûk_CLZ16
(
›us_öt16
 
ö16
)

115  32 - 
	`EC_ILOG
(
ö16
<<16|0x8000);

116 
	}
}

119 #i‚de‡
OVERRIDE_sûk_CLZ32


120 
OPUS_INLINE
 
›us_öt32
 
	$sûk_CLZ32
(
›us_öt32
 
ö32
)

122  
ö32
 ? 32 - 
	`EC_ILOG
(in32) : 32;

123 
	}
}

127 
	#m©rix_±r
(
M©rix_ba£_adr
, 
row
, 
cﬁumn
, 
N
) \

128 (*((
M©rix_ba£_adr
Ë+ ((
row
)*(
N
)+(
cﬁumn
))))

	)

129 
	#m©rix_adr
(
M©rix_ba£_adr
, 
row
, 
cﬁumn
, 
N
) \

130 ((
M©rix_ba£_adr
Ë+ ((
row
)*(
N
)+(
cﬁumn
)))

	)

133 #i‚de‡
m©rix_c_±r


134 
	#m©rix_c_±r
(
M©rix_ba£_adr
, 
row
, 
cﬁumn
, 
M
) \

135 (*((
M©rix_ba£_adr
Ë+ ((
row
)+(
M
)*(
cﬁumn
))))

	)

138 #ifde‡
OPUS_ARM_INLINE_ASM


139 
	~"¨m/ma¸os_¨mv4.h
"

142 #ifde‡
OPUS_ARM_INLINE_EDSP


143 
	~"¨m/ma¸os_¨mv5e.h
"

146 #ifde‡
OPUS_ARM_PRESUME_AARCH64_NEON_INTR


147 
	~"¨m/ma¸os_¨m64.h
"

	@silk/main.h

28 #i‚de‡
SILK_MAIN_H


29 
	#SILK_MAIN_H


	)

31 
	~"SigProc_FIX.h
"

32 
	~"deföe.h
"

33 
	~"°ru˘s.h
"

34 
	~"èbÀs.h
"

35 
	~"PLC.h
"

36 
	~"c⁄åﬁ.h
"

37 
	~"debug.h
"

38 
	~"íãnc.h
"

39 
	~"ítdec.h
"

41 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

42 
	~"x86/maö_s£.h
"

45 #i‡(
deföed
(
OPUS_ARM_ASM
Ë|| deföed(
OPUS_ARM_MAY_HAVE_NEON_INTR
))

46 
	~"¨m/NSQ_dñ_dec_¨m.h
"

50 
sûk_°îeo_LR_to_MS
(

51 
°îeo_íc_°©e
 *
°©e
,

52 
›us_öt16
 
x1
[],

53 
›us_öt16
 
x2
[],

54 
›us_öt8
 
ix
[ 2 ][ 3 ],

55 
›us_öt8
 *
mid_⁄ly_Êag
,

56 
›us_öt32
 
mid_side_øãs_bps
[],

57 
›us_öt32
 
tŸÆ_øã_bps
,

58 
›us_öt
 
¥ev_•ìch_a˘_Q8
,

59 
›us_öt
 
toM⁄o
,

60 
›us_öt
 
fs_kHz
,

61 
›us_öt
 
‰ame_Àngth


65 
sûk_°îeo_MS_to_LR
(

66 
°îeo_dec_°©e
 *
°©e
,

67 
›us_öt16
 
x1
[],

68 
›us_öt16
 
x2
[],

69 c⁄° 
›us_öt32
 
¥ed_Q13
[],

70 
›us_öt
 
fs_kHz
,

71 
›us_öt
 
‰ame_Àngth


75 
›us_öt32
 
sûk_°îeo_föd_¥edi˘‹
(

76 
›us_öt32
 *
øtio_Q14
,

77 c⁄° 
›us_öt16
 
x
[],

78 c⁄° 
›us_öt16
 
y
[],

79 
›us_öt32
 
mid_ªs_amp_Q0
[],

80 
›us_öt
 
Àngth
,

81 
›us_öt
 
smoŸh_c€f_Q16


85 
sûk_°îeo_qu™t_¥ed
(

86 
›us_öt32
 
¥ed_Q13
[],

87 
›us_öt8
 
ix
[ 2 ][ 3 ]

91 
sûk_°îeo_ícode_¥ed
(

92 
ec_íc
 *
psR™geEnc
,

93 
›us_öt8
 
ix
[ 2 ][ 3 ]

97 
sûk_°îeo_ícode_mid_⁄ly
(

98 
ec_íc
 *
psR™geEnc
,

99 
›us_öt8
 
mid_⁄ly_Êag


103 
sûk_°îeo_decode_¥ed
(

104 
ec_dec
 *
psR™geDec
,

105 
›us_öt32
 
¥ed_Q13
[]

109 
sûk_°îeo_decode_mid_⁄ly
(

110 
ec_dec
 *
psR™geDec
,

111 
›us_öt
 *
decode_⁄ly_mid


115 
sûk_ícode_signs
(

116 
ec_íc
 *
psR™geEnc
,

117 c⁄° 
›us_öt8
 
pul£s
[],

118 
›us_öt
 
Àngth
,

119 c⁄° 
›us_öt
 
sig«lTy≥
,

120 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

121 c⁄° 
›us_öt
 
sum_pul£s
[ 
MAX_NB_SHELL_BLOCKS
 ]

125 
sûk_decode_signs
(

126 
ec_dec
 *
psR™geDec
,

127 
›us_öt16
 
pul£s
[],

128 
›us_öt
 
Àngth
,

129 c⁄° 
›us_öt
 
sig«lTy≥
,

130 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

131 c⁄° 
›us_öt
 
sum_pul£s
[ 
MAX_NB_SHELL_BLOCKS
 ]

135 
›us_öt
 
check_c⁄åﬁ_öput
(

136 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


140 
›us_öt
 
sûk_c⁄åﬁ_audio_b™dwidth
(

141 
sûk_ícodî_°©e
 *
psEncC
,

142 
sûk_EncC⁄åﬁSåu˘
 *
ícC⁄åﬁ


146 
›us_öt
 
sûk_c⁄åﬁ_SNR
(

147 
sûk_ícodî_°©e
 *
psEncC
,

148 
›us_öt32
 
T¨gëR©e_bps


156 
sûk_ícode_pul£s
(

157 
ec_íc
 *
psR™geEnc
,

158 c⁄° 
›us_öt
 
sig«lTy≥
,

159 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

160 
›us_öt8
 
pul£s
[],

161 c⁄° 
›us_öt
 
‰ame_Àngth


165 
sûk_shñl_ícodî
(

166 
ec_íc
 *
psR™geEnc
,

167 c⁄° 
›us_öt
 *
pul£s0


171 
sûk_shñl_decodî
(

172 
›us_öt16
 *
pul£s0
,

173 
ec_dec
 *
psR™geDec
,

174 c⁄° 
›us_öt
 
pul£s4


178 
sûk_gaös_qu™t
(

179 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

180 
›us_öt32
 
gaö_Q16
[ 
MAX_NB_SUBFR
 ],

181 
›us_öt8
 *
¥ev_öd
,

182 c⁄° 
›us_öt
 
c⁄dôi⁄Æ
,

183 c⁄° 
›us_öt
 
nb_sub‰


187 
sûk_gaös_dequ™t
(

188 
›us_öt32
 
gaö_Q16
[ 
MAX_NB_SUBFR
 ],

189 c⁄° 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

190 
›us_öt8
 *
¥ev_öd
,

191 c⁄° 
›us_öt
 
c⁄dôi⁄Æ
,

192 c⁄° 
›us_öt
 
nb_sub‰


196 
›us_öt32
 
sûk_gaös_ID
(

197 c⁄° 
›us_öt8
 
öd
[ 
MAX_NB_SUBFR
 ],

198 c⁄° 
›us_öt
 
nb_sub‰


202 
sûk_öãΩﬁ©e
(

203 
›us_öt16
 
xi
[ 
MAX_LPC_ORDER
 ],

204 c⁄° 
›us_öt16
 
x0
[ 
MAX_LPC_ORDER
 ],

205 c⁄° 
›us_öt16
 
x1
[ 
MAX_LPC_ORDER
 ],

206 c⁄° 
›us_öt
 
iÁ˘_Q2
,

207 c⁄° 
›us_öt
 
d


211 
sûk_qu™t_LTP_gaös
(

212 
›us_öt16
 
B_Q14
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

213 
›us_öt8
 
cbk_ödex
[ 
MAX_NB_SUBFR
 ],

214 
›us_öt8
 *
≥riodicôy_ödex
,

215 
›us_öt32
 *
sum_gaö_dB_Q7
,

216 
›us_öt
 *
¥ed_gaö_dB_Q7
,

217 c⁄° 
›us_öt32
 
XX_Q17
[ 
MAX_NB_SUBFR
*
LTP_ORDER
*LTP_ORDER ],

218 c⁄° 
›us_öt32
 
xX_Q17
[ 
MAX_NB_SUBFR
*
LTP_ORDER
 ],

219 c⁄° 
›us_öt
 
sub‰_Àn
,

220 c⁄° 
›us_öt
 
nb_sub‰
,

221 
¨ch


225 
sûk_VQ_WM©_EC_c
(

226 
›us_öt8
 *
öd
,

227 
›us_öt32
 *
ªs_ƒg_Q15
,

228 
›us_öt32
 *
øã_di°_Q8
,

229 
›us_öt
 *
gaö_Q7
,

230 c⁄° 
›us_öt32
 *
XX_Q17
,

231 c⁄° 
›us_öt32
 *
xX_Q17
,

232 c⁄° 
›us_öt8
 *
cb_Q7
,

233 c⁄° 
›us_uöt8
 *
cb_gaö_Q7
,

234 c⁄° 
›us_uöt8
 *
˛_Q5
,

235 c⁄° 
›us_öt
 
sub‰_Àn
,

236 c⁄° 
›us_öt32
 
max_gaö_Q7
,

237 c⁄° 
›us_öt
 
L


240 #i‡!
deföed
(
OVERRIDE_sûk_VQ_WM©_EC
)

241 
	#sûk_VQ_WM©_EC
(
öd
, 
ªs_ƒg_Q15
, 
øã_di°_Q8
, 
gaö_Q7
, 
XX_Q17
, 
xX_Q17
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, 
sub‰_Àn
, 
max_gaö_Q7
, 
L
, 
¨ch
) \

242 (()(
¨ch
),
	`sûk_VQ_WM©_EC_c
(
öd
, 
ªs_ƒg_Q15
, 
øã_di°_Q8
, 
gaö_Q7
, 
XX_Q17
, 
xX_Q17
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, 
sub‰_Àn
, 
max_gaö_Q7
, 
L
))

	)

249 
sûk_NSQ_c
(

250 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

251 
sûk_nsq_°©e
 *
NSQ
,

252 
SideInfoIndi˚s
 *
psIndi˚s
,

253 c⁄° 
›us_öt16
 
x16
[],

254 
›us_öt8
 
pul£s
[],

255 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

256 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

257 c⁄° 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

258 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

259 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

260 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

261 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

262 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

263 c⁄° 
›us_öt
 
Lambda_Q10
,

264 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


267 #i‡!
deföed
(
OVERRIDE_sûk_NSQ
)

268 
	#sûk_NSQ
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, \

269 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

270 (()(
¨ch
),
	`sûk_NSQ_c
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, \

271 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

275 
sûk_NSQ_dñ_dec_c
(

276 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

277 
sûk_nsq_°©e
 *
NSQ
,

278 
SideInfoIndi˚s
 *
psIndi˚s
,

279 c⁄° 
›us_öt16
 
x16
[],

280 
›us_öt8
 
pul£s
[],

281 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

282 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

283 c⁄° 
›us_öt16
 
AR_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

284 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

285 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

286 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

287 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

288 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

289 c⁄° 
›us_öt
 
Lambda_Q10
,

290 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


293 #i‡!
deföed
(
OVERRIDE_sûk_NSQ_dñ_dec
)

294 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, \

295 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

296 (()(
¨ch
),
	`sûk_NSQ_dñ_dec_c
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x16
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR_Q13
, \

297 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

304 
›us_öt
 
sûk_VAD_Inô
(

305 
sûk_VAD_°©e
 *
psSûk_VAD


309 
›us_öt
 
sûk_VAD_GëSA_Q8_c
(

310 
sûk_ícodî_°©e
 *
psEncC
,

311 c⁄° 
›us_öt16
 
pIn
[]

314 #i‡!
deföed
(
OVERRIDE_sûk_VAD_GëSA_Q8
)

315 
	#sûk_VAD_GëSA_Q8
(
psEnC
, 
pIn
, 
¨ch
Ë(()◊rch),
	`sûk_VAD_GëSA_Q8_c
’sEnC,ÖIn))

	)

321 
sûk_LP_v¨übÀ_cutoff
(

322 
sûk_LP_°©e
 *
psLP
,

323 
›us_öt16
 *
‰ame
,

324 c⁄° 
›us_öt
 
‰ame_Àngth


331 
sûk_¥o˚ss_NLSFs
(

332 
sûk_ícodî_°©e
 *
psEncC
,

333 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ],

334 
›us_öt16
 
pNLSF_Q15
[ 
MAX_LPC_ORDER
 ],

335 c⁄° 
›us_öt16
 
¥ev_NLSFq_Q15
[ 
MAX_LPC_ORDER
 ]

338 
›us_öt32
 
sûk_NLSF_ícode
(

339 
›us_öt8
 *
NLSFIndi˚s
,

340 
›us_öt16
 *
pNLSF_Q15
,

341 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
,

342 c⁄° 
›us_öt16
 *
pW_QW
,

343 c⁄° 
›us_öt
 
NLSF_mu_Q20
,

344 c⁄° 
›us_öt
 
nSurviv‹s
,

345 c⁄° 
›us_öt
 
sig«lTy≥


349 
sûk_NLSF_VQ
(

350 
›us_öt32
 
îr_Q26
[],

351 c⁄° 
›us_öt16
 
ö_Q15
[],

352 c⁄° 
›us_uöt8
 
pCB_Q8
[],

353 c⁄° 
›us_öt16
 
pWght_Q9
[],

354 c⁄° 
›us_öt
 
K
,

355 c⁄° 
›us_öt
 
LPC_‹dî


359 
›us_öt32
 
sûk_NLSF_dñ_dec_qu™t
(

360 
›us_öt8
 
ödi˚s
[],

361 c⁄° 
›us_öt16
 
x_Q10
[],

362 c⁄° 
›us_öt16
 
w_Q5
[],

363 c⁄° 
›us_uöt8
 
¥ed_c€f_Q8
[],

364 c⁄° 
›us_öt16
 
ec_ix
[],

365 c⁄° 
›us_uöt8
 
ec_øãs_Q5
[],

366 c⁄° 
›us_öt
 
qu™t_°ï_size_Q16
,

367 c⁄° 
›us_öt16
 
öv_qu™t_°ï_size_Q6
,

368 c⁄° 
›us_öt32
 
mu_Q20
,

369 c⁄° 
›us_öt16
 
‹dî


373 
sûk_NLSF_u≈ack
(

374 
›us_öt16
 
ec_ix
[],

375 
›us_uöt8
 
¥ed_Q8
[],

376 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
,

377 c⁄° 
›us_öt
 
CB1_ödex


383 
sûk_NLSF_decode
(

384 
›us_öt16
 *
pNLSF_Q15
,

385 
›us_öt8
 *
NLSFIndi˚s
,

386 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB


392 
›us_öt
 
sûk_öô_decodî
(

393 
sûk_decodî_°©e
 *
psDec


397 
›us_öt
 
sûk_decodî_£t_fs
(

398 
sûk_decodî_°©e
 *
psDec
,

399 
›us_öt
 
fs_kHz
,

400 
›us_öt32
 
fs_API_Hz


406 
›us_öt
 
sûk_decode_‰ame
(

407 
sûk_decodî_°©e
 *
psDec
,

408 
ec_dec
 *
psR™geDec
,

409 
›us_öt16
 
pOut
[],

410 
›us_öt32
 *
pN
,

411 
›us_öt
 
lo°Fœg
,

412 
›us_öt
 
c⁄dCodög
,

413 
¨ch


417 
sûk_decode_ödi˚s
(

418 
sûk_decodî_°©e
 *
psDec
,

419 
ec_dec
 *
psR™geDec
,

420 
›us_öt
 
FømeIndex
,

421 
›us_öt
 
decode_LBRR
,

422 
›us_öt
 
c⁄dCodög


426 
sûk_decode_∑ømëîs
(

427 
sûk_decodî_°©e
 *
psDec
,

428 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

429 
›us_öt
 
c⁄dCodög


433 
sûk_decode_c‹e
(

434 
sûk_decodî_°©e
 *
psDec
,

435 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

436 
›us_öt16
 
xq
[],

437 c⁄° 
›us_öt16
 
pul£s
[ 
MAX_FRAME_LENGTH
 ],

438 
¨ch


442 
sûk_decode_pul£s
(

443 
ec_dec
 *
psR™geDec
,

444 
›us_öt16
 
pul£s
[],

445 c⁄° 
›us_öt
 
sig«lTy≥
,

446 c⁄° 
›us_öt
 
qu™tOff£tTy≥
,

447 c⁄° 
›us_öt
 
‰ame_Àngth


455 
sûk_CNG_Re£t
(

456 
sûk_decodî_°©e
 *
psDec


460 
sûk_CNG
(

461 
sûk_decodî_°©e
 *
psDec
,

462 
sûk_decodî_c⁄åﬁ
 *
psDecCål
,

463 
›us_öt16
 
‰ame
[],

464 
›us_öt
 
Àngth


468 
sûk_ícode_ödi˚s
(

469 
sûk_ícodî_°©e
 *
psEncC
,

470 
ec_íc
 *
psR™geEnc
,

471 
›us_öt
 
FømeIndex
,

472 
›us_öt
 
ícode_LBRR
,

473 
›us_öt
 
c⁄dCodög


	@silk/mips/NSQ_del_dec_mipsr1.h

28 #i‚de‡
__NSQ_DEL_DEC_MIPSR1_H__


29 
	#__NSQ_DEL_DEC_MIPSR1_H__


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 
	~"maö.h
"

36 
	~"°ack_Æloc.h
"

38 
	#OVERRIDE_sûk_noi£_sh≠e_qu™tizî_dñ_dec


	)

39 
ölöe
 
	$sûk_noi£_sh≠e_qu™tizî_dñ_dec
(

40 
sûk_nsq_°©e
 *
NSQ
,

41 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

42 
›us_öt
 
sig«lTy≥
,

43 c⁄° 
›us_öt32
 
x_Q10
[],

44 
›us_öt8
 
pul£s
[],

45 
›us_öt16
 
xq
[],

46 
›us_öt32
 
sLTP_Q15
[],

47 
›us_öt32
 
dñayedGaö_Q10
[],

48 c⁄° 
›us_öt16
 
a_Q12
[],

49 c⁄° 
›us_öt16
 
b_Q14
[],

50 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

51 
›us_öt
 
œg
,

52 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

53 
›us_öt
 
Tût_Q14
,

54 
›us_öt32
 
LF_shp_Q14
,

55 
›us_öt32
 
Gaö_Q16
,

56 
›us_öt
 
Lambda_Q10
,

57 
›us_öt
 
off£t_Q10
,

58 
›us_öt
 
Àngth
,

59 
›us_öt
 
sub‰
,

60 
›us_öt
 
sh≠ögLPCOrdî
,

61 
›us_öt
 
¥edi˘LPCOrdî
,

62 
›us_öt
 
w¨pög_Q16
,

63 
›us_öt
 
nSèãsDñayedDecisi⁄
,

64 
›us_öt
 *
sm∂_buf_idx
,

65 
›us_öt
 
decisi⁄Dñay
,

66 
¨ch


69 
›us_öt
 
i
, 
j
, 
k
, 
Wö√r_öd
, 
RDmö_öd
, 
RDmax_öd
, 
œ°_sm∂e_idx
;

70 
›us_öt32
 
Wö√r_ønd_°©e
;

71 
›us_öt32
 
LTP_¥ed_Q14
, 
LPC_¥ed_Q14
, 
n_AR_Q14
, 
n_LTP_Q14
;

72 
›us_öt32
 
n_LF_Q14
, 
r_Q10
, 
º_Q10
, 
rd1_Q10
, 
rd2_Q10
, 
RDmö_Q10
, 
RDmax_Q10
;

73 
›us_öt32
 
q1_Q0
, 
q1_Q10
, 
q2_Q10
, 
exc_Q14
, 
LPC_exc_Q14
, 
xq_Q14
, 
Gaö_Q10
;

74 
›us_öt32
 
tmp1
, 
tmp2
, 
sLF_AR_shp_Q14
;

75 
›us_öt32
 *
¥ed_œg_±r
, *
shp_œg_±r
, *
psLPC_Q14
;

76 
NSQ_ßm∂e_°ru˘
 
psSam∂eSèã
[ 
MAX_DEL_DEC_STATES
 ][ 2 ];

77 
NSQ_dñ_dec_°ru˘
 *
psDD
;

78 
NSQ_ßm∂e_°ru˘
 *
psSS
;

79 
›us_öt16
 
b_Q14_0
, 
b_Q14_1
, 
b_Q14_2
, 
b_Q14_3
, 
b_Q14_4
;

80 
›us_öt16
 
a_Q12_0
, 
a_Q12_1
, 
a_Q12_2
, 
a_Q12_3
, 
a_Q12_4
, 
a_Q12_5
, 
a_Q12_6
;

81 
›us_öt16
 
a_Q12_7
, 
a_Q12_8
, 
a_Q12_9
, 
a_Q12_10
, 
a_Q12_11
, 
a_Q12_12
, 
a_Q12_13
;

82 
›us_öt16
 
a_Q12_14
, 
a_Q12_15
;

84 
›us_öt32
 
cur
, 
¥ev
, 
√xt
;

87 ()
¨ch
;

90 
b_Q14_0
 = 
b_Q14
[ 0 ];

91 
b_Q14_1
 = 
b_Q14
[ 1 ];

92 
b_Q14_2
 = 
b_Q14
[ 2 ];

93 
b_Q14_3
 = 
b_Q14
[ 3 ];

94 
b_Q14_4
 = 
b_Q14
[ 4 ];

97 
a_Q12_0
 = 
a_Q12
[0];

98 
a_Q12_1
 = 
a_Q12
[1];

99 
a_Q12_2
 = 
a_Q12
[2];

100 
a_Q12_3
 = 
a_Q12
[3];

101 
a_Q12_4
 = 
a_Q12
[4];

102 
a_Q12_5
 = 
a_Q12
[5];

103 
a_Q12_6
 = 
a_Q12
[6];

104 
a_Q12_7
 = 
a_Q12
[7];

105 
a_Q12_8
 = 
a_Q12
[8];

106 
a_Q12_9
 = 
a_Q12
[9];

107 
a_Q12_10
 = 
a_Q12
[10];

108 
a_Q12_11
 = 
a_Q12
[11];

109 
a_Q12_12
 = 
a_Q12
[12];

110 
a_Q12_13
 = 
a_Q12
[13];

111 
a_Q12_14
 = 
a_Q12
[14];

112 
a_Q12_15
 = 
a_Q12
[15];

114 
ãmp64
;

116 
	`sûk_as£π
–
nSèãsDñayedDecisi⁄
 > 0 );

118 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

119 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

120 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

122  
i
 = 0; i < 
Àngth
; i++ ) {

126 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

129 
ãmp64
 = 
	`__buûtö_mùs_mu…
(
¥ed_œg_±r
[ 0 ], 
b_Q14_0
 );

130 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
¥ed_œg_±r
[ -1 ], 
b_Q14_1
 );

131 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
¥ed_œg_±r
[ -2 ], 
b_Q14_2
 );

132 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
¥ed_œg_±r
[ -3 ], 
b_Q14_3
 );

133 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
¥ed_œg_±r
[ -4 ], 
b_Q14_4
 );

134 
ãmp64
 += 32768;

135 
LTP_¥ed_Q14
 = 
	`__buûtö_mùs_exå_w
(
ãmp64
, 16);

136 
LTP_¥ed_Q14
 = 
	`sûk_LSHIFT
( LTP_pred_Q14, 1 );

137 
¥ed_œg_±r
++;

139 
LTP_¥ed_Q14
 = 0;

143 if–
œg
 > 0 ) {

145 
n_LTP_Q14
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

146 
n_LTP_Q14
 = 
	`sûk_SMLAWT
–n_LTP_Q14, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

147 
n_LTP_Q14
 = 
	`sûk_SUB_LSHIFT32
–
LTP_¥ed_Q14
,Ç_LTP_Q14, 2 );

148 
shp_œg_±r
++;

150 
n_LTP_Q14
 = 0;

153  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

155 
psDD
 = &
psDñDec
[ 
k
 ];

158 
psSS
 = 
psSam∂eSèã
[ 
k
 ];

161 
psDD
->
Sìd
 = 
	`sûk_RAND
(ÖsDD->Seed );

164 
psLPC_Q14
 = &
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 1 + 
i
 ];

166 
	`sûk_as£π
–
¥edi˘LPCOrdî
 == 10 ||ÖredictLPCOrder == 16 );

167 
ãmp64
 = 
	`__buûtö_mùs_mu…
(
psLPC_Q14
[ 0 ], 
a_Q12_0
 );

168 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -1 ], 
a_Q12_1
 );

169 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -2 ], 
a_Q12_2
 );

170 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -3 ], 
a_Q12_3
 );

171 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -4 ], 
a_Q12_4
 );

172 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -5 ], 
a_Q12_5
 );

173 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -6 ], 
a_Q12_6
 );

174 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -7 ], 
a_Q12_7
 );

175 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -8 ], 
a_Q12_8
 );

176 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -9 ], 
a_Q12_9
 );

177 if–
¥edi˘LPCOrdî
 == 16 ) {

178 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -10 ], 
a_Q12_10
 );

179 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -11 ], 
a_Q12_11
 );

180 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -12 ], 
a_Q12_12
 );

181 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -13 ], 
a_Q12_13
 );

182 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -14 ], 
a_Q12_14
 );

183 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
psLPC_Q14
[ -15 ], 
a_Q12_15
 );

185 
ãmp64
 += 32768;

186 
LPC_¥ed_Q14
 = 
	`__buûtö_mùs_exå_w
(
ãmp64
, 16);

188 
LPC_¥ed_Q14
 = 
	`sûk_LSHIFT
( LPC_pred_Q14, 4 );

191 
	`sûk_as£π
––
sh≠ögLPCOrdî
 & 1 ) == 0 );

193 
tmp2
 = 
	`sûk_SMLAWB
–
psLPC_Q14
[ 0 ], 
psDD
->
sAR2_Q14
[ 0 ], 
w¨pög_Q16
 );

195 
tmp1
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 0 ],ÖsDD->sAR2_Q14[ 1 ] - 
tmp2
, 
w¨pög_Q16
 );

196 
psDD
->
sAR2_Q14
[ 0 ] = 
tmp2
;

198 
ãmp64
 = 
	`__buûtö_mùs_mu…
(
tmp2
, 
AR_shp_Q13
[ 0 ] );

200 
¥ev
 = 
psDD
->
sAR2_Q14
[ 1 ];

203  
j
 = 2; j < 
sh≠ögLPCOrdî
; j += 2 ) {

204 
cur
 = 
psDD
->
sAR2_Q14
[ 
j
 ];

205 
√xt
 = 
psDD
->
sAR2_Q14
[ 
j
+1 ];

207 
tmp2
 = 
	`sûk_SMLAWB
–
¥ev
, 
cur
 - 
tmp1
, 
w¨pög_Q16
 );

208 
psDD
->
sAR2_Q14
[ 
j
 - 1 ] = 
tmp1
;

209 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
tmp1
, 
AR_shp_Q13
[ 
j
 - 1 ] );

210 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
tmp2
, 
AR_shp_Q13
[ 
j
 ] );

212 
tmp1
 = 
	`sûk_SMLAWB
–
cur
, 
√xt
 - 
tmp2
, 
w¨pög_Q16
 );

213 
psDD
->
sAR2_Q14
[ 
j
 + 0 ] = 
tmp2
;

214 
¥ev
 = 
√xt
;

216 
psDD
->
sAR2_Q14
[ 
sh≠ögLPCOrdî
 - 1 ] = 
tmp1
;

217 
ãmp64
 = 
	`__buûtö_mùs_madd
–ãmp64, 
tmp1
, 
AR_shp_Q13
[ 
sh≠ögLPCOrdî
 - 1 ] );

218 
ãmp64
 += 32768;

219 
n_AR_Q14
 = 
	`__buûtö_mùs_exå_w
(
ãmp64
, 16);

220 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 1 );

221 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
psDD
->
LF_AR_Q14
, 
Tût_Q14
 );

222 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 2 );

224 
n_LF_Q14
 = 
	`sûk_SMULWB
–
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ], 
LF_shp_Q14
 );

225 
n_LF_Q14
 = 
	`sûk_SMLAWT
–n_LF_Q14, 
psDD
->
LF_AR_Q14
, 
LF_shp_Q14
 );

226 
n_LF_Q14
 = 
	`sûk_LSHIFT
(Ç_LF_Q14, 2 );

230 
tmp1
 = 
	`sûk_ADD32
–
n_AR_Q14
, 
n_LF_Q14
 );

231 
tmp2
 = 
	`sûk_ADD32
–
n_LTP_Q14
, 
LPC_¥ed_Q14
 );

232 
tmp1
 = 
	`sûk_SUB32
–
tmp2
,Åmp1 );

233 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 4 );

235 
r_Q10
 = 
	`sûk_SUB32
–
x_Q10
[ 
i
 ], 
tmp1
 );

238 i‡–
psDD
->
Sìd
 < 0 ) {

239 
r_Q10
 = -r_Q10;

241 
r_Q10
 = 
	`sûk_LIMIT_32
(Ñ_Q10, -(31 << 10), 30 << 10 );

244 
q1_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
off£t_Q10
 );

245 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
, 10 );

246 if–
q1_Q0
 > 0 ) {

247 
q1_Q10
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

248 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

249 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

250 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

251 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

252 } if–
q1_Q0
 == 0 ) {

253 
q1_Q10
 = 
off£t_Q10
;

254 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

255 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

256 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

257 } if–
q1_Q0
 == -1 ) {

258 
q2_Q10
 = 
off£t_Q10
;

259 
q1_Q10
 = 
	`sûk_SUB32
–
q2_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

260 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

261 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

263 
q1_Q10
 = 
	`sûk_ADD32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

264 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

265 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

266 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

267 
rd2_Q10
 = 
	`sûk_SMULBB
–-
q2_Q10
, 
Lambda_Q10
 );

269 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q1_Q10
 );

270 
rd1_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd1_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

271 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q2_Q10
 );

272 
rd2_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd2_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

274 if–
rd1_Q10
 < 
rd2_Q10
 ) {

275 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

276 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

277 
psSS
[ 0 ].
Q_Q10
 = 
q1_Q10
;

278 
psSS
[ 1 ].
Q_Q10
 = 
q2_Q10
;

280 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

281 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

282 
psSS
[ 0 ].
Q_Q10
 = 
q2_Q10
;

283 
psSS
[ 1 ].
Q_Q10
 = 
q1_Q10
;

289 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 0 ].
Q_Q10
, 4 );

290 i‡–
psDD
->
Sìd
 < 0 ) {

291 
exc_Q14
 = -exc_Q14;

295 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

296 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

299 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
xq_Q14
, 
n_AR_Q14
 );

300 
psSS
[ 0 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

301 
psSS
[ 0 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

302 
psSS
[ 0 ].
LPC_exc_Q14
 = LPC_exc_Q14;

303 
psSS
[ 0 ].
xq_Q14
 = xq_Q14;

308 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 1 ].
Q_Q10
, 4 );

309 i‡–
psDD
->
Sìd
 < 0 ) {

310 
exc_Q14
 = -exc_Q14;

315 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

316 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

319 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
xq_Q14
, 
n_AR_Q14
 );

320 
psSS
[ 1 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

321 
psSS
[ 1 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

322 
psSS
[ 1 ].
LPC_exc_Q14
 = LPC_exc_Q14;

323 
psSS
[ 1 ].
xq_Q14
 = xq_Q14;

326 *
sm∂_buf_idx
 = ( *sm∂_buf_idx - 1 ) % 
DECISION_DELAY
;

327 if–*
sm∂_buf_idx
 < 0 ) *sm∂_buf_idx +
DECISION_DELAY
;

328 
œ°_sm∂e_idx
 = ( *
sm∂_buf_idx
 + 
decisi⁄Dñay
 ) % 
DECISION_DELAY
;

331 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

332 
Wö√r_öd
 = 0;

333  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

334 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 < 
RDmö_Q10
 ) {

335 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

336 
Wö√r_öd
 = 
k
;

341 
Wö√r_ønd_°©e
 = 
psDñDec
[ 
Wö√r_öd
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ];

342  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

343 if–
psDñDec
[ 
k
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ] !
Wö√r_ønd_°©e
 ) {

344 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 0 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

345 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 1 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

346 
	`sûk_as£π
–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 >= 0 );

351 
RDmax_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

352 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 1 ].
RD_Q10
;

353 
RDmax_öd
 = 0;

354 
RDmö_öd
 = 0;

355  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

357 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 > 
RDmax_Q10
 ) {

358 
RDmax_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

359 
RDmax_öd
 = 
k
;

362 if–
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 < 
RDmö_Q10
 ) {

363 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
;

364 
RDmö_öd
 = 
k
;

369 if–
RDmö_Q10
 < 
RDmax_Q10
 ) {

370 
	`sûk_mem˝y
––(
›us_öt32
 *)&
psDñDec
[ 
RDmax_öd
 ] ) + 
i
,

371 –(
›us_öt32
 *)&
psDñDec
[ 
RDmö_öd
 ] ) + 
i
, –
NSQ_dñ_dec_°ru˘
 ) - i * ( opus_int32) );

372 
	`sûk_mem˝y
–&
psSam∂eSèã
[ 
RDmax_öd
 ][ 0 ], &psSam∂eSèã[ 
RDmö_öd
 ][ 1 ], –
NSQ_ßm∂e_°ru˘
 ) );

376 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

377 if–
sub‰
 > 0 || 
i
 >
decisi⁄Dñay
 ) {

378 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

379 
xq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

380 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
dñayedGaö_Q10
[Üast_smple_idx ] ), 8 ) );

381 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

382 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Pªd_Q15
[ 
œ°_sm∂e_idx
 ];

384 
NSQ
->
sLTP_shp_buf_idx
++;

385 
NSQ
->
sLTP_buf_idx
++;

388  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

389 
psDD
 = &
psDñDec
[ 
k
 ];

390 
psSS
 = &
psSam∂eSèã
[ 
k
 ][ 0 ];

391 
psDD
->
LF_AR_Q14
 = 
psSS
->LF_AR_Q14;

392 
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 + 
i
 ] = 
psSS
->
xq_Q14
;

393 
psDD
->
Xq_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
xq_Q14
;

394 
psDD
->
Q_Q10
[ *
sm∂_buf_idx
 ] = 
psSS
->Q_Q10;

395 
psDD
->
Pªd_Q15
[ *
sm∂_buf_idx
 ] = 
	`sûk_LSHIFT32
–
psSS
->
LPC_exc_Q14
, 1 );

396 
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
sLTP_shp_Q14
;

397 
psDD
->
Sìd
 = 
	`sûk_ADD32_ovÊw
–psDD->Sìd, 
	`sûk_RSHIFT_ROUND
–
psSS
->
Q_Q10
, 10 ) );

398 
psDD
->
R™dSèã
[ *
sm∂_buf_idx
 ] =ÖsDD->
Sìd
;

399 
psDD
->
RD_Q10
 = 
psSS
->RD_Q10;

401 
dñayedGaö_Q10
[ *
sm∂_buf_idx
 ] = 
Gaö_Q10
;

404  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

405 
psDD
 = &
psDñDec
[ 
k
 ];

406 
	`sûk_mem˝y
–
psDD
->
sLPC_Q14
, &psDD->sLPC_Q14[ 
Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

408 
	}
}

	@silk/mips/macros_mipsr1.h

29 #i‚de‡
__SILK_MACROS_MIPSR1_H__


30 
	#__SILK_MACROS_MIPSR1_H__


	)

32 
	#mùs_˛z
(
x
Ë
	`__buûtö_˛z
(x)

	)

34 #unde‡
sûk_SMULWB


35 
ölöe
 
	$sûk_SMULWB
(
a
, 
b
)

37 
ac
;

38 
c
;

40 
ac
 = 
	`__buûtö_mùs_mu…
(
a
, (
›us_öt32
)(
›us_öt16
)
b
);

41 
c
 = 
	`__buûtö_mùs_exå_w
(
ac
, 16);

43  
c
;

44 
	}
}

46 #unde‡
sûk_SMLAWB


47 
	#sûk_SMLAWB
(
a32
, 
b32
, 
c32
Ë(◊32Ë+ 
	`sûk_SMULWB
(b32, c32))

	)

49 #unde‡
sûk_SMULWW


50 
ölöe
 
	$sûk_SMULWW
(
a
, 
b
)

52 
ac
;

53 
c
;

55 
ac
 = 
	`__buûtö_mùs_mu…
(
a
, 
b
);

56 
c
 = 
	`__buûtö_mùs_exå_w
(
ac
, 16);

58  
c
;

59 
	}
}

61 #unde‡
sûk_SMLAWW


62 
ölöe
 
	$sûk_SMLAWW
(
a
, 
b
, 
c
)

64 
ac
;

65 
ªs
;

67 
ac
 = 
	`__buûtö_mùs_mu…
(
b
, 
c
);

68 
ªs
 = 
	`__buûtö_mùs_exå_w
(
ac
, 16);

69 
ªs
 +
a
;

71  
ªs
;

72 
	}
}

74 
	#OVERRIDE_sûk_CLZ16


	)

75 
ölöe
 
›us_öt32
 
	$sûk_CLZ16
(
›us_öt16
 
ö16
)

77 
ª32
;

78 
›us_öt32
 
ö32
 = (›us_öt32 )
ö16
;

79 
ª32
 = 
	`mùs_˛z
(
ö32
);

80 
ª32
-=16;

81  
ª32
;

82 
	}
}

84 
	#OVERRIDE_sûk_CLZ32


	)

85 
ölöe
 
›us_öt32
 
	$sûk_CLZ32
(
›us_öt32
 
ö32
)

87 
ª32
;

88 
ª32
 = 
	`mùs_˛z
(
ö32
);

89  
ª32
;

90 
	}
}

	@silk/mips/sigproc_fix_mipsr1.h

28 #i‚de‡
SILK_SIGPROC_FIX_MIPSR1_H


29 
	#SILK_SIGPROC_FIX_MIPSR1_H


	)

31 #unde‡
sûk_SAT16


32 
ölöe
 
	$sûk_SAT16
(
a
)

34 
c
;

35 
c
 = 
	`__buûtö_mùs_shŒ_s_w
(
a
, 16);

36 
c
 = c>>16;

38  
c
;

39 
	}
}

41 #unde‡
sûk_LSHIFT_SAT32


42 
ölöe
 
	$sûk_LSHIFT_SAT32
(
a
, 
shi·
)

44 
r
;

46 
r
 = 
	`__buûtö_mùs_shŒ_s_w
(
a
, 
shi·
);

48  
r
;

49 
	}
}

51 #unde‡
sûk_RSHIFT_ROUND


52 
ölöe
 
	$sûk_RSHIFT_ROUND
(
a
, 
shi·
)

54 
r
;

56 
r
 = 
	`__buûtö_mùs_shø_r_w
(
a
, 
shi·
);

57  
r
;

58 
	}
}

	@silk/pitch_est_defines.h

28 #i‚de‡
SILK_PE_DEFINES_H


29 
	#SILK_PE_DEFINES_H


	)

31 
	~"SigProc_FIX.h
"

37 
	#PE_MAX_FS_KHZ
 16

	)

39 
	#PE_MAX_NB_SUBFR
 4

	)

40 
	#PE_SUBFR_LENGTH_MS
 5

	)

42 
	#PE_LTP_MEM_LENGTH_MS
 ( 4 * 
PE_SUBFR_LENGTH_MS
 )

	)

44 
	#PE_MAX_FRAME_LENGTH_MS
 ( 
PE_LTP_MEM_LENGTH_MS
 + 
PE_MAX_NB_SUBFR
 * 
PE_SUBFR_LENGTH_MS
 )

	)

45 
	#PE_MAX_FRAME_LENGTH
 ( 
PE_MAX_FRAME_LENGTH_MS
 * 
PE_MAX_FS_KHZ
 )

	)

46 
	#PE_MAX_FRAME_LENGTH_ST_1
 ( 
PE_MAX_FRAME_LENGTH
 >> 2 )

	)

47 
	#PE_MAX_FRAME_LENGTH_ST_2
 ( 
PE_MAX_FRAME_LENGTH
 >> 1 )

	)

49 
	#PE_MAX_LAG_MS
 18

	)

50 
	#PE_MIN_LAG_MS
 2

	)

51 
	#PE_MAX_LAG
 ( 
PE_MAX_LAG_MS
 * 
PE_MAX_FS_KHZ
 )

	)

52 
	#PE_MIN_LAG
 ( 
PE_MIN_LAG_MS
 * 
PE_MAX_FS_KHZ
 )

	)

54 
	#PE_D_SRCH_LENGTH
 24

	)

56 
	#PE_NB_STAGE3_LAGS
 5

	)

58 
	#PE_NB_CBKS_STAGE2
 3

	)

59 
	#PE_NB_CBKS_STAGE2_EXT
 11

	)

61 
	#PE_NB_CBKS_STAGE3_MAX
 34

	)

62 
	#PE_NB_CBKS_STAGE3_MID
 24

	)

63 
	#PE_NB_CBKS_STAGE3_MIN
 16

	)

65 
	#PE_NB_CBKS_STAGE3_10MS
 12

	)

66 
	#PE_NB_CBKS_STAGE2_10MS
 3

	)

68 
	#PE_SHORTLAG_BIAS
 0.2‡

	)

69 
	#PE_PREVLAG_BIAS
 0.2‡

	)

70 
	#PE_FLATCONTOUR_BIAS
 0.05f

	)

72 
	#SILK_PE_MIN_COMPLEX
 0

	)

73 
	#SILK_PE_MID_COMPLEX
 1

	)

74 
	#SILK_PE_MAX_COMPLEX
 2

	)

77 c⁄° 
›us_öt8
 
sûk_CB_œgs_°age2
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE2_EXT
 ];

78 c⁄° 
›us_öt8
 
sûk_CB_œgs_°age3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ];

79 c⁄° 
›us_öt8
 
sûk_Lag_ønge_°age3
[ 
SILK_PE_MAX_COMPLEX
 + 1 ] [ 
PE_MAX_NB_SUBFR
 ][ 2 ];

80 c⁄° 
›us_öt8
 
sûk_nb_cbk_£¨chs_°age3
[ 
SILK_PE_MAX_COMPLEX
 + 1 ];

83 c⁄° 
›us_öt8
 
sûk_CB_œgs_°age2_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1][ 3 ];

84 c⁄° 
›us_öt8
 
sûk_CB_œgs_°age3_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1 ][ 12 ];

85 c⁄° 
›us_öt8
 
sûk_Lag_ønge_°age3_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1 ][ 2 ];

	@silk/pitch_est_tables.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"ty≥def.h
"

33 
	~"pôch_e°_deföes.h
"

35 c⁄° 
›us_öt8
 
	gsûk_CB_œgs_°age2_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1][ 
PE_NB_CBKS_STAGE2_10MS
 ] =

41 c⁄° 
›us_öt8
 
	gsûk_CB_œgs_°age3_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1 ][ 
PE_NB_CBKS_STAGE3_10MS
 ] =

47 c⁄° 
›us_öt8
 
	gsûk_Lag_ønge_°age3_10_ms
[ 
PE_MAX_NB_SUBFR
 >> 1 ][ 2 ] =

53 c⁄° 
›us_öt8
 
	gsûk_CB_œgs_°age2
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE2_EXT
 ] =

61 c⁄° 
›us_öt8
 
	gsûk_CB_œgs_°age3
[ 
PE_MAX_NB_SUBFR
 ][ 
PE_NB_CBKS_STAGE3_MAX
 ] =

69 c⁄° 
›us_öt8
 
	gsûk_Lag_ønge_°age3
[ 
SILK_PE_MAX_COMPLEX
 + 1 ] [ 
PE_MAX_NB_SUBFR
 ][ 2 ] =

94 c⁄° 
›us_öt8
 
	gsûk_nb_cbk_£¨chs_°age3
[ 
SILK_PE_MAX_COMPLEX
 + 1 ] =

96 
PE_NB_CBKS_STAGE3_MIN
,

97 
PE_NB_CBKS_STAGE3_MID
,

98 
PE_NB_CBKS_STAGE3_MAX


	@silk/process_NLSFs.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_¥o˚ss_NLSFs
(

36 
sûk_ícodî_°©e
 *
psEncC
,

37 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ],

38 
›us_öt16
 
pNLSF_Q15
[ 
MAX_LPC_ORDER
 ],

39 c⁄° 
›us_öt16
 
¥ev_NLSFq_Q15
[ 
MAX_LPC_ORDER
 ]

42 
›us_öt
 
i
, 
doI¡îpﬁ©e
;

43 
›us_öt
 
NLSF_mu_Q20
;

44 
›us_öt16
 
i_sqr_Q15
;

45 
›us_öt16
 
pNLSF0_ãmp_Q15
[ 
MAX_LPC_ORDER
 ];

46 
›us_öt16
 
pNLSFW_QW
[ 
MAX_LPC_ORDER
 ];

47 
›us_öt16
 
pNLSFW0_ãmp_QW
[ 
MAX_LPC_ORDER
 ];

49 
	`sûk_as£π
–
psEncC
->
•ìch_a˘ivôy_Q8
 >= 0 );

50 
	`sûk_as£π
–
psEncC
->
•ìch_a˘ivôy_Q8
 <
	`SILK_FIX_CONST
( 1.0, 8 ) );

51 
	`˚…_as£π
–
psEncC
->
u£I¡îpﬁ©edNLSFs
 =1 ||ÖsEncC->
ödi˚s
.
NLSFI¡îpC€f_Q2
 == ( 1 << 2 ) );

57 
NLSF_mu_Q20
 = 
	`sûk_SMLAWB
–
	`SILK_FIX_CONST
–0.003, 20 ), SILK_FIX_CONST–-0.001, 28 ), 
psEncC
->
•ìch_a˘ivôy_Q8
 );

58 if–
psEncC
->
nb_sub‰
 == 2 ) {

60 
NLSF_mu_Q20
 = 
	`sûk_ADD_RSHIFT
( NLSF_mu_Q20, NLSF_mu_Q20, 1 );

63 
	`˚…_as£π
–
NLSF_mu_Q20
 > 0 );

64 
	`sûk_as£π
–
NLSF_mu_Q20
 <
	`SILK_FIX_CONST
( 0.005, 20 ) );

67 
	`sûk_NLSF_VQ_weights_œroü
–
pNLSFW_QW
, 
pNLSF_Q15
, 
psEncC
->
¥edi˘LPCOrdî
 );

70 
doI¡îpﬁ©e
 = ( 
psEncC
->
u£I¡îpﬁ©edNLSFs
 =1 ) && (ÖsEncC->
ödi˚s
.
NLSFI¡îpC€f_Q2
 < 4 );

71 if–
doI¡îpﬁ©e
 ) {

73 
	`sûk_öãΩﬁ©e
–
pNLSF0_ãmp_Q15
, 
¥ev_NLSFq_Q15
, 
pNLSF_Q15
,

74 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
,ÖsEncC->
¥edi˘LPCOrdî
 );

77 
	`sûk_NLSF_VQ_weights_œroü
–
pNLSFW0_ãmp_QW
, 
pNLSF0_ãmp_Q15
, 
psEncC
->
¥edi˘LPCOrdî
 );

80 
i_sqr_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_SMULBB
–
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
,ÖsEncC->indices.NLSFInterpCoef_Q2 ), 11 );

81  
i
 = 0; i < 
psEncC
->
¥edi˘LPCOrdî
; i++ ) {

82 
pNLSFW_QW
[ 
i
 ] = 
	`sûk_ADD16
–
	`sûk_RSHIFT
(ÖNLSFW_QW[ i ], 1 ), silk_RSHIFT(

83 
	`sûk_SMULBB
–
pNLSFW0_ãmp_QW
[ 
i
 ], 
i_sqr_Q15
 ), 16) );

84 
	`sûk_as£π
–
pNLSFW_QW
[ 
i
 ] >= 1 );

88 
	`sûk_NLSF_ícode
–
psEncC
->
ödi˚s
.
NLSFIndi˚s
, 
pNLSF_Q15
,ÖsEncC->
psNLSF_CB
, 
pNLSFW_QW
,

89 
NLSF_mu_Q20
, 
psEncC
->
NLSF_MSVQ_Surviv‹s
,ÖsEncC->
ödi˚s
.
sig«lTy≥
 );

92 
	`sûk_NLSF2A
–
PªdC€f_Q12
[ 1 ], 
pNLSF_Q15
, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

94 if–
doI¡îpﬁ©e
 ) {

96 
	`sûk_öãΩﬁ©e
–
pNLSF0_ãmp_Q15
, 
¥ev_NLSFq_Q15
, 
pNLSF_Q15
,

97 
psEncC
->
ödi˚s
.
NLSFI¡îpC€f_Q2
,ÖsEncC->
¥edi˘LPCOrdî
 );

100 
	`sûk_NLSF2A
–
PªdC€f_Q12
[ 0 ], 
pNLSF0_ãmp_Q15
, 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

104 
	`˚…_as£π
–
psEncC
->
¥edi˘LPCOrdî
 <
MAX_LPC_ORDER
 );

105 
	`sûk_mem˝y
–
PªdC€f_Q12
[ 0 ], PªdC€f_Q12[ 1 ], 
psEncC
->
¥edi˘LPCOrdî
 * –
›us_öt16
 ) );

107 
	}
}

	@silk/quant_LTP_gains.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"tunög_∑ømëîs.h
"

35 
	$sûk_qu™t_LTP_gaös
(

36 
›us_öt16
 
B_Q14
[ 
MAX_NB_SUBFR
 * 
LTP_ORDER
 ],

37 
›us_öt8
 
cbk_ödex
[ 
MAX_NB_SUBFR
 ],

38 
›us_öt8
 *
≥riodicôy_ödex
,

39 
›us_öt32
 *
sum_log_gaö_Q7
,

40 
›us_öt
 *
¥ed_gaö_dB_Q7
,

41 c⁄° 
›us_öt32
 
XX_Q17
[ 
MAX_NB_SUBFR
*
LTP_ORDER
*LTP_ORDER ],

42 c⁄° 
›us_öt32
 
xX_Q17
[ 
MAX_NB_SUBFR
*
LTP_ORDER
 ],

43 c⁄° 
›us_öt
 
sub‰_Àn
,

44 c⁄° 
›us_öt
 
nb_sub‰
,

45 
¨ch


48 
›us_öt
 
j
, 
k
, 
cbk_size
;

49 
›us_öt8
 
ãmp_idx
[ 
MAX_NB_SUBFR
 ];

50 c⁄° 
›us_uöt8
 *
˛_±r_Q5
;

51 c⁄° 
›us_öt8
 *
cbk_±r_Q7
;

52 c⁄° 
›us_uöt8
 *
cbk_gaö_±r_Q7
;

53 c⁄° 
›us_öt32
 *
XX_Q17_±r
, *
xX_Q17_±r
;

54 
›us_öt32
 
ªs_ƒg_Q15_sub‰
, 
ªs_ƒg_Q15
, 
øã_di°_Q7_sub‰
, 
øã_di°_Q7
, 
mö_øã_di°_Q7
;

55 
›us_öt32
 
sum_log_gaö_tmp_Q7
, 
be°_sum_log_gaö_Q7
, 
max_gaö_Q7
;

56 
›us_öt
 
gaö_Q7
;

62 
mö_øã_di°_Q7
 = 
sûk_öt32_MAX
;

63 
be°_sum_log_gaö_Q7
 = 0;

64  
k
 = 0; k < 3; k++ ) {

67 
›us_öt32
 
gaö_ß„ty
 = 
	`SILK_FIX_CONST
( 0.4, 7 );

69 
˛_±r_Q5
 = 
sûk_LTP_gaö_BITS_Q5_±rs
[ 
k
 ];

70 
cbk_±r_Q7
 = 
sûk_LTP_vq_±rs_Q7
[ 
k
 ];

71 
cbk_gaö_±r_Q7
 = 
sûk_LTP_vq_gaö_±rs_Q7
[ 
k
 ];

72 
cbk_size
 = 
sûk_LTP_vq_sizes
[ 
k
 ];

75 
XX_Q17_±r
 = 
XX_Q17
;

76 
xX_Q17_±r
 = 
xX_Q17
;

78 
ªs_ƒg_Q15
 = 0;

79 
øã_di°_Q7
 = 0;

80 
sum_log_gaö_tmp_Q7
 = *
sum_log_gaö_Q7
;

81  
j
 = 0; j < 
nb_sub‰
; j++ ) {

82 
max_gaö_Q7
 = 
	`sûk_log2lö
––
	`SILK_FIX_CONST
–
MAX_SUM_LOG_GAIN_DB
 / 6.0, 7 ) - 
sum_log_gaö_tmp_Q7
 )

83 + 
	`SILK_FIX_CONST
–7, 7 ) ) - 
gaö_ß„ty
;

84 
	`sûk_VQ_WM©_EC
(

85 &
ãmp_idx
[ 
j
 ],

86 &
ªs_ƒg_Q15_sub‰
,

87 &
øã_di°_Q7_sub‰
,

88 &
gaö_Q7
,

89 
XX_Q17_±r
,

90 
xX_Q17_±r
,

91 
cbk_±r_Q7
,

92 
cbk_gaö_±r_Q7
,

93 
˛_±r_Q5
,

94 
sub‰_Àn
,

95 
max_gaö_Q7
,

96 
cbk_size
,

97 
¨ch


100 
ªs_ƒg_Q15
 = 
	`sûk_ADD_POS_SAT32
–ªs_ƒg_Q15, 
ªs_ƒg_Q15_sub‰
 );

101 
øã_di°_Q7
 = 
	`sûk_ADD_POS_SAT32
–øã_di°_Q7, 
øã_di°_Q7_sub‰
 );

102 
sum_log_gaö_tmp_Q7
 = 
	`sûk_max
(0, sum_log_gain_tmp_Q7

103 + 
	`sûk_lö2log
–
gaö_ß„ty
 + 
gaö_Q7
 ) - 
	`SILK_FIX_CONST
( 7, 7 ));

105 
XX_Q17_±r
 +
LTP_ORDER
 * LTP_ORDER;

106 
xX_Q17_±r
 +
LTP_ORDER
;

109 if–
øã_di°_Q7
 <
mö_øã_di°_Q7
 ) {

110 
mö_øã_di°_Q7
 = 
øã_di°_Q7
;

111 *
≥riodicôy_ödex
 = (
›us_öt8
)
k
;

112 
	`sûk_mem˝y
–
cbk_ödex
, 
ãmp_idx
, 
nb_sub‰
 * –
›us_öt8
 ) );

113 
be°_sum_log_gaö_Q7
 = 
sum_log_gaö_tmp_Q7
;

117 
cbk_±r_Q7
 = 
sûk_LTP_vq_±rs_Q7
[ *
≥riodicôy_ödex
 ];

118  
j
 = 0; j < 
nb_sub‰
; j++ ) {

119  
k
 = 0; k < 
LTP_ORDER
; k++ ) {

120 
B_Q14
[ 
j
 * 
LTP_ORDER
 + 
k
 ] = 
	`sûk_LSHIFT
–
cbk_±r_Q7
[ 
cbk_ödex
[ j ] * LTP_ORDER + k ], 7 );

124 if–
nb_sub‰
 == 2 ) {

125 
ªs_ƒg_Q15
 = 
	`sûk_RSHIFT32
(Ñes_nrg_Q15, 1 );

127 
ªs_ƒg_Q15
 = 
	`sûk_RSHIFT32
(Ñes_nrg_Q15, 2 );

130 *
sum_log_gaö_Q7
 = 
be°_sum_log_gaö_Q7
;

131 *
¥ed_gaö_dB_Q7
 = (
›us_öt
)
	`sûk_SMULBB
–-3, 
	`sûk_lö2log
–
ªs_ƒg_Q15
 ) - ( 15 << 7 ) );

132 
	}
}

	@silk/resampler.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

50 
	~"ªßm∂î_¥iv©e.h
"

53 c⁄° 
›us_öt8
 
	gdñay_m©rix_íc
[ 5 ][ 3 ] = {

62 c⁄° 
›us_öt8
 
	gdñay_m©rix_dec
[ 3 ][ 5 ] = {

70 
	#øãID
(
R
Ë–––((R)>>12Ë- ((R)>16000ËË>> ((R)>24000ËË- 1 )

	)

72 
	#USE_sûk_ªßm∂î_c›y
 (0)

	)

73 
	#USE_sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
 (1)

	)

74 
	#USE_sûk_ªßm∂î_¥iv©e_IIR_FIR
 (2)

	)

75 
	#USE_sûk_ªßm∂î_¥iv©e_down_FIR
 (3)

	)

78 
›us_öt
 
	$sûk_ªßm∂î_öô
(

79 
sûk_ªßm∂î_°©e_°ru˘
 *
S
,

80 
›us_öt32
 
Fs_Hz_ö
,

81 
›us_öt32
 
Fs_Hz_out
,

82 
›us_öt
 
f‹Enc


85 
›us_öt
 
up2x
;

88 
	`sûk_mem£t
–
S
, 0, –
sûk_ªßm∂î_°©e_°ru˘
 ) );

91 if–
f‹Enc
 ) {

92 if––
Fs_Hz_ö
 != 8000 && Fs_Hz_in != 12000 && Fs_Hz_in != 16000 && Fs_Hz_in != 24000 && Fs_Hz_in != 48000 ) ||

93 –
Fs_Hz_out
 != 8000 && Fs_Hz_out != 12000 && Fs_Hz_out != 16000 ) ) {

94 
	`˚…_as£π
( 0 );

97 
S
->
öputDñay
 = 
dñay_m©rix_íc
[ 
	`øãID
–
Fs_Hz_ö
 ) ][Ñ©eID–
Fs_Hz_out
 ) ];

99 if––
Fs_Hz_ö
 != 8000 && Fs_Hz_in != 12000 && Fs_Hz_in != 16000 ) ||

100 –
Fs_Hz_out
 != 8000 && Fs_Hz_out != 12000 && Fs_Hz_out != 16000 && Fs_Hz_out != 24000 && Fs_Hz_out != 48000 ) ) {

101 
	`˚…_as£π
( 0 );

104 
S
->
öputDñay
 = 
dñay_m©rix_dec
[ 
	`øãID
–
Fs_Hz_ö
 ) ][Ñ©eID–
Fs_Hz_out
 ) ];

107 
S
->
Fs_ö_kHz
 = 
	`sûk_DIV32_16
–
Fs_Hz_ö
, 1000 );

108 
S
->
Fs_out_kHz
 = 
	`sûk_DIV32_16
–
Fs_Hz_out
, 1000 );

111 
S
->
b©chSize
 = S->
Fs_ö_kHz
 * 
RESAMPLER_MAX_BATCH_SIZE_MS
;

114 
up2x
 = 0;

115 if–
Fs_Hz_out
 > 
Fs_Hz_ö
 ) {

117 if–
Fs_Hz_out
 =
	`sûk_MUL
–
Fs_Hz_ö
, 2 ) ) {

119 
S
->
ªßm∂î_fun˘i⁄
 = 
USE_sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
;

122 
S
->
ªßm∂î_fun˘i⁄
 = 
USE_sûk_ªßm∂î_¥iv©e_IIR_FIR
;

123 
up2x
 = 1;

125 } i‡–
Fs_Hz_out
 < 
Fs_Hz_ö
 ) {

127 
S
->
ªßm∂î_fun˘i⁄
 = 
USE_sûk_ªßm∂î_¥iv©e_down_FIR
;

128 if–
	`sûk_MUL
–
Fs_Hz_out
, 4 ) =sûk_MUL–
Fs_Hz_ö
, 3 ) ) {

129 
S
->
FIR_Føcs
 = 3;

130 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR0
;

131 
S
->
C€fs
 = 
sûk_Reßm∂î_3_4_COEFS
;

132 } if–
	`sûk_MUL
–
Fs_Hz_out
, 3 ) =sûk_MUL–
Fs_Hz_ö
, 2 ) ) {

133 
S
->
FIR_Føcs
 = 2;

134 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR0
;

135 
S
->
C€fs
 = 
sûk_Reßm∂î_2_3_COEFS
;

136 } if–
	`sûk_MUL
–
Fs_Hz_out
, 2 ) =
Fs_Hz_ö
 ) {

137 
S
->
FIR_Føcs
 = 1;

138 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR1
;

139 
S
->
C€fs
 = 
sûk_Reßm∂î_1_2_COEFS
;

140 } if–
	`sûk_MUL
–
Fs_Hz_out
, 3 ) =
Fs_Hz_ö
 ) {

141 
S
->
FIR_Føcs
 = 1;

142 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR2
;

143 
S
->
C€fs
 = 
sûk_Reßm∂î_1_3_COEFS
;

144 } if–
	`sûk_MUL
–
Fs_Hz_out
, 4 ) =
Fs_Hz_ö
 ) {

145 
S
->
FIR_Føcs
 = 1;

146 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR2
;

147 
S
->
C€fs
 = 
sûk_Reßm∂î_1_4_COEFS
;

148 } if–
	`sûk_MUL
–
Fs_Hz_out
, 6 ) =
Fs_Hz_ö
 ) {

149 
S
->
FIR_Føcs
 = 1;

150 
S
->
FIR_Ordî
 = 
RESAMPLER_DOWN_ORDER_FIR2
;

151 
S
->
C€fs
 = 
sûk_Reßm∂î_1_6_COEFS
;

154 
	`˚…_as£π
( 0 );

159 
S
->
ªßm∂î_fun˘i⁄
 = 
USE_sûk_ªßm∂î_c›y
;

163 
S
->
övR©io_Q16
 = 
	`sûk_LSHIFT32
–
	`sûk_DIV32
–sûk_LSHIFT32–
Fs_Hz_ö
, 14 + 
up2x
 ), 
Fs_Hz_out
 ), 2 );

165  
	`sûk_SMULWW
–
S
->
övR©io_Q16
, 
Fs_Hz_out
 ) < 
	`sûk_LSHIFT32
–
Fs_Hz_ö
, 
up2x
 ) ) {

166 
S
->
övR©io_Q16
++;

170 
	}
}

174 
›us_öt
 
	$sûk_ªßm∂î
(

175 
sûk_ªßm∂î_°©e_°ru˘
 *
S
,

176 
›us_öt16
 
out
[],

177 c⁄° 
›us_öt16
 
ö
[],

178 
›us_öt32
 
öLí


181 
›us_öt
 
nSam∂es
;

184 
	`˚…_as£π
–
öLí
 >
S
->
Fs_ö_kHz
 );

186 
	`˚…_as£π
–
S
->
öputDñay
 <S->
Fs_ö_kHz
 );

188 
nSam∂es
 = 
S
->
Fs_ö_kHz
 - S->
öputDñay
;

191 
	`sûk_mem˝y
–&
S
->
dñayBuf
[ S->
öputDñay
 ], 
ö
, 
nSam∂es
 * –
›us_öt16
 ) );

193  
S
->
ªßm∂î_fun˘i⁄
 ) {

194 
USE_sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
:

195 
	`sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
–
S
, 
out
, S->
dñayBuf
, S->
Fs_ö_kHz
 );

196 
	`sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
–
S
, &
out
[ S->
Fs_out_kHz
 ], &
ö
[ 
nSam∂es
 ], 
öLí
 - S->
Fs_ö_kHz
 );

198 
USE_sûk_ªßm∂î_¥iv©e_IIR_FIR
:

199 
	`sûk_ªßm∂î_¥iv©e_IIR_FIR
–
S
, 
out
, S->
dñayBuf
, S->
Fs_ö_kHz
 );

200 
	`sûk_ªßm∂î_¥iv©e_IIR_FIR
–
S
, &
out
[ S->
Fs_out_kHz
 ], &
ö
[ 
nSam∂es
 ], 
öLí
 - S->
Fs_ö_kHz
 );

202 
USE_sûk_ªßm∂î_¥iv©e_down_FIR
:

203 
	`sûk_ªßm∂î_¥iv©e_down_FIR
–
S
, 
out
, S->
dñayBuf
, S->
Fs_ö_kHz
 );

204 
	`sûk_ªßm∂î_¥iv©e_down_FIR
–
S
, &
out
[ S->
Fs_out_kHz
 ], &
ö
[ 
nSam∂es
 ], 
öLí
 - S->
Fs_ö_kHz
 );

207 
	`sûk_mem˝y
–
out
, 
S
->
dñayBuf
, S->
Fs_ö_kHz
 * –
›us_öt16
 ) );

208 
	`sûk_mem˝y
–&
out
[ 
S
->
Fs_out_kHz
 ], &
ö
[ 
nSam∂es
 ], ( 
öLí
 - S->
Fs_ö_kHz
 ) * –
›us_öt16
 ) );

212 
	`sûk_mem˝y
–
S
->
dñayBuf
, &
ö
[ 
öLí
 - S->
öputDñay
 ], S->öputDñay * –
›us_öt16
 ) );

215 
	}
}

	@silk/resampler_down2.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_rom.h
"

36 
	$sûk_ªßm∂î_down2
(

37 
›us_öt32
 *
S
,

38 
›us_öt16
 *
out
,

39 c⁄° 
›us_öt16
 *
ö
,

40 
›us_öt32
 
öLí


43 
›us_öt32
 
k
, 
Àn2
 = 
	`sûk_RSHIFT32
–
öLí
, 1 );

44 
›us_öt32
 
ö32
, 
out32
, 
Y
, 
X
;

46 
	`˚…_as£π
–
sûk_ªßm∂î_down2_0
 > 0 );

47 
	`˚…_as£π
–
sûk_ªßm∂î_down2_1
 < 0 );

50  
k
 = 0; k < 
Àn2
; k++ ) {

52 
ö32
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
ö
[ 2 * 
k
 ], 10 );

55 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 0 ] );

56 
X
 = 
	`sûk_SMLAWB
–
Y
, Y, 
sûk_ªßm∂î_down2_1
 );

57 
out32
 = 
	`sûk_ADD32
–
S
[ 0 ], 
X
 );

58 
S
[ 0 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

61 
ö32
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
ö
[ 2 * 
k
 + 1 ], 10 );

64 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 1 ] );

65 
X
 = 
	`sûk_SMULWB
–
Y
, 
sûk_ªßm∂î_down2_0
 );

66 
out32
 = 
	`sûk_ADD32
–out32, 
S
[ 1 ] );

67 
out32
 = 
	`sûk_ADD32
–out32, 
X
 );

68 
S
[ 1 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

71 
out
[ 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
out32
, 11 ) );

73 
	}
}

	@silk/resampler_down2_3.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_¥iv©e.h
"

34 
	~"°ack_Æloc.h
"

36 
	#ORDER_FIR
 4

	)

39 
	$sûk_ªßm∂î_down2_3
(

40 
›us_öt32
 *
S
,

41 
›us_öt16
 *
out
,

42 c⁄° 
›us_öt16
 *
ö
,

43 
›us_öt32
 
öLí


46 
›us_öt32
 
nSam∂esIn
, 
cou¡î
, 
ªs_Q6
;

47 
	`VARDECL
–
›us_öt32
, 
buf
 );

48 
›us_öt32
 *
buf_±r
;

49 
SAVE_STACK
;

51 
	`ALLOC
–
buf
, 
RESAMPLER_MAX_BATCH_SIZE_IN
 + 
ORDER_FIR
, 
›us_öt32
 );

54 
	`sûk_mem˝y
–
buf
, 
S
, 
ORDER_FIR
 * –
›us_öt32
 ) );

58 
nSam∂esIn
 = 
	`sûk_mö
–
öLí
, 
RESAMPLER_MAX_BATCH_SIZE_IN
 );

61 
	`sûk_ªßm∂î_¥iv©e_AR2
–&
S
[ 
ORDER_FIR
 ], &
buf
[ ORDER_FIR ], 
ö
,

62 
sûk_Reßm∂î_2_3_COEFS_LQ
, 
nSam∂esIn
 );

65 
buf_±r
 = 
buf
;

66 
cou¡î
 = 
nSam∂esIn
;

67  
cou¡î
 > 2 ) {

69 
ªs_Q6
 = 
	`sûk_SMULWB
–
buf_±r
[ 0 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 2 ] );

70 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 1 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 3 ] );

71 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 2 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 5 ] );

72 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 3 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 4 ] );

75 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q6
, 6 ) );

77 
ªs_Q6
 = 
	`sûk_SMULWB
–
buf_±r
[ 1 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 4 ] );

78 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 2 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 5 ] );

79 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 3 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 3 ] );

80 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 4 ], 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 2 ] );

83 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q6
, 6 ) );

85 
buf_±r
 += 3;

86 
cou¡î
 -= 3;

89 
ö
 +
nSam∂esIn
;

90 
öLí
 -
nSam∂esIn
;

92 if–
öLí
 > 0 ) {

94 
	`sûk_mem˝y
–
buf
, &buf[ 
nSam∂esIn
 ], 
ORDER_FIR
 * –
›us_öt32
 ) );

101 
	`sûk_mem˝y
–
S
, &
buf
[ 
nSam∂esIn
 ], 
ORDER_FIR
 * –
›us_öt32
 ) );

102 
RESTORE_STACK
;

103 
	}
}

	@silk/resampler_private.h

28 #i‚de‡
SILK_RESAMPLER_PRIVATE_H


29 
	#SILK_RESAMPLER_PRIVATE_H


	)

31 #ifde‡
__˝lu•lus


35 
	~"SigProc_FIX.h
"

36 
	~"ªßm∂î_°ru˘s.h
"

37 
	~"ªßm∂î_rom.h
"

40 
	#RESAMPLER_MAX_BATCH_SIZE_MS
 10

	)

41 
	#RESAMPLER_MAX_FS_KHZ
 48

	)

42 
	#RESAMPLER_MAX_BATCH_SIZE_IN
 ( 
RESAMPLER_MAX_BATCH_SIZE_MS
 * 
RESAMPLER_MAX_FS_KHZ
 )

	)

45 
sûk_ªßm∂î_¥iv©e_IIR_FIR
(

46 *
SS
,

47 
›us_öt16
 
out
[],

48 c⁄° 
›us_öt16
 
ö
[],

49 
›us_öt32
 
öLí


53 
sûk_ªßm∂î_¥iv©e_down_FIR
(

54 *
SS
,

55 
›us_öt16
 
out
[],

56 c⁄° 
›us_öt16
 
ö
[],

57 
›us_öt32
 
öLí


61 
sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
(

62 *
SS
,

63 
›us_öt16
 *
out
,

64 c⁄° 
›us_öt16
 *
ö
,

65 
›us_öt32
 
Àn


69 
sûk_ªßm∂î_¥iv©e_up2_HQ
(

70 
›us_öt32
 *
S
,

71 
›us_öt16
 *
out
,

72 c⁄° 
›us_öt16
 *
ö
,

73 
›us_öt32
 
Àn


77 
sûk_ªßm∂î_¥iv©e_AR2
(

78 
›us_öt32
 
S
[],

79 
›us_öt32
 
out_Q8
[],

80 c⁄° 
›us_öt16
 
ö
[],

81 c⁄° 
›us_öt16
 
A_Q14
[],

82 
›us_öt32
 
Àn


85 #ifde‡
__˝lu•lus


	@silk/resampler_private_AR2.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_¥iv©e.h
"

36 
	$sûk_ªßm∂î_¥iv©e_AR2
(

37 
›us_öt32
 
S
[],

38 
›us_öt32
 
out_Q8
[],

39 c⁄° 
›us_öt16
 
ö
[],

40 c⁄° 
›us_öt16
 
A_Q14
[],

41 
›us_öt32
 
Àn


44 
›us_öt32
 
k
;

45 
›us_öt32
 
out32
;

47  
k
 = 0; k < 
Àn
; k++ ) {

48 
out32
 = 
	`sûk_ADD_LSHIFT32
–
S
[ 0 ], (
›us_öt32
)
ö
[ 
k
 ], 8 );

49 
out_Q8
[ 
k
 ] = 
out32
;

50 
out32
 = 
	`sûk_LSHIFT
( out32, 2 );

51 
S
[ 0 ] = 
	`sûk_SMLAWB
–S[ 1 ], 
out32
, 
A_Q14
[ 0 ] );

52 
S
[ 1 ] = 
	`sûk_SMULWB
–
out32
, 
A_Q14
[ 1 ] );

54 
	}
}

	@silk/resampler_private_IIR_FIR.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_¥iv©e.h
"

34 
	~"°ack_Æloc.h
"

36 
OPUS_INLINE
 
›us_öt16
 *
	$sûk_ªßm∂î_¥iv©e_IIR_FIR_INTERPOL
(

37 
›us_öt16
 *
out
,

38 
›us_öt16
 *
buf
,

39 
›us_öt32
 
max_ödex_Q16
,

40 
›us_öt32
 
ödex_ö¸emít_Q16


43 
›us_öt32
 
ödex_Q16
, 
ªs_Q15
;

44 
›us_öt16
 *
buf_±r
;

45 
›us_öt32
 
èbÀ_ödex
;

48  
ödex_Q16
 = 0; index_Q16 < 
max_ödex_Q16
; index_Q16 +
ödex_ö¸emít_Q16
 ) {

49 
èbÀ_ödex
 = 
	`sûk_SMULWB
–
ödex_Q16
 & 0xFFFF, 12 );

50 
buf_±r
 = &
buf
[ 
ödex_Q16
 >> 16 ];

52 
ªs_Q15
 = 
	`sûk_SMULBB
–
buf_±r
[ 0 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 
èbÀ_ödex
 ][ 0 ] );

53 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 1 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 
èbÀ_ödex
 ][ 1 ] );

54 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 2 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 
èbÀ_ödex
 ][ 2 ] );

55 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 3 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 
èbÀ_ödex
 ][ 3 ] );

56 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 4 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 11 - 
èbÀ_ödex
 ][ 3 ] );

57 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 5 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 11 - 
èbÀ_ödex
 ][ 2 ] );

58 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 6 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 11 - 
èbÀ_ödex
 ][ 1 ] );

59 
ªs_Q15
 = 
	`sûk_SMLABB
–ªs_Q15, 
buf_±r
[ 7 ], 
sûk_ªßm∂î_‰ac_FIR_12
[ 11 - 
èbÀ_ödex
 ][ 0 ] );

60 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q15
, 15 ) );

62  
out
;

63 
	}
}

65 
	$sûk_ªßm∂î_¥iv©e_IIR_FIR
(

66 *
SS
,

67 
›us_öt16
 
out
[],

68 c⁄° 
›us_öt16
 
ö
[],

69 
›us_öt32
 
öLí


72 
sûk_ªßm∂î_°©e_°ru˘
 *
S
 = (sûk_ªßm∂î_°©e_°ru˘ *)
SS
;

73 
›us_öt32
 
nSam∂esIn
;

74 
›us_öt32
 
max_ödex_Q16
, 
ödex_ö¸emít_Q16
;

75 
	`VARDECL
–
›us_öt16
, 
buf
 );

76 
SAVE_STACK
;

78 
	`ALLOC
–
buf
, 2 * 
S
->
b©chSize
 + 
RESAMPLER_ORDER_FIR_12
, 
›us_öt16
 );

81 
	`sûk_mem˝y
–
buf
, 
S
->
sFIR
.
i16
, 
RESAMPLER_ORDER_FIR_12
 * –
›us_öt16
 ) );

84 
ödex_ö¸emít_Q16
 = 
S
->
övR©io_Q16
;

86 
nSam∂esIn
 = 
	`sûk_mö
–
öLí
, 
S
->
b©chSize
 );

89 
	`sûk_ªßm∂î_¥iv©e_up2_HQ
–
S
->
sIIR
, &
buf
[ 
RESAMPLER_ORDER_FIR_12
 ], 
ö
, 
nSam∂esIn
 );

91 
max_ödex_Q16
 = 
	`sûk_LSHIFT32
–
nSam∂esIn
, 16 + 1 );

92 
out
 = 
	`sûk_ªßm∂î_¥iv©e_IIR_FIR_INTERPOL
–out, 
buf
, 
max_ödex_Q16
, 
ödex_ö¸emít_Q16
 );

93 
ö
 +
nSam∂esIn
;

94 
öLí
 -
nSam∂esIn
;

96 if–
öLí
 > 0 ) {

98 
	`sûk_mem˝y
–
buf
, &buf[ 
nSam∂esIn
 << 1 ], 
RESAMPLER_ORDER_FIR_12
 * –
›us_öt16
 ) );

105 
	`sûk_mem˝y
–
S
->
sFIR
.
i16
, &
buf
[ 
nSam∂esIn
 << 1 ], 
RESAMPLER_ORDER_FIR_12
 * –
›us_öt16
 ) );

106 
RESTORE_STACK
;

107 
	}
}

	@silk/resampler_private_down_FIR.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_¥iv©e.h
"

34 
	~"°ack_Æloc.h
"

36 
OPUS_INLINE
 
›us_öt16
 *
	$sûk_ªßm∂î_¥iv©e_down_FIR_INTERPOL
(

37 
›us_öt16
 *
out
,

38 
›us_öt32
 *
buf
,

39 c⁄° 
›us_öt16
 *
FIR_C€fs
,

40 
›us_öt
 
FIR_Ordî
,

41 
›us_öt
 
FIR_Føcs
,

42 
›us_öt32
 
max_ödex_Q16
,

43 
›us_öt32
 
ödex_ö¸emít_Q16


46 
›us_öt32
 
ödex_Q16
, 
ªs_Q6
;

47 
›us_öt32
 *
buf_±r
;

48 
›us_öt32
 
öãΩﬁ_öd
;

49 c⁄° 
›us_öt16
 *
öãΩﬁ_±r
;

51  
FIR_Ordî
 ) {

52 
RESAMPLER_DOWN_ORDER_FIR0
:

53  
ödex_Q16
 = 0; index_Q16 < 
max_ödex_Q16
; index_Q16 +
ödex_ö¸emít_Q16
 ) {

55 
buf_±r
 = 
buf
 + 
	`sûk_RSHIFT
–
ödex_Q16
, 16 );

58 
öãΩﬁ_öd
 = 
	`sûk_SMULWB
–
ödex_Q16
 & 0xFFFF, 
FIR_Føcs
 );

61 
öãΩﬁ_±r
 = &
FIR_C€fs
[ 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 * 
öãΩﬁ_öd
 ];

62 
ªs_Q6
 = 
	`sûk_SMULWB
–
buf_±r
[ 0 ], 
öãΩﬁ_±r
[ 0 ] );

63 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 1 ], 
öãΩﬁ_±r
[ 1 ] );

64 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 2 ], 
öãΩﬁ_±r
[ 2 ] );

65 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 3 ], 
öãΩﬁ_±r
[ 3 ] );

66 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 4 ], 
öãΩﬁ_±r
[ 4 ] );

67 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 5 ], 
öãΩﬁ_±r
[ 5 ] );

68 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 6 ], 
öãΩﬁ_±r
[ 6 ] );

69 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 7 ], 
öãΩﬁ_±r
[ 7 ] );

70 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 8 ], 
öãΩﬁ_±r
[ 8 ] );

71 
öãΩﬁ_±r
 = &
FIR_C€fs
[ 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 * ( 
FIR_Føcs
 - 1 - 
öãΩﬁ_öd
 ) ];

72 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 17 ], 
öãΩﬁ_±r
[ 0 ] );

73 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 16 ], 
öãΩﬁ_±r
[ 1 ] );

74 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 15 ], 
öãΩﬁ_±r
[ 2 ] );

75 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 14 ], 
öãΩﬁ_±r
[ 3 ] );

76 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 13 ], 
öãΩﬁ_±r
[ 4 ] );

77 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 12 ], 
öãΩﬁ_±r
[ 5 ] );

78 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 11 ], 
öãΩﬁ_±r
[ 6 ] );

79 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 10 ], 
öãΩﬁ_±r
[ 7 ] );

80 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
buf_±r
[ 9 ], 
öãΩﬁ_±r
[ 8 ] );

83 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q6
, 6 ) );

86 
RESAMPLER_DOWN_ORDER_FIR1
:

87  
ödex_Q16
 = 0; index_Q16 < 
max_ödex_Q16
; index_Q16 +
ödex_ö¸emít_Q16
 ) {

89 
buf_±r
 = 
buf
 + 
	`sûk_RSHIFT
–
ödex_Q16
, 16 );

92 
ªs_Q6
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
buf_±r
[ 0 ], buf_±r[ 23 ] ), 
FIR_C€fs
[ 0 ] );

93 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 1 ], buf_±r[ 22 ] ), 
FIR_C€fs
[ 1 ] );

94 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 2 ], buf_±r[ 21 ] ), 
FIR_C€fs
[ 2 ] );

95 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 3 ], buf_±r[ 20 ] ), 
FIR_C€fs
[ 3 ] );

96 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 4 ], buf_±r[ 19 ] ), 
FIR_C€fs
[ 4 ] );

97 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 5 ], buf_±r[ 18 ] ), 
FIR_C€fs
[ 5 ] );

98 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 6 ], buf_±r[ 17 ] ), 
FIR_C€fs
[ 6 ] );

99 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 7 ], buf_±r[ 16 ] ), 
FIR_C€fs
[ 7 ] );

100 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 8 ], buf_±r[ 15 ] ), 
FIR_C€fs
[ 8 ] );

101 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 9 ], buf_±r[ 14 ] ), 
FIR_C€fs
[ 9 ] );

102 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 10 ], buf_±r[ 13 ] ), 
FIR_C€fs
[ 10 ] );

103 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 11 ], buf_±r[ 12 ] ), 
FIR_C€fs
[ 11 ] );

106 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q6
, 6 ) );

109 
RESAMPLER_DOWN_ORDER_FIR2
:

110  
ödex_Q16
 = 0; index_Q16 < 
max_ödex_Q16
; index_Q16 +
ödex_ö¸emít_Q16
 ) {

112 
buf_±r
 = 
buf
 + 
	`sûk_RSHIFT
–
ödex_Q16
, 16 );

115 
ªs_Q6
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
buf_±r
[ 0 ], buf_±r[ 35 ] ), 
FIR_C€fs
[ 0 ] );

116 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 1 ], buf_±r[ 34 ] ), 
FIR_C€fs
[ 1 ] );

117 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 2 ], buf_±r[ 33 ] ), 
FIR_C€fs
[ 2 ] );

118 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 3 ], buf_±r[ 32 ] ), 
FIR_C€fs
[ 3 ] );

119 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 4 ], buf_±r[ 31 ] ), 
FIR_C€fs
[ 4 ] );

120 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 5 ], buf_±r[ 30 ] ), 
FIR_C€fs
[ 5 ] );

121 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 6 ], buf_±r[ 29 ] ), 
FIR_C€fs
[ 6 ] );

122 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 7 ], buf_±r[ 28 ] ), 
FIR_C€fs
[ 7 ] );

123 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 8 ], buf_±r[ 27 ] ), 
FIR_C€fs
[ 8 ] );

124 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 9 ], buf_±r[ 26 ] ), 
FIR_C€fs
[ 9 ] );

125 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 10 ], buf_±r[ 25 ] ), 
FIR_C€fs
[ 10 ] );

126 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 11 ], buf_±r[ 24 ] ), 
FIR_C€fs
[ 11 ] );

127 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 12 ], buf_±r[ 23 ] ), 
FIR_C€fs
[ 12 ] );

128 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 13 ], buf_±r[ 22 ] ), 
FIR_C€fs
[ 13 ] );

129 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 14 ], buf_±r[ 21 ] ), 
FIR_C€fs
[ 14 ] );

130 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 15 ], buf_±r[ 20 ] ), 
FIR_C€fs
[ 15 ] );

131 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 16 ], buf_±r[ 19 ] ), 
FIR_C€fs
[ 16 ] );

132 
ªs_Q6
 = 
	`sûk_SMLAWB
–ªs_Q6, 
	`sûk_ADD32
–
buf_±r
[ 17 ], buf_±r[ 18 ] ), 
FIR_C€fs
[ 17 ] );

135 *
out
++ = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
ªs_Q6
, 6 ) );

139 
	`˚…_as£π
( 0 );

141  
out
;

142 
	}
}

145 
	$sûk_ªßm∂î_¥iv©e_down_FIR
(

146 *
SS
,

147 
›us_öt16
 
out
[],

148 c⁄° 
›us_öt16
 
ö
[],

149 
›us_öt32
 
öLí


152 
sûk_ªßm∂î_°©e_°ru˘
 *
S
 = (sûk_ªßm∂î_°©e_°ru˘ *)
SS
;

153 
›us_öt32
 
nSam∂esIn
;

154 
›us_öt32
 
max_ödex_Q16
, 
ödex_ö¸emít_Q16
;

155 
	`VARDECL
–
›us_öt32
, 
buf
 );

156 c⁄° 
›us_öt16
 *
FIR_C€fs
;

157 
SAVE_STACK
;

159 
	`ALLOC
–
buf
, 
S
->
b©chSize
 + S->
FIR_Ordî
, 
›us_öt32
 );

162 
	`sûk_mem˝y
–
buf
, 
S
->
sFIR
.
i32
, S->
FIR_Ordî
 * –
›us_öt32
 ) );

164 
FIR_C€fs
 = &
S
->
C€fs
[ 2 ];

167 
ödex_ö¸emít_Q16
 = 
S
->
övR©io_Q16
;

169 
nSam∂esIn
 = 
	`sûk_mö
–
öLí
, 
S
->
b©chSize
 );

172 
	`sûk_ªßm∂î_¥iv©e_AR2
–
S
->
sIIR
, &
buf
[ S->
FIR_Ordî
 ], 
ö
, S->
C€fs
, 
nSam∂esIn
 );

174 
max_ödex_Q16
 = 
	`sûk_LSHIFT32
–
nSam∂esIn
, 16 );

177 
out
 = 
	`sûk_ªßm∂î_¥iv©e_down_FIR_INTERPOL
–out, 
buf
, 
FIR_C€fs
, 
S
->
FIR_Ordî
,

178 
S
->
FIR_Føcs
, 
max_ödex_Q16
, 
ödex_ö¸emít_Q16
 );

180 
ö
 +
nSam∂esIn
;

181 
öLí
 -
nSam∂esIn
;

183 if–
öLí
 > 1 ) {

185 
	`sûk_mem˝y
–
buf
, &buf[ 
nSam∂esIn
 ], 
S
->
FIR_Ordî
 * –
›us_öt32
 ) );

192 
	`sûk_mem˝y
–
S
->
sFIR
.
i32
, &
buf
[ 
nSam∂esIn
 ], S->
FIR_Ordî
 * –
›us_öt32
 ) );

193 
RESTORE_STACK
;

194 
	}
}

	@silk/resampler_private_up2_HQ.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"ªßm∂î_¥iv©e.h
"

38 
	$sûk_ªßm∂î_¥iv©e_up2_HQ
(

39 
›us_öt32
 *
S
,

40 
›us_öt16
 *
out
,

41 c⁄° 
›us_öt16
 *
ö
,

42 
›us_öt32
 
Àn


45 
›us_öt32
 
k
;

46 
›us_öt32
 
ö32
, 
out32_1
, 
out32_2
, 
Y
, 
X
;

48 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_0
[ 0 ] > 0 );

49 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_0
[ 1 ] > 0 );

50 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_0
[ 2 ] < 0 );

51 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_1
[ 0 ] > 0 );

52 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_1
[ 1 ] > 0 );

53 
	`sûk_as£π
–
sûk_ªßm∂î_up2_hq_1
[ 2 ] < 0 );

56  
k
 = 0; k < 
Àn
; k++ ) {

58 
ö32
 = 
	`sûk_LSHIFT
–(
›us_öt32
)
ö
[ 
k
 ], 10 );

61 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 0 ] );

62 
X
 = 
	`sûk_SMULWB
–
Y
, 
sûk_ªßm∂î_up2_hq_0
[ 0 ] );

63 
out32_1
 = 
	`sûk_ADD32
–
S
[ 0 ], 
X
 );

64 
S
[ 0 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

67 
Y
 = 
	`sûk_SUB32
–
out32_1
, 
S
[ 1 ] );

68 
X
 = 
	`sûk_SMULWB
–
Y
, 
sûk_ªßm∂î_up2_hq_0
[ 1 ] );

69 
out32_2
 = 
	`sûk_ADD32
–
S
[ 1 ], 
X
 );

70 
S
[ 1 ] = 
	`sûk_ADD32
–
out32_1
, 
X
 );

73 
Y
 = 
	`sûk_SUB32
–
out32_2
, 
S
[ 2 ] );

74 
X
 = 
	`sûk_SMLAWB
–
Y
, Y, 
sûk_ªßm∂î_up2_hq_0
[ 2 ] );

75 
out32_1
 = 
	`sûk_ADD32
–
S
[ 2 ], 
X
 );

76 
S
[ 2 ] = 
	`sûk_ADD32
–
out32_2
, 
X
 );

79 
out
[ 2 * 
k
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
out32_1
, 10 ) );

82 
Y
 = 
	`sûk_SUB32
–
ö32
, 
S
[ 3 ] );

83 
X
 = 
	`sûk_SMULWB
–
Y
, 
sûk_ªßm∂î_up2_hq_1
[ 0 ] );

84 
out32_1
 = 
	`sûk_ADD32
–
S
[ 3 ], 
X
 );

85 
S
[ 3 ] = 
	`sûk_ADD32
–
ö32
, 
X
 );

88 
Y
 = 
	`sûk_SUB32
–
out32_1
, 
S
[ 4 ] );

89 
X
 = 
	`sûk_SMULWB
–
Y
, 
sûk_ªßm∂î_up2_hq_1
[ 1 ] );

90 
out32_2
 = 
	`sûk_ADD32
–
S
[ 4 ], 
X
 );

91 
S
[ 4 ] = 
	`sûk_ADD32
–
out32_1
, 
X
 );

94 
Y
 = 
	`sûk_SUB32
–
out32_2
, 
S
[ 5 ] );

95 
X
 = 
	`sûk_SMLAWB
–
Y
, Y, 
sûk_ªßm∂î_up2_hq_1
[ 2 ] );

96 
out32_1
 = 
	`sûk_ADD32
–
S
[ 5 ], 
X
 );

97 
S
[ 5 ] = 
	`sûk_ADD32
–
out32_2
, 
X
 );

100 
out
[ 2 * 
k
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
out32_1
, 10 ) );

102 
	}
}

104 
	$sûk_ªßm∂î_¥iv©e_up2_HQ_wøµî
(

105 *
SS
,

106 
›us_öt16
 *
out
,

107 c⁄° 
›us_öt16
 *
ö
,

108 
›us_öt32
 
Àn


111 
sûk_ªßm∂î_°©e_°ru˘
 *
S
 = (sûk_ªßm∂î_°©e_°ru˘ *)
SS
;

112 
	`sûk_ªßm∂î_¥iv©e_up2_HQ
–
S
->
sIIR
, 
out
, 
ö
, 
Àn
 );

113 
	}
}

	@silk/resampler_rom.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

35 
	~"ªßm∂î_¥iv©e.h
"

43 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_3_4_COEFS
[ 2 + 3 * 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 ] = {

50 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_2_3_COEFS
[ 2 + 2 * 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 ] = {

56 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_1_2_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR1
 / 2 ] = {

61 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_1_3_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ] = {

66 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_1_4_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ] = {

71 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_1_6_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ] = {

76 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_Reßm∂î_2_3_COEFS_LQ
[ 2 + 2 * 2 ] = {

83 
sûk_DWORD_ALIGN
 c⁄° 
›us_öt16
 
	gsûk_ªßm∂î_‰ac_FIR_12
[ 12 ][ 
RESAMPLER_ORDER_FIR_12
 / 2 ] = {

	@silk/resampler_rom.h

28 #i‚de‡
SILK_FIX_RESAMPLER_ROM_H


29 
	#SILK_FIX_RESAMPLER_ROM_H


	)

31 #ifde‡ 
__˝lu•lus


36 
	~"ty≥def.h
"

37 
	~"ªßm∂î_°ru˘s.h
"

39 
	#RESAMPLER_DOWN_ORDER_FIR0
 18

	)

40 
	#RESAMPLER_DOWN_ORDER_FIR1
 24

	)

41 
	#RESAMPLER_DOWN_ORDER_FIR2
 36

	)

42 
	#RESAMPLER_ORDER_FIR_12
 8

	)

45 c⁄° 
›us_öt16
 
sûk_ªßm∂î_down2_0
 = 9872;

46 c⁄° 
›us_öt16
 
sûk_ªßm∂î_down2_1
 = 39809 - 65536;

49 c⁄° 
›us_öt16
 
sûk_ªßm∂î_up2_hq_0
[ 3 ] = { 1746, 14986, 39083 - 65536 };

50 c⁄° 
›us_öt16
 
sûk_ªßm∂î_up2_hq_1
[ 3 ] = { 6854, 25769, 55542 - 65536 };

53 c⁄° 
›us_öt16
 
sûk_Reßm∂î_3_4_COEFS
[ 2 + 3 * 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 ];

54 c⁄° 
›us_öt16
 
sûk_Reßm∂î_2_3_COEFS
[ 2 + 2 * 
RESAMPLER_DOWN_ORDER_FIR0
 / 2 ];

55 c⁄° 
›us_öt16
 
sûk_Reßm∂î_1_2_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR1
 / 2 ];

56 c⁄° 
›us_öt16
 
sûk_Reßm∂î_1_3_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ];

57 c⁄° 
›us_öt16
 
sûk_Reßm∂î_1_4_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ];

58 c⁄° 
›us_öt16
 
sûk_Reßm∂î_1_6_COEFS
[ 2 + 
RESAMPLER_DOWN_ORDER_FIR2
 / 2 ];

59 c⁄° 
›us_öt16
 
sûk_Reßm∂î_2_3_COEFS_LQ
[ 2 + 2 * 2 ];

62 c⁄° 
›us_öt16
 
sûk_ªßm∂î_‰ac_FIR_12
[ 12 ][ 
RESAMPLER_ORDER_FIR_12
 / 2 ];

64 #ifde‡ 
__˝lu•lus


	@silk/resampler_structs.h

28 #i‚de‡
SILK_RESAMPLER_STRUCTS_H


29 
	#SILK_RESAMPLER_STRUCTS_H


	)

31 #ifde‡
__˝lu•lus


35 
	#SILK_RESAMPLER_MAX_FIR_ORDER
 36

	)

36 
	#SILK_RESAMPLER_MAX_IIR_ORDER
 6

	)

38 
	s_sûk_ªßm∂î_°©e_°ru˘
{

39 
›us_öt32
 
sIIR
[ 
SILK_RESAMPLER_MAX_IIR_ORDER
 ];

41 
›us_öt32
 
i32
[ 
SILK_RESAMPLER_MAX_FIR_ORDER
 ];

42 
›us_öt16
 
i16
[ 
SILK_RESAMPLER_MAX_FIR_ORDER
 ];

43 } 
sFIR
;

44 
›us_öt16
 
dñayBuf
[ 48 ];

45 
›us_öt
 
ªßm∂î_fun˘i⁄
;

46 
›us_öt
 
b©chSize
;

47 
›us_öt32
 
övR©io_Q16
;

48 
›us_öt
 
FIR_Ordî
;

49 
›us_öt
 
FIR_Føcs
;

50 
›us_öt
 
Fs_ö_kHz
;

51 
›us_öt
 
Fs_out_kHz
;

52 
›us_öt
 
öputDñay
;

53 c⁄° 
›us_öt16
 *
C€fs
;

54 } 
	tsûk_ªßm∂î_°©e_°ru˘
;

56 #ifde‡
__˝lu•lus


	@silk/shell_coder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

36 
OPUS_INLINE
 
	$comböe_pul£s
(

37 
›us_öt
 *
out
,

38 c⁄° 
›us_öt
 *
ö
,

39 c⁄° 
›us_öt
 
Àn


42 
›us_öt
 
k
;

43  
k
 = 0; k < 
Àn
; k++ ) {

44 
out
[ 
k
 ] = 
ö
[ 2 * k ] + in[ 2 * k + 1 ];

46 
	}
}

48 
OPUS_INLINE
 
	$ícode_•lô
(

49 
ec_íc
 *
psR™geEnc
,

50 c⁄° 
›us_öt
 
p_chûd1
,

51 c⁄° 
›us_öt
 
p
,

52 c⁄° 
›us_uöt8
 *
shñl_èbÀ


55 if–
p
 > 0 ) {

56 
	`ec_íc_icdf
–
psR™geEnc
, 
p_chûd1
, &
shñl_èbÀ
[ 
sûk_shñl_code_èbÀ_off£ts
[ 
p
 ] ], 8 );

58 
	}
}

60 
OPUS_INLINE
 
	$decode_•lô
(

61 
›us_öt16
 *
p_chûd1
,

62 
›us_öt16
 *
p_chûd2
,

63 
ec_dec
 *
psR™geDec
,

64 c⁄° 
›us_öt
 
p
,

65 c⁄° 
›us_uöt8
 *
shñl_èbÀ


68 if–
p
 > 0 ) {

69 
p_chûd1
[ 0 ] = 
	`ec_dec_icdf
–
psR™geDec
, &
shñl_èbÀ
[ 
sûk_shñl_code_èbÀ_off£ts
[ 
p
 ] ], 8 );

70 
p_chûd2
[ 0 ] = 
p
 - 
p_chûd1
[ 0 ];

72 
p_chûd1
[ 0 ] = 0;

73 
p_chûd2
[ 0 ] = 0;

75 
	}
}

78 
	$sûk_shñl_ícodî
(

79 
ec_íc
 *
psR™geEnc
,

80 c⁄° 
›us_öt
 *
pul£s0


83 
›us_öt
 
pul£s1
[ 8 ], 
pul£s2
[ 4 ], 
pul£s3
[ 2 ], 
pul£s4
[ 1 ];

86 
	`sûk_as£π
–
SHELL_CODEC_FRAME_LENGTH
 == 16 );

89 
	`comböe_pul£s
–
pul£s1
, 
pul£s0
, 8 );

90 
	`comböe_pul£s
–
pul£s2
, 
pul£s1
, 4 );

91 
	`comböe_pul£s
–
pul£s3
, 
pul£s2
, 2 );

92 
	`comböe_pul£s
–
pul£s4
, 
pul£s3
, 1 );

94 
	`ícode_•lô
–
psR™geEnc
, 
pul£s3
[ 0 ], 
pul£s4
[ 0 ], 
sûk_shñl_code_èbÀ3
 );

96 
	`ícode_•lô
–
psR™geEnc
, 
pul£s2
[ 0 ], 
pul£s3
[ 0 ], 
sûk_shñl_code_èbÀ2
 );

98 
	`ícode_•lô
–
psR™geEnc
, 
pul£s1
[ 0 ], 
pul£s2
[ 0 ], 
sûk_shñl_code_èbÀ1
 );

99 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 0 ], 
pul£s1
[ 0 ], 
sûk_shñl_code_èbÀ0
 );

100 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 2 ], 
pul£s1
[ 1 ], 
sûk_shñl_code_èbÀ0
 );

102 
	`ícode_•lô
–
psR™geEnc
, 
pul£s1
[ 2 ], 
pul£s2
[ 1 ], 
sûk_shñl_code_èbÀ1
 );

103 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 4 ], 
pul£s1
[ 2 ], 
sûk_shñl_code_èbÀ0
 );

104 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 6 ], 
pul£s1
[ 3 ], 
sûk_shñl_code_èbÀ0
 );

106 
	`ícode_•lô
–
psR™geEnc
, 
pul£s2
[ 2 ], 
pul£s3
[ 1 ], 
sûk_shñl_code_èbÀ2
 );

108 
	`ícode_•lô
–
psR™geEnc
, 
pul£s1
[ 4 ], 
pul£s2
[ 2 ], 
sûk_shñl_code_èbÀ1
 );

109 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 8 ], 
pul£s1
[ 4 ], 
sûk_shñl_code_èbÀ0
 );

110 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 10 ], 
pul£s1
[ 5 ], 
sûk_shñl_code_èbÀ0
 );

112 
	`ícode_•lô
–
psR™geEnc
, 
pul£s1
[ 6 ], 
pul£s2
[ 3 ], 
sûk_shñl_code_èbÀ1
 );

113 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 12 ], 
pul£s1
[ 6 ], 
sûk_shñl_code_èbÀ0
 );

114 
	`ícode_•lô
–
psR™geEnc
, 
pul£s0
[ 14 ], 
pul£s1
[ 7 ], 
sûk_shñl_code_èbÀ0
 );

115 
	}
}

119 
	$sûk_shñl_decodî
(

120 
›us_öt16
 *
pul£s0
,

121 
ec_dec
 *
psR™geDec
,

122 c⁄° 
›us_öt
 
pul£s4


125 
›us_öt16
 
pul£s3
[ 2 ], 
pul£s2
[ 4 ], 
pul£s1
[ 8 ];

128 
	`sûk_as£π
–
SHELL_CODEC_FRAME_LENGTH
 == 16 );

130 
	`decode_•lô
–&
pul£s3
[ 0 ], &pul£s3[ 1 ], 
psR™geDec
, 
pul£s4
, 
sûk_shñl_code_èbÀ3
 );

132 
	`decode_•lô
–&
pul£s2
[ 0 ], &pul£s2[ 1 ], 
psR™geDec
, 
pul£s3
[ 0 ], 
sûk_shñl_code_èbÀ2
 );

134 
	`decode_•lô
–&
pul£s1
[ 0 ], &pul£s1[ 1 ], 
psR™geDec
, 
pul£s2
[ 0 ], 
sûk_shñl_code_èbÀ1
 );

135 
	`decode_•lô
–&
pul£s0
[ 0 ], &pul£s0[ 1 ], 
psR™geDec
, 
pul£s1
[ 0 ], 
sûk_shñl_code_èbÀ0
 );

136 
	`decode_•lô
–&
pul£s0
[ 2 ], &pul£s0[ 3 ], 
psR™geDec
, 
pul£s1
[ 1 ], 
sûk_shñl_code_èbÀ0
 );

138 
	`decode_•lô
–&
pul£s1
[ 2 ], &pul£s1[ 3 ], 
psR™geDec
, 
pul£s2
[ 1 ], 
sûk_shñl_code_èbÀ1
 );

139 
	`decode_•lô
–&
pul£s0
[ 4 ], &pul£s0[ 5 ], 
psR™geDec
, 
pul£s1
[ 2 ], 
sûk_shñl_code_èbÀ0
 );

140 
	`decode_•lô
–&
pul£s0
[ 6 ], &pul£s0[ 7 ], 
psR™geDec
, 
pul£s1
[ 3 ], 
sûk_shñl_code_èbÀ0
 );

142 
	`decode_•lô
–&
pul£s2
[ 2 ], &pul£s2[ 3 ], 
psR™geDec
, 
pul£s3
[ 1 ], 
sûk_shñl_code_èbÀ2
 );

144 
	`decode_•lô
–&
pul£s1
[ 4 ], &pul£s1[ 5 ], 
psR™geDec
, 
pul£s2
[ 2 ], 
sûk_shñl_code_èbÀ1
 );

145 
	`decode_•lô
–&
pul£s0
[ 8 ], &pul£s0[ 9 ], 
psR™geDec
, 
pul£s1
[ 4 ], 
sûk_shñl_code_èbÀ0
 );

146 
	`decode_•lô
–&
pul£s0
[ 10 ], &pul£s0[ 11 ], 
psR™geDec
, 
pul£s1
[ 5 ], 
sûk_shñl_code_èbÀ0
 );

148 
	`decode_•lô
–&
pul£s1
[ 6 ], &pul£s1[ 7 ], 
psR™geDec
, 
pul£s2
[ 3 ], 
sûk_shñl_code_èbÀ1
 );

149 
	`decode_•lô
–&
pul£s0
[ 12 ], &pul£s0[ 13 ], 
psR™geDec
, 
pul£s1
[ 6 ], 
sûk_shñl_code_èbÀ0
 );

150 
	`decode_•lô
–&
pul£s0
[ 14 ], &pul£s0[ 15 ], 
psR™geDec
, 
pul£s1
[ 7 ], 
sûk_shñl_code_èbÀ0
 );

151 
	}
}

	@silk/sigm_Q15.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

34 
	~"SigProc_FIX.h
"

37 c⁄° 
›us_öt32
 
	gsigm_LUT_¶›e_Q10
[ 6 ] = {

41 c⁄° 
›us_öt32
 
	gsigm_LUT_pos_Q15
[ 6 ] = {

45 c⁄° 
›us_öt32
 
	gsigm_LUT_√g_Q15
[ 6 ] = {

49 
›us_öt
 
	$sûk_sigm_Q15
(

50 
›us_öt
 
ö_Q5


53 
›us_öt
 
öd
;

55 if–
ö_Q5
 < 0 ) {

57 
ö_Q5
 = -in_Q5;

58 if–
ö_Q5
 >= 6 * 32 ) {

62 
öd
 = 
	`sûk_RSHIFT
–
ö_Q5
, 5 );

63 –
sigm_LUT_√g_Q15
[ 
öd
 ] - 
	`sûk_SMULBB
–
sigm_LUT_¶›e_Q10
[ ind ], 
ö_Q5
 & 0x1F ) );

67 if–
ö_Q5
 >= 6 * 32 ) {

71 
öd
 = 
	`sûk_RSHIFT
–
ö_Q5
, 5 );

72 –
sigm_LUT_pos_Q15
[ 
öd
 ] + 
	`sûk_SMULBB
–
sigm_LUT_¶›e_Q10
[ ind ], 
ö_Q5
 & 0x1F ) );

75 
	}
}

	@silk/sort.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

38 
	~"SigProc_FIX.h
"

40 
	$sûk_ö£πi⁄_s‹t_ö¸ósög
(

41 
›us_öt32
 *
a
,

42 
›us_öt
 *
idx
,

43 c⁄° 
›us_öt
 
L
,

44 c⁄° 
›us_öt
 
K


47 
›us_öt32
 
vÆue
;

48 
›us_öt
 
i
, 
j
;

51 
	`˚…_as£π
–
K
 > 0 );

52 
	`˚…_as£π
–
L
 > 0 );

53 
	`˚…_as£π
–
L
 >
K
 );

56  
i
 = 0; i < 
K
; i++ ) {

57 
idx
[ 
i
 ] = i;

61  
i
 = 1; i < 
K
; i++ ) {

62 
vÆue
 = 
a
[ 
i
 ];

63  
j
 = 
i
 - 1; ( j >0 ) && ( 
vÆue
 < 
a
[ j ] ); j-- ) {

64 
a
[ 
j
 + 1 ] =á[ j ];

65 
idx
[ 
j
 + 1 ] = idx[ j ];

67 
a
[ 
j
 + 1 ] = 
vÆue
;

68 
idx
[ 
j
 + 1 ] = 
i
;

73  
i
 = 
K
; i < 
L
; i++ ) {

74 
vÆue
 = 
a
[ 
i
 ];

75 if–
vÆue
 < 
a
[ 
K
 - 1 ] ) {

76  
j
 = 
K
 - 2; ( j >0 ) && ( 
vÆue
 < 
a
[ j ] ); j-- ) {

77 
a
[ 
j
 + 1 ] =á[ j ];

78 
idx
[ 
j
 + 1 ] = idx[ j ];

80 
a
[ 
j
 + 1 ] = 
vÆue
;

81 
idx
[ 
j
 + 1 ] = 
i
;

84 
	}
}

86 #ifde‡
FIXED_POINT


88 
	$sûk_ö£πi⁄_s‹t_de¸ósög_öt16
(

89 
›us_öt16
 *
a
,

90 
›us_öt
 *
idx
,

91 c⁄° 
›us_öt
 
L
,

92 c⁄° 
›us_öt
 
K


95 
›us_öt
 
i
, 
j
;

96 
›us_öt
 
vÆue
;

99 
	`˚…_as£π
–
K
 > 0 );

100 
	`˚…_as£π
–
L
 > 0 );

101 
	`˚…_as£π
–
L
 >
K
 );

104  
i
 = 0; i < 
K
; i++ ) {

105 
idx
[ 
i
 ] = i;

109  
i
 = 1; i < 
K
; i++ ) {

110 
vÆue
 = 
a
[ 
i
 ];

111  
j
 = 
i
 - 1; ( j >0 ) && ( 
vÆue
 > 
a
[ j ] ); j-- ) {

112 
a
[ 
j
 + 1 ] =á[ j ];

113 
idx
[ 
j
 + 1 ] = idx[ j ];

115 
a
[ 
j
 + 1 ] = 
vÆue
;

116 
idx
[ 
j
 + 1 ] = 
i
;

121  
i
 = 
K
; i < 
L
; i++ ) {

122 
vÆue
 = 
a
[ 
i
 ];

123 if–
vÆue
 > 
a
[ 
K
 - 1 ] ) {

124  
j
 = 
K
 - 2; ( j >0 ) && ( 
vÆue
 > 
a
[ j ] ); j-- ) {

125 
a
[ 
j
 + 1 ] =á[ j ];

126 
idx
[ 
j
 + 1 ] = idx[ j ];

128 
a
[ 
j
 + 1 ] = 
vÆue
;

129 
idx
[ 
j
 + 1 ] = 
i
;

132 
	}
}

135 
	$sûk_ö£πi⁄_s‹t_ö¸ósög_Æl_vÆues_öt16
(

136 
›us_öt16
 *
a
,

137 c⁄° 
›us_öt
 
L


140 
›us_öt
 
vÆue
;

141 
›us_öt
 
i
, 
j
;

144 
	`˚…_as£π
–
L
 > 0 );

147  
i
 = 1; i < 
L
; i++ ) {

148 
vÆue
 = 
a
[ 
i
 ];

149  
j
 = 
i
 - 1; ( j >0 ) && ( 
vÆue
 < 
a
[ j ] ); j-- ) {

150 
a
[ 
j
 + 1 ] =á[ j ];

152 
a
[ 
j
 + 1 ] = 
vÆue
;

154 
	}
}

	@silk/stereo_LR_to_MS.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

33 
	~"°ack_Æloc.h
"

36 
	$sûk_°îeo_LR_to_MS
(

37 
°îeo_íc_°©e
 *
°©e
,

38 
›us_öt16
 
x1
[],

39 
›us_öt16
 
x2
[],

40 
›us_öt8
 
ix
[ 2 ][ 3 ],

41 
›us_öt8
 *
mid_⁄ly_Êag
,

42 
›us_öt32
 
mid_side_øãs_bps
[],

43 
›us_öt32
 
tŸÆ_øã_bps
,

44 
›us_öt
 
¥ev_•ìch_a˘_Q8
,

45 
›us_öt
 
toM⁄o
,

46 
›us_öt
 
fs_kHz
,

47 
›us_öt
 
‰ame_Àngth


50 
›us_öt
 
n
, 
is10msFøme
, 
díom_Q16
, 
dñè0_Q13
, 
dñè1_Q13
;

51 
›us_öt32
 
sum
, 
diff
, 
smoŸh_c€f_Q16
, 
¥ed_Q13
[ 2 ], 
¥ed0_Q13
, 
¥ed1_Q13
;

52 
›us_öt32
 
LP_øtio_Q14
, 
HP_øtio_Q14
, 
‰ac_Q16
, 
‰ac_3_Q16
, 
mö_mid_øã_bps
, 
width_Q14
, 
w_Q24
, 
dñèw_Q24
;

53 
	`VARDECL
–
›us_öt16
, 
side
 );

54 
	`VARDECL
–
›us_öt16
, 
LP_mid
 );

55 
	`VARDECL
–
›us_öt16
, 
HP_mid
 );

56 
	`VARDECL
–
›us_öt16
, 
LP_side
 );

57 
	`VARDECL
–
›us_öt16
, 
HP_side
 );

58 
›us_öt16
 *
mid
 = &
x1
[ -2 ];

59 
SAVE_STACK
;

61 
	`ALLOC
–
side
, 
‰ame_Àngth
 + 2, 
›us_öt16
 );

63  
n
 = 0;Ç < 
‰ame_Àngth
 + 2;Ç++ ) {

64 
sum
 = 
x1
[ 
n
 - 2 ] + (
›us_öt32
)
x2
[Ç - 2 ];

65 
diff
 = 
x1
[ 
n
 - 2 ] - (
›us_öt32
)
x2
[Ç - 2 ];

66 
mid
[ 
n
 ] = (
›us_öt16
)
	`sûk_RSHIFT_ROUND
–
sum
, 1 );

67 
side
[ 
n
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
diff
, 1 ) );

71 
	`sûk_mem˝y
–
mid
, 
°©e
->
sMid
, 2 * –
›us_öt16
 ) );

72 
	`sûk_mem˝y
–
side
, 
°©e
->
sSide
, 2 * –
›us_öt16
 ) );

73 
	`sûk_mem˝y
–
°©e
->
sMid
, &
mid
[ 
‰ame_Àngth
 ], 2 * –
›us_öt16
 ) );

74 
	`sûk_mem˝y
–
°©e
->
sSide
, &
side
[ 
‰ame_Àngth
 ], 2 * –
›us_öt16
 ) );

77 
	`ALLOC
–
LP_mid
, 
‰ame_Àngth
, 
›us_öt16
 );

78 
	`ALLOC
–
HP_mid
, 
‰ame_Àngth
, 
›us_öt16
 );

79  
n
 = 0;Ç < 
‰ame_Àngth
;Ç++ ) {

80 
sum
 = 
	`sûk_RSHIFT_ROUND
–
	`sûk_ADD_LSHIFT
–
mid
[ 
n
 ] + (
›us_öt32
)mid[Ç + 2 ], mid[Ç + 1 ], 1 ), 2 );

81 
LP_mid
[ 
n
 ] = 
sum
;

82 
HP_mid
[ 
n
 ] = 
mid
[Ç + 1 ] - 
sum
;

86 
	`ALLOC
–
LP_side
, 
‰ame_Àngth
, 
›us_öt16
 );

87 
	`ALLOC
–
HP_side
, 
‰ame_Àngth
, 
›us_öt16
 );

88  
n
 = 0;Ç < 
‰ame_Àngth
;Ç++ ) {

89 
sum
 = 
	`sûk_RSHIFT_ROUND
–
	`sûk_ADD_LSHIFT
–
side
[ 
n
 ] + (
›us_öt32
)side[Ç + 2 ], side[Ç + 1 ], 1 ), 2 );

90 
LP_side
[ 
n
 ] = 
sum
;

91 
HP_side
[ 
n
 ] = 
side
[Ç + 1 ] - 
sum
;

95 
is10msFøme
 = 
‰ame_Àngth
 =10 * 
fs_kHz
;

96 
smoŸh_c€f_Q16
 = 
is10msFøme
 ?

97 
	`SILK_FIX_CONST
–
STEREO_RATIO_SMOOTH_COEF
 / 2, 16 ) :

98 
	`SILK_FIX_CONST
–
STEREO_RATIO_SMOOTH_COEF
, 16 );

99 
smoŸh_c€f_Q16
 = 
	`sûk_SMULWB
–
	`sûk_SMULBB
–
¥ev_•ìch_a˘_Q8
,Örev_speech_act_Q8 ), smooth_coef_Q16 );

101 
¥ed_Q13
[ 0 ] = 
	`sûk_°îeo_föd_¥edi˘‹
–&
LP_øtio_Q14
, 
LP_mid
, 
LP_side
, &
°©e
->
mid_side_amp_Q0
[ 0 ], 
‰ame_Àngth
, 
smoŸh_c€f_Q16
 );

102 
¥ed_Q13
[ 1 ] = 
	`sûk_°îeo_föd_¥edi˘‹
–&
HP_øtio_Q14
, 
HP_mid
, 
HP_side
, &
°©e
->
mid_side_amp_Q0
[ 2 ], 
‰ame_Àngth
, 
smoŸh_c€f_Q16
 );

104 
‰ac_Q16
 = 
	`sûk_SMLABB
–
HP_øtio_Q14
, 
LP_øtio_Q14
, 3 );

105 
‰ac_Q16
 = 
	`sûk_mö
–‰ac_Q16, 
	`SILK_FIX_CONST
( 1, 16 ) );

108 
tŸÆ_øã_bps
 -
is10msFøme
 ? 1200 : 600;

109 if–
tŸÆ_øã_bps
 < 1 ) {

110 
tŸÆ_øã_bps
 = 1;

112 
mö_mid_øã_bps
 = 
	`sûk_SMLABB
–2000, 
fs_kHz
, 600 );

113 
	`sûk_as£π
–
mö_mid_øã_bps
 < 32767 );

115 
‰ac_3_Q16
 = 
	`sûk_MUL
–3, 
‰ac_Q16
 );

116 
mid_side_øãs_bps
[ 0 ] = 
	`sûk_DIV32_v¨Q
–
tŸÆ_øã_bps
, 
	`SILK_FIX_CONST
–8 + 5, 16 ) + 
‰ac_3_Q16
, 16+3 );

118 if–
mid_side_øãs_bps
[ 0 ] < 
mö_mid_øã_bps
 ) {

119 
mid_side_øãs_bps
[ 0 ] = 
mö_mid_øã_bps
;

120 
mid_side_øãs_bps
[ 1 ] = 
tŸÆ_øã_bps
 - mid_side_rates_bps[ 0 ];

122 
width_Q14
 = 
	`sûk_DIV32_v¨Q
–
	`sûk_LSHIFT
–
mid_side_øãs_bps
[ 1 ], 1 ) - 
mö_mid_øã_bps
,

123 
	`sûk_SMULWB
–
	`SILK_FIX_CONST
–1, 16 ) + 
‰ac_3_Q16
, 
mö_mid_øã_bps
 ), 14+2 );

124 
width_Q14
 = 
	`sûk_LIMIT
–width_Q14, 0, 
	`SILK_FIX_CONST
( 1, 14 ) );

126 
mid_side_øãs_bps
[ 1 ] = 
tŸÆ_øã_bps
 - mid_side_rates_bps[ 0 ];

127 
width_Q14
 = 
	`SILK_FIX_CONST
( 1, 14 );

131 
°©e
->
smth_width_Q14
 = (
›us_öt16
)
	`sûk_SMLAWB
–°©e->smth_width_Q14, 
width_Q14
 - sèã->smth_width_Q14, 
smoŸh_c€f_Q16
 );

134 *
mid_⁄ly_Êag
 = 0;

135 if–
toM⁄o
 ) {

137 
width_Q14
 = 0;

138 
¥ed_Q13
[ 0 ] = 0;

139 
¥ed_Q13
[ 1 ] = 0;

140 
	`sûk_°îeo_qu™t_¥ed
–
¥ed_Q13
, 
ix
 );

141 } if–
°©e
->
width_¥ev_Q14
 == 0 &&

142 –8 * 
tŸÆ_øã_bps
 < 13 * 
mö_mid_øã_bps
 || 
	`sûk_SMULWB
–
‰ac_Q16
, 
°©e
->
smth_width_Q14
 ) < 
	`SILK_FIX_CONST
( 0.05, 14 ) ) )

146 
¥ed_Q13
[ 0 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 0 ] ), 14 );

147 
¥ed_Q13
[ 1 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 1 ] ), 14 );

148 
	`sûk_°îeo_qu™t_¥ed
–
¥ed_Q13
, 
ix
 );

150 
width_Q14
 = 0;

151 
¥ed_Q13
[ 0 ] = 0;

152 
¥ed_Q13
[ 1 ] = 0;

153 
mid_side_øãs_bps
[ 0 ] = 
tŸÆ_øã_bps
;

154 
mid_side_øãs_bps
[ 1 ] = 0;

155 *
mid_⁄ly_Êag
 = 1;

156 } if–
°©e
->
width_¥ev_Q14
 != 0 &&

157 –8 * 
tŸÆ_øã_bps
 < 11 * 
mö_mid_øã_bps
 || 
	`sûk_SMULWB
–
‰ac_Q16
, 
°©e
->
smth_width_Q14
 ) < 
	`SILK_FIX_CONST
( 0.02, 14 ) ) )

161 
¥ed_Q13
[ 0 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 0 ] ), 14 );

162 
¥ed_Q13
[ 1 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 1 ] ), 14 );

163 
	`sûk_°îeo_qu™t_¥ed
–
¥ed_Q13
, 
ix
 );

165 
width_Q14
 = 0;

166 
¥ed_Q13
[ 0 ] = 0;

167 
¥ed_Q13
[ 1 ] = 0;

168 } if–
°©e
->
smth_width_Q14
 > 
	`SILK_FIX_CONST
( 0.95, 14 ) ) {

170 
	`sûk_°îeo_qu™t_¥ed
–
¥ed_Q13
, 
ix
 );

171 
width_Q14
 = 
	`SILK_FIX_CONST
( 1, 14 );

174 
¥ed_Q13
[ 0 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 0 ] ), 14 );

175 
¥ed_Q13
[ 1 ] = 
	`sûk_RSHIFT
–
	`sûk_SMULBB
–
°©e
->
smth_width_Q14
,Öred_Q13[ 1 ] ), 14 );

176 
	`sûk_°îeo_qu™t_¥ed
–
¥ed_Q13
, 
ix
 );

177 
width_Q14
 = 
°©e
->
smth_width_Q14
;

181 if–*
mid_⁄ly_Êag
 == 1 ) {

182 
°©e
->
sûít_side_Àn
 +
‰ame_Àngth
 - 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
;

183 if–
°©e
->
sûít_side_Àn
 < 
LA_SHAPE_MS
 * 
fs_kHz
 ) {

184 *
mid_⁄ly_Êag
 = 0;

187 
°©e
->
sûít_side_Àn
 = 10000;

190 
°©e
->
sûít_side_Àn
 = 0;

193 if–*
mid_⁄ly_Êag
 =0 && 
mid_side_øãs_bps
[ 1 ] < 1 ) {

194 
mid_side_øãs_bps
[ 1 ] = 1;

195 
mid_side_øãs_bps
[ 0 ] = 
	`sûk_max_öt
–1, 
tŸÆ_øã_bps
 - mid_side_rates_bps[ 1 ]);

199 
¥ed0_Q13
 = -
°©e
->
¥ed_¥ev_Q13
[ 0 ];

200 
¥ed1_Q13
 = -
°©e
->
¥ed_¥ev_Q13
[ 1 ];

201 
w_Q24
 = 
	`sûk_LSHIFT
–
°©e
->
width_¥ev_Q14
, 10 );

202 
díom_Q16
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << 16, 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
 );

203 
dñè0_Q13
 = -
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULBB
–
¥ed_Q13
[ 0 ] - 
°©e
->
¥ed_¥ev_Q13
[ 0 ], 
díom_Q16
 ), 16 );

204 
dñè1_Q13
 = -
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULBB
–
¥ed_Q13
[ 1 ] - 
°©e
->
¥ed_¥ev_Q13
[ 1 ], 
díom_Q16
 ), 16 );

205 
dñèw_Q24
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–
width_Q14
 - 
°©e
->
width_¥ev_Q14
, 
díom_Q16
 ), 10 );

206  
n
 = 0;Ç < 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
;Ç++ ) {

207 
¥ed0_Q13
 +
dñè0_Q13
;

208 
¥ed1_Q13
 +
dñè1_Q13
;

209 
w_Q24
 +
dñèw_Q24
;

210 
sum
 = 
	`sûk_LSHIFT
–
	`sûk_ADD_LSHIFT
–
mid
[ 
n
 ] + (
›us_öt32
)mid[Ç + 2 ], mid[Ç + 1 ], 1 ), 9 );

211 
sum
 = 
	`sûk_SMLAWB
–
	`sûk_SMULWB
–
w_Q24
, 
side
[ 
n
 + 1 ] ), sum, 
¥ed0_Q13
 );

212 
sum
 = 
	`sûk_SMLAWB
–sum, 
	`sûk_LSHIFT
–(
›us_öt32
)
mid
[ 
n
 + 1 ], 11 ), 
¥ed1_Q13
 );

213 
x2
[ 
n
 - 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sum
, 8 ) );

216 
¥ed0_Q13
 = -
¥ed_Q13
[ 0 ];

217 
¥ed1_Q13
 = -
¥ed_Q13
[ 1 ];

218 
w_Q24
 = 
	`sûk_LSHIFT
–
width_Q14
, 10 );

219  
n
 = 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
;Ç < 
‰ame_Àngth
;Ç++ ) {

220 
sum
 = 
	`sûk_LSHIFT
–
	`sûk_ADD_LSHIFT
–
mid
[ 
n
 ] + (
›us_öt32
)mid[Ç + 2 ], mid[Ç + 1 ], 1 ), 9 );

221 
sum
 = 
	`sûk_SMLAWB
–
	`sûk_SMULWB
–
w_Q24
, 
side
[ 
n
 + 1 ] ), sum, 
¥ed0_Q13
 );

222 
sum
 = 
	`sûk_SMLAWB
–sum, 
	`sûk_LSHIFT
–(
›us_öt32
)
mid
[ 
n
 + 1 ], 11 ), 
¥ed1_Q13
 );

223 
x2
[ 
n
 - 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sum
, 8 ) );

225 
°©e
->
¥ed_¥ev_Q13
[ 0 ] = (
›us_öt16
)
¥ed_Q13
[ 0 ];

226 
°©e
->
¥ed_¥ev_Q13
[ 1 ] = (
›us_öt16
)
¥ed_Q13
[ 1 ];

227 
°©e
->
width_¥ev_Q14
 = (
›us_öt16
)
width_Q14
;

228 
RESTORE_STACK
;

229 
	}
}

	@silk/stereo_MS_to_LR.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_°îeo_MS_to_LR
(

36 
°îeo_dec_°©e
 *
°©e
,

37 
›us_öt16
 
x1
[],

38 
›us_öt16
 
x2
[],

39 c⁄° 
›us_öt32
 
¥ed_Q13
[],

40 
›us_öt
 
fs_kHz
,

41 
›us_öt
 
‰ame_Àngth


44 
›us_öt
 
n
, 
díom_Q16
, 
dñè0_Q13
, 
dñè1_Q13
;

45 
›us_öt32
 
sum
, 
diff
, 
¥ed0_Q13
, 
¥ed1_Q13
;

48 
	`sûk_mem˝y
–
x1
, 
°©e
->
sMid
, 2 * –
›us_öt16
 ) );

49 
	`sûk_mem˝y
–
x2
, 
°©e
->
sSide
, 2 * –
›us_öt16
 ) );

50 
	`sûk_mem˝y
–
°©e
->
sMid
, &
x1
[ 
‰ame_Àngth
 ], 2 * –
›us_öt16
 ) );

51 
	`sûk_mem˝y
–
°©e
->
sSide
, &
x2
[ 
‰ame_Àngth
 ], 2 * –
›us_öt16
 ) );

54 
¥ed0_Q13
 = 
°©e
->
¥ed_¥ev_Q13
[ 0 ];

55 
¥ed1_Q13
 = 
°©e
->
¥ed_¥ev_Q13
[ 1 ];

56 
díom_Q16
 = 
	`sûk_DIV32_16
–(
›us_öt32
)1 << 16, 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
 );

57 
dñè0_Q13
 = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULBB
–
¥ed_Q13
[ 0 ] - 
°©e
->
¥ed_¥ev_Q13
[ 0 ], 
díom_Q16
 ), 16 );

58 
dñè1_Q13
 = 
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULBB
–
¥ed_Q13
[ 1 ] - 
°©e
->
¥ed_¥ev_Q13
[ 1 ], 
díom_Q16
 ), 16 );

59  
n
 = 0;Ç < 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
;Ç++ ) {

60 
¥ed0_Q13
 +
dñè0_Q13
;

61 
¥ed1_Q13
 +
dñè1_Q13
;

62 
sum
 = 
	`sûk_LSHIFT
–
	`sûk_ADD_LSHIFT
–
x1
[ 
n
 ] + x1[Ç + 2 ], x1[Ç + 1 ], 1 ), 9 );

63 
sum
 = 
	`sûk_SMLAWB
–
	`sûk_LSHIFT
–(
›us_öt32
)
x2
[ 
n
 + 1 ], 8 ), sum, 
¥ed0_Q13
 );

64 
sum
 = 
	`sûk_SMLAWB
–sum, 
	`sûk_LSHIFT
–(
›us_öt32
)
x1
[ 
n
 + 1 ], 11 ), 
¥ed1_Q13
 );

65 
x2
[ 
n
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sum
, 8 ) );

67 
¥ed0_Q13
 = 
¥ed_Q13
[ 0 ];

68 
¥ed1_Q13
 = 
¥ed_Q13
[ 1 ];

69  
n
 = 
STEREO_INTERP_LEN_MS
 * 
fs_kHz
;Ç < 
‰ame_Àngth
;Ç++ ) {

70 
sum
 = 
	`sûk_LSHIFT
–
	`sûk_ADD_LSHIFT
–
x1
[ 
n
 ] + x1[Ç + 2 ], x1[Ç + 1 ], 1 ), 9 );

71 
sum
 = 
	`sûk_SMLAWB
–
	`sûk_LSHIFT
–(
›us_öt32
)
x2
[ 
n
 + 1 ], 8 ), sum, 
¥ed0_Q13
 );

72 
sum
 = 
	`sûk_SMLAWB
–sum, 
	`sûk_LSHIFT
–(
›us_öt32
)
x1
[ 
n
 + 1 ], 11 ), 
¥ed1_Q13
 );

73 
x2
[ 
n
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
sum
, 8 ) );

75 
°©e
->
¥ed_¥ev_Q13
[ 0 ] = 
¥ed_Q13
[ 0 ];

76 
°©e
->
¥ed_¥ev_Q13
[ 1 ] = 
¥ed_Q13
[ 1 ];

79  
n
 = 0;Ç < 
‰ame_Àngth
;Ç++ ) {

80 
sum
 = 
x1
[ 
n
 + 1 ] + (
›us_öt32
)
x2
[Ç + 1 ];

81 
diff
 = 
x1
[ 
n
 + 1 ] - (
›us_öt32
)
x2
[Ç + 1 ];

82 
x1
[ 
n
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
sum
 );

83 
x2
[ 
n
 + 1 ] = (
›us_öt16
)
	`sûk_SAT16
–
diff
 );

85 
	}
}

	@silk/stereo_decode_pred.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_°îeo_decode_¥ed
(

36 
ec_dec
 *
psR™geDec
,

37 
›us_öt32
 
¥ed_Q13
[]

40 
›us_öt
 
n
, 
ix
[ 2 ][ 3 ];

41 
›us_öt32
 
low_Q13
, 
°ï_Q13
;

44 
n
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_°îeo_¥ed_joöt_iCDF
, 8 );

45 
ix
[ 0 ][ 2 ] = 
	`sûk_DIV32_16
–
n
, 5 );

46 
ix
[ 1 ][ 2 ] = 
n
 - 5 * ix[ 0 ][ 2 ];

47  
n
 = 0;Ç < 2;Ç++ ) {

48 
ix
[ 
n
 ][ 0 ] = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_unif‹m3_iCDF
, 8 );

49 
ix
[ 
n
 ][ 1 ] = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_unif‹m5_iCDF
, 8 );

53  
n
 = 0;Ç < 2;Ç++ ) {

54 
ix
[ 
n
 ][ 0 ] += 3 * ix[Ç ][ 2 ];

55 
low_Q13
 = 
sûk_°îeo_¥ed_qu™t_Q13
[ 
ix
[ 
n
 ][ 0 ] ];

56 
°ï_Q13
 = 
	`sûk_SMULWB
–
sûk_°îeo_¥ed_qu™t_Q13
[ 
ix
[ 
n
 ][ 0 ] + 1 ] - 
low_Q13
,

57 
	`SILK_FIX_CONST
–0.5 / 
STEREO_QUANT_SUB_STEPS
, 16 ) );

58 
¥ed_Q13
[ 
n
 ] = 
	`sûk_SMLABB
–
low_Q13
, 
°ï_Q13
, 2 * 
ix
[Ç ][ 1 ] + 1 );

62 
¥ed_Q13
[ 0 ] -=Öred_Q13[ 1 ];

63 
	}
}

66 
	$sûk_°îeo_decode_mid_⁄ly
(

67 
ec_dec
 *
psR™geDec
,

68 
›us_öt
 *
decode_⁄ly_mid


72 *
decode_⁄ly_mid
 = 
	`ec_dec_icdf
–
psR™geDec
, 
sûk_°îeo_⁄ly_code_mid_iCDF
, 8 );

73 
	}
}

	@silk/stereo_encode_pred.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_°îeo_ícode_¥ed
(

36 
ec_íc
 *
psR™geEnc
,

37 
›us_öt8
 
ix
[ 2 ][ 3 ]

40 
›us_öt
 
n
;

43 
n
 = 5 * 
ix
[ 0 ][ 2 ] + ix[ 1 ][ 2 ];

44 
	`˚…_as£π
–
n
 < 25 );

45 
	`ec_íc_icdf
–
psR™geEnc
, 
n
, 
sûk_°îeo_¥ed_joöt_iCDF
, 8 );

46  
n
 = 0;Ç < 2;Ç++ ) {

47 
	`˚…_as£π
–
ix
[ 
n
 ][ 0 ] < 3 );

48 
	`˚…_as£π
–
ix
[ 
n
 ][ 1 ] < 
STEREO_QUANT_SUB_STEPS
 );

49 
	`ec_íc_icdf
–
psR™geEnc
, 
ix
[ 
n
 ][ 0 ], 
sûk_unif‹m3_iCDF
, 8 );

50 
	`ec_íc_icdf
–
psR™geEnc
, 
ix
[ 
n
 ][ 1 ], 
sûk_unif‹m5_iCDF
, 8 );

52 
	}
}

55 
	$sûk_°îeo_ícode_mid_⁄ly
(

56 
ec_íc
 *
psR™geEnc
,

57 
›us_öt8
 
mid_⁄ly_Êag


61 
	`ec_íc_icdf
–
psR™geEnc
, 
mid_⁄ly_Êag
, 
sûk_°îeo_⁄ly_code_mid_iCDF
, 8 );

62 
	}
}

	@silk/stereo_find_predictor.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
›us_öt32
 
	$sûk_°îeo_föd_¥edi˘‹
(

36 
›us_öt32
 *
øtio_Q14
,

37 c⁄° 
›us_öt16
 
x
[],

38 c⁄° 
›us_öt16
 
y
[],

39 
›us_öt32
 
mid_ªs_amp_Q0
[],

40 
›us_öt
 
Àngth
,

41 
›us_öt
 
smoŸh_c€f_Q16


44 
›us_öt
 
sˇÀ
, 
sˇÀ1
, 
sˇÀ2
;

45 
›us_öt32
 
ƒgx
, 
ƒgy
, 
c‹r
, 
¥ed_Q13
, 
¥ed2_Q10
;

48 
	`sûk_sum_sqr_shi·
–&
ƒgx
, &
sˇÀ1
, 
x
, 
Àngth
 );

49 
	`sûk_sum_sqr_shi·
–&
ƒgy
, &
sˇÀ2
, 
y
, 
Àngth
 );

50 
sˇÀ
 = 
	`sûk_max_öt
–
sˇÀ1
, 
sˇÀ2
 );

51 
sˇÀ
 = scale + ( scale & 1 );

52 
ƒgy
 = 
	`sûk_RSHIFT32
–ƒgy, 
sˇÀ
 - 
sˇÀ2
 );

53 
ƒgx
 = 
	`sûk_RSHIFT32
–ƒgx, 
sˇÀ
 - 
sˇÀ1
 );

54 
ƒgx
 = 
	`sûk_max_öt
(Çrgx, 1 );

55 
c‹r
 = 
	`sûk_ö√r_¥od_Æig√d_sˇÀ
–
x
, 
y
, 
sˇÀ
, 
Àngth
 );

56 
¥ed_Q13
 = 
	`sûk_DIV32_v¨Q
–
c‹r
, 
ƒgx
, 13 );

57 
¥ed_Q13
 = 
	`sûk_LIMIT
(Öred_Q13, -(1 << 14), 1 << 14 );

58 
¥ed2_Q10
 = 
	`sûk_SMULWB
–
¥ed_Q13
,Öred_Q13 );

61 
smoŸh_c€f_Q16
 = (
›us_öt
)
	`sûk_max_öt
–smoŸh_c€f_Q16, 
	`sûk_abs
–
¥ed2_Q10
 ) );

64 
	`sûk_as£π
–
smoŸh_c€f_Q16
 < 32768 );

65 
sˇÀ
 = 
	`sûk_RSHIFT
( scale, 1 );

66 
mid_ªs_amp_Q0
[ 0 ] = 
	`sûk_SMLAWB
–mid_ªs_amp_Q0[ 0 ], 
	`sûk_LSHIFT
–
	`sûk_SQRT_APPROX
–
ƒgx
 ), 
sˇÀ
 ) - mid_res_amp_Q0[ 0 ],

67 
smoŸh_c€f_Q16
 );

69 
ƒgy
 = 
	`sûk_SUB_LSHIFT32
–ƒgy, 
	`sûk_SMULWB
–
c‹r
, 
¥ed_Q13
 ), 3 + 1 );

70 
ƒgy
 = 
	`sûk_ADD_LSHIFT32
–ƒgy, 
	`sûk_SMULWB
–
ƒgx
, 
¥ed2_Q10
 ), 6 );

71 
mid_ªs_amp_Q0
[ 1 ] = 
	`sûk_SMLAWB
–mid_ªs_amp_Q0[ 1 ], 
	`sûk_LSHIFT
–
	`sûk_SQRT_APPROX
–
ƒgy
 ), 
sˇÀ
 ) - mid_res_amp_Q0[ 1 ],

72 
smoŸh_c€f_Q16
 );

75 *
øtio_Q14
 = 
	`sûk_DIV32_v¨Q
–
mid_ªs_amp_Q0
[ 1 ], 
	`sûk_max
( mid_res_amp_Q0[ 0 ], 1 ), 14 );

76 *
øtio_Q14
 = 
	`sûk_LIMIT
( *ratio_Q14, 0, 32767 );

78  
¥ed_Q13
;

79 
	}
}

	@silk/stereo_quant_pred.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"maö.h
"

35 
	$sûk_°îeo_qu™t_¥ed
(

36 
›us_öt32
 
¥ed_Q13
[],

37 
›us_öt8
 
ix
[ 2 ][ 3 ]

40 
›us_öt
 
i
, 
j
, 
n
;

41 
›us_öt32
 
low_Q13
, 
°ï_Q13
, 
lvl_Q13
, 
îr_mö_Q13
, 
îr_Q13
, 
qu™t_¥ed_Q13
 = 0;

44  
n
 = 0;Ç < 2;Ç++ ) {

46 
îr_mö_Q13
 = 
sûk_öt32_MAX
;

47  
i
 = 0; i < 
STEREO_QUANT_TAB_SIZE
 - 1; i++ ) {

48 
low_Q13
 = 
sûk_°îeo_¥ed_qu™t_Q13
[ 
i
 ];

49 
°ï_Q13
 = 
	`sûk_SMULWB
–
sûk_°îeo_¥ed_qu™t_Q13
[ 
i
 + 1 ] - 
low_Q13
,

50 
	`SILK_FIX_CONST
–0.5 / 
STEREO_QUANT_SUB_STEPS
, 16 ) );

51  
j
 = 0; j < 
STEREO_QUANT_SUB_STEPS
; j++ ) {

52 
lvl_Q13
 = 
	`sûk_SMLABB
–
low_Q13
, 
°ï_Q13
, 2 * 
j
 + 1 );

53 
îr_Q13
 = 
	`sûk_abs
–
¥ed_Q13
[ 
n
 ] - 
lvl_Q13
 );

54 if–
îr_Q13
 < 
îr_mö_Q13
 ) {

55 
îr_mö_Q13
 = 
îr_Q13
;

56 
qu™t_¥ed_Q13
 = 
lvl_Q13
;

57 
ix
[ 
n
 ][ 0 ] = 
i
;

58 
ix
[ 
n
 ][ 1 ] = 
j
;

61 
d⁄e
;

65 
d⁄e
:

66 
ix
[ 
n
 ][ 2 ] = 
	`sûk_DIV32_16
( ix[Ç ][ 0 ], 3 );

67 
ix
[ 
n
 ][ 0 ] -= ix[Ç ][ 2 ] * 3;

68 
¥ed_Q13
[ 
n
 ] = 
qu™t_¥ed_Q13
;

72 
¥ed_Q13
[ 0 ] -=Öred_Q13[ 1 ];

73 
	}
}

	@silk/structs.h

28 #i‚de‡
SILK_STRUCTS_H


29 
	#SILK_STRUCTS_H


	)

31 
	~"ty≥def.h
"

32 
	~"SigProc_FIX.h
"

33 
	~"deföe.h
"

34 
	~"íãnc.h
"

35 
	~"ítdec.h
"

37 #ifde‡
__˝lu•lus


46 
›us_öt16
 
xq
[ 2 * 
MAX_FRAME_LENGTH
 ];

47 
›us_öt32
 
sLTP_shp_Q14
[ 2 * 
MAX_FRAME_LENGTH
 ];

48 
›us_öt32
 
sLPC_Q14
[ 
MAX_SUB_FRAME_LENGTH
 + 
NSQ_LPC_BUF_LENGTH
 ];

49 
›us_öt32
 
sAR2_Q14
[ 
MAX_SHAPE_LPC_ORDER
 ];

50 
›us_öt32
 
sLF_AR_shp_Q14
;

51 
›us_öt32
 
sDiff_shp_Q14
;

52 
›us_öt
 
œgPªv
;

53 
›us_öt
 
sLTP_buf_idx
;

54 
›us_öt
 
sLTP_shp_buf_idx
;

55 
›us_öt32
 
ønd_£ed
;

56 
›us_öt32
 
¥ev_gaö_Q16
;

57 
›us_öt
 
ªwhôe_Êag
;

58 } 
	tsûk_nsq_°©e
;

64 
›us_öt32
 
A«Sèã
[ 2 ];

65 
›us_öt32
 
A«Sèã1
[ 2 ];

66 
›us_öt32
 
A«Sèã2
[ 2 ];

67 
›us_öt32
 
XƒgSub‰
[ 
VAD_N_BANDS
 ];

68 
›us_öt32
 
NrgR©ioSmth_Q8
[ 
VAD_N_BANDS
 ];

69 
›us_öt16
 
HP°©e
;

70 
›us_öt32
 
NL
[ 
VAD_N_BANDS
 ];

71 
›us_öt32
 
öv_NL
[ 
VAD_N_BANDS
 ];

72 
›us_öt32
 
Noi£LevñBüs
[ 
VAD_N_BANDS
 ];

73 
›us_öt32
 
cou¡î
;

74 } 
	tsûk_VAD_°©e
;

78 
›us_öt32
 
In_LP_Sèã
[ 2 ];

79 
›us_öt32
 
å™sôi⁄_‰ame_no
;

80 
›us_öt
 
mode
;

81 
›us_öt32
 
ßved_fs_kHz
;

82 } 
	tsûk_LP_°©e
;

86 c⁄° 
›us_öt16
 
nVe˘‹s
;

87 c⁄° 
›us_öt16
 
‹dî
;

88 c⁄° 
›us_öt16
 
qu™tSãpSize_Q16
;

89 c⁄° 
›us_öt16
 
övQu™tSãpSize_Q6
;

90 c⁄° 
›us_uöt8
 *
CB1_NLSF_Q8
;

91 c⁄° 
›us_öt16
 *
CB1_Wght_Q9
;

92 c⁄° 
›us_uöt8
 *
CB1_iCDF
;

93 c⁄° 
›us_uöt8
 *
¥ed_Q8
;

94 c⁄° 
›us_uöt8
 *
ec_£l
;

95 c⁄° 
›us_uöt8
 *
ec_iCDF
;

96 c⁄° 
›us_uöt8
 *
ec_R©es_Q5
;

97 c⁄° 
›us_öt16
 *
dñèMö_Q15
;

98 } 
	tsûk_NLSF_CB_°ru˘
;

101 
›us_öt16
 
¥ed_¥ev_Q13
[ 2 ];

102 
›us_öt16
 
sMid
[ 2 ];

103 
›us_öt16
 
sSide
[ 2 ];

104 
›us_öt32
 
mid_side_amp_Q0
[ 4 ];

105 
›us_öt16
 
smth_width_Q14
;

106 
›us_öt16
 
width_¥ev_Q14
;

107 
›us_öt16
 
sûít_side_Àn
;

108 
›us_öt8
 
¥edIx
[ 
MAX_FRAMES_PER_PACKET
 ][ 2 ][ 3 ];

109 
›us_öt8
 
mid_⁄ly_Êags
[ 
MAX_FRAMES_PER_PACKET
 ];

110 } 
	t°îeo_íc_°©e
;

113 
›us_öt16
 
¥ed_¥ev_Q13
[ 2 ];

114 
›us_öt16
 
sMid
[ 2 ];

115 
›us_öt16
 
sSide
[ 2 ];

116 } 
	t°îeo_dec_°©e
;

119 
›us_öt8
 
GaösIndi˚s
[ 
MAX_NB_SUBFR
 ];

120 
›us_öt8
 
LTPIndex
[ 
MAX_NB_SUBFR
 ];

121 
›us_öt8
 
NLSFIndi˚s
[ 
MAX_LPC_ORDER
 + 1 ];

122 
›us_öt16
 
œgIndex
;

123 
›us_öt8
 
c⁄tourIndex
;

124 
›us_öt8
 
sig«lTy≥
;

125 
›us_öt8
 
qu™tOff£tTy≥
;

126 
›us_öt8
 
NLSFI¡îpC€f_Q2
;

127 
›us_öt8
 
PERIndex
;

128 
›us_öt8
 
LTP_sˇÀIndex
;

129 
›us_öt8
 
Sìd
;

130 } 
	tSideInfoIndi˚s
;

136 
›us_öt32
 
In_HP_Sèã
[ 2 ];

137 
›us_öt32
 
v¨übÀ_HP_smth1_Q15
;

138 
›us_öt32
 
v¨übÀ_HP_smth2_Q15
;

139 
sûk_LP_°©e
 
sLP
;

140 
sûk_VAD_°©e
 
sVAD
;

141 
sûk_nsq_°©e
 
sNSQ
;

142 
›us_öt16
 
¥ev_NLSFq_Q15
[ 
MAX_LPC_ORDER
 ];

143 
›us_öt
 
•ìch_a˘ivôy_Q8
;

144 
›us_öt
 
Ælow_b™dwidth_swôch
;

145 
›us_öt8
 
LBRR¥evLa°GaöIndex
;

146 
›us_öt8
 
¥evSig«lTy≥
;

147 
›us_öt
 
¥evLag
;

148 
›us_öt
 
pôch_LPC_wö_Àngth
;

149 
›us_öt
 
max_pôch_œg
;

150 
›us_öt32
 
API_fs_Hz
;

151 
›us_öt32
 
¥ev_API_fs_Hz
;

152 
›us_öt
 
maxI¡î«l_fs_Hz
;

153 
›us_öt
 
möI¡î«l_fs_Hz
;

154 
›us_öt
 
desúedI¡î«l_fs_Hz
;

155 
›us_öt
 
fs_kHz
;

156 
›us_öt
 
nb_sub‰
;

157 
›us_öt
 
‰ame_Àngth
;

158 
›us_öt
 
sub‰_Àngth
;

159 
›us_öt
 
…p_mem_Àngth
;

160 
›us_öt
 
œ_pôch
;

161 
›us_öt
 
œ_sh≠e
;

162 
›us_öt
 
sh≠eWöLígth
;

163 
›us_öt32
 
T¨gëR©e_bps
;

164 
›us_öt
 
PackëSize_ms
;

165 
›us_öt
 
PackëLoss_≥rc
;

166 
›us_öt32
 
‰ameCou¡î
;

167 
›us_öt
 
Com∂exôy
;

168 
›us_öt
 
nSèãsDñayedDecisi⁄
;

169 
›us_öt
 
u£I¡îpﬁ©edNLSFs
;

170 
›us_öt
 
sh≠ögLPCOrdî
;

171 
›us_öt
 
¥edi˘LPCOrdî
;

172 
›us_öt
 
pôchE°im©i⁄Com∂exôy
;

173 
›us_öt
 
pôchE°im©i⁄LPCOrdî
;

174 
›us_öt32
 
pôchE°im©i⁄Thªshﬁd_Q16
;

175 
›us_öt32
 
sum_log_gaö_Q7
;

176 
›us_öt
 
NLSF_MSVQ_Surviv‹s
;

177 
›us_öt
 
fú°_‰ame_a·î_ª£t
;

178 
›us_öt
 
c⁄åﬁÀd_sö˚_œ°_∑ylﬂd
;

179 
›us_öt
 
w¨pög_Q16
;

180 
›us_öt
 
u£CBR
;

181 
›us_öt
 
¥efûlFœg
;

182 c⁄° 
›us_uöt8
 *
pôch_œg_low_bôs_iCDF
;

183 c⁄° 
›us_uöt8
 *
pôch_c⁄tour_iCDF
;

184 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
;

185 
›us_öt
 
öput_quÆôy_b™ds_Q15
[ 
VAD_N_BANDS
 ];

186 
›us_öt
 
öput_tût_Q15
;

187 
›us_öt
 
SNR_dB_Q7
;

189 
›us_öt8
 
VAD_Êags
[ 
MAX_FRAMES_PER_PACKET
 ];

190 
›us_öt8
 
LBRR_Êag
;

191 
›us_öt
 
LBRR_Êags
[ 
MAX_FRAMES_PER_PACKET
 ];

193 
SideInfoIndi˚s
 
ödi˚s
;

194 
›us_öt8
 
pul£s
[ 
MAX_FRAME_LENGTH
 ];

196 
¨ch
;

199 
›us_öt16
 
öputBuf
[ 
MAX_FRAME_LENGTH
 + 2 ];

200 
›us_öt
 
öputBufIx
;

201 
›us_öt
 
nFømesPîPackë
;

202 
›us_öt
 
nFømesEncoded
;

204 
›us_öt
 
nCh™√lsAPI
;

205 
›us_öt
 
nCh™√lsI¡î«l
;

206 
›us_öt
 
ch™√lNb
;

209 
›us_öt
 
‰ames_sö˚_⁄£t
;

212 
›us_öt
 
ec_¥evSig«lTy≥
;

213 
›us_öt16
 
ec_¥evLagIndex
;

215 
sûk_ªßm∂î_°©e_°ru˘
 
ªßm∂î_°©e
;

218 
›us_öt
 
u£DTX
;

219 
›us_öt
 
öDTX
;

220 
›us_öt
 
noS≥echCou¡î
;

223 
›us_öt
 
u£InB™dFEC
;

224 
›us_öt
 
LBRR_íabÀd
;

225 
›us_öt
 
LBRR_GaöIn¸ó£s
;

226 
SideInfoIndi˚s
 
ödi˚s_LBRR
[ 
MAX_FRAMES_PER_PACKET
 ];

227 
›us_öt8
 
pul£s_LBRR
[ 
MAX_FRAMES_PER_PACKET
 ][ 
MAX_FRAME_LENGTH
 ];

228 } 
	tsûk_ícodî_°©e
;

233 
›us_öt32
 
pôchL_Q8
;

234 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 ];

235 
›us_öt16
 
¥evLPC_Q12
[ 
MAX_LPC_ORDER
 ];

236 
›us_öt
 
œ°_‰ame_lo°
;

237 
›us_öt32
 
ønd_£ed
;

238 
›us_öt16
 
øndSˇÀ_Q14
;

239 
›us_öt32
 
c⁄c_íîgy
;

240 
›us_öt
 
c⁄c_íîgy_shi·
;

241 
›us_öt16
 
¥evLTP_sˇÀ_Q14
;

242 
›us_öt32
 
¥evGaö_Q16
[ 2 ];

243 
›us_öt
 
fs_kHz
;

244 
›us_öt
 
nb_sub‰
;

245 
›us_öt
 
sub‰_Àngth
;

246 } 
	tsûk_PLC_°ru˘
;

250 
›us_öt32
 
CNG_exc_buf_Q14
[ 
MAX_FRAME_LENGTH
 ];

251 
›us_öt16
 
CNG_smth_NLSF_Q15
[ 
MAX_LPC_ORDER
 ];

252 
›us_öt32
 
CNG_sy¡h_°©e
[ 
MAX_LPC_ORDER
 ];

253 
›us_öt32
 
CNG_smth_Gaö_Q16
;

254 
›us_öt32
 
ønd_£ed
;

255 
›us_öt
 
fs_kHz
;

256 } 
	tsûk_CNG_°ru˘
;

262 
›us_öt32
 
¥ev_gaö_Q16
;

263 
›us_öt32
 
exc_Q14
[ 
MAX_FRAME_LENGTH
 ];

264 
›us_öt32
 
sLPC_Q14_buf
[ 
MAX_LPC_ORDER
 ];

265 
›us_öt16
 
outBuf
[ 
MAX_FRAME_LENGTH
 + 2 * 
MAX_SUB_FRAME_LENGTH
 ];

266 
›us_öt
 
œgPªv
;

267 
›us_öt8
 
La°GaöIndex
;

268 
›us_öt
 
fs_kHz
;

269 
›us_öt32
 
fs_API_hz
;

270 
›us_öt
 
nb_sub‰
;

271 
›us_öt
 
‰ame_Àngth
;

272 
›us_öt
 
sub‰_Àngth
;

273 
›us_öt
 
…p_mem_Àngth
;

274 
›us_öt
 
LPC_‹dî
;

275 
›us_öt16
 
¥evNLSF_Q15
[ 
MAX_LPC_ORDER
 ];

276 
›us_öt
 
fú°_‰ame_a·î_ª£t
;

277 c⁄° 
›us_uöt8
 *
pôch_œg_low_bôs_iCDF
;

278 c⁄° 
›us_uöt8
 *
pôch_c⁄tour_iCDF
;

281 
›us_öt
 
nFømesDecoded
;

282 
›us_öt
 
nFømesPîPackë
;

285 
›us_öt
 
ec_¥evSig«lTy≥
;

286 
›us_öt16
 
ec_¥evLagIndex
;

288 
›us_öt
 
VAD_Êags
[ 
MAX_FRAMES_PER_PACKET
 ];

289 
›us_öt
 
LBRR_Êag
;

290 
›us_öt
 
LBRR_Êags
[ 
MAX_FRAMES_PER_PACKET
 ];

292 
sûk_ªßm∂î_°©e_°ru˘
 
ªßm∂î_°©e
;

294 c⁄° 
sûk_NLSF_CB_°ru˘
 *
psNLSF_CB
;

297 
SideInfoIndi˚s
 
ödi˚s
;

300 
sûk_CNG_°ru˘
 
sCNG
;

303 
›us_öt
 
lossC¡
;

304 
›us_öt
 
¥evSig«lTy≥
;

305 
¨ch
;

307 
sûk_PLC_°ru˘
 
sPLC
;

309 } 
	tsûk_decodî_°©e
;

316 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ];

317 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ];

319 
sûk_DWORD_ALIGN
 
›us_öt16
 
PªdC€f_Q12
[ 2 ][ 
MAX_LPC_ORDER
 ];

320 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ];

321 
›us_öt
 
LTP_sˇÀ_Q14
;

322 } 
	tsûk_decodî_c⁄åﬁ
;

325 #ifde‡
__˝lu•lus


	@silk/sum_sqr_shift.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"SigProc_FIX.h
"

36 
	$sûk_sum_sqr_shi·
(

37 
›us_öt32
 *
íîgy
,

38 
›us_öt
 *
shi·
,

39 c⁄° 
›us_öt16
 *
x
,

40 
›us_öt
 
Àn


43 
›us_öt
 
i
, 
sh·
;

44 
›us_uöt32
 
ƒg_tmp
;

45 
›us_öt32
 
ƒg
;

48 
sh·
 = 31-
	`sûk_CLZ32
(
Àn
);

50 
ƒg
 = 
Àn
;

51  
i
 = 0; i < 
Àn
 - 1; i += 2 ) {

52 
ƒg_tmp
 = 
	`sûk_SMULBB
–
x
[ 
i
 ], x[ i ] );

53 
ƒg_tmp
 = 
	`sûk_SMLABB_ovÊw
–ƒg_tmp, 
x
[ 
i
 + 1 ], x[ i + 1 ] );

54 
ƒg
 = (
›us_öt32
)
	`sûk_ADD_RSHIFT_uöt
–ƒg, 
ƒg_tmp
, 
sh·
 );

56 if–
i
 < 
Àn
 ) {

58 
ƒg_tmp
 = 
	`sûk_SMULBB
–
x
[ 
i
 ], x[ i ] );

59 
ƒg
 = (
›us_öt32
)
	`sûk_ADD_RSHIFT_uöt
–ƒg, 
ƒg_tmp
, 
sh·
 );

61 
	`sûk_as£π
–
ƒg
 >= 0 );

64 
sh·
 = 
	`sûk_max_32
(0, sh·+3 - 
	`sûk_CLZ32
(
ƒg
));

65 
ƒg
 = 0;

66  
i
 = 0 ; i < 
Àn
 - 1; i += 2 ) {

67 
ƒg_tmp
 = 
	`sûk_SMULBB
–
x
[ 
i
 ], x[ i ] );

68 
ƒg_tmp
 = 
	`sûk_SMLABB_ovÊw
–ƒg_tmp, 
x
[ 
i
 + 1 ], x[ i + 1 ] );

69 
ƒg
 = (
›us_öt32
)
	`sûk_ADD_RSHIFT_uöt
–ƒg, 
ƒg_tmp
, 
sh·
 );

71 if–
i
 < 
Àn
 ) {

73 
ƒg_tmp
 = 
	`sûk_SMULBB
–
x
[ 
i
 ], x[ i ] );

74 
ƒg
 = (
›us_öt32
)
	`sûk_ADD_RSHIFT_uöt
–ƒg, 
ƒg_tmp
, 
sh·
 );

77 
	`sûk_as£π
–
ƒg
 >= 0 );

80 *
shi·
 = 
sh·
;

81 *
íîgy
 = 
ƒg
;

82 
	}
}

	@silk/table_LSF_cos.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

36 c⁄° 
›us_öt16
 
	gsûk_LSFCosTab_FIX_Q12
[ 
LSF_COS_TAB_SZ_FIX
 + 1 ] = {

	@silk/tables.h

28 #i‚de‡
SILK_TABLES_H


29 
	#SILK_TABLES_H


	)

31 
	~"deföe.h
"

32 
	~"°ru˘s.h
"

34 #ifde‡
__˝lu•lus


40 c⁄° 
›us_uöt8
 
sûk_gaö_iCDF
[ 3 ][ 
N_LEVELS_QGAIN
 / 8 ];

41 c⁄° 
›us_uöt8
 
sûk_dñè_gaö_iCDF
[ 
MAX_DELTA_GAIN_QUANT
 - 
MIN_DELTA_GAIN_QUANT
 + 1 ];

43 c⁄° 
›us_uöt8
 
sûk_pôch_œg_iCDF
[ 2 * ( 
PITCH_EST_MAX_LAG_MS
 - 
PITCH_EST_MIN_LAG_MS
 ) ];

44 c⁄° 
›us_uöt8
 
sûk_pôch_dñè_iCDF
[ 21 ];

45 c⁄° 
›us_uöt8
 
sûk_pôch_c⁄tour_iCDF
[ 34 ];

46 c⁄° 
›us_uöt8
 
sûk_pôch_c⁄tour_NB_iCDF
[ 11 ];

47 c⁄° 
›us_uöt8
 
sûk_pôch_c⁄tour_10_ms_iCDF
[ 12 ];

48 c⁄° 
›us_uöt8
 
sûk_pôch_c⁄tour_10_ms_NB_iCDF
[ 3 ];

50 c⁄° 
›us_uöt8
 
sûk_pul£s_≥r_block_iCDF
[ 
N_RATE_LEVELS
 ][ 
SILK_MAX_PULSES
 + 2 ];

51 c⁄° 
›us_uöt8
 
sûk_pul£s_≥r_block_BITS_Q5
[ 
N_RATE_LEVELS
 - 1 ][ 
SILK_MAX_PULSES
 + 2 ];

53 c⁄° 
›us_uöt8
 
sûk_øã_Àvñs_iCDF
[ 2 ][ 
N_RATE_LEVELS
 - 1 ];

54 c⁄° 
›us_uöt8
 
sûk_øã_Àvñs_BITS_Q5
[ 2 ][ 
N_RATE_LEVELS
 - 1 ];

56 c⁄° 
›us_uöt8
 
sûk_max_pul£s_èbÀ
[ 4 ];

58 c⁄° 
›us_uöt8
 
sûk_shñl_code_èbÀ0
[ 152 ];

59 c⁄° 
›us_uöt8
 
sûk_shñl_code_èbÀ1
[ 152 ];

60 c⁄° 
›us_uöt8
 
sûk_shñl_code_èbÀ2
[ 152 ];

61 c⁄° 
›us_uöt8
 
sûk_shñl_code_èbÀ3
[ 152 ];

62 c⁄° 
›us_uöt8
 
sûk_shñl_code_èbÀ_off£ts
[ 
SILK_MAX_PULSES
 + 1 ];

64 c⁄° 
›us_uöt8
 
sûk_lsb_iCDF
[ 2 ];

66 c⁄° 
›us_uöt8
 
sûk_sign_iCDF
[ 42 ];

68 c⁄° 
›us_uöt8
 
sûk_unif‹m3_iCDF
[ 3 ];

69 c⁄° 
›us_uöt8
 
sûk_unif‹m4_iCDF
[ 4 ];

70 c⁄° 
›us_uöt8
 
sûk_unif‹m5_iCDF
[ 5 ];

71 c⁄° 
›us_uöt8
 
sûk_unif‹m6_iCDF
[ 6 ];

72 c⁄° 
›us_uöt8
 
sûk_unif‹m8_iCDF
[ 8 ];

74 c⁄° 
›us_uöt8
 
sûk_NLSF_EXT_iCDF
[ 7 ];

76 c⁄° 
›us_uöt8
 
sûk_LTP_≥r_ödex_iCDF
[ 3 ];

77 c⁄° 
›us_uöt8
 * c⁄° 
sûk_LTP_gaö_iCDF_±rs
[ 
NB_LTP_CBKS
 ];

78 c⁄° 
›us_uöt8
 * c⁄° 
sûk_LTP_gaö_BITS_Q5_±rs
[ 
NB_LTP_CBKS
 ];

79 c⁄° 
›us_öt8
 * c⁄° 
sûk_LTP_vq_±rs_Q7
[ 
NB_LTP_CBKS
 ];

80 c⁄° 
›us_uöt8
 * c⁄° 
sûk_LTP_vq_gaö_±rs_Q7
[
NB_LTP_CBKS
];

81 c⁄° 
›us_öt8
 
sûk_LTP_vq_sizes
[ 
NB_LTP_CBKS
 ];

83 c⁄° 
›us_uöt8
 
sûk_LTPsˇÀ_iCDF
[ 3 ];

84 c⁄° 
›us_öt16
 
sûk_LTPSˇÀs_èbÀ_Q14
[ 3 ];

86 c⁄° 
›us_uöt8
 
sûk_ty≥_off£t_VAD_iCDF
[ 4 ];

87 c⁄° 
›us_uöt8
 
sûk_ty≥_off£t_no_VAD_iCDF
[ 2 ];

89 c⁄° 
›us_öt16
 
sûk_°îeo_¥ed_qu™t_Q13
[ 
STEREO_QUANT_TAB_SIZE
 ];

90 c⁄° 
›us_uöt8
 
sûk_°îeo_¥ed_joöt_iCDF
[ 25 ];

91 c⁄° 
›us_uöt8
 
sûk_°îeo_⁄ly_code_mid_iCDF
[ 2 ];

93 c⁄° 
›us_uöt8
 * c⁄° 
sûk_LBRR_Êags_iCDF_±r
[ 2 ];

95 c⁄° 
›us_uöt8
 
sûk_NLSF_öãΩﬁ©i⁄_Á˘‹_iCDF
[ 5 ];

97 c⁄° 
sûk_NLSF_CB_°ru˘
 
sûk_NLSF_CB_WB
;

98 c⁄° 
sûk_NLSF_CB_°ru˘
 
sûk_NLSF_CB_NB_MB
;

101 c⁄° 
›us_öt16
 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 2 ][ 2 ];

104 c⁄° 
›us_öt32
 
sûk_Tønsôi⁄_LP_B_Q28
[ 
TRANSITION_INT_NUM
 ][ 
TRANSITION_NB
 ];

105 c⁄° 
›us_öt32
 
sûk_Tønsôi⁄_LP_A_Q28
[ 
TRANSITION_INT_NUM
 ][ 
TRANSITION_NA
 ];

108 c⁄° 
›us_öt16
 
sûk_LSFCosTab_FIX_Q12
[ 
LSF_COS_TAB_SZ_FIX
 + 1 ];

110 #ifde‡
__˝lu•lus


	@silk/tables_LTP.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 c⁄° 
›us_uöt8
 
	gsûk_LTP_≥r_ödex_iCDF
[3] = {

38 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_iCDF_0
[8] = {

42 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_iCDF_1
[16] = {

47 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_iCDF_2
[32] = {

54 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_BITS_Q5_0
[8] = {

58 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_BITS_Q5_1
[16] = {

63 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_BITS_Q5_2
[32] = {

70 c⁄° 
›us_uöt8
 * c⁄° 
	gsûk_LTP_gaö_iCDF_±rs
[
NB_LTP_CBKS
] = {

71 
sûk_LTP_gaö_iCDF_0
,

72 
sûk_LTP_gaö_iCDF_1
,

73 
sûk_LTP_gaö_iCDF_2


76 c⁄° 
›us_uöt8
 * c⁄° 
	gsûk_LTP_gaö_BITS_Q5_±rs
[
NB_LTP_CBKS
] = {

77 
sûk_LTP_gaö_BITS_Q5_0
,

78 
sûk_LTP_gaö_BITS_Q5_1
,

79 
sûk_LTP_gaö_BITS_Q5_2


82 c⁄° 
›us_öt8
 
	gsûk_LTP_gaö_vq_0
[8][5] =

110 c⁄° 
›us_öt8
 
	gsûk_LTP_gaö_vq_1
[16][5] =

162 c⁄° 
›us_öt8
 
	gsûk_LTP_gaö_vq_2
[32][5] =

262 c⁄° 
›us_öt8
 * c⁄° 
	gsûk_LTP_vq_±rs_Q7
[
NB_LTP_CBKS
] = {

263 (
›us_öt8
 *)&
sûk_LTP_gaö_vq_0
[0][0],

264 (
›us_öt8
 *)&
sûk_LTP_gaö_vq_1
[0][0],

265 (
›us_öt8
 *)&
sûk_LTP_gaö_vq_2
[0][0]

270 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_vq_0_gaö
[8] = {

274 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_vq_1_gaö
[16] = {

279 c⁄° 
›us_uöt8
 
	gsûk_LTP_gaö_vq_2_gaö
[32] = {

286 c⁄° 
›us_uöt8
 * c⁄° 
	gsûk_LTP_vq_gaö_±rs_Q7
[
NB_LTP_CBKS
] = {

287 &
sûk_LTP_gaö_vq_0_gaö
[0],

288 &
sûk_LTP_gaö_vq_1_gaö
[0],

289 &
sûk_LTP_gaö_vq_2_gaö
[0]

292 c⁄° 
›us_öt8
 
	gsûk_LTP_vq_sizes
[
NB_LTP_CBKS
] = {

	@silk/tables_NLSF_CB_NB_MB.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB1_NB_MB_Q8
[ 320 ] = {

77 c⁄° 
›us_öt16
 
	gsûk_NLSF_CB1_Wght_Q9
[ 320 ] = {

112 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB1_iCDF_NB_MB
[ 64 ] = {

123 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_SELECT_NB_MB
[ 160 ] = {

146 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_iCDF_NB_MB
[ 72 ] = {

158 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_BITS_NB_MB_Q5
[ 72 ] = {

170 c⁄° 
›us_uöt8
 
	gsûk_NLSF_PRED_NB_MB_Q8
[ 18 ] = {

176 c⁄° 
›us_öt16
 
	gsûk_NLSF_DELTA_MIN_NB_MB_Q15
[ 11 ] = {

181 c⁄° 
sûk_NLSF_CB_°ru˘
 
	gsûk_NLSF_CB_NB_MB
 =

185 
SILK_FIX_CONST
( 0.18, 16 ),

186 
SILK_FIX_CONST
( 1.0 / 0.18, 6 ),

187 
sûk_NLSF_CB1_NB_MB_Q8
,

188 
sûk_NLSF_CB1_Wght_Q9
,

189 
sûk_NLSF_CB1_iCDF_NB_MB
,

190 
sûk_NLSF_PRED_NB_MB_Q8
,

191 
sûk_NLSF_CB2_SELECT_NB_MB
,

192 
sûk_NLSF_CB2_iCDF_NB_MB
,

193 
sûk_NLSF_CB2_BITS_NB_MB_Q5
,

194 
sûk_NLSF_DELTA_MIN_NB_MB_Q15
,

	@silk/tables_NLSF_CB_WB.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB1_WB_Q8
[ 512 ] = {

101 c⁄° 
›us_öt16
 
	gsûk_NLSF_CB1_WB_Wght_Q9
[ 512 ] = {

136 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB1_iCDF_WB
[ 64 ] = {

147 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_SELECT_WB
[ 256 ] = {

182 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_iCDF_WB
[ 72 ] = {

194 c⁄° 
›us_uöt8
 
	gsûk_NLSF_CB2_BITS_WB_Q5
[ 72 ] = {

206 c⁄° 
›us_uöt8
 
	gsûk_NLSF_PRED_WB_Q8
[ 30 ] = {

213 c⁄° 
›us_öt16
 
	gsûk_NLSF_DELTA_MIN_WB_Q15
[ 17 ] = {

219 c⁄° 
sûk_NLSF_CB_°ru˘
 
	gsûk_NLSF_CB_WB
 =

223 
SILK_FIX_CONST
( 0.15, 16 ),

224 
SILK_FIX_CONST
( 1.0 / 0.15, 6 ),

225 
sûk_NLSF_CB1_WB_Q8
,

226 
sûk_NLSF_CB1_WB_Wght_Q9
,

227 
sûk_NLSF_CB1_iCDF_WB
,

228 
sûk_NLSF_PRED_WB_Q8
,

229 
sûk_NLSF_CB2_SELECT_WB
,

230 
sûk_NLSF_CB2_iCDF_WB
,

231 
sûk_NLSF_CB2_BITS_WB_Q5
,

232 
sûk_NLSF_DELTA_MIN_WB_Q15
,

	@silk/tables_gain.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 #ifde‡
__˝lu•lus


39 c⁄° 
›us_uöt8
 
sûk_gaö_iCDF
[ 3 ][ 
N_LEVELS_QGAIN
 / 8 ] =

52 c⁄° 
›us_uöt8
 
sûk_dñè_gaö_iCDF
[ 
MAX_DELTA_GAIN_QUANT
 - 
MIN_DELTA_GAIN_QUANT
 + 1 ] = {

61 #ifde‡
__˝lu•lus


	@silk/tables_other.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"°ru˘s.h
"

33 
	~"deföe.h
"

34 
	~"èbÀs.h
"

36 #ifde‡
__˝lu•lus


42 c⁄° 
›us_öt16
 
sûk_°îeo_¥ed_qu™t_Q13
[ 
STEREO_QUANT_TAB_SIZE
 ] = {

46 c⁄° 
›us_uöt8
 
sûk_°îeo_¥ed_joöt_iCDF
[ 25 ] = {

53 c⁄° 
›us_uöt8
 
sûk_°îeo_⁄ly_code_mid_iCDF
[ 2 ] = { 64, 0 };

56 c⁄° 
›us_uöt8
 
sûk_LBRR_Êags_2_iCDF
[ 3 ] = { 203, 150, 0 };

57 c⁄° 
›us_uöt8
 
sûk_LBRR_Êags_3_iCDF
[ 7 ] = { 215, 195, 166, 125, 110, 82, 0 };

58 c⁄° 
›us_uöt8
 * c⁄° 
sûk_LBRR_Êags_iCDF_±r
[ 2 ] = {

59 
sûk_LBRR_Êags_2_iCDF
,

60 
sûk_LBRR_Êags_3_iCDF


64 c⁄° 
›us_uöt8
 
sûk_lsb_iCDF
[ 2 ] = { 120, 0 };

67 c⁄° 
›us_uöt8
 
sûk_LTPsˇÀ_iCDF
[ 3 ] = { 128, 64, 0 };

70 c⁄° 
›us_uöt8
 
sûk_ty≥_off£t_VAD_iCDF
[ 4 ] = {

73 c⁄° 
›us_uöt8
 
sûk_ty≥_off£t_no_VAD_iCDF
[ 2 ] = {

78 c⁄° 
›us_uöt8
 
sûk_NLSF_öãΩﬁ©i⁄_Á˘‹_iCDF
[ 5 ] = { 243, 221, 192, 181, 0 };

81 c⁄° 
›us_öt16
 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 2 ][ 2 ] = {

82 { 
OFFSET_UVL_Q10
, 
OFFSET_UVH_Q10
 }, { 
OFFSET_VL_Q10
, 
OFFSET_VH_Q10
 }

86 c⁄° 
›us_öt16
 
sûk_LTPSˇÀs_èbÀ_Q14
[ 3 ] = { 15565, 12288, 8192 };

89 c⁄° 
›us_uöt8
 
sûk_unif‹m3_iCDF
[ 3 ] = { 171, 85, 0 };

90 c⁄° 
›us_uöt8
 
sûk_unif‹m4_iCDF
[ 4 ] = { 192, 128, 64, 0 };

91 c⁄° 
›us_uöt8
 
sûk_unif‹m5_iCDF
[ 5 ] = { 205, 154, 102, 51, 0 };

92 c⁄° 
›us_uöt8
 
sûk_unif‹m6_iCDF
[ 6 ] = { 213, 171, 128, 85, 43, 0 };

93 c⁄° 
›us_uöt8
 
sûk_unif‹m8_iCDF
[ 8 ] = { 224, 192, 160, 128, 96, 64, 32, 0 };

95 c⁄° 
›us_uöt8
 
sûk_NLSF_EXT_iCDF
[ 7 ] = { 100, 40, 16, 7, 3, 1, 0 };

102 c⁄° 
›us_öt32
 
sûk_Tønsôi⁄_LP_B_Q28
[ 
TRANSITION_INT_NUM
 ][ 
TRANSITION_NB
 ] =

112 c⁄° 
›us_öt32
 
sûk_Tønsôi⁄_LP_A_Q28
[ 
TRANSITION_INT_NUM
 ][ 
TRANSITION_NA
 ] =

121 #ifde‡
__˝lu•lus


	@silk/tables_pitch_lag.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 c⁄° 
›us_uöt8
 
	gsûk_pôch_œg_iCDF
[ 2 * ( 
PITCH_EST_MAX_LAG_MS
 - 
PITCH_EST_MIN_LAG_MS
 ) ] = {

41 c⁄° 
›us_uöt8
 
	gsûk_pôch_dñè_iCDF
[21] = {

47 c⁄° 
›us_uöt8
 
	gsûk_pôch_c⁄tour_iCDF
[34] = {

55 c⁄° 
›us_uöt8
 
	gsûk_pôch_c⁄tour_NB_iCDF
[11] = {

60 c⁄° 
›us_uöt8
 
	gsûk_pôch_c⁄tour_10_ms_iCDF
[12] = {

65 c⁄° 
›us_uöt8
 
	gsûk_pôch_c⁄tour_10_ms_NB_iCDF
[3] = {

	@silk/tables_pulses_per_block.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"èbÀs.h
"

34 c⁄° 
›us_uöt8
 
	gsûk_max_pul£s_èbÀ
[ 4 ] = {

38 c⁄° 
›us_uöt8
 
	gsûk_pul£s_≥r_block_iCDF
[ 10 ][ 18 ] = {

91 c⁄° 
›us_uöt8
 
	gsûk_pul£s_≥r_block_BITS_Q5
[ 9 ][ 18 ] = {

139 c⁄° 
›us_uöt8
 
	gsûk_øã_Àvñs_iCDF
[ 2 ][ 9 ] =

151 c⁄° 
›us_uöt8
 
	gsûk_øã_Àvñs_BITS_Q5
[ 2 ][ 9 ] =

163 c⁄° 
›us_uöt8
 
	gsûk_shñl_code_èbÀ0
[ 152 ] = {

185 c⁄° 
›us_uöt8
 
	gsûk_shñl_code_èbÀ1
[ 152 ] = {

207 c⁄° 
›us_uöt8
 
	gsûk_shñl_code_èbÀ2
[ 152 ] = {

229 c⁄° 
›us_uöt8
 
	gsûk_shñl_code_èbÀ3
[ 152 ] = {

251 c⁄° 
›us_uöt8
 
	gsûk_shñl_code_èbÀ_off£ts
[ 17 ] = {

257 c⁄° 
›us_uöt8
 
	gsûk_sign_iCDF
[ 42 ] = {

	@silk/tests/test_unit_LPC_inv_pred_gain.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~"˚…/°ack_Æloc.h
"

35 
	~"˝u_suµ‹t.h
"

36 
	~"SigProc_FIX.h
"

42 
	$check_°abûôy
(
›us_öt16
 *
A_Q12
, 
‹dî
) {

43 
i
;

44 
j
;

45 
sum_a
, 
sum_abs_a
;

46 
sum_a
 = 
sum_abs_a
 = 0;

47  
j
 = 0; j < 
‹dî
; j++ ) {

48 
sum_a
 +
A_Q12
[ 
j
 ];

49 
sum_abs_a
 +
	`sûk_abs
–
A_Q12
[ 
j
 ] );

52 if–
sum_a
 >= 4096 ) {

57 if–
sum_abs_a
 < 4096 ) {

60 
y
[
SILK_MAX_ORDER_LPC
] = {0};

61 
y
[0] = 1;

62  
i
 = 0; i < 10000; i++ ) {

63 
sum
 = 0;

64  
j
 = 0; j < 
‹dî
; j++ ) {

65 
sum
 +
y
[ 
j
 ]*
A_Q12
[ j ];

67  
j
 = 
‹dî
 - 1; j > 0; j-- ) {

68 
y
[ 
j
 ] = y[ j - 1 ];

70 
y
[ 0 ] = 
sum
*(1./4096);

73 if–!(
y
[ 0 ] < 10000 && y[ 0 ] > -10000) ) {

77 if––
i
 & 0x7 ) == 0 ) {

78 
amp
 = 0;

79  
j
 = 0; j < 
‹dî
; j++ ) {

80 
amp
 +
	`Ábs
(
y
[
j
]);

82 if–
amp
 < 0.00001 ) {

88 
	}
}

90 
	$maö
() {

91 c⁄° 
¨ch
 = 
	`›us_£À˘_¨ch
();

93 c⁄° 
lo›_num
 = 10000;

94 
cou¡
 = 0;

95 
ALLOC_STACK
;

99 
	`§™d
(0);

101 
	`¥ötf
("Testing silk_LPC_inverse_pred_gain() optimization ...\n");

102  
cou¡
 = 0; cou¡ < 
lo›_num
; count++ ) {

103 
i
;

104 
›us_öt
 
‹dî
;

105 
shi·
;

106 
›us_öt16
 
A_Q12
[ 
SILK_MAX_ORDER_LPC
 ];

107 
›us_öt32
 
gaö
;

109  
‹dî
 = 2; ordî <
SILK_MAX_ORDER_LPC
; order += 2 ) {

110  
shi·
 = 0; shift < 16; shift++ ) {

111  
i
 = 0; i < 
SILK_MAX_ORDER_LPC
; i++ ) {

112 
A_Q12
[
i
] = ((
›us_öt16
)
	`ønd
()Ë>> 
shi·
;

114 
gaö
 = 
	`sûk_LPC_övî£_¥ed_gaö
(
A_Q12
, 
‹dî
, 
¨ch
);

117 if–
gaö
 !0 && !
	`check_°abûôy
(
A_Q12
, 
‹dî
) ) {

118 
	`Ârötf
(
°dîr
, "**Lo› %4d faûed!**\n", 
cou¡
);

123 if–!(
cou¡
 % 500) ) {

124 
	`¥ötf
("Lo› %4dÖas£d\n", 
cou¡
);

127 
	`¥ötf
("silk_LPC_inverse_pred_gain() optimizationÖassed\n");

129 
	}
}

	@silk/tuning_parameters.h

28 #i‚de‡
SILK_TUNING_PARAMETERS_H


29 
	#SILK_TUNING_PARAMETERS_H


	)

31 #ifde‡
__˝lu•lus


37 
	#BITRESERVOIR_DECAY_TIME_MS
 500

	)

44 
	#FIND_PITCH_WHITE_NOISE_FRACTION
 1e-3f

	)

47 
	#FIND_PITCH_BANDWIDTH_EXPANSION
 0.99f

	)

54 
	#FIND_LPC_COND_FAC
 1e-5f

	)

57 
	#MAX_SUM_LOG_GAIN_DB
 250.0f

	)

60 
	#LTP_CORR_INV_MAX
 0.03f

	)

67 
	#VARIABLE_HP_SMTH_COEF1
 0.1f

	)

68 
	#VARIABLE_HP_SMTH_COEF2
 0.015f

	)

69 
	#VARIABLE_HP_MAX_DELTA_FREQ
 0.4f

	)

72 
	#VARIABLE_HP_MIN_CUTOFF_HZ
 60

	)

73 
	#VARIABLE_HP_MAX_CUTOFF_HZ
 100

	)

80 
	#SPEECH_ACTIVITY_DTX_THRES
 0.05f

	)

83 
	#LBRR_SPEECH_ACTIVITY_THRES
 0.3f

	)

90 
	#BG_SNR_DECR_dB
 2.0f

	)

93 
	#HARM_SNR_INCR_dB
 2.0f

	)

96 
	#SPARSE_SNR_INCR_dB
 2.0f

	)

99 
	#ENERGY_VARIATION_THRESHOLD_QNT_OFFSET
 0.6f

	)

102 
	#WARPING_MULTIPLIER
 0.015f

	)

105 
	#SHAPE_WHITE_NOISE_FRACTION
 3e-5f

	)

108 
	#BANDWIDTH_EXPANSION
 0.94f

	)

111 
	#HARMONIC_SHAPING
 0.3f

	)

114 
	#HIGH_RATE_OR_LOW_QUALITY_HARMONIC_SHAPING
 0.2f

	)

117 
	#HP_NOISE_COEF
 0.25f

	)

120 
	#HARM_HP_NOISE_COEF
 0.35f

	)

123 
	#INPUT_TILT
 0.05f

	)

126 
	#HIGH_RATE_INPUT_TILT
 0.1f

	)

129 
	#LOW_FREQ_SHAPING
 4.0f

	)

132 
	#LOW_QUALITY_LOW_FREQ_SHAPING_DECR
 0.5f

	)

135 
	#SUBFR_SMTH_COEF
 0.4f

	)

138 
	#LAMBDA_OFFSET
 1.2f

	)

139 
	#LAMBDA_SPEECH_ACT
 -0.2f

	)

140 
	#LAMBDA_DELAYED_DECISIONS
 -0.05f

	)

141 
	#LAMBDA_INPUT_QUALITY
 -0.1f

	)

142 
	#LAMBDA_CODING_QUALITY
 -0.2f

	)

143 
	#LAMBDA_QUANT_OFFSET
 0.8f

	)

146 
	#REDUCE_BITRATE_10_MS_BPS
 2200

	)

149 
	#MAX_BANDWIDTH_SWITCH_DELAY_MS
 5000

	)

151 #ifde‡
__˝lu•lus


	@silk/typedef.h

28 #i‚de‡
SILK_TYPEDEF_H


29 
	#SILK_TYPEDEF_H


	)

31 
	~"›us_ty≥s.h
"

32 
	~"›us_deföes.h
"

34 #i‚de‡
FIXED_POINT


35 
	~<Êﬂt.h
>

36 
	#sûk_Êﬂt
 

	)

37 
	#sûk_Êﬂt_MAX
 
FLT_MAX


	)

40 
	#sûk_öt64_MAX
 ((
›us_öt64
)0x7FFFFFFFFFFFFFFFLLË

	)

41 
	#sûk_öt64_MIN
 ((
›us_öt64
)0x8000000000000000LLË

	)

42 
	#sûk_öt32_MAX
 0x7FFFFFFF

	)

43 
	#sûk_öt32_MIN
 ((
›us_öt32
)0x80000000Ë

	)

44 
	#sûk_öt16_MAX
 0x7FFF

	)

45 
	#sûk_öt16_MIN
 ((
›us_öt16
)0x8000Ë

	)

46 
	#sûk_öt8_MAX
 0x7F

	)

47 
	#sûk_öt8_MIN
 ((
›us_öt8
)0x80Ë

	)

48 
	#sûk_uöt8_MAX
 0xFF

	)

50 
	#sûk_TRUE
 1

	)

51 
	#sûk_FALSE
 0

	)

54 #i‡(
deföed
 
_WIN32
 && !deföed 
_WINCE
 && !deföed(
__GNUC__
Ë&& !deföed(
NO_ASSERTS
))

55 #i‚de‡
sûk_as£π


56 
	~<¸tdbg.h
>

57 
	#sûk_as£π
(
COND
Ë
	`_ASSERTE
(COND)

	)

60 #ifde‡
ENABLE_ASSERTIONS


61 
	~<°dio.h
>

62 
	~<°dlib.h
>

63 
	#sûk_Áèl
(
°r
Ë
	`_sûk_Áèl
(°r, 
__FILE__
, 
__LINE__
);

	)

64 #ifde‡
__GNUC__


65 
__©åibuã__
((
n‹ëu∫
))

67 
OPUS_INLINE
 
	$_sûk_Áèl
(c⁄° *
°r
, c⁄° *
fûe
, 
löe
)

69 
	`Ârötf
 (
°dîr
, "F©Æ (öã∫ÆËîr‹ i¿%s,Üöê%d: %s\n", 
fûe
, 
löe
, 
°r
);

70 
	`ab‹t
();

71 
	}
}

72 
	#sûk_as£π
(
COND
Ë{i‡(!(COND)Ë{
	`sûk_Áèl
("as£πi⁄ faûed: " #COND);}}

	)

74 
	#sûk_as£π
(
COND
)

	)

	@silk/x86/NSQ_del_dec_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"maö.h
"

36 
	~"˚…/x86/x86˝u.h
"

38 
	~"°ack_Æloc.h
"

41 
›us_öt32
 
	msLPC_Q14
[ 
MAX_SUB_FRAME_LENGTH
 + 
NSQ_LPC_BUF_LENGTH
 ];

42 
›us_öt32
 
	mR™dSèã
[ 
DECISION_DELAY
 ];

43 
›us_öt32
 
	mQ_Q10
[ 
DECISION_DELAY
 ];

44 
›us_öt32
 
	mXq_Q14
[ 
DECISION_DELAY
 ];

45 
›us_öt32
 
	mPªd_Q15
[ 
DECISION_DELAY
 ];

46 
›us_öt32
 
	mSh≠e_Q14
[ 
DECISION_DELAY
 ];

47 
›us_öt32
 
	msAR2_Q14
[ 
MAX_SHAPE_LPC_ORDER
 ];

48 
›us_öt32
 
	mLF_AR_Q14
;

49 
›us_öt32
 
	mSìd
;

50 
›us_öt32
 
	mSìdInô
;

51 
›us_öt32
 
	mRD_Q10
;

52 } 
	tNSQ_dñ_dec_°ru˘
;

55 
›us_öt32
 
	mQ_Q10
;

56 
›us_öt32
 
	mRD_Q10
;

57 
›us_öt32
 
	mxq_Q14
;

58 
›us_öt32
 
	mLF_AR_Q14
;

59 
›us_öt32
 
	msLTP_shp_Q14
;

60 
›us_öt32
 
	mLPC_exc_Q14
;

61 } 
	tNSQ_ßm∂e_°ru˘
;

63 
NSQ_ßm∂e_°ru˘
 
	tNSQ_ßm∂e_∑ú
[ 2 ];

65 
OPUS_INLINE
 
sûk_nsq_dñ_dec_sˇÀ_°©es_s£4_1
(

66 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

67 
sûk_nsq_°©e
 *
NSQ
,

68 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

69 c⁄° 
›us_öt32
 
x_Q3
[],

70 
›us_öt32
 
x_sc_Q10
[],

71 c⁄° 
›us_öt16
 
sLTP
[],

72 
›us_öt32
 
sLTP_Q15
[],

73 
›us_öt
 
sub‰
,

74 
›us_öt
 
nSèãsDñayedDecisi⁄
,

75 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

76 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

77 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

78 c⁄° 
›us_öt
 
sig«l_ty≥
,

79 c⁄° 
›us_öt
 
decisi⁄Dñay


85 
OPUS_INLINE
 
sûk_noi£_sh≠e_qu™tizî_dñ_dec_s£4_1
(

86 
sûk_nsq_°©e
 *
NSQ
,

87 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

88 
›us_öt
 
sig«lTy≥
,

89 c⁄° 
›us_öt32
 
x_Q10
[],

90 
›us_öt8
 
pul£s
[],

91 
›us_öt16
 
xq
[],

92 
›us_öt32
 
sLTP_Q15
[],

93 
›us_öt32
 
dñayedGaö_Q10
[],

94 c⁄° 
›us_öt16
 
a_Q12
[],

95 c⁄° 
›us_öt16
 
b_Q14
[],

96 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

97 
›us_öt
 
œg
,

98 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

99 
›us_öt
 
Tût_Q14
,

100 
›us_öt32
 
LF_shp_Q14
,

101 
›us_öt32
 
Gaö_Q16
,

102 
›us_öt
 
Lambda_Q10
,

103 
›us_öt
 
off£t_Q10
,

104 
›us_öt
 
Àngth
,

105 
›us_öt
 
sub‰
,

106 
›us_öt
 
sh≠ögLPCOrdî
,

107 
›us_öt
 
¥edi˘LPCOrdî
,

108 
›us_öt
 
w¨pög_Q16
,

109 
›us_öt
 
nSèãsDñayedDecisi⁄
,

110 
›us_öt
 *
sm∂_buf_idx
,

111 
›us_öt
 
decisi⁄Dñay


114 
	$sûk_NSQ_dñ_dec_s£4_1
(

115 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

116 
sûk_nsq_°©e
 *
NSQ
,

117 
SideInfoIndi˚s
 *
psIndi˚s
,

118 c⁄° 
›us_öt32
 
x_Q3
[],

119 
›us_öt8
 
pul£s
[],

120 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

121 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

122 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

123 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

124 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

125 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

126 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

127 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

128 c⁄° 
›us_öt
 
Lambda_Q10
,

129 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


132 
›us_öt
 
i
, 
k
, 
œg
, 
°¨t_idx
, 
LSF_öãΩﬁ©i⁄_Êag
, 
Wö√r_öd
, 
sub‰
;

133 
›us_öt
 
œ°_sm∂e_idx
, 
sm∂_buf_idx
, 
decisi⁄Dñay
;

134 c⁄° 
›us_öt16
 *
A_Q12
, *
B_Q14
, *
AR_shp_Q13
;

135 
›us_öt16
 *
pxq
;

136 
	`VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

137 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

138 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
;

139 
›us_öt
 
off£t_Q10
;

140 
›us_öt32
 
RDmö_Q10
, 
Gaö_Q10
;

141 
	`VARDECL
–
›us_öt32
, 
x_sc_Q10
 );

142 
	`VARDECL
–
›us_öt32
, 
dñayedGaö_Q10
 );

143 
	`VARDECL
–
NSQ_dñ_dec_°ru˘
, 
psDñDec
 );

144 
NSQ_dñ_dec_°ru˘
 *
psDD
;

145 
SAVE_STACK
;

148 
œg
 = 
NSQ
->
œgPªv
;

150 
	`sûk_as£π
–
NSQ
->
¥ev_gaö_Q16
 != 0 );

153 
	`ALLOC
–
psDñDec
, 
psEncC
->
nSèãsDñayedDecisi⁄
, 
NSQ_dñ_dec_°ru˘
 );

154 
	`sûk_mem£t
–
psDñDec
, 0, 
psEncC
->
nSèãsDñayedDecisi⁄
 * –
NSQ_dñ_dec_°ru˘
 ) );

155  
k
 = 0; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

156 
psDD
 = &
psDñDec
[ 
k
 ];

157 
psDD
->
Sìd
 = ( 
k
 + 
psIndi˚s
->Seed ) & 3;

158 
psDD
->
SìdInô
 =ÖsDD->
Sìd
;

159 
psDD
->
RD_Q10
 = 0;

160 
psDD
->
LF_AR_Q14
 = 
NSQ
->
sLF_AR_shp_Q14
;

161 
psDD
->
Sh≠e_Q14
[ 0 ] = 
NSQ
->
sLTP_shp_Q14
[ 
psEncC
->
…p_mem_Àngth
 - 1 ];

162 
	`sûk_mem˝y
–
psDD
->
sLPC_Q14
, 
NSQ
->sLPC_Q14, 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

163 
	`sûk_mem˝y
–
psDD
->
sAR2_Q14
, 
NSQ
->sAR2_Q14, ( NSQ->sAR2_Q14 ) );

166 
off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psIndi˚s
->
sig«lTy≥
 >> 1 ][ÖsIndi˚s->
qu™tOff£tTy≥
 ];

167 
sm∂_buf_idx
 = 0;

169 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–
DECISION_DELAY
, 
psEncC
->
sub‰_Àngth
 );

172 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

173  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

174 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
pôchL
[ 
k
 ] - 
LTP_ORDER
 / 2 - 1 );

177 if–
œg
 > 0 ) {

178 
decisi⁄Dñay
 = 
	`sûk_mö_öt
–decisi⁄Dñay, 
œg
 - 
LTP_ORDER
 / 2 - 1 );

182 if–
psIndi˚s
->
NLSFI¡îpC€f_Q2
 == 4 ) {

183 
LSF_öãΩﬁ©i⁄_Êag
 = 0;

185 
LSF_öãΩﬁ©i⁄_Êag
 = 1;

188 
	`ALLOC
–
sLTP_Q15
,

189 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt32
 );

190 
	`ALLOC
–
sLTP
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt16
 );

191 
	`ALLOC
–
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
, 
›us_öt32
 );

192 
	`ALLOC
–
dñayedGaö_Q10
, 
DECISION_DELAY
, 
›us_öt32
 );

194 
pxq
 = &
NSQ
->
xq
[ 
psEncC
->
…p_mem_Àngth
 ];

195 
NSQ
->
sLTP_shp_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

196 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

197 
sub‰
 = 0;

198  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

199 
A_Q12
 = &
PªdC€f_Q12
[ ( ( 
k
 >> 1 ) | ( 1 - 
LSF_öãΩﬁ©i⁄_Êag
 ) ) * 
MAX_LPC_ORDER
 ];

200 
B_Q14
 = &
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

201 
AR_shp_Q13
 = &
AR2_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ];

204 
	`sûk_as£π
–
H¨mSh≠eGaö_Q14
[ 
k
 ] >= 0 );

205 
H¨mSh≠eFIRPacked_Q14
 = 
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 2 );

206 
H¨mSh≠eFIRPacked_Q14
 |
	`sûk_LSHIFT
–(
›us_öt32
)
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 1 ), 16 );

208 
NSQ
->
ªwhôe_Êag
 = 0;

209 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

211 
œg
 = 
pôchL
[ 
k
 ];

214 if––
k
 & ( 3 - 
	`sûk_LSHIFT
–
LSF_öãΩﬁ©i⁄_Êag
, 1 ) ) ) == 0 ) {

215 if–
k
 == 2 ) {

218 
RDmö_Q10
 = 
psDñDec
[ 0 ].
RD_Q10
;

219 
Wö√r_öd
 = 0;

220  
i
 = 1; i < 
psEncC
->
nSèãsDñayedDecisi⁄
; i++ ) {

221 if–
psDñDec
[ 
i
 ].
RD_Q10
 < 
RDmö_Q10
 ) {

222 
RDmö_Q10
 = 
psDñDec
[ 
i
 ].
RD_Q10
;

223 
Wö√r_öd
 = 
i
;

226  
i
 = 0; i < 
psEncC
->
nSèãsDñayedDecisi⁄
; i++ ) {

227 if–
i
 !
Wö√r_öd
 ) {

228 
psDñDec
[ 
i
 ].
RD_Q10
 +–
sûk_öt32_MAX
 >> 4 );

229 
	`sûk_as£π
–
psDñDec
[ 
i
 ].
RD_Q10
 >= 0 );

234 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

235 
œ°_sm∂e_idx
 = 
sm∂_buf_idx
 + 
decisi⁄Dñay
;

236  
i
 = 0; i < 
decisi⁄Dñay
; i++ ) {

237 
œ°_sm∂e_idx
 = (Üa°_sm∂e_idx - 1 ) % 
DECISION_DELAY
;

238 if–
œ°_sm∂e_idx
 < 0 )Üa°_sm∂e_idx +
DECISION_DELAY
;

239 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

240 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

241 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
Gaös_Q16
[ 1 ] ), 14 ) );

242 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

245 
sub‰
 = 0;

249 
°¨t_idx
 = 
psEncC
->
…p_mem_Àngth
 - 
œg
 -ÖsEncC->
¥edi˘LPCOrdî
 - 
LTP_ORDER
 / 2;

250 
	`˚…_as£π
–
°¨t_idx
 > 0 );

252 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
NSQ
->
xq
[ sèπ_idx + 
k
 * 
psEncC
->
sub‰_Àngth
 ],

253 
A_Q12
, 
psEncC
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

255 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

256 
NSQ
->
ªwhôe_Êag
 = 1;

260 
	`sûk_nsq_dñ_dec_sˇÀ_°©es_s£4_1
–
psEncC
, 
NSQ
, 
psDñDec
, 
x_Q3
, 
x_sc_Q10
, 
sLTP
, 
sLTP_Q15
, 
k
,

261 
psEncC
->
nSèãsDñayedDecisi⁄
, 
LTP_sˇÀ_Q14
, 
Gaös_Q16
, 
pôchL
, 
psIndi˚s
->
sig«lTy≥
, 
decisi⁄Dñay
 );

263 
	`sûk_noi£_sh≠e_qu™tizî_dñ_dec_s£4_1
–
NSQ
, 
psDñDec
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
,

264 
dñayedGaö_Q10
, 
A_Q12
, 
B_Q14
, 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ],

265 
Gaös_Q16
[ 
k
 ], 
Lambda_Q10
, 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
, 
sub‰
++,ÖsEncC->
sh≠ögLPCOrdî
,

266 
psEncC
->
¥edi˘LPCOrdî
,ÖsEncC->
w¨pög_Q16
,ÖsEncC->
nSèãsDñayedDecisi⁄
, &
sm∂_buf_idx
, 
decisi⁄Dñay
 );

268 
x_Q3
 +
psEncC
->
sub‰_Àngth
;

269 
pul£s
 +
psEncC
->
sub‰_Àngth
;

270 
pxq
 +
psEncC
->
sub‰_Àngth
;

274 
RDmö_Q10
 = 
psDñDec
[ 0 ].
RD_Q10
;

275 
Wö√r_öd
 = 0;

276  
k
 = 1; k < 
psEncC
->
nSèãsDñayedDecisi⁄
; k++ ) {

277 if–
psDñDec
[ 
k
 ].
RD_Q10
 < 
RDmö_Q10
 ) {

278 
RDmö_Q10
 = 
psDñDec
[ 
k
 ].
RD_Q10
;

279 
Wö√r_öd
 = 
k
;

284 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

285 
psIndi˚s
->
Sìd
 = 
psDD
->
SìdInô
;

286 
œ°_sm∂e_idx
 = 
sm∂_buf_idx
 + 
decisi⁄Dñay
;

287 
Gaö_Q10
 = 
	`sûk_RSHIFT32
–
Gaös_Q16
[ 
psEncC
->
nb_sub‰
 - 1 ], 6 );

288  
i
 = 0; i < 
decisi⁄Dñay
; i++ ) {

289 
œ°_sm∂e_idx
 = (Üa°_sm∂e_idx - 1 ) % 
DECISION_DELAY
;

290 if–
œ°_sm∂e_idx
 < 0 )Üa°_sm∂e_idx +
DECISION_DELAY
;

291 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

292 
pxq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

293 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
Gaö_Q10
 ), 8 ) );

294 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 + 
i
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

296 
	`sûk_mem˝y
–
NSQ
->
sLPC_Q14
, &
psDD
->sLPC_Q14[ 
psEncC
->
sub‰_Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

297 
	`sûk_mem˝y
–
NSQ
->
sAR2_Q14
, 
psDD
->sAR2_Q14, (ÖsDD->sAR2_Q14 ) );

300 
NSQ
->
sLF_AR_shp_Q14
 = 
psDD
->
LF_AR_Q14
;

301 
NSQ
->
œgPªv
 = 
pôchL
[ 
psEncC
->
nb_sub‰
 - 1 ];

304 
	`sûk_memmove
–
NSQ
->
xq
, &NSQ->xq[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt16
 ) );

305 
	`sûk_memmove
–
NSQ
->
sLTP_shp_Q14
, &NSQ->sLTP_shp_Q14[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt32
 ) );

306 
RESTORE_STACK
;

307 
	}
}

312 
OPUS_INLINE
 
	$sûk_noi£_sh≠e_qu™tizî_dñ_dec_s£4_1
(

313 
sûk_nsq_°©e
 *
NSQ
,

314 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

315 
›us_öt
 
sig«lTy≥
,

316 c⁄° 
›us_öt32
 
x_Q10
[],

317 
›us_öt8
 
pul£s
[],

318 
›us_öt16
 
xq
[],

319 
›us_öt32
 
sLTP_Q15
[],

320 
›us_öt32
 
dñayedGaö_Q10
[],

321 c⁄° 
›us_öt16
 
a_Q12
[],

322 c⁄° 
›us_öt16
 
b_Q14
[],

323 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

324 
›us_öt
 
œg
,

325 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

326 
›us_öt
 
Tût_Q14
,

327 
›us_öt32
 
LF_shp_Q14
,

328 
›us_öt32
 
Gaö_Q16
,

329 
›us_öt
 
Lambda_Q10
,

330 
›us_öt
 
off£t_Q10
,

331 
›us_öt
 
Àngth
,

332 
›us_öt
 
sub‰
,

333 
›us_öt
 
sh≠ögLPCOrdî
,

334 
›us_öt
 
¥edi˘LPCOrdî
,

335 
›us_öt
 
w¨pög_Q16
,

336 
›us_öt
 
nSèãsDñayedDecisi⁄
,

337 
›us_öt
 *
sm∂_buf_idx
,

338 
›us_öt
 
decisi⁄Dñay


341 
›us_öt
 
i
, 
j
, 
k
, 
Wö√r_öd
, 
RDmö_öd
, 
RDmax_öd
, 
œ°_sm∂e_idx
;

342 
›us_öt32
 
Wö√r_ønd_°©e
;

343 
›us_öt32
 
LTP_¥ed_Q14
, 
LPC_¥ed_Q14
, 
n_AR_Q14
, 
n_LTP_Q14
;

344 
›us_öt32
 
n_LF_Q14
, 
r_Q10
, 
º_Q10
, 
rd1_Q10
, 
rd2_Q10
, 
RDmö_Q10
, 
RDmax_Q10
;

345 
›us_öt32
 
q1_Q0
, 
q1_Q10
, 
q2_Q10
, 
exc_Q14
, 
LPC_exc_Q14
, 
xq_Q14
, 
Gaö_Q10
;

346 
›us_öt32
 
tmp1
, 
tmp2
, 
sLF_AR_shp_Q14
;

347 
›us_öt32
 *
¥ed_œg_±r
, *
shp_œg_±r
, *
psLPC_Q14
;

348 
	`VARDECL
–
NSQ_ßm∂e_∑ú
, 
psSam∂eSèã
 );

349 
NSQ_dñ_dec_°ru˘
 *
psDD
;

350 
NSQ_ßm∂e_°ru˘
 *
psSS
;

352 
__m128i
 
a_Q12_0123
, 
a_Q12_4567
, 
a_Q12_89AB
, 
a_Q12_CDEF
;

353 
__m128i
 
b_Q12_0123
, 
b_§_Q12_0123
;

354 
SAVE_STACK
;

356 
	`˚…_as£π
–
nSèãsDñayedDecisi⁄
 > 0 );

357 
	`ALLOC
–
psSam∂eSèã
, 
nSèãsDñayedDecisi⁄
, 
NSQ_ßm∂e_∑ú
 );

359 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

360 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

361 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

363 
a_Q12_0123
 = 
	`OP_CVTEPI16_EPI32_M64
–
a_Q12
 );

364 
a_Q12_4567
 = 
	`OP_CVTEPI16_EPI32_M64
–
a_Q12
 + 4 );

366 if–
	`›us_likñy
–
¥edi˘LPCOrdî
 == 16 ) ) {

367 
a_Q12_89AB
 = 
	`OP_CVTEPI16_EPI32_M64
–
a_Q12
 + 8 );

368 
a_Q12_CDEF
 = 
	`OP_CVTEPI16_EPI32_M64
–
a_Q12
 + 12 );

371 if–
sig«lTy≥
 =
TYPE_VOICED
 ){

372 
b_Q12_0123
 = 
	`OP_CVTEPI16_EPI32_M64
–
b_Q14
 );

373 
b_§_Q12_0123
 = 
	`_mm_shufÊe_ïi32
–
b_Q12_0123
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

375  
i
 = 0; i < 
Àngth
; i++ ) {

379 if–
sig«lTy≥
 =
TYPE_VOICED
 ) {

382 
LTP_¥ed_Q14
 = 2;

384 
__m128i
 
tm∑
, 
tmpb
, 
¥ed_œg_±r_tmp
;

385 
¥ed_œg_±r_tmp
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
¥ed_œg_±r
[ -3 ] ) );

386 
¥ed_œg_±r_tmp
 = 
	`_mm_shufÊe_ïi32
(Öred_lag_ptr_tmp, 0x1B );

387 
tm∑
 = 
	`_mm_mul_ïi32
–
¥ed_œg_±r_tmp
, 
b_Q12_0123
 );

388 
tm∑
 = 
	`_mm_§li_si128
(Åmpa, 2 );

390 
¥ed_œg_±r_tmp
 = 
	`_mm_shufÊe_ïi32
–¥ed_œg_±r_tmp, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

391 
¥ed_œg_±r_tmp
 = 
	`_mm_mul_ïi32
–¥ed_œg_±r_tmp, 
b_§_Q12_0123
 );

392 
¥ed_œg_±r_tmp
 = 
	`_mm_§li_si128
(Öred_lag_ptr_tmp, 2 );

393 
¥ed_œg_±r_tmp
 = 
	`_mm_add_ïi32
–¥ed_œg_±r_tmp, 
tm∑
 );

395 
tmpb
 = 
	`_mm_shufÊe_ïi32
–
¥ed_œg_±r_tmp
, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

396 
¥ed_œg_±r_tmp
 = 
	`_mm_add_ïi32
–¥ed_œg_±r_tmp, 
tmpb
 );

397 
LTP_¥ed_Q14
 +
	`_mm_cvtsi128_si32
–
¥ed_œg_±r_tmp
 );

399 
LTP_¥ed_Q14
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q14, 
¥ed_œg_±r
[ -4 ], 
b_Q14
[ 4 ] );

400 
LTP_¥ed_Q14
 = 
	`sûk_LSHIFT
( LTP_pred_Q14, 1 );

401 
¥ed_œg_±r
++;

404 
LTP_¥ed_Q14
 = 0;

408 if–
œg
 > 0 ) {

410 
n_LTP_Q14
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

411 
n_LTP_Q14
 = 
	`sûk_SMLAWT
–n_LTP_Q14, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

412 
n_LTP_Q14
 = 
	`sûk_SUB_LSHIFT32
–
LTP_¥ed_Q14
,Ç_LTP_Q14, 2 );

413 
shp_œg_±r
++;

415 
n_LTP_Q14
 = 0;

418 
__m128i
 
tm∑
, 
tmpb
, 
psLPC_Q14_tmp
, 
a_Q12_tmp
;

420  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

422 
psDD
 = &
psDñDec
[ 
k
 ];

425 
psSS
 = 
psSam∂eSèã
[ 
k
 ];

428 
psDD
->
Sìd
 = 
	`sûk_RAND
(ÖsDD->Seed );

431 
psLPC_Q14
 = &
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 1 + 
i
 ];

433 
	`sûk_as£π
–
¥edi˘LPCOrdî
 == 10 ||ÖredictLPCOrder == 16 );

435 
LPC_¥ed_Q14
 = 
	`sûk_RSHIFT
–
¥edi˘LPCOrdî
, 1 );

437 
tmpb
 = 
	`_mm_£tzîo_si128
();

440 
psLPC_Q14_tmp
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -3 ] ) );

441 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
(ÖsLPC_Q14_tmp, 0x1B );

442 
tm∑
 = 
	`_mm_mul_ïi32
–
psLPC_Q14_tmp
, 
a_Q12_0123
 );

444 
tm∑
 = 
	`_mm_§li_ïi64
(Åmpa, 16 );

445 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

447 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
–psLPC_Q14_tmp, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

448 
a_Q12_tmp
 = 
	`_mm_shufÊe_ïi32
–
a_Q12_0123
, 
	`_MM_SHUFFLE
(0, 3, 2, 1 ) );

449 
psLPC_Q14_tmp
 = 
	`_mm_mul_ïi32
–psLPC_Q14_tmp, 
a_Q12_tmp
 );

450 
psLPC_Q14_tmp
 = 
	`_mm_§li_ïi64
(ÖsLPC_Q14_tmp, 16 );

451 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
psLPC_Q14_tmp
 );

454 
psLPC_Q14_tmp
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -7 ] ) );

455 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
(ÖsLPC_Q14_tmp, 0x1B );

456 
tm∑
 = 
	`_mm_mul_ïi32
–
psLPC_Q14_tmp
, 
a_Q12_4567
 );

457 
tm∑
 = 
	`_mm_§li_ïi64
(Åmpa, 16 );

458 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

460 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
–psLPC_Q14_tmp, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

461 
a_Q12_tmp
 = 
	`_mm_shufÊe_ïi32
–
a_Q12_4567
, 
	`_MM_SHUFFLE
(0, 3, 2, 1 ) );

462 
psLPC_Q14_tmp
 = 
	`_mm_mul_ïi32
–psLPC_Q14_tmp, 
a_Q12_tmp
 );

463 
psLPC_Q14_tmp
 = 
	`_mm_§li_ïi64
(ÖsLPC_Q14_tmp, 16 );

464 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
psLPC_Q14_tmp
 );

466 i‡–
	`›us_likñy
–
¥edi˘LPCOrdî
 == 16 ) )

469 
psLPC_Q14_tmp
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -11 ] ) );

470 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
(ÖsLPC_Q14_tmp, 0x1B );

471 
tm∑
 = 
	`_mm_mul_ïi32
–
psLPC_Q14_tmp
, 
a_Q12_89AB
 );

472 
tm∑
 = 
	`_mm_§li_ïi64
(Åmpa, 16 );

473 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

475 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
–psLPC_Q14_tmp, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

476 
a_Q12_tmp
 = 
	`_mm_shufÊe_ïi32
–
a_Q12_89AB
, 
	`_MM_SHUFFLE
(0, 3, 2, 1 ) );

477 
psLPC_Q14_tmp
 = 
	`_mm_mul_ïi32
–psLPC_Q14_tmp, 
a_Q12_tmp
 );

478 
psLPC_Q14_tmp
 = 
	`_mm_§li_ïi64
(ÖsLPC_Q14_tmp, 16 );

479 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
psLPC_Q14_tmp
 );

482 
psLPC_Q14_tmp
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -15 ] ) );

483 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
(ÖsLPC_Q14_tmp, 0x1B );

484 
tm∑
 = 
	`_mm_mul_ïi32
–
psLPC_Q14_tmp
, 
a_Q12_CDEF
 );

485 
tm∑
 = 
	`_mm_§li_ïi64
(Åmpa, 16 );

486 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

488 
psLPC_Q14_tmp
 = 
	`_mm_shufÊe_ïi32
–psLPC_Q14_tmp, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

489 
a_Q12_tmp
 = 
	`_mm_shufÊe_ïi32
–
a_Q12_CDEF
, 
	`_MM_SHUFFLE
(0, 3, 2, 1 ) );

490 
psLPC_Q14_tmp
 = 
	`_mm_mul_ïi32
–psLPC_Q14_tmp, 
a_Q12_tmp
 );

491 
psLPC_Q14_tmp
 = 
	`_mm_§li_ïi64
(ÖsLPC_Q14_tmp, 16 );

492 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
psLPC_Q14_tmp
 );

496 
tm∑
 = 
	`_mm_shufÊe_ïi32
–
tmpb
, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

497 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

498 
LPC_¥ed_Q14
 +
	`_mm_cvtsi128_si32
–
tmpb
 );

503 
tm∑
 = 
	`_mm_shufÊe_ïi32
–
tmpb
, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

504 
tmpb
 = 
	`_mm_add_ïi32
–tmpb, 
tm∑
 );

505 
LPC_¥ed_Q14
 +
	`_mm_cvtsi128_si32
–
tmpb
 );

507 
LPC_¥ed_Q14
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q14, 
psLPC_Q14
[ -8 ], 
a_Q12
[ 8 ] );

508 
LPC_¥ed_Q14
 = 
	`sûk_SMLAWB
–LPC_¥ed_Q14, 
psLPC_Q14
[ -9 ], 
a_Q12
[ 9 ] );

511 
LPC_¥ed_Q14
 = 
	`sûk_LSHIFT
( LPC_pred_Q14, 4 );

514 
	`sûk_as£π
––
sh≠ögLPCOrdî
 & 1 ) == 0 );

516 
tmp2
 = 
	`sûk_SMLAWB
–
psLPC_Q14
[ 0 ], 
psDD
->
sAR2_Q14
[ 0 ], 
w¨pög_Q16
 );

518 
tmp1
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 0 ],ÖsDD->sAR2_Q14[ 1 ] - 
tmp2
, 
w¨pög_Q16
 );

519 
psDD
->
sAR2_Q14
[ 0 ] = 
tmp2
;

520 
n_AR_Q14
 = 
	`sûk_RSHIFT
–
sh≠ögLPCOrdî
, 1 );

521 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp2
, 
AR_shp_Q13
[ 0 ] );

523  
j
 = 2; j < 
sh≠ögLPCOrdî
; j += 2 ) {

525 
tmp2
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 
j
 - 1 ],ÖsDD->sAR2_Q14[ j + 0 ] - 
tmp1
, 
w¨pög_Q16
 );

526 
psDD
->
sAR2_Q14
[ 
j
 - 1 ] = 
tmp1
;

527 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp1
, 
AR_shp_Q13
[ 
j
 - 1 ] );

529 
tmp1
 = 
	`sûk_SMLAWB
–
psDD
->
sAR2_Q14
[ 
j
 + 0 ],ÖsDD->sAR2_Q14[ j + 1 ] - 
tmp2
, 
w¨pög_Q16
 );

530 
psDD
->
sAR2_Q14
[ 
j
 + 0 ] = 
tmp2
;

531 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp2
, 
AR_shp_Q13
[ 
j
 ] );

533 
psDD
->
sAR2_Q14
[ 
sh≠ögLPCOrdî
 - 1 ] = 
tmp1
;

534 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
tmp1
, 
AR_shp_Q13
[ 
sh≠ögLPCOrdî
 - 1 ] );

536 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 1 );

537 
n_AR_Q14
 = 
	`sûk_SMLAWB
–n_AR_Q14, 
psDD
->
LF_AR_Q14
, 
Tût_Q14
 );

538 
n_AR_Q14
 = 
	`sûk_LSHIFT
(Ç_AR_Q14, 2 );

540 
n_LF_Q14
 = 
	`sûk_SMULWB
–
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ], 
LF_shp_Q14
 );

541 
n_LF_Q14
 = 
	`sûk_SMLAWT
–n_LF_Q14, 
psDD
->
LF_AR_Q14
, 
LF_shp_Q14
 );

542 
n_LF_Q14
 = 
	`sûk_LSHIFT
(Ç_LF_Q14, 2 );

546 
tmp1
 = 
	`sûk_ADD32
–
n_AR_Q14
, 
n_LF_Q14
 );

547 
tmp2
 = 
	`sûk_ADD32
–
n_LTP_Q14
, 
LPC_¥ed_Q14
 );

548 
tmp1
 = 
	`sûk_SUB32
–
tmp2
,Åmp1 );

549 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 4 );

551 
r_Q10
 = 
	`sûk_SUB32
–
x_Q10
[ 
i
 ], 
tmp1
 );

554 i‡–
psDD
->
Sìd
 < 0 ) {

555 
r_Q10
 = -r_Q10;

557 
r_Q10
 = 
	`sûk_LIMIT_32
(Ñ_Q10, -(31 << 10), 30 << 10 );

560 
q1_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
off£t_Q10
 );

561 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
, 10 );

562 if–
q1_Q0
 > 0 ) {

563 
q1_Q10
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

564 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

565 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

566 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

567 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

568 } if–
q1_Q0
 == 0 ) {

569 
q1_Q10
 = 
off£t_Q10
;

570 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

571 
rd1_Q10
 = 
	`sûk_SMULBB
–
q1_Q10
, 
Lambda_Q10
 );

572 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

573 } if–
q1_Q0
 == -1 ) {

574 
q2_Q10
 = 
off£t_Q10
;

575 
q1_Q10
 = 
	`sûk_SUB32
–
q2_Q10
, 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

576 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

577 
rd2_Q10
 = 
	`sûk_SMULBB
–
q2_Q10
, 
Lambda_Q10
 );

579 
q1_Q10
 = 
	`sûk_ADD32
–
	`sûk_LSHIFT
–
q1_Q0
, 10 ), 
QUANT_LEVEL_ADJUST_Q10
 );

580 
q1_Q10
 = 
	`sûk_ADD32
–q1_Q10, 
off£t_Q10
 );

581 
q2_Q10
 = 
	`sûk_ADD32
–
q1_Q10
, 1024 );

582 
rd1_Q10
 = 
	`sûk_SMULBB
–-
q1_Q10
, 
Lambda_Q10
 );

583 
rd2_Q10
 = 
	`sûk_SMULBB
–-
q2_Q10
, 
Lambda_Q10
 );

585 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q1_Q10
 );

586 
rd1_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd1_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

587 
º_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
q2_Q10
 );

588 
rd2_Q10
 = 
	`sûk_RSHIFT
–
	`sûk_SMLABB
–rd2_Q10, 
º_Q10
,Ñr_Q10 ), 10 );

590 if–
rd1_Q10
 < 
rd2_Q10
 ) {

591 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

592 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

593 
psSS
[ 0 ].
Q_Q10
 = 
q1_Q10
;

594 
psSS
[ 1 ].
Q_Q10
 = 
q2_Q10
;

596 
psSS
[ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd2_Q10
 );

597 
psSS
[ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–
psDD
->RD_Q10, 
rd1_Q10
 );

598 
psSS
[ 0 ].
Q_Q10
 = 
q2_Q10
;

599 
psSS
[ 1 ].
Q_Q10
 = 
q1_Q10
;

605 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 0 ].
Q_Q10
, 4 );

606 i‡–
psDD
->
Sìd
 < 0 ) {

607 
exc_Q14
 = -exc_Q14;

611 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

612 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

615 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
xq_Q14
, 
n_AR_Q14
 );

616 
psSS
[ 0 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

617 
psSS
[ 0 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

618 
psSS
[ 0 ].
LPC_exc_Q14
 = LPC_exc_Q14;

619 
psSS
[ 0 ].
xq_Q14
 = xq_Q14;

624 
exc_Q14
 = 
	`sûk_LSHIFT32
–
psSS
[ 1 ].
Q_Q10
, 4 );

625 i‡–
psDD
->
Sìd
 < 0 ) {

626 
exc_Q14
 = -exc_Q14;

631 
LPC_exc_Q14
 = 
	`sûk_ADD32
–
exc_Q14
, 
LTP_¥ed_Q14
 );

632 
xq_Q14
 = 
	`sûk_ADD32
–
LPC_exc_Q14
, 
LPC_¥ed_Q14
 );

635 
sLF_AR_shp_Q14
 = 
	`sûk_SUB32
–
xq_Q14
, 
n_AR_Q14
 );

636 
psSS
[ 1 ].
sLTP_shp_Q14
 = 
	`sûk_SUB32
–
sLF_AR_shp_Q14
, 
n_LF_Q14
 );

637 
psSS
[ 1 ].
LF_AR_Q14
 = 
sLF_AR_shp_Q14
;

638 
psSS
[ 1 ].
LPC_exc_Q14
 = LPC_exc_Q14;

639 
psSS
[ 1 ].
xq_Q14
 = xq_Q14;

642 *
sm∂_buf_idx
 = ( *sm∂_buf_idx - 1 ) % 
DECISION_DELAY
;

643 if–*
sm∂_buf_idx
 < 0 ) *sm∂_buf_idx +
DECISION_DELAY
;

644 
œ°_sm∂e_idx
 = ( *
sm∂_buf_idx
 + 
decisi⁄Dñay
 ) % 
DECISION_DELAY
;

647 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

648 
Wö√r_öd
 = 0;

649  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

650 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 < 
RDmö_Q10
 ) {

651 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

652 
Wö√r_öd
 = 
k
;

657 
Wö√r_ønd_°©e
 = 
psDñDec
[ 
Wö√r_öd
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ];

658  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

659 if–
psDñDec
[ 
k
 ].
R™dSèã
[ 
œ°_sm∂e_idx
 ] !
Wö√r_ønd_°©e
 ) {

660 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 0 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

661 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 = 
	`sûk_ADD32
–psSam∂eSèã[ k ][ 1 ].RD_Q10, 
sûk_öt32_MAX
 >> 4 );

662 
	`sûk_as£π
–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 >= 0 );

667 
RDmax_Q10
 = 
psSam∂eSèã
[ 0 ][ 0 ].
RD_Q10
;

668 
RDmö_Q10
 = 
psSam∂eSèã
[ 0 ][ 1 ].
RD_Q10
;

669 
RDmax_öd
 = 0;

670 
RDmö_öd
 = 0;

671  
k
 = 1; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

673 if–
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
 > 
RDmax_Q10
 ) {

674 
RDmax_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 0 ].
RD_Q10
;

675 
RDmax_öd
 = 
k
;

678 if–
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
 < 
RDmö_Q10
 ) {

679 
RDmö_Q10
 = 
psSam∂eSèã
[ 
k
 ][ 1 ].
RD_Q10
;

680 
RDmö_öd
 = 
k
;

685 if–
RDmö_Q10
 < 
RDmax_Q10
 ) {

686 
	`sûk_mem˝y
––(
›us_öt32
 *)&
psDñDec
[ 
RDmax_öd
 ] ) + 
i
,

687 –(
›us_öt32
 *)&
psDñDec
[ 
RDmö_öd
 ] ) + 
i
, –
NSQ_dñ_dec_°ru˘
 ) - i * ( opus_int32) );

688 
	`sûk_mem˝y
–&
psSam∂eSèã
[ 
RDmax_öd
 ][ 0 ], &psSam∂eSèã[ 
RDmö_öd
 ][ 1 ], –
NSQ_ßm∂e_°ru˘
 ) );

692 
psDD
 = &
psDñDec
[ 
Wö√r_öd
 ];

693 if–
sub‰
 > 0 || 
i
 >
decisi⁄Dñay
 ) {

694 
pul£s
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
psDD
->
Q_Q10
[ 
œ°_sm∂e_idx
 ], 10 );

695 
xq
[ 
i
 - 
decisi⁄Dñay
 ] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
(

696 
	`sûk_SMULWW
–
psDD
->
Xq_Q14
[ 
œ°_sm∂e_idx
 ], 
dñayedGaö_Q10
[Üast_smple_idx ] ), 8 ) );

697 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Sh≠e_Q14
[ 
œ°_sm∂e_idx
 ];

698 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
decisi⁄Dñay
 ] = 
psDD
->
Pªd_Q15
[ 
œ°_sm∂e_idx
 ];

700 
NSQ
->
sLTP_shp_buf_idx
++;

701 
NSQ
->
sLTP_buf_idx
++;

704  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

705 
psDD
 = &
psDñDec
[ 
k
 ];

706 
psSS
 = &
psSam∂eSèã
[ 
k
 ][ 0 ];

707 
psDD
->
LF_AR_Q14
 = 
psSS
->LF_AR_Q14;

708 
psDD
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 + 
i
 ] = 
psSS
->
xq_Q14
;

709 
psDD
->
Xq_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
xq_Q14
;

710 
psDD
->
Q_Q10
[ *
sm∂_buf_idx
 ] = 
psSS
->Q_Q10;

711 
psDD
->
Pªd_Q15
[ *
sm∂_buf_idx
 ] = 
	`sûk_LSHIFT32
–
psSS
->
LPC_exc_Q14
, 1 );

712 
psDD
->
Sh≠e_Q14
[ *
sm∂_buf_idx
 ] = 
psSS
->
sLTP_shp_Q14
;

713 
psDD
->
Sìd
 = 
	`sûk_ADD32_ovÊw
–psDD->Sìd, 
	`sûk_RSHIFT_ROUND
–
psSS
->
Q_Q10
, 10 ) );

714 
psDD
->
R™dSèã
[ *
sm∂_buf_idx
 ] =ÖsDD->
Sìd
;

715 
psDD
->
RD_Q10
 = 
psSS
->RD_Q10;

717 
dñayedGaö_Q10
[ *
sm∂_buf_idx
 ] = 
Gaö_Q10
;

720  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

721 
psDD
 = &
psDñDec
[ 
k
 ];

722 
	`sûk_mem˝y
–
psDD
->
sLPC_Q14
, &psDD->sLPC_Q14[ 
Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

724 
RESTORE_STACK
;

725 
	}
}

727 
OPUS_INLINE
 
	$sûk_nsq_dñ_dec_sˇÀ_°©es_s£4_1
(

728 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

729 
sûk_nsq_°©e
 *
NSQ
,

730 
NSQ_dñ_dec_°ru˘
 
psDñDec
[],

731 c⁄° 
›us_öt32
 
x_Q3
[],

732 
›us_öt32
 
x_sc_Q10
[],

733 c⁄° 
›us_öt16
 
sLTP
[],

734 
›us_öt32
 
sLTP_Q15
[],

735 
›us_öt
 
sub‰
,

736 
›us_öt
 
nSèãsDñayedDecisi⁄
,

737 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

738 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

739 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

740 c⁄° 
›us_öt
 
sig«l_ty≥
,

741 c⁄° 
›us_öt
 
decisi⁄Dñay


744 
›us_öt
 
i
, 
k
, 
œg
;

745 
›us_öt32
 
gaö_adj_Q16
, 
öv_gaö_Q31
, 
öv_gaö_Q23
;

746 
NSQ_dñ_dec_°ru˘
 *
psDD
;

747 
__m128i
 
xmm_öv_gaö_Q23
, 
xmm_x_Q3_x2x0
, 
xmm_x_Q3_x3x1
;

749 
œg
 = 
pôchL
[ 
sub‰
 ];

750 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
	`sûk_max
–
Gaös_Q16
[ 
sub‰
 ], 1 ), 47 );

752 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

755 if–
Gaös_Q16
[ 
sub‰
 ] !
NSQ
->
¥ev_gaö_Q16
 ) {

756 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
NSQ
->
¥ev_gaö_Q16
, 
Gaös_Q16
[ 
sub‰
 ], 16 );

758 
gaö_adj_Q16
 = (
›us_öt32
)1 << 16;

762 
öv_gaö_Q23
 = 
	`sûk_RSHIFT_ROUND
–
öv_gaö_Q31
, 8 );

765 
xmm_öv_gaö_Q23
 = 
	`_mm_£t1_ïi32
(
öv_gaö_Q23
);

767  
i
 = 0; i < 
psEncC
->
sub‰_Àngth
 - 3; i += 4 ) {

768 
xmm_x_Q3_x2x0
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
x_Q3
[ 
i
 ] ) ) );

770 
xmm_x_Q3_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_x_Q3_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

772 
xmm_x_Q3_x2x0
 = 
	`_mm_mul_ïi32
–xmm_x_Q3_x2x0, 
xmm_öv_gaö_Q23
 );

773 
xmm_x_Q3_x3x1
 = 
	`_mm_mul_ïi32
–xmm_x_Q3_x3x1, 
xmm_öv_gaö_Q23
 );

775 
xmm_x_Q3_x2x0
 = 
	`_mm_§li_ïi64
( xmm_x_Q3_x2x0, 16 );

776 
xmm_x_Q3_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_x_Q3_x3x1, 16 );

778 
xmm_x_Q3_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_x_Q3_x2x0, 
xmm_x_Q3_x3x1
, 0xCC );

780 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&(
x_sc_Q10
[ 
i
 ])), 
xmm_x_Q3_x2x0
 );

783  ; 
i
 < 
psEncC
->
sub‰_Àngth
; i++ ) {

784 
x_sc_Q10
[ 
i
 ] = 
	`sûk_SMULWW
–
x_Q3
[ i ], 
öv_gaö_Q23
 );

788 
NSQ
->
¥ev_gaö_Q16
 = 
Gaös_Q16
[ 
sub‰
 ];

791 if–
NSQ
->
ªwhôe_Êag
 ) {

792 if–
sub‰
 == 0 ) {

794 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
LTP_sˇÀ_Q14
 ), 2 );

796  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

797 
	`sûk_as£π
–
i
 < 
MAX_FRAME_LENGTH
 );

798 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWB
–
öv_gaö_Q31
, 
sLTP
[ i ] );

803 if–
gaö_adj_Q16
 !(
›us_öt32
)1 << 16 ) {

806 
__m128i
 
xmm_gaö_adj_Q16
, 
xmm_sLTP_shp_Q14_x2x0
, 
xmm_sLTP_shp_Q14_x3x1
;

809 
xmm_gaö_adj_Q16
 = 
	`_mm_£t1_ïi32
–
gaö_adj_Q16
 );

811  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx - 3; i += 4 )

813 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
NSQ
->
sLTP_shp_Q14
[ 
i
 ] ) ) );

815 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_sLTP_shp_Q14_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

817 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_mul_ïi32
–xmm_sLTP_shp_Q14_x2x0, 
xmm_gaö_adj_Q16
 );

818 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_mul_ïi32
–xmm_sLTP_shp_Q14_x3x1, 
xmm_gaö_adj_Q16
 );

820 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_§li_ïi64
( xmm_sLTP_shp_Q14_x2x0, 16 );

821 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_sLTP_shp_Q14_x3x1, 16 );

823 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_sLTP_shp_Q14_x2x0, 
xmm_sLTP_shp_Q14_x3x1
, 0xCC );

825 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&(
NSQ
->
sLTP_shp_Q14
[ 
i
 ] ) ), 
xmm_sLTP_shp_Q14_x2x0
 );

828  ; 
i
 < 
NSQ
->
sLTP_shp_buf_idx
; i++ ) {

829 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

833 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

834  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx - 
decisi⁄Dñay
; i++ ) {

835 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

839  
k
 = 0; k < 
nSèãsDñayedDecisi⁄
; k++ ) {

840 
psDD
 = &
psDñDec
[ 
k
 ];

843 
psDD
->
LF_AR_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->LF_AR_Q14 );

846  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

847 
psDD
->
sLPC_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->sLPC_Q14[ i ] );

849  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

850 
psDD
->
sAR2_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->sAR2_Q14[ i ] );

852  
i
 = 0; i < 
DECISION_DELAY
; i++ ) {

853 
psDD
->
Pªd_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->Pred_Q15[ i ] );

854 
psDD
->
Sh≠e_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
,ÖsDD->Shape_Q14[ i ] );

859 
	}
}

	@silk/x86/NSQ_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"maö.h
"

36 
	~"˚…/x86/x86˝u.h
"

37 
	~"°ack_Æloc.h
"

39 
OPUS_INLINE
 
sûk_nsq_sˇÀ_°©es_s£4_1
(

40 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

41 
sûk_nsq_°©e
 *
NSQ
,

42 c⁄° 
›us_öt32
 
x_Q3
[],

43 
›us_öt32
 
x_sc_Q10
[],

44 c⁄° 
›us_öt16
 
sLTP
[],

45 
›us_öt32
 
sLTP_Q15
[],

46 
›us_öt
 
sub‰
,

47 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

48 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

49 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

50 c⁄° 
›us_öt
 
sig«l_ty≥


53 
OPUS_INLINE
 
sûk_noi£_sh≠e_qu™tizî_10_16_s£4_1
(

54 
sûk_nsq_°©e
 *
NSQ
,

55 
›us_öt
 
sig«lTy≥
,

56 c⁄° 
›us_öt32
 
x_sc_Q10
[],

57 
›us_öt8
 
pul£s
[],

58 
›us_öt16
 
xq
[],

59 
›us_öt32
 
sLTP_Q15
[],

60 c⁄° 
›us_öt16
 
a_Q12
[],

61 c⁄° 
›us_öt16
 
b_Q14
[],

62 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

63 
›us_öt
 
œg
,

64 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

65 
›us_öt
 
Tût_Q14
,

66 
›us_öt32
 
LF_shp_Q14
,

67 
›us_öt32
 
Gaö_Q16
,

68 
›us_öt
 
off£t_Q10
,

69 
›us_öt
 
Àngth
,

70 
›us_öt32
 
èbÀ
[][4]

73 
	$sûk_NSQ_s£4_1
(

74 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

75 
sûk_nsq_°©e
 *
NSQ
,

76 
SideInfoIndi˚s
 *
psIndi˚s
,

77 c⁄° 
›us_öt32
 
x_Q3
[],

78 
›us_öt8
 
pul£s
[],

79 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

80 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

81 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

82 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

83 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

84 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

85 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

86 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

87 c⁄° 
›us_öt
 
Lambda_Q10
,

88 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


91 
›us_öt
 
k
, 
œg
, 
°¨t_idx
, 
LSF_öãΩﬁ©i⁄_Êag
;

92 c⁄° 
›us_öt16
 *
A_Q12
, *
B_Q14
, *
AR_shp_Q13
;

93 
›us_öt16
 *
pxq
;

94 
	`VARDECL
–
›us_öt32
, 
sLTP_Q15
 );

95 
	`VARDECL
–
›us_öt16
, 
sLTP
 );

96 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
;

97 
›us_öt
 
off£t_Q10
;

98 
	`VARDECL
–
›us_öt32
, 
x_sc_Q10
 );

100 
›us_öt32
 
èbÀ
[ 64 ][ 4 ];

101 
›us_öt32
 
tmp1
;

102 
›us_öt32
 
q1_Q10
, 
q2_Q10
, 
rd1_Q20
, 
rd2_Q20
;

104 
SAVE_STACK
;

106 
NSQ
->
ønd_£ed
 = 
psIndi˚s
->
Sìd
;

109 
œg
 = 
NSQ
->
œgPªv
;

111 
	`sûk_as£π
–
NSQ
->
¥ev_gaö_Q16
 != 0 );

113 
off£t_Q10
 = 
sûk_Qu™tiz©i⁄_Off£ts_Q10
[ 
psIndi˚s
->
sig«lTy≥
 >> 1 ][ÖsIndi˚s->
qu™tOff£tTy≥
 ];

116 
q1_Q10
 = 
off£t_Q10
;

117 
q2_Q10
 = 
off£t_Q10
 + ( 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

118 
rd1_Q20
 = 
q1_Q10
 * 
Lambda_Q10
;

119 
rd2_Q20
 = 
q2_Q10
 * 
Lambda_Q10
;

121 
èbÀ
[ 32 ][ 0 ] = 
q1_Q10
;

122 
èbÀ
[ 32 ][ 1 ] = 
q2_Q10
;

123 
èbÀ
[ 32 ][ 2 ] = 2 * (
q1_Q10
 - 
q2_Q10
);

124 
èbÀ
[ 32 ][ 3 ] = (
rd1_Q20
 - 
rd2_Q20
Ë+ (
q1_Q10
 * q1_Q10 - 
q2_Q10
 * q2_Q10);

127 
q1_Q10
 = 
off£t_Q10
 - ( 1024 - 
QUANT_LEVEL_ADJUST_Q10
 );

128 
q2_Q10
 = 
off£t_Q10
;

129 
rd1_Q20
 = - 
q1_Q10
 * 
Lambda_Q10
;

130 
rd2_Q20
 = 
q2_Q10
 * 
Lambda_Q10
;

132 
èbÀ
[ 31 ][ 0 ] = 
q1_Q10
;

133 
èbÀ
[ 31 ][ 1 ] = 
q2_Q10
;

134 
èbÀ
[ 31 ][ 2 ] = 2 * (
q1_Q10
 - 
q2_Q10
);

135 
èbÀ
[ 31 ][ 3 ] = (
rd1_Q20
 - 
rd2_Q20
Ë+ (
q1_Q10
 * q1_Q10 - 
q2_Q10
 * q2_Q10);

138 
k
 = 1; k <= 31; k++)

140 
tmp1
 = 
off£t_Q10
 + 
	`sûk_LSHIFT
–
k
, 10 );

142 
q1_Q10
 = 
tmp1
 - 
QUANT_LEVEL_ADJUST_Q10
;

143 
q2_Q10
 = 
tmp1
 - 
QUANT_LEVEL_ADJUST_Q10
 + 1024;

144 
rd1_Q20
 = 
q1_Q10
 * 
Lambda_Q10
;

145 
rd2_Q20
 = 
q2_Q10
 * 
Lambda_Q10
;

147 
èbÀ
[ 32 + 
k
 ][ 0 ] = 
q1_Q10
;

148 
èbÀ
[ 32 + 
k
 ][ 1 ] = 
q2_Q10
;

149 
èbÀ
[ 32 + 
k
 ][ 2 ] = 2 * (
q1_Q10
 - 
q2_Q10
);

150 
èbÀ
[ 32 + 
k
 ][ 3 ] = (
rd1_Q20
 - 
rd2_Q20
Ë+ (
q1_Q10
 * q1_Q10 - 
q2_Q10
 * q2_Q10);

154 
k
 = -32; k <= -2; k++)

156 
tmp1
 = 
off£t_Q10
 + 
	`sûk_LSHIFT
–
k
, 10 );

158 
q1_Q10
 = 
tmp1
 + 
QUANT_LEVEL_ADJUST_Q10
;

159 
q2_Q10
 = 
tmp1
 + 
QUANT_LEVEL_ADJUST_Q10
 + 1024;

160 
rd1_Q20
 = - 
q1_Q10
 * 
Lambda_Q10
;

161 
rd2_Q20
 = - 
q2_Q10
 * 
Lambda_Q10
;

163 
èbÀ
[ 32 + 
k
 ][ 0 ] = 
q1_Q10
;

164 
èbÀ
[ 32 + 
k
 ][ 1 ] = 
q2_Q10
;

165 
èbÀ
[ 32 + 
k
 ][ 2 ] = 2 * (
q1_Q10
 - 
q2_Q10
);

166 
èbÀ
[ 32 + 
k
 ][ 3 ] = (
rd1_Q20
 - 
rd2_Q20
Ë+ (
q1_Q10
 * q1_Q10 - 
q2_Q10
 * q2_Q10);

169 if–
psIndi˚s
->
NLSFI¡îpC€f_Q2
 == 4 ) {

170 
LSF_öãΩﬁ©i⁄_Êag
 = 0;

172 
LSF_öãΩﬁ©i⁄_Êag
 = 1;

175 
	`ALLOC
–
sLTP_Q15
,

176 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt32
 );

177 
	`ALLOC
–
sLTP
, 
psEncC
->
…p_mem_Àngth
 +ÖsEncC->
‰ame_Àngth
, 
›us_öt16
 );

178 
	`ALLOC
–
x_sc_Q10
, 
psEncC
->
sub‰_Àngth
, 
›us_öt32
 );

180 
NSQ
->
sLTP_shp_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

181 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

182 
pxq
 = &
NSQ
->
xq
[ 
psEncC
->
…p_mem_Àngth
 ];

183  
k
 = 0; k < 
psEncC
->
nb_sub‰
; k++ ) {

184 
A_Q12
 = &
PªdC€f_Q12
[ (–
k
 >> 1 ) | ( 1 - 
LSF_öãΩﬁ©i⁄_Êag
 )Ë* 
MAX_LPC_ORDER
 ];

185 
B_Q14
 = &
LTPC€f_Q14
[ 
k
 * 
LTP_ORDER
 ];

186 
AR_shp_Q13
 = &
AR2_Q13
[ 
k
 * 
MAX_SHAPE_LPC_ORDER
 ];

189 
	`sûk_as£π
–
H¨mSh≠eGaö_Q14
[ 
k
 ] >= 0 );

190 
H¨mSh≠eFIRPacked_Q14
 = 
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 2 );

191 
H¨mSh≠eFIRPacked_Q14
 |
	`sûk_LSHIFT
–(
›us_öt32
)
	`sûk_RSHIFT
–
H¨mSh≠eGaö_Q14
[ 
k
 ], 1 ), 16 );

193 
NSQ
->
ªwhôe_Êag
 = 0;

194 if–
psIndi˚s
->
sig«lTy≥
 =
TYPE_VOICED
 ) {

196 
œg
 = 
pôchL
[ 
k
 ];

199 if––
k
 & ( 3 - 
	`sûk_LSHIFT
–
LSF_öãΩﬁ©i⁄_Êag
, 1 ) ) ) == 0 ) {

201 
°¨t_idx
 = 
psEncC
->
…p_mem_Àngth
 - 
œg
 -ÖsEncC->
¥edi˘LPCOrdî
 - 
LTP_ORDER
 / 2;

202 
	`˚…_as£π
–
°¨t_idx
 > 0 );

204 
	`sûk_LPC_™Æysis_fûãr
–&
sLTP
[ 
°¨t_idx
 ], &
NSQ
->
xq
[ sèπ_idx + 
k
 * 
psEncC
->
sub‰_Àngth
 ],

205 
A_Q12
, 
psEncC
->
…p_mem_Àngth
 - 
°¨t_idx
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

207 
NSQ
->
ªwhôe_Êag
 = 1;

208 
NSQ
->
sLTP_buf_idx
 = 
psEncC
->
…p_mem_Àngth
;

212 
	`sûk_nsq_sˇÀ_°©es_s£4_1
–
psEncC
, 
NSQ
, 
x_Q3
, 
x_sc_Q10
, 
sLTP
, 
sLTP_Q15
, 
k
, 
LTP_sˇÀ_Q14
, 
Gaös_Q16
, 
pôchL
, 
psIndi˚s
->
sig«lTy≥
 );

214 i‡–
	`›us_likñy
––10 =
psEncC
->
sh≠ögLPCOrdî
 ) && ( 16 =psEncC->
¥edi˘LPCOrdî
) ) )

216 
	`sûk_noi£_sh≠e_qu™tizî_10_16_s£4_1
–
NSQ
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
, 
A_Q12
, 
B_Q14
,

217 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ], 
Gaös_Q16
[ k ],

218 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
, &(
èbÀ
[32]) );

222 
	`sûk_noi£_sh≠e_qu™tizî
–
NSQ
, 
psIndi˚s
->
sig«lTy≥
, 
x_sc_Q10
, 
pul£s
, 
pxq
, 
sLTP_Q15
, 
A_Q12
, 
B_Q14
,

223 
AR_shp_Q13
, 
œg
, 
H¨mSh≠eFIRPacked_Q14
, 
Tût_Q14
[ 
k
 ], 
LF_shp_Q14
[ k ], 
Gaös_Q16
[ k ], 
Lambda_Q10
,

224 
off£t_Q10
, 
psEncC
->
sub‰_Àngth
,ÖsEncC->
sh≠ögLPCOrdî
,ÖsEncC->
¥edi˘LPCOrdî
,ÖsEncC->
¨ch
 );

227 
x_Q3
 +
psEncC
->
sub‰_Àngth
;

228 
pul£s
 +
psEncC
->
sub‰_Àngth
;

229 
pxq
 +
psEncC
->
sub‰_Àngth
;

233 
NSQ
->
œgPªv
 = 
pôchL
[ 
psEncC
->
nb_sub‰
 - 1 ];

236 
	`sûk_memmove
–
NSQ
->
xq
, &NSQ->xq[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt16
 ) );

237 
	`sûk_memmove
–
NSQ
->
sLTP_shp_Q14
, &NSQ->sLTP_shp_Q14[ 
psEncC
->
‰ame_Àngth
 ],ÖsEncC->
…p_mem_Àngth
 * –
›us_öt32
 ) );

238 
RESTORE_STACK
;

239 
	}
}

244 
OPUS_INLINE
 
	$sûk_noi£_sh≠e_qu™tizî_10_16_s£4_1
(

245 
sûk_nsq_°©e
 *
NSQ
,

246 
›us_öt
 
sig«lTy≥
,

247 c⁄° 
›us_öt32
 
x_sc_Q10
[],

248 
›us_öt8
 
pul£s
[],

249 
›us_öt16
 
xq
[],

250 
›us_öt32
 
sLTP_Q15
[],

251 c⁄° 
›us_öt16
 
a_Q12
[],

252 c⁄° 
›us_öt16
 
b_Q14
[],

253 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

254 
›us_öt
 
œg
,

255 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

256 
›us_öt
 
Tût_Q14
,

257 
›us_öt32
 
LF_shp_Q14
,

258 
›us_öt32
 
Gaö_Q16
,

259 
›us_öt
 
off£t_Q10
,

260 
›us_öt
 
Àngth
,

261 
›us_öt32
 
èbÀ
[][4]

264 
›us_öt
 
i
;

265 
›us_öt32
 
LTP_¥ed_Q13
, 
LPC_¥ed_Q10
, 
n_AR_Q12
, 
n_LTP_Q13
;

266 
›us_öt32
 
n_LF_Q12
, 
r_Q10
, 
q1_Q0
, 
q1_Q10
, 
q2_Q10
;

267 
›us_öt32
 
exc_Q14
, 
LPC_exc_Q14
, 
xq_Q14
, 
Gaö_Q10
;

268 
›us_öt32
 
tmp1
, 
tmp2
, 
sLF_AR_shp_Q14
;

269 
›us_öt32
 *
psLPC_Q14
, *
shp_œg_±r
, *
¥ed_œg_±r
;

271 
__m128i
 
xmm_ãm∑
, 
xmm_ãmpb
;

273 
__m128i
 
xmm_⁄e
;

275 
__m128i
 
psLPC_Q14_hi_01234567
, 
psLPC_Q14_hi_89ABCDEF
;

276 
__m128i
 
psLPC_Q14_lo_01234567
, 
psLPC_Q14_lo_89ABCDEF
;

277 
__m128i
 
a_Q12_01234567
, 
a_Q12_89ABCDEF
;

279 
__m128i
 
sAR2_Q14_hi_76543210
, 
sAR2_Q14_lo_76543210
;

280 
__m128i
 
AR_shp_Q13_76543210
;

282 
shp_œg_±r
 = &
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 
œg
 + 
HARM_SHAPE_FIR_TAPS
 / 2 ];

283 
¥ed_œg_±r
 = &
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 - 
œg
 + 
LTP_ORDER
 / 2 ];

284 
Gaö_Q10
 = 
	`sûk_RSHIFT
–
Gaö_Q16
, 6 );

287 
psLPC_Q14
 = &
NSQ
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 - 1 ];

289 
sLF_AR_shp_Q14
 = 
NSQ
->sLF_AR_shp_Q14;

290 
xq_Q14
 = 
psLPC_Q14
[ 0 ];

291 
LTP_¥ed_Q13
 = 0;

294 
xmm_⁄e
 = 
	`_mm_£t_ïi8
( 1, 0, 3, 2, 5, 4, 7, 6, 9, 8, 11, 10, 13, 12, 15, 14 );

297 
a_Q12_01234567
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
a_Q12
[ 0 ] ) );

299 
a_Q12_89ABCDEF
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
a_Q12
[ 8 ] ) );

301 
a_Q12_01234567
 = 
	`_mm_shufÊe_ïi8
–a_Q12_01234567, 
xmm_⁄e
 );

302 
a_Q12_89ABCDEF
 = 
	`_mm_shufÊe_ïi8
–a_Q12_89ABCDEF, 
xmm_⁄e
 );

305 
AR_shp_Q13_76543210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
AR_shp_Q13
[0] ) );

308 
xmm_⁄e
 = 
	`_mm_£t_ïi8
(15, 14, 11, 10, 7, 6, 3, 2, 13, 12, 9, 8, 5, 4, 1, 0 );

310 
xmm_ãm∑
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[-16]) );

311 
xmm_ãmpb
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[-12]) );

313 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi8
–xmm_ãm∑, 
xmm_⁄e
 );

314 
xmm_ãmpb
 = 
	`_mm_shufÊe_ïi8
–xmm_ãmpb, 
xmm_⁄e
 );

316 
psLPC_Q14_hi_89ABCDEF
 = 
	`_mm_u≈ackhi_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

317 
psLPC_Q14_lo_89ABCDEF
 = 
	`_mm_u≈acklo_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

319 
xmm_ãm∑
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -8 ]) );

320 
xmm_ãmpb
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
psLPC_Q14
[ -4 ]) );

322 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi8
–xmm_ãm∑, 
xmm_⁄e
 );

323 
xmm_ãmpb
 = 
	`_mm_shufÊe_ïi8
–xmm_ãmpb, 
xmm_⁄e
 );

325 
psLPC_Q14_hi_01234567
 = 
	`_mm_u≈ackhi_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

326 
psLPC_Q14_lo_01234567
 = 
	`_mm_u≈acklo_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

329 
xmm_ãm∑
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
NSQ
->
sAR2_Q14
[ 0 ]) ) );

330 
xmm_ãmpb
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
NSQ
->
sAR2_Q14
[ 4 ]) ) );

332 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi8
–xmm_ãm∑, 
xmm_⁄e
 );

333 
xmm_ãmpb
 = 
	`_mm_shufÊe_ïi8
–xmm_ãmpb, 
xmm_⁄e
 );

335 
sAR2_Q14_hi_76543210
 = 
	`_mm_u≈ackhi_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

336 
sAR2_Q14_lo_76543210
 = 
	`_mm_u≈acklo_ïi64
–
xmm_ãm∑
, 
xmm_ãmpb
 );

339 
xmm_⁄e
 = 
	`_mm_£t1_ïi16
(1);

341  
i
 = 0; i < 
Àngth
; i++ )

344 
__m128i
 
xmm_hi_07
, 
xmm_hi_8F
, 
xmm_lo_07
, 
xmm_lo_8F
;

347 
LPC_¥ed_Q10
 = 8;

350 
psLPC_Q14_hi_89ABCDEF
 = 
	`_mm_Æigƒ_ïi8
–
psLPC_Q14_hi_01234567
,ÖsLPC_Q14_hi_89ABCDEF, 2 );

351 
psLPC_Q14_lo_89ABCDEF
 = 
	`_mm_Æigƒ_ïi8
–
psLPC_Q14_lo_01234567
,ÖsLPC_Q14_lo_89ABCDEF, 2 );

353 
psLPC_Q14_hi_01234567
 = 
	`_mm_§li_si128
(ÖsLPC_Q14_hi_01234567, 2 );

354 
psLPC_Q14_lo_01234567
 = 
	`_mm_§li_si128
(ÖsLPC_Q14_lo_01234567, 2 );

356 
psLPC_Q14_hi_01234567
 = 
	`_mm_ö£π_ïi16
–psLPC_Q14_hi_01234567, (
xq_Q14
 >> 16), 7 );

357 
psLPC_Q14_lo_01234567
 = 
	`_mm_ö£π_ïi16
–psLPC_Q14_lo_01234567, (
xq_Q14
), 7 );

360 
xmm_hi_07
 = 
	`_mm_madd_ïi16
–
psLPC_Q14_hi_01234567
, 
a_Q12_01234567
 );

361 
xmm_hi_8F
 = 
	`_mm_madd_ïi16
–
psLPC_Q14_hi_89ABCDEF
, 
a_Q12_89ABCDEF
 );

364 
xmm_ãm∑
 = 
	`_mm_cmpgt_ïi16
–
	`_mm_£tzîo_si128
(), 
psLPC_Q14_lo_01234567
 );

365 
xmm_ãmpb
 = 
	`_mm_cmpgt_ïi16
–
	`_mm_£tzîo_si128
(), 
psLPC_Q14_lo_89ABCDEF
 );

367 
xmm_ãm∑
 = 
	`_mm_™d_si128
–xmm_ãm∑, 
a_Q12_01234567
 );

368 
xmm_ãmpb
 = 
	`_mm_™d_si128
–xmm_ãmpb, 
a_Q12_89ABCDEF
 );

370 
xmm_lo_07
 = 
	`_mm_mulhi_ïi16
–
psLPC_Q14_lo_01234567
, 
a_Q12_01234567
 );

371 
xmm_lo_8F
 = 
	`_mm_mulhi_ïi16
–
psLPC_Q14_lo_89ABCDEF
, 
a_Q12_89ABCDEF
 );

373 
xmm_lo_07
 = 
	`_mm_add_ïi16
–xmm_lo_07, 
xmm_ãm∑
 );

374 
xmm_lo_8F
 = 
	`_mm_add_ïi16
–xmm_lo_8F, 
xmm_ãmpb
 );

376 
xmm_lo_07
 = 
	`_mm_madd_ïi16
–xmm_lo_07, 
xmm_⁄e
 );

377 
xmm_lo_8F
 = 
	`_mm_madd_ïi16
–xmm_lo_8F, 
xmm_⁄e
 );

380 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
xmm_hi_8F
 );

381 
xmm_lo_07
 = 
	`_mm_add_ïi32
–xmm_lo_07, 
xmm_lo_8F
 );

383 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
xmm_lo_07
 );

385 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
	`_mm_u≈ackhi_ïi64
(xmm_hi_07, xmm_hi_07 ) );

386 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
	`_mm_shufÊño_ïi16
(xmm_hi_07, 0x0E ) );

388 
LPC_¥ed_Q10
 +
	`_mm_cvtsi128_si32
–
xmm_hi_07
 );

391 i‡–
	`›us_likñy
–
sig«lTy≥
 =
TYPE_VOICED
 ) ) {

394 
LTP_¥ed_Q13
 = 2;

396 
__m128i
 
b_Q14_3210
, 
b_Q14_0123
, 
¥ed_œg_±r_0123
;

398 
b_Q14_3210
 = 
	`OP_CVTEPI16_EPI32_M64
–
b_Q14
 );

399 
b_Q14_0123
 = 
	`_mm_shufÊe_ïi32
–
b_Q14_3210
, 0x1B );

402 
¥ed_œg_±r_0123
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
¥ed_œg_±r
[ -3 ] ) );

404 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi32
–
¥ed_œg_±r_0123
, 0x1B );

406 
xmm_ãm∑
 = 
	`_mm_mul_ïi32
–xmm_ãm∑, 
b_Q14_3210
 );

408 
xmm_ãm∑
 = 
	`_mm_§li_si128
( xmm_tempa, 2 );

411 
¥ed_œg_±r_0123
 = 
	`_mm_mul_ïi32
–¥ed_œg_±r_0123, 
b_Q14_0123
 );

412 
¥ed_œg_±r_0123
 = 
	`_mm_§li_si128
(Öred_lag_ptr_0123, 2 );

414 
¥ed_œg_±r_0123
 = 
	`_mm_add_ïi32
–¥ed_œg_±r_0123, 
xmm_ãm∑
 );

416 
xmm_ãm∑
 = 
	`_mm_shufÊe_ïi32
–
¥ed_œg_±r_0123
, 
	`_MM_SHUFFLE
( 0, 0, 3, 2 ) );

417 
xmm_ãm∑
 = 
	`_mm_add_ïi32
–xmm_ãm∑, 
¥ed_œg_±r_0123
 );

419 
LTP_¥ed_Q13
 +
	`_mm_cvtsi128_si32
–
xmm_ãm∑
 );

421 
LTP_¥ed_Q13
 = 
	`sûk_SMLAWB
–LTP_¥ed_Q13, 
¥ed_œg_±r
[ -4 ], 
b_Q14
[ 4 ] );

422 
¥ed_œg_±r
++;

427 
NSQ
->
sAR2_Q14
[ 9 ] = NSQ->sAR2_Q14[ 8 ];

428 
NSQ
->
sAR2_Q14
[ 8 ] = 
	`_mm_cvtsi128_si32
–
	`_mm_§li_si128
(
	`_mm_u≈ackhi_ïi16
–
sAR2_Q14_lo_76543210
, 
sAR2_Q14_hi_76543210
 ), 12 ) );

430 
sAR2_Q14_hi_76543210
 = 
	`_mm_¶li_si128
( sAR2_Q14_hi_76543210, 2 );

431 
sAR2_Q14_lo_76543210
 = 
	`_mm_¶li_si128
( sAR2_Q14_lo_76543210, 2 );

433 
sAR2_Q14_hi_76543210
 = 
	`_mm_ö£π_ïi16
–sAR2_Q14_hi_76543210, (
xq_Q14
 >> 16), 0 );

434 
sAR2_Q14_lo_76543210
 = 
	`_mm_ö£π_ïi16
–sAR2_Q14_lo_76543210, (
xq_Q14
), 0 );

437 
xmm_hi_07
 = 
	`_mm_madd_ïi16
–
sAR2_Q14_hi_76543210
, 
AR_shp_Q13_76543210
 );

440 
xmm_ãm∑
 = 
	`_mm_cmpgt_ïi16
–
	`_mm_£tzîo_si128
(), 
sAR2_Q14_lo_76543210
 );

441 
xmm_ãm∑
 = 
	`_mm_™d_si128
–xmm_ãm∑, 
AR_shp_Q13_76543210
 );

443 
xmm_lo_07
 = 
	`_mm_mulhi_ïi16
–
sAR2_Q14_lo_76543210
, 
AR_shp_Q13_76543210
 );

444 
xmm_lo_07
 = 
	`_mm_add_ïi16
–xmm_lo_07, 
xmm_ãm∑
 );

446 
xmm_lo_07
 = 
	`_mm_madd_ïi16
–xmm_lo_07, 
xmm_⁄e
 );

449 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
xmm_lo_07
 );

451 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
	`_mm_u≈ackhi_ïi64
(xmm_hi_07, xmm_hi_07 ) );

452 
xmm_hi_07
 = 
	`_mm_add_ïi32
–xmm_hi_07, 
	`_mm_shufÊño_ïi16
(xmm_hi_07, 0x0E ) );

454 
n_AR_Q12
 = 5 + 
	`_mm_cvtsi128_si32
–
xmm_hi_07
 );

456 
n_AR_Q12
 = 
	`sûk_SMLAWB
–n_AR_Q12, 
NSQ
->
sAR2_Q14
[ 8 ], 
AR_shp_Q13
[ 8 ] );

457 
n_AR_Q12
 = 
	`sûk_SMLAWB
–n_AR_Q12, 
NSQ
->
sAR2_Q14
[ 9 ], 
AR_shp_Q13
[ 9 ] );

459 
n_AR_Q12
 = 
	`sûk_LSHIFT32
(Ç_AR_Q12, 1 );

460 
n_AR_Q12
 = 
	`sûk_SMLAWB
–n_AR_Q12, 
sLF_AR_shp_Q14
, 
Tût_Q14
 );

462 
n_LF_Q12
 = 
	`sûk_SMULWB
–
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 - 1 ], 
LF_shp_Q14
 );

463 
n_LF_Q12
 = 
	`sûk_SMLAWT
–n_LF_Q12, 
sLF_AR_shp_Q14
, 
LF_shp_Q14
 );

465 
	`sûk_as£π
–
œg
 > 0 || 
sig«lTy≥
 !
TYPE_VOICED
 );

468 
tmp1
 = 
	`sûk_SUB32
–
	`sûk_LSHIFT32
–
LPC_¥ed_Q10
, 2 ), 
n_AR_Q12
 );

469 
tmp1
 = 
	`sûk_SUB32
–tmp1, 
n_LF_Q12
 );

470 if–
œg
 > 0 ) {

472 
n_LTP_Q13
 = 
	`sûk_SMULWB
–
	`sûk_ADD32
–
shp_œg_±r
[ 0 ], shp_œg_±r[ -2 ] ), 
H¨mSh≠eFIRPacked_Q14
 );

473 
n_LTP_Q13
 = 
	`sûk_SMLAWT
–n_LTP_Q13, 
shp_œg_±r
[ -1 ], 
H¨mSh≠eFIRPacked_Q14
 );

474 
n_LTP_Q13
 = 
	`sûk_LSHIFT
(Ç_LTP_Q13, 1 );

475 
shp_œg_±r
++;

477 
tmp2
 = 
	`sûk_SUB32
–
LTP_¥ed_Q13
, 
n_LTP_Q13
 );

478 
tmp1
 = 
	`sûk_ADD_LSHIFT32
–
tmp2
,Åmp1, 1 );

479 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 3 );

481 
tmp1
 = 
	`sûk_RSHIFT_ROUND
(Åmp1, 2 );

484 
r_Q10
 = 
	`sûk_SUB32
–
x_sc_Q10
[ 
i
 ], 
tmp1
 );

487 
NSQ
->
ønd_£ed
 = 
	`sûk_RAND
( NSQ->rand_seed );

490 
tmp2
 = -
r_Q10
;

491 i‡–
NSQ
->
ønd_£ed
 < 0 ) 
r_Q10
 = 
tmp2
;

493 
r_Q10
 = 
	`sûk_LIMIT_32
(Ñ_Q10, -(31 << 10), 30 << 10 );

496 
q1_Q10
 = 
	`sûk_SUB32
–
r_Q10
, 
off£t_Q10
 );

497 
q1_Q0
 = 
	`sûk_RSHIFT
–
q1_Q10
, 10 );

499 
q1_Q10
 = 
èbÀ
[
q1_Q0
][0];

500 
q2_Q10
 = 
èbÀ
[
q1_Q0
][1];

502 i‡(
r_Q10
 * 
èbÀ
[
q1_Q0
][2] -Åable[q1_Q0][3] < 0)

504 
q1_Q10
 = 
q2_Q10
;

507 
pul£s
[ 
i
 ] = (
›us_öt8
)
	`sûk_RSHIFT_ROUND
–
q1_Q10
, 10 );

510 
exc_Q14
 = 
	`sûk_LSHIFT
–
q1_Q10
, 4 );

512 
tmp2
 = -
exc_Q14
;

513 i‡–
NSQ
->
ønd_£ed
 < 0 ) 
exc_Q14
 = 
tmp2
;

516 
LPC_exc_Q14
 = 
	`sûk_ADD_LSHIFT32
–
exc_Q14
, 
LTP_¥ed_Q13
, 1 );

517 
xq_Q14
 = 
	`sûk_ADD_LSHIFT32
–
LPC_exc_Q14
, 
LPC_¥ed_Q10
, 4 );

520 
psLPC_Q14
++;

521 *
psLPC_Q14
 = 
xq_Q14
;

522 
sLF_AR_shp_Q14
 = 
	`sûk_SUB_LSHIFT32
–
xq_Q14
, 
n_AR_Q12
, 2 );

524 
NSQ
->
sLTP_shp_Q14
[ NSQ->
sLTP_shp_buf_idx
 ] = 
	`sûk_SUB_LSHIFT32
–
sLF_AR_shp_Q14
, 
n_LF_Q12
, 2 );

525 
sLTP_Q15
[ 
NSQ
->
sLTP_buf_idx
 ] = 
	`sûk_LSHIFT
–
LPC_exc_Q14
, 1 );

526 
NSQ
->
sLTP_shp_buf_idx
++;

527 
NSQ
->
sLTP_buf_idx
++;

530 
NSQ
->
ønd_£ed
 = 
	`sûk_ADD32_ovÊw
–NSQ->ønd_£ed, 
pul£s
[ 
i
 ] );

533 
NSQ
->
sLF_AR_shp_Q14
 = sLF_AR_shp_Q14;

536 
psLPC_Q14
 = &
NSQ
->
sLPC_Q14
[ 
NSQ_LPC_BUF_LENGTH
 ];

539 
xmm_ãm∑
 = 
	`_mm_u≈ackhi_ïi16
–
sAR2_Q14_lo_76543210
, 
sAR2_Q14_hi_76543210
 );

540 
xmm_ãmpb
 = 
	`_mm_u≈acklo_ïi16
–
sAR2_Q14_lo_76543210
, 
sAR2_Q14_hi_76543210
 );

541 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&
NSQ
->
sAR2_Q14
[ 4 ]), 
xmm_ãm∑
 );

542 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&
NSQ
->
sAR2_Q14
[ 0 ]), 
xmm_ãmpb
 );

546 
__m128i
 
xmm_Gaö_Q10
;

547 
__m128i
 
xmm_xq_Q14_3210
, 
xmm_xq_Q14_x3x1
, 
xmm_xq_Q14_7654
, 
xmm_xq_Q14_x7x5
;

550 
xmm_ãm∑
 = 
	`_mm_£t1_ïi32
( (1 << 7) );

553 
xmm_Gaö_Q10
 = 
	`_mm_£t1_ïi32
–
Gaö_Q10
 );

556 
i
 = 0; i < 
Àngth
 - 7; i += 8)

558 
xmm_xq_Q14_3210
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
psLPC_Q14
[ 
i
 + 0 ] ) ) );

559 
xmm_xq_Q14_7654
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
psLPC_Q14
[ 
i
 + 4 ] ) ) );

562 
xmm_xq_Q14_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_xq_Q14_3210
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

564 
xmm_xq_Q14_x7x5
 = 
	`_mm_shufÊe_ïi32
–
xmm_xq_Q14_7654
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

566 
xmm_xq_Q14_3210
 = 
	`_mm_mul_ïi32
–xmm_xq_Q14_3210, 
xmm_Gaö_Q10
 );

567 
xmm_xq_Q14_x3x1
 = 
	`_mm_mul_ïi32
–xmm_xq_Q14_x3x1, 
xmm_Gaö_Q10
 );

568 
xmm_xq_Q14_7654
 = 
	`_mm_mul_ïi32
–xmm_xq_Q14_7654, 
xmm_Gaö_Q10
 );

569 
xmm_xq_Q14_x7x5
 = 
	`_mm_mul_ïi32
–xmm_xq_Q14_x7x5, 
xmm_Gaö_Q10
 );

571 
xmm_xq_Q14_3210
 = 
	`_mm_§li_ïi64
( xmm_xq_Q14_3210, 16 );

572 
xmm_xq_Q14_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_xq_Q14_x3x1, 16 );

573 
xmm_xq_Q14_7654
 = 
	`_mm_§li_ïi64
( xmm_xq_Q14_7654, 16 );

574 
xmm_xq_Q14_x7x5
 = 
	`_mm_¶li_ïi64
( xmm_xq_Q14_x7x5, 16 );

576 
xmm_xq_Q14_3210
 = 
	`_mm_bÀnd_ïi16
–xmm_xq_Q14_3210, 
xmm_xq_Q14_x3x1
, 0xCC );

577 
xmm_xq_Q14_7654
 = 
	`_mm_bÀnd_ïi16
–xmm_xq_Q14_7654, 
xmm_xq_Q14_x7x5
, 0xCC );

580 
xmm_xq_Q14_3210
 = 
	`_mm_add_ïi32
–xmm_xq_Q14_3210, 
xmm_ãm∑
 );

581 
xmm_xq_Q14_7654
 = 
	`_mm_add_ïi32
–xmm_xq_Q14_7654, 
xmm_ãm∑
 );

583 
xmm_xq_Q14_3210
 = 
	`_mm_§ai_ïi32
( xmm_xq_Q14_3210, 8 );

584 
xmm_xq_Q14_7654
 = 
	`_mm_§ai_ïi32
( xmm_xq_Q14_7654, 8 );

587 
xmm_xq_Q14_3210
 = 
	`_mm_∑cks_ïi32
–xmm_xq_Q14_3210, 
xmm_xq_Q14_7654
 );

590 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&
xq
[ 
i
 ] ), 
xmm_xq_Q14_3210
 );

593  ; 
i
 < 
Àngth
; i++)

595 
xq
[
i
] = (
›us_öt16
)
	`sûk_SAT16
–
	`sûk_RSHIFT_ROUND
–
	`sûk_SMULWW
–
psLPC_Q14
[ i ], 
Gaö_Q10
 ), 8 ) );

599 
	`sûk_mem˝y
–
NSQ
->
sLPC_Q14
, &NSQ->sLPC_Q14[ 
Àngth
 ], 
NSQ_LPC_BUF_LENGTH
 * –
›us_öt32
 ) );

600 
	}
}

602 
OPUS_INLINE
 
	$sûk_nsq_sˇÀ_°©es_s£4_1
(

603 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

604 
sûk_nsq_°©e
 *
NSQ
,

605 c⁄° 
›us_öt32
 
x_Q3
[],

606 
›us_öt32
 
x_sc_Q10
[],

607 c⁄° 
›us_öt16
 
sLTP
[],

608 
›us_öt32
 
sLTP_Q15
[],

609 
›us_öt
 
sub‰
,

610 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14
,

611 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

612 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

613 c⁄° 
›us_öt
 
sig«l_ty≥


616 
›us_öt
 
i
, 
œg
;

617 
›us_öt32
 
gaö_adj_Q16
, 
öv_gaö_Q31
, 
öv_gaö_Q23
;

618 
__m128i
 
xmm_öv_gaö_Q23
, 
xmm_x_Q3_x2x0
, 
xmm_x_Q3_x3x1
;

620 
œg
 = 
pôchL
[ 
sub‰
 ];

621 
öv_gaö_Q31
 = 
	`sûk_INVERSE32_v¨Q
–
	`sûk_max
–
Gaös_Q16
[ 
sub‰
 ], 1 ), 47 );

622 
	`sûk_as£π
–
öv_gaö_Q31
 != 0 );

625 if–
Gaös_Q16
[ 
sub‰
 ] !
NSQ
->
¥ev_gaö_Q16
 ) {

626 
gaö_adj_Q16
 = 
	`sûk_DIV32_v¨Q
–
NSQ
->
¥ev_gaö_Q16
, 
Gaös_Q16
[ 
sub‰
 ], 16 );

628 
gaö_adj_Q16
 = (
›us_öt32
)1 << 16;

632 
öv_gaö_Q23
 = 
	`sûk_RSHIFT_ROUND
–
öv_gaö_Q31
, 8 );

635 
xmm_öv_gaö_Q23
 = 
	`_mm_£t1_ïi32
(
öv_gaö_Q23
);

637  
i
 = 0; i < 
psEncC
->
sub‰_Àngth
 - 3; i += 4 ) {

638 
xmm_x_Q3_x2x0
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
x_Q3
[ 
i
 ] ) ) );

641 
xmm_x_Q3_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_x_Q3_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

643 
xmm_x_Q3_x2x0
 = 
	`_mm_mul_ïi32
–xmm_x_Q3_x2x0, 
xmm_öv_gaö_Q23
 );

644 
xmm_x_Q3_x3x1
 = 
	`_mm_mul_ïi32
–xmm_x_Q3_x3x1, 
xmm_öv_gaö_Q23
 );

646 
xmm_x_Q3_x2x0
 = 
	`_mm_§li_ïi64
( xmm_x_Q3_x2x0, 16 );

647 
xmm_x_Q3_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_x_Q3_x3x1, 16 );

649 
xmm_x_Q3_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_x_Q3_x2x0, 
xmm_x_Q3_x3x1
, 0xCC );

651 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&(
x_sc_Q10
[ 
i
 ] ) ), 
xmm_x_Q3_x2x0
 );

654  ; 
i
 < 
psEncC
->
sub‰_Àngth
; i++ ) {

655 
x_sc_Q10
[ 
i
 ] = 
	`sûk_SMULWW
–
x_Q3
[ i ], 
öv_gaö_Q23
 );

659 
NSQ
->
¥ev_gaö_Q16
 = 
Gaös_Q16
[ 
sub‰
 ];

662 if–
NSQ
->
ªwhôe_Êag
 ) {

663 if–
sub‰
 == 0 ) {

665 
öv_gaö_Q31
 = 
	`sûk_LSHIFT
–
	`sûk_SMULWB
–öv_gaö_Q31, 
LTP_sˇÀ_Q14
 ), 2 );

667  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

668 
	`sûk_as£π
–
i
 < 
MAX_FRAME_LENGTH
 );

669 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWB
–
öv_gaö_Q31
, 
sLTP
[ i ] );

674 if–
gaö_adj_Q16
 !(
›us_öt32
)1 << 16 ) {

676 
__m128i
 
xmm_gaö_adj_Q16
, 
xmm_sLTP_shp_Q14_x2x0
, 
xmm_sLTP_shp_Q14_x3x1
;

679 
xmm_gaö_adj_Q16
 = 
	`_mm_£t1_ïi32
(
gaö_adj_Q16
);

681  
i
 = 
NSQ
->
sLTP_shp_buf_idx
 - 
psEncC
->
…p_mem_Àngth
; i < NSQ->sLTP_shp_buf_idx - 3; i += 4 )

683 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&(
NSQ
->
sLTP_shp_Q14
[ 
i
 ] ) ) );

685 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_shufÊe_ïi32
–
xmm_sLTP_shp_Q14_x2x0
, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

687 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_mul_ïi32
–xmm_sLTP_shp_Q14_x2x0, 
xmm_gaö_adj_Q16
 );

688 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_mul_ïi32
–xmm_sLTP_shp_Q14_x3x1, 
xmm_gaö_adj_Q16
 );

690 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_§li_ïi64
( xmm_sLTP_shp_Q14_x2x0, 16 );

691 
xmm_sLTP_shp_Q14_x3x1
 = 
	`_mm_¶li_ïi64
( xmm_sLTP_shp_Q14_x3x1, 16 );

693 
xmm_sLTP_shp_Q14_x2x0
 = 
	`_mm_bÀnd_ïi16
–xmm_sLTP_shp_Q14_x2x0, 
xmm_sLTP_shp_Q14_x3x1
, 0xCC );

695 
	`_mm_°‹eu_si128
–(
__m128i
 *)(&(
NSQ
->
sLTP_shp_Q14
[ 
i
 ] ) ), 
xmm_sLTP_shp_Q14_x2x0
 );

698  ; 
i
 < 
NSQ
->
sLTP_shp_buf_idx
; i++ ) {

699 
NSQ
->
sLTP_shp_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLTP_shp_Q14[ i ] );

703 if–
sig«l_ty≥
 =
TYPE_VOICED
 && 
NSQ
->
ªwhôe_Êag
 == 0 ) {

704  
i
 = 
NSQ
->
sLTP_buf_idx
 - 
œg
 - 
LTP_ORDER
 / 2; i < NSQ->sLTP_buf_idx; i++ ) {

705 
sLTP_Q15
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, sLTP_Q15[ i ] );

709 
NSQ
->
sLF_AR_shp_Q14
 = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLF_AR_shp_Q14 );

712  
i
 = 0; i < 
NSQ_LPC_BUF_LENGTH
; i++ ) {

713 
NSQ
->
sLPC_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sLPC_Q14[ i ] );

715  
i
 = 0; i < 
MAX_SHAPE_LPC_ORDER
; i++ ) {

716 
NSQ
->
sAR2_Q14
[ 
i
 ] = 
	`sûk_SMULWW
–
gaö_adj_Q16
, NSQ->sAR2_Q14[ i ] );

719 
	}
}

	@silk/x86/SigProc_FIX_sse.h

28 #i‚de‡
SIGPROC_FIX_SSE_H


29 
	#SIGPROC_FIX_SSE_H


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

36 
sûk_burg_modifõd_s£4_1
(

37 
›us_öt32
 *
ªs_ƒg
,

38 
›us_öt
 *
ªs_ƒg_Q
,

39 
›us_öt32
 
A_Q16
[],

40 c⁄° 
›us_öt16
 
x
[],

41 c⁄° 
›us_öt32
 
möInvGaö_Q30
,

42 c⁄° 
›us_öt
 
sub‰_Àngth
,

43 c⁄° 
›us_öt
 
nb_sub‰
,

44 c⁄° 
›us_öt
 
D
,

45 
¨ch


48 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
)

49 
	#sûk_burg_modifõd
(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
, 
¨ch
) \

50 (()(
¨ch
), 
	`sûk_burg_modifõd_s£4_1
(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
,árch))

	)

54 (*c⁄° 
SILK_BURG_MODIFIED_IMPL
[
OPUS_ARCHMASK
 + 1])(

55 
›us_öt32
 *
ªs_ƒg
,

56 
›us_öt
 *
ªs_ƒg_Q
,

57 
›us_öt32
 
A_Q16
[],

58 c⁄° 
›us_öt16
 
x
[],

59 c⁄° 
›us_öt32
 
möInvGaö_Q30
,

60 c⁄° 
›us_öt
 
sub‰_Àngth
,

61 c⁄° 
›us_öt
 
nb_sub‰
,

62 c⁄° 
›us_öt
 
D
,

63 
¨ch
 );

65 
	#sûk_burg_modifõd
(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
, 
¨ch
) \

66 ((*
SILK_BURG_MODIFIED_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
ªs_ƒg
, 
ªs_ƒg_Q
, 
A_Q16
, 
x
, 
möInvGaö_Q30
, 
sub‰_Àngth
, 
nb_sub‰
, 
D
,árch))

	)

70 
›us_öt64
 
sûk_ö√r_¥od16_Æig√d_64_s£4_1
(

71 c⁄° 
›us_öt16
 *
öVec1
,

72 c⁄° 
›us_öt16
 *
öVec2
,

73 c⁄° 
›us_öt
 
Àn


77 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
)

79 
	#sûk_ö√r_¥od16_Æig√d_64
(
öVec1
, 
öVec2
, 
Àn
, 
¨ch
) \

80 (()(
¨ch
),
	`sûk_ö√r_¥od16_Æig√d_64_s£4_1
(
öVec1
, 
öVec2
, 
Àn
))

	)

84 
›us_öt64
 (*c⁄° 
SILK_INNER_PROD16_ALIGNED_64_IMPL
[
OPUS_ARCHMASK
 + 1])(

85 c⁄° 
›us_öt16
 *
öVec1
,

86 c⁄° 
›us_öt16
 *
öVec2
,

87 c⁄° 
›us_öt
 
Àn
);

89 
	#sûk_ö√r_¥od16_Æig√d_64
(
öVec1
, 
öVec2
, 
Àn
, 
¨ch
) \

90 ((*
SILK_INNER_PROD16_ALIGNED_64_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
öVec1
, 
öVec2
, 
Àn
))

	)

	@silk/x86/VAD_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

36 
	~"maö.h
"

37 
	~"°ack_Æloc.h
"

40 c⁄° 
›us_öt32
 
	gtûtWeights
[ 
VAD_N_BANDS
 ] = { 30000, 6000, -12000, -12000 };

45 
›us_öt
 
	$sûk_VAD_GëSA_Q8_s£4_1
(

46 
sûk_ícodî_°©e
 *
psEncC
,

47 c⁄° 
›us_öt16
 
pIn
[]

50 
›us_öt
 
SA_Q15
, 
pSNR_dB_Q7
, 
öput_tût
;

51 
›us_öt
 
decim©ed_‰amñígth1
, 
decim©ed_‰amñígth2
;

52 
›us_öt
 
decim©ed_‰amñígth
;

53 
›us_öt
 
dec_sub‰ame_Àngth
, 
dec_sub‰ame_off£t
, 
SNR_Q7
, 
i
, 
b
, 
s
;

54 
›us_öt32
 
sumSqu¨ed
, 
smoŸh_c€f_Q16
;

55 
›us_öt16
 
HP°©eTmp
;

56 
	`VARDECL
–
›us_öt16
, 
X
 );

57 
›us_öt32
 
Xƒg
[ 
VAD_N_BANDS
 ];

58 
›us_öt32
 
NrgToNoi£R©io_Q8
[ 
VAD_N_BANDS
 ];

59 
›us_öt32
 
•ìch_ƒg
, 
x_tmp
;

60 
›us_öt
 
X_off£t
[ 
VAD_N_BANDS
 ];

61 
›us_öt
 
ªt
 = 0;

62 
sûk_VAD_°©e
 *
psSûk_VAD
 = &
psEncC
->
sVAD
;

64 
SAVE_STACK
;

67 
	`sûk_as£π
–
VAD_N_BANDS
 == 4 );

68 
	`˚…_as£π
–
MAX_FRAME_LENGTH
 >
psEncC
->
‰ame_Àngth
 );

69 
	`˚…_as£π
–
psEncC
->
‰ame_Àngth
 <= 512 );

70 
	`˚…_as£π
–
psEncC
->
‰ame_Àngth
 =8 * 
	`sûk_RSHIFT
(ÖsEncC->frame_length, 3 ) );

75 
decim©ed_‰amñígth1
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 1 );

76 
decim©ed_‰amñígth2
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 2 );

77 
decim©ed_‰amñígth
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 3 );

87 
X_off£t
[ 0 ] = 0;

88 
X_off£t
[ 1 ] = 
decim©ed_‰amñígth
 + 
decim©ed_‰amñígth2
;

89 
X_off£t
[ 2 ] = X_off£t[ 1 ] + 
decim©ed_‰amñígth
;

90 
X_off£t
[ 3 ] = X_off£t[ 2 ] + 
decim©ed_‰amñígth2
;

91 
	`ALLOC
–
X
, 
X_off£t
[ 3 ] + 
decim©ed_‰amñígth1
, 
›us_öt16
 );

94 
	`sûk_™a_fût_b™k_1
–
pIn
, &
psSûk_VAD
->
A«Sèã
[ 0 ],

95 
X
, &X[ 
X_off£t
[ 3 ] ], 
psEncC
->
‰ame_Àngth
 );

98 
	`sûk_™a_fût_b™k_1
–
X
, &
psSûk_VAD
->
A«Sèã1
[ 0 ],

99 
X
, &X[ 
X_off£t
[ 2 ] ], 
decim©ed_‰amñígth1
 );

102 
	`sûk_™a_fût_b™k_1
–
X
, &
psSûk_VAD
->
A«Sèã2
[ 0 ],

103 
X
, &X[ 
X_off£t
[ 1 ] ], 
decim©ed_‰amñígth2
 );

108 
X
[ 
decim©ed_‰amñígth
 - 1 ] = 
	`sûk_RSHIFT
( X[ decimated_framelength - 1 ], 1 );

109 
HP°©eTmp
 = 
X
[ 
decim©ed_‰amñígth
 - 1 ];

110  
i
 = 
decim©ed_‰amñígth
 - 1; i > 0; i-- ) {

111 
X
[ 
i
 - 1 ] = 
	`sûk_RSHIFT
( X[ i - 1 ], 1 );

112 
X
[ 
i
 ] -= X[ i - 1 ];

114 
X
[ 0 ] -
psSûk_VAD
->
HP°©e
;

115 
psSûk_VAD
->
HP°©e
 = 
HP°©eTmp
;

120  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

122 
decim©ed_‰amñígth
 = 
	`sûk_RSHIFT
–
psEncC
->
‰ame_Àngth
, 
	`sûk_mö_öt
–
VAD_N_BANDS
 - 
b
, VAD_N_BANDS - 1 ) );

125 
dec_sub‰ame_Àngth
 = 
	`sûk_RSHIFT
–
decim©ed_‰amñígth
, 
VAD_INTERNAL_SUBFRAMES_LOG2
 );

126 
dec_sub‰ame_off£t
 = 0;

130 
Xƒg
[ 
b
 ] = 
psSûk_VAD
->
XƒgSub‰
[ b ];

131  
s
 = 0; s < 
VAD_INTERNAL_SUBFRAMES
; s++ ) {

132 
__m128i
 
xmm_X
, 
xmm_acc
;

133 
sumSqu¨ed
 = 0;

135 
xmm_acc
 = 
	`_mm_£tzîo_si128
();

137  
i
 = 0; i < 
dec_sub‰ame_Àngth
 - 7; i += 8 )

139 
xmm_X
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)&(
X
[ 
X_off£t
[ 
b
 ] + 
i
 + 
dec_sub‰ame_off£t
 ] ) );

140 
xmm_X
 = 
	`_mm_§ai_ïi16
( xmm_X, 3 );

141 
xmm_X
 = 
	`_mm_madd_ïi16
( xmm_X, xmm_X );

142 
xmm_acc
 = 
	`_mm_add_ïi32
–xmm_acc, 
xmm_X
 );

145 
xmm_acc
 = 
	`_mm_add_ïi32
–xmm_acc, 
	`_mm_u≈ackhi_ïi64
( xmm_acc, xmm_acc ) );

146 
xmm_acc
 = 
	`_mm_add_ïi32
–xmm_acc, 
	`_mm_shufÊño_ïi16
( xmm_acc, 0x0E ) );

148 
sumSqu¨ed
 +
	`_mm_cvtsi128_si32
–
xmm_acc
 );

150  ; 
i
 < 
dec_sub‰ame_Àngth
; i++ ) {

153 
x_tmp
 = 
	`sûk_RSHIFT
(

154 
X
[ 
X_off£t
[ 
b
 ] + 
i
 + 
dec_sub‰ame_off£t
 ], 3 );

155 
sumSqu¨ed
 = 
	`sûk_SMLABB
–sumSqu¨ed, 
x_tmp
, x_tmp );

158 
	`sûk_as£π
–
sumSqu¨ed
 >= 0 );

162 if–
s
 < 
VAD_INTERNAL_SUBFRAMES
 - 1 ) {

163 
Xƒg
[ 
b
 ] = 
	`sûk_ADD_POS_SAT32
–Xƒg[ b ], 
sumSqu¨ed
 );

166 
Xƒg
[ 
b
 ] = 
	`sûk_ADD_POS_SAT32
–Xƒg[ b ], 
	`sûk_RSHIFT
–
sumSqu¨ed
, 1 ) );

169 
dec_sub‰ame_off£t
 +
dec_sub‰ame_Àngth
;

171 
psSûk_VAD
->
XƒgSub‰
[ 
b
 ] = 
sumSqu¨ed
;

177 
	`sûk_VAD_GëNoi£Levñs
–&
Xƒg
[ 0 ], 
psSûk_VAD
 );

182 
sumSqu¨ed
 = 0;

183 
öput_tût
 = 0;

184  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

185 
•ìch_ƒg
 = 
Xƒg
[ 
b
 ] - 
psSûk_VAD
->
NL
[ b ];

186 if–
•ìch_ƒg
 > 0 ) {

188 if––
Xƒg
[ 
b
 ] & 0xFF800000 ) == 0 ) {

189 
NrgToNoi£R©io_Q8
[ 
b
 ] = 
	`sûk_DIV32
–
	`sûk_LSHIFT
–
Xƒg
[ b ], 8 ), 
psSûk_VAD
->
NL
[ b ] + 1 );

191 
NrgToNoi£R©io_Q8
[ 
b
 ] = 
	`sûk_DIV32
–
Xƒg
[ b ], 
	`sûk_RSHIFT
–
psSûk_VAD
->
NL
[ b ], 8 ) + 1 );

195 
SNR_Q7
 = 
	`sûk_lö2log
–
NrgToNoi£R©io_Q8
[ 
b
 ] ) - 8 * 128;

198 
sumSqu¨ed
 = 
	`sûk_SMLABB
–sumSqu¨ed, 
SNR_Q7
, SNR_Q7 );

201 if–
•ìch_ƒg
 < ( (
›us_öt32
)1 << 20 ) ) {

203 
SNR_Q7
 = 
	`sûk_SMULWB
–
	`sûk_LSHIFT
–
	`sûk_SQRT_APPROX
–
•ìch_ƒg
 ), 6 ), SNR_Q7 );

205 
öput_tût
 = 
	`sûk_SMLAWB
–öput_tût, 
tûtWeights
[ 
b
 ], 
SNR_Q7
 );

207 
NrgToNoi£R©io_Q8
[ 
b
 ] = 256;

212 
sumSqu¨ed
 = 
	`sûk_DIV32_16
–sumSqu¨ed, 
VAD_N_BANDS
 );

215 
pSNR_dB_Q7
 = (
›us_öt16
)–3 * 
	`sûk_SQRT_APPROX
–
sumSqu¨ed
 ) );

220 
SA_Q15
 = 
	`sûk_sigm_Q15
–
	`sûk_SMULWB
–
VAD_SNR_FACTOR_Q16
, 
pSNR_dB_Q7
 ) - 
VAD_NEGATIVE_OFFSET_Q5
 );

225 
psEncC
->
öput_tût_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_sigm_Q15
–
öput_tût
 ) - 16384, 1 );

230 
•ìch_ƒg
 = 0;

231  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

233 
•ìch_ƒg
 +–
b
 + 1 ) * 
	`sûk_RSHIFT
–
Xƒg
[ b ] - 
psSûk_VAD
->
NL
[ b ], 4 );

237 if–
•ìch_ƒg
 <= 0 ) {

238 
SA_Q15
 = 
	`sûk_RSHIFT
( SA_Q15, 1 );

239 } if–
•ìch_ƒg
 < 32768 ) {

240 if–
psEncC
->
‰ame_Àngth
 =10 *ÖsEncC->
fs_kHz
 ) {

241 
•ìch_ƒg
 = 
	`sûk_LSHIFT_SAT32
( speech_nrg, 16 );

243 
•ìch_ƒg
 = 
	`sûk_LSHIFT_SAT32
( speech_nrg, 15 );

247 
•ìch_ƒg
 = 
	`sûk_SQRT_APPROX
( speech_nrg );

248 
SA_Q15
 = 
	`sûk_SMULWB
–32768 + 
•ìch_ƒg
, SA_Q15 );

252 
psEncC
->
•ìch_a˘ivôy_Q8
 = 
	`sûk_mö_öt
–
	`sûk_RSHIFT
–
SA_Q15
, 7 ), 
sûk_uöt8_MAX
 );

258 
smoŸh_c€f_Q16
 = 
	`sûk_SMULWB
–
VAD_SNR_SMOOTH_COEF_Q18
, sûk_SMULWB–(
›us_öt32
)
SA_Q15
, SA_Q15 ) );

260 if–
psEncC
->
‰ame_Àngth
 =10 *ÖsEncC->
fs_kHz
 ) {

261 
smoŸh_c€f_Q16
 >>= 1;

264  
b
 = 0; b < 
VAD_N_BANDS
; b++ ) {

266 
psSûk_VAD
->
NrgR©ioSmth_Q8
[ 
b
 ] = 
	`sûk_SMLAWB
(ÖsSilk_VAD->NrgRatioSmth_Q8[ b ],

267 
NrgToNoi£R©io_Q8
[ 
b
 ] - 
psSûk_VAD
->
NrgR©ioSmth_Q8
[ b ], 
smoŸh_c€f_Q16
 );

270 
SNR_Q7
 = 3 * ( 
	`sûk_lö2log
–
psSûk_VAD
->
NrgR©ioSmth_Q8
[
b
] ) - 8 * 128 );

272 
psEncC
->
öput_quÆôy_b™ds_Q15
[ 
b
 ] = 
	`sûk_sigm_Q15
–
	`sûk_RSHIFT
–
SNR_Q7
 - 16 * 128, 4 ) );

275 
RESTORE_STACK
;

276 –
ªt
 );

277 
	}
}

	@silk/x86/VQ_WMat_EC_sse4_1.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<xmmöåö.h
>

33 
	~<emmöåö.h
>

34 
	~<smmöåö.h
>

35 
	~"maö.h
"

36 
	~"˚…/x86/x86˝u.h
"

39 
	$sûk_VQ_WM©_EC_s£4_1
(

40 
›us_öt8
 *
öd
,

41 
›us_öt32
 *
øã_di°_Q14
,

42 
›us_öt
 *
gaö_Q7
,

43 c⁄° 
›us_öt16
 *
ö_Q14
,

44 c⁄° 
›us_öt32
 *
W_Q18
,

45 c⁄° 
›us_öt8
 *
cb_Q7
,

46 c⁄° 
›us_uöt8
 *
cb_gaö_Q7
,

47 c⁄° 
›us_uöt8
 *
˛_Q5
,

48 c⁄° 
›us_öt
 
mu_Q9
,

49 c⁄° 
›us_öt32
 
max_gaö_Q7
,

50 
›us_öt
 
L


53 
›us_öt
 
k
, 
gaö_tmp_Q7
;

54 c⁄° 
›us_öt8
 *
cb_row_Q7
;

55 
›us_öt16
 
diff_Q14
[ 5 ];

56 
›us_öt32
 
sum1_Q14
, 
sum2_Q16
;

58 
__m128i
 
C_tmp1
, 
C_tmp2
, 
C_tmp3
, 
C_tmp4
, 
C_tmp5
;

60 *
øã_di°_Q14
 = 
sûk_öt32_MAX
;

61 
cb_row_Q7
 = 
cb_Q7
;

62  
k
 = 0; k < 
L
; k++ ) {

63 
gaö_tmp_Q7
 = 
cb_gaö_Q7
[
k
];

65 
diff_Q14
[ 0 ] = 
ö_Q14
[ 0 ] - 
	`sûk_LSHIFT
–
cb_row_Q7
[ 0 ], 7 );

67 
C_tmp1
 = 
	`OP_CVTEPI16_EPI32_M64
–&
ö_Q14
[ 1 ] );

68 
C_tmp2
 = 
	`OP_CVTEPI8_EPI32_M32
–&
cb_row_Q7
[ 1 ] );

69 
C_tmp2
 = 
	`_mm_¶li_ïi32
( C_tmp2, 7 );

70 
C_tmp1
 = 
	`_mm_sub_ïi32
–C_tmp1, 
C_tmp2
 );

72 
diff_Q14
[ 1 ] = 
	`_mm_exåa˘_ïi16
–
C_tmp1
, 0 );

73 
diff_Q14
[ 2 ] = 
	`_mm_exåa˘_ïi16
–
C_tmp1
, 2 );

74 
diff_Q14
[ 3 ] = 
	`_mm_exåa˘_ïi16
–
C_tmp1
, 4 );

75 
diff_Q14
[ 4 ] = 
	`_mm_exåa˘_ïi16
–
C_tmp1
, 6 );

78 
sum1_Q14
 = 
	`sûk_SMULBB
–
mu_Q9
, 
˛_Q5
[ 
k
 ] );

81 
sum1_Q14
 = 
	`sûk_ADD_LSHIFT32
–sum1_Q14, 
	`sûk_max
–
	`sûk_SUB32
–
gaö_tmp_Q7
, 
max_gaö_Q7
 ), 0 ), 10 );

83 
	`sûk_as£π
–
sum1_Q14
 >= 0 );

86 
C_tmp3
 = 
	`_mm_lﬂdu_si128
–(
__m128i
 *)(&
W_Q18
[ 1 ] ) );

87 
C_tmp4
 = 
	`_mm_mul_ïi32
–
C_tmp3
, 
C_tmp1
 );

88 
C_tmp4
 = 
	`_mm_§li_si128
( C_tmp4, 2 );

90 
C_tmp1
 = 
	`_mm_shufÊe_ïi32
–C_tmp1, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

91 
C_tmp3
 = 
	`_mm_shufÊe_ïi32
–C_tmp3, 
	`_MM_SHUFFLE
( 0, 3, 2, 1 ) );

93 
C_tmp5
 = 
	`_mm_mul_ïi32
–
C_tmp3
, 
C_tmp1
 );

94 
C_tmp5
 = 
	`_mm_§li_si128
( C_tmp5, 2 );

96 
C_tmp5
 = 
	`_mm_add_ïi32
–
C_tmp4
, C_tmp5 );

97 
C_tmp5
 = 
	`_mm_¶li_ïi32
( C_tmp5, 1 );

99 
C_tmp5
 = 
	`_mm_add_ïi32
–C_tmp5, 
	`_mm_shufÊe_ïi32
–C_tmp5, 
	`_MM_SHUFFLE
( 0, 0, 0, 2 ) ) );

100 
sum2_Q16
 = 
	`_mm_cvtsi128_si32
–
C_tmp5
 );

102 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 0 ], 
diff_Q14
[ 0 ] );

103 
sum1_Q14
 = 
	`sûk_SMLAWB
–sum1_Q14, 
sum2_Q16
, 
diff_Q14
[ 0 ] );

106 
sum2_Q16
 = 
	`sûk_SMULWB
–
W_Q18
[ 7 ], 
diff_Q14
[ 2 ] );

107 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 8 ], 
diff_Q14
[ 3 ] );

108 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 9 ], 
diff_Q14
[ 4 ] );

109 
sum2_Q16
 = 
	`sûk_LSHIFT
( sum2_Q16, 1 );

110 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 6 ], 
diff_Q14
[ 1 ] );

111 
sum1_Q14
 = 
	`sûk_SMLAWB
–sum1_Q14, 
sum2_Q16
, 
diff_Q14
[ 1 ] );

114 
sum2_Q16
 = 
	`sûk_SMULWB
–
W_Q18
[ 13 ], 
diff_Q14
[ 3 ] );

115 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 14 ], 
diff_Q14
[ 4 ] );

116 
sum2_Q16
 = 
	`sûk_LSHIFT
( sum2_Q16, 1 );

117 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 12 ], 
diff_Q14
[ 2 ] );

118 
sum1_Q14
 = 
	`sûk_SMLAWB
–sum1_Q14, 
sum2_Q16
, 
diff_Q14
[ 2 ] );

121 
sum2_Q16
 = 
	`sûk_SMULWB
–
W_Q18
[ 19 ], 
diff_Q14
[ 4 ] );

122 
sum2_Q16
 = 
	`sûk_LSHIFT
( sum2_Q16, 1 );

123 
sum2_Q16
 = 
	`sûk_SMLAWB
–sum2_Q16, 
W_Q18
[ 18 ], 
diff_Q14
[ 3 ] );

124 
sum1_Q14
 = 
	`sûk_SMLAWB
–sum1_Q14, 
sum2_Q16
, 
diff_Q14
[ 3 ] );

127 
sum2_Q16
 = 
	`sûk_SMULWB
–
W_Q18
[ 24 ], 
diff_Q14
[ 4 ] );

128 
sum1_Q14
 = 
	`sûk_SMLAWB
–sum1_Q14, 
sum2_Q16
, 
diff_Q14
[ 4 ] );

130 
	`sûk_as£π
–
sum1_Q14
 >= 0 );

133 if–
sum1_Q14
 < *
øã_di°_Q14
 ) {

134 *
øã_di°_Q14
 = 
sum1_Q14
;

135 *
öd
 = (
›us_öt8
)
k
;

136 *
gaö_Q7
 = 
gaö_tmp_Q7
;

140 
cb_row_Q7
 +
LTP_ORDER
;

142 
	}
}

	@silk/x86/main_sse.h

28 #i‚de‡
MAIN_SSE_H


29 
	#MAIN_SSE_H


	)

31 #ifde‡
HAVE_CONFIG_H


32 
	~"c⁄fig.h
"

35 #i‡
deföed
(
OPUS_X86_MAY_HAVE_SSE4_1
)

38 
	#OVERRIDE_sûk_VQ_WM©_EC


	)

40 
sûk_VQ_WM©_EC_s£4_1
(

41 
›us_öt8
 *
öd
,

42 
›us_öt32
 *
øã_di°_Q14
,

43 
›us_öt
 *
gaö_Q7
,

44 c⁄° 
›us_öt16
 *
ö_Q14
,

45 c⁄° 
›us_öt32
 *
W_Q18
,

46 c⁄° 
›us_öt8
 *
cb_Q7
,

47 c⁄° 
›us_uöt8
 *
cb_gaö_Q7
,

48 c⁄° 
›us_uöt8
 *
˛_Q5
,

49 c⁄° 
›us_öt
 
mu_Q9
,

50 c⁄° 
›us_öt32
 
max_gaö_Q7
,

51 
›us_öt
 
L


54 #i‡
deföed
 
OPUS_X86_PRESUME_SSE4_1


56 
	#sûk_VQ_WM©_EC
(
öd
, 
øã_di°_Q14
, 
gaö_Q7
, 
ö_Q14
, 
W_Q18
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, \

57 
mu_Q9
, 
max_gaö_Q7
, 
L
, 
¨ch
) \

58 (()(
¨ch
),
	`sûk_VQ_WM©_EC_s£4_1
(
öd
, 
øã_di°_Q14
, 
gaö_Q7
, 
ö_Q14
, 
W_Q18
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, \

59 
mu_Q9
, 
max_gaö_Q7
, 
L
))

	)

63 (*c⁄° 
SILK_VQ_WMAT_EC_IMPL
[
OPUS_ARCHMASK
 + 1])(

64 
›us_öt8
 *
öd
,

65 
›us_öt32
 *
øã_di°_Q14
,

66 
›us_öt
 *
gaö_Q7
,

67 c⁄° 
›us_öt16
 *
ö_Q14
,

68 c⁄° 
›us_öt32
 *
W_Q18
,

69 c⁄° 
›us_öt8
 *
cb_Q7
,

70 c⁄° 
›us_uöt8
 *
cb_gaö_Q7
,

71 c⁄° 
›us_uöt8
 *
˛_Q5
,

72 c⁄° 
›us_öt
 
mu_Q9
,

73 c⁄° 
›us_öt32
 
max_gaö_Q7
,

74 
›us_öt
 
L


77 
	#sûk_VQ_WM©_EC
(
öd
, 
øã_di°_Q14
, 
gaö_Q7
, 
ö_Q14
, 
W_Q18
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, \

78 
mu_Q9
, 
max_gaö_Q7
, 
L
, 
¨ch
) \

79 ((*
SILK_VQ_WMAT_EC_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
öd
, 
øã_di°_Q14
, 
gaö_Q7
, 
ö_Q14
, 
W_Q18
, 
cb_Q7
, 
cb_gaö_Q7
, 
˛_Q5
, \

80 
mu_Q9
, 
max_gaö_Q7
, 
L
))

	)

86 
	#OVERRIDE_sûk_NSQ


	)

88 
sûk_NSQ_s£4_1
(

89 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

90 
sûk_nsq_°©e
 *
NSQ
,

91 
SideInfoIndi˚s
 *
psIndi˚s
,

92 c⁄° 
›us_öt32
 
x_Q3
[],

93 
›us_öt8
 
pul£s
[],

94 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

95 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

96 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

97 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

98 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

99 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

100 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

101 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

102 c⁄° 
›us_öt
 
Lambda_Q10
,

103 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


106 #i‡
deföed
 
OPUS_X86_PRESUME_SSE4_1


108 
	#sûk_NSQ
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

109 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

110 (()(
¨ch
),
	`sûk_NSQ_s£4_1
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

111 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

115 (*c⁄° 
SILK_NSQ_IMPL
[
OPUS_ARCHMASK
 + 1])(

116 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

117 
sûk_nsq_°©e
 *
NSQ
,

118 
SideInfoIndi˚s
 *
psIndi˚s
,

119 c⁄° 
›us_öt32
 
x_Q3
[],

120 
›us_öt8
 
pul£s
[],

121 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

122 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

123 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

124 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

125 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

126 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

127 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

128 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

129 c⁄° 
›us_öt
 
Lambda_Q10
,

130 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


133 
	#sûk_NSQ
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

134 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

135 ((*
SILK_NSQ_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

136 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

140 
	#OVERRIDE_sûk_NSQ_dñ_dec


	)

142 
sûk_NSQ_dñ_dec_s£4_1
(

143 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

144 
sûk_nsq_°©e
 *
NSQ
,

145 
SideInfoIndi˚s
 *
psIndi˚s
,

146 c⁄° 
›us_öt32
 
x_Q3
[],

147 
›us_öt8
 
pul£s
[],

148 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

149 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

150 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

151 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

152 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

153 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

154 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

155 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

156 c⁄° 
›us_öt
 
Lambda_Q10
,

157 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


160 #i‡
deföed
 
OPUS_X86_PRESUME_SSE4_1


162 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

163 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

164 (()(
¨ch
),
	`sûk_NSQ_dñ_dec_s£4_1
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

165 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

169 (*c⁄° 
SILK_NSQ_DEL_DEC_IMPL
[
OPUS_ARCHMASK
 + 1])(

170 c⁄° 
sûk_ícodî_°©e
 *
psEncC
,

171 
sûk_nsq_°©e
 *
NSQ
,

172 
SideInfoIndi˚s
 *
psIndi˚s
,

173 c⁄° 
›us_öt32
 
x_Q3
[],

174 
›us_öt8
 
pul£s
[],

175 c⁄° 
›us_öt16
 
PªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

176 c⁄° 
›us_öt16
 
LTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

177 c⁄° 
›us_öt16
 
AR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

178 c⁄° 
›us_öt
 
H¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

179 c⁄° 
›us_öt
 
Tût_Q14
[ 
MAX_NB_SUBFR
 ],

180 c⁄° 
›us_öt32
 
LF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

181 c⁄° 
›us_öt32
 
Gaös_Q16
[ 
MAX_NB_SUBFR
 ],

182 c⁄° 
›us_öt
 
pôchL
[ 
MAX_NB_SUBFR
 ],

183 c⁄° 
›us_öt
 
Lambda_Q10
,

184 c⁄° 
›us_öt
 
LTP_sˇÀ_Q14


187 
	#sûk_NSQ_dñ_dec
(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

188 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
, 
¨ch
) \

189 ((*
SILK_NSQ_DEL_DEC_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
psEncC
, 
NSQ
, 
psIndi˚s
, 
x_Q3
, 
pul£s
, 
PªdC€f_Q12
, 
LTPC€f_Q14
, 
AR2_Q13
, \

190 
H¨mSh≠eGaö_Q14
, 
Tût_Q14
, 
LF_shp_Q14
, 
Gaös_Q16
, 
pôchL
, 
Lambda_Q10
, 
LTP_sˇÀ_Q14
))

	)

195 
sûk_noi£_sh≠e_qu™tizî
(

196 
sûk_nsq_°©e
 *
NSQ
,

197 
›us_öt
 
sig«lTy≥
,

198 c⁄° 
›us_öt32
 
x_sc_Q10
[],

199 
›us_öt8
 
pul£s
[],

200 
›us_öt16
 
xq
[],

201 
›us_öt32
 
sLTP_Q15
[],

202 c⁄° 
›us_öt16
 
a_Q12
[],

203 c⁄° 
›us_öt16
 
b_Q14
[],

204 c⁄° 
›us_öt16
 
AR_shp_Q13
[],

205 
›us_öt
 
œg
,

206 
›us_öt32
 
H¨mSh≠eFIRPacked_Q14
,

207 
›us_öt
 
Tût_Q14
,

208 
›us_öt32
 
LF_shp_Q14
,

209 
›us_öt32
 
Gaö_Q16
,

210 
›us_öt
 
Lambda_Q10
,

211 
›us_öt
 
off£t_Q10
,

212 
›us_öt
 
Àngth
,

213 
›us_öt
 
sh≠ögLPCOrdî
,

214 
›us_öt
 
¥edi˘LPCOrdî
,

215 
¨ch


221 
sûk_VAD_GëNoi£Levñs
(

222 c⁄° 
›us_öt32
 
pX
[ 
VAD_N_BANDS
 ],

223 
sûk_VAD_°©e
 *
psSûk_VAD


226 
	#OVERRIDE_sûk_VAD_GëSA_Q8


	)

228 
›us_öt
 
sûk_VAD_GëSA_Q8_s£4_1
(

229 
sûk_ícodî_°©e
 *
psEnC
,

230 c⁄° 
›us_öt16
 
pIn
[]

233 #i‡
deföed
(
OPUS_X86_PRESUME_SSE4_1
)

234 
	#sûk_VAD_GëSA_Q8
(
psEnC
, 
pIn
, 
¨ch
Ë(()◊rch),
	`sûk_VAD_GëSA_Q8_s£4_1
’sEnC,ÖIn))

	)

238 
	#sûk_VAD_GëSA_Q8
(
psEnC
, 
pIn
, 
¨ch
) \

239 ((*
SILK_VAD_GETSA_Q8_IMPL
[(
¨ch
Ë& 
OPUS_ARCHMASK
])(
psEnC
, 
pIn
))

	)

241 
›us_öt
 (*c⁄° 
SILK_VAD_GETSA_Q8_IMPL
[
OPUS_ARCHMASK
 + 1])(

242 
sûk_ícodî_°©e
 *
psEnC
,

243 c⁄° 
›us_öt16
 
pIn
[]);

	@silk/x86/x86_silk_map.c

28 #i‡
deföed
(
HAVE_CONFIG_H
)

29 
	~"c⁄fig.h
"

32 
	~"˚…/x86/x86˝u.h
"

33 
	~"°ru˘s.h
"

34 
	~"SigProc_FIX.h
"

35 
	~"pôch.h
"

36 
	~"maö.h
"

38 #i‡!
deföed
(
OPUS_X86_PRESUME_SSE4_1
)

40 #i‡
deföed
(
FIXED_POINT
)

42 
	~"fixed/maö_FIX.h
"

44 
›us_öt64
 (*c⁄° 
SILK_INNER_PROD16_ALIGNED_64_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

45 c⁄° 
›us_öt16
 *
	göVec1
,

46 c⁄° 
›us_öt16
 *
	göVec2
,

47 c⁄° 
›us_öt
 
	gÀn


49 
sûk_ö√r_¥od16_Æig√d_64_c
,

50 
sûk_ö√r_¥od16_Æig√d_64_c
,

51 
sûk_ö√r_¥od16_Æig√d_64_c
,

52 
MAY_HAVE_SSE4_1
–
sûk_ö√r_¥od16_Æig√d_64
 ),

53 
MAY_HAVE_SSE4_1
–
sûk_ö√r_¥od16_Æig√d_64
 )

58 
›us_öt
 (*c⁄° 
SILK_VAD_GETSA_Q8_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

59 
sûk_ícodî_°©e
 *
	gpsEncC
,

60 c⁄° 
›us_öt16
 
	gpIn
[]

62 
sûk_VAD_GëSA_Q8_c
,

63 
sûk_VAD_GëSA_Q8_c
,

64 
sûk_VAD_GëSA_Q8_c
,

65 
MAY_HAVE_SSE4_1
–
sûk_VAD_GëSA_Q8
 ),

66 
MAY_HAVE_SSE4_1
–
sûk_VAD_GëSA_Q8
 )

70 (*c⁄° 
	gSILK_NSQ_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

71 c⁄° 
sûk_ícodî_°©e
 *
	gpsEncC
,

72 
sûk_nsq_°©e
 *
	gNSQ
,

73 
SideInfoIndi˚s
 *
	gpsIndi˚s
,

74 c⁄° 
›us_öt32
 
	gx_Q3
[],

75 
›us_öt8
 
	gpul£s
[],

76 c⁄° 
›us_öt16
 
	gPªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

77 c⁄° 
›us_öt16
 
	gLTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

78 c⁄° 
›us_öt16
 
	gAR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

79 c⁄° 
›us_öt
 
	gH¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

80 c⁄° 
›us_öt
 
	gTût_Q14
[ 
MAX_NB_SUBFR
 ],

81 c⁄° 
›us_öt32
 
	gLF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

82 c⁄° 
›us_öt32
 
	gGaös_Q16
[ 
MAX_NB_SUBFR
 ],

83 c⁄° 
›us_öt
 
	gpôchL
[ 
MAX_NB_SUBFR
 ],

84 c⁄° 
›us_öt
 
	gLambda_Q10
,

85 c⁄° 
›us_öt
 
	gLTP_sˇÀ_Q14


87 
sûk_NSQ_c
,

88 
sûk_NSQ_c
,

89 
sûk_NSQ_c
,

90 
MAY_HAVE_SSE4_1
–
sûk_NSQ
 ),

91 
MAY_HAVE_SSE4_1
–
sûk_NSQ
 )

96 (*c⁄° 
	gSILK_VQ_WMAT_EC_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

97 
›us_öt8
 *
	göd
,

98 
›us_öt32
 *
	gøã_di°_Q14
,

99 
›us_öt
 *
	ggaö_Q7
,

100 c⁄° 
›us_öt16
 *
	gö_Q14
,

101 c⁄° 
›us_öt32
 *
	gW_Q18
,

102 c⁄° 
›us_öt8
 *
	gcb_Q7
,

103 c⁄° 
›us_uöt8
 *
	gcb_gaö_Q7
,

104 c⁄° 
›us_uöt8
 *
	g˛_Q5
,

105 c⁄° 
›us_öt
 
	gmu_Q9
,

106 c⁄° 
›us_öt32
 
	gmax_gaö_Q7
,

107 
›us_öt
 
	gL


109 
sûk_VQ_WM©_EC_c
,

110 
sûk_VQ_WM©_EC_c
,

111 
sûk_VQ_WM©_EC_c
,

112 
MAY_HAVE_SSE4_1
–
sûk_VQ_WM©_EC
 ),

113 
MAY_HAVE_SSE4_1
–
sûk_VQ_WM©_EC
 )

118 (*c⁄° 
	gSILK_NSQ_DEL_DEC_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

119 c⁄° 
sûk_ícodî_°©e
 *
	gpsEncC
,

120 
sûk_nsq_°©e
 *
	gNSQ
,

121 
SideInfoIndi˚s
 *
	gpsIndi˚s
,

122 c⁄° 
›us_öt32
 
	gx_Q3
[],

123 
›us_öt8
 
	gpul£s
[],

124 c⁄° 
›us_öt16
 
	gPªdC€f_Q12
[ 2 * 
MAX_LPC_ORDER
 ],

125 c⁄° 
›us_öt16
 
	gLTPC€f_Q14
[ 
LTP_ORDER
 * 
MAX_NB_SUBFR
 ],

126 c⁄° 
›us_öt16
 
	gAR2_Q13
[ 
MAX_NB_SUBFR
 * 
MAX_SHAPE_LPC_ORDER
 ],

127 c⁄° 
›us_öt
 
	gH¨mSh≠eGaö_Q14
[ 
MAX_NB_SUBFR
 ],

128 c⁄° 
›us_öt
 
	gTût_Q14
[ 
MAX_NB_SUBFR
 ],

129 c⁄° 
›us_öt32
 
	gLF_shp_Q14
[ 
MAX_NB_SUBFR
 ],

130 c⁄° 
›us_öt32
 
	gGaös_Q16
[ 
MAX_NB_SUBFR
 ],

131 c⁄° 
›us_öt
 
	gpôchL
[ 
MAX_NB_SUBFR
 ],

132 c⁄° 
›us_öt
 
	gLambda_Q10
,

133 c⁄° 
›us_öt
 
	gLTP_sˇÀ_Q14


135 
sûk_NSQ_dñ_dec_c
,

136 
sûk_NSQ_dñ_dec_c
,

137 
sûk_NSQ_dñ_dec_c
,

138 
MAY_HAVE_SSE4_1
–
sûk_NSQ_dñ_dec
 ),

139 
MAY_HAVE_SSE4_1
–
sûk_NSQ_dñ_dec
 )

143 #i‡
deföed
(
FIXED_POINT
)

145 (*c⁄° 
	gSILK_BURG_MODIFIED_IMPL
[ 
OPUS_ARCHMASK
 + 1 ] )(

146 
›us_öt32
 *
	gªs_ƒg
,

147 
›us_öt
 *
	gªs_ƒg_Q
,

148 
›us_öt32
 
	gA_Q16
[],

149 c⁄° 
›us_öt16
 
	gx
[],

150 c⁄° 
›us_öt32
 
	gmöInvGaö_Q30
,

151 c⁄° 
›us_öt
 
	gsub‰_Àngth
,

152 c⁄° 
›us_öt
 
	gnb_sub‰
,

153 c⁄° 
›us_öt
 
	gD
,

154 
	g¨ch


156 
sûk_burg_modifõd_c
,

157 
sûk_burg_modifõd_c
,

158 
sûk_burg_modifõd_c
,

159 
MAY_HAVE_SSE4_1
–
sûk_burg_modifõd
 ),

160 
MAY_HAVE_SSE4_1
–
sûk_burg_modifõd
 )

	@src/analysis.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	#ANALYSIS_C


	)

34 
	~<°dio.h
>

36 
	~"m©h›s.h
"

37 
	~"kiss_f·.h
"

38 
	~"˚….h
"

39 
	~"modes.h
"

40 
	~"¨ch.h
"

41 
	~"qu™t_b™ds.h
"

42 
	~"™Æysis.h
"

43 
	~"mÕ.h
"

44 
	~"°ack_Æloc.h
"

45 
	~"Êﬂt_ˇ°.h
"

47 #i‚de‡
M_PI


48 
	#M_PI
 3.141592653

	)

51 #i‚de‡
DISABLE_FLOAT_API


53 
	#TRANSITION_PENALTY
 10

	)

55 c⁄° 
	gd˘_èbÀ
[128] = {

74 c⁄° 
	g™Æysis_wödow
[240] = {

107 c⁄° 
	gtb™ds
[
NB_TBANDS
+1] = {

111 
	#NB_TONAL_SKIP_BANDS
 9

	)

113 
›us_vÆ32
 
	$sûk_ªßm∂î_down2_hp
(

114 
›us_vÆ32
 *
S
,

115 
›us_vÆ32
 *
out
,

116 c⁄° 
›us_vÆ32
 *
ö
,

117 
öLí


120 
k
, 
Àn2
 = 
öLí
/2;

121 
›us_vÆ32
 
ö32
, 
out32
, 
out32_hp
, 
Y
, 
X
;

122 
›us_vÆ64
 
hp_íî
 = 0;

124  
k
 = 0; k < 
Àn2
; k++ ) {

126 
ö32
 = 
ö
[ 2 * 
k
 ];

129 
Y
 = 
	`SUB32
–
ö32
, 
S
[ 0 ] );

130 
X
 = 
	`MULT16_32_Q15
(
	`QCONST16
(0.6074371f, 15), 
Y
);

131 
out32
 = 
	`ADD32
–
S
[ 0 ], 
X
 );

132 
S
[ 0 ] = 
	`ADD32
–
ö32
, 
X
 );

133 
out32_hp
 = 
out32
;

135 
ö32
 = 
ö
[ 2 * 
k
 + 1 ];

138 
Y
 = 
	`SUB32
–
ö32
, 
S
[ 1 ] );

139 
X
 = 
	`MULT16_32_Q15
(
	`QCONST16
(0.15063f, 15), 
Y
);

140 
out32
 = 
	`ADD32
–out32, 
S
[ 1 ] );

141 
out32
 = 
	`ADD32
–out32, 
X
 );

142 
S
[ 1 ] = 
	`ADD32
–
ö32
, 
X
 );

144 
Y
 = 
	`SUB32
–-
ö32
, 
S
[ 2 ] );

145 
X
 = 
	`MULT16_32_Q15
(
	`QCONST16
(0.15063f, 15), 
Y
);

146 
out32_hp
 = 
	`ADD32
–out32_hp, 
S
[ 2 ] );

147 
out32_hp
 = 
	`ADD32
–out32_hp, 
X
 );

148 
S
[ 2 ] = 
	`ADD32
–-
ö32
, 
X
 );

150 
hp_íî
 +
out32_hp
*(
›us_vÆ64
)out32_hp;

152 
out
[ 
k
 ] = 
	`HALF32
(
out32
);

154 #ifde‡
FIXED_POINT


156 
hp_íî
 = hp_íî >> (2*
SIG_SHIFT
 + 8);

158  (
›us_vÆ32
)
hp_íî
;

159 
	}
}

161 
›us_vÆ32
 
	$downmix_™d_ªßm∂e
(
downmix_func
 
downmix
, c⁄° *
_x
, 
›us_vÆ32
 *
y
, opus_vÆ32 
S
[3], 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
, 
Fs
)

163 
	`VARDECL
(
›us_vÆ32
, 
tmp
);

164 
›us_vÆ32
 
sˇÀ
;

165 
j
;

166 
›us_vÆ32
 
ªt
 = 0;

167 
SAVE_STACK
;

169 i‡(
sub‰ame
==0)  0;

170 i‡(
Fs
 == 48000)

172 
sub‰ame
 *= 2;

173 
off£t
 *= 2;

174 } i‡(
Fs
 == 16000) {

175 
sub‰ame
 = subframe*2/3;

176 
off£t
 = offset*2/3;

178 
	`ALLOC
(
tmp
, 
sub‰ame
, 
›us_vÆ32
);

180 
	`downmix
(
_x
, 
tmp
, 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
);

181 #ifde‡
FIXED_POINT


182 
sˇÀ
 = (1<<
SIG_SHIFT
);

184 
sˇÀ
 = 1.f/32768;

186 i‡(
c2
==-2)

187 
sˇÀ
 /
C
;

188 i‡(
c2
>-1)

189 
sˇÀ
 /= 2;

190 
j
=0;j<
sub‰ame
;j++)

191 
tmp
[
j
] *
sˇÀ
;

192 i‡(
Fs
 == 48000)

194 
ªt
 = 
	`sûk_ªßm∂î_down2_hp
(
S
, 
y
, 
tmp
, 
sub‰ame
);

195 } i‡(
Fs
 == 24000) {

196 
	`OPUS_COPY
(
y
, 
tmp
, 
sub‰ame
);

197 } i‡(
Fs
 == 16000) {

198 
	`VARDECL
(
›us_vÆ32
, 
tmp3x
);

199 
	`ALLOC
(
tmp3x
, 3*
sub‰ame
, 
›us_vÆ32
);

203 
j
=0;j<
sub‰ame
;j++)

205 
tmp3x
[3*
j
] = 
tmp
[j];

206 
tmp3x
[3*
j
+1] = 
tmp
[j];

207 
tmp3x
[3*
j
+2] = 
tmp
[j];

209 
	`sûk_ªßm∂î_down2_hp
(
S
, 
y
, 
tmp3x
, 3*
sub‰ame
);

211 
RESTORE_STACK
;

212  
ªt
;

213 
	}
}

215 
	$t⁄Æôy_™Æysis_öô
(
T⁄ÆôyA«lysisSèã
 *
t⁄Æ
, 
›us_öt32
 
Fs
)

218 
t⁄Æ
->
¨ch
 = 
	`›us_£À˘_¨ch
();

219 
t⁄Æ
->
Fs
 = Fs;

221 
	`t⁄Æôy_™Æysis_ª£t
(
t⁄Æ
);

222 
	}
}

224 
	$t⁄Æôy_™Æysis_ª£t
(
T⁄ÆôyA«lysisSèã
 *
t⁄Æ
)

227 *
°¨t
 = (*)&
t⁄Æ
->
TONALITY_ANALYSIS_RESET_START
;

228 
	`OPUS_CLEAR
(
°¨t
, (
T⁄ÆôyA«lysisSèã
Ë- (°¨à- (*)
t⁄Æ
));

229 
	}
}

231 
	$t⁄Æôy_gë_öfo
(
T⁄ÆôyA«lysisSèã
 *
t⁄Æ
, 
A«lysisInfo
 *
öfo_out
, 
Àn
)

233 
pos
;

234 
cuº_lookahód
;

235 
t⁄Æôy_max
;

236 
t⁄Æôy_avg
;

237 
t⁄Æôy_cou¡
;

238 
i
;

239 
pos0
;

240 
¥ob_avg
;

241 
¥ob_cou¡
;

242 
¥ob_mö
, 
¥ob_max
;

243 
vad_¥ob
;

244 
mpos
, 
vpos
;

245 
b™dwidth_•™
;

247 
pos
 = 
t⁄Æ
->
ªad_pos
;

248 
cuº_lookahód
 = 
t⁄Æ
->
wrôe_pos
-t⁄Æ->
ªad_pos
;

249 i‡(
cuº_lookahód
<0)

250 
cuº_lookahód
 +
DETECT_SIZE
;

252 
t⁄Æ
->
ªad_sub‰ame
 +
Àn
/—⁄Æ->
Fs
/400);

253 
t⁄Æ
->
ªad_sub‰ame
>=8)

255 
t⁄Æ
->
ªad_sub‰ame
 -= 8;

256 
t⁄Æ
->
ªad_pos
++;

258 i‡(
t⁄Æ
->
ªad_pos
>=
DETECT_SIZE
)

259 
t⁄Æ
->
ªad_pos
-=
DETECT_SIZE
;

262 i‡(
Àn
 > 
t⁄Æ
->
Fs
/50 && 
pos
 !t⁄Æ->
wrôe_pos
)

264 
pos
++;

265 i‡(
pos
==
DETECT_SIZE
)

266 
pos
=0;

268 i‡(
pos
 =
t⁄Æ
->
wrôe_pos
)

269 
pos
--;

270 i‡(
pos
<0)

271 
pos
 = 
DETECT_SIZE
-1;

272 
pos0
 = 
pos
;

273 
	`OPUS_COPY
(
öfo_out
, &
t⁄Æ
->
öfo
[
pos
], 1);

274 i‡(!
öfo_out
->
vÆid
)

276 
t⁄Æôy_max
 = 
t⁄Æôy_avg
 = 
öfo_out
->
t⁄Æôy
;

277 
t⁄Æôy_cou¡
 = 1;

279 
b™dwidth_•™
 = 6;

281 
i
=0;i<3;i++)

283 
pos
++;

284 i‡(
pos
==
DETECT_SIZE
)

285 
pos
 = 0;

286 i‡(
pos
 =
t⁄Æ
->
wrôe_pos
)

288 
t⁄Æôy_max
 = 
	`MAX32
—⁄Æôy_max, 
t⁄Æ
->
öfo
[
pos
].
t⁄Æôy
);

289 
t⁄Æôy_avg
 +
t⁄Æ
->
öfo
[
pos
].
t⁄Æôy
;

290 
t⁄Æôy_cou¡
++;

291 
öfo_out
->
b™dwidth
 = 
	`IMAX
(öfo_out->b™dwidth, 
t⁄Æ
->
öfo
[
pos
].bandwidth);

292 
b™dwidth_•™
--;

294 
pos
 = 
pos0
;

296 
i
=0;i<
b™dwidth_•™
;i++)

298 
pos
--;

299 i‡(
pos
 < 0)

300 
pos
 = 
DETECT_SIZE
-1;

301 i‡(
pos
 =
t⁄Æ
->
wrôe_pos
)

303 
öfo_out
->
b™dwidth
 = 
	`IMAX
(öfo_out->b™dwidth, 
t⁄Æ
->
öfo
[
pos
].bandwidth);

305 
öfo_out
->
t⁄Æôy
 = 
	`MAX32
(
t⁄Æôy_avg
/
t⁄Æôy_cou¡
, 
t⁄Æôy_max
-.2f);

307 
mpos
 = 
vpos
 = 
pos0
;

310 i‡(
cuº_lookahód
 > 15)

312 
mpos
 += 5;

313 i‡(
mpos
>=
DETECT_SIZE
)

314 
mpos
 -
DETECT_SIZE
;

315 
vpos
 += 1;

316 i‡(
vpos
>=
DETECT_SIZE
)

317 
vpos
 -
DETECT_SIZE
;

351 
¥ob_mö
 = 1.f;

352 
¥ob_max
 = 0.f;

353 
vad_¥ob
 = 
t⁄Æ
->
öfo
[
vpos
].
a˘ivôy_¥obabûôy
;

354 
¥ob_cou¡
 = 
	`MAX16
(.1f, 
vad_¥ob
);

355 
¥ob_avg
 = 
	`MAX16
(.1f, 
vad_¥ob
)*
t⁄Æ
->
öfo
[
mpos
].
music_¥ob
;

358 
pos_vad
;

359 
mpos
++;

360 i‡(
mpos
==
DETECT_SIZE
)

361 
mpos
 = 0;

362 i‡(
mpos
 =
t⁄Æ
->
wrôe_pos
)

364 
vpos
++;

365 i‡(
vpos
==
DETECT_SIZE
)

366 
vpos
 = 0;

367 i‡(
vpos
 =
t⁄Æ
->
wrôe_pos
)

369 
pos_vad
 = 
t⁄Æ
->
öfo
[
vpos
].
a˘ivôy_¥obabûôy
;

370 
¥ob_mö
 = 
	`MIN16
((
¥ob_avg
 - 
TRANSITION_PENALTY
*(
vad_¥ob
 - 
pos_vad
))/
¥ob_cou¡
,Örob_min);

371 
¥ob_max
 = 
	`MAX16
((
¥ob_avg
 + 
TRANSITION_PENALTY
*(
vad_¥ob
 - 
pos_vad
))/
¥ob_cou¡
,Örob_max);

372 
¥ob_cou¡
 +
	`MAX16
(.1f, 
pos_vad
);

373 
¥ob_avg
 +
	`MAX16
(.1f, 
pos_vad
)*
t⁄Æ
->
öfo
[
mpos
].
music_¥ob
;

375 
öfo_out
->
music_¥ob
 = 
¥ob_avg
/
¥ob_cou¡
;

376 
¥ob_mö
 = 
	`MIN16
(
¥ob_avg
/
¥ob_cou¡
,Örob_min);

377 
¥ob_max
 = 
	`MAX16
(
¥ob_avg
/
¥ob_cou¡
,Örob_max);

378 
¥ob_mö
 = 
	`MAX16
(prob_min, 0.f);

379 
¥ob_max
 = 
	`MIN16
(prob_max, 1.f);

382 i‡(
cuº_lookahód
 < 10)

384 
pmö
, 
pmax
;

385 
pmö
 = 
¥ob_mö
;

386 
pmax
 = 
¥ob_max
;

387 
pos
 = 
pos0
;

389 
i
=0;i<
	`IMIN
(
t⁄Æ
->
cou¡
-1, 15);i++)

391 
pos
--;

392 i‡(
pos
 < 0)

393 
pos
 = 
DETECT_SIZE
-1;

394 
pmö
 = 
	`MIN16
’mö, 
t⁄Æ
->
öfo
[
pos
].
music_¥ob
);

395 
pmax
 = 
	`MAX16
’max, 
t⁄Æ
->
öfo
[
pos
].
music_¥ob
);

398 
pmö
 = 
	`MAX16
(0.f,Ömö - .1f*
vad_¥ob
);

399 
pmax
 = 
	`MIN16
(1.f,Ömax + .1f*
vad_¥ob
);

400 
¥ob_mö
 +(1.f-.1f*
cuº_lookahód
)*(
pmö
 -Örob_min);

401 
¥ob_max
 +(1.f-.1f*
cuº_lookahód
)*(
pmax
 -Örob_max);

403 
öfo_out
->
music_¥ob_mö
 = 
¥ob_mö
;

404 
öfo_out
->
music_¥ob_max
 = 
¥ob_max
;

407 
	}
}

409 c⁄° 
	g°d_„©uª_büs
[9] = {

414 
	#LEAKAGE_OFFSET
 2.5f

	)

415 
	#LEAKAGE_SLOPE
 2.f

	)

417 #ifde‡
FIXED_POINT


420 
	#SCALE_COMPENS
 (1.f/((
›us_öt32
)1<<(15+
SIG_SHIFT
)))

	)

421 
	#SCALE_ENER
(
e
Ë((
SCALE_COMPENS
*SCALE_COMPENS)*”))

	)

423 
	#SCALE_ENER
(
e
Ë”)

	)

426 #ifde‡
FIXED_POINT


427 
	$is_digôÆ_sûí˚32
(c⁄° 
›us_vÆ32
* 
pcm
, 
‰ame_size
, 
ch™√ls
, 
lsb_dïth
)

429 
sûí˚
 = 0;

430 
›us_vÆ32
 
ßm∂e_max
 = 0;

431 #ifde‡
MLP_TRAINING


434 
ßm∂e_max
 = 
	`˚…_maxabs32
(
pcm
, 
‰ame_size
*
ch™√ls
);

436 
sûí˚
 = (
ßm∂e_max
 == 0);

437 ()
lsb_dïth
;

438  
sûí˚
;

439 
	}
}

441 
	#is_digôÆ_sûí˚32
(
pcm
, 
‰ame_size
, 
ch™√ls
, 
lsb_dïth
Ë
	`is_digôÆ_sûí˚
’cm, føme_size, ch™√ls,Üsb_dïth)

	)

444 
	$t⁄Æôy_™Æysis
(
T⁄ÆôyA«lysisSèã
 *
t⁄Æ
, c⁄° 
CELTMode
 *
˚…_mode
, c⁄° *
x
, 
Àn
, 
off£t
, 
c1
, 
c2
, 
C
, 
lsb_dïth
, 
downmix_func
 
downmix
)

446 
i
, 
b
;

447 c⁄° 
kiss_f·_°©e
 *
kf·
;

448 
	`VARDECL
(
kiss_f·_˝x
, 
ö
);

449 
	`VARDECL
(
kiss_f·_˝x
, 
out
);

450 
N
 = 480, 
N2
=240;

451 * 
OPUS_RESTRICT
 
A
 = 
t⁄Æ
->
™gÀ
;

452 * 
OPUS_RESTRICT
 
dA
 = 
t⁄Æ
->
d_™gÀ
;

453 * 
OPUS_RESTRICT
 
d2A
 = 
t⁄Æ
->
d2_™gÀ
;

454 
	`VARDECL
(, 
t⁄Æôy
);

455 
	`VARDECL
(, 
noisöess
);

456 
b™d_t⁄Æôy
[
NB_TBANDS
];

457 
logE
[
NB_TBANDS
];

458 
BFCC
[8];

459 
„©uªs
[25];

460 
‰ame_t⁄Æôy
;

461 
max_‰ame_t⁄Æôy
;

463 
‰ame_noisöess
;

464 c⁄° 
pi4
 = ()(
M_PI
*M_PI*M_PI*M_PI);

465 
¶›e
=0;

466 
‰ame_°©i⁄¨ôy
;

467 
ªœtiveE
;

468 
‰ame_¥obs
[2];

469 
Æpha
, 
ÆphaE
, 
ÆphaE2
;

470 
‰ame_loud√ss
;

471 
b™dwidth_mask
;

472 
is_masked
[
NB_TBANDS
+1];

473 
b™dwidth
=0;

474 
maxE
 = 0;

475 
noi£_Êo‹
;

476 
ªmaöög
;

477 
A«lysisInfo
 *
öfo
;

478 
hp_íî
;

479 
t⁄Æôy2
[240];

480 
midE
[8];

481 
•ec_v¨übûôy
=0;

482 
b™d_log2
[
NB_TBANDS
+1];

483 
Àakage_‰om
[
NB_TBANDS
+1];

484 
Àakage_to
[
NB_TBANDS
+1];

485 
œyî_out
[
MAX_NEURONS
];

486 
bñow_max_pôch
;

487 
above_max_pôch
;

488 
is_sûí˚
;

489 
SAVE_STACK
;

491 i‡(!
t⁄Æ
->
öôülized
)

493 
t⁄Æ
->
mem_fûl
 = 240;

494 
t⁄Æ
->
öôülized
 = 1;

496 
Æpha
 = 1.f/
	`IMIN
(10, 1+
t⁄Æ
->
cou¡
);

497 
ÆphaE
 = 1.f/
	`IMIN
(25, 1+
t⁄Æ
->
cou¡
);

499 
ÆphaE2
 = 1.f/
	`IMIN
(100, 1+
t⁄Æ
->
cou¡
);

500 i‡(
t⁄Æ
->
cou¡
 <1Ë
ÆphaE2
 = 1;

502 i‡(
t⁄Æ
->
Fs
 == 48000)

505 
Àn
/= 2;

506 
off£t
 /= 2;

507 } i‡(
t⁄Æ
->
Fs
 == 16000) {

508 
Àn
 = 3*len/2;

509 
off£t
 = 3*offset/2;

512 
kf·
 = 
˚…_mode
->
md˘
.kfft[0];

513 
t⁄Æ
->
hp_íî_accum
 +()
	`downmix_™d_ªßm∂e
(
downmix
, 
x
,

514 &
t⁄Æ
->
ömem
[t⁄Æ->
mem_fûl
],Å⁄Æ->
downmix_°©e
,

515 
	`IMIN
(
Àn
, 
ANALYSIS_BUF_SIZE
-
t⁄Æ
->
mem_fûl
), 
off£t
, 
c1
, 
c2
, 
C
,Å⁄Æ->
Fs
);

516 i‡(
t⁄Æ
->
mem_fûl
+
Àn
 < 
ANALYSIS_BUF_SIZE
)

518 
t⁄Æ
->
mem_fûl
 +
Àn
;

520 
RESTORE_STACK
;

523 
hp_íî
 = 
t⁄Æ
->
hp_íî_accum
;

524 
öfo
 = &
t⁄Æ
->öfo[t⁄Æ->
wrôe_pos
++];

525 i‡(
t⁄Æ
->
wrôe_pos
>=
DETECT_SIZE
)

526 
t⁄Æ
->
wrôe_pos
-=
DETECT_SIZE
;

528 
is_sûí˚
 = 
	`is_digôÆ_sûí˚32
(
t⁄Æ
->
ömem
, 
ANALYSIS_BUF_SIZE
, 1, 
lsb_dïth
);

530 
	`ALLOC
(
ö
, 480, 
kiss_f·_˝x
);

531 
	`ALLOC
(
out
, 480, 
kiss_f·_˝x
);

532 
	`ALLOC
(
t⁄Æôy
, 240, );

533 
	`ALLOC
(
noisöess
, 240, );

534 
i
=0;i<
N2
;i++)

536 
w
 = 
™Æysis_wödow
[
i
];

537 
ö
[
i
].
r
 = (
kiss_f·_sˇœr
)(
w
*
t⁄Æ
->
ömem
[i]);

538 
ö
[
i
].ò(
kiss_f·_sˇœr
)(
w
*
t⁄Æ
->
ömem
[
N2
+i]);

539 
ö
[
N
-
i
-1].
r
 = (
kiss_f·_sˇœr
)(
w
*
t⁄Æ
->
ömem
[N-i-1]);

540 
ö
[
N
-
i
-1].ò(
kiss_f·_sˇœr
)(
w
*
t⁄Æ
->
ömem
[N+
N2
-i-1]);

542 
	`OPUS_MOVE
(
t⁄Æ
->
ömem
,Å⁄Æ->ömem+
ANALYSIS_BUF_SIZE
-240, 240);

543 
ªmaöög
 = 
Àn
 - (
ANALYSIS_BUF_SIZE
-
t⁄Æ
->
mem_fûl
);

544 
t⁄Æ
->
hp_íî_accum
 = ()
	`downmix_™d_ªßm∂e
(
downmix
, 
x
,

545 &
t⁄Æ
->
ömem
[240],Å⁄Æ->
downmix_°©e
, 
ªmaöög
,

546 
off£t
+
ANALYSIS_BUF_SIZE
-
t⁄Æ
->
mem_fûl
, 
c1
, 
c2
, 
C
,Å⁄Æ->
Fs
);

547 
t⁄Æ
->
mem_fûl
 = 240 + 
ªmaöög
;

548 i‡(
is_sûí˚
)

551 
¥ev_pos
 = 
t⁄Æ
->
wrôe_pos
-2;

552 i‡(
¥ev_pos
 < 0)

553 
¥ev_pos
 +
DETECT_SIZE
;

554 
	`OPUS_COPY
(
öfo
, &
t⁄Æ
->öfo[
¥ev_pos
], 1);

555 
RESTORE_STACK
;

558 
	`›us_f·
(
kf·
, 
ö
, 
out
, 
t⁄Æ
->
¨ch
);

559 #i‚de‡
FIXED_POINT


561 i‡(
	`˚…_i¢™
(
out
[0].
r
))

563 
öfo
->
vÆid
 = 0;

564 
RESTORE_STACK
;

569 
i
=1;i<
N2
;i++)

571 
X1r
, 
X2r
, 
X1i
, 
X2i
;

572 
™gÀ
, 
d_™gÀ
, 
d2_™gÀ
;

573 
™gÀ2
, 
d_™gÀ2
, 
d2_™gÀ2
;

574 
mod1
, 
mod2
, 
avg_mod
;

575 
X1r
 = ()
out
[
i
].
r
+out[
N
-i].r;

576 
X1i
 = ()
out
[
i
].i-out[
N
-i].i;

577 
X2r
 = ()
out
[
i
].i+out[
N
-i].i;

578 
X2i
 = ()
out
[
N
-
i
].
r
-out[i].r;

580 
™gÀ
 = ()(.5f/
M_PI
)*
	`Á°_©™2f
(
X1i
, 
X1r
);

581 
d_™gÀ
 = 
™gÀ
 - 
A
[
i
];

582 
d2_™gÀ
 = 
d_™gÀ
 - 
dA
[
i
];

584 
™gÀ2
 = ()(.5f/
M_PI
)*
	`Á°_©™2f
(
X2i
, 
X2r
);

585 
d_™gÀ2
 = 
™gÀ2
 - 
™gÀ
;

586 
d2_™gÀ2
 = 
d_™gÀ2
 - 
d_™gÀ
;

588 
mod1
 = 
d2_™gÀ
 - ()
	`Êﬂt2öt
(d2_angle);

589 
noisöess
[
i
] = 
	`ABS16
(
mod1
);

590 
mod1
 *= mod1;

591 
mod1
 *= mod1;

593 
mod2
 = 
d2_™gÀ2
 - ()
	`Êﬂt2öt
(d2_angle2);

594 
noisöess
[
i
] +
	`ABS16
(
mod2
);

595 
mod2
 *= mod2;

596 
mod2
 *= mod2;

598 
avg_mod
 = .25f*(
d2A
[
i
]+
mod1
+2*
mod2
);

600 
t⁄Æôy
[
i
] = 1.f/(1.f+40.f*16.f*
pi4
*
avg_mod
)-.015f;

602 
t⁄Æôy2
[
i
] = 1.f/(1.f+40.f*16.f*
pi4
*
mod2
)-.015f;

604 
A
[
i
] = 
™gÀ2
;

605 
dA
[
i
] = 
d_™gÀ2
;

606 
d2A
[
i
] = 
mod2
;

608 
i
=2;i<
N2
-1;i++)

610 
â
 = 
	`MIN32
(
t⁄Æôy2
[
i
], 
	`MAX32
(tonality2[i-1],Åonality2[i+1]));

611 
t⁄Æôy
[
i
] = .9f*
	`MAX32
—⁄Æôy[i], 
â
-.1f);

613 
‰ame_t⁄Æôy
 = 0;

614 
max_‰ame_t⁄Æôy
 = 0;

616 
öfo
->
a˘ivôy
 = 0;

617 
‰ame_noisöess
 = 0;

618 
‰ame_°©i⁄¨ôy
 = 0;

619 i‡(!
t⁄Æ
->
cou¡
)

621 
b
=0;b<
NB_TBANDS
;b++)

623 
t⁄Æ
->
lowE
[
b
] = 1e10;

624 
t⁄Æ
->
highE
[
b
] = -1e10;

627 
ªœtiveE
 = 0;

628 
‰ame_loud√ss
 = 0;

631 
E
 = 0;

632 
X1r
, 
X2r
;

633 
X1r
 = 2*()
out
[0].
r
;

634 
X2r
 = 2*()
out
[0].
i
;

635 
E
 = 
X1r
*X1∏+ 
X2r
*X2r;

636 
i
=1;i<4;i++)

638 
böE
 = 
out
[
i
].
r
*()out[i].∏+ out[
N
-i].r*()out[N-i].r

639 + 
out
[
i
].i*()out[i].ò+ out[
N
-i].i*()out[N-i].i;

640 
E
 +
böE
;

642 
E
 = 
	`SCALE_ENER
(E);

643 
b™d_log2
[0] = .5f*1.442695f*()
	`log
(
E
+1e-10f);

645 
b
=0;b<
NB_TBANDS
;b++)

647 
E
=0, 
tE
=0, 
nE
=0;

648 
L1
, 
L2
;

649 
°©i⁄¨ôy
;

650 
i
=
tb™ds
[
b
];i<tbands[b+1];i++)

652 
böE
 = 
out
[
i
].
r
*()out[i].∏+ out[
N
-i].r*()out[N-i].r

653 + 
out
[
i
].i*()out[i].ò+ out[
N
-i].i*()out[N-i].i;

654 
böE
 = 
	`SCALE_ENER
(binE);

655 
E
 +
böE
;

656 
tE
 +
böE
*
	`MAX32
(0, 
t⁄Æôy
[
i
]);

657 
nE
 +
böE
*2.f*(.5f-
noisöess
[
i
]);

659 #i‚de‡
FIXED_POINT


661 i‡(!(
E
<1e9fË|| 
	`˚…_i¢™
(E))

663 
öfo
->
vÆid
 = 0;

664 
RESTORE_STACK
;

669 
t⁄Æ
->
E
[t⁄Æ->
E_cou¡
][
b
] = E;

670 
‰ame_noisöess
 +
nE
/(1e-15f+
E
);

672 
‰ame_loud√ss
 +()
	`sqπ
(
E
+1e-10f);

673 
logE
[
b
] = ()
	`log
(
E
+1e-10f);

674 
b™d_log2
[
b
+1] = .5f*1.442695f*()
	`log
(
E
+1e-10f);

675 
t⁄Æ
->
logE
[t⁄Æ->
E_cou¡
][
b
] =ÜogE[b];

676 i‡(
t⁄Æ
->
cou¡
==0)

677 
t⁄Æ
->
highE
[
b
] =Å⁄Æ->
lowE
[b] = 
logE
[b];

678 i‡(
t⁄Æ
->
highE
[
b
] >Å⁄Æ->
lowE
[b] + 7.5)

680 i‡(
t⁄Æ
->
highE
[
b
] - 
logE
[b] >ÜogE[b] -Å⁄Æ->
lowE
[b])

681 
t⁄Æ
->
highE
[
b
] -= .01f;

683 
t⁄Æ
->
lowE
[
b
] += .01f;

685 i‡(
logE
[
b
] > 
t⁄Æ
->
highE
[b])

687 
t⁄Æ
->
highE
[
b
] = 
logE
[b];

688 
t⁄Æ
->
lowE
[
b
] = 
	`MAX32
—⁄Æ->
highE
[b]-15,Åonal->lowE[b]);

689 } i‡(
logE
[
b
] < 
t⁄Æ
->
lowE
[b])

691 
t⁄Æ
->
lowE
[
b
] = 
logE
[b];

692 
t⁄Æ
->
highE
[
b
] = 
	`MIN32
—⁄Æ->
lowE
[b]+15,Åonal->highE[b]);

694 
ªœtiveE
 +(
logE
[
b
]-
t⁄Æ
->
lowE
[b])/(1e-5‡+ (t⁄Æ->
highE
[b]-tonal->lowE[b]));

696 
L1
=
L2
=0;

697 
i
=0;i<
NB_FRAMES
;i++)

699 
L1
 +()
	`sqπ
(
t⁄Æ
->
E
[
i
][
b
]);

700 
L2
 +
t⁄Æ
->
E
[
i
][
b
];

703 
°©i⁄¨ôy
 = 
	`MIN16
(0.99f,
L1
/()
	`sqπ
(1e-15+
NB_FRAMES
*
L2
));

704 
°©i⁄¨ôy
 *= stationarity;

705 
°©i⁄¨ôy
 *= stationarity;

706 
‰ame_°©i⁄¨ôy
 +
°©i⁄¨ôy
;

708 
b™d_t⁄Æôy
[
b
] = 
	`MAX16
(
tE
/(1e-15f+
E
), 
°©i⁄¨ôy
*
t⁄Æ
->
¥ev_b™d_t⁄Æôy
[b]);

710 i‡(
b
>=
NB_TONAL_SKIP_BANDS
)

712 
‰ame_t⁄Æôy
 +
tweight
[
b
]*
b™d_t⁄Æôy
[b];

713 
tw_sum
 +
tweight
[
b
];

716 
‰ame_t⁄Æôy
 +
b™d_t⁄Æôy
[
b
];

717 i‡(
b
>=
NB_TBANDS
-
NB_TONAL_SKIP_BANDS
)

718 
‰ame_t⁄Æôy
 -
b™d_t⁄Æôy
[
b
-
NB_TBANDS
+
NB_TONAL_SKIP_BANDS
];

720 
max_‰ame_t⁄Æôy
 = 
	`MAX16
(max_‰ame_t⁄Æôy, (1.f+.03f*(
b
-
NB_TBANDS
))*
‰ame_t⁄Æôy
);

721 
¶›e
 +
b™d_t⁄Æôy
[
b
]*(b-8);

723 
t⁄Æ
->
¥ev_b™d_t⁄Æôy
[
b
] = 
b™d_t⁄Æôy
[b];

726 
Àakage_‰om
[0] = 
b™d_log2
[0];

727 
Àakage_to
[0] = 
b™d_log2
[0] - 
LEAKAGE_OFFSET
;

728 
b
=1;b<
NB_TBANDS
+1;b++)

730 
Àak_¶›e
 = 
LEAKAGE_SLOPE
*(
tb™ds
[
b
]-tbands[b-1])/4;

731 
Àakage_‰om
[
b
] = 
	`MIN16
÷ókage_‰om[b-1]+
Àak_¶›e
, 
b™d_log2
[b]);

732 
Àakage_to
[
b
] = 
	`MAX16
÷ókage_to[b-1]-
Àak_¶›e
, 
b™d_log2
[b]-
LEAKAGE_OFFSET
);

734 
b
=
NB_TBANDS
-2;b>=0;b--)

736 
Àak_¶›e
 = 
LEAKAGE_SLOPE
*(
tb™ds
[
b
+1]-tbands[b])/4;

737 
Àakage_‰om
[
b
] = 
	`MIN16
÷ókage_‰om[b+1]+
Àak_¶›e
,Üeakage_from[b]);

738 
Àakage_to
[
b
] = 
	`MAX16
÷ókage_to[b+1]-
Àak_¶›e
,Üeakage_to[b]);

740 
	`˚…_as£π
(
NB_TBANDS
+1 <
LEAK_BANDS
);

741 
b
=0;b<
NB_TBANDS
+1;b++)

749 
boo°
 = 
	`MAX16
(0, 
Àakage_to
[
b
] - 
b™d_log2
[b]) +

750 
	`MAX16
(0, 
b™d_log2
[
b
] - (
Àakage_‰om
[b]+
LEAKAGE_OFFSET
));

751 
öfo
->
Àak_boo°
[
b
] = 
	`IMIN
(255, ()
	`Êo‹
(.5 + 64.f*
boo°
));

753 ;
b
<
LEAK_BANDS
;b++Ë
öfo
->
Àak_boo°
[b] = 0;

755 
i
=0;i<
NB_FRAMES
;i++)

757 
j
;

758 
mödi°
 = 1e15f;

759 
j
=0;j<
NB_FRAMES
;j++)

761 
k
;

762 
di°
=0;

763 
k
=0;k<
NB_TBANDS
;k++)

765 
tmp
;

766 
tmp
 = 
t⁄Æ
->
logE
[
i
][
k
] -Å⁄Æ->logE[
j
][k];

767 
di°
 +
tmp
*tmp;

769 i‡(
j
!=
i
)

770 
mödi°
 = 
	`MIN32
(mödi°, 
di°
);

772 
•ec_v¨übûôy
 +
mödi°
;

774 
•ec_v¨übûôy
 = ()
	`sqπ
(•ec_v¨übûôy/
NB_FRAMES
/
NB_TBANDS
);

775 
b™dwidth_mask
 = 0;

776 
b™dwidth
 = 0;

777 
maxE
 = 0;

778 
noi£_Êo‹
 = 5.7e-4f/(1<<(
	`IMAX
(0,
lsb_dïth
-8)));

779 
noi£_Êo‹
 *=Çoise_floor;

780 
bñow_max_pôch
=0;

781 
above_max_pôch
=0;

782 
b
=0;b<
NB_TBANDS
;b++)

784 
E
=0;

785 
Em
;

786 
b™d_°¨t
, 
b™d_íd
;

788 
b™d_°¨t
 = 
tb™ds
[
b
];

789 
b™d_íd
 = 
tb™ds
[
b
+1];

790 
i
=
b™d_°¨t
;i<
b™d_íd
;i++)

792 
böE
 = 
out
[
i
].
r
*()out[i].∏+ out[
N
-i].r*()out[N-i].r

793 + 
out
[
i
].i*()out[i].ò+ out[
N
-i].i*()out[N-i].i;

794 
E
 +
böE
;

796 
E
 = 
	`SCALE_ENER
(E);

797 
maxE
 = 
	`MAX32
(maxE, 
E
);

798 i‡(
b™d_°¨t
 < 64)

800 
bñow_max_pôch
 +
E
;

802 
above_max_pôch
 +
E
;

804 
t⁄Æ
->
mónE
[
b
] = 
	`MAX32
((1-
ÆphaE2
)*t⁄Æ->mónE[b], 
E
);

805 
Em
 = 
	`MAX32
(
E
, 
t⁄Æ
->
mónE
[
b
]);

812 i‡(
E
*1e9‡> 
maxE
 && (
Em
 > 3*
noi£_Êo‹
*(
b™d_íd
-
b™d_°¨t
) || E >Çoise_floor*(band_end-band_start)))

813 
b™dwidth
 = 
b
+1;

815 
is_masked
[
b
] = 
E
 < (
t⁄Æ
->
¥ev_b™dwidth
 >b+1 ? .01‡: .05f)*
b™dwidth_mask
;

817 
b™dwidth_mask
 = 
	`MAX32
(.05f*b™dwidth_mask, 
E
);

823 i‡(
t⁄Æ
->
Fs
 == 48000) {

824 
noi£_øtio
;

825 
Em
;

826 
E
 = 
hp_íî
*(1.f/(60*60));

827 
noi£_øtio
 = 
t⁄Æ
->
¥ev_b™dwidth
==20 ? 10.f : 30.f;

829 #ifde‡
FIXED_POINT


831 
E
 *256.f*(1.f/
Q15ONE
)*(1.f/Q15ONE);

833 
above_max_pôch
 +
E
;

834 
t⁄Æ
->
mónE
[
b
] = 
	`MAX32
((1-
ÆphaE2
)*t⁄Æ->mónE[b], 
E
);

835 
Em
 = 
	`MAX32
(
E
, 
t⁄Æ
->
mónE
[
b
]);

836 i‡(
Em
 > 3*
noi£_øtio
*
noi£_Êo‹
*160 || 
E
 >Çoise_ratio*noise_floor*160)

837 
b™dwidth
 = 20;

839 
is_masked
[
b
] = 
E
 < (
t⁄Æ
->
¥ev_b™dwidth
 =20 ? .01‡: .05f)*
b™dwidth_mask
;

841 i‡(
above_max_pôch
 > 
bñow_max_pôch
)

842 
öfo
->
max_pôch_øtio
 = 
bñow_max_pôch
/
above_max_pôch
;

844 
öfo
->
max_pôch_øtio
 = 1;

847 i‡(
b™dwidth
 =20 && 
is_masked
[
NB_TBANDS
])

848 
b™dwidth
-=2;

849 i‡(
b™dwidth
 > 0 && b™dwidth <
NB_TBANDS
 && 
is_masked
[bandwidth-1])

850 
b™dwidth
--;

851 i‡(
t⁄Æ
->
cou¡
<=2)

852 
b™dwidth
 = 20;

853 
‰ame_loud√ss
 = 20*()
	`log10
(frame_loudness);

854 
t⁄Æ
->
Eåackî
 = 
	`MAX32
—⁄Æ->Eåackî-.003f, 
‰ame_loud√ss
);

855 
t⁄Æ
->
lowECou¡
 *(1-
ÆphaE
);

856 i‡(
‰ame_loud√ss
 < 
t⁄Æ
->
Eåackî
-30)

857 
t⁄Æ
->
lowECou¡
 +
ÆphaE
;

859 
i
=0;i<8;i++)

861 
sum
=0;

862 
b
=0;b<16;b++)

863 
sum
 +
d˘_èbÀ
[
i
*16+
b
]*
logE
[b];

864 
BFCC
[
i
] = 
sum
;

866 
i
=0;i<8;i++)

868 
sum
=0;

869 
b
=0;b<16;b++)

870 
sum
 +
d˘_èbÀ
[
i
*16+
b
]*.5f*(
t⁄Æ
->
highE
[b]+t⁄Æ->
lowE
[b]);

871 
midE
[
i
] = 
sum
;

874 
‰ame_°©i⁄¨ôy
 /
NB_TBANDS
;

875 
ªœtiveE
 /
NB_TBANDS
;

876 i‡(
t⁄Æ
->
cou¡
<10)

877 
ªœtiveE
 = .5f;

878 
‰ame_noisöess
 /
NB_TBANDS
;

880 
öfo
->
a˘ivôy
 = 
‰ame_noisöess
 + (1-‰ame_noisöess)*
ªœtiveE
;

882 
öfo
->
a˘ivôy
 = .5*(1+
‰ame_noisöess
-
‰ame_°©i⁄¨ôy
);

884 
‰ame_t⁄Æôy
 = (
max_‰ame_t⁄Æôy
/(
NB_TBANDS
-
NB_TONAL_SKIP_BANDS
));

885 
‰ame_t⁄Æôy
 = 
	`MAX16
(‰ame_t⁄Æôy, 
t⁄Æ
->
¥ev_t⁄Æôy
*.8f);

886 
t⁄Æ
->
¥ev_t⁄Æôy
 = 
‰ame_t⁄Æôy
;

888 
¶›e
 /= 8*8;

889 
öfo
->
t⁄Æôy_¶›e
 = 
¶›e
;

891 
t⁄Æ
->
E_cou¡
 = (t⁄Æ->E_cou¡+1)%
NB_FRAMES
;

892 
t⁄Æ
->
cou¡
 = 
	`IMIN
—⁄Æ->cou¡+1, 
ANALYSIS_COUNT_MAX
);

893 
öfo
->
t⁄Æôy
 = 
‰ame_t⁄Æôy
;

895 
i
=0;i<4;i++)

896 
„©uªs
[
i
] = -0.12299f*(
BFCC
[i]+
t⁄Æ
->
mem
[i+24]Ë+ 0.49195f*—⁄Æ->mem[i]+t⁄Æ->mem[i+16]Ë+ 0.69693f*t⁄Æ->mem[i+8] - 1.4349f*t⁄Æ->
cmón
[i];

898 
i
=0;i<4;i++)

899 
t⁄Æ
->
cmón
[
i
] = (1-
Æpha
)*t⁄Æ->cmón[i] +áÕha*
BFCC
[i];

901 
i
=0;i<4;i++)

902 
„©uªs
[4+
i
] = 0.63246f*(
BFCC
[i]-
t⁄Æ
->
mem
[i+24]) + 0.31623f*(tonal->mem[i]-tonal->mem[i+16]);

903 
i
=0;i<3;i++)

904 
„©uªs
[8+
i
] = 0.53452f*(
BFCC
[i]+
t⁄Æ
->
mem
[i+24]) - 0.26726f*(tonal->mem[i]+tonal->mem[i+16]) -0.53452f*tonal->mem[i+8];

906 i‡(
t⁄Æ
->
cou¡
 > 5)

908 
i
=0;i<9;i++)

909 
t⁄Æ
->
°d
[
i
] = (1-
Æpha
)*t⁄Æ->°d[i] +áÕha*
„©uªs
[i]*features[i];

911 
i
=0;i<4;i++)

912 
„©uªs
[
i
] = 
BFCC
[i]-
midE
[i];

914 
i
=0;i<8;i++)

916 
t⁄Æ
->
mem
[
i
+24] =Åonal->mem[i+16];

917 
t⁄Æ
->
mem
[
i
+16] =Åonal->mem[i+8];

918 
t⁄Æ
->
mem
[
i
+8] =Åonal->mem[i];

919 
t⁄Æ
->
mem
[
i
] = 
BFCC
[i];

921 
i
=0;i<9;i++)

922 
„©uªs
[11+
i
] = ()
	`sqπ
(
t⁄Æ
->
°d
[i]Ë- 
°d_„©uª_büs
[i];

923 
„©uªs
[18] = 
•ec_v¨übûôy
 - 0.78f;

924 
„©uªs
[20] = 
öfo
->
t⁄Æôy
 - 0.154723f;

925 
„©uªs
[21] = 
öfo
->
a˘ivôy
 - 0.724643f;

926 
„©uªs
[22] = 
‰ame_°©i⁄¨ôy
 - 0.743717f;

927 
„©uªs
[23] = 
öfo
->
t⁄Æôy_¶›e
 + 0.069216f;

928 
„©uªs
[24] = 
t⁄Æ
->
lowECou¡
 - 0.067930f;

930 
	`compuã_dí£
(&
œyî0
, 
œyî_out
, 
„©uªs
);

931 
	`compuã_gru
(&
œyî1
, 
t⁄Æ
->
∫n_°©e
, 
œyî_out
);

932 
	`compuã_dí£
(&
œyî2
, 
‰ame_¥obs
, 
t⁄Æ
->
∫n_°©e
);

935 
öfo
->
a˘ivôy_¥obabûôy
 = 
‰ame_¥obs
[1];

936 
öfo
->
music_¥ob
 = 
‰ame_¥obs
[0];

939 #ifde‡
MLP_TRAINING


940 
i
=0;i<25;i++)

941 
	`¥ötf
("%‡", 
„©uªs
[
i
]);

942 
	`¥ötf
("\n");

945 
öfo
->
b™dwidth
 = bandwidth;

946 
t⁄Æ
->
¥ev_b™dwidth
 = 
b™dwidth
;

948 
öfo
->
noisöess
 = 
‰ame_noisöess
;

949 
öfo
->
vÆid
 = 1;

950 
RESTORE_STACK
;

951 
	}
}

953 
	$run_™Æysis
(
T⁄ÆôyA«lysisSèã
 *
™Æysis
, c⁄° 
CELTMode
 *
˚…_mode
, c⁄° *
™Æysis_pcm
,

954 
™Æysis_‰ame_size
, 
‰ame_size
, 
c1
, 
c2
, 
C
, 
›us_öt32
 
Fs
,

955 
lsb_dïth
, 
downmix_func
 
downmix
, 
A«lysisInfo
 *
™Æysis_öfo
)

957 
off£t
;

958 
pcm_Àn
;

960 
™Æysis_‰ame_size
 -=ánalysis_frame_size&1;

961 i‡(
™Æysis_pcm
 !
NULL
)

964 
™Æysis_‰ame_size
 = 
	`IMIN
((
DETECT_SIZE
-5)*
Fs
/50,ánalysis_frame_size);

966 
pcm_Àn
 = 
™Æysis_‰ame_size
 - 
™Æysis
->
™Æysis_off£t
;

967 
off£t
 = 
™Æysis
->
™Æysis_off£t
;

968 
pcm_Àn
>0) {

969 
	`t⁄Æôy_™Æysis
(
™Æysis
, 
˚…_mode
, 
™Æysis_pcm
, 
	`IMIN
(
Fs
/50, 
pcm_Àn
), 
off£t
, 
c1
, 
c2
, 
C
, 
lsb_dïth
, 
downmix
);

970 
off£t
 +
Fs
/50;

971 
pcm_Àn
 -
Fs
/50;

973 
™Æysis
->
™Æysis_off£t
 = 
™Æysis_‰ame_size
;

975 
™Æysis
->
™Æysis_off£t
 -
‰ame_size
;

978 
	`t⁄Æôy_gë_öfo
(
™Æysis
, 
™Æysis_öfo
, 
‰ame_size
);

979 
	}
}

	@src/analysis.h

28 #i‚de‡
ANALYSIS_H


29 
	#ANALYSIS_H


	)

31 
	~"˚….h
"

32 
	~"›us_¥iv©e.h
"

33 
	~"mÕ.h
"

35 
	#NB_FRAMES
 8

	)

36 
	#NB_TBANDS
 18

	)

37 
	#ANALYSIS_BUF_SIZE
 720

	)

40 
	#ANALYSIS_COUNT_MAX
 10000

	)

42 
	#DETECT_SIZE
 100

	)

48 
	m¨ch
;

49 
	m≠∂iˇti⁄
;

50 
›us_öt32
 
	mFs
;

51 
	#TONALITY_ANALYSIS_RESET_START
 
™gÀ


	)

52 
	m™gÀ
[240];

53 
	md_™gÀ
[240];

54 
	md2_™gÀ
[240];

55 
›us_vÆ32
 
	mömem
[
ANALYSIS_BUF_SIZE
];

56 
	mmem_fûl
;

57 
	m¥ev_b™d_t⁄Æôy
[
NB_TBANDS
];

58 
	m¥ev_t⁄Æôy
;

59 
	m¥ev_b™dwidth
;

60 
	mE
[
NB_FRAMES
][
NB_TBANDS
];

61 
	mlogE
[
NB_FRAMES
][
NB_TBANDS
];

62 
	mlowE
[
NB_TBANDS
];

63 
	mhighE
[
NB_TBANDS
];

64 
	mmónE
[
NB_TBANDS
+1];

65 
	mmem
[32];

66 
	mcmón
[8];

67 
	m°d
[9];

68 
	mEåackî
;

69 
	mlowECou¡
;

70 
	mE_cou¡
;

71 
	mcou¡
;

72 
	m™Æysis_off£t
;

73 
	mwrôe_pos
;

74 
	mªad_pos
;

75 
	mªad_sub‰ame
;

76 
	mhp_íî_accum
;

77 
	möôülized
;

78 
	m∫n_°©e
[
MAX_NEURONS
];

79 
›us_vÆ32
 
	mdownmix_°©e
[3];

80 
A«lysisInfo
 
	möfo
[
DETECT_SIZE
];

81 } 
	tT⁄ÆôyA«lysisSèã
;

89 
t⁄Æôy_™Æysis_öô
(
T⁄ÆôyA«lysisSèã
 *
™Æysis
, 
›us_öt32
 
Fs
);

95 
t⁄Æôy_™Æysis_ª£t
(
T⁄ÆôyA«lysisSèã
 *
™Æysis
);

97 
t⁄Æôy_gë_öfo
(
T⁄ÆôyA«lysisSèã
 *
t⁄Æ
, 
A«lysisInfo
 *
öfo_out
, 
Àn
);

99 
run_™Æysis
(
T⁄ÆôyA«lysisSèã
 *
™Æysis
, c⁄° 
CELTMode
 *
˚…_mode
, c⁄° *
™Æysis_pcm
,

100 
™Æysis_‰ame_size
, 
‰ame_size
, 
c1
, 
c2
, 
C
, 
›us_öt32
 
Fs
,

101 
lsb_dïth
, 
downmix_func
 
downmix
, 
A«lysisInfo
 *
™Æysis_öfo
);

	@src/mapping_matrix.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"¨ch.h
"

33 
	~"Êﬂt_ˇ°.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"›us_deföes.h
"

36 
	~"m≠pög_m©rix.h
"

38 
	#MATRIX_INDEX
(
nb_rows
, 
row
, 
cﬁ
Ë“b_row†* cﬁ +Ñow)

	)

40 
›us_öt32
 
	$m≠pög_m©rix_gë_size
(
rows
, 
cﬁs
)

42 
›us_öt32
 
size
;

48 i‡(
rows
 > 255 || 
cﬁs
 > 255)

50 
size
 = 
rows
 * (
›us_öt32
)
cﬁs
 * (
›us_öt16
);

51 i‡(
size
 > 65004)

54  
	`Æign
((
M≠pögM©rix
)Ë+álign(
size
);

55 
	}
}

57 
›us_öt16
 *
	$m≠pög_m©rix_gë_d©a
(c⁄° 
M≠pögM©rix
 *
m©rix
)

60  (
›us_öt16
*)(*)((*)
m©rix
 + 
	`Æign
((
M≠pögM©rix
)));

61 
	}
}

63 
	$m≠pög_m©rix_öô
(
M≠pögM©rix
 * c⁄° 
m©rix
,

64 
rows
, 
cﬁs
, 
gaö
, c⁄° 
›us_öt16
 *
d©a
, 
›us_öt32
 
d©a_size
)

66 
i
;

67 
›us_öt16
 *
±r
;

69 #i‡!
	`deföed
(
ENABLE_ASSERTIONS
)

70 ()
d©a_size
;

72 
	`˚…_as£π
(
	`Æign
(
d©a_size
Ë=Æign(
rows
 * 
cﬁs
 * (
›us_öt16
)));

74 
m©rix
->
rows
 =Ñows;

75 
m©rix
->
cﬁs
 = cols;

76 
m©rix
->
gaö
 = gain;

77 
±r
 = 
	`m≠pög_m©rix_gë_d©a
(
m©rix
);

78 
i
 = 0; i < 
rows
 * 
cﬁs
; i++)

80 
±r
[
i
] = 
d©a
[i];

82 
	}
}

84 #i‚de‡
DISABLE_FLOAT_API


85 
	$m≠pög_m©rix_mu…ùly_ch™√l_ö_Êﬂt
(

86 c⁄° 
M≠pögM©rix
 *
m©rix
,

87 c⁄° *
öput
,

88 
öput_rows
,

89 
›us_vÆ16
 *
ouçut
,

90 
ouçut_row
,

91 
ouçut_rows
,

92 
‰ame_size
)

95 
›us_öt16
* 
m©rix_d©a
;

96 
i
, 
cﬁ
;

98 
	`˚…_as£π
(
öput_rows
 <
m©rix
->
cﬁs
 && 
ouçut_rows
 <m©rix->
rows
);

100 
m©rix_d©a
 = 
	`m≠pög_m©rix_gë_d©a
(
m©rix
);

102 
i
 = 0; i < 
‰ame_size
; i++)

104 
tmp
 = 0;

105 
cﬁ
 = 0; cﬁ < 
öput_rows
; col++)

107 
tmp
 +=

108 
m©rix_d©a
[
	`MATRIX_INDEX
(
m©rix
->
rows
, 
ouçut_row
, 
cﬁ
)] *

109 
öput
[
	`MATRIX_INDEX
(
öput_rows
, 
cﬁ
, 
i
)];

111 #i‡
	`deföed
(
FIXED_POINT
)

112 
ouçut
[
ouçut_rows
 * 
i
] = 
	`FLOAT2INT16
((1/32768.f)*
tmp
);

114 
ouçut
[
ouçut_rows
 * 
i
] = (1/32768.f)*
tmp
;

117 
	}
}

119 
	$m≠pög_m©rix_mu…ùly_ch™√l_out_Êﬂt
(

120 c⁄° 
M≠pögM©rix
 *
m©rix
,

121 c⁄° 
›us_vÆ16
 *
öput
,

122 
öput_row
,

123 
öput_rows
,

124 *
ouçut
,

125 
ouçut_rows
,

126 
‰ame_size


130 
›us_öt16
* 
m©rix_d©a
;

131 
i
, 
row
;

132 
öput_ßm∂e
;

134 
	`˚…_as£π
(
öput_rows
 <
m©rix
->
cﬁs
 && 
ouçut_rows
 <m©rix->
rows
);

136 
m©rix_d©a
 = 
	`m≠pög_m©rix_gë_d©a
(
m©rix
);

138 
i
 = 0; i < 
‰ame_size
; i++)

140 #i‡
	`deföed
(
FIXED_POINT
)

141 
öput_ßm∂e
 = (1/32768.f)*
öput
[
öput_rows
 * 
i
];

143 
öput_ßm∂e
 = 
öput
[
öput_rows
 * 
i
];

145 
row
 = 0;Ñow < 
ouçut_rows
;Ñow++)

147 
tmp
 =

148 (1/32768.f)*
m©rix_d©a
[
	`MATRIX_INDEX
(
m©rix
->
rows
, 
row
, 
öput_row
)] *

149 
öput_ßm∂e
;

150 
ouçut
[
	`MATRIX_INDEX
(
ouçut_rows
, 
row
, 
i
)] +
tmp
;

153 
	}
}

156 
	$m≠pög_m©rix_mu…ùly_ch™√l_ö_sh‹t
(

157 c⁄° 
M≠pögM©rix
 *
m©rix
,

158 c⁄° 
›us_öt16
 *
öput
,

159 
öput_rows
,

160 
›us_vÆ16
 *
ouçut
,

161 
ouçut_row
,

162 
ouçut_rows
,

163 
‰ame_size
)

166 
›us_öt16
* 
m©rix_d©a
;

167 
i
, 
cﬁ
;

169 
	`˚…_as£π
(
öput_rows
 <
m©rix
->
cﬁs
 && 
ouçut_rows
 <m©rix->
rows
);

171 
m©rix_d©a
 = 
	`m≠pög_m©rix_gë_d©a
(
m©rix
);

173 
i
 = 0; i < 
‰ame_size
; i++)

175 
›us_vÆ32
 
tmp
 = 0;

176 
cﬁ
 = 0; cﬁ < 
öput_rows
; col++)

178 #i‡
	`deföed
(
FIXED_POINT
)

179 
tmp
 +=

180 ((
›us_öt32
)
m©rix_d©a
[
	`MATRIX_INDEX
(
m©rix
->
rows
, 
ouçut_row
, 
cﬁ
)] *

181 (
›us_öt32
)
öput
[
	`MATRIX_INDEX
(
öput_rows
, 
cﬁ
, 
i
)]) >> 8;

183 
tmp
 +=

184 
m©rix_d©a
[
	`MATRIX_INDEX
(
m©rix
->
rows
, 
ouçut_row
, 
cﬁ
)] *

185 
öput
[
	`MATRIX_INDEX
(
öput_rows
, 
cﬁ
, 
i
)];

188 #i‡
	`deföed
(
FIXED_POINT
)

189 
ouçut
[
ouçut_rows
 * 
i
] = (
›us_öt16
)((
tmp
 + 64) >> 7);

191 
ouçut
[
ouçut_rows
 * 
i
] = (1/(32768.f*32768.f))*
tmp
;

194 
	}
}

196 
	$m≠pög_m©rix_mu…ùly_ch™√l_out_sh‹t
(

197 c⁄° 
M≠pögM©rix
 *
m©rix
,

198 c⁄° 
›us_vÆ16
 *
öput
,

199 
öput_row
,

200 
öput_rows
,

201 
›us_öt16
 *
ouçut
,

202 
ouçut_rows
,

203 
‰ame_size
)

206 
›us_öt16
* 
m©rix_d©a
;

207 
i
, 
row
;

208 
›us_öt32
 
öput_ßm∂e
;

210 
	`˚…_as£π
(
öput_rows
 <
m©rix
->
cﬁs
 && 
ouçut_rows
 <m©rix->
rows
);

212 
m©rix_d©a
 = 
	`m≠pög_m©rix_gë_d©a
(
m©rix
);

214 
i
 = 0; i < 
‰ame_size
; i++)

216 #i‡
	`deföed
(
FIXED_POINT
)

217 
öput_ßm∂e
 = (
›us_öt32
)
öput
[
öput_rows
 * 
i
];

219 
öput_ßm∂e
 = (
›us_öt32
)
	`FLOAT2INT16
(
öput
[
öput_rows
 * 
i
]);

221 
row
 = 0;Ñow < 
ouçut_rows
;Ñow++)

223 
›us_öt32
 
tmp
 =

224 (
›us_öt32
)
m©rix_d©a
[
	`MATRIX_INDEX
(
m©rix
->
rows
, 
row
, 
öput_row
)] *

225 
öput_ßm∂e
;

226 
ouçut
[
	`MATRIX_INDEX
(
ouçut_rows
, 
row
, 
i
)] +(
tmp
 + 16384) >> 15;

229 
	}
}

231 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_fﬂ_mixög
 = { 6, 6, 0 };

232 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_fﬂ_mixög_d©a
[36] = {

240 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_sﬂ_mixög
 = { 11, 11, 0 };

241 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_sﬂ_mixög_d©a
[121] = {

260 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_tﬂ_mixög
 = { 18, 18, 0 };

261 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_tﬂ_mixög_d©a
[324] = {

305 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_fﬂ_demixög
 = { 6, 6, 0 };

306 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_fﬂ_demixög_d©a
[36] = {

314 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_sﬂ_demixög
 = { 11, 11, 3050 };

315 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_sﬂ_demixög_d©a
[121] = {

334 c⁄° 
M≠pögM©rix
 
	gm≠pög_m©rix_tﬂ_demixög
 = { 18, 18, 0 };

335 c⁄° 
›us_öt16
 
	gm≠pög_m©rix_tﬂ_demixög_d©a
[324] = {

	@src/mapping_matrix.h

33 #i‚de‡
MAPPING_MATRIX_H


34 
	#MAPPING_MATRIX_H


	)

36 
	~"›us_ty≥s.h
"

37 
	~"›us_¥oje˘i⁄.h
"

39 #ifde‡
__˝lu•lus


43 
	sM≠pögM©rix


45 
rows
;

46 
cﬁs
;

47 
gaö
;

49 } 
	tM≠pögM©rix
;

51 
›us_öt32
 
m≠pög_m©rix_gë_size
(
rows
, 
cﬁs
);

53 
›us_öt16
 *
m≠pög_m©rix_gë_d©a
(c⁄° 
M≠pögM©rix
 *
m©rix
);

55 
m≠pög_m©rix_öô
(

56 
M≠pögM©rix
 * c⁄° 
m©rix
,

57 
rows
,

58 
cﬁs
,

59 
gaö
,

60 c⁄° 
›us_öt16
 *
d©a
,

61 
›us_öt32
 
d©a_size


64 #i‚de‡
DISABLE_FLOAT_API


65 
m≠pög_m©rix_mu…ùly_ch™√l_ö_Êﬂt
(

66 c⁄° 
M≠pögM©rix
 *
m©rix
,

67 c⁄° *
öput
,

68 
öput_rows
,

69 
›us_vÆ16
 *
ouçut
,

70 
ouçut_row
,

71 
ouçut_rows
,

72 
‰ame_size


75 
m≠pög_m©rix_mu…ùly_ch™√l_out_Êﬂt
(

76 c⁄° 
M≠pögM©rix
 *
m©rix
,

77 c⁄° 
›us_vÆ16
 *
öput
,

78 
öput_row
,

79 
öput_rows
,

80 *
ouçut
,

81 
ouçut_rows
,

82 
‰ame_size


86 
m≠pög_m©rix_mu…ùly_ch™√l_ö_sh‹t
(

87 c⁄° 
M≠pögM©rix
 *
m©rix
,

88 c⁄° 
›us_öt16
 *
öput
,

89 
öput_rows
,

90 
›us_vÆ16
 *
ouçut
,

91 
ouçut_row
,

92 
ouçut_rows
,

93 
‰ame_size


96 
m≠pög_m©rix_mu…ùly_ch™√l_out_sh‹t
(

97 c⁄° 
M≠pögM©rix
 *
m©rix
,

98 c⁄° 
›us_vÆ16
 *
öput
,

99 
öput_row
,

100 
öput_rows
,

101 
›us_öt16
 *
ouçut
,

102 
ouçut_rows
,

103 
‰ame_size


111 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_fﬂ_mixög
;

112 c⁄° 
›us_öt16
 
m≠pög_m©rix_fﬂ_mixög_d©a
[36];

114 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_sﬂ_mixög
;

115 c⁄° 
›us_öt16
 
m≠pög_m©rix_sﬂ_mixög_d©a
[121];

117 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_tﬂ_mixög
;

118 c⁄° 
›us_öt16
 
m≠pög_m©rix_tﬂ_mixög_d©a
[324];

120 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_fﬂ_demixög
;

121 c⁄° 
›us_öt16
 
m≠pög_m©rix_fﬂ_demixög_d©a
[36];

123 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_sﬂ_demixög
;

124 c⁄° 
›us_öt16
 
m≠pög_m©rix_sﬂ_demixög_d©a
[121];

126 c⁄° 
M≠pögM©rix
 
m≠pög_m©rix_tﬂ_demixög
;

127 c⁄° 
›us_öt16
 
m≠pög_m©rix_tﬂ_demixög_d©a
[324];

129 #ifde‡
__˝lu•lus


	@src/mlp.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<m©h.h
>

33 
	~"›us_ty≥s.h
"

34 
	~"›us_deföes.h
"

35 
	~"¨ch.h
"

36 
	~"ènsig_èbÀ.h
"

37 
	~"mÕ.h
"

39 
OPUS_INLINE
 
	$ènsig_≠¥ox
(
x
)

41 
i
;

42 
y
, 
dy
;

43 
sign
=1;

45 i‡(!(
x
<8))

47 i‡(!(
x
>-8))

49 #i‚de‡
FIXED_POINT


51 i‡(
	`˚…_i¢™
(
x
))

54 i‡(
x
<0)

56 
x
=-x;

57 
sign
=-1;

59 
i
 = ()
	`Êo‹
(.5f+25*
x
);

60 
x
 -.04f*
i
;

61 
y
 = 
ènsig_èbÀ
[
i
];

62 
dy
 = 1-
y
*y;

63 
y
 = y + 
x
*
dy
*(1 - y*x);

64  
sign
*
y
;

65 
	}
}

67 
OPUS_INLINE
 
	$sigmoid_≠¥ox
(
x
)

69  .5‡+ .5f*
	`ènsig_≠¥ox
(.5f*
x
);

70 
	}
}

72 
	$gemm_accum
(*
out
, c⁄° 
›us_öt8
 *
weights
, 
rows
, 
cﬁs
, 
cﬁ_°ride
, c⁄° *
x
)

74 
i
, 
j
;

75 
i
=0;i<
rows
;i++)

77 
j
=0;j<
cﬁs
;j++)

78 
out
[
i
] +
weights
[
j
*
cﬁ_°ride
 + i]*
x
[j];

80 
	}
}

82 
	$compuã_dí£
(c⁄° 
Dí£Layî
 *
œyî
, *
ouçut
, c⁄° *
öput
)

84 
i
;

85 
N
, 
M
;

86 
°ride
;

87 
M
 = 
œyî
->
nb_öputs
;

88 
N
 = 
œyî
->
nb_√ur⁄s
;

89 
°ride
 = 
N
;

90 
i
=0;i<
N
;i++)

91 
ouçut
[
i
] = 
œyî
->
büs
[i];

92 
	`gemm_accum
(
ouçut
, 
œyî
->
öput_weights
, 
N
, 
M
, 
°ride
, 
öput
);

93 
i
=0;i<
N
;i++)

94 
ouçut
[
i
] *
WEIGHTS_SCALE
;

95 i‡(
œyî
->
sigmoid
) {

96 
i
=0;i<
N
;i++)

97 
ouçut
[
i
] = 
	`sigmoid_≠¥ox
(output[i]);

99 
i
=0;i<
N
;i++)

100 
ouçut
[
i
] = 
	`ènsig_≠¥ox
(output[i]);

102 
	}
}

104 
	$compuã_gru
(c⁄° 
GRULayî
 *
gru
, *
°©e
, c⁄° *
öput
)

106 
i
;

107 
N
, 
M
;

108 
°ride
;

109 
tmp
[
MAX_NEURONS
];

110 
z
[
MAX_NEURONS
];

111 
r
[
MAX_NEURONS
];

112 
h
[
MAX_NEURONS
];

113 
M
 = 
gru
->
nb_öputs
;

114 
N
 = 
gru
->
nb_√ur⁄s
;

115 
°ride
 = 3*
N
;

117 
i
=0;i<
N
;i++)

118 
z
[
i
] = 
gru
->
büs
[i];

119 
	`gemm_accum
(
z
, 
gru
->
öput_weights
, 
N
, 
M
, 
°ride
, 
öput
);

120 
	`gemm_accum
(
z
, 
gru
->
ªcuºít_weights
, 
N
, N, 
°ride
, 
°©e
);

121 
i
=0;i<
N
;i++)

122 
z
[
i
] = 
	`sigmoid_≠¥ox
(
WEIGHTS_SCALE
*z[i]);

125 
i
=0;i<
N
;i++)

126 
r
[
i
] = 
gru
->
büs
[
N
 + i];

127 
	`gemm_accum
(
r
, &
gru
->
öput_weights
[
N
], N, 
M
, 
°ride
, 
öput
);

128 
	`gemm_accum
(
r
, &
gru
->
ªcuºít_weights
[
N
], N, N, 
°ride
, 
°©e
);

129 
i
=0;i<
N
;i++)

130 
r
[
i
] = 
	`sigmoid_≠¥ox
(
WEIGHTS_SCALE
*r[i]);

133 
i
=0;i<
N
;i++)

134 
h
[
i
] = 
gru
->
büs
[2*
N
 + i];

135 
i
=0;i<
N
;i++)

136 
tmp
[
i
] = 
°©e
[i] * 
r
[i];

137 
	`gemm_accum
(
h
, &
gru
->
öput_weights
[2*
N
], N, 
M
, 
°ride
, 
öput
);

138 
	`gemm_accum
(
h
, &
gru
->
ªcuºít_weights
[2*
N
], N, N, 
°ride
, 
tmp
);

139 
i
=0;i<
N
;i++)

140 
h
[
i
] = 
z
[i]*
°©e
[i] + (1-z[i])*
	`ènsig_≠¥ox
(
WEIGHTS_SCALE
*h[i]);

141 
i
=0;i<
N
;i++)

142 
°©e
[
i
] = 
h
[i];

143 
	}
}

	@src/mlp.h

27 #i‚de‡
_MLP_H_


28 
	#_MLP_H_


	)

30 
	~"›us_ty≥s.h
"

32 
	#WEIGHTS_SCALE
 (1.f/128)

	)

34 
	#MAX_NEURONS
 32

	)

37 c⁄° 
›us_öt8
 *
	mbüs
;

38 c⁄° 
›us_öt8
 *
	möput_weights
;

39 
	mnb_öputs
;

40 
	mnb_√ur⁄s
;

41 
	msigmoid
;

42 } 
	tDí£Layî
;

45 c⁄° 
›us_öt8
 *
	mbüs
;

46 c⁄° 
›us_öt8
 *
	möput_weights
;

47 c⁄° 
›us_öt8
 *
	mªcuºít_weights
;

48 
	mnb_öputs
;

49 
	mnb_√ur⁄s
;

50 } 
	tGRULayî
;

52 c⁄° 
Dí£Layî
 
œyî0
;

53 c⁄° 
GRULayî
 
œyî1
;

54 c⁄° 
Dí£Layî
 
œyî2
;

56 
compuã_dí£
(c⁄° 
Dí£Layî
 *
œyî
, *
ouçut
, c⁄° *
öput
);

58 
compuã_gru
(c⁄° 
GRULayî
 *
gru
, *
°©e
, c⁄° *
öput
);

	@src/mlp_data.c

3 #ifde‡
HAVE_CONFIG_H


4 
	~"c⁄fig.h
"

7 
	~"mÕ.h
"

9 c⁄° 
›us_öt8
 
	gœyî0_weights
[800] = {

112 c⁄° 
›us_öt8
 
	gœyî0_büs
[32] = {

119 c⁄° 
›us_öt8
 
	gœyî1_weights
[2304] = {

410 c⁄° 
›us_öt8
 
	gœyî1_ªcur_weights
[1728] = {

629 c⁄° 
›us_öt8
 
	gœyî1_büs
[72] = {

641 c⁄° 
›us_öt8
 
	gœyî2_weights
[48] = {

650 c⁄° 
›us_öt8
 
	gœyî2_büs
[2] = {

654 c⁄° 
Dí£Layî
 
	gœyî0
 = {

655 
œyî0_büs
,

656 
œyî0_weights
,

660 c⁄° 
GRULayî
 
	gœyî1
 = {

661 
œyî1_büs
,

662 
œyî1_weights
,

663 
œyî1_ªcur_weights
,

667 c⁄° 
Dí£Layî
 
	gœyî2
 = {

668 
œyî2_büs
,

669 
œyî2_weights
,

	@src/opus.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us.h
"

33 
	~"›us_¥iv©e.h
"

35 #i‚de‡
DISABLE_FLOAT_API


36 
OPUS_EXPORT
 
	$›us_pcm_so·_˛ù
(*
_x
, 
N
, 
C
, *
de˛ù_mem
)

38 
c
;

39 
i
;

40 *
x
;

42 i‡(
C
<1 || 
N
<1 || !
_x
 || !
de˛ù_mem
) ;

48 
i
=0;i<
N
*
C
;i++)

49 
_x
[
i
] = 
	`MAX16
(-2.f, 
	`MIN16
(2.f, _x[i]));

50 
c
=0;c<
C
;c++)

52 
a
;

53 
x0
;

54 
cuº
;

56 
x
 = 
_x
+
c
;

57 
a
 = 
de˛ù_mem
[
c
];

60 
i
=0;i<
N
;i++)

62 i‡(
x
[
i
*
C
]*
a
>=0)

64 
x
[
i
*
C
] = x[i*C]+
a
*x[i*C]*x[i*C];

67 
cuº
=0;

68 
x0
 = 
x
[0];

71 
°¨t
, 
íd
;

72 
maxvÆ
;

73 
•ecül
=0;

74 
≥ak_pos
;

75 
i
=
cuº
;i<
N
;i++)

77 i‡(
x
[
i
*
C
]>1 || x[i*C]<-1)

80 i‡(
i
==
N
)

82 
a
=0;

85 
≥ak_pos
 = 
i
;

86 
°¨t
=
íd
=
i
;

87 
maxvÆ
=
	`ABS16
(
x
[
i
*
C
]);

89 
°¨t
>0 && 
x
[
i
*
C
]*x[(start-1)*C]>=0)

90 
°¨t
--;

92 
íd
<
N
 && 
x
[
i
*
C
]*x[end*C]>=0)

95 i‡(
	`ABS16
(
x
[
íd
*
C
])>
maxvÆ
)

97 
maxvÆ
 = 
	`ABS16
(
x
[
íd
*
C
]);

98 
≥ak_pos
 = 
íd
;

100 
íd
++;

103 
•ecül
 = (
°¨t
==0 && 
x
[
i
*
C
]*x[0]>=0);

106 
a
=(
maxvÆ
-1)/(maxval*maxval);

110 
a
 +=á*2.4e-7f;

111 i‡(
x
[
i
*
C
]>0)

112 
a
 = -a;

114 
i
=
°¨t
;i<
íd
;i++)

115 
x
[
i
*
C
] = x[i*C]+
a
*x[i*C]*x[i*C];

117 i‡(
•ecül
 && 
≥ak_pos
>=2)

121 
dñè
;

122 
off£t
 = 
x0
-
x
[0];

123 
dñè
 = 
off£t
 / 
≥ak_pos
;

124 
i
=
cuº
;i<
≥ak_pos
;i++)

126 
off£t
 -
dñè
;

127 
x
[
i
*
C
] +
off£t
;

128 
x
[
i
*
C
] = 
	`MAX16
(-1.f, 
	`MIN16
(1.f, x[i*C]));

131 
cuº
 = 
íd
;

132 i‡(
cuº
==
N
)

135 
de˛ù_mem
[
c
] = 
a
;

137 
	}
}

140 
	$ícode_size
(
size
, *
d©a
)

142 i‡(
size
 < 252)

144 
d©a
[0] = 
size
;

147 
d©a
[0] = 252+(
size
&0x3);

148 
d©a
[1] = (
size
-()data[0])>>2;

151 
	}
}

153 
	$∑r£_size
(c⁄° *
d©a
, 
›us_öt32
 
Àn
, 
›us_öt16
 *
size
)

155 i‡(
Àn
<1)

157 *
size
 = -1;

159 } i‡(
d©a
[0]<252)

161 *
size
 = 
d©a
[0];

163 } i‡(
Àn
<2)

165 *
size
 = -1;

168 *
size
 = 4*
d©a
[1] + data[0];

171 
	}
}

173 
	$›us_∑ckë_gë_ßm∂es_≥r_‰ame
(c⁄° *
d©a
,

174 
›us_öt32
 
Fs
)

176 
audiosize
;

177 i‡(
d©a
[0]&0x80)

179 
audiosize
 = ((
d©a
[0]>>3)&0x3);

180 
audiosize
 = (
Fs
<<audiosize)/400;

181 } i‡((
d©a
[0]&0x60) == 0x60)

183 
audiosize
 = (
d©a
[0]&0x08Ë? 
Fs
/50 : Fs/100;

185 
audiosize
 = ((
d©a
[0]>>3)&0x3);

186 i‡(
audiosize
 == 3)

187 
audiosize
 = 
Fs
*60/1000;

189 
audiosize
 = (
Fs
<<audiosize)/100;

191  
audiosize
;

192 
	}
}

194 
	$›us_∑ckë_∑r£_im∂
(c⁄° *
d©a
, 
›us_öt32
 
Àn
,

195 
£lf_dñimôed
, *
out_toc
,

196 c⁄° *
‰ames
[48], 
›us_öt16
 
size
[48],

197 *
∑ylﬂd_off£t
, 
›us_öt32
 *
∑ckë_off£t
)

199 
i
, 
byãs
;

200 
cou¡
;

201 
cbr
;

202 
ch
, 
toc
;

203 
‰amesize
;

204 
›us_öt32
 
œ°_size
;

205 
›us_öt32
 
∑d
 = 0;

206 c⁄° *
d©a0
 = 
d©a
;

208 i‡(
size
==
NULL
 || 
Àn
<0)

209  
OPUS_BAD_ARG
;

210 i‡(
Àn
==0)

211  
OPUS_INVALID_PACKET
;

213 
‰amesize
 = 
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
d©a
, 48000);

215 
cbr
 = 0;

216 
toc
 = *
d©a
++;

217 
Àn
--;

218 
œ°_size
 = 
Àn
;

219 
toc
&0x3)

223 
cou¡
=1;

227 
cou¡
=2;

228 
cbr
 = 1;

229 i‡(!
£lf_dñimôed
)

231 i‡(
Àn
&0x1)

232  
OPUS_INVALID_PACKET
;

233 
œ°_size
 = 
Àn
/2;

235 
size
[0] = (
›us_öt16
)
œ°_size
;

240 
cou¡
 = 2;

241 
byãs
 = 
	`∑r£_size
(
d©a
, 
Àn
, 
size
);

242 
Àn
 -
byãs
;

243 i‡(
size
[0]<0 || size[0] > 
Àn
)

244  
OPUS_INVALID_PACKET
;

245 
d©a
 +
byãs
;

246 
œ°_size
 = 
Àn
-
size
[0];

250 i‡(
Àn
<1)

251  
OPUS_INVALID_PACKET
;

253 
ch
 = *
d©a
++;

254 
cou¡
 = 
ch
&0x3F;

255 i‡(
cou¡
 <0 || 
‰amesize
*(
›us_öt32
)count > 5760)

256  
OPUS_INVALID_PACKET
;

257 
Àn
--;

259 i‡(
ch
&0x40)

261 
p
;

263 
tmp
;

264 i‡(
Àn
<=0)

265  
OPUS_INVALID_PACKET
;

266 
p
 = *
d©a
++;

267 
Àn
--;

268 
tmp
 = 
p
==255 ? 254:Ö;

269 
Àn
 -
tmp
;

270 
∑d
 +
tmp
;

271 } 
p
==255);

273 i‡(
Àn
<0)

274  
OPUS_INVALID_PACKET
;

276 
cbr
 = !(
ch
&0x80);

277 i‡(!
cbr
)

280 
œ°_size
 = 
Àn
;

281 
i
=0;i<
cou¡
-1;i++)

283 
byãs
 = 
	`∑r£_size
(
d©a
, 
Àn
, 
size
+
i
);

284 
Àn
 -
byãs
;

285 i‡(
size
[
i
]<0 || size[i] > 
Àn
)

286  
OPUS_INVALID_PACKET
;

287 
d©a
 +
byãs
;

288 
œ°_size
 -
byãs
+
size
[
i
];

290 i‡(
œ°_size
<0)

291  
OPUS_INVALID_PACKET
;

292 } i‡(!
£lf_dñimôed
)

295 
œ°_size
 = 
Àn
/
cou¡
;

296 i‡(
œ°_size
*
cou¡
!=
Àn
)

297  
OPUS_INVALID_PACKET
;

298 
i
=0;i<
cou¡
-1;i++)

299 
size
[
i
] = (
›us_öt16
)
œ°_size
;

304 i‡(
£lf_dñimôed
)

306 
byãs
 = 
	`∑r£_size
(
d©a
, 
Àn
, 
size
+
cou¡
-1);

307 
Àn
 -
byãs
;

308 i‡(
size
[
cou¡
-1]<0 || size[cou¡-1] > 
Àn
)

309  
OPUS_INVALID_PACKET
;

310 
d©a
 +
byãs
;

312 i‡(
cbr
)

314 i‡(
size
[
cou¡
-1]*cou¡ > 
Àn
)

315  
OPUS_INVALID_PACKET
;

316 
i
=0;i<
cou¡
-1;i++)

317 
size
[
i
] = size[
cou¡
-1];

318 } i‡(
byãs
+
size
[
cou¡
-1] > 
œ°_size
)

319  
OPUS_INVALID_PACKET
;

325 i‡(
œ°_size
 > 1275)

326  
OPUS_INVALID_PACKET
;

327 
size
[
cou¡
-1] = (
›us_öt16
)
œ°_size
;

330 i‡(
∑ylﬂd_off£t
)

331 *
∑ylﬂd_off£t
 = ()(
d©a
-
d©a0
);

333 
i
=0;i<
cou¡
;i++)

335 i‡(
‰ames
)

336 
‰ames
[
i
] = 
d©a
;

337 
d©a
 +
size
[
i
];

340 i‡(
∑ckë_off£t
)

341 *
∑ckë_off£t
 = 
∑d
+(
›us_öt32
)(
d©a
-
d©a0
);

343 i‡(
out_toc
)

344 *
out_toc
 = 
toc
;

346  
cou¡
;

347 
	}
}

349 
	$›us_∑ckë_∑r£
(c⁄° *
d©a
, 
›us_öt32
 
Àn
,

350 *
out_toc
, c⁄° *
‰ames
[48],

351 
›us_öt16
 
size
[48], *
∑ylﬂd_off£t
)

353  
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 0, 
out_toc
,

354 
‰ames
, 
size
, 
∑ylﬂd_off£t
, 
NULL
);

355 
	}
}

	@src/opus_compare.c

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<m©h.h
>

31 
	~<°rög.h
>

33 
	#OPUS_PI
 (3.14159265F)

	)

35 
	#OPUS_COSF
(
_x
Ë(()
	`cos
(_x))

	)

36 
	#OPUS_SINF
(
_x
Ë(()
	`sö
(_x))

	)

38 *
	$check_Æloc
(*
_±r
){

39 if(
_±r
==
NULL
){

40 
	`Ârötf
(
°dîr
,"Out of memory.\n");

41 
	`exô
(
EXIT_FAILURE
);

43  
_±r
;

44 
	}
}

46 *
	$›us_mÆloc
(
size_t
 
_size
){

47  
	`check_Æloc
(
	`mÆloc
(
_size
));

48 
	}
}

50 *
	$›us_ªÆloc
(*
_±r
,
size_t
 
_size
){

51  
	`check_Æloc
(
	`ªÆloc
(
_±r
,
_size
));

52 
	}
}

54 
size_t
 
	$ªad_pcm16
(**
_ßm∂es
,
FILE
 *
_fö
,
_nch™√ls
){

55 
buf
[1024];

56 *
ßm∂es
;

57 
size_t
 
nßm∂es
;

58 
size_t
 
cßm∂es
;

59 
size_t
 
xi
;

60 
size_t
 
ƒód
;

61 
ßm∂es
=
NULL
;

62 
nßm∂es
=
cßm∂es
=0;

64 
ƒód
=
	`‰ód
(
buf
,2*
_nch™√ls
,1024/(2*_nch™√ls),
_fö
);

65 if(
ƒód
<=0);

66 if(
nßm∂es
+
ƒód
>
cßm∂es
){

67 dÿ
cßm∂es
=csamples<<1|1;

68 
nßm∂es
+
ƒód
>
cßm∂es
);

69 
ßm∂es
=(*)
	`›us_ªÆloc
(samples,

70 
_nch™√ls
*
cßm∂es
*(*
ßm∂es
));

72 
xi
=0;xi<
ƒód
;xi++){

73 
ci
;

74 
ci
=0;ci<
_nch™√ls
;ci++){

75 
s
;

76 
s
=
buf
[2*(
xi
*
_nch™√ls
+
ci
)+1]<<8|buf[2*(xi*_nchannels+ci)];

77 
s
=((s&0xFFFF)^0x8000)-0x8000;

78 
ßm∂es
[(
nßm∂es
+
xi
)*
_nch™√ls
+
ci
]=
s
;

81 
nßm∂es
+=
ƒód
;

83 *
_ßm∂es
=(*)
	`›us_ªÆloc
(
ßm∂es
,

84 
_nch™√ls
*
nßm∂es
*(*
ßm∂es
));

85  
nßm∂es
;

86 
	}
}

88 
	$b™d_íîgy
(*
_out
,*
_ps
,c⁄° *
_b™ds
,
_nb™ds
,

89 c⁄° *
_ö
,
_nch™√ls
,
size_t
 
_n‰ames
,
_wödow_sz
,

90 
_°ï
,
_downßm∂e
){

91 *
wödow
;

92 *
x
;

93 *
c
;

94 *
s
;

95 
size_t
 
xi
;

96 
xj
;

97 
ps_sz
;

98 
wödow
=(*)
	`›us_mÆloc
((3+
_nch™√ls
)*
_wödow_sz
*(*window));

99 
c
=
wödow
+
_wödow_sz
;

100 
s
=
c
+
_wödow_sz
;

101 
x
=
s
+
_wödow_sz
;

102 
ps_sz
=
_wödow_sz
/2;

103 
xj
=0;xj<
_wödow_sz
;xj++){

104 
wödow
[
xj
]=0.5F-0.5F*
	`OPUS_COSF
((2*
OPUS_PI
/(
_wödow_sz
-1))*xj);

106 
xj
=0;xj<
_wödow_sz
;xj++){

107 
c
[
xj
]=
	`OPUS_COSF
((2*
OPUS_PI
/
_wödow_sz
)*xj);

109 
xj
=0;xj<
_wödow_sz
;xj++){

110 
s
[
xj
]=
	`OPUS_SINF
((2*
OPUS_PI
/
_wödow_sz
)*xj);

112 
xi
=0;xi<
_n‰ames
;xi++){

113 
ci
;

114 
xk
;

115 
bi
;

116 
ci
=0;ci<
_nch™√ls
;ci++){

117 
xk
=0;xk<
_wödow_sz
;xk++){

118 
x
[
ci
*
_wödow_sz
+
xk
]=
wödow
[xk]*
_ö
[(
xi
*
_°ï
+xk)*
_nch™√ls
+ci];

121 
bi
=
xj
=0;bi<
_nb™ds
;bi++){

122 
p
[2]={0};

123 ;
xj
<
_b™ds
[
bi
+1];xj++){

124 
ci
=0;ci<
_nch™√ls
;ci++){

125 
ª
;

126 
im
;

127 
ti
;

128 
ti
=0;

129 
ª
=
im
=0;

130 
xk
=0;xk<
_wödow_sz
;xk++){

131 
ª
+=
c
[
ti
]*
x
[
ci
*
_wödow_sz
+
xk
];

132 
im
-=
s
[
ti
]*
x
[
ci
*
_wödow_sz
+
xk
];

133 
ti
+=
xj
;

134 if(
ti
>=
_wödow_sz
)ti-=_window_sz;

136 
ª
*=
_downßm∂e
;

137 
im
*=
_downßm∂e
;

138 
_ps
[(
xi
*
ps_sz
+
xj
)*
_nch™√ls
+
ci
]=
ª
*ª+
im
*im+100000;

139 
p
[
ci
]+=
_ps
[(
xi
*
ps_sz
+
xj
)*
_nch™√ls
+ci];

142 if(
_out
){

143 
_out
[(
xi
*
_nb™ds
+
bi
)*
_nch™√ls
]=
p
[0]/(
_b™ds
[bi+1]-_bands[bi]);

144 if(
_nch™√ls
==2){

145 
_out
[(
xi
*
_nb™ds
+
bi
)*
_nch™√ls
+1]=
p
[1]/(
_b™ds
[bi+1]-_bands[bi]);

150 
	`‰ì
(
wödow
);

151 
	}
}

153 
	#NBANDS
 (21)

	)

154 
	#NFREQS
 (240)

	)

158 c⁄° 
	gBANDS
[
NBANDS
+1]={

162 
	#TEST_WIN_SIZE
 (480)

	)

163 
	#TEST_WIN_STEP
 (120)

	)

165 
	$maö
(
_¨gc
,c⁄° **
_¨gv
){

166 
FILE
 *
fö1
;

167 
FILE
 *
fö2
;

168 *
x
;

169 *
y
;

170 *
xb
;

171 *
X
;

172 *
Y
;

173 
îr
;

174 
Q
;

175 
size_t
 
xÀngth
;

176 
size_t
 
yÀngth
;

177 
size_t
 
n‰ames
;

178 
size_t
 
xi
;

179 
ci
;

180 
xj
;

181 
bi
;

182 
nch™√ls
;

183 
øã
;

184 
downßm∂e
;

185 
yb™ds
;

186 
y‰eqs
;

187 
max_com∑ª
;

188 if(
_¨gc
<3||_argc>6){

189 
	`Ârötf
(
°dîr
,"Usage: %s [-s] [-rÑate2] <file1.sw> <file2.sw>\n",

190 
_¨gv
[0]);

191  
EXIT_FAILURE
;

193 
nch™√ls
=1;

194 if(
	`°rcmp
(
_¨gv
[1],"-s")==0){

195 
nch™√ls
=2;

196 
_¨gv
++;

198 
øã
=48000;

199 
yb™ds
=
NBANDS
;

200 
y‰eqs
=
NFREQS
;

201 
downßm∂e
=1;

202 if(
	`°rcmp
(
_¨gv
[1],"-r")==0){

203 
øã
=
	`©oi
(
_¨gv
[2]);

204 if(
øã
!=8000&&rate!=12000&&rate!=16000&&rate!=24000&&rate!=48000){

205 
	`Ârötf
(
°dîr
,

207  
EXIT_FAILURE
;

209 
downßm∂e
=48000/
øã
;

210 
øã
){

211 8000:
yb™ds
=13;;

212 12000:
yb™ds
=15;;

213 16000:
yb™ds
=17;;

214 24000:
yb™ds
=19;;

216 
y‰eqs
=
NFREQS
/
downßm∂e
;

217 
_¨gv
+=2;

219 
fö1
=
	`f›í
(
_¨gv
[1],"rb");

220 if(
fö1
==
NULL
){

221 
	`Ârötf
(
°dîr
,"Eº‹ o≥nög '%s'.\n",
_¨gv
[1]);

222  
EXIT_FAILURE
;

224 
fö2
=
	`f›í
(
_¨gv
[2],"rb");

225 if(
fö2
==
NULL
){

226 
	`Ârötf
(
°dîr
,"Eº‹ o≥nög '%s'.\n",
_¨gv
[2]);

227 
	`f˛o£
(
fö1
);

228  
EXIT_FAILURE
;

231 
xÀngth
=
	`ªad_pcm16
(&
x
,
fö1
,2);

232 if(
nch™√ls
==1){

233 
xi
=0;xi<
xÀngth
;xi++)
x
[xi]=.5*(x[2*xi]+x[2*xi+1]);

235 
	`f˛o£
(
fö1
);

236 
yÀngth
=
	`ªad_pcm16
(&
y
,
fö2
,
nch™√ls
);

237 
	`f˛o£
(
fö2
);

238 if(
xÀngth
!=
yÀngth
*
downßm∂e
){

239 
	`Ârötf
(
°dîr
,"Sample counts doÇot match (%lu!=%lu).\n",

240 ()
xÀngth
,()
yÀngth
*
downßm∂e
);

241  
EXIT_FAILURE
;

243 if(
xÀngth
<
TEST_WIN_SIZE
){

244 
	`Ârötf
(
°dîr
,"Insufficient sample data (%lu<%i).\n",

245 ()
xÀngth
,
TEST_WIN_SIZE
);

246  
EXIT_FAILURE
;

248 
n‰ames
=(
xÀngth
-
TEST_WIN_SIZE
+
TEST_WIN_STEP
)/TEST_WIN_STEP;

249 
xb
=(*)
	`›us_mÆloc
(
n‰ames
*
NBANDS
*
nch™√ls
*(*xb));

250 
X
=(*)
	`›us_mÆloc
(
n‰ames
*
NFREQS
*
nch™√ls
*(*X));

251 
Y
=(*)
	`›us_mÆloc
(
n‰ames
*
y‰eqs
*
nch™√ls
*(*Y));

254 
	`b™d_íîgy
(
xb
,
X
,
BANDS
,
NBANDS
,
x
,
nch™√ls
,
n‰ames
,

255 
TEST_WIN_SIZE
,
TEST_WIN_STEP
,1);

256 
	`‰ì
(
x
);

257 
	`b™d_íîgy
(
NULL
,
Y
,
BANDS
,
yb™ds
,
y
,
nch™√ls
,
n‰ames
,

258 
TEST_WIN_SIZE
/
downßm∂e
,
TEST_WIN_STEP
/downsample,downsample);

259 
	`‰ì
(
y
);

260 
xi
=0;xi<
n‰ames
;xi++){

262 
bi
=1;bi<
NBANDS
;bi++){

263 
ci
=0;ci<
nch™√ls
;ci++){

264 
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+
ci
]+=

265 0.1F*
xb
[(
xi
*
NBANDS
+
bi
-1)*
nch™√ls
+
ci
];

269 
bi
=
NBANDS
-1;bi-->0;){

270 
ci
=0;ci<
nch™√ls
;ci++){

271 
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+
ci
]+=

272 0.03F*
xb
[(
xi
*
NBANDS
+
bi
+1)*
nch™√ls
+
ci
];

275 if(
xi
>0){

277 
bi
=0;bi<
NBANDS
;bi++){

278 
ci
=0;ci<
nch™√ls
;ci++){

279 
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+
ci
]+=

280 0.5F*
xb
[((
xi
-1)*
NBANDS
+
bi
)*
nch™√ls
+
ci
];

285 if(
nch™√ls
==2){

286 
bi
=0;bi<
NBANDS
;bi++){

287 
l
,
r
;

288 
l
=
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+0];

289 
r
=
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+1];

290 
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+0]+=0.01F*
r
;

291 
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+1]+=0.01F*
l
;

296 
bi
=0;bi<
yb™ds
;bi++){

297 
xj
=
BANDS
[
bi
];xj<BANDS[bi+1];xj++){

298 
ci
=0;ci<
nch™√ls
;ci++){

299 
X
[(
xi
*
NFREQS
+
xj
)*
nch™√ls
+
ci
]+=

300 0.1F*
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+
ci
];

301 
Y
[(
xi
*
y‰eqs
+
xj
)*
nch™√ls
+
ci
]+=

302 0.1F*
xb
[(
xi
*
NBANDS
+
bi
)*
nch™√ls
+
ci
];

309 
bi
=0;bi<
yb™ds
;bi++){

310 
xj
=
BANDS
[
bi
];xj<BANDS[bi+1];xj++){

311 
ci
=0;ci<
nch™√ls
;ci++){

312 
xtmp
;

313 
ytmp
;

314 
xtmp
 = 
X
[
xj
*
nch™√ls
+
ci
];

315 
ytmp
 = 
Y
[
xj
*
nch™√ls
+
ci
];

316 
xi
=1;xi<
n‰ames
;xi++){

317 
xtmp2
;

318 
ytmp2
;

319 
xtmp2
 = 
X
[(
xi
*
NFREQS
+
xj
)*
nch™√ls
+
ci
];

320 
ytmp2
 = 
Y
[(
xi
*
y‰eqs
+
xj
)*
nch™√ls
+
ci
];

321 
X
[(
xi
*
NFREQS
+
xj
)*
nch™√ls
+
ci
] +
xtmp
;

322 
Y
[(
xi
*
y‰eqs
+
xj
)*
nch™√ls
+
ci
] +
ytmp
;

323 
xtmp
 = 
xtmp2
;

324 
ytmp
 = 
ytmp2
;

334 if(
øã
==48000)
max_com∑ª
=
BANDS
[
NBANDS
];

335 if(
øã
==12000)
max_com∑ª
=
BANDS
[
yb™ds
];

336 
max_com∑ª
=
BANDS
[
yb™ds
]-3;

337 
îr
=0;

338 
xi
=0;xi<
n‰ames
;xi++){

339 
Ef
;

340 
Ef
=0;

341 
bi
=0;bi<
yb™ds
;bi++){

342 
Eb
;

343 
Eb
=0;

344 
xj
=
BANDS
[
bi
];xj<BANDS[bi+1]&&xj<
max_com∑ª
;xj++){

345 
ci
=0;ci<
nch™√ls
;ci++){

346 
ª
;

347 
im
;

348 
ª
=
Y
[(
xi
*
y‰eqs
+
xj
)*
nch™√ls
+
ci
]/
X
[(xi*
NFREQS
+xj)*nchannels+ci];

349 
im
=
ª
-
	`log
(re)-1;

352 if(
xj
>=79&&xj<=81)
im
*=0.1F;

353 if(
xj
==80)
im
*=0.1F;

354 
Eb
+=
im
;

357 
Eb
 /(
BANDS
[
bi
+1]-BANDS[bi])*
nch™√ls
;

358 
Ef
 +
Eb
*Eb;

362 
Ef
/=
NBANDS
;

363 
Ef
*=Ef;

364 
îr
+=
Ef
*Ef;

366 
	`‰ì
(
xb
);

367 
	`‰ì
(
X
);

368 
	`‰ì
(
Y
);

369 
îr
=
	`pow
”º/
n‰ames
,1.0/16);

370 
Q
=100*(1-0.5*
	`log
(1+
îr
)/log(1.13));

371 if(
Q
<0){

372 
	`Ârötf
(
°dîr
,"Test vector FAILS\n");

373 
	`Ârötf
(
°dîr
,"I¡î«»weighãdÉº‹ i†%f\n",
îr
);

374  
EXIT_FAILURE
;

377 
	`Ârötf
(
°dîr
,"Test vector PASSES\n");

378 
	`Ârötf
(
°dîr
,

379 "Opu†quÆôy mëric: %.1‡%% (öã∫Æ weighãdÉº‹ i†%f)\n",
Q
,
îr
);

380  
EXIT_SUCCESS
;

382 
	}
}

	@src/opus_decoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 #i‚de‡
OPUS_BUILD


36 #i‡
deföed
(
__GNUC__
Ë&& (__GNUC__ >2Ë&& !deföed(
__OPTIMIZE__
Ë&& !deföed(
OPUS_WILL_BE_SLOW
)

37 #¥agm®
mesßge
 "YouáppearÅo be compiling without optimization, if so opus will be very slow."

40 
	~<°d¨g.h
>

41 
	~"˚….h
"

42 
	~"›us.h
"

43 
	~"ítdec.h
"

44 
	~"modes.h
"

45 
	~"API.h
"

46 
	~"°ack_Æloc.h
"

47 
	~"Êﬂt_ˇ°.h
"

48 
	~"›us_¥iv©e.h
"

49 
	~"os_suµ‹t.h
"

50 
	~"°ru˘s.h
"

51 
	~"deföe.h
"

52 
	~"m©h›s.h
"

53 
	~"˝u_suµ‹t.h
"

55 
	sOpusDecodî
 {

56 
	m˚…_dec_off£t
;

57 
	msûk_dec_off£t
;

58 
	mch™√ls
;

59 
›us_öt32
 
	mFs
;

60 
sûk_DecC⁄åﬁSåu˘
 
	mDecC⁄åﬁ
;

61 
	mdecode_gaö
;

62 
	m¨ch
;

65 
	#OPUS_DECODER_RESET_START
 
°ªam_ch™√ls


	)

66 
	m°ªam_ch™√ls
;

68 
	mb™dwidth
;

69 
	mmode
;

70 
	m¥ev_mode
;

71 
	m‰ame_size
;

72 
	m¥ev_ªdund™cy
;

73 
	mœ°_∑ckë_duøti⁄
;

74 #i‚de‡
FIXED_POINT


75 
›us_vÆ16
 
	mso·˛ù_mem
[2];

78 
›us_uöt32
 
	møngeFöÆ
;

81 #i‡
deföed
(
ENABLE_HARDENING
Ë|| deföed(
ENABLE_ASSERTIONS
)

82 
	$vÆid©e_›us_decodî
(
OpusDecodî
 *
°
)

84 
	`˚…_as£π
(
°
->
ch™√ls
 == 1 || st->channels == 2);

85 
	`˚…_as£π
(
°
->
Fs
 == 48000 || st->Fs == 24000 || st->Fs == 16000 || st->Fs == 12000 || st->Fs == 8000);

86 
	`˚…_as£π
(
°
->
DecC⁄åﬁ
.
API_ßm∂eR©e
 =°->
Fs
);

87 
	`˚…_as£π
(
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 == 0 || st->DecControl.internalSampleRate == 16000 || st->DecControl.internalSampleRate == 12000 || st->DecControl.internalSampleRate == 8000);

88 
	`˚…_as£π
(
°
->
DecC⁄åﬁ
.
nCh™√lsAPI
 =°->
ch™√ls
);

89 
	`˚…_as£π
(
°
->
DecC⁄åﬁ
.
nCh™√lsI¡î«l
 == 0 || st->DecControl.nChannelsInternal == 1 || st->DecControl.nChannelsInternal == 2);

90 
	`˚…_as£π
(
°
->
DecC⁄åﬁ
.
∑ylﬂdSize_ms
 == 0 || st->DecControl.payloadSize_ms == 10 || st->DecControl.payloadSize_ms == 20 || st->DecControl.payloadSize_ms == 40 || st->DecControl.payloadSize_ms == 60);

91 #ifde‡
OPUS_ARCHMASK


92 
	`˚…_as£π
(
°
->
¨ch
 >= 0);

93 
	`˚…_as£π
(
°
->
¨ch
 <
OPUS_ARCHMASK
);

95 
	`˚…_as£π
(
°
->
°ªam_ch™√ls
 == 1 || st->stream_channels == 2);

96 
	}
}

97 
	#VALIDATE_OPUS_DECODER
(
°
Ë
	`vÆid©e_›us_decodî
(°)

	)

99 
	#VALIDATE_OPUS_DECODER
(
°
)

	)

102 
	$›us_decodî_gë_size
(
ch™√ls
)

104 
sûkDecSizeByãs
, 
˚…DecSizeByãs
;

105 
ªt
;

106 i‡(
ch™√ls
<1 || channels > 2)

108 
ªt
 = 
	`sûk_Gë_Decodî_Size
–&
sûkDecSizeByãs
 );

109 if(
ªt
)

111 
sûkDecSizeByãs
 = 
	`Æign
(silkDecSizeBytes);

112 
˚…DecSizeByãs
 = 
	`˚…_decodî_gë_size
(
ch™√ls
);

113  
	`Æign
((
OpusDecodî
))+
sûkDecSizeByãs
+
˚…DecSizeByãs
;

114 
	}
}

116 
	$›us_decodî_öô
(
OpusDecodî
 *
°
, 
›us_öt32
 
Fs
, 
ch™√ls
)

118 *
sûk_dec
;

119 
CELTDecodî
 *
˚…_dec
;

120 
ªt
, 
sûkDecSizeByãs
;

122 i‡((
Fs
!=48000&&Fs!=24000&&Fs!=16000&&Fs!=12000&&Fs!=8000)

123 || (
ch™√ls
!=1&&channels!=2))

124  
OPUS_BAD_ARG
;

126 
	`OPUS_CLEAR
((*)
°
, 
	`›us_decodî_gë_size
(
ch™√ls
));

128 
ªt
 = 
	`sûk_Gë_Decodî_Size
(&
sûkDecSizeByãs
);

129 i‡(
ªt
)

130  
OPUS_INTERNAL_ERROR
;

132 
sûkDecSizeByãs
 = 
	`Æign
(silkDecSizeBytes);

133 
°
->
sûk_dec_off£t
 = 
	`Æign
((
OpusDecodî
));

134 
°
->
˚…_dec_off£t
 = st->
sûk_dec_off£t
+
sûkDecSizeByãs
;

135 
sûk_dec
 = (*)
°
+°->
sûk_dec_off£t
;

136 
˚…_dec
 = (
CELTDecodî
*)((*)
°
+°->
˚…_dec_off£t
);

137 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
 = channels;

139 
°
->
Fs
 = Fs;

140 
°
->
DecC⁄åﬁ
.
API_ßm∂eR©e
 = st->
Fs
;

141 
°
->
DecC⁄åﬁ
.
nCh™√lsAPI
 = st->
ch™√ls
;

144 
ªt
 = 
	`sûk_InôDecodî
–
sûk_dec
 );

145 if(
ªt
) 
OPUS_INTERNAL_ERROR
;

148 
ªt
 = 
	`˚…_decodî_öô
(
˚…_dec
, 
Fs
, 
ch™√ls
);

149 if(
ªt
!=
OPUS_OK
) 
OPUS_INTERNAL_ERROR
;

151 
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_SIGNALLING
(0));

153 
°
->
¥ev_mode
 = 0;

154 
°
->
‰ame_size
 = 
Fs
/400;

155 
°
->
¨ch
 = 
	`›us_£À˘_¨ch
();

156  
OPUS_OK
;

157 
	}
}

159 
OpusDecodî
 *
	$›us_decodî_¸óã
(
›us_öt32
 
Fs
, 
ch™√ls
, *
îr‹
)

161 
ªt
;

162 
OpusDecodî
 *
°
;

163 i‡((
Fs
!=48000&&Fs!=24000&&Fs!=16000&&Fs!=12000&&Fs!=8000)

164 || (
ch™√ls
!=1&&channels!=2))

166 i‡(
îr‹
)

167 *
îr‹
 = 
OPUS_BAD_ARG
;

168  
NULL
;

170 
°
 = (
OpusDecodî
 *)
	`›us_Æloc
(
	`›us_decodî_gë_size
(
ch™√ls
));

171 i‡(
°
 =
NULL
)

173 i‡(
îr‹
)

174 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

175  
NULL
;

177 
ªt
 = 
	`›us_decodî_öô
(
°
, 
Fs
, 
ch™√ls
);

178 i‡(
îr‹
)

179 *
îr‹
 = 
ªt
;

180 i‡(
ªt
 !
OPUS_OK
)

182 
	`›us_‰ì
(
°
);

183 
°
 = 
NULL
;

185  
°
;

186 
	}
}

188 
	$smoŸh_Áde
(c⁄° 
›us_vÆ16
 *
ö1
, c⁄° opus_vÆ16 *
ö2
,

189 
›us_vÆ16
 *
out
, 
ovîœp
, 
ch™√ls
,

190 c⁄° 
›us_vÆ16
 *
wödow
, 
›us_öt32
 
Fs
)

192 
i
, 
c
;

193 
öc
 = 48000/
Fs
;

194 
c
=0;c<
ch™√ls
;c++)

196 
i
=0;i<
ovîœp
;i++)

198 
›us_vÆ16
 
w
 = 
	`MULT16_16_Q15
(
wödow
[
i
*
öc
], window[i*inc]);

199 
out
[
i
*
ch™√ls
+
c
] = 
	`SHR32
(
	`MAC16_16
(
	`MULT16_16
(
w
,
ö2
[i*channels+c]),

200 
Q15ONE
-
w
, 
ö1
[
i
*
ch™√ls
+
c
]), 15);

203 
	}
}

205 
	$›us_∑ckë_gë_mode
(c⁄° *
d©a
)

207 
mode
;

208 i‡(
d©a
[0]&0x80)

210 
mode
 = 
MODE_CELT_ONLY
;

211 } i‡((
d©a
[0]&0x60) == 0x60)

213 
mode
 = 
MODE_HYBRID
;

215 
mode
 = 
MODE_SILK_ONLY
;

217  
mode
;

218 
	}
}

220 
	$›us_decode_‰ame
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

221 
›us_öt32
 
Àn
, 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
decode_„c
)

223 *
sûk_dec
;

224 
CELTDecodî
 *
˚…_dec
;

225 
i
, 
sûk_ªt
=0, 
˚…_ªt
=0;

226 
ec_dec
 
dec
;

227 
›us_öt32
 
sûk_‰ame_size
;

228 
pcm_sûk_size
;

229 
	`VARDECL
(
›us_öt16
, 
pcm_sûk
);

230 
pcm_å™sôi⁄_sûk_size
;

231 
	`VARDECL
(
›us_vÆ16
, 
pcm_å™sôi⁄_sûk
);

232 
pcm_å™sôi⁄_˚…_size
;

233 
	`VARDECL
(
›us_vÆ16
, 
pcm_å™sôi⁄_˚…
);

234 
›us_vÆ16
 *
pcm_å™sôi⁄
=
NULL
;

235 
ªdund™t_audio_size
;

236 
	`VARDECL
(
›us_vÆ16
, 
ªdund™t_audio
);

238 
audiosize
;

239 
mode
;

240 
b™dwidth
;

241 
å™sôi⁄
=0;

242 
°¨t_b™d
;

243 
ªdund™cy
=0;

244 
ªdund™cy_byãs
 = 0;

245 
˚…_to_sûk
=0;

246 
c
;

247 
F2_5
, 
F5
, 
F10
, 
F20
;

248 c⁄° 
›us_vÆ16
 *
wödow
;

249 
›us_uöt32
 
ªdund™t_∫g
 = 0;

250 
˚…_accum
;

251 
ALLOC_STACK
;

253 
sûk_dec
 = (*)
°
+°->
sûk_dec_off£t
;

254 
˚…_dec
 = (
CELTDecodî
*)((*)
°
+°->
˚…_dec_off£t
);

255 
F20
 = 
°
->
Fs
/50;

256 
F10
 = 
F20
>>1;

257 
F5
 = 
F10
>>1;

258 
F2_5
 = 
F5
>>1;

259 i‡(
‰ame_size
 < 
F2_5
)

261 
RESTORE_STACK
;

262  
OPUS_BUFFER_TOO_SMALL
;

265 
‰ame_size
 = 
	`IMIN
(‰ame_size, 
°
->
Fs
/25*3);

267 i‡(
Àn
<=1)

269 
d©a
 = 
NULL
;

271 
‰ame_size
 = 
	`IMIN
(‰ame_size, 
°
->frame_size);

273 i‡(
d©a
 !
NULL
)

275 
audiosize
 = 
°
->
‰ame_size
;

276 
mode
 = 
°
->mode;

277 
b™dwidth
 = 
°
->bandwidth;

278 
	`ec_dec_öô
(&
dec
,(*)
d©a
,
Àn
);

280 
audiosize
 = 
‰ame_size
;

281 
mode
 = 
°
->
¥ev_mode
;

282 
b™dwidth
 = 0;

284 i‡(
mode
 == 0)

287 
i
=0;i<
audiosize
*
°
->
ch™√ls
;i++)

288 
pcm
[
i
] = 0;

289 
RESTORE_STACK
;

290  
audiosize
;

295 i‡(
audiosize
 > 
F20
)

298 
ªt
 = 
	`›us_decode_‰ame
(
°
, 
NULL
, 0, 
pcm
, 
	`IMIN
(
audiosize
, 
F20
), 0);

299 i‡(
ªt
<0)

301 
RESTORE_STACK
;

302  
ªt
;

304 
pcm
 +
ªt
*
°
->
ch™√ls
;

305 
audiosize
 -
ªt
;

306 } 
audiosize
 > 0);

307 
RESTORE_STACK
;

308  
‰ame_size
;

309 } i‡(
audiosize
 < 
F20
)

311 i‡(
audiosize
 > 
F10
)

312 
audiosize
 = 
F10
;

313 i‡(
mode
 !
MODE_SILK_ONLY
 && 
audiosize
 > 
F5
 &&áudiosizê< 
F10
)

314 
audiosize
 = 
F5
;

320 #ifde‡
FIXED_POINT


321 
˚…_accum
 = (
mode
 !
MODE_CELT_ONLY
Ë&& (
‰ame_size
 >
F10
);

323 
˚…_accum
 = 0;

326 
pcm_å™sôi⁄_sûk_size
 = 
ALLOC_NONE
;

327 
pcm_å™sôi⁄_˚…_size
 = 
ALLOC_NONE
;

328 i‡(
d©a
!=
NULL
 && 
°
->
¥ev_mode
 > 0 && (

329 (
mode
 =
MODE_CELT_ONLY
 && 
°
->
¥ev_mode
 !MODE_CELT_ONLY && !°->
¥ev_ªdund™cy
)

330 || (
mode
 !
MODE_CELT_ONLY
 && 
°
->
¥ev_mode
 == MODE_CELT_ONLY) )

333 
å™sôi⁄
 = 1;

335 i‡(
mode
 =
MODE_CELT_ONLY
)

336 
pcm_å™sôi⁄_˚…_size
 = 
F5
*
°
->
ch™√ls
;

338 
pcm_å™sôi⁄_sûk_size
 = 
F5
*
°
->
ch™√ls
;

340 
	`ALLOC
(
pcm_å™sôi⁄_˚…
, 
pcm_å™sôi⁄_˚…_size
, 
›us_vÆ16
);

341 i‡(
å™sôi⁄
 && 
mode
 =
MODE_CELT_ONLY
)

343 
pcm_å™sôi⁄
 = 
pcm_å™sôi⁄_˚…
;

344 
	`›us_decode_‰ame
(
°
, 
NULL
, 0, 
pcm_å™sôi⁄
, 
	`IMIN
(
F5
, 
audiosize
), 0);

346 i‡(
audiosize
 > 
‰ame_size
)

349 
RESTORE_STACK
;

350  
OPUS_BAD_ARG
;

352 
‰ame_size
 = 
audiosize
;

356 
pcm_sûk_size
 = (
mode
 !
MODE_CELT_ONLY
 && !
˚…_accum
Ë? 
	`IMAX
(
F10
, 
‰ame_size
)*
°
->
ch™√ls
 : 
ALLOC_NONE
;

357 
	`ALLOC
(
pcm_sûk
, 
pcm_sûk_size
, 
›us_öt16
);

360 i‡(
mode
 !
MODE_CELT_ONLY
)

362 
lo°_Êag
, 
decoded_ßm∂es
;

363 
›us_öt16
 *
pcm_±r
;

364 #ifde‡
FIXED_POINT


365 i‡(
˚…_accum
)

366 
pcm_±r
 = 
pcm
;

369 
pcm_±r
 = 
pcm_sûk
;

371 i‡(
°
->
¥ev_mode
==
MODE_CELT_ONLY
)

372 
	`sûk_InôDecodî
–
sûk_dec
 );

375 
°
->
DecC⁄åﬁ
.
∑ylﬂdSize_ms
 = 
	`IMAX
(10, 1000 * 
audiosize
 / st->
Fs
);

377 i‡(
d©a
 !
NULL
)

379 
°
->
DecC⁄åﬁ
.
nCh™√lsI¡î«l
 = st->
°ªam_ch™√ls
;

380 if–
mode
 =
MODE_SILK_ONLY
 ) {

381 if–
b™dwidth
 =
OPUS_BANDWIDTH_NARROWBAND
 ) {

382 
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 = 8000;

383 } if–
b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
 ) {

384 
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 = 12000;

385 } if–
b™dwidth
 =
OPUS_BANDWIDTH_WIDEBAND
 ) {

386 
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 = 16000;

388 
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 = 16000;

389 
	`˚…_as£π
( 0 );

393 
°
->
DecC⁄åﬁ
.
öã∫ÆSam∂eR©e
 = 16000;

397 
lo°_Êag
 = 
d©a
 =
NULL
 ? 1 : 2 * 
decode_„c
;

398 
decoded_ßm∂es
 = 0;

401 
fú°_‰ame
 = 
decoded_ßm∂es
 == 0;

402 
sûk_ªt
 = 
	`sûk_Decode
–
sûk_dec
, &
°
->
DecC⁄åﬁ
,

403 
lo°_Êag
, 
fú°_‰ame
, &
dec
, 
pcm_±r
, &
sûk_‰ame_size
, 
°
->
¨ch
 );

404 if–
sûk_ªt
 ) {

405 i‡(
lo°_Êag
) {

407 
sûk_‰ame_size
 = 
‰ame_size
;

408 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

409 
pcm_±r
[
i
] = 0;

411 
RESTORE_STACK
;

412  
OPUS_INTERNAL_ERROR
;

415 
pcm_±r
 +
sûk_‰ame_size
 * 
°
->
ch™√ls
;

416 
decoded_ßm∂es
 +
sûk_‰ame_size
;

417 }  
decoded_ßm∂es
 < 
‰ame_size
 );

420 
°¨t_b™d
 = 0;

421 i‡(!
decode_„c
 && 
mode
 !
MODE_CELT_ONLY
 && 
d©a
 !
NULL


422 && 
	`ec_ãŒ
(&
dec
)+17+20*(
°
->
mode
 =
MODE_HYBRID
Ë<8*
Àn
)

425 i‡(
mode
 =
MODE_HYBRID
)

426 
ªdund™cy
 = 
	`ec_dec_bô_logp
(&
dec
, 12);

428 
ªdund™cy
 = 1;

429 i‡(
ªdund™cy
)

431 
˚…_to_sûk
 = 
	`ec_dec_bô_logp
(&
dec
, 1);

434 
ªdund™cy_byãs
 = 
mode
==
MODE_HYBRID
 ?

435 (
›us_öt32
)
	`ec_dec_uöt
(&
dec
, 256)+2 :

436 
Àn
-((
	`ec_ãŒ
(&
dec
)+7)>>3);

437 
Àn
 -
ªdund™cy_byãs
;

440 i‡(
Àn
*8 < 
	`ec_ãŒ
(&
dec
))

442 
Àn
 = 0;

443 
ªdund™cy_byãs
 = 0;

444 
ªdund™cy
 = 0;

447 
dec
.
°‹age
 -
ªdund™cy_byãs
;

450 i‡(
mode
 !
MODE_CELT_ONLY
)

451 
°¨t_b™d
 = 17;

453 i‡(
ªdund™cy
)

455 
å™sôi⁄
 = 0;

456 
pcm_å™sôi⁄_sûk_size
=
ALLOC_NONE
;

459 
	`ALLOC
(
pcm_å™sôi⁄_sûk
, 
pcm_å™sôi⁄_sûk_size
, 
›us_vÆ16
);

461 i‡(
å™sôi⁄
 && 
mode
 !
MODE_CELT_ONLY
)

463 
pcm_å™sôi⁄
 = 
pcm_å™sôi⁄_sûk
;

464 
	`›us_decode_‰ame
(
°
, 
NULL
, 0, 
pcm_å™sôi⁄
, 
	`IMIN
(
F5
, 
audiosize
), 0);

468 i‡(
b™dwidth
)

470 
ídb™d
=21;

472 
b™dwidth
)

474 
OPUS_BANDWIDTH_NARROWBAND
:

475 
ídb™d
 = 13;

477 
OPUS_BANDWIDTH_MEDIUMBAND
:

478 
OPUS_BANDWIDTH_WIDEBAND
:

479 
ídb™d
 = 17;

481 
OPUS_BANDWIDTH_SUPERWIDEBAND
:

482 
ídb™d
 = 19;

484 
OPUS_BANDWIDTH_FULLBAND
:

485 
ídb™d
 = 21;

488 
	`˚…_as£π
(0);

491 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_END_BAND
(
ídb™d
)));

493 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_CHANNELS
(
°
->
°ªam_ch™√ls
)));

496 
ªdund™t_audio_size
 = 
ªdund™cy
 ? 
F5
*
°
->
ch™√ls
 : 
ALLOC_NONE
;

497 
	`ALLOC
(
ªdund™t_audio
, 
ªdund™t_audio_size
, 
›us_vÆ16
);

500 i‡(
ªdund™cy
 && 
˚…_to_sûk
)

502 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_START_BAND
(0)));

503 
	`˚…_decode_wôh_ec
(
˚…_dec
, 
d©a
+
Àn
, 
ªdund™cy_byãs
,

504 
ªdund™t_audio
, 
F5
, 
NULL
, 0);

505 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`OPUS_GET_FINAL_RANGE
(&
ªdund™t_∫g
)));

509 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_START_BAND
(
°¨t_b™d
)));

511 i‡(
mode
 !
MODE_SILK_ONLY
)

513 
˚…_‰ame_size
 = 
	`IMIN
(
F20
, 
‰ame_size
);

515 i‡(
mode
 !
°
->
¥ev_mode
 && st->¥ev_modê> 0 && !°->
¥ev_ªdund™cy
)

516 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
OPUS_RESET_STATE
));

518 
˚…_ªt
 = 
	`˚…_decode_wôh_ec
(
˚…_dec
, 
decode_„c
 ? 
NULL
 : 
d©a
,

519 
Àn
, 
pcm
, 
˚…_‰ame_size
, &
dec
, 
˚…_accum
);

521 
sûí˚
[2] = {0xFF, 0xFF};

522 i‡(!
˚…_accum
)

524 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

525 
pcm
[
i
] = 0;

529 i‡(
°
->
¥ev_mode
 =
MODE_HYBRID
 && !(
ªdund™cy
 && 
˚…_to_sûk
 && st->
¥ev_ªdund™cy
) )

531 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_START_BAND
(0)));

532 
	`˚…_decode_wôh_ec
(
˚…_dec
, 
sûí˚
, 2, 
pcm
, 
F2_5
, 
NULL
, 
˚…_accum
);

536 i‡(
mode
 !
MODE_CELT_ONLY
 && !
˚…_accum
)

538 #ifde‡
FIXED_POINT


539 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

540 
pcm
[
i
] = 
	`SAT16
(
	`ADD32
’cm[i], 
pcm_sûk
[i]));

542 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

543 
pcm
[
i
] =Öcm[i] + (
›us_vÆ16
)((1.f/32768.f)*
pcm_sûk
[i]);

548 c⁄° 
CELTMode
 *
˚…_mode
;

549 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_GET_MODE
(&
˚…_mode
)));

550 
wödow
 = 
˚…_mode
->window;

554 i‡(
ªdund™cy
 && !
˚…_to_sûk
)

556 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
OPUS_RESET_STATE
));

557 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`CELT_SET_START_BAND
(0)));

559 
	`˚…_decode_wôh_ec
(
˚…_dec
, 
d©a
+
Àn
, 
ªdund™cy_byãs
, 
ªdund™t_audio
, 
F5
, 
NULL
, 0);

560 
	`MUST_SUCCEED
(
	`˚…_decodî_˘l
(
˚…_dec
, 
	`OPUS_GET_FINAL_RANGE
(&
ªdund™t_∫g
)));

561 
	`smoŸh_Áde
(
pcm
+
°
->
ch™√ls
*(
‰ame_size
-
F2_5
), 
ªdund™t_audio
+st->channels*F2_5,

562 
pcm
+
°
->
ch™√ls
*(
‰ame_size
-
F2_5
), F2_5, st->ch™√ls, 
wödow
, st->
Fs
);

564 i‡(
ªdund™cy
 && 
˚…_to_sûk
)

566 
c
=0;c<
°
->
ch™√ls
;c++)

568 
i
=0;i<
F2_5
;i++)

569 
pcm
[
°
->
ch™√ls
*
i
+
c
] = 
ªdund™t_audio
[st->channels*i+c];

571 
	`smoŸh_Áde
(
ªdund™t_audio
+
°
->
ch™√ls
*
F2_5
, 
pcm
+st->channels*F2_5,

572 
pcm
+
°
->
ch™√ls
*
F2_5
, F2_5, st->ch™√ls, 
wödow
, st->
Fs
);

574 i‡(
å™sôi⁄
)

576 i‡(
audiosize
 >
F5
)

578 
i
=0;i<
°
->
ch™√ls
*
F2_5
;i++)

579 
pcm
[
i
] = 
pcm_å™sôi⁄
[i];

580 
	`smoŸh_Áde
(
pcm_å™sôi⁄
+
°
->
ch™√ls
*
F2_5
, 
pcm
+st->channels*F2_5,

581 
pcm
+
°
->
ch™√ls
*
F2_5
, F2_5,

582 
°
->
ch™√ls
, 
wödow
, st->
Fs
);

589 
	`smoŸh_Áde
(
pcm_å™sôi⁄
, 
pcm
,

590 
pcm
, 
F2_5
,

591 
°
->
ch™√ls
, 
wödow
, st->
Fs
);

595 if(
°
->
decode_gaö
)

597 
›us_vÆ32
 
gaö
;

598 
gaö
 = 
	`˚…_exp2
(
	`MULT16_16_P15
(
	`QCONST16
(6.48814081e-4f, 25), 
°
->
decode_gaö
));

599 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

601 
›us_vÆ32
 
x
;

602 
x
 = 
	`MULT16_32_P16
(
pcm
[
i
],
gaö
);

603 
pcm
[
i
] = 
	`SATURATE
(
x
, 32767);

607 i‡(
Àn
 <= 1)

608 
°
->
øngeFöÆ
 = 0;

610 
°
->
øngeFöÆ
 = 
dec
.
∫g
 ^ 
ªdund™t_∫g
;

612 
°
->
¥ev_mode
 = 
mode
;

613 
°
->
¥ev_ªdund™cy
 = 
ªdund™cy
 && !
˚…_to_sûk
;

615 i‡(
˚…_ªt
>=0)

617 i‡(
	`OPUS_CHECK_ARRAY
(
pcm
, 
audiosize
*
°
->
ch™√ls
))

618 
	`OPUS_PRINT_INT
(
audiosize
);

621 
RESTORE_STACK
;

622  
˚…_ªt
 < 0 ? cñt_ªà: 
audiosize
;

624 
	}
}

626 
	$›us_decode_«tive
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

627 
›us_öt32
 
Àn
, 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
decode_„c
,

628 
£lf_dñimôed
, 
›us_öt32
 *
∑ckë_off£t
, 
so·_˛ù
)

630 
i
, 
nb_ßm∂es
;

631 
cou¡
, 
off£t
;

632 
toc
;

633 
∑ckë_‰ame_size
, 
∑ckë_b™dwidth
, 
∑ckë_mode
, 
∑ckë_°ªam_ch™√ls
;

635 
›us_öt16
 
size
[48];

636 
	`VALIDATE_OPUS_DECODER
(
°
);

637 i‡(
decode_„c
<0 || decode_fec>1)

638  
OPUS_BAD_ARG
;

640 i‡((
decode_„c
 || 
Àn
==0 || 
d©a
==
NULL
Ë&& 
‰ame_size
%(
°
->
Fs
/400)!=0)

641  
OPUS_BAD_ARG
;

642 i‡(
Àn
==0 || 
d©a
==
NULL
)

644 
pcm_cou¡
=0;

646 
ªt
;

647 
ªt
 = 
	`›us_decode_‰ame
(
°
, 
NULL
, 0, 
pcm
+
pcm_cou¡
*°->
ch™√ls
, 
‰ame_size
-pcm_count, 0);

648 i‡(
ªt
<0)

649  
ªt
;

650 
pcm_cou¡
 +
ªt
;

651 } 
pcm_cou¡
 < 
‰ame_size
);

652 
	`˚…_as£π
(
pcm_cou¡
 =
‰ame_size
);

653 i‡(
	`OPUS_CHECK_ARRAY
(
pcm
, 
pcm_cou¡
*
°
->
ch™√ls
))

654 
	`OPUS_PRINT_INT
(
pcm_cou¡
);

655 
°
->
œ°_∑ckë_duøti⁄
 = 
pcm_cou¡
;

656  
pcm_cou¡
;

657 } i‡(
Àn
<0)

658  
OPUS_BAD_ARG
;

660 
∑ckë_mode
 = 
	`›us_∑ckë_gë_mode
(
d©a
);

661 
∑ckë_b™dwidth
 = 
	`›us_∑ckë_gë_b™dwidth
(
d©a
);

662 
∑ckë_‰ame_size
 = 
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
d©a
, 
°
->
Fs
);

663 
∑ckë_°ªam_ch™√ls
 = 
	`›us_∑ckë_gë_nb_ch™√ls
(
d©a
);

665 
cou¡
 = 
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 
£lf_dñimôed
, &
toc
, 
NULL
,

666 
size
, &
off£t
, 
∑ckë_off£t
);

667 i‡(
cou¡
<0)

668  
cou¡
;

670 
d©a
 +
off£t
;

672 i‡(
decode_„c
)

674 
duøti⁄_c›y
;

675 
ªt
;

677 i‡(
‰ame_size
 < 
∑ckë_‰ame_size
 || 
∑ckë_mode
 =
MODE_CELT_ONLY
 || 
°
->
mode
 == MODE_CELT_ONLY)

678  
	`›us_decode_«tive
(
°
, 
NULL
, 0, 
pcm
, 
‰ame_size
, 0, 0, NULL, 
so·_˛ù
);

680 
duøti⁄_c›y
 = 
°
->
œ°_∑ckë_duøti⁄
;

681 i‡(
‰ame_size
-
∑ckë_‰ame_size
!=0)

683 
ªt
 = 
	`›us_decode_«tive
(
°
, 
NULL
, 0, 
pcm
, 
‰ame_size
-
∑ckë_‰ame_size
, 0, 0, NULL, 
so·_˛ù
);

684 i‡(
ªt
<0)

686 
°
->
œ°_∑ckë_duøti⁄
 = 
duøti⁄_c›y
;

687  
ªt
;

689 
	`˚…_as£π
(
ªt
==
‰ame_size
-
∑ckë_‰ame_size
);

692 
°
->
mode
 = 
∑ckë_mode
;

693 
°
->
b™dwidth
 = 
∑ckë_b™dwidth
;

694 
°
->
‰ame_size
 = 
∑ckë_‰ame_size
;

695 
°
->
°ªam_ch™√ls
 = 
∑ckë_°ªam_ch™√ls
;

696 
ªt
 = 
	`›us_decode_‰ame
(
°
, 
d©a
, 
size
[0], 
pcm
+°->
ch™√ls
*(
‰ame_size
-
∑ckë_‰ame_size
),

697 
∑ckë_‰ame_size
, 1);

698 i‡(
ªt
<0)

699  
ªt
;

701 i‡(
	`OPUS_CHECK_ARRAY
(
pcm
, 
‰ame_size
*
°
->
ch™√ls
))

702 
	`OPUS_PRINT_INT
(
‰ame_size
);

703 
°
->
œ°_∑ckë_duøti⁄
 = 
‰ame_size
;

704  
‰ame_size
;

708 i‡(
cou¡
*
∑ckë_‰ame_size
 > 
‰ame_size
)

709  
OPUS_BUFFER_TOO_SMALL
;

712 
°
->
mode
 = 
∑ckë_mode
;

713 
°
->
b™dwidth
 = 
∑ckë_b™dwidth
;

714 
°
->
‰ame_size
 = 
∑ckë_‰ame_size
;

715 
°
->
°ªam_ch™√ls
 = 
∑ckë_°ªam_ch™√ls
;

717 
nb_ßm∂es
=0;

718 
i
=0;i<
cou¡
;i++)

720 
ªt
;

721 
ªt
 = 
	`›us_decode_‰ame
(
°
, 
d©a
, 
size
[
i
], 
pcm
+
nb_ßm∂es
*°->
ch™√ls
, 
‰ame_size
-nb_samples, 0);

722 i‡(
ªt
<0)

723  
ªt
;

724 
	`˚…_as£π
(
ªt
==
∑ckë_‰ame_size
);

725 
d©a
 +
size
[
i
];

726 
nb_ßm∂es
 +
ªt
;

728 
°
->
œ°_∑ckë_duøti⁄
 = 
nb_ßm∂es
;

729 i‡(
	`OPUS_CHECK_ARRAY
(
pcm
, 
nb_ßm∂es
*
°
->
ch™√ls
))

730 
	`OPUS_PRINT_INT
(
nb_ßm∂es
);

731 #i‚de‡
FIXED_POINT


732 i‡(
so·_˛ù
)

733 
	`›us_pcm_so·_˛ù
(
pcm
, 
nb_ßm∂es
, 
°
->
ch™√ls
, st->
so·˛ù_mem
);

735 
°
->
so·˛ù_mem
[0]=st->softclip_mem[1]=0;

737  
nb_ßm∂es
;

738 
	}
}

740 #ifde‡
FIXED_POINT


741 
	$›us_decode
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

742 
›us_öt32
 
Àn
, 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
decode_„c
)

744 if(
‰ame_size
<=0)

745  
OPUS_BAD_ARG
;

746  
	`›us_decode_«tive
(
°
, 
d©a
, 
Àn
, 
pcm
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
, 0);

747 
	}
}

749 #i‚de‡
DISABLE_FLOAT_API


750 
	$›us_decode_Êﬂt
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

751 
›us_öt32
 
Àn
, *
pcm
, 
‰ame_size
, 
decode_„c
)

753 
	`VARDECL
(
›us_öt16
, 
out
);

754 
ªt
, 
i
;

755 
nb_ßm∂es
;

756 
ALLOC_STACK
;

758 if(
‰ame_size
<=0)

760 
RESTORE_STACK
;

761  
OPUS_BAD_ARG
;

763 i‡(
d©a
 !
NULL
 && 
Àn
 > 0 && !
decode_„c
)

765 
nb_ßm∂es
 = 
	`›us_decodî_gë_nb_ßm∂es
(
°
, 
d©a
, 
Àn
);

766 i‡(
nb_ßm∂es
>0)

767 
‰ame_size
 = 
	`IMIN
(‰ame_size, 
nb_ßm∂es
);

769  
OPUS_INVALID_PACKET
;

771 
	`˚…_as£π
(
°
->
ch™√ls
 == 1 || st->channels == 2);

772 
	`ALLOC
(
out
, 
‰ame_size
*
°
->
ch™√ls
, 
›us_öt16
);

774 
ªt
 = 
	`›us_decode_«tive
(
°
, 
d©a
, 
Àn
, 
out
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
, 0);

775 i‡(
ªt
 > 0)

777 
i
=0;i<
ªt
*
°
->
ch™√ls
;i++)

778 
pcm
[
i
] = (1.f/32768.f)*(
out
[i]);

780 
RESTORE_STACK
;

781  
ªt
;

782 
	}
}

787 
	$›us_decode
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

788 
›us_öt32
 
Àn
, 
›us_öt16
 *
pcm
, 
‰ame_size
, 
decode_„c
)

790 
	`VARDECL
(, 
out
);

791 
ªt
, 
i
;

792 
nb_ßm∂es
;

793 
ALLOC_STACK
;

795 if(
‰ame_size
<=0)

797 
RESTORE_STACK
;

798  
OPUS_BAD_ARG
;

801 i‡(
d©a
 !
NULL
 && 
Àn
 > 0 && !
decode_„c
)

803 
nb_ßm∂es
 = 
	`›us_decodî_gë_nb_ßm∂es
(
°
, 
d©a
, 
Àn
);

804 i‡(
nb_ßm∂es
>0)

805 
‰ame_size
 = 
	`IMIN
(‰ame_size, 
nb_ßm∂es
);

807  
OPUS_INVALID_PACKET
;

809 
	`˚…_as£π
(
°
->
ch™√ls
 == 1 || st->channels == 2);

810 
	`ALLOC
(
out
, 
‰ame_size
*
°
->
ch™√ls
, );

812 
ªt
 = 
	`›us_decode_«tive
(
°
, 
d©a
, 
Àn
, 
out
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
, 1);

813 i‡(
ªt
 > 0)

815 
i
=0;i<
ªt
*
°
->
ch™√ls
;i++)

816 
pcm
[
i
] = 
	`FLOAT2INT16
(
out
[i]);

818 
RESTORE_STACK
;

819  
ªt
;

820 
	}
}

822 
	$›us_decode_Êﬂt
(
OpusDecodî
 *
°
, c⁄° *
d©a
,

823 
›us_öt32
 
Àn
, 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
decode_„c
)

825 if(
‰ame_size
<=0)

826  
OPUS_BAD_ARG
;

827  
	`›us_decode_«tive
(
°
, 
d©a
, 
Àn
, 
pcm
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
, 0);

828 
	}
}

832 
	$›us_decodî_˘l
(
OpusDecodî
 *
°
, 
ªque°
, ...)

834 
ªt
 = 
OPUS_OK
;

835 
va_li°
 
≠
;

836 *
sûk_dec
;

837 
CELTDecodî
 *
˚…_dec
;

839 
sûk_dec
 = (*)
°
+°->
sûk_dec_off£t
;

840 
˚…_dec
 = (
CELTDecodî
*)((*)
°
+°->
˚…_dec_off£t
);

843 
	`va_°¨t
(
≠
, 
ªque°
);

845 
ªque°
)

847 
OPUS_GET_BANDWIDTH_REQUEST
:

849 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

850 i‡(!
vÆue
)

852 
bad_¨g
;

854 *
vÆue
 = 
°
->
b™dwidth
;

857 
OPUS_GET_FINAL_RANGE_REQUEST
:

859 
›us_uöt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32*);

860 i‡(!
vÆue
)

862 
bad_¨g
;

864 *
vÆue
 = 
°
->
øngeFöÆ
;

867 
OPUS_RESET_STATE
:

869 
	`OPUS_CLEAR
((*)&
°
->
OPUS_DECODER_RESET_START
,

870 (
OpusDecodî
)-

871 ((*)&
°
->
OPUS_DECODER_RESET_START
 - (*)st));

873 
	`˚…_decodî_˘l
(
˚…_dec
, 
OPUS_RESET_STATE
);

874 
	`sûk_InôDecodî
–
sûk_dec
 );

875 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
;

876 
°
->
‰ame_size
 = st->
Fs
/400;

879 
OPUS_GET_SAMPLE_RATE_REQUEST
:

881 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

882 i‡(!
vÆue
)

884 
bad_¨g
;

886 *
vÆue
 = 
°
->
Fs
;

889 
OPUS_GET_PITCH_REQUEST
:

891 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

892 i‡(!
vÆue
)

894 
bad_¨g
;

896 i‡(
°
->
¥ev_mode
 =
MODE_CELT_ONLY
)

897 
ªt
 = 
	`˚…_decodî_˘l
(
˚…_dec
, 
	`OPUS_GET_PITCH
(
vÆue
));

899 *
vÆue
 = 
°
->
DecC⁄åﬁ
.
¥evPôchLag
;

902 
OPUS_GET_GAIN_REQUEST
:

904 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

905 i‡(!
vÆue
)

907 
bad_¨g
;

909 *
vÆue
 = 
°
->
decode_gaö
;

912 
OPUS_SET_GAIN_REQUEST
:

914 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

915 i‡(
vÆue
<-32768 || value>32767)

917 
bad_¨g
;

919 
°
->
decode_gaö
 = 
vÆue
;

922 
OPUS_GET_LAST_PACKET_DURATION_REQUEST
:

924 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

925 i‡(!
vÆue
)

927 
bad_¨g
;

929 *
vÆue
 = 
°
->
œ°_∑ckë_duøti⁄
;

932 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

934 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

935 if(
vÆue
<0 || value>1)

937 
bad_¨g
;

939 
ªt
 = 
	`˚…_decodî_˘l
(
˚…_dec
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(
vÆue
));

942 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

944 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

945 i‡(!
vÆue
)

947 
bad_¨g
;

949 
ªt
 = 
	`˚…_decodî_˘l
(
˚…_dec
, 
	`OPUS_GET_PHASE_INVERSION_DISABLED
(
vÆue
));

954 
ªt
 = 
OPUS_UNIMPLEMENTED
;

958 
	`va_íd
(
≠
);

959  
ªt
;

960 
bad_¨g
:

961 
	`va_íd
(
≠
);

962  
OPUS_BAD_ARG
;

963 
	}
}

965 
	$›us_decodî_de°roy
(
OpusDecodî
 *
°
)

967 
	`›us_‰ì
(
°
);

968 
	}
}

971 
	$›us_∑ckë_gë_b™dwidth
(c⁄° *
d©a
)

973 
b™dwidth
;

974 i‡(
d©a
[0]&0x80)

976 
b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
 + ((
d©a
[0]>>5)&0x3);

977 i‡(
b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
)

978 
b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

979 } i‡((
d©a
[0]&0x60) == 0x60)

981 
b™dwidth
 = (
d©a
[0]&0x10Ë? 
OPUS_BANDWIDTH_FULLBAND
 :

982 
OPUS_BANDWIDTH_SUPERWIDEBAND
;

984 
b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
 + ((
d©a
[0]>>5)&0x3);

986  
b™dwidth
;

987 
	}
}

989 
	$›us_∑ckë_gë_nb_ch™√ls
(c⁄° *
d©a
)

991  (
d©a
[0]&0x4) ? 2 : 1;

992 
	}
}

994 
	$›us_∑ckë_gë_nb_‰ames
(c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
)

996 
cou¡
;

997 i‡(
Àn
<1)

998  
OPUS_BAD_ARG
;

999 
cou¡
 = 
∑ckë
[0]&0x3;

1000 i‡(
cou¡
==0)

1002 i‡(
cou¡
!=3)

1004 i‡(
Àn
<2)

1005  
OPUS_INVALID_PACKET
;

1007  
∑ckë
[1]&0x3F;

1008 
	}
}

1010 
	$›us_∑ckë_gë_nb_ßm∂es
(c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
,

1011 
›us_öt32
 
Fs
)

1013 
ßm∂es
;

1014 
cou¡
 = 
	`›us_∑ckë_gë_nb_‰ames
(
∑ckë
, 
Àn
);

1016 i‡(
cou¡
<0)

1017  
cou¡
;

1019 
ßm∂es
 = 
cou¡
*
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
, 
Fs
);

1021 i‡(
ßm∂es
*25 > 
Fs
*3)

1022  
OPUS_INVALID_PACKET
;

1024  
ßm∂es
;

1025 
	}
}

1027 
	$›us_decodî_gë_nb_ßm∂es
(c⁄° 
OpusDecodî
 *
dec
,

1028 c⁄° 
∑ckë
[], 
›us_öt32
 
Àn
)

1030  
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
, 
Àn
, 
dec
->
Fs
);

1031 
	}
}

	@src/opus_demo.c

29 #ifde‡
HAVE_CONFIG_H


30 
	~"c⁄fig.h
"

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<m©h.h
>

36 
	~<°rög.h
>

37 
	~"›us.h
"

38 
	~"debug.h
"

39 
	~"›us_ty≥s.h
"

40 
	~"›us_¥iv©e.h
"

41 
	~"›us_mu…i°ªam.h
"

43 
	#MAX_PACKET
 1500

	)

45 
	$¥öt_ußge
–* 
¨gv
[] )

47 
	`Ârötf
(
°dîr
, "Usage: %s [-e] <application> <samplingÑate (Hz)> <channels (1/2)> "

48 "<bô†≥∏£c⁄d> [›ti⁄s] <öput> <ouçut>\n", 
¨gv
[0]);

49 
	`Ârötf
(
°dîr
, " %s -d <samplingÑate (Hz)> <channels (1/2)> "

50 "[›ti⁄s] <öput> <ouçut>\n\n", 
¨gv
[0]);

51 
	`Ârötf
(
°dîr
, "application: voip |áudio |Ñestricted-lowdelay\n" );

52 
	`Ârötf
(
°dîr
, "options:\n" );

53 
	`Ârötf
(
°dîr
, "-e : onlyÑunsÅheÉncoder (outputÅhe bit-stream)\n" );

54 
	`Ârötf
(
°dîr
, "-d : onlyÑunsÅhe decoder (readsÅhe bit-streamás input)\n" );

55 
	`Ârötf
(
°dîr
, "-cbr :Énable constant bitrate; default: variable bitrate\n" );

56 
	`Ârötf
(
°dîr
, "-cvbr :Énable constrained variable bitrate; default: unconstrained\n" );

57 
	`Ârötf
(
°dîr
, "-delayed-decision : useÜook-ahead for speech/music detection (experts only); default: disabled\n" );

58 
	`Ârötf
(
°dîr
, "-bandwidth <NB|MB|WB|SWB|FB> :áudio bandwidth (fromÇarrowbandÅo fullband); default: samplingÑate\n" );

59 
	`Ârötf
(
°dîr
, "-framesize <2.5|5|10|20|40|60|80|100|120> : frame size in ms; default: 20 \n" );

60 
	`Ârötf
(
°dîr
, "-max_payload <bytes> : maximumÖayload size in bytes, default: 1024\n" );

61 
	`Ârötf
(
°dîr
, "-complexity <comp> : complexity, 0 (lowest) ... 10 (highest); default: 10\n" );

62 
	`Ârötf
(
°dîr
, "-inbandfec :Énable SILK inband FEC\n" );

63 
	`Ârötf
(
°dîr
, "-forcemono : force monoÉncoding,Éven for stereo input\n" );

64 
	`Ârötf
(
°dîr
, "-dtx :Énable SILK DTX\n" );

65 
	`Ârötf
(
°dîr
, "-loss <perc> : simulateÖacketÜoss, inÖercent (0-100); default: 0\n" );

66 
	}
}

68 
	$öt_to_ch¨
(
›us_uöt32
 
i
, 
ch
[4])

70 
ch
[0] = 
i
>>24;

71 
ch
[1] = (
i
>>16)&0xFF;

72 
ch
[2] = (
i
>>8)&0xFF;

73 
ch
[3] = 
i
&0xFF;

74 
	}
}

76 
›us_uöt32
 
	$ch¨_to_öt
(
ch
[4])

78  ((
›us_uöt32
)
ch
[0]<<24) | ((opus_uint32)ch[1]<<16)

79 | ((
›us_uöt32
)
ch
[2]<< 8) | (opus_uint32)ch[3];

80 
	}
}

82 
	#check_ícodî_›ti⁄
(
decode_⁄ly
, 
›t
Ëdÿ{i‡(decode_⁄lyË{
	`Ârötf
(
°dîr
, "›ti⁄ %†i†⁄ly f‹Éncodög\n", o±); 
Áûuª
;}} 0)

	)

84 c⁄° 
	gsûk8_ã°
[][4] = {

85 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960*3, 1},

86 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960*2, 1},

87 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960, 1},

88 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 480, 1},

89 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960*3, 2},

90 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960*2, 2},

91 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960, 2},

92 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 480, 2}

95 c⁄° 
	gsûk12_ã°
[][4] = {

96 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960*3, 1},

97 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960*2, 1},

98 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960, 1},

99 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 480, 1},

100 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960*3, 2},

101 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960*2, 2},

102 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 960, 2},

103 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_MEDIUMBAND
, 480, 2}

106 c⁄° 
	gsûk16_ã°
[][4] = {

107 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960*3, 1},

108 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960*2, 1},

109 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960, 1},

110 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 480, 1},

111 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960*3, 2},

112 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960*2, 2},

113 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960, 2},

114 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 480, 2}

117 c⁄° 
	ghybrid24_ã°
[][4] = {

118 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 960, 1},

119 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 480, 1},

120 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 960, 2},

121 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 480, 2}

124 c⁄° 
	ghybrid48_ã°
[][4] = {

125 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 960, 1},

126 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 480, 1},

127 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 960, 2},

128 {
MODE_SILK_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 480, 2}

131 c⁄° 
	g˚…_ã°
[][4] = {

132 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 960, 1},

133 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 960, 1},

134 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960, 1},

135 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960, 1},

137 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 480, 1},

138 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 480, 1},

139 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 480, 1},

140 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 480, 1},

142 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 240, 1},

143 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 240, 1},

144 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 240, 1},

145 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 240, 1},

147 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 120, 1},

148 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 120, 1},

149 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 120, 1},

150 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 120, 1},

152 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 960, 2},

153 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 960, 2},

154 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 960, 2},

155 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 960, 2},

157 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 480, 2},

158 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 480, 2},

159 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 480, 2},

160 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 480, 2},

162 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 240, 2},

163 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 240, 2},

164 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 240, 2},

165 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 240, 2},

167 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 120, 2},

168 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
, 120, 2},

169 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_WIDEBAND
, 120, 2},

170 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_NARROWBAND
, 120, 2},

174 c⁄° 
	g˚…_hq_ã°
[][4] = {

175 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 960, 2},

176 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 480, 2},

177 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 240, 2},

178 {
MODE_CELT_ONLY
, 
OPUS_BANDWIDTH_FULLBAND
, 120, 2},

182 
	#OpusEncodî
 
OpusMSEncodî


	)

183 
	#OpusDecodî
 
OpusMSDecodî


	)

184 
	#›us_ícode
 
›us_mu…i°ªam_ícode


	)

185 
	#›us_decode
 
›us_mu…i°ªam_decode


	)

186 
	#›us_ícodî_˘l
 
›us_mu…i°ªam_ícodî_˘l


	)

187 
	#›us_decodî_˘l
 
›us_mu…i°ªam_decodî_˘l


	)

188 
	#›us_ícodî_¸óã
 
ms_›us_ícodî_¸óã


	)

189 
	#›us_decodî_¸óã
 
ms_›us_decodî_¸óã


	)

190 
	#›us_ícodî_de°roy
 
›us_mu…i°ªam_ícodî_de°roy


	)

191 
	#›us_decodî_de°roy
 
›us_mu…i°ªam_decodî_de°roy


	)

193 
OpusEncodî
 *
	$ms_›us_ícodî_¸óã
(
›us_öt32
 
Fs
, 
ch™√ls
, 
≠∂iˇti⁄
, *
îr‹
)

195 
°ªams
, 
cou∂ed_°ªams
;

196 
m≠pög
[256];

197  (
OpusEncodî
 *)
	`›us_mu…i°ªam_suºound_ícodî_¸óã
(
Fs
, 
ch™√ls
, 1, &
°ªams
, &
cou∂ed_°ªams
, 
m≠pög
, 
≠∂iˇti⁄
, 
îr‹
);

198 
	}
}

199 
OpusDecodî
 *
	$ms_›us_decodî_¸óã
(
›us_öt32
 
Fs
, 
ch™√ls
, *
îr‹
)

201 
°ªams
;

202 
cou∂ed_°ªams
;

203 
m≠pög
[256]={0,1};

204 
°ªams
 = 1;

205 
cou∂ed_°ªams
 = 
ch™√ls
==2;

206  (
OpusDecodî
 *)
	`›us_mu…i°ªam_decodî_¸óã
(
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
, 
m≠pög
, 
îr‹
);

207 
	}
}

210 
	$maö
(
¨gc
, *
¨gv
[])

212 
îr
;

213 *
öFûe
, *
outFûe
;

214 
FILE
 *
fö
=
NULL
;

215 
FILE
 *
fout
=
NULL
;

216 
OpusEncodî
 *
íc
=
NULL
;

217 
OpusDecodî
 *
dec
=
NULL
;

218 
¨gs
;

219 
Àn
[2];

220 
‰ame_size
, 
ch™√ls
;

221 
›us_öt32
 
bôøã_bps
=0;

222 *
d©a
[2] = {
NULL
, NULL};

223 *
fbyãs
=
NULL
;

224 
›us_öt32
 
ßm∂ög_øã
;

225 
u£_vbr
;

226 
max_∑ylﬂd_byãs
;

227 
com∂exôy
;

228 
u£_öb™d„c
;

229 
u£_dtx
;

230 
f‹˚ch™√ls
;

231 
cvbr
 = 0;

232 
∑ckë_loss_≥rc
;

233 
›us_öt32
 
cou¡
=0, 
cou¡_a˘
=0;

234 
k
;

235 
›us_öt32
 
skù
=0;

236 
°›
=0;

237 *
ö
=
NULL
;

238 *
out
=
NULL
;

239 
≠∂iˇti⁄
=
OPUS_APPLICATION_AUDIO
;

240 
bôs
=0.0, 
bôs_max
=0.0, 
bôs_a˘
=0.0, 
bôs2
=0.0, 
ƒg
;

241 
tŸ_ßm∂es
=0;

242 
›us_uöt64
 
tŸ_ö
, 
tŸ_out
;

243 
b™dwidth
=
OPUS_AUTO
;

244 c⁄° *
b™dwidth_°rög
;

245 
lo°
 = 0, 
lo°_¥ev
 = 1;

246 
toggÀ
 = 0;

247 
›us_uöt32
 
íc_föÆ_ønge
[2];

248 
›us_uöt32
 
dec_föÆ_ønge
;

249 
ícode_⁄ly
=0, 
decode_⁄ly
=0;

250 
max_‰ame_size
 = 48000*2;

251 
size_t
 
num_ªad
;

252 
cuº_ªad
=0;

253 
swìp_bps
 = 0;

254 
øndom_‰amesize
=0, 
√wsize
=0, 
dñayed_˚…
=0;

255 
swìp_max
=0, 
swìp_mö
=0;

256 
øndom_„c
=0;

257 c⁄° (*
mode_li°
)[4]=
NULL
;

258 
nb_modes_ö_li°
=0;

259 
cuº_mode
=0;

260 
cuº_mode_cou¡
=0;

261 
mode_swôch_time
 = 48000;

262 
nb_ícoded
=0;

263 
ªmaöög
=0;

264 
v¨übÀ_duøti⁄
=
OPUS_FRAMESIZE_ARG
;

265 
dñayed_decisi⁄
=0;

266 
ªt
 = 
EXIT_FAILURE
;

268 i‡(
¨gc
 < 5 )

270 
	`¥öt_ußge
–
¨gv
 );

271 
Áûuª
;

274 
tŸ_ö
=
tŸ_out
=0;

275 
	`Ârötf
(
°dîr
, "%s\n", 
	`›us_gë_vîsi⁄_°rög
());

277 
¨gs
 = 1;

278 i‡(
	`°rcmp
(
¨gv
[
¨gs
], "-e")==0)

280 
ícode_⁄ly
 = 1;

281 
¨gs
++;

282 } i‡(
	`°rcmp
(
¨gv
[
¨gs
], "-d")==0)

284 
decode_⁄ly
 = 1;

285 
¨gs
++;

287 i‡(!
decode_⁄ly
 && 
¨gc
 < 7 )

289 
	`¥öt_ußge
–
¨gv
 );

290 
Áûuª
;

293 i‡(!
decode_⁄ly
)

295 i‡(
	`°rcmp
(
¨gv
[
¨gs
], "voip")==0)

296 
≠∂iˇti⁄
 = 
OPUS_APPLICATION_VOIP
;

297 i‡(
	`°rcmp
(
¨gv
[
¨gs
], "restricted-lowdelay")==0)

298 
≠∂iˇti⁄
 = 
OPUS_APPLICATION_RESTRICTED_LOWDELAY
;

299 i‡(
	`°rcmp
(
¨gv
[
¨gs
], "audio")!=0) {

300 
	`Ârötf
(
°dîr
, "unknow¿≠∂iˇti⁄: %s\n", 
¨gv
[
¨gs
]);

301 
	`¥öt_ußge
(
¨gv
);

302 
Áûuª
;

304 
¨gs
++;

306 
ßm∂ög_øã
 = (
›us_öt32
)
	`©ﬁ
(
¨gv
[
¨gs
]);

307 
¨gs
++;

309 i‡(
ßm∂ög_øã
 != 8000 && sampling_rate != 12000

310 && 
ßm∂ög_øã
 != 16000 && sampling_rate != 24000

311 && 
ßm∂ög_øã
 != 48000)

313 
	`Ârötf
(
°dîr
, "Supported samplingÑatesáre 8000, 12000, "

315 
Áûuª
;

317 
‰ame_size
 = 
ßm∂ög_øã
/50;

319 
ch™√ls
 = 
	`©oi
(
¨gv
[
¨gs
]);

320 
¨gs
++;

322 i‡(
ch™√ls
 < 1 || channels > 2)

324 
	`Ârötf
(
°dîr
, "Opus_demo supports only 1 or 2 channels.\n");

325 
Áûuª
;

328 i‡(!
decode_⁄ly
)

330 
bôøã_bps
 = (
›us_öt32
)
	`©ﬁ
(
¨gv
[
¨gs
]);

331 
¨gs
++;

335 
u£_vbr
 = 1;

336 
max_∑ylﬂd_byãs
 = 
MAX_PACKET
;

337 
com∂exôy
 = 10;

338 
u£_öb™d„c
 = 0;

339 
f‹˚ch™√ls
 = 
OPUS_AUTO
;

340 
u£_dtx
 = 0;

341 
∑ckë_loss_≥rc
 = 0;

343  
¨gs
 < 
¨gc
 - 2 ) {

345 if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-cbr" ) == 0 ) {

346 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-cbr");

347 
u£_vbr
 = 0;

348 
¨gs
++;

349 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-bandwidth" ) == 0 ) {

350 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-bandwidth");

351 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "NB")==0)

352 
b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

353 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "MB")==0)

354 
b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
;

355 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "WB")==0)

356 
b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

357 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "SWB")==0)

358 
b™dwidth
 = 
OPUS_BANDWIDTH_SUPERWIDEBAND
;

359 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "FB")==0)

360 
b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

362 
	`Ârötf
(
°dîr
, "Unknown bandwidth %s. "

364 
¨gv
[ 
¨gs
 + 1 ]);

365 
Áûuª
;

367 
¨gs
 += 2;

368 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-framesize" ) == 0 ) {

369 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-framesize");

370 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "2.5")==0)

371 
‰ame_size
 = 
ßm∂ög_øã
/400;

372 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "5")==0)

373 
‰ame_size
 = 
ßm∂ög_øã
/200;

374 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "10")==0)

375 
‰ame_size
 = 
ßm∂ög_øã
/100;

376 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "20")==0)

377 
‰ame_size
 = 
ßm∂ög_øã
/50;

378 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "40")==0)

379 
‰ame_size
 = 
ßm∂ög_øã
/25;

380 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "60")==0)

381 
‰ame_size
 = 3*
ßm∂ög_øã
/50;

382 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "80")==0)

383 
‰ame_size
 = 4*
ßm∂ög_øã
/50;

384 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "100")==0)

385 
‰ame_size
 = 5*
ßm∂ög_øã
/50;

386 i‡(
	`°rcmp
(
¨gv
[ 
¨gs
 + 1 ], "120")==0)

387 
‰ame_size
 = 6*
ßm∂ög_øã
/50;

389 
	`Ârötf
(
°dîr
, "Unsupported frame size: %s ms. "

391 
¨gv
[ 
¨gs
 + 1 ]);

392 
Áûuª
;

394 
¨gs
 += 2;

395 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-max_payload" ) == 0 ) {

396 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-max_payload");

397 
max_∑ylﬂd_byãs
 = 
	`©oi
–
¨gv
[ 
¨gs
 + 1 ] );

398 
¨gs
 += 2;

399 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-complexity" ) == 0 ) {

400 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-complexity");

401 
com∂exôy
 = 
	`©oi
–
¨gv
[ 
¨gs
 + 1 ] );

402 
¨gs
 += 2;

403 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-inbandfec" ) == 0 ) {

404 
u£_öb™d„c
 = 1;

405 
¨gs
++;

406 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-forcemono" ) == 0 ) {

407 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-forcemono");

408 
f‹˚ch™√ls
 = 1;

409 
¨gs
++;

410 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-cvbr" ) == 0 ) {

411 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-cvbr");

412 
cvbr
 = 1;

413 
¨gs
++;

414 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-delayed-decision" ) == 0 ) {

415 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-delayed-decision");

416 
dñayed_decisi⁄
 = 1;

417 
¨gs
++;

418 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-dtx") == 0 ) {

419 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-dtx");

420 
u£_dtx
 = 1;

421 
¨gs
++;

422 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-loss" ) == 0 ) {

423 
∑ckë_loss_≥rc
 = 
	`©oi
–
¨gv
[ 
¨gs
 + 1 ] );

424 
¨gs
 += 2;

425 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-sweep" ) == 0 ) {

426 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-sweep");

427 
swìp_bps
 = 
	`©oi
–
¨gv
[ 
¨gs
 + 1 ] );

428 
¨gs
 += 2;

429 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-random_framesize" ) == 0 ) {

430 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-random_framesize");

431 
øndom_‰amesize
 = 1;

432 
¨gs
++;

433 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-sweep_max" ) == 0 ) {

434 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-sweep_max");

435 
swìp_max
 = 
	`©oi
–
¨gv
[ 
¨gs
 + 1 ] );

436 
¨gs
 += 2;

437 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-random_fec" ) == 0 ) {

438 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-random_fec");

439 
øndom_„c
 = 1;

440 
¨gs
++;

441 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-silk8k_test" ) == 0 ) {

442 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-silk8k_test");

443 
mode_li°
 = 
sûk8_ã°
;

444 
nb_modes_ö_li°
 = 8;

445 
¨gs
++;

446 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-silk12k_test" ) == 0 ) {

447 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-silk12k_test");

448 
mode_li°
 = 
sûk12_ã°
;

449 
nb_modes_ö_li°
 = 8;

450 
¨gs
++;

451 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-silk16k_test" ) == 0 ) {

452 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-silk16k_test");

453 
mode_li°
 = 
sûk16_ã°
;

454 
nb_modes_ö_li°
 = 8;

455 
¨gs
++;

456 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-hybrid24k_test" ) == 0 ) {

457 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-hybrid24k_test");

458 
mode_li°
 = 
hybrid24_ã°
;

459 
nb_modes_ö_li°
 = 4;

460 
¨gs
++;

461 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-hybrid48k_test" ) == 0 ) {

462 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-hybrid48k_test");

463 
mode_li°
 = 
hybrid48_ã°
;

464 
nb_modes_ö_li°
 = 4;

465 
¨gs
++;

466 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-celt_test" ) == 0 ) {

467 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-celt_test");

468 
mode_li°
 = 
˚…_ã°
;

469 
nb_modes_ö_li°
 = 32;

470 
¨gs
++;

471 } if–
	`°rcmp
–
¨gv
[ 
¨gs
 ], "-celt_hq_test" ) == 0 ) {

472 
	`check_ícodî_›ti⁄
(
decode_⁄ly
, "-celt_hq_test");

473 
mode_li°
 = 
˚…_hq_ã°
;

474 
nb_modes_ö_li°
 = 4;

475 
¨gs
++;

477 
	`¥ötf
–"Eº‹: uƒecognized sëtög: %s\n\n", 
¨gv
[ 
¨gs
 ] );

478 
	`¥öt_ußge
–
¨gv
 );

479 
Áûuª
;

483 i‡(
swìp_max
)

484 
swìp_mö
 = 
bôøã_bps
;

486 i‡(
max_∑ylﬂd_byãs
 < 0 || max_∑ylﬂd_byã†> 
MAX_PACKET
)

488 
	`Ârötf
 (
°dîr
, "max_payload_bytes must be between 0ánd %d\n",

489 
MAX_PACKET
);

490 
Áûuª
;

493 
öFûe
 = 
¨gv
[
¨gc
-2];

494 
fö
 = 
	`f›í
(
öFûe
, "rb");

495 i‡(!
fö
)

497 
	`Ârötf
 (
°dîr
, "CouldÇŸ o≥¿öpuàfûê%s\n", 
¨gv
[
¨gc
-2]);

498 
Áûuª
;

500 i‡(
mode_li°
)

502 
size
;

503 
	`f£ek
(
fö
, 0, 
SEEK_END
);

504 
size
 = 
	`·ñl
(
fö
);

505 
	`Ârötf
(
°dîr
, "Fûêsizêi†%d byãs\n", 
size
);

506 
	`f£ek
(
fö
, 0, 
SEEK_SET
);

507 
mode_swôch_time
 = 
size
/()/
ch™√ls
/
nb_modes_ö_li°
;

508 
	`Ârötf
(
°dîr
, "Swôchög modêevîy %d sam∂es\n", 
mode_swôch_time
);

511 
outFûe
 = 
¨gv
[
¨gc
-1];

512 
fout
 = 
	`f›í
(
outFûe
, "wb+");

513 i‡(!
fout
)

515 
	`Ârötf
 (
°dîr
, "CouldÇŸ o≥¿ouçuàfûê%s\n", 
¨gv
[
¨gc
-1]);

516 
Áûuª
;

519 i‡(!
decode_⁄ly
)

521 
íc
 = 
	`›us_ícodî_¸óã
(
ßm∂ög_øã
, 
ch™√ls
, 
≠∂iˇti⁄
, &
îr
);

522 i‡(
îr
 !
OPUS_OK
)

524 
	`Ârötf
(
°dîr
, "C™nŸ cª©êícodî: %s\n", 
	`›us_°ªº‹
(
îr
));

525 
Áûuª
;

527 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
bôøã_bps
));

528 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
b™dwidth
));

529 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(
u£_vbr
));

530 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
cvbr
));

531 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(
com∂exôy
));

532 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(
u£_öb™d„c
));

533 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
f‹˚ch™√ls
));

534 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(
u£_dtx
));

535 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(
∑ckë_loss_≥rc
));

537 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_GET_LOOKAHEAD
(&
skù
));

538 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(16));

539 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_EXPERT_FRAME_DURATION
(
v¨übÀ_duøti⁄
));

541 i‡(!
ícode_⁄ly
)

543 
dec
 = 
	`›us_decodî_¸óã
(
ßm∂ög_øã
, 
ch™√ls
, &
îr
);

544 i‡(
îr
 !
OPUS_OK
)

546 
	`Ârötf
(
°dîr
, "C™nŸ cª©êdecodî: %s\n", 
	`›us_°ªº‹
(
îr
));

547 
Áûuª
;

552 
b™dwidth
)

554 
OPUS_BANDWIDTH_NARROWBAND
:

555 
b™dwidth_°rög
 = "narrowband";

557 
OPUS_BANDWIDTH_MEDIUMBAND
:

558 
b™dwidth_°rög
 = "mediumband";

560 
OPUS_BANDWIDTH_WIDEBAND
:

561 
b™dwidth_°rög
 = "wideband";

563 
OPUS_BANDWIDTH_SUPERWIDEBAND
:

564 
b™dwidth_°rög
 = "superwideband";

566 
OPUS_BANDWIDTH_FULLBAND
:

567 
b™dwidth_°rög
 = "fullband";

569 
OPUS_AUTO
:

570 
b™dwidth_°rög
 = "auto bandwidth";

573 
b™dwidth_°rög
 = "unknown";

577 i‡(
decode_⁄ly
)

578 
	`Ârötf
(
°dîr
, "Decoding with %ld Hz output (%d channels)\n",

579 ()
ßm∂ög_øã
, 
ch™√ls
);

581 
	`Ârötf
(
°dîr
, "Encoding %ld Hz inputát %.3f kb/s "

583 ()
ßm∂ög_øã
, 
bôøã_bps
*0.001,

584 
b™dwidth_°rög
, 
‰ame_size
);

586 
ö
 = (*)
	`mÆloc
(
max_‰ame_size
*
ch™√ls
*());

587 
out
 = (*)
	`mÆloc
(
max_‰ame_size
*
ch™√ls
*());

589 
fbyãs
 = (*)
	`mÆloc
(
max_‰ame_size
*
ch™√ls
*());

590 
d©a
[0] = (*)
	`ˇŒoc
(
max_∑ylﬂd_byãs
,());

591 i‡–
u£_öb™d„c
 ) {

592 
d©a
[1] = (*)
	`ˇŒoc
(
max_∑ylﬂd_byãs
,());

594 if(
dñayed_decisi⁄
)

596 i‡(
‰ame_size
==
ßm∂ög_øã
/400)

597 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_2_5_MS
;

598 i‡(
‰ame_size
==
ßm∂ög_øã
/200)

599 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_5_MS
;

600 i‡(
‰ame_size
==
ßm∂ög_øã
/100)

601 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_10_MS
;

602 i‡(
‰ame_size
==
ßm∂ög_øã
/50)

603 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_20_MS
;

604 i‡(
‰ame_size
==
ßm∂ög_øã
/25)

605 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_40_MS
;

606 i‡(
‰ame_size
==3*
ßm∂ög_øã
/50)

607 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_60_MS
;

608 i‡(
‰ame_size
==4*
ßm∂ög_øã
/50)

609 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_80_MS
;

610 i‡(
‰ame_size
==5*
ßm∂ög_øã
/50)

611 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_100_MS
;

613 
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_120_MS
;

614 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_EXPERT_FRAME_DURATION
(
v¨übÀ_duøti⁄
));

615 
‰ame_size
 = 2*48000;

617 !
°›
)

619 i‡(
dñayed_˚…
)

621 
‰ame_size
 = 
√wsize
;

622 
dñayed_˚…
 = 0;

623 } i‡(
øndom_‰amesize
 && 
	`ønd
()%20==0)

625 
√wsize
 = 
	`ønd
()%6;

626 
√wsize
)

628 0: 
√wsize
=
ßm∂ög_øã
/400; ;

629 1: 
√wsize
=
ßm∂ög_øã
/200; ;

630 2: 
√wsize
=
ßm∂ög_øã
/100; ;

631 3: 
√wsize
=
ßm∂ög_øã
/50; ;

632 4: 
√wsize
=
ßm∂ög_øã
/25; ;

633 5: 
√wsize
=3*
ßm∂ög_øã
/50; ;

635 
√wsize
 < 
ßm∂ög_øã
/25 && 
bôøã_bps
-
	`abs
(
swìp_bps
) <= 3*12*sampling_rate/newsize)

636 
√wsize
*=2;

637 i‡(
√wsize
 < 
ßm∂ög_øã
/100 && 
‰ame_size
 >= sampling_rate/100)

639 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_MODE
(
MODE_CELT_ONLY
));

640 
dñayed_˚…
=1;

642 
‰ame_size
 = 
√wsize
;

645 i‡(
øndom_„c
 && 
	`ønd
()%30==0)

647 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(
	`ønd
()%4==0));

649 i‡(
decode_⁄ly
)

651 
ch
[4];

652 
num_ªad
 = 
	`‰ód
(
ch
, 1, 4, 
fö
);

653 i‡(
num_ªad
!=4)

655 
Àn
[
toggÀ
] = 
	`ch¨_to_öt
(
ch
);

656 i‡(
Àn
[
toggÀ
]>
max_∑ylﬂd_byãs
 ||Üen[toggle]<0)

658 
	`Ârötf
(
°dîr
, "InvÆidÖaylﬂdÜígth: %d\n",
Àn
[
toggÀ
]);

661 
num_ªad
 = 
	`‰ód
(
ch
, 1, 4, 
fö
);

662 i‡(
num_ªad
!=4)

664 
íc_föÆ_ønge
[
toggÀ
] = 
	`ch¨_to_öt
(
ch
);

665 
num_ªad
 = 
	`‰ód
(
d©a
[
toggÀ
], 1, 
Àn
[toggÀ], 
fö
);

666 i‡(
num_ªad
!=(
size_t
)
Àn
[
toggÀ
])

668 
	`Ârötf
(
°dîr
, "Ran out of input, "

670 
Àn
[
toggÀ
],()
num_ªad
);

674 
i
;

675 i‡(
mode_li°
!=
NULL
)

677 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
mode_li°
[
cuº_mode
][1]));

678 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_MODE
(
mode_li°
[
cuº_mode
][0]));

679 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
mode_li°
[
cuº_mode
][3]));

680 
‰ame_size
 = 
mode_li°
[
cuº_mode
][2];

682 
num_ªad
 = 
	`‰ód
(
fbyãs
, ()*
ch™√ls
, 
‰ame_size
-
ªmaöög
, 
fö
);

683 
cuº_ªad
 = ()
num_ªad
;

684 
tŸ_ö
 +
cuº_ªad
;

685 
i
=0;i<
cuº_ªad
*
ch™√ls
;i++)

687 
›us_öt32
 
s
;

688 
s
=
fbyãs
[2*
i
+1]<<8|fbytes[2*i];

689 
s
=((s&0xFFFF)^0x8000)-0x8000;

690 
ö
[
i
+
ªmaöög
*
ch™√ls
]=
s
;

692 i‡(
cuº_ªad
+
ªmaöög
 < 
‰ame_size
)

694 
i
=(
cuº_ªad
+
ªmaöög
)*
ch™√ls
;i<
‰ame_size
*channels;i++)

695 
ö
[
i
] = 0;

696 i‡(
ícode_⁄ly
 || 
decode_⁄ly
)

697 
°›
 = 1;

699 
Àn
[
toggÀ
] = 
	`›us_ícode
(
íc
, 
ö
, 
‰ame_size
, 
d©a
[toggÀ], 
max_∑ylﬂd_byãs
);

700 
nb_ícoded
 = 
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
d©a
[
toggÀ
], 
ßm∂ög_øã
)*
	`›us_∑ckë_gë_nb_‰ames
(d©a[toggÀ], 
Àn
[toggle]);

701 
ªmaöög
 = 
‰ame_size
-
nb_ícoded
;

702 
i
=0;i<
ªmaöög
*
ch™√ls
;i++)

703 
ö
[
i
] = in[
nb_ícoded
*
ch™√ls
+i];

704 i‡(
swìp_bps
!=0)

706 
bôøã_bps
 +
swìp_bps
;

707 i‡(
swìp_max
)

709 i‡(
bôøã_bps
 > 
swìp_max
)

710 
swìp_bps
 = -sweep_bps;

711 i‡(
bôøã_bps
 < 
swìp_mö
)

712 
swìp_bps
 = -sweep_bps;

715 i‡(
bôøã_bps
<1000)

716 
bôøã_bps
 = 1000;

717 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
bôøã_bps
));

719 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_GET_FINAL_RANGE
(&
íc_föÆ_ønge
[
toggÀ
]));

720 i‡(
Àn
[
toggÀ
] < 0)

722 
	`Ârötf
 (
°dîr
, "›us_ícode(Ëªtu∫ed %d\n", 
Àn
[
toggÀ
]);

723 
Áûuª
;

725 
cuº_mode_cou¡
 +
‰ame_size
;

726 i‡(
cuº_mode_cou¡
 > 
mode_swôch_time
 && 
cuº_mode
 < 
nb_modes_ö_li°
-1)

728 
cuº_mode
++;

729 
cuº_mode_cou¡
 = 0;

734 i‡(
Àn
[
toggÀ
]<1275)

736 
√w_Àn
 = 
Àn
[
toggÀ
]+
	`ønd
()%(
max_∑ylﬂd_byãs
-len[toggle]);

737 i‡((
îr
 = 
	`›us_∑ckë_∑d
(
d©a
[
toggÀ
], 
Àn
[toggÀ], 
√w_Àn
)Ë!
OPUS_OK
)

739 
	`Ârötf
(
°dîr
, "∑ddög faûed: %s\n", 
	`›us_°ªº‹
(
îr
));

740 
Áûuª
;

742 
Àn
[
toggÀ
] = 
√w_Àn
;

745 i‡(
ícode_⁄ly
)

747 
öt_fõld
[4];

748 
	`öt_to_ch¨
(
Àn
[
toggÀ
], 
öt_fõld
);

749 i‡(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
) != 4) {

750 
	`Ârötf
(
°dîr
, "Error writing.\n");

751 
Áûuª
;

753 
	`öt_to_ch¨
(
íc_föÆ_ønge
[
toggÀ
], 
öt_fõld
);

754 i‡(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
) != 4) {

755 
	`Ârötf
(
°dîr
, "Error writing.\n");

756 
Áûuª
;

758 i‡(
	`fwrôe
(
d©a
[
toggÀ
], 1, 
Àn
[toggÀ], 
fout
) != ()len[toggle]) {

759 
	`Ârötf
(
°dîr
, "Error writing.\n");

760 
Áûuª
;

762 
tŸ_ßm∂es
 +
nb_ícoded
;

764 
›us_öt32
 
ouçut_ßm∂es
;

765 
lo°
 = 
Àn
[
toggÀ
]==0 || (
∑ckë_loss_≥rc
>0 && 
	`ønd
()%100 <Öacket_loss_perc);

766 i‡(
lo°
)

767 
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_LAST_PACKET_DURATION
(&
ouçut_ßm∂es
));

769 
ouçut_ßm∂es
 = 
max_‰ame_size
;

770 if–
cou¡
 >
u£_öb™d„c
 ) {

772 if–
u£_öb™d„c
 ) {

773 if–
lo°_¥ev
 ) {

775 
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_LAST_PACKET_DURATION
(&
ouçut_ßm∂es
));

776 
ouçut_ßm∂es
 = 
	`›us_decode
(
dec
, 
lo°
 ? 
NULL
 : 
d©a
[
toggÀ
], 
Àn
[toggÀ], 
out
, output_samples, 1);

779 
ouçut_ßm∂es
 = 
max_‰ame_size
;

780 
ouçut_ßm∂es
 = 
	`›us_decode
(
dec
, 
d©a
[1-
toggÀ
], 
Àn
[1-toggÀ], 
out
, output_samples, 0);

783 
ouçut_ßm∂es
 = 
	`›us_decode
(
dec
, 
lo°
 ? 
NULL
 : 
d©a
[
toggÀ
], 
Àn
[toggÀ], 
out
, output_samples, 0);

785 i‡(
ouçut_ßm∂es
>0)

787 i‡(!
decode_⁄ly
 && 
tŸ_out
 + 
ouçut_ßm∂es
 > 
tŸ_ö
)

789 
°›
=1;

790 
ouçut_ßm∂es
 = (
›us_öt32
)(
tŸ_ö
 - 
tŸ_out
);

792 i‡(
ouçut_ßm∂es
>
skù
) {

793 
i
;

794 
i
=0;i<(
ouçut_ßm∂es
-
skù
)*
ch™√ls
;i++)

796 
s
;

797 
s
=
out
[
i
+(
skù
*
ch™√ls
)];

798 
fbyãs
[2*
i
]=
s
&0xFF;

799 
fbyãs
[2*
i
+1]=(
s
>>8)&0xFF;

801 i‡(
	`fwrôe
(
fbyãs
, ()*
ch™√ls
, 
ouçut_ßm∂es
-
skù
, 
fout
) != ()(output_samples-skip)){

802 
	`Ârötf
(
°dîr
, "Error writing.\n");

803 
Áûuª
;

805 
tŸ_out
 +
ouçut_ßm∂es
-
skù
;

807 i‡(
ouçut_ßm∂es
<
skù
) skip -= output_samples;

808 
skù
 = 0;

810 
	`Ârötf
(
°dîr
, "error decoding frame: %s\n",

811 
	`›us_°ªº‹
(
ouçut_ßm∂es
));

813 
tŸ_ßm∂es
 +
ouçut_ßm∂es
;

817 i‡(!
ícode_⁄ly
)

818 
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
));

820 if–
íc_föÆ_ønge
[
toggÀ
^
u£_öb™d„c
]!=0 && !
ícode_⁄ly


821 && !
lo°
 && !
lo°_¥ev


822 && 
dec_föÆ_ønge
 !
íc_föÆ_ønge
[
toggÀ
^
u£_öb™d„c
] ) {

823 
	`Ârötf
 (
°dîr
, "Error: Range coder state mismatch "

826 ()
cou¡
,

827 ()
íc_föÆ_ønge
[
toggÀ
^
u£_öb™d„c
],

828 ()
dec_föÆ_ønge
);

829 
Áûuª
;

832 
lo°_¥ev
 = 
lo°
;

833 if–
cou¡
 >
u£_öb™d„c
 ) {

835 
bôs
 +
Àn
[
toggÀ
]*8;

836 
bôs_max
 = ( 
Àn
[
toggÀ
]*8 > bits_max ) ?Üen[toggle]*8 : bits_max;

837 
bôs2
 +
Àn
[
toggÀ
]*len[toggle]*64;

838 i‡(!
decode_⁄ly
)

840 
ƒg
 = 0.0;

841  
k
 = 0; k < 
‰ame_size
 * 
ch™√ls
; k++ ) {

842 
ƒg
 +
ö
[ 
k
 ] * ()in[ k ];

844 
ƒg
 /
‰ame_size
 * 
ch™√ls
;

845 if–
ƒg
 > 1e5 ) {

846 
bôs_a˘
 +
Àn
[
toggÀ
]*8;

847 
cou¡_a˘
++;

851 
cou¡
++;

852 
toggÀ
 = (toggÀ + 
u£_öb™d„c
) & 1;

855 if(
decode_⁄ly
 && 
cou¡
 > 0)

856 
‰ame_size
 = ()(
tŸ_ßm∂es
 / 
cou¡
);

857 
cou¡
 -
u£_öb™d„c
;

858 i‡(
tŸ_ßm∂es
 >1 && 
cou¡
 > 0 && 
‰ame_size
)

861 
v¨
;

862 
	`Ârötf
 (
°dîr
, "average bitrate: %7.3f kb/s\n",

863 1e-3*
bôs
*
ßm∂ög_øã
/
tŸ_ßm∂es
);

864 
	`Ârötf
 (
°dîr
, "maximum bitrate: %7.3f kb/s\n",

865 1e-3*
bôs_max
*
ßm∂ög_øã
/
‰ame_size
);

866 i‡(!
decode_⁄ly
)

867 
	`Ârötf
 (
°dîr
, "active bitrate: %7.3f kb/s\n",

868 1e-3*
bôs_a˘
*
ßm∂ög_øã
/(1e-15+
‰ame_size
*()
cou¡_a˘
));

869 
v¨
 = 
bôs2
/
cou¡
 - 
bôs
*bits/(count*()count);

870 i‡(
v¨
 < 0)

871 
v¨
 = 0;

872 
	`Ârötf
 (
°dîr
, "bitrate standard deviation: %7.3f kb/s\n",

873 1e-3*
	`sqπ
(
v¨
)*
ßm∂ög_øã
/
‰ame_size
);

875 
	`Ârötf
(
°dîr
, "bitrate statisticsáre undefined\n");

877 
	`sûk_TimîSave
("opus_timing.txt");

878 
ªt
 = 
EXIT_SUCCESS
;

879 
Áûuª
:

880 
	`›us_ícodî_de°roy
(
íc
);

881 
	`›us_decodî_de°roy
(
dec
);

882 
	`‰ì
(
d©a
[0]);

883 
	`‰ì
(
d©a
[1]);

884 i‡(
fö
)

885 
	`f˛o£
(
fö
);

886 i‡(
fout
)

887 
	`f˛o£
(
fout
);

888 
	`‰ì
(
ö
);

889 
	`‰ì
(
out
);

890 
	`‰ì
(
fbyãs
);

891  
ªt
;

892 
	}
}

	@src/opus_encoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°d¨g.h
>

33 
	~"˚….h
"

34 
	~"íãnc.h
"

35 
	~"modes.h
"

36 
	~"API.h
"

37 
	~"°ack_Æloc.h
"

38 
	~"Êﬂt_ˇ°.h
"

39 
	~"›us.h
"

40 
	~"¨ch.h
"

41 
	~"pôch.h
"

42 
	~"›us_¥iv©e.h
"

43 
	~"os_suµ‹t.h
"

44 
	~"˝u_suµ‹t.h
"

45 
	~"™Æysis.h
"

46 
	~"m©h›s.h
"

47 
	~"tunög_∑ømëîs.h
"

48 #ifde‡
FIXED_POINT


49 
	~"fixed/°ru˘s_FIX.h
"

51 
	~"Êﬂt/°ru˘s_FLP.h
"

54 
	#MAX_ENCODER_BUFFER
 480

	)

56 #i‚de‡
DISABLE_FLOAT_API


57 
	#PSEUDO_SNR_THRESHOLD
 316.23‡

	)

61 
›us_vÆ32
 
	mXX
, 
	mXY
, 
	mYY
;

62 
›us_vÆ16
 
	msmoŸhed_width
;

63 
›us_vÆ16
 
	mmax_fﬁlowî
;

64 } 
	tSãªoWidthSèã
;

66 
	sOpusEncodî
 {

67 
	m˚…_íc_off£t
;

68 
	msûk_íc_off£t
;

69 
sûk_EncC⁄åﬁSåu˘
 
	msûk_mode
;

70 
	m≠∂iˇti⁄
;

71 
	mch™√ls
;

72 
	mdñay_com≥nßti⁄
;

73 
	mf‹˚_ch™√ls
;

74 
	msig«l_ty≥
;

75 
	mu£r_b™dwidth
;

76 
	mmax_b™dwidth
;

77 
	mu£r_f‹˚d_mode
;

78 
	mvoi˚_øtio
;

79 
›us_öt32
 
	mFs
;

80 
	mu£_vbr
;

81 
	mvbr_c⁄°øöt
;

82 
	mv¨übÀ_duøti⁄
;

83 
›us_öt32
 
	mbôøã_bps
;

84 
›us_öt32
 
	mu£r_bôøã_bps
;

85 
	mlsb_dïth
;

86 
	mícodî_buf„r
;

87 
	ml„
;

88 
	m¨ch
;

89 
	mu£_dtx
;

90 #i‚de‡
DISABLE_FLOAT_API


91 
T⁄ÆôyA«lysisSèã
 
	m™Æysis
;

94 
	#OPUS_ENCODER_RESET_START
 
°ªam_ch™√ls


	)

95 
	m°ªam_ch™√ls
;

96 
›us_öt16
 
	mhybrid_°îeo_width_Q14
;

97 
›us_öt32
 
	mv¨übÀ_HP_smth2_Q15
;

98 
›us_vÆ16
 
	m¥ev_HB_gaö
;

99 
›us_vÆ32
 
	mhp_mem
[4];

100 
	mmode
;

101 
	m¥ev_mode
;

102 
	m¥ev_ch™√ls
;

103 
	m¥ev_‰amesize
;

104 
	mb™dwidth
;

106 
	mauto_b™dwidth
;

107 
	msûk_bw_swôch
;

109 
	mfú°
;

110 
›us_vÆ16
 * 
	míîgy_maskög
;

111 
SãªoWidthSèã
 
	mwidth_mem
;

112 
›us_vÆ16
 
	mdñay_buf„r
[
MAX_ENCODER_BUFFER
*2];

113 #i‚de‡
DISABLE_FLOAT_API


114 
	mdëe˘ed_b™dwidth
;

115 
	mnb_no_a˘ivôy_‰ames
;

116 
›us_vÆ32
 
	m≥ak_sig«l_íîgy
;

118 
	mn⁄föÆ_‰ame
;

119 
›us_uöt32
 
	møngeFöÆ
;

125 c⁄° 
›us_öt32
 
	gm⁄o_voi˚_b™dwidth_thªshﬁds
[8] = {

131 c⁄° 
›us_öt32
 
	gm⁄o_music_b™dwidth_thªshﬁds
[8] = {

137 c⁄° 
›us_öt32
 
	g°îeo_voi˚_b™dwidth_thªshﬁds
[8] = {

143 c⁄° 
›us_öt32
 
	g°îeo_music_b™dwidth_thªshﬁds
[8] = {

150 c⁄° 
›us_öt32
 
	g°îeo_voi˚_thªshﬁd
 = 19000;

151 c⁄° 
›us_öt32
 
	g°îeo_music_thªshﬁd
 = 17000;

154 c⁄° 
›us_öt32
 
	gmode_thªshﬁds
[2][2] = {

160 c⁄° 
›us_öt32
 
	g„c_thªshﬁds
[] = {

168 
	$›us_ícodî_gë_size
(
ch™√ls
)

170 
sûkEncSizeByãs
, 
˚…EncSizeByãs
;

171 
ªt
;

172 i‡(
ch™√ls
<1 || channels > 2)

174 
ªt
 = 
	`sûk_Gë_Encodî_Size
–&
sûkEncSizeByãs
 );

175 i‡(
ªt
)

177 
sûkEncSizeByãs
 = 
	`Æign
(silkEncSizeBytes);

178 
˚…EncSizeByãs
 = 
	`˚…_ícodî_gë_size
(
ch™√ls
);

179  
	`Æign
((
OpusEncodî
))+
sûkEncSizeByãs
+
˚…EncSizeByãs
;

180 
	}
}

182 
	$›us_ícodî_öô
(
OpusEncodî
* 
°
, 
›us_öt32
 
Fs
, 
ch™√ls
, 
≠∂iˇti⁄
)

184 *
sûk_íc
;

185 
CELTEncodî
 *
˚…_íc
;

186 
îr
;

187 
ªt
, 
sûkEncSizeByãs
;

189 if((
Fs
!=48000&&Fs!=24000&&Fs!=16000&&Fs!=12000&&Fs!=8000)||(
ch™√ls
!=1&&channels!=2)||

190 (
≠∂iˇti⁄
 !
OPUS_APPLICATION_VOIP
 &&áµliˇti⁄ !
OPUS_APPLICATION_AUDIO


191 && 
≠∂iˇti⁄
 !
OPUS_APPLICATION_RESTRICTED_LOWDELAY
))

192  
OPUS_BAD_ARG
;

194 
	`OPUS_CLEAR
((*)
°
, 
	`›us_ícodî_gë_size
(
ch™√ls
));

196 
ªt
 = 
	`sûk_Gë_Encodî_Size
–&
sûkEncSizeByãs
 );

197 i‡(
ªt
)

198  
OPUS_BAD_ARG
;

199 
sûkEncSizeByãs
 = 
	`Æign
(silkEncSizeBytes);

200 
°
->
sûk_íc_off£t
 = 
	`Æign
((
OpusEncodî
));

201 
°
->
˚…_íc_off£t
 = st->
sûk_íc_off£t
+
sûkEncSizeByãs
;

202 
sûk_íc
 = (*)
°
+°->
sûk_íc_off£t
;

203 
˚…_íc
 = (
CELTEncodî
*)((*)
°
+°->
˚…_íc_off£t
);

205 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
 = channels;

207 
°
->
Fs
 = Fs;

209 
°
->
¨ch
 = 
	`›us_£À˘_¨ch
();

211 
ªt
 = 
	`sûk_InôEncodî
–
sûk_íc
, 
°
->
¨ch
, &°->
sûk_mode
 );

212 if(
ªt
) 
OPUS_INTERNAL_ERROR
;

215 
°
->
sûk_mode
.
nCh™√lsAPI
 = 
ch™√ls
;

216 
°
->
sûk_mode
.
nCh™√lsI¡î«l
 = 
ch™√ls
;

217 
°
->
sûk_mode
.
API_ßm∂eR©e
 = st->
Fs
;

218 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 16000;

219 
°
->
sûk_mode
.
möI¡î«lSam∂eR©e
 = 8000;

220 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 16000;

221 
°
->
sûk_mode
.
∑ylﬂdSize_ms
 = 20;

222 
°
->
sûk_mode
.
bôR©e
 = 25000;

223 
°
->
sûk_mode
.
∑ckëLossPî˚¡age
 = 0;

224 
°
->
sûk_mode
.
com∂exôy
 = 9;

225 
°
->
sûk_mode
.
u£InB™dFEC
 = 0;

226 
°
->
sûk_mode
.
u£DTX
 = 0;

227 
°
->
sûk_mode
.
u£CBR
 = 0;

228 
°
->
sûk_mode
.
ªdu˚dDïídícy
 = 0;

232 
îr
 = 
	`˚…_ícodî_öô
(
˚…_íc
, 
Fs
, 
ch™√ls
, 
°
->
¨ch
);

233 if(
îr
!=
OPUS_OK
) 
OPUS_INTERNAL_ERROR
;

235 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_SIGNALLING
(0));

236 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_COMPLEXITY
(
°
->
sûk_mode
.
com∂exôy
));

238 
°
->
u£_vbr
 = 1;

240 
°
->
vbr_c⁄°øöt
 = 1;

241 
°
->
u£r_bôøã_bps
 = 
OPUS_AUTO
;

242 
°
->
bôøã_bps
 = 3000+
Fs
*
ch™√ls
;

243 
°
->
≠∂iˇti⁄
 =ápplication;

244 
°
->
sig«l_ty≥
 = 
OPUS_AUTO
;

245 
°
->
u£r_b™dwidth
 = 
OPUS_AUTO
;

246 
°
->
max_b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

247 
°
->
f‹˚_ch™√ls
 = 
OPUS_AUTO
;

248 
°
->
u£r_f‹˚d_mode
 = 
OPUS_AUTO
;

249 
°
->
voi˚_øtio
 = -1;

250 
°
->
ícodî_buf„r
 = st->
Fs
/100;

251 
°
->
lsb_dïth
 = 24;

252 
°
->
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_ARG
;

256 
°
->
dñay_com≥nßti⁄
 = st->
Fs
/250;

258 
°
->
hybrid_°îeo_width_Q14
 = 1 << 14;

259 
°
->
¥ev_HB_gaö
 = 
Q15ONE
;

260 
°
->
v¨übÀ_HP_smth2_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
VARIABLE_HP_MIN_CUTOFF_HZ
 ), 8 );

261 
°
->
fú°
 = 1;

262 
°
->
mode
 = 
MODE_HYBRID
;

263 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

265 #i‚de‡
DISABLE_FLOAT_API


266 
	`t⁄Æôy_™Æysis_öô
(&
°
->
™Æysis
, st->
Fs
);

267 
°
->
™Æysis
.
≠∂iˇti⁄
 = st->application;

270  
OPUS_OK
;

271 
	}
}

273 
	$gí_toc
(
mode
, 
‰amî©e
, 
b™dwidth
, 
ch™√ls
)

275 
≥riod
;

276 
toc
;

277 
≥riod
 = 0;

278 
‰amî©e
 < 400)

280 
‰amî©e
 <<= 1;

281 
≥riod
++;

283 i‡(
mode
 =
MODE_SILK_ONLY
)

285 
toc
 = (
b™dwidth
-
OPUS_BANDWIDTH_NARROWBAND
)<<5;

286 
toc
 |(
≥riod
-2)<<3;

287 } i‡(
mode
 =
MODE_CELT_ONLY
)

289 
tmp
 = 
b™dwidth
-
OPUS_BANDWIDTH_MEDIUMBAND
;

290 i‡(
tmp
 < 0)

291 
tmp
 = 0;

292 
toc
 = 0x80;

293 
toc
 |
tmp
 << 5;

294 
toc
 |
≥riod
<<3;

297 
toc
 = 0x60;

298 
toc
 |(
b™dwidth
-
OPUS_BANDWIDTH_SUPERWIDEBAND
)<<4;

299 
toc
 |(
≥riod
-2)<<3;

301 
toc
 |(
ch™√ls
==2)<<2;

302  
toc
;

303 
	}
}

305 #i‚de‡
FIXED_POINT


306 
	$sûk_biquad_Êﬂt
(

307 c⁄° 
›us_vÆ16
 *
ö
,

308 c⁄° 
›us_öt32
 *
B_Q28
,

309 c⁄° 
›us_öt32
 *
A_Q28
,

310 
›us_vÆ32
 *
S
,

311 
›us_vÆ16
 *
out
,

312 c⁄° 
›us_öt32
 
Àn
,

313 
°ride


317 
›us_öt
 
k
;

318 
›us_vÆ32
 
vout
;

319 
›us_vÆ32
 
övÆ
;

320 
›us_vÆ32
 
A
[2], 
B
[3];

322 
A
[0] = (
›us_vÆ32
)(
A_Q28
[0] * (1.f/((
›us_öt32
)1<<28)));

323 
A
[1] = (
›us_vÆ32
)(
A_Q28
[1] * (1.f/((
›us_öt32
)1<<28)));

324 
B
[0] = (
›us_vÆ32
)(
B_Q28
[0] * (1.f/((
›us_öt32
)1<<28)));

325 
B
[1] = (
›us_vÆ32
)(
B_Q28
[1] * (1.f/((
›us_öt32
)1<<28)));

326 
B
[2] = (
›us_vÆ32
)(
B_Q28
[2] * (1.f/((
›us_öt32
)1<<28)));

330  
k
 = 0; k < 
Àn
; k++ ) {

332 
övÆ
 = 
ö
[ 
k
*
°ride
 ];

333 
vout
 = 
S
[ 0 ] + 
B
[0]*
övÆ
;

335 
S
[ 0 ] = S[1] - 
vout
*
A
[0] + 
B
[1]*
övÆ
;

337 
S
[ 1 ] = - 
vout
*
A
[1] + 
B
[2]*
övÆ
 + 
VERY_SMALL
;

340 
out
[ 
k
*
°ride
 ] = 
vout
;

342 
	}
}

345 
	$hp_cutoff
(c⁄° 
›us_vÆ16
 *
ö
, 
›us_öt32
 
cutoff_Hz
, opus_vÆ16 *
out
, 
›us_vÆ32
 *
hp_mem
, 
Àn
, 
ch™√ls
, opus_öt32 
Fs
, 
¨ch
)

347 
›us_öt32
 
B_Q28
[ 3 ], 
A_Q28
[ 2 ];

348 
›us_öt32
 
Fc_Q19
, 
r_Q28
, 
r_Q22
;

349 ()
¨ch
;

351 
	`sûk_as£π
–
cutoff_Hz
 <
sûk_öt32_MAX
 / 
	`SILK_FIX_CONST
( 1.5 * 3.14159 / 1000, 19 ) );

352 
Fc_Q19
 = 
	`sûk_DIV32_16
–
	`sûk_SMULBB
–
	`SILK_FIX_CONST
–1.5 * 3.14159 / 1000, 19 ), 
cutoff_Hz
 ), 
Fs
/1000 );

353 
	`sûk_as£π
–
Fc_Q19
 > 0 && Fc_Q19 < 32768 );

355 
r_Q28
 = 
	`SILK_FIX_CONST
–1.0, 28 ) - 
	`sûk_MUL
–SILK_FIX_CONST–0.92, 9 ), 
Fc_Q19
 );

359 
B_Q28
[ 0 ] = 
r_Q28
;

360 
B_Q28
[ 1 ] = 
	`sûk_LSHIFT
–-
r_Q28
, 1 );

361 
B_Q28
[ 2 ] = 
r_Q28
;

364 
r_Q22
 = 
	`sûk_RSHIFT
–
r_Q28
, 6 );

365 
A_Q28
[ 0 ] = 
	`sûk_SMULWW
–
r_Q22
, sûk_SMULWW–
Fc_Q19
, Fc_Q19 ) - 
	`SILK_FIX_CONST
( 2.0, 22 ) );

366 
A_Q28
[ 1 ] = 
	`sûk_SMULWW
–
r_Q22
,Ñ_Q22 );

368 #ifde‡
FIXED_POINT


369 if–
ch™√ls
 == 1 ) {

370 
	`sûk_biquad_Æt_°ride1
–
ö
, 
B_Q28
, 
A_Q28
, 
hp_mem
, 
out
, 
Àn
 );

372 
	`sûk_biquad_Æt_°ride2
–
ö
, 
B_Q28
, 
A_Q28
, 
hp_mem
, 
out
, 
Àn
, 
¨ch
 );

375 
	`sûk_biquad_Êﬂt
–
ö
, 
B_Q28
, 
A_Q28
, 
hp_mem
, 
out
, 
Àn
, 
ch™√ls
 );

376 if–
ch™√ls
 == 2 ) {

377 
	`sûk_biquad_Êﬂt
–
ö
+1, 
B_Q28
, 
A_Q28
, 
hp_mem
+2, 
out
+1, 
Àn
, 
ch™√ls
 );

380 
	}
}

382 #ifde‡
FIXED_POINT


383 
	$dc_ªje˘
(c⁄° 
›us_vÆ16
 *
ö
, 
›us_öt32
 
cutoff_Hz
, opus_vÆ16 *
out
, 
›us_vÆ32
 *
hp_mem
, 
Àn
, 
ch™√ls
, opus_öt32 
Fs
)

385 
c
, 
i
;

386 
shi·
;

389 
shi·
=
	`˚…_ûog2
(
Fs
/(
cutoff_Hz
*4));

390 
c
=0;c<
ch™√ls
;c++)

392 
i
=0;i<
Àn
;i++)

394 
›us_vÆ32
 
x
, 
y
;

395 
x
 = 
	`SHL32
(
	`EXTEND32
(
ö
[
ch™√ls
*
i
+
c
]), 14);

396 
y
 = 
x
-
hp_mem
[2*
c
];

397 
hp_mem
[2*
c
] = hp_mem[2*c] + 
	`PSHR32
(
x
 - hp_mem[2*c], 
shi·
);

398 
out
[
ch™√ls
*
i
+
c
] = 
	`EXTRACT16
(
	`SATURATE
(
	`PSHR32
(
y
, 14), 32767));

401 
	}
}

404 
	$dc_ªje˘
(c⁄° 
›us_vÆ16
 *
ö
, 
›us_öt32
 
cutoff_Hz
, opus_vÆ16 *
out
, 
›us_vÆ32
 *
hp_mem
, 
Àn
, 
ch™√ls
, opus_öt32 
Fs
)

406 
i
;

407 
c€f
, 
c€f2
;

408 
c€f
 = 6.3f*
cutoff_Hz
/
Fs
;

409 
c€f2
 = 1-
c€f
;

410 i‡(
ch™√ls
==2)

412 
m0
, 
m2
;

413 
m0
 = 
hp_mem
[0];

414 
m2
 = 
hp_mem
[2];

415 
i
=0;i<
Àn
;i++)

417 
›us_vÆ32
 
x0
, 
x1
, 
out0
, 
out1
;

418 
x0
 = 
ö
[2*
i
+0];

419 
x1
 = 
ö
[2*
i
+1];

420 
out0
 = 
x0
-
m0
;

421 
out1
 = 
x1
-
m2
;

422 
m0
 = 
c€f
*
x0
 + 
VERY_SMALL
 + 
c€f2
*m0;

423 
m2
 = 
c€f
*
x1
 + 
VERY_SMALL
 + 
c€f2
*m2;

424 
out
[2*
i
+0] = 
out0
;

425 
out
[2*
i
+1] = 
out1
;

427 
hp_mem
[0] = 
m0
;

428 
hp_mem
[2] = 
m2
;

430 
m0
;

431 
m0
 = 
hp_mem
[0];

432 
i
=0;i<
Àn
;i++)

434 
›us_vÆ32
 
x
, 
y
;

435 
x
 = 
ö
[
i
];

436 
y
 = 
x
-
m0
;

437 
m0
 = 
c€f
*
x
 + 
VERY_SMALL
 + 
c€f2
*m0;

438 
out
[
i
] = 
y
;

440 
hp_mem
[0] = 
m0
;

442 
	}
}

445 
	$°îeo_Áde
(c⁄° 
›us_vÆ16
 *
ö
, opus_vÆ16 *
out
, opus_vÆ16 
g1
, opus_vÆ16 
g2
,

446 
ovîœp48
, 
‰ame_size
, 
ch™√ls
, c⁄° 
›us_vÆ16
 *
wödow
, 
›us_öt32
 
Fs
)

448 
i
;

449 
ovîœp
;

450 
öc
;

451 
öc
 = 48000/
Fs
;

452 
ovîœp
=
ovîœp48
/
öc
;

453 
g1
 = 
Q15ONE
-g1;

454 
g2
 = 
Q15ONE
-g2;

455 
i
=0;i<
ovîœp
;i++)

457 
›us_vÆ32
 
diff
;

458 
›us_vÆ16
 
g
, 
w
;

459 
w
 = 
	`MULT16_16_Q15
(
wödow
[
i
*
öc
], window[i*inc]);

460 
g
 = 
	`SHR32
(
	`MAC16_16
(
	`MULT16_16
(
w
,
g2
),

461 
Q15ONE
-
w
, 
g1
), 15);

462 
diff
 = 
	`EXTRACT16
(
	`HALF32
((
›us_vÆ32
)
ö
[
i
*
ch™√ls
] - (opus_val32)in[i*channels+1]));

463 
diff
 = 
	`MULT16_16_Q15
(
g
, diff);

464 
out
[
i
*
ch™√ls
] = out[i*ch™√ls] - 
diff
;

465 
out
[
i
*
ch™√ls
+1] = out[i*ch™√ls+1] + 
diff
;

467 ;
i
<
‰ame_size
;i++)

469 
›us_vÆ32
 
diff
;

470 
diff
 = 
	`EXTRACT16
(
	`HALF32
((
›us_vÆ32
)
ö
[
i
*
ch™√ls
] - (opus_val32)in[i*channels+1]));

471 
diff
 = 
	`MULT16_16_Q15
(
g2
, diff);

472 
out
[
i
*
ch™√ls
] = out[i*ch™√ls] - 
diff
;

473 
out
[
i
*
ch™√ls
+1] = out[i*ch™√ls+1] + 
diff
;

475 
	}
}

477 
	$gaö_Áde
(c⁄° 
›us_vÆ16
 *
ö
, opus_vÆ16 *
out
, opus_vÆ16 
g1
, opus_vÆ16 
g2
,

478 
ovîœp48
, 
‰ame_size
, 
ch™√ls
, c⁄° 
›us_vÆ16
 *
wödow
, 
›us_öt32
 
Fs
)

480 
i
;

481 
öc
;

482 
ovîœp
;

483 
c
;

484 
öc
 = 48000/
Fs
;

485 
ovîœp
=
ovîœp48
/
öc
;

486 i‡(
ch™√ls
==1)

488 
i
=0;i<
ovîœp
;i++)

490 
›us_vÆ16
 
g
, 
w
;

491 
w
 = 
	`MULT16_16_Q15
(
wödow
[
i
*
öc
], window[i*inc]);

492 
g
 = 
	`SHR32
(
	`MAC16_16
(
	`MULT16_16
(
w
,
g2
),

493 
Q15ONE
-
w
, 
g1
), 15);

494 
out
[
i
] = 
	`MULT16_16_Q15
(
g
, 
ö
[i]);

497 
i
=0;i<
ovîœp
;i++)

499 
›us_vÆ16
 
g
, 
w
;

500 
w
 = 
	`MULT16_16_Q15
(
wödow
[
i
*
öc
], window[i*inc]);

501 
g
 = 
	`SHR32
(
	`MAC16_16
(
	`MULT16_16
(
w
,
g2
),

502 
Q15ONE
-
w
, 
g1
), 15);

503 
out
[
i
*2] = 
	`MULT16_16_Q15
(
g
, 
ö
[i*2]);

504 
out
[
i
*2+1] = 
	`MULT16_16_Q15
(
g
, 
ö
[i*2+1]);

507 
c
=0;do {

508 
i
=
ovîœp
;i<
‰ame_size
;i++)

510 
out
[
i
*
ch™√ls
+
c
] = 
	`MULT16_16_Q15
(
g2
, 
ö
[i*channels+c]);

513 ++
c
<
ch™√ls
);

514 
	}
}

516 
OpusEncodî
 *
	$›us_ícodî_¸óã
(
›us_öt32
 
Fs
, 
ch™√ls
, 
≠∂iˇti⁄
, *
îr‹
)

518 
ªt
;

519 
OpusEncodî
 *
°
;

520 if((
Fs
!=48000&&Fs!=24000&&Fs!=16000&&Fs!=12000&&Fs!=8000)||(
ch™√ls
!=1&&channels!=2)||

521 (
≠∂iˇti⁄
 !
OPUS_APPLICATION_VOIP
 &&áµliˇti⁄ !
OPUS_APPLICATION_AUDIO


522 && 
≠∂iˇti⁄
 !
OPUS_APPLICATION_RESTRICTED_LOWDELAY
))

524 i‡(
îr‹
)

525 *
îr‹
 = 
OPUS_BAD_ARG
;

526  
NULL
;

528 
°
 = (
OpusEncodî
 *)
	`›us_Æloc
(
	`›us_ícodî_gë_size
(
ch™√ls
));

529 i‡(
°
 =
NULL
)

531 i‡(
îr‹
)

532 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

533  
NULL
;

535 
ªt
 = 
	`›us_ícodî_öô
(
°
, 
Fs
, 
ch™√ls
, 
≠∂iˇti⁄
);

536 i‡(
îr‹
)

537 *
îr‹
 = 
ªt
;

538 i‡(
ªt
 !
OPUS_OK
)

540 
	`›us_‰ì
(
°
);

541 
°
 = 
NULL
;

543  
°
;

544 
	}
}

546 
›us_öt32
 
	$u£r_bôøã_to_bôøã
(
OpusEncodî
 *
°
, 
‰ame_size
, 
max_d©a_byãs
)

548 if(!
‰ame_size
)‰ame_size=
°
->
Fs
/400;

549 i‡(
°
->
u£r_bôøã_bps
==
OPUS_AUTO
)

550  60*
°
->
Fs
/
‰ame_size
 + st->Fs*°->
ch™√ls
;

551 i‡(
°
->
u£r_bôøã_bps
==
OPUS_BITRATE_MAX
)

552  
max_d©a_byãs
*8*
°
->
Fs
/
‰ame_size
;

554  
°
->
u£r_bôøã_bps
;

555 
	}
}

557 #i‚de‡
DISABLE_FLOAT_API


558 #ifde‡
FIXED_POINT


559 
	#PCM2VAL
(
x
Ë
	`FLOAT2INT16
(x)

	)

561 
	#PCM2VAL
(
x
Ë
	`SCALEIN
(x)

	)

564 
	$downmix_Êﬂt
(c⁄° *
_x
, 
›us_vÆ32
 *
y
, 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
)

566 c⁄° *
x
;

567 
j
;

569 
x
 = (c⁄° *)
_x
;

570 
j
=0;j<
sub‰ame
;j++)

571 
y
[
j
] = 
	`PCM2VAL
(
x
[(j+
off£t
)*
C
+
c1
]);

572 i‡(
c2
>-1)

574 
j
=0;j<
sub‰ame
;j++)

575 
y
[
j
] +
	`PCM2VAL
(
x
[(j+
off£t
)*
C
+
c2
]);

576 } i‡(
c2
==-2)

578 
c
;

579 
c
=1;c<
C
;c++)

581 
j
=0;j<
sub‰ame
;j++)

582 
y
[
j
] +
	`PCM2VAL
(
x
[(j+
off£t
)*
C
+
c
]);

585 
	}
}

588 
	$downmix_öt
(c⁄° *
_x
, 
›us_vÆ32
 *
y
, 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
)

590 c⁄° 
›us_öt16
 *
x
;

591 
j
;

593 
x
 = (c⁄° 
›us_öt16
 *)
_x
;

594 
j
=0;j<
sub‰ame
;j++)

595 
y
[
j
] = 
x
[(j+
off£t
)*
C
+
c1
];

596 i‡(
c2
>-1)

598 
j
=0;j<
sub‰ame
;j++)

599 
y
[
j
] +
x
[(j+
off£t
)*
C
+
c2
];

600 } i‡(
c2
==-2)

602 
c
;

603 
c
=1;c<
C
;c++)

605 
j
=0;j<
sub‰ame
;j++)

606 
y
[
j
] +
x
[(j+
off£t
)*
C
+
c
];

609 
	}
}

611 
›us_öt32
 
	$‰ame_size_£À˘
(
›us_öt32
 
‰ame_size
, 
v¨übÀ_duøti⁄
, opus_öt32 
Fs
)

613 
√w_size
;

614 i‡(
‰ame_size
<
Fs
/400)

616 i‡(
v¨übÀ_duøti⁄
 =
OPUS_FRAMESIZE_ARG
)

617 
√w_size
 = 
‰ame_size
;

618 i‡(
v¨übÀ_duøti⁄
 >
OPUS_FRAMESIZE_2_5_MS
 && v¨übÀ_duøti⁄ <
OPUS_FRAMESIZE_120_MS
)

620 i‡(
v¨übÀ_duøti⁄
 <
OPUS_FRAMESIZE_40_MS
)

621 
√w_size
 = (
Fs
/400)<<(
v¨übÀ_duøti⁄
-
OPUS_FRAMESIZE_2_5_MS
);

623 
√w_size
 = (
v¨übÀ_duøti⁄
-
OPUS_FRAMESIZE_2_5_MS
-2)*
Fs
/50;

627 i‡(
√w_size
>
‰ame_size
)

629 i‡(400*
√w_size
!=
Fs
 && 200*new_size!=Fs && 100*new_size!=Fs &&

630 50*
√w_size
!=
Fs
 && 25*new_size!=Fs && 50*new_size!=3*Fs &&

631 50*
√w_size
!=4*
Fs
 && 50*new_size!=5*Fs && 50*new_size!=6*Fs)

633  
√w_size
;

634 
	}
}

636 
›us_vÆ16
 
	$compuã_°îeo_width
(c⁄° 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
›us_öt32
 
Fs
, 
SãªoWidthSèã
 *
mem
)

638 
›us_vÆ32
 
xx
, 
xy
, 
yy
;

639 
›us_vÆ16
 
sqπ_xx
, 
sqπ_yy
;

640 
›us_vÆ16
 
qºt_xx
, 
qºt_yy
;

641 
‰ame_øã
;

642 
i
;

643 
›us_vÆ16
 
sh‹t_Æpha
;

645 
‰ame_øã
 = 
Fs
/
‰ame_size
;

646 
sh‹t_Æpha
 = 
Q15ONE
 - 
	`MULT16_16
(25, Q15ONE)/
	`IMAX
(50,
‰ame_øã
);

647 
xx
=
xy
=
yy
=0;

651 
i
=0;i<
‰ame_size
-3;i+=4)

653 
›us_vÆ32
 
pxx
=0;

654 
›us_vÆ32
 
pxy
=0;

655 
›us_vÆ32
 
pyy
=0;

656 
›us_vÆ16
 
x
, 
y
;

657 
x
 = 
pcm
[2*
i
];

658 
y
 = 
pcm
[2*
i
+1];

659 
pxx
 = 
	`SHR32
(
	`MULT16_16
(
x
,x),2);

660 
pxy
 = 
	`SHR32
(
	`MULT16_16
(
x
,
y
),2);

661 
pyy
 = 
	`SHR32
(
	`MULT16_16
(
y
,y),2);

662 
x
 = 
pcm
[2*
i
+2];

663 
y
 = 
pcm
[2*
i
+3];

664 
pxx
 +
	`SHR32
(
	`MULT16_16
(
x
,x),2);

665 
pxy
 +
	`SHR32
(
	`MULT16_16
(
x
,
y
),2);

666 
pyy
 +
	`SHR32
(
	`MULT16_16
(
y
,y),2);

667 
x
 = 
pcm
[2*
i
+4];

668 
y
 = 
pcm
[2*
i
+5];

669 
pxx
 +
	`SHR32
(
	`MULT16_16
(
x
,x),2);

670 
pxy
 +
	`SHR32
(
	`MULT16_16
(
x
,
y
),2);

671 
pyy
 +
	`SHR32
(
	`MULT16_16
(
y
,y),2);

672 
x
 = 
pcm
[2*
i
+6];

673 
y
 = 
pcm
[2*
i
+7];

674 
pxx
 +
	`SHR32
(
	`MULT16_16
(
x
,x),2);

675 
pxy
 +
	`SHR32
(
	`MULT16_16
(
x
,
y
),2);

676 
pyy
 +
	`SHR32
(
	`MULT16_16
(
y
,y),2);

678 
xx
 +
	`SHR32
(
pxx
, 10);

679 
xy
 +
	`SHR32
(
pxy
, 10);

680 
yy
 +
	`SHR32
(
pyy
, 10);

682 #i‚de‡
FIXED_POINT


683 i‡(!(
xx
 < 1e9fË|| 
	`˚…_i¢™
(xxË|| !(
yy
 < 1e9f) || celt_isnan(yy))

685 
xy
 = 
xx
 = 
yy
 = 0;

688 
mem
->
XX
 +
	`MULT16_32_Q15
(
sh‹t_Æpha
, 
xx
-mem->XX);

689 
mem
->
XY
 +
	`MULT16_32_Q15
(
sh‹t_Æpha
, 
xy
-mem->XY);

690 
mem
->
YY
 +
	`MULT16_32_Q15
(
sh‹t_Æpha
, 
yy
-mem->YY);

691 
mem
->
XX
 = 
	`MAX32
(0, mem->XX);

692 
mem
->
XY
 = 
	`MAX32
(0, mem->XY);

693 
mem
->
YY
 = 
	`MAX32
(0, mem->YY);

694 i‡(
	`MAX32
(
mem
->
XX
, mem->
YY
)>
	`QCONST16
(8e-4f, 18))

696 
›us_vÆ16
 
c‹r
;

697 
›us_vÆ16
 
ldiff
;

698 
›us_vÆ16
 
width
;

699 
sqπ_xx
 = 
	`˚…_sqπ
(
mem
->
XX
);

700 
sqπ_yy
 = 
	`˚…_sqπ
(
mem
->
YY
);

701 
qºt_xx
 = 
	`˚…_sqπ
(
sqπ_xx
);

702 
qºt_yy
 = 
	`˚…_sqπ
(
sqπ_yy
);

704 
mem
->
XY
 = 
	`MIN32
(mem->XY, 
sqπ_xx
*
sqπ_yy
);

705 
c‹r
 = 
	`SHR32
(
	`‰ac_div32
(
mem
->
XY
,
EPSILON
+
	`MULT16_16
(
sqπ_xx
,
sqπ_yy
)),16);

707 
ldiff
 = 
	`MULT16_16
(
Q15ONE
, 
	`ABS16
(
qºt_xx
-
qºt_yy
))/(
EPSILON
+qrrt_xx+qrrt_yy);

708 
width
 = 
	`MULT16_16_Q15
(
	`˚…_sqπ
(
	`QCONST32
(1.f,30)-
	`MULT16_16
(
c‹r
,c‹r)), 
ldiff
);

710 
mem
->
smoŸhed_width
 +(
width
-mem->smoŸhed_width)/
‰ame_øã
;

712 
mem
->
max_fﬁlowî
 = 
	`MAX16
(mem->max_fﬁlowî-
	`QCONST16
(.02f,15)/
‰ame_øã
, mem->
smoŸhed_width
);

715  
	`EXTRACT16
(
	`MIN32
(
Q15ONE
, 
	`MULT16_16
(20, 
mem
->
max_fﬁlowî
)));

716 
	}
}

718 
	$decide_„c
(
u£InB™dFEC
, 
PackëLoss_≥rc
, 
œ°_„c
, 
mode
, *
b™dwidth
, 
›us_öt32
 
øã
)

720 
‹ig_b™dwidth
;

721 i‡(!
u£InB™dFEC
 || 
PackëLoss_≥rc
 =0 || 
mode
 =
MODE_CELT_ONLY
)

723 
‹ig_b™dwidth
 = *
b™dwidth
;

726 
›us_öt32
 
hy°îesis
;

727 
›us_öt32
 
LBRR_øã_thªs_bps
;

729 
LBRR_øã_thªs_bps
 = 
„c_thªshﬁds
[2*(*
b™dwidth
 - 
OPUS_BANDWIDTH_NARROWBAND
)];

730 
hy°îesis
 = 
„c_thªshﬁds
[2*(*
b™dwidth
 - 
OPUS_BANDWIDTH_NARROWBAND
) + 1];

731 i‡(
œ°_„c
 =1Ë
LBRR_øã_thªs_bps
 -
hy°îesis
;

732 i‡(
œ°_„c
 =0Ë
LBRR_øã_thªs_bps
 +
hy°îesis
;

733 
LBRR_øã_thªs_bps
 = 
	`sûk_SMULWB
–
	`sûk_MUL
( LBRR_rate_thres_bps,

734 125 - 
	`sûk_mö
–
PackëLoss_≥rc
, 25 ) ), 
	`SILK_FIX_CONST
( 0.01, 16 ) );

737 i‡(
øã
 > 
LBRR_øã_thªs_bps
)

739 i‡(
PackëLoss_≥rc
 <= 5)

741 i‡(*
b™dwidth
 > 
OPUS_BANDWIDTH_NARROWBAND
)

742 (*
b™dwidth
)--;

747 *
b™dwidth
 = 
‹ig_b™dwidth
;

749 
	}
}

751 
	$compuã_sûk_øã_f‹_hybrid
(
øã
, 
b™dwidth
, 
‰ame20ms
, 
vbr
, 
„c
, 
ch™√ls
) {

752 
íåy
;

753 
i
;

754 
N
;

755 
sûk_øã
;

756 
øã_èbÀ
[][5] = {

769 
øã
 /
ch™√ls
;

770 
íåy
 = 1 + 
‰ame20ms
 + 2*
„c
;

771 
N
 = (
øã_èbÀ
)/(rate_table[0]);

772 
i
=1;i<
N
;i++)

774 i‡(
øã_èbÀ
[
i
][0] > 
øã
) ;

776 i‡(
i
 =
N
)

778 
sûk_øã
 = 
øã_èbÀ
[
i
-1][
íåy
];

780 
sûk_øã
 +(
øã
-
øã_èbÀ
[
i
-1][0])/2;

782 
›us_öt32
 
lo
, 
hi
, 
x0
, 
x1
;

783 
lo
 = 
øã_èbÀ
[
i
-1][
íåy
];

784 
hi
 = 
øã_èbÀ
[
i
][
íåy
];

785 
x0
 = 
øã_èbÀ
[
i
-1][0];

786 
x1
 = 
øã_èbÀ
[
i
][0];

787 
sûk_øã
 = (
lo
*(
x1
-
øã
Ë+ 
hi
*‘©e-
x0
))/(x1-x0);

789 i‡(!
vbr
)

792 
sûk_øã
 += 100;

794 i‡(
b™dwidth
==
OPUS_BANDWIDTH_SUPERWIDEBAND
)

795 
sûk_øã
 += 300;

796 
sûk_øã
 *
ch™√ls
;

798 i‡(
ch™√ls
 =2 && 
øã
 >= 12000)

799 
sûk_øã
 -= 1000;

800  
sûk_øã
;

801 
	}
}

805 
›us_öt32
 
	$compuã_equiv_øã
(
›us_öt32
 
bôøã
, 
ch™√ls
,

806 
‰ame_øã
, 
vbr
, 
mode
, 
com∂exôy
, 
loss
)

808 
›us_öt32
 
equiv
;

809 
equiv
 = 
bôøã
;

811 i‡(
‰ame_øã
 > 50)

812 
equiv
 -(40*
ch™√ls
+20)*(
‰ame_øã
 - 50);

814 i‡(!
vbr
)

815 
equiv
 -=Équiv/12;

817 
equiv
 =Équiv * (90+
com∂exôy
)/100;

818 i‡(
mode
 =
MODE_SILK_ONLY
 || modê=
MODE_HYBRID
)

822 i‡(
com∂exôy
<2)

823 
equiv
 =Équiv*4/5;

824 
equiv
 -equiv*
loss
/(6*loss + 10);

825 } i‡(
mode
 =
MODE_CELT_ONLY
) {

828 i‡(
com∂exôy
<5)

829 
equiv
 =Équiv*9/10;

833 
equiv
 -equiv*
loss
/(12*loss + 20);

835  
equiv
;

836 
	}
}

838 #i‚de‡
DISABLE_FLOAT_API


840 
	$is_digôÆ_sûí˚
(c⁄° 
›us_vÆ16
* 
pcm
, 
‰ame_size
, 
ch™√ls
, 
lsb_dïth
)

842 
sûí˚
 = 0;

843 
›us_vÆ32
 
ßm∂e_max
 = 0;

844 #ifde‡
MLP_TRAINING


847 
ßm∂e_max
 = 
	`˚…_maxabs16
(
pcm
, 
‰ame_size
*
ch™√ls
);

849 #ifde‡
FIXED_POINT


850 
sûí˚
 = (
ßm∂e_max
 == 0);

851 ()
lsb_dïth
;

853 
sûí˚
 = (
ßm∂e_max
 <(
›us_vÆ16
Ë1 / (1 << 
lsb_dïth
));

856  
sûí˚
;

857 
	}
}

859 #ifde‡
FIXED_POINT


860 
›us_vÆ32
 
	$compuã_‰ame_íîgy
(c⁄° 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
ch™√ls
, 
¨ch
)

862 
i
;

863 
›us_vÆ32
 
ßm∂e_max
;

864 
max_shi·
;

865 
shi·
;

866 
›us_vÆ32
 
íîgy
 = 0;

867 
Àn
 = 
‰ame_size
*
ch™√ls
;

868 ()
¨ch
;

870 
ßm∂e_max
 = 
	`˚…_maxabs16
(
pcm
, 
Àn
);

873 
max_shi·
 = 
	`˚…_ûog2
(
Àn
);

874 
shi·
 = 
	`IMAX
(0, (
	`˚…_ûog2
(
ßm∂e_max
Ë<< 1Ë+ 
max_shi·
 - 28);

877 
i
=0; i<
Àn
; i++)

878 
íîgy
 +
	`SHR32
(
	`MULT16_16
(
pcm
[
i
],Öcm[i]), 
shi·
);

881 
íîgy
 /
Àn
;

882 
íîgy
 = 
	`SHL32
”√rgy, 
shi·
);

884  
íîgy
;

885 
	}
}

887 
›us_vÆ32
 
	$compuã_‰ame_íîgy
(c⁄° 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
ch™√ls
, 
¨ch
)

889 
Àn
 = 
‰ame_size
*
ch™√ls
;

890  
	`˚…_ö√r_¥od
(
pcm
,Öcm, 
Àn
, 
¨ch
)/len;

891 
	}
}

895 
	$decide_dtx_mode
(
a˘ivôy_¥obabûôy
,

896 *
nb_no_a˘ivôy_‰ames
,

897 
›us_vÆ32
 
≥ak_sig«l_íîgy
,

898 c⁄° 
›us_vÆ16
 *
pcm
,

899 
‰ame_size
,

900 
ch™√ls
,

901 
is_sûí˚
,

902 
¨ch


905 
›us_vÆ32
 
noi£_íîgy
;

907 i‡(!
is_sûí˚
)

909 i‡(
a˘ivôy_¥obabûôy
 < 
DTX_ACTIVITY_THRESHOLD
)

911 
noi£_íîgy
 = 
	`compuã_‰ame_íîgy
(
pcm
, 
‰ame_size
, 
ch™√ls
, 
¨ch
);

914 
is_sûí˚
 = 
≥ak_sig«l_íîgy
 >(
PSEUDO_SNR_THRESHOLD
 * 
noi£_íîgy
);

918 i‡(
is_sûí˚
)

921 (*
nb_no_a˘ivôy_‰ames
)++;

923 i‡(*
nb_no_a˘ivôy_‰ames
 > 
NB_SPEECH_FRAMES_BEFORE_DTX
)

925 i‡(*
nb_no_a˘ivôy_‰ames
 <(
NB_SPEECH_FRAMES_BEFORE_DTX
 + 
MAX_CONSECUTIVE_DTX
))

929 (*
nb_no_a˘ivôy_‰ames
Ë
NB_SPEECH_FRAMES_BEFORE_DTX
;

932 (*
nb_no_a˘ivôy_‰ames
) = 0;

935 
	}
}

939 
›us_öt32
 
	$ícode_mu…i‰ame_∑ckë
(
OpusEncodî
 *
°
,

940 c⁄° 
›us_vÆ16
 *
pcm
,

941 
nb_‰ames
,

942 
‰ame_size
,

943 *
d©a
,

944 
›us_öt32
 
out_d©a_byãs
,

945 
to_˚…
,

946 
lsb_dïth
,

947 
Êﬂt_≠i
)

949 
i
;

950 
ªt
 = 0;

951 
	`VARDECL
(, 
tmp_d©a
);

952 
bak_mode
, 
bak_b™dwidth
, 
bak_ch™√ls
, 
bak_to_m⁄o
;

953 
	`VARDECL
(
OpusRïackëizî
, 
Ω
);

954 
max_hódî_byãs
;

955 
›us_öt32
 
byãs_≥r_‰ame
;

956 
›us_öt32
 
cbr_byãs
;

957 
›us_öt32
 
ª∑ckëize_Àn
;

958 
tmp_Àn
;

959 
ALLOC_STACK
;

964 
max_hódî_byãs
 = 
nb_‰ames
 == 2 ? 3 : (2+(nb_frames-1)*2);

966 i‡(
°
->
u£_vbr
 || st->
u£r_bôøã_bps
==
OPUS_BITRATE_MAX
)

967 
ª∑ckëize_Àn
 = 
out_d©a_byãs
;

969 
cbr_byãs
 = 3*
°
->
bôøã_bps
/(3*8*°->
Fs
/(
‰ame_size
*
nb_‰ames
));

970 
ª∑ckëize_Àn
 = 
	`IMIN
(
cbr_byãs
, 
out_d©a_byãs
);

972 
byãs_≥r_‰ame
 = 
	`IMIN
(1276, 1+(
ª∑ckëize_Àn
-
max_hódî_byãs
)/
nb_‰ames
);

974 
	`ALLOC
(
tmp_d©a
, 
nb_‰ames
*
byãs_≥r_‰ame
, );

975 
	`ALLOC
(
Ω
, 1, 
OpusRïackëizî
);

976 
	`›us_ª∑ckëizî_öô
(
Ω
);

978 
bak_mode
 = 
°
->
u£r_f‹˚d_mode
;

979 
bak_b™dwidth
 = 
°
->
u£r_b™dwidth
;

980 
bak_ch™√ls
 = 
°
->
f‹˚_ch™√ls
;

982 
°
->
u£r_f‹˚d_mode
 = st->
mode
;

983 
°
->
u£r_b™dwidth
 = st->
b™dwidth
;

984 
°
->
f‹˚_ch™√ls
 = st->
°ªam_ch™√ls
;

986 
bak_to_m⁄o
 = 
°
->
sûk_mode
.
toM⁄o
;

987 i‡(
bak_to_m⁄o
)

988 
°
->
f‹˚_ch™√ls
 = 1;

990 
°
->
¥ev_ch™√ls
 = st->
°ªam_ch™√ls
;

992 
i
=0;i<
nb_‰ames
;i++)

994 
°
->
sûk_mode
.
toM⁄o
 = 0;

995 
°
->
n⁄föÆ_‰ame
 = 
i
<(
nb_‰ames
-1);

998 i‡(
to_˚…
 && 
i
==
nb_‰ames
-1)

999 
°
->
u£r_f‹˚d_mode
 = 
MODE_CELT_ONLY
;

1001 
tmp_Àn
 = 
	`›us_ícode_«tive
(
°
, 
pcm
+
i
*(°->
ch™√ls
*
‰ame_size
), frame_size,

1002 
tmp_d©a
+
i
*
byãs_≥r_‰ame
, byãs_≥r_‰ame, 
lsb_dïth
, 
NULL
, 0, 0, 0, 0,

1003 
NULL
, 
Êﬂt_≠i
);

1005 i‡(
tmp_Àn
<0)

1007 
RESTORE_STACK
;

1008  
OPUS_INTERNAL_ERROR
;

1011 
ªt
 = 
	`›us_ª∑ckëizî_ˇt
(
Ω
, 
tmp_d©a
+
i
*
byãs_≥r_‰ame
, 
tmp_Àn
);

1013 i‡(
ªt
<0)

1015 
RESTORE_STACK
;

1016  
OPUS_INTERNAL_ERROR
;

1020 
ªt
 = 
	`›us_ª∑ckëizî_out_ønge_im∂
(
Ω
, 0, 
nb_‰ames
, 
d©a
, 
ª∑ckëize_Àn
, 0, !
°
->
u£_vbr
);

1022 i‡(
ªt
<0)

1024 
RESTORE_STACK
;

1025  
OPUS_INTERNAL_ERROR
;

1029 
°
->
u£r_f‹˚d_mode
 = 
bak_mode
;

1030 
°
->
u£r_b™dwidth
 = 
bak_b™dwidth
;

1031 
°
->
f‹˚_ch™√ls
 = 
bak_ch™√ls
;

1032 
°
->
sûk_mode
.
toM⁄o
 = 
bak_to_m⁄o
;

1034 
RESTORE_STACK
;

1035  
ªt
;

1036 
	}
}

1038 
	$compuã_ªdund™cy_byãs
(
›us_öt32
 
max_d©a_byãs
, opus_öt32 
bôøã_bps
, 
‰ame_øã
, 
ch™√ls
)

1040 
ªdund™cy_byãs_ˇp
;

1041 
ªdund™cy_byãs
;

1042 
›us_öt32
 
ªdund™cy_øã
;

1043 
ba£_bôs
;

1044 
›us_öt32
 
avaûabÀ_bôs
;

1045 
ba£_bôs
 = (40*
ch™√ls
+20);

1048 
ªdund™cy_øã
 = 
bôøã_bps
 + 
ba£_bôs
*(200 - 
‰ame_øã
);

1051 
ªdund™cy_øã
 = 3*redundancy_rate/2;

1052 
ªdund™cy_byãs
 = 
ªdund™cy_øã
/1600;

1055 
avaûabÀ_bôs
 = 
max_d©a_byãs
*8 - 2*
ba£_bôs
;

1056 
ªdund™cy_byãs_ˇp
 = (
avaûabÀ_bôs
*240/(240+48000/
‰ame_øã
Ë+ 
ba£_bôs
)/8;

1057 
ªdund™cy_byãs
 = 
	`IMIN
‘edund™cy_byãs, 
ªdund™cy_byãs_ˇp
);

1059 i‡(
ªdund™cy_byãs
 > 4 + 8*
ch™√ls
)

1060 
ªdund™cy_byãs
 = 
	`IMIN
(257,Ñedundancy_bytes);

1062 
ªdund™cy_byãs
 = 0;

1063  
ªdund™cy_byãs
;

1064 
	}
}

1066 
›us_öt32
 
	$›us_ícode_«tive
(
OpusEncodî
 *
°
, c⁄° 
›us_vÆ16
 *
pcm
, 
‰ame_size
,

1067 *
d©a
, 
›us_öt32
 
out_d©a_byãs
, 
lsb_dïth
,

1068 c⁄° *
™Æysis_pcm
, 
›us_öt32
 
™Æysis_size
, 
c1
, 
c2
,

1069 
™Æysis_ch™√ls
, 
downmix_func
 
downmix
, 
Êﬂt_≠i
)

1071 *
sûk_íc
;

1072 
CELTEncodî
 *
˚…_íc
;

1073 
i
;

1074 
ªt
=0;

1075 
›us_öt32
 
nByãs
;

1076 
ec_íc
 
íc
;

1077 
byãs_èrgë
;

1078 
¥efûl
=0;

1079 
°¨t_b™d
 = 0;

1080 
ªdund™cy
 = 0;

1081 
ªdund™cy_byãs
 = 0;

1082 
˚…_to_sûk
 = 0;

1083 
	`VARDECL
(
›us_vÆ16
, 
pcm_buf
);

1084 
nb_com¥_byãs
;

1085 
to_˚…
 = 0;

1086 
›us_uöt32
 
ªdund™t_∫g
 = 0;

1087 
cutoff_Hz
, 
hp_‰eq_smth1
;

1088 
voi˚_e°
;

1089 
›us_öt32
 
equiv_øã
;

1090 
dñay_com≥nßti⁄
;

1091 
‰ame_øã
;

1092 
›us_öt32
 
max_øã
;

1093 
cuº_b™dwidth
;

1094 
›us_vÆ16
 
HB_gaö
;

1095 
›us_öt32
 
max_d©a_byãs
;

1096 
tŸÆ_buf„r
;

1097 
›us_vÆ16
 
°îeo_width
;

1098 c⁄° 
CELTMode
 *
˚…_mode
;

1099 #i‚de‡
DISABLE_FLOAT_API


1100 
A«lysisInfo
 
™Æysis_öfo
;

1101 
™Æysis_ªad_pos_bak
=-1;

1102 
™Æysis_ªad_sub‰ame_bak
=-1;

1103 
is_sûí˚
 = 0;

1105 
	`VARDECL
(
›us_vÆ16
, 
tmp_¥efûl
);

1107 
ALLOC_STACK
;

1109 
max_d©a_byãs
 = 
	`IMIN
(1276, 
out_d©a_byãs
);

1111 
°
->
øngeFöÆ
 = 0;

1112 i‡(
‰ame_size
 <0 || 
max_d©a_byãs
 <= 0)

1114 
RESTORE_STACK
;

1115  
OPUS_BAD_ARG
;

1119 i‡(
max_d©a_byãs
==1 && 
°
->
Fs
==(
‰ame_size
*10))

1121 
RESTORE_STACK
;

1122  
OPUS_BUFFER_TOO_SMALL
;

1125 
sûk_íc
 = (*)
°
+°->
sûk_íc_off£t
;

1126 
˚…_íc
 = (
CELTEncodî
*)((*)
°
+°->
˚…_íc_off£t
);

1127 i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_RESTRICTED_LOWDELAY
)

1128 
dñay_com≥nßti⁄
 = 0;

1130 
dñay_com≥nßti⁄
 = 
°
->delay_compensation;

1132 
lsb_dïth
 = 
	`IMIN
÷sb_dïth, 
°
->lsb_depth);

1134 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_GET_MODE
(&
˚…_mode
));

1135 #i‚de‡
DISABLE_FLOAT_API


1136 
™Æysis_öfo
.
vÆid
 = 0;

1137 #ifde‡
FIXED_POINT


1138 i‡(
°
->
sûk_mode
.
com∂exôy
 >10 && st->
Fs
>=16000)

1140 i‡(
°
->
sûk_mode
.
com∂exôy
 >7 && st->
Fs
>=16000)

1143 
is_sûí˚
 = 
	`is_digôÆ_sûí˚
(
pcm
, 
‰ame_size
, 
°
->
ch™√ls
, 
lsb_dïth
);

1144 
™Æysis_ªad_pos_bak
 = 
°
->
™Æysis
.
ªad_pos
;

1145 
™Æysis_ªad_sub‰ame_bak
 = 
°
->
™Æysis
.
ªad_sub‰ame
;

1146 
	`run_™Æysis
(&
°
->
™Æysis
, 
˚…_mode
, 
™Æysis_pcm
, 
™Æysis_size
, 
‰ame_size
,

1147 
c1
, 
c2
, 
™Æysis_ch™√ls
, 
°
->
Fs
,

1148 
lsb_dïth
, 
downmix
, &
™Æysis_öfo
);

1151 i‡(!
is_sûí˚
 && 
™Æysis_öfo
.
a˘ivôy_¥obabûôy
 > 
DTX_ACTIVITY_THRESHOLD
)

1152 
°
->
≥ak_sig«l_íîgy
 = 
	`MAX32
(
	`MULT16_32_Q15
(
	`QCONST16
(0.999f, 15), st->peak_signal_energy),

1153 
	`compuã_‰ame_íîgy
(
pcm
, 
‰ame_size
, 
°
->
ch™√ls
, st->
¨ch
));

1154 } i‡(
°
->
™Æysis
.
öôülized
) {

1155 
	`t⁄Æôy_™Æysis_ª£t
(&
°
->
™Æysis
);

1158 ()
™Æysis_pcm
;

1159 ()
™Æysis_size
;

1160 ()
c1
;

1161 ()
c2
;

1162 ()
™Æysis_ch™√ls
;

1163 ()
downmix
;

1166 #i‚de‡
DISABLE_FLOAT_API


1169 i‡(!
is_sûí˚
)

1170 
°
->
voi˚_øtio
 = -1;

1172 
°
->
dëe˘ed_b™dwidth
 = 0;

1173 i‡(
™Æysis_öfo
.
vÆid
)

1175 
™Æysis_b™dwidth
;

1176 i‡(
°
->
sig«l_ty≥
 =
OPUS_AUTO
)

1178 
¥ob
;

1179 i‡(
°
->
¥ev_mode
 == 0)

1180 
¥ob
 = 
™Æysis_öfo
.
music_¥ob
;

1181 i‡(
°
->
¥ev_mode
 =
MODE_CELT_ONLY
)

1182 
¥ob
 = 
™Æysis_öfo
.
music_¥ob_max
;

1184 
¥ob
 = 
™Æysis_öfo
.
music_¥ob_mö
;

1185 
°
->
voi˚_øtio
 = ()
	`Êo‹
(.5+100*(1-
¥ob
));

1188 
™Æysis_b™dwidth
 = 
™Æysis_öfo
.
b™dwidth
;

1189 i‡(
™Æysis_b™dwidth
<=12)

1190 
°
->
dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

1191 i‡(
™Æysis_b™dwidth
<=14)

1192 
°
->
dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
;

1193 i‡(
™Æysis_b™dwidth
<=16)

1194 
°
->
dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1195 i‡(
™Æysis_b™dwidth
<=18)

1196 
°
->
dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_SUPERWIDEBAND
;

1198 
°
->
dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

1201 
°
->
voi˚_øtio
 = -1;

1204 i‡(
°
->
ch™√ls
==2 && st->
f‹˚_ch™√ls
!=1)

1205 
°îeo_width
 = 
	`compuã_°îeo_width
(
pcm
, 
‰ame_size
, 
°
->
Fs
, &°->
width_mem
);

1207 
°îeo_width
 = 0;

1208 
tŸÆ_buf„r
 = 
dñay_com≥nßti⁄
;

1209 
°
->
bôøã_bps
 = 
	`u£r_bôøã_to_bôøã
(°, 
‰ame_size
, 
max_d©a_byãs
);

1211 
‰ame_øã
 = 
°
->
Fs
/
‰ame_size
;

1212 i‡(!
°
->
u£_vbr
)

1214 
cbrByãs
;

1216 
‰ame_øã12
 = 12*
°
->
Fs
/
‰ame_size
;

1218 
cbrByãs
 = 
	`IMIN
–(12*
°
->
bôøã_bps
/8 + 
‰ame_øã12
/2)/‰ame_øã12, 
max_d©a_byãs
);

1219 
°
->
bôøã_bps
 = 
cbrByãs
*(
›us_öt32
)
‰ame_øã12
*8/12;

1221 
max_d©a_byãs
 = 
	`IMAX
(1, 
cbrByãs
);

1223 i‡(
max_d©a_byãs
<3 || 
°
->
bôøã_bps
 < 3*
‰ame_øã
*8

1224 || (
‰ame_øã
<50 && (
max_d©a_byãs
*‰ame_øã<300 || 
°
->
bôøã_bps
 < 2400)))

1227 
tocmode
 = 
°
->
mode
;

1228 
bw
 = 
°
->
b™dwidth
 =0 ? 
OPUS_BANDWIDTH_NARROWBAND
 : st->bandwidth;

1229 
∑ckë_code
 = 0;

1230 
num_mu…i‰ames
 = 0;

1232 i‡(
tocmode
==0)

1233 
tocmode
 = 
MODE_SILK_ONLY
;

1234 i‡(
‰ame_øã
>100)

1235 
tocmode
 = 
MODE_CELT_ONLY
;

1237 i‡(
‰ame_øã
==25 && 
tocmode
!=
MODE_SILK_ONLY
)

1239 
‰ame_øã
 = 50;

1240 
∑ckë_code
 = 1;

1244 i‡(
‰ame_øã
<=16)

1247 i‡(
out_d©a_byãs
==1 || (
tocmode
==
MODE_SILK_ONLY
 && 
‰ame_øã
!=10))

1249 
tocmode
 = 
MODE_SILK_ONLY
;

1251 
∑ckë_code
 = 
‰ame_øã
 <= 12;

1252 
‰ame_øã
 = frame_rate == 12 ? 25 : 16;

1256 
num_mu…i‰ames
 = 50/
‰ame_øã
;

1257 
‰ame_øã
 = 50;

1258 
∑ckë_code
 = 3;

1262 if(
tocmode
==
MODE_SILK_ONLY
&&
bw
>
OPUS_BANDWIDTH_WIDEBAND
)

1263 
bw
=
OPUS_BANDWIDTH_WIDEBAND
;

1264 i‡(
tocmode
==
MODE_CELT_ONLY
&&
bw
==
OPUS_BANDWIDTH_MEDIUMBAND
)

1265 
bw
=
OPUS_BANDWIDTH_NARROWBAND
;

1266 i‡(
tocmode
==
MODE_HYBRID
&&
bw
<=
OPUS_BANDWIDTH_SUPERWIDEBAND
)

1267 
bw
=
OPUS_BANDWIDTH_SUPERWIDEBAND
;

1269 
d©a
[0] = 
	`gí_toc
(
tocmode
, 
‰ame_øã
, 
bw
, 
°
->
°ªam_ch™√ls
);

1270 
d©a
[0] |
∑ckë_code
;

1272 
ªt
 = 
∑ckë_code
 <= 1 ? 1 : 2;

1274 
max_d©a_byãs
 = 
	`IMAX
(max_d©a_byãs, 
ªt
);

1276 i‡(
∑ckë_code
==3)

1277 
d©a
[1] = 
num_mu…i‰ames
;

1279 i‡(!
°
->
u£_vbr
)

1281 
ªt
 = 
	`›us_∑ckë_∑d
(
d©a
,Ñë, 
max_d©a_byãs
);

1282 i‡(
ªt
 =
OPUS_OK
)

1283 
ªt
 = 
max_d©a_byãs
;

1285 
ªt
 = 
OPUS_INTERNAL_ERROR
;

1287 
RESTORE_STACK
;

1288  
ªt
;

1290 
max_øã
 = 
‰ame_øã
*
max_d©a_byãs
*8;

1293 
equiv_øã
 = 
	`compuã_equiv_øã
(
°
->
bôøã_bps
, st->
ch™√ls
, st->
Fs
/
‰ame_size
,

1294 
°
->
u£_vbr
, 0, st->
sûk_mode
.
com∂exôy
, st->sûk_mode.
∑ckëLossPî˚¡age
);

1296 i‡(
°
->
sig«l_ty≥
 =
OPUS_SIGNAL_VOICE
)

1297 
voi˚_e°
 = 127;

1298 i‡(
°
->
sig«l_ty≥
 =
OPUS_SIGNAL_MUSIC
)

1299 
voi˚_e°
 = 0;

1300 i‡(
°
->
voi˚_øtio
 >= 0)

1302 
voi˚_e°
 = 
°
->
voi˚_øtio
*327>>8;

1304 i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_AUDIO
)

1305 
voi˚_e°
 = 
	`IMIN
(voice_est, 115);

1306 } i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_VOIP
)

1307 
voi˚_e°
 = 115;

1309 
voi˚_e°
 = 48;

1311 i‡(
°
->
f‹˚_ch™√ls
!=
OPUS_AUTO
 && st->
ch™√ls
 == 2)

1313 
°
->
°ªam_ch™√ls
 = st->
f‹˚_ch™√ls
;

1315 #ifde‡
FUZZING


1317 i‡(
°
->
ch™√ls
 =2 && (
	`ønd
()&0x1F)==0)

1318 
°
->
°ªam_ch™√ls
 = 3-st->stream_channels;

1321 i‡(
°
->
ch™√ls
 == 2)

1323 
›us_öt32
 
°îeo_thªshﬁd
;

1324 
°îeo_thªshﬁd
 = 
°îeo_music_thªshﬁd
 + ((
voi˚_e°
*voi˚_e°*(
°îeo_voi˚_thªshﬁd
-stereo_music_threshold))>>14);

1325 i‡(
°
->
°ªam_ch™√ls
 == 2)

1326 
°îeo_thªshﬁd
 -= 1000;

1328 
°îeo_thªshﬁd
 += 1000;

1329 
°
->
°ªam_ch™√ls
 = (
equiv_øã
 > 
°îeo_thªshﬁd
) ? 2 : 1;

1331 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
;

1336 
equiv_øã
 = 
	`compuã_equiv_øã
(
°
->
bôøã_bps
, st->
°ªam_ch™√ls
, st->
Fs
/
‰ame_size
,

1337 
°
->
u£_vbr
, 0, st->
sûk_mode
.
com∂exôy
, st->sûk_mode.
∑ckëLossPî˚¡age
);

1341 #i‚de‡
DISABLE_FLOAT_API


1342 
°
->
sûk_mode
.
u£DTX
 = st->
u£_dtx
 && !(
™Æysis_öfo
.
vÆid
 || 
is_sûí˚
);

1344 
°
->
sûk_mode
.
u£DTX
 = st->
u£_dtx
;

1348 i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_RESTRICTED_LOWDELAY
)

1350 
°
->
mode
 = 
MODE_CELT_ONLY
;

1351 } i‡(
°
->
u£r_f‹˚d_mode
 =
OPUS_AUTO
)

1353 #ifde‡
FUZZING


1355 i‡((
	`ønd
()&0xF)==0)

1357 i‡((
	`ønd
()&0x1)==0)

1358 
°
->
mode
 = 
MODE_CELT_ONLY
;

1360 
°
->
mode
 = 
MODE_SILK_ONLY
;

1362 i‡(
°
->
¥ev_mode
==
MODE_CELT_ONLY
)

1363 
°
->
mode
 = 
MODE_CELT_ONLY
;

1365 
°
->
mode
 = 
MODE_SILK_ONLY
;

1368 
›us_öt32
 
mode_voi˚
, 
mode_music
;

1369 
›us_öt32
 
thªshﬁd
;

1372 
mode_voi˚
 = (
›us_öt32
)(
	`MULT16_32_Q15
(
Q15ONE
-
°îeo_width
,
mode_thªshﬁds
[0][0])

1373 + 
	`MULT16_32_Q15
(
°îeo_width
,
mode_thªshﬁds
[1][0]));

1374 
mode_music
 = (
›us_öt32
)(
	`MULT16_32_Q15
(
Q15ONE
-
°îeo_width
,
mode_thªshﬁds
[1][1])

1375 + 
	`MULT16_32_Q15
(
°îeo_width
,
mode_thªshﬁds
[1][1]));

1377 
thªshﬁd
 = 
mode_music
 + ((
voi˚_e°
*voi˚_e°*(
mode_voi˚
-mode_music))>>14);

1379 i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_VOIP
)

1380 
thªshﬁd
 += 8000;

1384 i‡(
°
->
¥ev_mode
 =
MODE_CELT_ONLY
)

1385 
thªshﬁd
 -= 4000;

1386 i‡(
°
->
¥ev_mode
>0)

1387 
thªshﬁd
 += 4000;

1389 
°
->
mode
 = (
equiv_øã
 >
thªshﬁd
Ë? 
MODE_CELT_ONLY
: 
MODE_SILK_ONLY
;

1392 i‡(
°
->
sûk_mode
.
u£InB™dFEC
 && st->sûk_mode.
∑ckëLossPî˚¡age
 > (128-
voi˚_e°
)>>4)

1393 
°
->
mode
 = 
MODE_SILK_ONLY
;

1396 i‡(
°
->
sûk_mode
.
u£DTX
 && 
voi˚_e°
 > 100)

1397 
°
->
mode
 = 
MODE_SILK_ONLY
;

1401 i‡(
max_d©a_byãs
 < (
‰ame_øã
 > 50 ? 9000 : 6000)*
‰ame_size
 / (
°
->
Fs
 * 8))

1402 
°
->
mode
 = 
MODE_CELT_ONLY
;

1404 
°
->
mode
 = st->
u£r_f‹˚d_mode
;

1408 i‡(
°
->
mode
 !
MODE_CELT_ONLY
 && 
‰ame_size
 < st->
Fs
/100)

1409 
°
->
mode
 = 
MODE_CELT_ONLY
;

1410 i‡(
°
->
l„
)

1411 
°
->
mode
 = 
MODE_CELT_ONLY
;

1413 i‡(
°
->
¥ev_mode
 > 0 &&

1414 ((
°
->
mode
 !
MODE_CELT_ONLY
 && st->
¥ev_mode
 == MODE_CELT_ONLY) ||

1415 (
°
->
mode
 =
MODE_CELT_ONLY
 && st->
¥ev_mode
 != MODE_CELT_ONLY)))

1417 
ªdund™cy
 = 1;

1418 
˚…_to_sûk
 = (
°
->
mode
 !
MODE_CELT_ONLY
);

1419 i‡(!
˚…_to_sûk
)

1422 i‡(
‰ame_size
 >
°
->
Fs
/100)

1424 
°
->
mode
 = st->
¥ev_mode
;

1425 
to_˚…
 = 1;

1427 
ªdund™cy
=0;

1434 i‡(
°
->
°ªam_ch™√ls
 =1 && st->
¥ev_ch™√ls
 ==2 && st->
sûk_mode
.
toM⁄o
==0

1435 && 
°
->
mode
 !
MODE_CELT_ONLY
 && st->
¥ev_mode
 != MODE_CELT_ONLY)

1438 
°
->
sûk_mode
.
toM⁄o
 = 1;

1439 
°
->
°ªam_ch™√ls
 = 2;

1441 
°
->
sûk_mode
.
toM⁄o
 = 0;

1445 
equiv_øã
 = 
	`compuã_equiv_øã
(
°
->
bôøã_bps
, st->
°ªam_ch™√ls
, st->
Fs
/
‰ame_size
,

1446 
°
->
u£_vbr
, st->
mode
, st->
sûk_mode
.
com∂exôy
, st->sûk_mode.
∑ckëLossPî˚¡age
);

1448 i‡(
°
->
mode
 !
MODE_CELT_ONLY
 && st->
¥ev_mode
 == MODE_CELT_ONLY)

1450 
sûk_EncC⁄åﬁSåu˘
 
dummy
;

1451 
	`sûk_InôEncodî
–
sûk_íc
, 
°
->
¨ch
, &
dummy
);

1452 
¥efûl
=1;

1456 i‡(
°
->
mode
 =
MODE_CELT_ONLY
 || st->
fú°
 || st->
sûk_mode
.
ÆlowB™dwidthSwôch
)

1458 c⁄° 
›us_öt32
 *
voi˚_b™dwidth_thªshﬁds
, *
music_b™dwidth_thªshﬁds
;

1459 
›us_öt32
 
b™dwidth_thªshﬁds
[8];

1460 
b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

1462 i‡(
°
->
ch™√ls
==2 && st->
f‹˚_ch™√ls
!=1)

1464 
voi˚_b™dwidth_thªshﬁds
 = 
°îeo_voi˚_b™dwidth_thªshﬁds
;

1465 
music_b™dwidth_thªshﬁds
 = 
°îeo_music_b™dwidth_thªshﬁds
;

1467 
voi˚_b™dwidth_thªshﬁds
 = 
m⁄o_voi˚_b™dwidth_thªshﬁds
;

1468 
music_b™dwidth_thªshﬁds
 = 
m⁄o_music_b™dwidth_thªshﬁds
;

1471 
i
=0;i<8;i++)

1473 
b™dwidth_thªshﬁds
[
i
] = 
music_b™dwidth_thªshﬁds
[i]

1474 + ((
voi˚_e°
*voi˚_e°*(
voi˚_b™dwidth_thªshﬁds
[
i
]-
music_b™dwidth_thªshﬁds
[i]))>>14);

1477 
thªshﬁd
, 
hy°îesis
;

1478 
thªshﬁd
 = 
b™dwidth_thªshﬁds
[2*(
b™dwidth
-
OPUS_BANDWIDTH_MEDIUMBAND
)];

1479 
hy°îesis
 = 
b™dwidth_thªshﬁds
[2*(
b™dwidth
-
OPUS_BANDWIDTH_MEDIUMBAND
)+1];

1480 i‡(!
°
->
fú°
)

1482 i‡(
°
->
auto_b™dwidth
 >
b™dwidth
)

1483 
thªshﬁd
 -
hy°îesis
;

1485 
thªshﬁd
 +
hy°îesis
;

1487 i‡(
equiv_øã
 >
thªshﬁd
)

1489 } --
b™dwidth
>
OPUS_BANDWIDTH_NARROWBAND
);

1492 i‡(
b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
)

1493 
b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1494 
°
->
b™dwidth
 = st->
auto_b™dwidth
 = bandwidth;

1497 i‡(!
°
->
fú°
 && st->
mode
 !
MODE_CELT_ONLY
 && !°->
sûk_mode
.
öWBmodeWôhoutV¨übÀLP
 && st->
b™dwidth
 > 
OPUS_BANDWIDTH_WIDEBAND
)

1498 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1501 i‡(
°
->
b™dwidth
>°->
max_b™dwidth
)

1502 
°
->
b™dwidth
 = st->
max_b™dwidth
;

1504 i‡(
°
->
u£r_b™dwidth
 !
OPUS_AUTO
)

1505 
°
->
b™dwidth
 = st->
u£r_b™dwidth
;

1508 i‡(
°
->
mode
 !
MODE_CELT_ONLY
 && 
max_øã
 < 15000)

1510 
°
->
b™dwidth
 = 
	`IMIN
(°->b™dwidth, 
OPUS_BANDWIDTH_WIDEBAND
);

1515 i‡(
°
->
Fs
 <24000 && st->
b™dwidth
 > 
OPUS_BANDWIDTH_SUPERWIDEBAND
)

1516 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_SUPERWIDEBAND
;

1517 i‡(
°
->
Fs
 <16000 && st->
b™dwidth
 > 
OPUS_BANDWIDTH_WIDEBAND
)

1518 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1519 i‡(
°
->
Fs
 <12000 && st->
b™dwidth
 > 
OPUS_BANDWIDTH_MEDIUMBAND
)

1520 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
;

1521 i‡(
°
->
Fs
 <8000 && st->
b™dwidth
 > 
OPUS_BANDWIDTH_NARROWBAND
)

1522 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

1523 #i‚de‡
DISABLE_FLOAT_API


1525 i‡(
°
->
dëe˘ed_b™dwidth
 && st->
u£r_b™dwidth
 =
OPUS_AUTO
)

1527 
mö_dëe˘ed_b™dwidth
;

1532 i‡(
equiv_øã
 <18000*
°
->
°ªam_ch™√ls
 && st->
mode
 =
MODE_CELT_ONLY
)

1533 
mö_dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

1534 i‡(
equiv_øã
 <24000*
°
->
°ªam_ch™√ls
 && st->
mode
 =
MODE_CELT_ONLY
)

1535 
mö_dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
;

1536 i‡(
equiv_øã
 <30000*
°
->
°ªam_ch™√ls
)

1537 
mö_dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1538 i‡(
equiv_øã
 <44000*
°
->
°ªam_ch™√ls
)

1539 
mö_dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_SUPERWIDEBAND
;

1541 
mö_dëe˘ed_b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

1543 
°
->
dëe˘ed_b™dwidth
 = 
	`IMAX
(°->dëe˘ed_b™dwidth, 
mö_dëe˘ed_b™dwidth
);

1544 
°
->
b™dwidth
 = 
	`IMIN
(°->b™dwidth, st->
dëe˘ed_b™dwidth
);

1547 
°
->
sûk_mode
.
LBRR_coded
 = 
	`decide_„c
(°->sûk_mode.
u£InB™dFEC
, st->sûk_mode.
∑ckëLossPî˚¡age
,

1548 
°
->
sûk_mode
.
LBRR_coded
, st->
mode
, &°->
b™dwidth
, 
equiv_øã
);

1549 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_LSB_DEPTH
(
lsb_dïth
));

1552 i‡(
°
->
mode
 =
MODE_CELT_ONLY
 && st->
b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
)

1553 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1554 i‡(
°
->
l„
)

1555 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

1557 
cuº_b™dwidth
 = 
°
->
b™dwidth
;

1561 i‡(
°
->
mode
 =
MODE_SILK_ONLY
 && 
cuº_b™dwidth
 > 
OPUS_BANDWIDTH_WIDEBAND
)

1562 
°
->
mode
 = 
MODE_HYBRID
;

1563 i‡(
°
->
mode
 =
MODE_HYBRID
 && 
cuº_b™dwidth
 <
OPUS_BANDWIDTH_WIDEBAND
)

1564 
°
->
mode
 = 
MODE_SILK_ONLY
;

1567 i‡((
‰ame_size
 > 
°
->
Fs
/50 && (°->
mode
 !
MODE_SILK_ONLY
)) || frame_size > 3*st->Fs/50)

1569 
íc_‰ame_size
;

1570 
nb_‰ames
;

1572 i‡(
°
->
mode
 =
MODE_SILK_ONLY
)

1574 i‡(
‰ame_size
 =2*
°
->
Fs
/25)

1575 
íc_‰ame_size
 = 
°
->
Fs
/25;

1576 i‡(
‰ame_size
 =3*
°
->
Fs
/25)

1577 
íc_‰ame_size
 = 3*
°
->
Fs
/50;

1579 
íc_‰ame_size
 = 
°
->
Fs
/50;

1582 
íc_‰ame_size
 = 
°
->
Fs
/50;

1584 
nb_‰ames
 = 
‰ame_size
/
íc_‰ame_size
;

1586 #i‚de‡
DISABLE_FLOAT_API


1587 i‡(
™Æysis_ªad_pos_bak
!= -1)

1589 
°
->
™Æysis
.
ªad_pos
 = 
™Æysis_ªad_pos_bak
;

1590 
°
->
™Æysis
.
ªad_sub‰ame
 = 
™Æysis_ªad_sub‰ame_bak
;

1594 
ªt
 = 
	`ícode_mu…i‰ame_∑ckë
(
°
, 
pcm
, 
nb_‰ames
, 
íc_‰ame_size
, 
d©a
,

1595 
out_d©a_byãs
, 
to_˚…
, 
lsb_dïth
, 
Êﬂt_≠i
);

1597 
RESTORE_STACK
;

1598  
ªt
;

1602 i‡(
°
->
sûk_bw_swôch
)

1604 
ªdund™cy
 = 1;

1605 
˚…_to_sûk
 = 1;

1606 
°
->
sûk_bw_swôch
 = 0;

1608 
¥efûl
=2;

1613 i‡(
°
->
mode
 =
MODE_CELT_ONLY
)

1614 
ªdund™cy
 = 0;

1616 i‡(
ªdund™cy
)

1618 
ªdund™cy_byãs
 = 
	`compuã_ªdund™cy_byãs
(
max_d©a_byãs
, 
°
->
bôøã_bps
, 
‰ame_øã
, st->
°ªam_ch™√ls
);

1619 i‡(
ªdund™cy_byãs
 == 0)

1620 
ªdund™cy
 = 0;

1624 
byãs_èrgë
 = 
	`IMIN
(
max_d©a_byãs
-
ªdund™cy_byãs
, 
°
->
bôøã_bps
 * 
‰ame_size
 / (°->
Fs
 * 8)) - 1;

1626 
d©a
 += 1;

1628 
	`ec_íc_öô
(&
íc
, 
d©a
, 
max_d©a_byãs
-1);

1630 
	`ALLOC
(
pcm_buf
, (
tŸÆ_buf„r
+
‰ame_size
)*
°
->
ch™√ls
, 
›us_vÆ16
);

1631 
	`OPUS_COPY
(
pcm_buf
, &
°
->
dñay_buf„r
[(°->
ícodî_buf„r
-
tŸÆ_buf„r
)*°->
ch™√ls
],Åotal_buffer*st->channels);

1633 i‡(
°
->
mode
 =
MODE_CELT_ONLY
)

1634 
hp_‰eq_smth1
 = 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
VARIABLE_HP_MIN_CUTOFF_HZ
 ), 8 );

1636 
hp_‰eq_smth1
 = ((
sûk_ícodî
*)
sûk_íc
)->
°©e_Fxx
[0].
sCmn
.
v¨übÀ_HP_smth1_Q15
;

1638 
°
->
v¨übÀ_HP_smth2_Q15
 = 
	`sûk_SMLAWB
( st->variable_HP_smth2_Q15,

1639 
hp_‰eq_smth1
 - 
°
->
v¨übÀ_HP_smth2_Q15
, 
	`SILK_FIX_CONST
–
VARIABLE_HP_SMTH_COEF2
, 16 ) );

1642 
cutoff_Hz
 = 
	`sûk_log2lö
–
	`sûk_RSHIFT
–
°
->
v¨übÀ_HP_smth2_Q15
, 8 ) );

1644 i‡(
°
->
≠∂iˇti⁄
 =
OPUS_APPLICATION_VOIP
)

1646 
	`hp_cutoff
(
pcm
, 
cutoff_Hz
, &
pcm_buf
[
tŸÆ_buf„r
*
°
->
ch™√ls
], st->
hp_mem
, 
‰ame_size
, st->ch™√ls, st->
Fs
, st->
¨ch
);

1648 
	`dc_ªje˘
(
pcm
, 3, &
pcm_buf
[
tŸÆ_buf„r
*
°
->
ch™√ls
], st->
hp_mem
, 
‰ame_size
, st->ch™√ls, st->
Fs
);

1650 #i‚de‡
FIXED_POINT


1651 i‡(
Êﬂt_≠i
)

1653 
›us_vÆ32
 
sum
;

1654 
sum
 = 
	`˚…_ö√r_¥od
(&
pcm_buf
[
tŸÆ_buf„r
*
°
->
ch™√ls
], &pcm_buf[tŸÆ_buf„r*°->ch™√ls], 
‰ame_size
*°->ch™√ls, st->
¨ch
);

1657 i‡(!(
sum
 < 1e9fË|| 
	`˚…_i¢™
(sum))

1659 
	`OPUS_CLEAR
(&
pcm_buf
[
tŸÆ_buf„r
*
°
->
ch™√ls
], 
‰ame_size
*st->channels);

1660 
°
->
hp_mem
[0] = st->hp_mem[1] = st->hp_mem[2] = st->hp_mem[3] = 0;

1667 
HB_gaö
 = 
Q15ONE
;

1668 i‡(
°
->
mode
 !
MODE_CELT_ONLY
)

1670 
›us_öt32
 
tŸÆ_bôR©e
, 
˚…_øã
;

1671 
›us_öt
 
a˘ivôy
;

1672 #ifde‡
FIXED_POINT


1673 c⁄° 
›us_öt16
 *
pcm_sûk
;

1675 
	`VARDECL
(
›us_öt16
, 
pcm_sûk
);

1676 
	`ALLOC
(
pcm_sûk
, 
°
->
ch™√ls
*
‰ame_size
, 
›us_öt16
);

1679 
a˘ivôy
 = 
VAD_NO_DECISION
;

1680 #i‚de‡
DISABLE_FLOAT_API


1681 if–
™Æysis_öfo
.
vÆid
 ) {

1683 
a˘ivôy
 = ( 
™Æysis_öfo
.
a˘ivôy_¥obabûôy
 >
DTX_ACTIVITY_THRESHOLD
 );

1688 
tŸÆ_bôR©e
 = 8 * 
byãs_èrgë
 * 
‰ame_øã
;

1689 if–
°
->
mode
 =
MODE_HYBRID
 ) {

1691 
°
->
sûk_mode
.
bôR©e
 = 
	`compuã_sûk_øã_f‹_hybrid
(
tŸÆ_bôR©e
,

1692 
cuº_b™dwidth
, 
°
->
Fs
 =50 * 
‰ame_size
, st->
u£_vbr
, st->
sûk_mode
.
LBRR_coded
,

1693 
°
->
°ªam_ch™√ls
);

1694 i‡(!
°
->
íîgy_maskög
)

1697 
˚…_øã
 = 
tŸÆ_bôR©e
 - 
°
->
sûk_mode
.
bôR©e
;

1698 
HB_gaö
 = 
Q15ONE
 - 
	`SHR32
(
	`˚…_exp2
(-
˚…_øã
 * 
	`QCONST16
(1.f/1024, 10)), 1);

1702 
°
->
sûk_mode
.
bôR©e
 = 
tŸÆ_bôR©e
;

1706 i‡(
°
->
íîgy_maskög
 && st->
u£_vbr
 && !°->
l„
)

1708 
›us_vÆ32
 
mask_sum
=0;

1709 
›us_vÆ16
 
maskög_dïth
;

1710 
›us_öt32
 
øã_off£t
;

1711 
c
;

1712 
íd
 = 17;

1713 
›us_öt16
 
§©e
 = 16000;

1714 i‡(
°
->
b™dwidth
 =
OPUS_BANDWIDTH_NARROWBAND
)

1716 
íd
 = 13;

1717 
§©e
 = 8000;

1718 } i‡(
°
->
b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
)

1720 
íd
 = 15;

1721 
§©e
 = 12000;

1723 
c
=0;c<
°
->
ch™√ls
;c++)

1725 
i
=0;i<
íd
;i++)

1727 
›us_vÆ16
 
mask
;

1728 
mask
 = 
	`MAX16
(
	`MIN16
(
°
->
íîgy_maskög
[21*
c
+
i
],

1729 
	`QCONST16
(.5f, 
DB_SHIFT
)), -QCONST16(2.0f, DB_SHIFT));

1730 i‡(
mask
 > 0)

1731 
mask
 = 
	`HALF16
(mask);

1732 
mask_sum
 +
mask
;

1736 
maskög_dïth
 = 
mask_sum
 / 
íd
*
°
->
ch™√ls
;

1737 
maskög_dïth
 +
	`QCONST16
(.2f, 
DB_SHIFT
);

1738 
øã_off£t
 = (
›us_öt32
)
	`PSHR32
(
	`MULT16_16
(
§©e
, 
maskög_dïth
), 
DB_SHIFT
);

1739 
øã_off£t
 = 
	`MAX32
‘©e_off£t, -2*
°
->
sûk_mode
.
bôR©e
/3);

1741 i‡(
°
->
b™dwidth
==
OPUS_BANDWIDTH_SUPERWIDEBAND
 || st->b™dwidth==
OPUS_BANDWIDTH_FULLBAND
)

1742 
°
->
sûk_mode
.
bôR©e
 +3*
øã_off£t
/5;

1744 
°
->
sûk_mode
.
bôR©e
 +
øã_off£t
;

1747 
°
->
sûk_mode
.
∑ylﬂdSize_ms
 = 1000 * 
‰ame_size
 / st->
Fs
;

1748 
°
->
sûk_mode
.
nCh™√lsAPI
 = st->
ch™√ls
;

1749 
°
->
sûk_mode
.
nCh™√lsI¡î«l
 = st->
°ªam_ch™√ls
;

1750 i‡(
cuº_b™dwidth
 =
OPUS_BANDWIDTH_NARROWBAND
) {

1751 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 8000;

1752 } i‡(
cuº_b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
) {

1753 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 12000;

1755 
	`˚…_as£π
–
°
->
mode
 =
MODE_HYBRID
 || 
cuº_b™dwidth
 =
OPUS_BANDWIDTH_WIDEBAND
 );

1756 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 16000;

1758 if–
°
->
mode
 =
MODE_HYBRID
 ) {

1760 
°
->
sûk_mode
.
möI¡î«lSam∂eR©e
 = 16000;

1762 
°
->
sûk_mode
.
möI¡î«lSam∂eR©e
 = 8000;

1765 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 16000;

1766 i‡(
°
->
mode
 =
MODE_SILK_ONLY
)

1768 
›us_öt32
 
ef„˘ive_max_øã
 = 
max_øã
;

1769 i‡(
‰ame_øã
 > 50)

1770 
ef„˘ive_max_øã
 =Éffective_max_rate*2/3;

1771 i‡(
ef„˘ive_max_øã
 < 8000)

1773 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 12000;

1774 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 
	`IMIN
(12000, st->silk_mode.desiredInternalSampleRate);

1776 i‡(
ef„˘ive_max_øã
 < 7000)

1778 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 8000;

1779 
°
->
sûk_mode
.
desúedI¡î«lSam∂eR©e
 = 
	`IMIN
(8000, st->silk_mode.desiredInternalSampleRate);

1783 
°
->
sûk_mode
.
u£CBR
 = !°->
u£_vbr
;

1788 
°
->
sûk_mode
.
maxBôs
 = (
max_d©a_byãs
-1)*8;

1789 i‡(
ªdund™cy
 && 
ªdund™cy_byãs
 >= 2)

1792 
°
->
sûk_mode
.
maxBôs
 -
ªdund™cy_byãs
*8 + 1;

1793 i‡(
°
->
mode
 =
MODE_HYBRID
)

1794 
°
->
sûk_mode
.
maxBôs
 -= 20;

1796 i‡(
°
->
sûk_mode
.
u£CBR
)

1798 i‡(
°
->
mode
 =
MODE_HYBRID
)

1800 
°
->
sûk_mode
.
maxBôs
 = 
	`IMIN
(°->sûk_mode.maxBôs, st->sûk_mode.
bôR©e
 * 
‰ame_size
 / st->
Fs
);

1804 i‡(
°
->
mode
 =
MODE_HYBRID
)

1807 
›us_öt32
 
maxBôR©e
 = 
	`compuã_sûk_øã_f‹_hybrid
(
°
->
sûk_mode
.
maxBôs
*°->
Fs
 / 
‰ame_size
,

1808 
cuº_b™dwidth
, 
°
->
Fs
 =50 * 
‰ame_size
, st->
u£_vbr
, st->
sûk_mode
.
LBRR_coded
,

1809 
°
->
°ªam_ch™√ls
);

1810 
°
->
sûk_mode
.
maxBôs
 = 
maxBôR©e
 * 
‰ame_size
 / st->
Fs
;

1814 i‡(
¥efûl
)

1816 
›us_öt32
 
zîo
=0;

1817 
¥efûl_off£t
;

1824 
¥efûl_off£t
 = 
°
->
ch™√ls
*(°->
ícodî_buf„r
-°->
dñay_com≥nßti⁄
-°->
Fs
/400);

1825 
	`gaö_Áde
(
°
->
dñay_buf„r
+
¥efûl_off£t
, st->delay_buffer+prefill_offset,

1826 0, 
Q15ONE
, 
˚…_mode
->
ovîœp
, 
°
->
Fs
/400, st->
ch™√ls
, cñt_mode->
wödow
, st->Fs);

1827 
	`OPUS_CLEAR
(
°
->
dñay_buf„r
, 
¥efûl_off£t
);

1828 #ifde‡
FIXED_POINT


1829 
pcm_sûk
 = 
°
->
dñay_buf„r
;

1831 
i
=0;i<
°
->
ícodî_buf„r
*°->
ch™√ls
;i++)

1832 
pcm_sûk
[
i
] = 
	`FLOAT2INT16
(
°
->
dñay_buf„r
[i]);

1834 
	`sûk_Encode
–
sûk_íc
, &
°
->
sûk_mode
, 
pcm_sûk
, st->
ícodî_buf„r
, 
NULL
, &
zîo
, 
¥efûl
, 
a˘ivôy
 );

1836 
°
->
sûk_mode
.
›usC™Swôch
 = 0;

1839 #ifde‡
FIXED_POINT


1840 
pcm_sûk
 = 
pcm_buf
+
tŸÆ_buf„r
*
°
->
ch™√ls
;

1842 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

1843 
pcm_sûk
[
i
] = 
	`FLOAT2INT16
(
pcm_buf
[
tŸÆ_buf„r
*
°
->
ch™√ls
 + i]);

1845 
ªt
 = 
	`sûk_Encode
–
sûk_íc
, &
°
->
sûk_mode
, 
pcm_sûk
, 
‰ame_size
, &
íc
, &
nByãs
, 0, 
a˘ivôy
 );

1846 if–
ªt
 ) {

1849 
RESTORE_STACK
;

1850  
OPUS_INTERNAL_ERROR
;

1854 if–
°
->
mode
 =
MODE_SILK_ONLY
 ) {

1855 if–
°
->
sûk_mode
.
öã∫ÆSam∂eR©e
 == 8000 ) {

1856 
cuº_b™dwidth
 = 
OPUS_BANDWIDTH_NARROWBAND
;

1857 } if–
°
->
sûk_mode
.
öã∫ÆSam∂eR©e
 == 12000 ) {

1858 
cuº_b™dwidth
 = 
OPUS_BANDWIDTH_MEDIUMBAND
;

1859 } if–
°
->
sûk_mode
.
öã∫ÆSam∂eR©e
 == 16000 ) {

1860 
cuº_b™dwidth
 = 
OPUS_BANDWIDTH_WIDEBAND
;

1863 
	`˚…_as£π
–
°
->
sûk_mode
.
öã∫ÆSam∂eR©e
 == 16000 );

1866 
°
->
sûk_mode
.
›usC™Swôch
 = st->sûk_mode.
swôchRódy
 && !°->
n⁄föÆ_‰ame
;

1868 i‡(
nByãs
==0)

1870 
°
->
øngeFöÆ
 = 0;

1871 
d©a
[-1] = 
	`gí_toc
(
°
->
mode
, st->
Fs
/
‰ame_size
, 
cuº_b™dwidth
, st->
°ªam_ch™√ls
);

1872 
RESTORE_STACK
;

1877 i‡(
°
->
sûk_mode
.
›usC™Swôch
)

1879 
ªdund™cy_byãs
 = 
	`compuã_ªdund™cy_byãs
(
max_d©a_byãs
, 
°
->
bôøã_bps
, 
‰ame_øã
, st->
°ªam_ch™√ls
);

1880 
ªdund™cy
 = (
ªdund™cy_byãs
 != 0);

1881 
˚…_to_sûk
 = 0;

1882 
°
->
sûk_bw_swôch
 = 1;

1888 
ídb™d
=21;

1890 
cuº_b™dwidth
)

1892 
OPUS_BANDWIDTH_NARROWBAND
:

1893 
ídb™d
 = 13;

1895 
OPUS_BANDWIDTH_MEDIUMBAND
:

1896 
OPUS_BANDWIDTH_WIDEBAND
:

1897 
ídb™d
 = 17;

1899 
OPUS_BANDWIDTH_SUPERWIDEBAND
:

1900 
ídb™d
 = 19;

1902 
OPUS_BANDWIDTH_FULLBAND
:

1903 
ídb™d
 = 21;

1906 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_END_BAND
(
ídb™d
));

1907 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_CHANNELS
(
°
->
°ªam_ch™√ls
));

1909 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
OPUS_BITRATE_MAX
));

1910 i‡(
°
->
mode
 !
MODE_SILK_ONLY
)

1912 
›us_vÆ32
 
˚…_¥ed
=2;

1913 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR
(0));

1915 i‡(
°
->
sûk_mode
.
ªdu˚dDïídícy
)

1916 
˚…_¥ed
 = 0;

1917 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_PREDICTION
(
˚…_¥ed
));

1919 i‡(
°
->
mode
 =
MODE_HYBRID
)

1921 if–
°
->
u£_vbr
 ) {

1922 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
°
->
bôøã_bps
-°->
sûk_mode
.
bôR©e
));

1923 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(0));

1926 i‡(
°
->
u£_vbr
)

1928 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR
(1));

1929 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
°
->
vbr_c⁄°øöt
));

1930 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
°
->
bôøã_bps
));

1935 
	`ALLOC
(
tmp_¥efûl
, 
°
->
ch™√ls
*°->
Fs
/400, 
›us_vÆ16
);

1936 i‡(
°
->
mode
 !
MODE_SILK_ONLY
 && st->modê!°->
¥ev_mode
 && st->prev_mode > 0)

1938 
	`OPUS_COPY
(
tmp_¥efûl
, &
°
->
dñay_buf„r
[(°->
ícodî_buf„r
-
tŸÆ_buf„r
-°->
Fs
/400)*°->
ch™√ls
], st->channels*st->Fs/400);

1941 i‡(
°
->
ch™√ls
*(°->
ícodî_buf„r
-(
‰ame_size
+
tŸÆ_buf„r
)) > 0)

1943 
	`OPUS_MOVE
(
°
->
dñay_buf„r
, &°->dñay_buf„r[°->
ch™√ls
*
‰ame_size
], st->ch™√ls*(°->
ícodî_buf„r
-‰ame_size-
tŸÆ_buf„r
));

1944 
	`OPUS_COPY
(&
°
->
dñay_buf„r
[°->
ch™√ls
*(°->
ícodî_buf„r
-
‰ame_size
-
tŸÆ_buf„r
)],

1945 &
pcm_buf
[0],

1946 (
‰ame_size
+
tŸÆ_buf„r
)*
°
->
ch™√ls
);

1948 
	`OPUS_COPY
(
°
->
dñay_buf„r
, &
pcm_buf
[(
‰ame_size
+
tŸÆ_buf„r
-°->
ícodî_buf„r
)*°->
ch™√ls
], st->encoder_buffer*st->channels);

1952 if–
°
->
¥ev_HB_gaö
 < 
Q15ONE
 || 
HB_gaö
 < Q15ONE ) {

1953 
	`gaö_Áde
(
pcm_buf
,Öcm_buf,

1954 
°
->
¥ev_HB_gaö
, 
HB_gaö
, 
˚…_mode
->
ovîœp
, 
‰ame_size
, st->
ch™√ls
, cñt_mode->
wödow
, st->
Fs
);

1956 
°
->
¥ev_HB_gaö
 = 
HB_gaö
;

1957 i‡(
°
->
mode
 !
MODE_HYBRID
 || st->
°ªam_ch™√ls
==1)

1959 i‡(
equiv_øã
 > 32000)

1960 
°
->
sûk_mode
.
°îeoWidth_Q14
 = 16384;

1961 i‡(
equiv_øã
 < 16000)

1962 
°
->
sûk_mode
.
°îeoWidth_Q14
 = 0;

1964 
°
->
sûk_mode
.
°îeoWidth_Q14
 = 16384 - 2048*(
›us_öt32
)(32000-
equiv_øã
)/(equiv_rate-14000);

1966 if–!
°
->
íîgy_maskög
 && st->
ch™√ls
 == 2 ) {

1968 if–
°
->
hybrid_°îeo_width_Q14
 < (1 << 14Ë|| st->
sûk_mode
.
°îeoWidth_Q14
 < (1 << 14) ) {

1969 
›us_vÆ16
 
g1
, 
g2
;

1970 
g1
 = 
°
->
hybrid_°îeo_width_Q14
;

1971 
g2
 = (
›us_vÆ16
)(
°
->
sûk_mode
.
°îeoWidth_Q14
);

1972 #ifde‡
FIXED_POINT


1973 
g1
 = g1==16384 ? 
Q15ONE
 : 
	`SHL16
(g1,1);

1974 
g2
 = g2==16384 ? 
Q15ONE
 : 
	`SHL16
(g2,1);

1976 
g1
 *= (1.f/16384);

1977 
g2
 *= (1.f/16384);

1979 
	`°îeo_Áde
(
pcm_buf
,Öcm_buf, 
g1
, 
g2
, 
˚…_mode
->
ovîœp
,

1980 
‰ame_size
, 
°
->
ch™√ls
, 
˚…_mode
->
wödow
, st->
Fs
);

1981 
°
->
hybrid_°îeo_width_Q14
 = st->
sûk_mode
.
°îeoWidth_Q14
;

1985 i‡–
°
->
mode
 !
MODE_CELT_ONLY
 && 
	`ec_ãŒ
(&
íc
)+17+20*(°->modê=
MODE_HYBRID
Ë<8*(
max_d©a_byãs
-1))

1988 i‡(
°
->
mode
 =
MODE_HYBRID
)

1989 
	`ec_íc_bô_logp
(&
íc
, 
ªdund™cy
, 12);

1990 i‡(
ªdund™cy
)

1992 
max_ªdund™cy
;

1993 
	`ec_íc_bô_logp
(&
íc
, 
˚…_to_sûk
, 1);

1994 i‡(
°
->
mode
 =
MODE_HYBRID
)

1998 
max_ªdund™cy
 = (
max_d©a_byãs
-1)-((
	`ec_ãŒ
(&
íc
)+8+3+7)>>3);

2001 
max_ªdund™cy
 = (
max_d©a_byãs
-1)-((
	`ec_ãŒ
(&
íc
)+7)>>3);

2004 
ªdund™cy_byãs
 = 
	`IMIN
(
max_ªdund™cy
,Ñedundancy_bytes);

2005 
ªdund™cy_byãs
 = 
	`IMIN
(257, 
	`IMAX
(2,Ñedundancy_bytes));

2006 i‡(
°
->
mode
 =
MODE_HYBRID
)

2007 
	`ec_íc_uöt
(&
íc
, 
ªdund™cy_byãs
-2, 256);

2010 
ªdund™cy
 = 0;

2013 i‡(!
ªdund™cy
)

2015 
°
->
sûk_bw_swôch
 = 0;

2016 
ªdund™cy_byãs
 = 0;

2018 i‡(
°
->
mode
 !
MODE_CELT_ONLY
)
°¨t_b™d
=17;

2020 i‡(
°
->
mode
 =
MODE_SILK_ONLY
)

2022 
ªt
 = (
	`ec_ãŒ
(&
íc
)+7)>>3;

2023 
	`ec_íc_d⁄e
(&
íc
);

2024 
nb_com¥_byãs
 = 
ªt
;

2026 
nb_com¥_byãs
 = (
max_d©a_byãs
-1)-
ªdund™cy_byãs
;

2027 
	`ec_íc_shrök
(&
íc
, 
nb_com¥_byãs
);

2030 #i‚de‡
DISABLE_FLOAT_API


2031 i‡(
ªdund™cy
 || 
°
->
mode
 !
MODE_SILK_ONLY
)

2032 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_ANALYSIS
(&
™Æysis_öfo
));

2034 i‡(
°
->
mode
 =
MODE_HYBRID
) {

2035 
SILKInfo
 
öfo
;

2036 
öfo
.
sig«lTy≥
 = 
°
->
sûk_mode
.signalType;

2037 
öfo
.
off£t
 = 
°
->
sûk_mode
.offset;

2038 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_SILK_INFO
(&
öfo
));

2042 i‡(
ªdund™cy
 && 
˚…_to_sûk
)

2044 
îr
;

2045 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_START_BAND
(0));

2046 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR
(0));

2047 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
OPUS_BITRATE_MAX
));

2048 
îr
 = 
	`˚…_ícode_wôh_ec
(
˚…_íc
, 
pcm_buf
, 
°
->
Fs
/200, 
d©a
+
nb_com¥_byãs
, 
ªdund™cy_byãs
, 
NULL
);

2049 i‡(
îr
 < 0)

2051 
RESTORE_STACK
;

2052  
OPUS_INTERNAL_ERROR
;

2054 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_GET_FINAL_RANGE
(&
ªdund™t_∫g
));

2055 
	`˚…_ícodî_˘l
(
˚…_íc
, 
OPUS_RESET_STATE
);

2058 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_START_BAND
(
°¨t_b™d
));

2060 i‡(
°
->
mode
 !
MODE_SILK_ONLY
)

2062 i‡(
°
->
mode
 !°->
¥ev_mode
 && st->prev_mode > 0)

2064 
dummy
[2];

2065 
	`˚…_ícodî_˘l
(
˚…_íc
, 
OPUS_RESET_STATE
);

2068 
	`˚…_ícode_wôh_ec
(
˚…_íc
, 
tmp_¥efûl
, 
°
->
Fs
/400, 
dummy
, 2, 
NULL
);

2069 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_PREDICTION
(0));

2072 i‡(
	`ec_ãŒ
(&
íc
Ë<8*
nb_com¥_byãs
)

2075 i‡(
ªdund™cy
 && 
˚…_to_sûk
 && 
°
->
mode
==
MODE_HYBRID
 && st->
u£_vbr
)

2076 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
°
->
bôøã_bps
-°->
sûk_mode
.
bôR©e
));

2077 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR
(
°
->
u£_vbr
));

2078 
ªt
 = 
	`˚…_ícode_wôh_ec
(
˚…_íc
, 
pcm_buf
, 
‰ame_size
, 
NULL
, 
nb_com¥_byãs
, &
íc
);

2079 i‡(
ªt
 < 0)

2081 
RESTORE_STACK
;

2082  
OPUS_INTERNAL_ERROR
;

2085 i‡(
ªdund™cy
 && 
˚…_to_sûk
 && 
°
->
mode
==
MODE_HYBRID
 && st->
u£_vbr
)

2087 
	`OPUS_MOVE
(
d©a
+
ªt
, d©a+
nb_com¥_byãs
, 
ªdund™cy_byãs
);

2088 
nb_com¥_byãs
 =Çb_com¥_byãs+
ªdund™cy_byãs
;

2094 i‡(
ªdund™cy
 && !
˚…_to_sûk
)

2096 
îr
;

2097 
dummy
[2];

2098 
N2
, 
N4
;

2099 
N2
 = 
°
->
Fs
/200;

2100 
N4
 = 
°
->
Fs
/400;

2102 
	`˚…_ícodî_˘l
(
˚…_íc
, 
OPUS_RESET_STATE
);

2103 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_START_BAND
(0));

2104 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_SET_PREDICTION
(0));

2105 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_VBR
(0));

2106 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_BITRATE
(
OPUS_BITRATE_MAX
));

2108 i‡(
°
->
mode
 =
MODE_HYBRID
)

2111 
nb_com¥_byãs
 = 
ªt
;

2112 
	`ec_íc_shrök
(&
íc
, 
nb_com¥_byãs
);

2115 
	`˚…_ícode_wôh_ec
(
˚…_íc
, 
pcm_buf
+
°
->
ch™√ls
*(
‰ame_size
-
N2
-
N4
), N4, 
dummy
, 2, 
NULL
);

2117 
îr
 = 
	`˚…_ícode_wôh_ec
(
˚…_íc
, 
pcm_buf
+
°
->
ch™√ls
*(
‰ame_size
-
N2
), N2, 
d©a
+
nb_com¥_byãs
, 
ªdund™cy_byãs
, 
NULL
);

2118 i‡(
îr
 < 0)

2120 
RESTORE_STACK
;

2121  
OPUS_INTERNAL_ERROR
;

2123 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_GET_FINAL_RANGE
(&
ªdund™t_∫g
));

2129 
d©a
--;

2130 
d©a
[0] = 
	`gí_toc
(
°
->
mode
, st->
Fs
/
‰ame_size
, 
cuº_b™dwidth
, st->
°ªam_ch™√ls
);

2132 
°
->
øngeFöÆ
 = 
íc
.
∫g
 ^ 
ªdund™t_∫g
;

2134 i‡(
to_˚…
)

2135 
°
->
¥ev_mode
 = 
MODE_CELT_ONLY
;

2137 
°
->
¥ev_mode
 = st->
mode
;

2138 
°
->
¥ev_ch™√ls
 = st->
°ªam_ch™√ls
;

2139 
°
->
¥ev_‰amesize
 = 
‰ame_size
;

2141 
°
->
fú°
 = 0;

2144 #i‚de‡
DISABLE_FLOAT_API


2145 i‡(
°
->
u£_dtx
 && (
™Æysis_öfo
.
vÆid
 || 
is_sûí˚
))

2147 i‡(
	`decide_dtx_mode
(
™Æysis_öfo
.
a˘ivôy_¥obabûôy
, &
°
->
nb_no_a˘ivôy_‰ames
,

2148 
°
->
≥ak_sig«l_íîgy
, 
pcm
, 
‰ame_size
, st->
ch™√ls
, 
is_sûí˚
, st->
¨ch
))

2150 
°
->
øngeFöÆ
 = 0;

2151 
d©a
[0] = 
	`gí_toc
(
°
->
mode
, st->
Fs
/
‰ame_size
, 
cuº_b™dwidth
, st->
°ªam_ch™√ls
);

2152 
RESTORE_STACK
;

2156 
°
->
nb_no_a˘ivôy_‰ames
 = 0;

2162 i‡(
	`ec_ãŒ
(&
íc
Ë> (
max_d©a_byãs
-1)*8)

2164 i‡(
max_d©a_byãs
 < 2)

2166 
RESTORE_STACK
;

2167  
OPUS_BUFFER_TOO_SMALL
;

2169 
d©a
[1] = 0;

2170 
ªt
 = 1;

2171 
°
->
øngeFöÆ
 = 0;

2172 } i‡(
°
->
mode
==
MODE_SILK_ONLY
&&!
ªdund™cy
)

2180 
ªt
>2&&
d©a
[ret]==0)ret--;

2183 
ªt
 +1+
ªdund™cy_byãs
;

2184 i‡(!
°
->
u£_vbr
)

2186 i‡(
	`›us_∑ckë_∑d
(
d©a
, 
ªt
, 
max_d©a_byãs
Ë!
OPUS_OK
)

2188 
RESTORE_STACK
;

2189  
OPUS_INTERNAL_ERROR
;

2191 
ªt
 = 
max_d©a_byãs
;

2193 
RESTORE_STACK
;

2194  
ªt
;

2195 
	}
}

2197 #ifde‡
FIXED_POINT


2199 #i‚de‡
DISABLE_FLOAT_API


2200 
›us_öt32
 
	$›us_ícode_Êﬂt
(
OpusEncodî
 *
°
, c⁄° *
pcm
, 
™Æysis_‰ame_size
,

2201 *
d©a
, 
›us_öt32
 
max_d©a_byãs
)

2203 
i
, 
ªt
;

2204 
‰ame_size
;

2205 
	`VARDECL
(
›us_öt16
, 
ö
);

2206 
ALLOC_STACK
;

2208 
‰ame_size
 = 
	`‰ame_size_£À˘
(
™Æysis_‰ame_size
, 
°
->
v¨übÀ_duøti⁄
, st->
Fs
);

2209 i‡(
‰ame_size
 <= 0)

2211 
RESTORE_STACK
;

2212  
OPUS_BAD_ARG
;

2214 
	`ALLOC
(
ö
, 
‰ame_size
*
°
->
ch™√ls
, 
›us_öt16
);

2216 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

2217 
ö
[
i
] = 
	`FLOAT2INT16
(
pcm
[i]);

2218 
ªt
 = 
	`›us_ícode_«tive
(
°
, 
ö
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 16,

2219 
pcm
, 
™Æysis_‰ame_size
, 0, -2, 
°
->
ch™√ls
, 
downmix_Êﬂt
, 1);

2220 
RESTORE_STACK
;

2221  
ªt
;

2222 
	}
}

2225 
›us_öt32
 
	$›us_ícode
(
OpusEncodî
 *
°
, c⁄° 
›us_öt16
 *
pcm
, 
™Æysis_‰ame_size
,

2226 *
d©a
, 
›us_öt32
 
out_d©a_byãs
)

2228 
‰ame_size
;

2229 
‰ame_size
 = 
	`‰ame_size_£À˘
(
™Æysis_‰ame_size
, 
°
->
v¨übÀ_duøti⁄
, st->
Fs
);

2230  
	`›us_ícode_«tive
(
°
, 
pcm
, 
‰ame_size
, 
d©a
, 
out_d©a_byãs
, 16,

2231 
pcm
, 
™Æysis_‰ame_size
, 0, -2, 
°
->
ch™√ls
, 
downmix_öt
, 0);

2232 
	}
}

2235 
›us_öt32
 
	$›us_ícode
(
OpusEncodî
 *
°
, c⁄° 
›us_öt16
 *
pcm
, 
™Æysis_‰ame_size
,

2236 *
d©a
, 
›us_öt32
 
max_d©a_byãs
)

2238 
i
, 
ªt
;

2239 
‰ame_size
;

2240 
	`VARDECL
(, 
ö
);

2241 
ALLOC_STACK
;

2243 
‰ame_size
 = 
	`‰ame_size_£À˘
(
™Æysis_‰ame_size
, 
°
->
v¨übÀ_duøti⁄
, st->
Fs
);

2244 i‡(
‰ame_size
 <= 0)

2246 
RESTORE_STACK
;

2247  
OPUS_BAD_ARG
;

2249 
	`ALLOC
(
ö
, 
‰ame_size
*
°
->
ch™√ls
, );

2251 
i
=0;i<
‰ame_size
*
°
->
ch™√ls
;i++)

2252 
ö
[
i
] = (1.0f/32768)*
pcm
[i];

2253 
ªt
 = 
	`›us_ícode_«tive
(
°
, 
ö
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 16,

2254 
pcm
, 
™Æysis_‰ame_size
, 0, -2, 
°
->
ch™√ls
, 
downmix_öt
, 0);

2255 
RESTORE_STACK
;

2256  
ªt
;

2257 
	}
}

2258 
›us_öt32
 
	$›us_ícode_Êﬂt
(
OpusEncodî
 *
°
, c⁄° *
pcm
, 
™Æysis_‰ame_size
,

2259 *
d©a
, 
›us_öt32
 
out_d©a_byãs
)

2261 
‰ame_size
;

2262 
‰ame_size
 = 
	`‰ame_size_£À˘
(
™Æysis_‰ame_size
, 
°
->
v¨übÀ_duøti⁄
, st->
Fs
);

2263  
	`›us_ícode_«tive
(
°
, 
pcm
, 
‰ame_size
, 
d©a
, 
out_d©a_byãs
, 24,

2264 
pcm
, 
™Æysis_‰ame_size
, 0, -2, 
°
->
ch™√ls
, 
downmix_Êﬂt
, 1);

2265 
	}
}

2269 
	$›us_ícodî_˘l
(
OpusEncodî
 *
°
, 
ªque°
, ...)

2271 
ªt
;

2272 
CELTEncodî
 *
˚…_íc
;

2273 
va_li°
 
≠
;

2275 
ªt
 = 
OPUS_OK
;

2276 
	`va_°¨t
(
≠
, 
ªque°
);

2278 
˚…_íc
 = (
CELTEncodî
*)((*)
°
+°->
˚…_íc_off£t
);

2280 
ªque°
)

2282 
OPUS_SET_APPLICATION_REQUEST
:

2284 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2285 i‡–(
vÆue
 !
OPUS_APPLICATION_VOIP
 && vÆuê!
OPUS_APPLICATION_AUDIO


2286 && 
vÆue
 !
OPUS_APPLICATION_RESTRICTED_LOWDELAY
)

2287 || (!
°
->
fú°
 && st->
≠∂iˇti⁄
 !
vÆue
))

2289 
ªt
 = 
OPUS_BAD_ARG
;

2292 
°
->
≠∂iˇti⁄
 = 
vÆue
;

2293 #i‚de‡
DISABLE_FLOAT_API


2294 
°
->
™Æysis
.
≠∂iˇti⁄
 = 
vÆue
;

2298 
OPUS_GET_APPLICATION_REQUEST
:

2300 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2301 i‡(!
vÆue
)

2303 
bad_¨g
;

2305 *
vÆue
 = 
°
->
≠∂iˇti⁄
;

2308 
OPUS_SET_BITRATE_REQUEST
:

2310 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2311 i‡(
vÆue
 !
OPUS_AUTO
 && vÆuê!
OPUS_BITRATE_MAX
)

2313 i‡(
vÆue
 <= 0)

2314 
bad_¨g
;

2315 i‡(
vÆue
 <= 500)

2316 
vÆue
 = 500;

2317 i‡(
vÆue
 > (
›us_öt32
)300000*
°
->
ch™√ls
)

2318 
vÆue
 = (
›us_öt32
)300000*
°
->
ch™√ls
;

2320 
°
->
u£r_bôøã_bps
 = 
vÆue
;

2323 
OPUS_GET_BITRATE_REQUEST
:

2325 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2326 i‡(!
vÆue
)

2328 
bad_¨g
;

2330 *
vÆue
 = 
	`u£r_bôøã_to_bôøã
(
°
, st->
¥ev_‰amesize
, 1276);

2333 
OPUS_SET_FORCE_CHANNELS_REQUEST
:

2335 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2336 if((
vÆue
<1 || vÆue>
°
->
ch™√ls
Ë&& vÆuê!
OPUS_AUTO
)

2338 
bad_¨g
;

2340 
°
->
f‹˚_ch™√ls
 = 
vÆue
;

2343 
OPUS_GET_FORCE_CHANNELS_REQUEST
:

2345 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2346 i‡(!
vÆue
)

2348 
bad_¨g
;

2350 *
vÆue
 = 
°
->
f‹˚_ch™√ls
;

2353 
OPUS_SET_MAX_BANDWIDTH_REQUEST
:

2355 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2356 i‡(
vÆue
 < 
OPUS_BANDWIDTH_NARROWBAND
 || vÆuê> 
OPUS_BANDWIDTH_FULLBAND
)

2358 
bad_¨g
;

2360 
°
->
max_b™dwidth
 = 
vÆue
;

2361 i‡(
°
->
max_b™dwidth
 =
OPUS_BANDWIDTH_NARROWBAND
) {

2362 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 8000;

2363 } i‡(
°
->
max_b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
) {

2364 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 12000;

2366 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 16000;

2370 
OPUS_GET_MAX_BANDWIDTH_REQUEST
:

2372 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2373 i‡(!
vÆue
)

2375 
bad_¨g
;

2377 *
vÆue
 = 
°
->
max_b™dwidth
;

2380 
OPUS_SET_BANDWIDTH_REQUEST
:

2382 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2383 i‡((
vÆue
 < 
OPUS_BANDWIDTH_NARROWBAND
 || vÆuê> 
OPUS_BANDWIDTH_FULLBAND
Ë&& vÆuê!
OPUS_AUTO
)

2385 
bad_¨g
;

2387 
°
->
u£r_b™dwidth
 = 
vÆue
;

2388 i‡(
°
->
u£r_b™dwidth
 =
OPUS_BANDWIDTH_NARROWBAND
) {

2389 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 8000;

2390 } i‡(
°
->
u£r_b™dwidth
 =
OPUS_BANDWIDTH_MEDIUMBAND
) {

2391 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 12000;

2393 
°
->
sûk_mode
.
maxI¡î«lSam∂eR©e
 = 16000;

2397 
OPUS_GET_BANDWIDTH_REQUEST
:

2399 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2400 i‡(!
vÆue
)

2402 
bad_¨g
;

2404 *
vÆue
 = 
°
->
b™dwidth
;

2407 
OPUS_SET_DTX_REQUEST
:

2409 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2410 if(
vÆue
<0 || value>1)

2412 
bad_¨g
;

2414 
°
->
u£_dtx
 = 
vÆue
;

2417 
OPUS_GET_DTX_REQUEST
:

2419 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2420 i‡(!
vÆue
)

2422 
bad_¨g
;

2424 *
vÆue
 = 
°
->
u£_dtx
;

2427 
OPUS_SET_COMPLEXITY_REQUEST
:

2429 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2430 if(
vÆue
<0 || value>10)

2432 
bad_¨g
;

2434 
°
->
sûk_mode
.
com∂exôy
 = 
vÆue
;

2435 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_COMPLEXITY
(
vÆue
));

2438 
OPUS_GET_COMPLEXITY_REQUEST
:

2440 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2441 i‡(!
vÆue
)

2443 
bad_¨g
;

2445 *
vÆue
 = 
°
->
sûk_mode
.
com∂exôy
;

2448 
OPUS_SET_INBAND_FEC_REQUEST
:

2450 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2451 if(
vÆue
<0 || value>1)

2453 
bad_¨g
;

2455 
°
->
sûk_mode
.
u£InB™dFEC
 = 
vÆue
;

2458 
OPUS_GET_INBAND_FEC_REQUEST
:

2460 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2461 i‡(!
vÆue
)

2463 
bad_¨g
;

2465 *
vÆue
 = 
°
->
sûk_mode
.
u£InB™dFEC
;

2468 
OPUS_SET_PACKET_LOSS_PERC_REQUEST
:

2470 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2471 i‡(
vÆue
 < 0 || value > 100)

2473 
bad_¨g
;

2475 
°
->
sûk_mode
.
∑ckëLossPî˚¡age
 = 
vÆue
;

2476 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(
vÆue
));

2479 
OPUS_GET_PACKET_LOSS_PERC_REQUEST
:

2481 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2482 i‡(!
vÆue
)

2484 
bad_¨g
;

2486 *
vÆue
 = 
°
->
sûk_mode
.
∑ckëLossPî˚¡age
;

2489 
OPUS_SET_VBR_REQUEST
:

2491 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2492 if(
vÆue
<0 || value>1)

2494 
bad_¨g
;

2496 
°
->
u£_vbr
 = 
vÆue
;

2497 
°
->
sûk_mode
.
u£CBR
 = 1-
vÆue
;

2500 
OPUS_GET_VBR_REQUEST
:

2502 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2503 i‡(!
vÆue
)

2505 
bad_¨g
;

2507 *
vÆue
 = 
°
->
u£_vbr
;

2510 
OPUS_SET_VOICE_RATIO_REQUEST
:

2512 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2513 i‡(
vÆue
<-1 || value>100)

2515 
bad_¨g
;

2517 
°
->
voi˚_øtio
 = 
vÆue
;

2520 
OPUS_GET_VOICE_RATIO_REQUEST
:

2522 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2523 i‡(!
vÆue
)

2525 
bad_¨g
;

2527 *
vÆue
 = 
°
->
voi˚_øtio
;

2530 
OPUS_SET_VBR_CONSTRAINT_REQUEST
:

2532 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2533 if(
vÆue
<0 || value>1)

2535 
bad_¨g
;

2537 
°
->
vbr_c⁄°øöt
 = 
vÆue
;

2540 
OPUS_GET_VBR_CONSTRAINT_REQUEST
:

2542 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2543 i‡(!
vÆue
)

2545 
bad_¨g
;

2547 *
vÆue
 = 
°
->
vbr_c⁄°øöt
;

2550 
OPUS_SET_SIGNAL_REQUEST
:

2552 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2553 if(
vÆue
!=
OPUS_AUTO
 && vÆue!=
OPUS_SIGNAL_VOICE
 && vÆue!=
OPUS_SIGNAL_MUSIC
)

2555 
bad_¨g
;

2557 
°
->
sig«l_ty≥
 = 
vÆue
;

2560 
OPUS_GET_SIGNAL_REQUEST
:

2562 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2563 i‡(!
vÆue
)

2565 
bad_¨g
;

2567 *
vÆue
 = 
°
->
sig«l_ty≥
;

2570 
OPUS_GET_LOOKAHEAD_REQUEST
:

2572 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2573 i‡(!
vÆue
)

2575 
bad_¨g
;

2577 *
vÆue
 = 
°
->
Fs
/400;

2578 i‡(
°
->
≠∂iˇti⁄
 !
OPUS_APPLICATION_RESTRICTED_LOWDELAY
)

2579 *
vÆue
 +
°
->
dñay_com≥nßti⁄
;

2582 
OPUS_GET_SAMPLE_RATE_REQUEST
:

2584 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2585 i‡(!
vÆue
)

2587 
bad_¨g
;

2589 *
vÆue
 = 
°
->
Fs
;

2592 
OPUS_GET_FINAL_RANGE_REQUEST
:

2594 
›us_uöt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32*);

2595 i‡(!
vÆue
)

2597 
bad_¨g
;

2599 *
vÆue
 = 
°
->
øngeFöÆ
;

2602 
OPUS_SET_LSB_DEPTH_REQUEST
:

2604 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2605 i‡(
vÆue
<8 || value>24)

2607 
bad_¨g
;

2609 
°
->
lsb_dïth
=
vÆue
;

2612 
OPUS_GET_LSB_DEPTH_REQUEST
:

2614 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2615 i‡(!
vÆue
)

2617 
bad_¨g
;

2619 *
vÆue
 = 
°
->
lsb_dïth
;

2622 
OPUS_SET_EXPERT_FRAME_DURATION_REQUEST
:

2624 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2625 i‡(
vÆue
 !
OPUS_FRAMESIZE_ARG
 && vÆuê!
OPUS_FRAMESIZE_2_5_MS
 &&

2626 
vÆue
 !
OPUS_FRAMESIZE_5_MS
 && vÆuê!
OPUS_FRAMESIZE_10_MS
 &&

2627 
vÆue
 !
OPUS_FRAMESIZE_20_MS
 && vÆuê!
OPUS_FRAMESIZE_40_MS
 &&

2628 
vÆue
 !
OPUS_FRAMESIZE_60_MS
 && vÆuê!
OPUS_FRAMESIZE_80_MS
 &&

2629 
vÆue
 !
OPUS_FRAMESIZE_100_MS
 && vÆuê!
OPUS_FRAMESIZE_120_MS
)

2631 
bad_¨g
;

2633 
°
->
v¨übÀ_duøti⁄
 = 
vÆue
;

2636 
OPUS_GET_EXPERT_FRAME_DURATION_REQUEST
:

2638 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2639 i‡(!
vÆue
)

2641 
bad_¨g
;

2643 *
vÆue
 = 
°
->
v¨übÀ_duøti⁄
;

2646 
OPUS_SET_PREDICTION_DISABLED_REQUEST
:

2648 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2649 i‡(
vÆue
 > 1 || value < 0)

2650 
bad_¨g
;

2651 
°
->
sûk_mode
.
ªdu˚dDïídícy
 = 
vÆue
;

2654 
OPUS_GET_PREDICTION_DISABLED_REQUEST
:

2656 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2657 i‡(!
vÆue
)

2658 
bad_¨g
;

2659 *
vÆue
 = 
°
->
sûk_mode
.
ªdu˚dDïídícy
;

2662 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

2664 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2665 if(
vÆue
<0 || value>1)

2667 
bad_¨g
;

2669 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(
vÆue
));

2672 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

2674 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2675 i‡(!
vÆue
)

2677 
bad_¨g
;

2679 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_GET_PHASE_INVERSION_DISABLED
(
vÆue
));

2682 
OPUS_RESET_STATE
:

2684 *
sûk_íc
;

2685 
sûk_EncC⁄åﬁSåu˘
 
dummy
;

2686 *
°¨t
;

2687 
sûk_íc
 = (*)
°
+°->
sûk_íc_off£t
;

2688 #i‚de‡
DISABLE_FLOAT_API


2689 
	`t⁄Æôy_™Æysis_ª£t
(&
°
->
™Æysis
);

2692 
°¨t
 = (*)&
°
->
OPUS_ENCODER_RESET_START
;

2693 
	`OPUS_CLEAR
(
°¨t
, (
OpusEncodî
Ë- (°¨à- (*)
°
));

2695 
	`˚…_ícodî_˘l
(
˚…_íc
, 
OPUS_RESET_STATE
);

2696 
	`sûk_InôEncodî
–
sûk_íc
, 
°
->
¨ch
, &
dummy
 );

2697 
°
->
°ªam_ch™√ls
 = st->
ch™√ls
;

2698 
°
->
hybrid_°îeo_width_Q14
 = 1 << 14;

2699 
°
->
¥ev_HB_gaö
 = 
Q15ONE
;

2700 
°
->
fú°
 = 1;

2701 
°
->
mode
 = 
MODE_HYBRID
;

2702 
°
->
b™dwidth
 = 
OPUS_BANDWIDTH_FULLBAND
;

2703 
°
->
v¨übÀ_HP_smth2_Q15
 = 
	`sûk_LSHIFT
–
	`sûk_lö2log
–
VARIABLE_HP_MIN_CUTOFF_HZ
 ), 8 );

2706 
OPUS_SET_FORCE_MODE_REQUEST
:

2708 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2709 i‡((
vÆue
 < 
MODE_SILK_ONLY
 || vÆuê> 
MODE_CELT_ONLY
Ë&& vÆuê!
OPUS_AUTO
)

2711 
bad_¨g
;

2713 
°
->
u£r_f‹˚d_mode
 = 
vÆue
;

2716 
OPUS_SET_LFE_REQUEST
:

2718 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

2719 
°
->
l„
 = 
vÆue
;

2720 
ªt
 = 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_LFE
(
vÆue
));

2723 
OPUS_SET_ENERGY_MASK_REQUEST
:

2725 
›us_vÆ16
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_val16*);

2726 
°
->
íîgy_maskög
 = 
vÆue
;

2727 
ªt
 = 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`OPUS_SET_ENERGY_MASK
(
vÆue
));

2730 
OPUS_GET_IN_DTX_REQUEST
:

2732 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

2733 i‡(!
vÆue
)

2735 
bad_¨g
;

2737 i‡(
°
->
sûk_mode
.
u£DTX
 && (°->
¥ev_mode
 =
MODE_SILK_ONLY
 || st->¥ev_modê=
MODE_HYBRID
)) {

2739 
n
;

2740 *
sûk_íc
 = (*)
°
+°->
sûk_íc_off£t
;

2741 *
vÆue
 = 1;

2742 
n
=0;n<
°
->
sûk_mode
.
nCh™√lsI¡î«l
;n++) {

2743 *
vÆue
 = *vÆuê&& ((
sûk_ícodî
*)
sûk_íc
)->
°©e_Fxx
[
n
].
sCmn
.
noS≥echCou¡î
 >
NB_SPEECH_FRAMES_BEFORE_DTX
;

2746 #i‚de‡
DISABLE_FLOAT_API


2747 i‡(
°
->
u£_dtx
) {

2749 *
vÆue
 = 
°
->
nb_no_a˘ivôy_‰ames
 >
NB_SPEECH_FRAMES_BEFORE_DTX
;

2753 *
vÆue
 = 0;

2758 
CELT_GET_MODE_REQUEST
:

2760 c⁄° 
CELTMode
 ** 
vÆue
 = 
	`va_¨g
(
≠
, const CELTMode**);

2761 i‡(!
vÆue
)

2763 
bad_¨g
;

2765 
ªt
 = 
	`˚…_ícodî_˘l
(
˚…_íc
, 
	`CELT_GET_MODE
(
vÆue
));

2770 
ªt
 = 
OPUS_UNIMPLEMENTED
;

2773 
	`va_íd
(
≠
);

2774  
ªt
;

2775 
bad_¨g
:

2776 
	`va_íd
(
≠
);

2777  
OPUS_BAD_ARG
;

2778 
	}
}

2780 
	$›us_ícodî_de°roy
(
OpusEncodî
 *
°
)

2782 
	`›us_‰ì
(
°
);

2783 
	}
}

	@src/opus_multistream.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us_mu…i°ªam.h
"

33 
	~"›us.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"°ack_Æloc.h
"

36 
	~<°d¨g.h
>

37 
	~"Êﬂt_ˇ°.h
"

38 
	~"os_suµ‹t.h
"

41 
	$vÆid©e_œyout
(c⁄° 
Ch™√lLayout
 *
œyout
)

43 
i
, 
max_ch™√l
;

45 
max_ch™√l
 = 
œyout
->
nb_°ªams
+œyout->
nb_cou∂ed_°ªams
;

46 i‡(
max_ch™√l
>255)

48 
i
=0;i<
œyout
->
nb_ch™√ls
;i++)

50 i‡(
œyout
->
m≠pög
[
i
] >
max_ch™√l
 &&Üayout->mapping[i] != 255)

54 
	}
}

57 
	$gë_À·_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
)

59 
i
;

60 
i
 = (
¥ev
<0) ? 0 :Örev+1;

61 ;
i
<
œyout
->
nb_ch™√ls
;i++)

63 i‡(
œyout
->
m≠pög
[
i
]==
°ªam_id
*2)

64  
i
;

67 
	}
}

69 
	$gë_right_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
)

71 
i
;

72 
i
 = (
¥ev
<0) ? 0 :Örev+1;

73 ;
i
<
œyout
->
nb_ch™√ls
;i++)

75 i‡(
œyout
->
m≠pög
[
i
]==
°ªam_id
*2+1)

76  
i
;

79 
	}
}

81 
	$gë_m⁄o_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
)

83 
i
;

84 
i
 = (
¥ev
<0) ? 0 :Örev+1;

85 ;
i
<
œyout
->
nb_ch™√ls
;i++)

87 i‡(
œyout
->
m≠pög
[
i
]==
°ªam_id
+œyout->
nb_cou∂ed_°ªams
)

88  
i
;

91 
	}
}

	@src/opus_multistream_decoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us_mu…i°ªam.h
"

33 
	~"›us.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"°ack_Æloc.h
"

36 
	~<°d¨g.h
>

37 
	~"Êﬂt_ˇ°.h
"

38 
	~"os_suµ‹t.h
"

42 #i‡
deföed
(
ENABLE_HARDENING
Ë|| deföed(
ENABLE_ASSERTIONS
)

43 
	$vÆid©e_ms_decodî
(
OpusMSDecodî
 *
°
)

45 
	`vÆid©e_œyout
(&
°
->
œyout
);

46 
	}
}

47 
	#VALIDATE_MS_DECODER
(
°
Ë
	`vÆid©e_ms_decodî
(°)

	)

49 
	#VALIDATE_MS_DECODER
(
°
)

	)

53 
›us_öt32
 
	$›us_mu…i°ªam_decodî_gë_size
(
nb_°ªams
, 
nb_cou∂ed_°ªams
)

55 
cou∂ed_size
;

56 
m⁄o_size
;

58 if(
nb_°ªams
<1||
nb_cou∂ed_°ªams
>nb_streams||nb_coupled_streams<0) 0;

59 
cou∂ed_size
 = 
	`›us_decodî_gë_size
(2);

60 
m⁄o_size
 = 
	`›us_decodî_gë_size
(1);

61  
	`Æign
((
OpusMSDecodî
))

62 + 
nb_cou∂ed_°ªams
 * 
	`Æign
(
cou∂ed_size
)

63 + (
nb_°ªams
-
nb_cou∂ed_°ªams
Ë* 
	`Æign
(
m⁄o_size
);

64 
	}
}

66 
	$›us_mu…i°ªam_decodî_öô
(

67 
OpusMSDecodî
 *
°
,

68 
›us_öt32
 
Fs
,

69 
ch™√ls
,

70 
°ªams
,

71 
cou∂ed_°ªams
,

72 c⁄° *
m≠pög


75 
cou∂ed_size
;

76 
m⁄o_size
;

77 
i
, 
ªt
;

78 *
±r
;

80 i‡((
ch™√ls
>255Ë|| (ch™√ls<1Ë|| (
cou∂ed_°ªams
>
°ªams
) ||

81 (
°ªams
<1Ë|| (
cou∂ed_°ªams
<0) || (streams>255-coupled_streams))

82  
OPUS_BAD_ARG
;

84 
°
->
œyout
.
nb_ch™√ls
 = 
ch™√ls
;

85 
°
->
œyout
.
nb_°ªams
 = 
°ªams
;

86 
°
->
œyout
.
nb_cou∂ed_°ªams
 = 
cou∂ed_°ªams
;

88 
i
=0;i<
°
->
œyout
.
nb_ch™√ls
;i++)

89 
°
->
œyout
.
m≠pög
[
i
] = mapping[i];

90 i‡(!
	`vÆid©e_œyout
(&
°
->
œyout
))

91  
OPUS_BAD_ARG
;

93 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSDecodî
));

94 
cou∂ed_size
 = 
	`›us_decodî_gë_size
(2);

95 
m⁄o_size
 = 
	`›us_decodî_gë_size
(1);

97 
i
=0;i<
°
->
œyout
.
nb_cou∂ed_°ªams
;i++)

99 
ªt
=
	`›us_decodî_öô
((
OpusDecodî
*)
±r
, 
Fs
, 2);

100 if(
ªt
!=
OPUS_OK
)Ñet;

101 
±r
 +
	`Æign
(
cou∂ed_size
);

103 ;
i
<
°
->
œyout
.
nb_°ªams
;i++)

105 
ªt
=
	`›us_decodî_öô
((
OpusDecodî
*)
±r
, 
Fs
, 1);

106 if(
ªt
!=
OPUS_OK
)Ñet;

107 
±r
 +
	`Æign
(
m⁄o_size
);

109  
OPUS_OK
;

110 
	}
}

113 
OpusMSDecodî
 *
	$›us_mu…i°ªam_decodî_¸óã
(

114 
›us_öt32
 
Fs
,

115 
ch™√ls
,

116 
°ªams
,

117 
cou∂ed_°ªams
,

118 c⁄° *
m≠pög
,

119 *
îr‹


122 
ªt
;

123 
OpusMSDecodî
 *
°
;

124 i‡((
ch™√ls
>255Ë|| (ch™√ls<1Ë|| (
cou∂ed_°ªams
>
°ªams
) ||

125 (
°ªams
<1Ë|| (
cou∂ed_°ªams
<0) || (streams>255-coupled_streams))

127 i‡(
îr‹
)

128 *
îr‹
 = 
OPUS_BAD_ARG
;

129  
NULL
;

131 
°
 = (
OpusMSDecodî
 *)
	`›us_Æloc
(
	`›us_mu…i°ªam_decodî_gë_size
(
°ªams
, 
cou∂ed_°ªams
));

132 i‡(
°
==
NULL
)

134 i‡(
îr‹
)

135 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

136  
NULL
;

138 
ªt
 = 
	`›us_mu…i°ªam_decodî_öô
(
°
, 
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
, 
m≠pög
);

139 i‡(
îr‹
)

140 *
îr‹
 = 
ªt
;

141 i‡(
ªt
 !
OPUS_OK
)

143 
	`›us_‰ì
(
°
);

144 
°
 = 
NULL
;

146  
°
;

147 
	}
}

149 
	$›us_mu…i°ªam_∑ckë_vÆid©e
(c⁄° *
d©a
,

150 
›us_öt32
 
Àn
, 
nb_°ªams
, opus_öt32 
Fs
)

152 
s
;

153 
cou¡
;

154 
toc
;

155 
›us_öt16
 
size
[48];

156 
ßm∂es
=0;

157 
›us_öt32
 
∑ckë_off£t
;

159 
s
=0;s<
nb_°ªams
;s++)

161 
tmp_ßm∂es
;

162 i‡(
Àn
<=0)

163  
OPUS_INVALID_PACKET
;

164 
cou¡
 = 
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 
s
!=
nb_°ªams
-1, &
toc
, 
NULL
,

165 
size
, 
NULL
, &
∑ckë_off£t
);

166 i‡(
cou¡
<0)

167  
cou¡
;

168 
tmp_ßm∂es
 = 
	`›us_∑ckë_gë_nb_ßm∂es
(
d©a
, 
∑ckë_off£t
, 
Fs
);

169 i‡(
s
!=0 && 
ßm∂es
 !
tmp_ßm∂es
)

170  
OPUS_INVALID_PACKET
;

171 
ßm∂es
 = 
tmp_ßm∂es
;

172 
d©a
 +
∑ckë_off£t
;

173 
Àn
 -
∑ckë_off£t
;

175  
ßm∂es
;

176 
	}
}

178 
	$›us_mu…i°ªam_decode_«tive
(

179 
OpusMSDecodî
 *
°
,

180 c⁄° *
d©a
,

181 
›us_öt32
 
Àn
,

182 *
pcm
,

183 
›us_c›y_ch™√l_out_func
 
c›y_ch™√l_out
,

184 
‰ame_size
,

185 
decode_„c
,

186 
so·_˛ù
,

187 *
u£r_d©a


190 
›us_öt32
 
Fs
;

191 
cou∂ed_size
;

192 
m⁄o_size
;

193 
s
, 
c
;

194 *
±r
;

195 
do_∂c
=0;

196 
	`VARDECL
(
›us_vÆ16
, 
buf
);

197 
ALLOC_STACK
;

199 
	`VALIDATE_MS_DECODER
(
°
);

200 i‡(
‰ame_size
 <= 0)

202 
RESTORE_STACK
;

203  
OPUS_BAD_ARG
;

206 
	`MUST_SUCCEED
(
	`›us_mu…i°ªam_decodî_˘l
(
°
, 
	`OPUS_GET_SAMPLE_RATE
(&
Fs
)));

207 
‰ame_size
 = 
	`IMIN
(‰ame_size, 
Fs
/25*3);

208 
	`ALLOC
(
buf
, 2*
‰ame_size
, 
›us_vÆ16
);

209 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSDecodî
));

210 
cou∂ed_size
 = 
	`›us_decodî_gë_size
(2);

211 
m⁄o_size
 = 
	`›us_decodî_gë_size
(1);

213 i‡(
Àn
==0)

214 
do_∂c
 = 1;

215 i‡(
Àn
 < 0)

217 
RESTORE_STACK
;

218  
OPUS_BAD_ARG
;

220 i‡(!
do_∂c
 && 
Àn
 < 2*
°
->
œyout
.
nb_°ªams
-1)

222 
RESTORE_STACK
;

223  
OPUS_INVALID_PACKET
;

225 i‡(!
do_∂c
)

227 
ªt
 = 
	`›us_mu…i°ªam_∑ckë_vÆid©e
(
d©a
, 
Àn
, 
°
->
œyout
.
nb_°ªams
, 
Fs
);

228 i‡(
ªt
 < 0)

230 
RESTORE_STACK
;

231  
ªt
;

232 } i‡(
ªt
 > 
‰ame_size
)

234 
RESTORE_STACK
;

235  
OPUS_BUFFER_TOO_SMALL
;

238 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

240 
OpusDecodî
 *
dec
;

241 
›us_öt32
 
∑ckë_off£t
;

242 
ªt
;

244 
dec
 = (
OpusDecodî
*)
±r
;

245 
±r
 +(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
Ë? 
	`Æign
(
cou∂ed_size
Ë:álign(
m⁄o_size
);

247 i‡(!
do_∂c
 && 
Àn
<=0)

249 
RESTORE_STACK
;

250  
OPUS_INTERNAL_ERROR
;

252 
∑ckë_off£t
 = 0;

253 
ªt
 = 
	`›us_decode_«tive
(
dec
, 
d©a
, 
Àn
, 
buf
, 
‰ame_size
, 
decode_„c
, 
s
!=
°
->
œyout
.
nb_°ªams
-1, &
∑ckë_off£t
, 
so·_˛ù
);

254 
d©a
 +
∑ckë_off£t
;

255 
Àn
 -
∑ckë_off£t
;

256 i‡(
ªt
 <= 0)

258 
RESTORE_STACK
;

259  
ªt
;

261 
‰ame_size
 = 
ªt
;

262 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

264 
ch™
, 
¥ev
;

265 
¥ev
 = -1;

267  (
ch™
 = 
	`gë_À·_ch™√l
(&
°
->
œyout
, 
s
, 
¥ev
)) != -1)

269 (*
c›y_ch™√l_out
)(
pcm
, 
°
->
œyout
.
nb_ch™√ls
, 
ch™
,

270 
buf
, 2, 
‰ame_size
, 
u£r_d©a
);

271 
¥ev
 = 
ch™
;

273 
¥ev
 = -1;

275  (
ch™
 = 
	`gë_right_ch™√l
(&
°
->
œyout
, 
s
, 
¥ev
)) != -1)

277 (*
c›y_ch™√l_out
)(
pcm
, 
°
->
œyout
.
nb_ch™√ls
, 
ch™
,

278 
buf
+1, 2, 
‰ame_size
, 
u£r_d©a
);

279 
¥ev
 = 
ch™
;

282 
ch™
, 
¥ev
;

283 
¥ev
 = -1;

285  (
ch™
 = 
	`gë_m⁄o_ch™√l
(&
°
->
œyout
, 
s
, 
¥ev
)) != -1)

287 (*
c›y_ch™√l_out
)(
pcm
, 
°
->
œyout
.
nb_ch™√ls
, 
ch™
,

288 
buf
, 1, 
‰ame_size
, 
u£r_d©a
);

289 
¥ev
 = 
ch™
;

294 
c
=0;c<
°
->
œyout
.
nb_ch™√ls
;c++)

296 i‡(
°
->
œyout
.
m≠pög
[
c
] == 255)

298 (*
c›y_ch™√l_out
)(
pcm
, 
°
->
œyout
.
nb_ch™√ls
, 
c
,

299 
NULL
, 0, 
‰ame_size
, 
u£r_d©a
);

302 
RESTORE_STACK
;

303  
‰ame_size
;

304 
	}
}

306 #i‡!
deföed
(
DISABLE_FLOAT_API
)

307 
	$›us_c›y_ch™√l_out_Êﬂt
(

308 *
d°
,

309 
d°_°ride
,

310 
d°_ch™√l
,

311 c⁄° 
›us_vÆ16
 *
§c
,

312 
§c_°ride
,

313 
‰ame_size
,

314 *
u£r_d©a


317 *
Êﬂt_d°
;

318 
›us_öt32
 
i
;

319 ()
u£r_d©a
;

320 
Êﬂt_d°
 = (*)
d°
;

321 i‡(
§c
 !
NULL
)

323 
i
=0;i<
‰ame_size
;i++)

324 #i‡
	`deföed
(
FIXED_POINT
)

325 
Êﬂt_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = (1/32768.f)*
§c
[i*
§c_°ride
];

327 
Êﬂt_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = 
§c
[i*
§c_°ride
];

332 
i
=0;i<
‰ame_size
;i++)

333 
Êﬂt_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = 0;

335 
	}
}

338 
	$›us_c›y_ch™√l_out_sh‹t
(

339 *
d°
,

340 
d°_°ride
,

341 
d°_ch™√l
,

342 c⁄° 
›us_vÆ16
 *
§c
,

343 
§c_°ride
,

344 
‰ame_size
,

345 *
u£r_d©a


348 
›us_öt16
 *
sh‹t_d°
;

349 
›us_öt32
 
i
;

350 ()
u£r_d©a
;

351 
sh‹t_d°
 = (
›us_öt16
*)
d°
;

352 i‡(
§c
 !
NULL
)

354 
i
=0;i<
‰ame_size
;i++)

355 #i‡
	`deföed
(
FIXED_POINT
)

356 
sh‹t_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = 
§c
[i*
§c_°ride
];

358 
sh‹t_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = 
	`FLOAT2INT16
(
§c
[i*
§c_°ride
]);

363 
i
=0;i<
‰ame_size
;i++)

364 
sh‹t_d°
[
i
*
d°_°ride
+
d°_ch™√l
] = 0;

366 
	}
}

370 #ifde‡
FIXED_POINT


371 
	$›us_mu…i°ªam_decode
(

372 
OpusMSDecodî
 *
°
,

373 c⁄° *
d©a
,

374 
›us_öt32
 
Àn
,

375 
›us_öt16
 *
pcm
,

376 
‰ame_size
,

377 
decode_„c


380  
	`›us_mu…i°ªam_decode_«tive
(
°
, 
d©a
, 
Àn
,

381 
pcm
, 
›us_c›y_ch™√l_out_sh‹t
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
);

382 
	}
}

384 #i‚de‡
DISABLE_FLOAT_API


385 
	$›us_mu…i°ªam_decode_Êﬂt
(
OpusMSDecodî
 *
°
, c⁄° *
d©a
,

386 
›us_öt32
 
Àn
, *
pcm
, 
‰ame_size
, 
decode_„c
)

388  
	`›us_mu…i°ªam_decode_«tive
(
°
, 
d©a
, 
Àn
,

389 
pcm
, 
›us_c›y_ch™√l_out_Êﬂt
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
);

390 
	}
}

395 
	$›us_mu…i°ªam_decode
(
OpusMSDecodî
 *
°
, c⁄° *
d©a
,

396 
›us_öt32
 
Àn
, 
›us_öt16
 *
pcm
, 
‰ame_size
, 
decode_„c
)

398  
	`›us_mu…i°ªam_decode_«tive
(
°
, 
d©a
, 
Àn
,

399 
pcm
, 
›us_c›y_ch™√l_out_sh‹t
, 
‰ame_size
, 
decode_„c
, 1, 
NULL
);

400 
	}
}

402 
	$›us_mu…i°ªam_decode_Êﬂt
(

403 
OpusMSDecodî
 *
°
,

404 c⁄° *
d©a
,

405 
›us_öt32
 
Àn
,

406 
›us_vÆ16
 *
pcm
,

407 
‰ame_size
,

408 
decode_„c


411  
	`›us_mu…i°ªam_decode_«tive
(
°
, 
d©a
, 
Àn
,

412 
pcm
, 
›us_c›y_ch™√l_out_Êﬂt
, 
‰ame_size
, 
decode_„c
, 0, 
NULL
);

413 
	}
}

416 
	$›us_mu…i°ªam_decodî_˘l_va_li°
(
OpusMSDecodî
 *
°
, 
ªque°
,

417 
va_li°
 
≠
)

419 
cou∂ed_size
, 
m⁄o_size
;

420 *
±r
;

421 
ªt
 = 
OPUS_OK
;

423 
cou∂ed_size
 = 
	`›us_decodî_gë_size
(2);

424 
m⁄o_size
 = 
	`›us_decodî_gë_size
(1);

425 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSDecodî
));

426 
ªque°
)

428 
OPUS_GET_BANDWIDTH_REQUEST
:

429 
OPUS_GET_SAMPLE_RATE_REQUEST
:

430 
OPUS_GET_GAIN_REQUEST
:

431 
OPUS_GET_LAST_PACKET_DURATION_REQUEST
:

432 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

434 
OpusDecodî
 *
dec
;

436 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

437 
dec
 = (
OpusDecodî
*)
±r
;

438 
ªt
 = 
	`›us_decodî_˘l
(
dec
, 
ªque°
, 
vÆue
);

441 
OPUS_GET_FINAL_RANGE_REQUEST
:

443 
s
;

444 
›us_uöt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32*);

445 
›us_uöt32
 
tmp
;

446 i‡(!
vÆue
)

448 
bad_¨g
;

450 *
vÆue
 = 0;

451 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

453 
OpusDecodî
 *
dec
;

454 
dec
 = (
OpusDecodî
*)
±r
;

455 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

456 
±r
 +
	`Æign
(
cou∂ed_size
);

458 
±r
 +
	`Æign
(
m⁄o_size
);

459 
ªt
 = 
	`›us_decodî_˘l
(
dec
, 
ªque°
, &
tmp
);

460 i‡(
ªt
 !
OPUS_OK
) ;

461 *
vÆue
 ^
tmp
;

465 
OPUS_RESET_STATE
:

467 
s
;

468 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

470 
OpusDecodî
 *
dec
;

472 
dec
 = (
OpusDecodî
*)
±r
;

473 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

474 
±r
 +
	`Æign
(
cou∂ed_size
);

476 
±r
 +
	`Æign
(
m⁄o_size
);

477 
ªt
 = 
	`›us_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
);

478 i‡(
ªt
 !
OPUS_OK
)

483 
OPUS_MULTISTREAM_GET_DECODER_STATE_REQUEST
:

485 
s
;

486 
›us_öt32
 
°ªam_id
;

487 
OpusDecodî
 **
vÆue
;

488 
°ªam_id
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

489 i‡(
°ªam_id
<0 || såóm_id >
°
->
œyout
.
nb_°ªams
)

490 
bad_¨g
;

491 
vÆue
 = 
	`va_¨g
(
≠
, 
OpusDecodî
**);

492 i‡(!
vÆue
)

494 
bad_¨g
;

496 
s
=0;s<
°ªam_id
;s++)

498 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

499 
±r
 +
	`Æign
(
cou∂ed_size
);

501 
±r
 +
	`Æign
(
m⁄o_size
);

503 *
vÆue
 = (
OpusDecodî
*)
±r
;

506 
OPUS_SET_GAIN_REQUEST
:

507 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

509 
s
;

511 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

512 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

514 
OpusDecodî
 *
dec
;

516 
dec
 = (
OpusDecodî
*)
±r
;

517 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

518 
±r
 +
	`Æign
(
cou∂ed_size
);

520 
±r
 +
	`Æign
(
m⁄o_size
);

521 
ªt
 = 
	`›us_decodî_˘l
(
dec
, 
ªque°
, 
vÆue
);

522 i‡(
ªt
 !
OPUS_OK
)

528 
ªt
 = 
OPUS_UNIMPLEMENTED
;

531  
ªt
;

532 
bad_¨g
:

533  
OPUS_BAD_ARG
;

534 
	}
}

536 
	$›us_mu…i°ªam_decodî_˘l
(
OpusMSDecodî
 *
°
, 
ªque°
, ...)

538 
ªt
;

539 
va_li°
 
≠
;

540 
	`va_°¨t
(
≠
, 
ªque°
);

541 
ªt
 = 
	`›us_mu…i°ªam_decodî_˘l_va_li°
(
°
, 
ªque°
, 
≠
);

542 
	`va_íd
(
≠
);

543  
ªt
;

544 
	}
}

546 
	$›us_mu…i°ªam_decodî_de°roy
(
OpusMSDecodî
 *
°
)

548 
	`›us_‰ì
(
°
);

549 
	}
}

	@src/opus_multistream_encoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us_mu…i°ªam.h
"

33 
	~"›us.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"°ack_Æloc.h
"

36 
	~<°d¨g.h
>

37 
	~"Êﬂt_ˇ°.h
"

38 
	~"os_suµ‹t.h
"

39 
	~"m©h›s.h
"

40 
	~"md˘.h
"

41 
	~"modes.h
"

42 
	~"b™ds.h
"

43 
	~"qu™t_b™ds.h
"

44 
	~"pôch.h
"

47 
	mnb_°ªams
;

48 
	mnb_cou∂ed_°ªams
;

49 
	mm≠pög
[8];

50 } 
	tV‹bisLayout
;

53 c⁄° 
V‹bisLayout
 
	gv‹bis_m≠pögs
[8] = {

64 
›us_vÆ32
 *
	$ms_gë_¥ìmph_mem
(
OpusMSEncodî
 *
°
)

66 
s
;

67 *
±r
;

68 
cou∂ed_size
, 
m⁄o_size
;

70 
cou∂ed_size
 = 
	`›us_ícodî_gë_size
(2);

71 
m⁄o_size
 = 
	`›us_ícodî_gë_size
(1);

72 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSEncodî
));

73 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

75 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

76 
±r
 +
	`Æign
(
cou∂ed_size
);

78 
±r
 +
	`Æign
(
m⁄o_size
);

81  (
›us_vÆ32
*)(*)(
±r
+
°
->
œyout
.
nb_ch™√ls
*120*(opus_val32));

82 
	}
}

84 
›us_vÆ32
 *
	$ms_gë_wödow_mem
(
OpusMSEncodî
 *
°
)

86 
s
;

87 *
±r
;

88 
cou∂ed_size
, 
m⁄o_size
;

90 
cou∂ed_size
 = 
	`›us_ícodî_gë_size
(2);

91 
m⁄o_size
 = 
	`›us_ícodî_gë_size
(1);

92 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSEncodî
));

93 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

95 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

96 
±r
 +
	`Æign
(
cou∂ed_size
);

98 
±r
 +
	`Æign
(
m⁄o_size
);

101  (
›us_vÆ32
*)(*)
±r
;

102 
	}
}

104 
	$vÆid©e_ambis⁄ics
(
nb_ch™√ls
, *
nb_°ªams
, *
nb_cou∂ed_°ªams
)

106 
‹dî_∂us_⁄e
;

107 
a˙_ch™√ls
;

108 
n⁄dõgëic_ch™√ls
;

110 i‡(
nb_ch™√ls
 < 1 ||Çb_channels > 227)

113 
‹dî_∂us_⁄e
 = 
	`isqπ32
(
nb_ch™√ls
);

114 
a˙_ch™√ls
 = 
‹dî_∂us_⁄e
 * order_plus_one;

115 
n⁄dõgëic_ch™√ls
 = 
nb_ch™√ls
 - 
a˙_ch™√ls
;

117 i‡(
n⁄dõgëic_ch™√ls
 != 0 &&Çondiegetic_channels != 2)

120 i‡(
nb_°ªams
)

121 *
nb_°ªams
 = 
a˙_ch™√ls
 + (
n⁄dõgëic_ch™√ls
 != 0);

122 i‡(
nb_cou∂ed_°ªams
)

123 *
nb_cou∂ed_°ªams
 = 
n⁄dõgëic_ch™√ls
 != 0;

125 
	}
}

127 
	$vÆid©e_ícodî_œyout
(c⁄° 
Ch™√lLayout
 *
œyout
)

129 
s
;

130 
s
=0;s<
œyout
->
nb_°ªams
;s++)

132 i‡(
s
 < 
œyout
->
nb_cou∂ed_°ªams
)

134 i‡(
	`gë_À·_ch™√l
(
œyout
, 
s
, -1)==-1)

136 i‡(
	`gë_right_ch™√l
(
œyout
, 
s
, -1)==-1)

139 i‡(
	`gë_m⁄o_ch™√l
(
œyout
, 
s
, -1)==-1)

144 
	}
}

146 
	$ch™√l_pos
(
ch™√ls
, 
pos
[8])

149 i‡(
ch™√ls
==4)

151 
pos
[0]=1;

152 
pos
[1]=3;

153 
pos
[2]=1;

154 
pos
[3]=3;

155 } i‡(
ch™√ls
==3||channels==5||channels==6)

157 
pos
[0]=1;

158 
pos
[1]=2;

159 
pos
[2]=3;

160 
pos
[3]=1;

161 
pos
[4]=3;

162 
pos
[5]=0;

163 } i‡(
ch™√ls
==7)

165 
pos
[0]=1;

166 
pos
[1]=2;

167 
pos
[2]=3;

168 
pos
[3]=1;

169 
pos
[4]=3;

170 
pos
[5]=2;

171 
pos
[6]=0;

172 } i‡(
ch™√ls
==8)

174 
pos
[0]=1;

175 
pos
[1]=2;

176 
pos
[2]=3;

177 
pos
[3]=1;

178 
pos
[4]=3;

179 
pos
[5]=1;

180 
pos
[6]=3;

181 
pos
[7]=0;

183 
	}
}

187 
›us_vÆ16
 
	$logSum
(
›us_vÆ16
 
a
, opus_vÆ16 
b
)

189 
›us_vÆ16
 
max
;

190 
›us_vÆ32
 
diff
;

191 
›us_vÆ16
 
‰ac
;

192 c⁄° 
›us_vÆ16
 
diff_èbÀ
[17] = {

193 
	`QCONST16
(0.5000000f, 
DB_SHIFT
), QCONST16(0.2924813f, DB_SHIFT), QCONST16(0.1609640f, DB_SHIFT), QCONST16(0.0849625f, DB_SHIFT),

194 
	`QCONST16
(0.0437314f, 
DB_SHIFT
), QCONST16(0.0221971f, DB_SHIFT), QCONST16(0.0111839f, DB_SHIFT), QCONST16(0.0056136f, DB_SHIFT),

195 
	`QCONST16
(0.0028123f, 
DB_SHIFT
)

197 
low
;

198 i‡(
a
>
b
)

200 
max
 = 
a
;

201 
diff
 = 
	`SUB32
(
	`EXTEND32
(
a
),EXTEND32(
b
));

203 
max
 = 
b
;

204 
diff
 = 
	`SUB32
(
	`EXTEND32
(
b
),EXTEND32(
a
));

206 i‡(!(
diff
 < 
	`QCONST16
(8.f, 
DB_SHIFT
)))

207  
max
;

208 #ifde‡
FIXED_POINT


209 
low
 = 
	`SHR32
(
diff
, 
DB_SHIFT
-1);

210 
‰ac
 = 
	`SHL16
(
diff
 - SHL16(
low
, 
DB_SHIFT
-1), 16-DB_SHIFT);

212 
low
 = ()
	`Êo‹
(2*
diff
);

213 
‰ac
 = 2*
diff
 - 
low
;

215  
max
 + 
diff_èbÀ
[
low
] + 
	`MULT16_16_Q15
(
‰ac
, 
	`SUB16
(diff_table[low+1], diff_table[low]));

216 
	}
}

218 
›us_vÆ16
 
	$logSum
(
›us_vÆ16
 
a
, opus_vÆ16 
b
)

220  
	`log2
(
	`pow
(4, 
a
)+Öow(4, 
b
))/2;

221 
	}
}

224 
	$suºound_™Æysis
(c⁄° 
CELTMode
 *
˚…_mode
, c⁄° *
pcm
, 
›us_vÆ16
 *
b™dLogE
, 
›us_vÆ32
 *
mem
, opus_vÆ32 *
¥ìmph_mem
,

225 
Àn
, 
ovîœp
, 
ch™√ls
, 
øã
, 
›us_c›y_ch™√l_ö_func
 
c›y_ch™√l_ö
, 
¨ch


228 
c
;

229 
i
;

230 
LM
;

231 
pos
[8] = {0};

232 
upßm∂e
;

233 
‰ame_size
;

234 
‰eq_size
;

235 
›us_vÆ16
 
ch™√l_off£t
;

236 
›us_vÆ32
 
b™dE
[21];

237 
›us_vÆ16
 
maskLogE
[3][21];

238 
	`VARDECL
(
›us_vÆ32
, 
ö
);

239 
	`VARDECL
(
›us_vÆ16
, 
x
);

240 
	`VARDECL
(
›us_vÆ32
, 
‰eq
);

241 
SAVE_STACK
;

243 
upßm∂e
 = 
	`ªßm∂ög_Á˘‹
(
øã
);

244 
‰ame_size
 = 
Àn
*
upßm∂e
;

245 
‰eq_size
 = 
	`IMIN
(960, 
‰ame_size
);

248 
LM
=0;LM<
˚…_mode
->
maxLM
;LM++)

249 i‡(
˚…_mode
->
sh‹tMd˘Size
<<
LM
==
‰ame_size
)

252 
	`ALLOC
(
ö
, 
‰ame_size
+
ovîœp
, 
›us_vÆ32
);

253 
	`ALLOC
(
x
, 
Àn
, 
›us_vÆ16
);

254 
	`ALLOC
(
‰eq
, 
‰eq_size
, 
›us_vÆ32
);

256 
	`ch™√l_pos
(
ch™√ls
, 
pos
);

258 
c
=0;c<3;c++)

259 
i
=0;i<21;i++)

260 
maskLogE
[
c
][
i
] = -
	`QCONST16
(28.f, 
DB_SHIFT
);

262 
c
=0;c<
ch™√ls
;c++)

264 
‰ame
;

265 
nb_‰ames
 = 
‰ame_size
/
‰eq_size
;

266 
	`˚…_as£π
(
nb_‰ames
*
‰eq_size
 =
‰ame_size
);

267 
	`OPUS_COPY
(
ö
, 
mem
+
c
*
ovîœp
, overlap);

268 (*
c›y_ch™√l_ö
)(
x
, 1, 
pcm
, 
ch™√ls
, 
c
, 
Àn
, 
NULL
);

269 
	`˚…_¥ìmphasis
(
x
, 
ö
+
ovîœp
, 
‰ame_size
, 1, 
upßm∂e
, 
˚…_mode
->
¥ìmph
, 
¥ìmph_mem
+
c
, 0);

270 #i‚de‡
FIXED_POINT


272 
›us_vÆ32
 
sum
;

273 
sum
 = 
	`˚…_ö√r_¥od
(
ö
, in, 
‰ame_size
+
ovîœp
, 0);

276 i‡(!(
sum
 < 1e18fË|| 
	`˚…_i¢™
(sum))

278 
	`OPUS_CLEAR
(
ö
, 
‰ame_size
+
ovîœp
);

279 
¥ìmph_mem
[
c
] = 0;

283 
	`OPUS_CLEAR
(
b™dE
, 21);

284 
‰ame
=0;‰ame<
nb_‰ames
;frame++)

286 
›us_vÆ32
 
tmpE
[21];

287 
	`˛t_md˘_f‹w¨d
(&
˚…_mode
->
md˘
, 
ö
+960*
‰ame
, 
‰eq
, cñt_mode->
wödow
,

288 
ovîœp
, 
˚…_mode
->
maxLM
-
LM
, 1, 
¨ch
);

289 i‡(
upßm∂e
 != 1)

291 
bound
 = 
‰eq_size
/
upßm∂e
;

292 
i
=0;i<
bound
;i++)

293 
‰eq
[
i
] *
upßm∂e
;

294 ;
i
<
‰eq_size
;i++)

295 
‰eq
[
i
] = 0;

298 
	`compuã_b™d_íîgõs
(
˚…_mode
, 
‰eq
, 
tmpE
, 21, 1, 
LM
, 
¨ch
);

300 
i
=0;i<21;i++)

301 
b™dE
[
i
] = 
	`MAX32
(b™dE[i], 
tmpE
[i]);

303 
	`amp2Log2
(
˚…_mode
, 21, 21, 
b™dE
, 
b™dLogE
+21*
c
, 1);

305 
i
=1;i<21;i++)

306 
b™dLogE
[21*
c
+
i
] = 
	`MAX16
(b™dLogE[21*c+i], b™dLogE[21*c+i-1]-
	`QCONST16
(1.f, 
DB_SHIFT
));

307 
i
=19;i>=0;i--)

308 
b™dLogE
[21*
c
+
i
] = 
	`MAX16
(b™dLogE[21*c+i], b™dLogE[21*c+i+1]-
	`QCONST16
(2.f, 
DB_SHIFT
));

309 i‡(
pos
[
c
]==1)

311 
i
=0;i<21;i++)

312 
maskLogE
[0][
i
] = 
	`logSum
(maskLogE[0][i], 
b™dLogE
[21*
c
+i]);

313 } i‡(
pos
[
c
]==3)

315 
i
=0;i<21;i++)

316 
maskLogE
[2][
i
] = 
	`logSum
(maskLogE[2][i], 
b™dLogE
[21*
c
+i]);

317 } i‡(
pos
[
c
]==2)

319 
i
=0;i<21;i++)

321 
maskLogE
[0][
i
] = 
	`logSum
(maskLogE[0][i], 
b™dLogE
[21*
c
+i]-
	`QCONST16
(.5f, 
DB_SHIFT
));

322 
maskLogE
[2][
i
] = 
	`logSum
(maskLogE[2][i], 
b™dLogE
[21*
c
+i]-
	`QCONST16
(.5f, 
DB_SHIFT
));

326 
i
=0;i<21;i++)

327 
	`¥ötf
("%‡", 
b™dLogE
[21*
c
+
i
]);

328 
sum
=0;

329 
i
=0;i<21;i++)

330 
sum
 +
b™dLogE
[21*
c
+
i
];

331 
	`¥ötf
("%‡", 
sum
/21);

333 
	`OPUS_COPY
(
mem
+
c
*
ovîœp
, 
ö
+
‰ame_size
, overlap);

335 
i
=0;i<21;i++)

336 
maskLogE
[1][
i
] = 
	`MIN32
(maskLogE[0][i],maskLogE[2][i]);

337 
ch™√l_off£t
 = 
	`HALF16
(
	`˚…_log2
(
	`QCONST32
(2.f,14)/(
ch™√ls
-1)));

338 
c
=0;c<3;c++)

339 
i
=0;i<21;i++)

340 
maskLogE
[
c
][
i
] +
ch™√l_off£t
;

342 
c
=0;c<3;c++)

344 
i
=0;i<21;i++)

345 
	`¥ötf
("%‡", 
maskLogE
[
c
][
i
]);

348 
c
=0;c<
ch™√ls
;c++)

350 
›us_vÆ16
 *
mask
;

351 i‡(
pos
[
c
]!=0)

353 
mask
 = &
maskLogE
[
pos
[
c
]-1][0];

354 
i
=0;i<21;i++)

355 
b™dLogE
[21*
c
+
i
] = b™dLogE[21*c+i] - 
mask
[i];

357 
i
=0;i<21;i++)

358 
b™dLogE
[21*
c
+
i
] = 0;

361 
i
=0;i<21;i++)

362 
	`¥ötf
("%‡", 
b™dLogE
[21*
c
+
i
]);

363 
	`¥ötf
("\n");

366 
sum
=0;

367 
i
=0;i<21;i++)

368 
sum
 +
b™dLogE
[21*
c
+
i
];

369 
	`¥ötf
("%‡", 
sum
/()
	`QCONST32
(21.f, 
DB_SHIFT
));

370 
	`¥ötf
("\n");

373 
RESTORE_STACK
;

374 
	}
}

376 
›us_öt32
 
	$›us_mu…i°ªam_ícodî_gë_size
(
nb_°ªams
, 
nb_cou∂ed_°ªams
)

378 
cou∂ed_size
;

379 
m⁄o_size
;

381 if(
nb_°ªams
<1||
nb_cou∂ed_°ªams
>nb_streams||nb_coupled_streams<0) 0;

382 
cou∂ed_size
 = 
	`›us_ícodî_gë_size
(2);

383 
m⁄o_size
 = 
	`›us_ícodî_gë_size
(1);

384  
	`Æign
((
OpusMSEncodî
))

385 + 
nb_cou∂ed_°ªams
 * 
	`Æign
(
cou∂ed_size
)

386 + (
nb_°ªams
-
nb_cou∂ed_°ªams
Ë* 
	`Æign
(
m⁄o_size
);

387 
	}
}

389 
›us_öt32
 
	$›us_mu…i°ªam_suºound_ícodî_gë_size
(
ch™√ls
, 
m≠pög_Ámûy
)

391 
nb_°ªams
;

392 
nb_cou∂ed_°ªams
;

393 
›us_öt32
 
size
;

395 i‡(
m≠pög_Ámûy
==0)

397 i‡(
ch™√ls
==1)

399 
nb_°ªams
=1;

400 
nb_cou∂ed_°ªams
=0;

401 } i‡(
ch™√ls
==2)

403 
nb_°ªams
=1;

404 
nb_cou∂ed_°ªams
=1;

407 } i‡(
m≠pög_Ámûy
==1 && 
ch™√ls
<=8 && channels>=1)

409 
nb_°ªams
=
v‹bis_m≠pögs
[
ch™√ls
-1].nb_streams;

410 
nb_cou∂ed_°ªams
=
v‹bis_m≠pögs
[
ch™√ls
-1].nb_coupled_streams;

411 } i‡(
m≠pög_Ámûy
==255)

413 
nb_°ªams
=
ch™√ls
;

414 
nb_cou∂ed_°ªams
=0;

415 } i‡(
m≠pög_Ámûy
==2)

417 i‡(!
	`vÆid©e_ambis⁄ics
(
ch™√ls
, &
nb_°ªams
, &
nb_cou∂ed_°ªams
))

421 
size
 = 
	`›us_mu…i°ªam_ícodî_gë_size
(
nb_°ªams
, 
nb_cou∂ed_°ªams
);

422 i‡(
ch™√ls
>2)

424 
size
 +
ch™√ls
*(120*(
›us_vÆ32
) + (opus_val32));

426  
size
;

427 
	}
}

429 
	$›us_mu…i°ªam_ícodî_öô_im∂
(

430 
OpusMSEncodî
 *
°
,

431 
›us_öt32
 
Fs
,

432 
ch™√ls
,

433 
°ªams
,

434 
cou∂ed_°ªams
,

435 c⁄° *
m≠pög
,

436 
≠∂iˇti⁄
,

437 
M≠pögTy≥
 
m≠pög_ty≥


440 
cou∂ed_size
;

441 
m⁄o_size
;

442 
i
, 
ªt
;

443 *
±r
;

445 i‡((
ch™√ls
>255Ë|| (ch™√ls<1Ë|| (
cou∂ed_°ªams
>
°ªams
) ||

446 (
°ªams
<1Ë|| (
cou∂ed_°ªams
<0) || (streams>255-coupled_streams))

447  
OPUS_BAD_ARG
;

449 
°
->
¨ch
 = 
	`›us_£À˘_¨ch
();

450 
°
->
œyout
.
nb_ch™√ls
 = 
ch™√ls
;

451 
°
->
œyout
.
nb_°ªams
 = 
°ªams
;

452 
°
->
œyout
.
nb_cou∂ed_°ªams
 = 
cou∂ed_°ªams
;

453 i‡(
m≠pög_ty≥
 !
MAPPING_TYPE_SURROUND
)

454 
°
->
l„_°ªam
 = -1;

455 
°
->
bôøã_bps
 = 
OPUS_AUTO
;

456 
°
->
≠∂iˇti⁄
 =ápplication;

457 
°
->
v¨übÀ_duøti⁄
 = 
OPUS_FRAMESIZE_ARG
;

458 
i
=0;i<
°
->
œyout
.
nb_ch™√ls
;i++)

459 
°
->
œyout
.
m≠pög
[
i
] = mapping[i];

460 i‡(!
	`vÆid©e_œyout
(&
°
->
œyout
))

461  
OPUS_BAD_ARG
;

462 i‡(
m≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
 &&

463 !
	`vÆid©e_ícodî_œyout
(&
°
->
œyout
))

464  
OPUS_BAD_ARG
;

465 i‡(
m≠pög_ty≥
 =
MAPPING_TYPE_AMBISONICS
 &&

466 !
	`vÆid©e_ambis⁄ics
(
°
->
œyout
.
nb_ch™√ls
, 
NULL
, NULL))

467  
OPUS_BAD_ARG
;

468 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSEncodî
));

469 
cou∂ed_size
 = 
	`›us_ícodî_gë_size
(2);

470 
m⁄o_size
 = 
	`›us_ícodî_gë_size
(1);

472 
i
=0;i<
°
->
œyout
.
nb_cou∂ed_°ªams
;i++)

474 
ªt
 = 
	`›us_ícodî_öô
((
OpusEncodî
*)
±r
, 
Fs
, 2, 
≠∂iˇti⁄
);

475 if(
ªt
!=
OPUS_OK
)Ñet;

476 i‡(
i
==
°
->
l„_°ªam
)

477 
	`›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
	`OPUS_SET_LFE
(1));

478 
±r
 +
	`Æign
(
cou∂ed_size
);

480 ;
i
<
°
->
œyout
.
nb_°ªams
;i++)

482 
ªt
 = 
	`›us_ícodî_öô
((
OpusEncodî
*)
±r
, 
Fs
, 1, 
≠∂iˇti⁄
);

483 i‡(
i
==
°
->
l„_°ªam
)

484 
	`›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
	`OPUS_SET_LFE
(1));

485 if(
ªt
!=
OPUS_OK
)Ñet;

486 
±r
 +
	`Æign
(
m⁄o_size
);

488 i‡(
m≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

490 
	`OPUS_CLEAR
(
	`ms_gë_¥ìmph_mem
(
°
), 
ch™√ls
);

491 
	`OPUS_CLEAR
(
	`ms_gë_wödow_mem
(
°
), 
ch™√ls
*120);

493 
°
->
m≠pög_ty≥
 = mapping_type;

494  
OPUS_OK
;

495 
	}
}

497 
	$›us_mu…i°ªam_ícodî_öô
(

498 
OpusMSEncodî
 *
°
,

499 
›us_öt32
 
Fs
,

500 
ch™√ls
,

501 
°ªams
,

502 
cou∂ed_°ªams
,

503 c⁄° *
m≠pög
,

504 
≠∂iˇti⁄


507  
	`›us_mu…i°ªam_ícodî_öô_im∂
(
°
, 
Fs
, 
ch™√ls
, 
°ªams
,

508 
cou∂ed_°ªams
, 
m≠pög
,

509 
≠∂iˇti⁄
, 
MAPPING_TYPE_NONE
);

510 
	}
}

512 
	$›us_mu…i°ªam_suºound_ícodî_öô
(

513 
OpusMSEncodî
 *
°
,

514 
›us_öt32
 
Fs
,

515 
ch™√ls
,

516 
m≠pög_Ámûy
,

517 *
°ªams
,

518 *
cou∂ed_°ªams
,

519 *
m≠pög
,

520 
≠∂iˇti⁄


523 
M≠pögTy≥
 
m≠pög_ty≥
;

525 i‡((
ch™√ls
>255) || (channels<1))

526  
OPUS_BAD_ARG
;

527 
°
->
l„_°ªam
 = -1;

528 i‡(
m≠pög_Ámûy
==0)

530 i‡(
ch™√ls
==1)

532 *
°ªams
=1;

533 *
cou∂ed_°ªams
=0;

534 
m≠pög
[0]=0;

535 } i‡(
ch™√ls
==2)

537 *
°ªams
=1;

538 *
cou∂ed_°ªams
=1;

539 
m≠pög
[0]=0;

540 
m≠pög
[1]=1;

542  
OPUS_UNIMPLEMENTED
;

543 } i‡(
m≠pög_Ámûy
==1 && 
ch™√ls
<=8 && channels>=1)

545 
i
;

546 *
°ªams
=
v‹bis_m≠pögs
[
ch™√ls
-1].
nb_°ªams
;

547 *
cou∂ed_°ªams
=
v‹bis_m≠pögs
[
ch™√ls
-1].
nb_cou∂ed_°ªams
;

548 
i
=0;i<
ch™√ls
;i++)

549 
m≠pög
[
i
] = 
v‹bis_m≠pögs
[
ch™√ls
-1].mapping[i];

550 i‡(
ch™√ls
>=6)

551 
°
->
l„_°ªam
 = *
°ªams
-1;

552 } i‡(
m≠pög_Ámûy
==255)

554 
i
;

555 *
°ªams
=
ch™√ls
;

556 *
cou∂ed_°ªams
=0;

557 
i
=0;i<
ch™√ls
;i++)

558 
m≠pög
[
i
] = i;

559 } i‡(
m≠pög_Ámûy
==2)

561 
i
;

562 i‡(!
	`vÆid©e_ambis⁄ics
(
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
))

563  
OPUS_BAD_ARG
;

564 
i
 = 0; i < (*
°ªams
 - *
cou∂ed_°ªams
); i++)

565 
m≠pög
[
i
] = i + (*
cou∂ed_°ªams
 * 2);

566 
i
 = 0; i < *
cou∂ed_°ªams
 * 2; i++)

567 
m≠pög
[
i
 + (*
°ªams
 - *
cou∂ed_°ªams
)] = i;

569  
OPUS_UNIMPLEMENTED
;

571 i‡(
ch™√ls
>2 && 
m≠pög_Ámûy
==1) {

572 
m≠pög_ty≥
 = 
MAPPING_TYPE_SURROUND
;

573 } i‡(
m≠pög_Ámûy
==2)

575 
m≠pög_ty≥
 = 
MAPPING_TYPE_AMBISONICS
;

578 
m≠pög_ty≥
 = 
MAPPING_TYPE_NONE
;

580  
	`›us_mu…i°ªam_ícodî_öô_im∂
(
°
, 
Fs
, 
ch™√ls
, *
°ªams
,

581 *
cou∂ed_°ªams
, 
m≠pög
,

582 
≠∂iˇti⁄
, 
m≠pög_ty≥
);

583 
	}
}

585 
OpusMSEncodî
 *
	$›us_mu…i°ªam_ícodî_¸óã
(

586 
›us_öt32
 
Fs
,

587 
ch™√ls
,

588 
°ªams
,

589 
cou∂ed_°ªams
,

590 c⁄° *
m≠pög
,

591 
≠∂iˇti⁄
,

592 *
îr‹


595 
ªt
;

596 
OpusMSEncodî
 *
°
;

597 i‡((
ch™√ls
>255Ë|| (ch™√ls<1Ë|| (
cou∂ed_°ªams
>
°ªams
) ||

598 (
°ªams
<1Ë|| (
cou∂ed_°ªams
<0) || (streams>255-coupled_streams))

600 i‡(
îr‹
)

601 *
îr‹
 = 
OPUS_BAD_ARG
;

602  
NULL
;

604 
°
 = (
OpusMSEncodî
 *)
	`›us_Æloc
(
	`›us_mu…i°ªam_ícodî_gë_size
(
°ªams
, 
cou∂ed_°ªams
));

605 i‡(
°
==
NULL
)

607 i‡(
îr‹
)

608 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

609  
NULL
;

611 
ªt
 = 
	`›us_mu…i°ªam_ícodî_öô
(
°
, 
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
, 
m≠pög
, 
≠∂iˇti⁄
);

612 i‡(
ªt
 !
OPUS_OK
)

614 
	`›us_‰ì
(
°
);

615 
°
 = 
NULL
;

617 i‡(
îr‹
)

618 *
îr‹
 = 
ªt
;

619  
°
;

620 
	}
}

622 
OpusMSEncodî
 *
	$›us_mu…i°ªam_suºound_ícodî_¸óã
(

623 
›us_öt32
 
Fs
,

624 
ch™√ls
,

625 
m≠pög_Ámûy
,

626 *
°ªams
,

627 *
cou∂ed_°ªams
,

628 *
m≠pög
,

629 
≠∂iˇti⁄
,

630 *
îr‹


633 
ªt
;

634 
›us_öt32
 
size
;

635 
OpusMSEncodî
 *
°
;

636 i‡((
ch™√ls
>255) || (channels<1))

638 i‡(
îr‹
)

639 *
îr‹
 = 
OPUS_BAD_ARG
;

640  
NULL
;

642 
size
 = 
	`›us_mu…i°ªam_suºound_ícodî_gë_size
(
ch™√ls
, 
m≠pög_Ámûy
);

643 i‡(!
size
)

645 i‡(
îr‹
)

646 *
îr‹
 = 
OPUS_UNIMPLEMENTED
;

647  
NULL
;

649 
°
 = (
OpusMSEncodî
 *)
	`›us_Æloc
(
size
);

650 i‡(
°
==
NULL
)

652 i‡(
îr‹
)

653 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

654  
NULL
;

656 
ªt
 = 
	`›us_mu…i°ªam_suºound_ícodî_öô
(
°
, 
Fs
, 
ch™√ls
, 
m≠pög_Ámûy
, 
°ªams
, 
cou∂ed_°ªams
, 
m≠pög
, 
≠∂iˇti⁄
);

657 i‡(
ªt
 !
OPUS_OK
)

659 
	`›us_‰ì
(
°
);

660 
°
 = 
NULL
;

662 i‡(
îr‹
)

663 *
îr‹
 = 
ªt
;

664  
°
;

665 
	}
}

667 
	$suºound_øã_Æloˇti⁄
(

668 
OpusMSEncodî
 *
°
,

669 
›us_öt32
 *
øã
,

670 
‰ame_size
,

671 
›us_öt32
 
Fs


674 
i
;

675 
›us_öt32
 
ch™√l_øã
;

676 
°ªam_off£t
;

677 
l„_off£t
;

678 
cou∂ed_øtio
;

679 
l„_øtio
;

680 
nb_l„
;

681 
nb_uncou∂ed
;

682 
nb_cou∂ed
;

683 
nb_n‹mÆ
;

684 
›us_öt32
 
ch™√l_off£t
;

685 
›us_öt32
 
bôøã
;

686 
tŸÆ
;

688 
nb_l„
 = (
°
->
l„_°ªam
!=-1);

689 
nb_cou∂ed
 = 
°
->
œyout
.
nb_cou∂ed_°ªams
;

690 
nb_uncou∂ed
 = 
°
->
œyout
.
nb_°ªams
-
nb_cou∂ed
-
nb_l„
;

691 
nb_n‹mÆ
 = 2*
nb_cou∂ed
 + 
nb_uncou∂ed
;

694 
ch™√l_off£t
 = 40*
	`IMAX
(50, 
Fs
/
‰ame_size
);

696 i‡(
°
->
bôøã_bps
==
OPUS_AUTO
)

698 
bôøã
 = 
nb_n‹mÆ
*(
ch™√l_off£t
 + 
Fs
 + 10000Ë+ 8000*
nb_l„
;

699 } i‡(
°
->
bôøã_bps
==
OPUS_BITRATE_MAX
)

701 
bôøã
 = 
nb_n‹mÆ
*300000 + 
nb_l„
*128000;

703 
bôøã
 = 
°
->
bôøã_bps
;

708 
l„_off£t
 = 
	`IMIN
(
bôøã
/20, 3000Ë+ 15*
	`IMAX
(50, 
Fs
/
‰ame_size
);

712 
°ªam_off£t
 = (
bôøã
 - 
ch™√l_off£t
*
nb_n‹mÆ
 - 
l„_off£t
*
nb_l„
)/nb_normal/2;

713 
°ªam_off£t
 = 
	`IMAX
(0, 
	`IMIN
(20000, stream_offset));

716 
cou∂ed_øtio
 = 512;

718 
l„_øtio
 = 32;

720 
tŸÆ
 = (
nb_uncou∂ed
<<8)

721 + 
cou∂ed_øtio
*
nb_cou∂ed


722 + 
nb_l„
*
l„_øtio
;

723 
ch™√l_øã
 = 256*(
›us_öt64
)(
bôøã
 - 
l„_off£t
*
nb_l„
 - 
°ªam_off£t
*(
nb_cou∂ed
+
nb_uncou∂ed
Ë- 
ch™√l_off£t
*
nb_n‹mÆ
)/
tŸÆ
;

725 
i
=0;i<
°
->
œyout
.
nb_°ªams
;i++)

727 i‡(
i
<
°
->
œyout
.
nb_cou∂ed_°ªams
)

728 
øã
[
i
] = 2*
ch™√l_off£t
 + 
	`IMAX
(0, 
°ªam_off£t
+(
ch™√l_øã
*
cou∂ed_øtio
>>8));

729 i‡(
i
!=
°
->
l„_°ªam
)

730 
øã
[
i
] = 
ch™√l_off£t
 + 
	`IMAX
(0, 
°ªam_off£t
 + 
ch™√l_øã
);

732 
øã
[
i
] = 
	`IMAX
(0, 
l„_off£t
+(
ch™√l_øã
*
l„_øtio
>>8));

734 
	}
}

736 
	$ambis⁄ics_øã_Æloˇti⁄
(

737 
OpusMSEncodî
 *
°
,

738 
›us_öt32
 *
øã
,

739 
‰ame_size
,

740 
›us_öt32
 
Fs


743 
i
;

744 
›us_öt32
 
tŸÆ_øã
;

745 
›us_öt32
 
≥r_°ªam_øã
;

747 c⁄° 
nb_ch™√ls
 = 
°
->
œyout
.
nb_°ªams
 + st->œyout.
nb_cou∂ed_°ªams
;

749 i‡(
°
->
bôøã_bps
==
OPUS_AUTO
)

751 
tŸÆ_øã
 = (
°
->
œyout
.
nb_cou∂ed_°ªams
 + st->œyout.
nb_°ªams
) *

752 (
Fs
+60*Fs/
‰ame_size
Ë+ 
°
->
œyout
.
nb_°ªams
 * (
›us_öt32
)15000;

753 } i‡(
°
->
bôøã_bps
==
OPUS_BITRATE_MAX
)

755 
tŸÆ_øã
 = 
nb_ch™√ls
 * 320000;

758 
tŸÆ_øã
 = 
°
->
bôøã_bps
;

763 
≥r_°ªam_øã
 = 
tŸÆ_øã
 / 
°
->
œyout
.
nb_°ªams
;

764 
i
 = 0; i < 
°
->
œyout
.
nb_°ªams
; i++)

766 
øã
[
i
] = 
≥r_°ªam_øã
;

768 
	}
}

770 
›us_öt32
 
	$øã_Æloˇti⁄
(

771 
OpusMSEncodî
 *
°
,

772 
›us_öt32
 *
øã
,

773 
‰ame_size


776 
i
;

777 
›us_öt32
 
øã_sum
=0;

778 
›us_öt32
 
Fs
;

779 *
±r
;

781 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSEncodî
));

782 
	`›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
	`OPUS_GET_SAMPLE_RATE
(&
Fs
));

784 i‡(
°
->
m≠pög_ty≥
 =
MAPPING_TYPE_AMBISONICS
) {

785 
	`ambis⁄ics_øã_Æloˇti⁄
(
°
, 
øã
, 
‰ame_size
, 
Fs
);

788 
	`suºound_øã_Æloˇti⁄
(
°
, 
øã
, 
‰ame_size
, 
Fs
);

791 
i
=0;i<
°
->
œyout
.
nb_°ªams
;i++)

793 
øã
[
i
] = 
	`IMAX
(rate[i], 500);

794 
øã_sum
 +
øã
[
i
];

796  
øã_sum
;

797 
	}
}

800 
	#MS_FRAME_TMP
 (6*1275+12)

	)

801 
	g›us_mu…i°ªam_ícode_«tive


803 
OpusMSEncodî
 *
	g°
,

804 
›us_c›y_ch™√l_ö_func
 
	gc›y_ch™√l_ö
,

805 c⁄° *
	gpcm
,

806 
	g™Æysis_‰ame_size
,

807 *
	gd©a
,

808 
›us_öt32
 
	gmax_d©a_byãs
,

809 
	glsb_dïth
,

810 
downmix_func
 
	gdownmix
,

811 
	gÊﬂt_≠i
,

812 *
	gu£r_d©a


815 
›us_öt32
 
	gFs
;

816 
	gcou∂ed_size
;

817 
	gm⁄o_size
;

818 
	gs
;

819 *
	g±r
;

820 
	gtŸ_size
;

821 
VARDECL
(
›us_vÆ16
, 
buf
);

822 
VARDECL
(
›us_vÆ16
, 
b™dSMR
);

823 
	gtmp_d©a
[
MS_FRAME_TMP
];

824 
OpusRïackëizî
 
	gΩ
;

825 
›us_öt32
 
	gvbr
;

826 c⁄° 
CELTMode
 *
	g˚…_mode
;

827 
›us_öt32
 
	gbôøãs
[256];

828 
›us_vÆ16
 
	gb™dLogE
[42];

829 
›us_vÆ32
 *
	gmem
 = 
NULL
;

830 
›us_vÆ32
 *
	g¥ìmph_mem
=
NULL
;

831 
	g‰ame_size
;

832 
›us_öt32
 
	gøã_sum
;

833 
›us_öt32
 
	gsmÆÀ°_∑ckë
;

834 
	gALLOC_STACK
;

836 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

838 
¥ìmph_mem
 = 
ms_gë_¥ìmph_mem
(
°
);

839 
	gmem
 = 
ms_gë_wödow_mem
(
°
);

842 
	g±r
 = (*)
°
 + 
Æign
((
OpusMSEncodî
));

843 
›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
OPUS_GET_SAMPLE_RATE
(&
Fs
));

844 
›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
OPUS_GET_VBR
(&
vbr
));

845 
›us_ícodî_˘l
((
OpusEncodî
*)
±r
, 
CELT_GET_MODE
(&
˚…_mode
));

847 
	g‰ame_size
 = 
‰ame_size_£À˘
(
™Æysis_‰ame_size
, 
°
->
v¨übÀ_duøti⁄
, 
Fs
);

848 i‡(
	g‰ame_size
 <= 0)

850 
RESTORE_STACK
;

851  
	gOPUS_BAD_ARG
;

855 
	gsmÆÀ°_∑ckë
 = 
°
->
œyout
.
nb_°ªams
*2-1;

857 i‡(
	gFs
/
	g‰ame_size
 == 10)

858 
smÆÀ°_∑ckë
 +
°
->
œyout
.
nb_°ªams
;

859 i‡(
	gmax_d©a_byãs
 < 
	gsmÆÀ°_∑ckë
)

861 
	gRESTORE_STACK
;

862  
	gOPUS_BUFFER_TOO_SMALL
;

864 
ALLOC
(
buf
, 2*
‰ame_size
, 
›us_vÆ16
);

865 
	gcou∂ed_size
 = 
›us_ícodî_gë_size
(2);

866 
	gm⁄o_size
 = 
›us_ícodî_gë_size
(1);

868 
ALLOC
(
b™dSMR
, 21*
°
->
œyout
.
nb_ch™√ls
, 
›us_vÆ16
);

869 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

871 
suºound_™Æysis
(
˚…_mode
, 
pcm
, 
b™dSMR
, 
mem
, 
¥ìmph_mem
, 
‰ame_size
, 120, 
°
->
œyout
.
nb_ch™√ls
, 
Fs
, 
c›y_ch™√l_ö
, st->
¨ch
);

875 
	gøã_sum
 = 
øã_Æloˇti⁄
(
°
, 
bôøãs
, 
‰ame_size
);

877 i‡(!
	gvbr
)

879 i‡(
	g°
->
	gbôøã_bps
 =
OPUS_AUTO
)

881 
max_d©a_byãs
 = 
IMIN
(max_d©a_byãs, 3*
øã_sum
/(3*8*
Fs
/
‰ame_size
));

882 } i‡(
	g°
->
	gbôøã_bps
 !
OPUS_BITRATE_MAX
)

884 
max_d©a_byãs
 = 
IMIN
(max_d©a_byãs, 
IMAX
(
smÆÀ°_∑ckë
,

885 3*
°
->
bôøã_bps
/(3*8*
Fs
/
‰ame_size
)));

888 
	g±r
 = (*)
°
 + 
Æign
((
OpusMSEncodî
));

889 
	gs
=0;s<
	g°
->
	gœyout
.
	gnb_°ªams
;s++)

891 
OpusEncodî
 *
	gíc
;

892 
	gíc
 = (
OpusEncodî
*)
±r
;

893 i‡(
	gs
 < 
	g°
->
	gœyout
.
	gnb_cou∂ed_°ªams
)

894 
	g±r
 +
Æign
(
cou∂ed_size
);

896 
	g±r
 +
Æign
(
m⁄o_size
);

897 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BITRATE
(
bôøãs
[
s
]));

898 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

900 
›us_öt32
 
equiv_øã
;

901 
	gequiv_øã
 = 
°
->
bôøã_bps
;

902 i‡(
	g‰ame_size
*50 < 
	gFs
)

903 
	gequiv_øã
 -60*(
Fs
/
‰ame_size
 - 50)*
°
->
œyout
.
nb_ch™√ls
;

904 i‡(
	gequiv_øã
 > 10000*
	g°
->
	gœyout
.
	gnb_ch™√ls
)

905 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

906 i‡(
	gequiv_øã
 > 7000*
	g°
->
	gœyout
.
	gnb_ch™√ls
)

907 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_SUPERWIDEBAND
));

908 i‡(
	gequiv_øã
 > 5000*
	g°
->
	gœyout
.
	gnb_ch™√ls
)

909 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_WIDEBAND
));

911 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

912 i‡(
	gs
 < 
	g°
->
	gœyout
.
	gnb_cou∂ed_°ªams
)

915 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_FORCE_MODE
(
MODE_CELT_ONLY
));

916 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_FORCE_CHANNELS
(2));

919 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_AMBISONICS
) {

920 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_FORCE_MODE
(
MODE_CELT_ONLY
));

924 
	g±r
 = (*)
°
 + 
Æign
((
OpusMSEncodî
));

926 
	gtŸ_size
 = 0;

927 
	gs
=0;s<
	g°
->
	gœyout
.
	gnb_°ªams
;s++)

929 
OpusEncodî
 *
	gíc
;

930 
	gÀn
;

931 
	gcuº_max
;

932 
	gc1
, 
	gc2
;

933 
	gªt
;

935 
›us_ª∑ckëizî_öô
(&
Ω
);

936 
	gíc
 = (
OpusEncodî
*)
±r
;

937 i‡(
	gs
 < 
	g°
->
	gœyout
.
	gnb_cou∂ed_°ªams
)

939 
	gi
;

940 
	gÀ·
, 
	gright
;

941 
	gÀ·
 = 
gë_À·_ch™√l
(&
°
->
œyout
, 
s
, -1);

942 
	gright
 = 
gë_right_ch™√l
(&
°
->
œyout
, 
s
, -1);

943 (*
	gc›y_ch™√l_ö
)(
	gbuf
, 2,

944 
	gpcm
, 
	g°
->
	gœyout
.
	gnb_ch™√ls
, 
	gÀ·
, 
	g‰ame_size
, 
	gu£r_d©a
);

945 (*
	gc›y_ch™√l_ö
)(
	gbuf
+1, 2,

946 
	gpcm
, 
	g°
->
	gœyout
.
	gnb_ch™√ls
, 
	gright
, 
	g‰ame_size
, 
	gu£r_d©a
);

947 
	g±r
 +
Æign
(
cou∂ed_size
);

948 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

950 
i
=0;
	gi
<21;i++)

952 
	gb™dLogE
[
i
] = 
b™dSMR
[21*
À·
+i];

953 
	gb™dLogE
[21+
i
] = 
b™dSMR
[21*
right
+i];

956 
	gc1
 = 
À·
;

957 
	gc2
 = 
right
;

959 
	gi
;

960 
	gch™
 = 
gë_m⁄o_ch™√l
(&
°
->
œyout
, 
s
, -1);

961 (*
	gc›y_ch™√l_ö
)(
	gbuf
, 1,

962 
	gpcm
, 
	g°
->
	gœyout
.
	gnb_ch™√ls
, 
	gch™
, 
	g‰ame_size
, 
	gu£r_d©a
);

963 
	g±r
 +
Æign
(
m⁄o_size
);

964 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

966 
i
=0;
	gi
<21;i++)

967 
	gb™dLogE
[
i
] = 
b™dSMR
[21*
ch™
+i];

969 
	gc1
 = 
ch™
;

970 
	gc2
 = -1;

972 i‡(
	g°
->
	gm≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

973 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_ENERGY_MASK
(
b™dLogE
));

975 
	gcuº_max
 = 
max_d©a_byãs
 - 
tŸ_size
;

977 
	gcuº_max
 -
IMAX
(0,2*(
°
->
œyout
.
nb_°ªams
-
s
-1)-1);

979 i‡(
	gFs
/
	g‰ame_size
 == 10)

980 
cuº_max
 -
°
->
œyout
.
nb_°ªams
-
s
-1;

981 
	gcuº_max
 = 
IMIN
(
cuº_max
,
MS_FRAME_TMP
);

983 i‡(
	gs
 !
°
->
œyout
.
nb_°ªams
-1Ë
cuº_max
 -= curr_max>253 ? 2 : 1;

984 i‡(!
	gvbr
 && 
	gs
 =
°
->
œyout
.
nb_°ªams
-1)

985 
›us_ícodî_˘l
(
íc
, 
OPUS_SET_BITRATE
(
cuº_max
*(8*
Fs
/
‰ame_size
)));

986 
	gÀn
 = 
›us_ícode_«tive
(
íc
, 
buf
, 
‰ame_size
, 
tmp_d©a
, 
cuº_max
, 
lsb_dïth
,

987 
pcm
, 
™Æysis_‰ame_size
, 
c1
, 
c2
, 
°
->
œyout
.
nb_ch™√ls
, 
downmix
, 
Êﬂt_≠i
);

988 i‡(
	gÀn
<0)

990 
	gRESTORE_STACK
;

991  
	gÀn
;

996 
	gªt
 = 
›us_ª∑ckëizî_ˇt
(&
Ω
, 
tmp_d©a
, 
Àn
);

999 i‡(
	gªt
 !
OPUS_OK
)

1001 
RESTORE_STACK
;

1002  
	gOPUS_INTERNAL_ERROR
;

1004 
	gÀn
 = 
›us_ª∑ckëizî_out_ønge_im∂
(&
Ω
, 0, 
›us_ª∑ckëizî_gë_nb_‰ames
(&rp),

1005 
d©a
, 
max_d©a_byãs
-
tŸ_size
, 
s
 !
°
->
œyout
.
nb_°ªams
-1, !
vbr
 && s == st->layout.nb_streams-1);

1006 
	gd©a
 +
Àn
;

1007 
	gtŸ_size
 +
Àn
;

1010 
	gRESTORE_STACK
;

1011  
	gtŸ_size
;

1014 #i‡!
deföed
(
DISABLE_FLOAT_API
)

1015 
	$›us_c›y_ch™√l_ö_Êﬂt
(

1016 
›us_vÆ16
 *
d°
,

1017 
d°_°ride
,

1018 c⁄° *
§c
,

1019 
§c_°ride
,

1020 
§c_ch™√l
,

1021 
‰ame_size
,

1022 *
u£r_d©a


1025 c⁄° *
Êﬂt_§c
;

1026 
›us_öt32
 
i
;

1027 ()
u£r_d©a
;

1028 
Êﬂt_§c
 = (c⁄° *)
§c
;

1029 
i
=0;i<
‰ame_size
;i++)

1030 #i‡
	`deföed
(
FIXED_POINT
)

1031 
d°
[
i
*
d°_°ride
] = 
	`FLOAT2INT16
(
Êﬂt_§c
[i*
§c_°ride
+
§c_ch™√l
]);

1033 
d°
[
i
*
d°_°ride
] = 
Êﬂt_§c
[i*
§c_°ride
+
§c_ch™√l
];

1035 
	}
}

1038 
	$›us_c›y_ch™√l_ö_sh‹t
(

1039 
›us_vÆ16
 *
d°
,

1040 
d°_°ride
,

1041 c⁄° *
§c
,

1042 
§c_°ride
,

1043 
§c_ch™√l
,

1044 
‰ame_size
,

1045 *
u£r_d©a


1048 c⁄° 
›us_öt16
 *
sh‹t_§c
;

1049 
›us_öt32
 
i
;

1050 ()
u£r_d©a
;

1051 
sh‹t_§c
 = (c⁄° 
›us_öt16
 *)
§c
;

1052 
i
=0;i<
‰ame_size
;i++)

1053 #i‡
	`deföed
(
FIXED_POINT
)

1054 
d°
[
i
*
d°_°ride
] = 
sh‹t_§c
[i*
§c_°ride
+
§c_ch™√l
];

1056 
d°
[
i
*
d°_°ride
] = (1/32768.f)*
sh‹t_§c
[i*
§c_°ride
+
§c_ch™√l
];

1058 
	}
}

1061 #ifde‡
FIXED_POINT


1062 
	$›us_mu…i°ªam_ícode
(

1063 
OpusMSEncodî
 *
°
,

1064 c⁄° 
›us_vÆ16
 *
pcm
,

1065 
‰ame_size
,

1066 *
d©a
,

1067 
›us_öt32
 
max_d©a_byãs


1070  
	`›us_mu…i°ªam_ícode_«tive
(
°
, 
›us_c›y_ch™√l_ö_sh‹t
,

1071 
pcm
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 16, 
downmix_öt
, 0, 
NULL
);

1072 
	}
}

1074 #i‚de‡
DISABLE_FLOAT_API


1075 
	$›us_mu…i°ªam_ícode_Êﬂt
(

1076 
OpusMSEncodî
 *
°
,

1077 c⁄° *
pcm
,

1078 
‰ame_size
,

1079 *
d©a
,

1080 
›us_öt32
 
max_d©a_byãs


1083  
	`›us_mu…i°ªam_ícode_«tive
(
°
, 
›us_c›y_ch™√l_ö_Êﬂt
,

1084 
pcm
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 16, 
downmix_Êﬂt
, 1, 
NULL
);

1085 
	}
}

1090 
	g›us_mu…i°ªam_ícode_Êﬂt


1092 
OpusMSEncodî
 *
	g°
,

1093 c⁄° 
›us_vÆ16
 *
	gpcm
,

1094 
	g‰ame_size
,

1095 *
	gd©a
,

1096 
›us_öt32
 
	gmax_d©a_byãs


1099  
›us_mu…i°ªam_ícode_«tive
(
°
, 
›us_c›y_ch™√l_ö_Êﬂt
,

1100 
pcm
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 24, 
downmix_Êﬂt
, 1, 
NULL
);

1103 
	$›us_mu…i°ªam_ícode
(

1104 
OpusMSEncodî
 *
°
,

1105 c⁄° 
›us_öt16
 *
pcm
,

1106 
‰ame_size
,

1107 *
d©a
,

1108 
›us_öt32
 
max_d©a_byãs


1111  
	`›us_mu…i°ªam_ícode_«tive
(
°
, 
›us_c›y_ch™√l_ö_sh‹t
,

1112 
pcm
, 
‰ame_size
, 
d©a
, 
max_d©a_byãs
, 16, 
downmix_öt
, 0, 
NULL
);

1113 
	}
}

1116 
	$›us_mu…i°ªam_ícodî_˘l_va_li°
(
OpusMSEncodî
 *
°
, 
ªque°
,

1117 
va_li°
 
≠
)

1119 
cou∂ed_size
, 
m⁄o_size
;

1120 *
±r
;

1121 
ªt
 = 
OPUS_OK
;

1123 
cou∂ed_size
 = 
	`›us_ícodî_gë_size
(2);

1124 
m⁄o_size
 = 
	`›us_ícodî_gë_size
(1);

1125 
±r
 = (*)
°
 + 
	`Æign
((
OpusMSEncodî
));

1126 
ªque°
)

1128 
OPUS_SET_BITRATE_REQUEST
:

1130 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1131 i‡(
vÆue
 !
OPUS_AUTO
 && vÆuê!
OPUS_BITRATE_MAX
)

1133 i‡(
vÆue
 <= 0)

1134 
bad_¨g
;

1135 
vÆue
 = 
	`IMIN
(300000*
°
->
œyout
.
nb_ch™√ls
, 
	`IMAX
(500*st->layout.nb_channels, value));

1137 
°
->
bôøã_bps
 = 
vÆue
;

1140 
OPUS_GET_BITRATE_REQUEST
:

1142 
s
;

1143 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1144 i‡(!
vÆue
)

1146 
bad_¨g
;

1148 *
vÆue
 = 0;

1149 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

1151 
›us_öt32
 
øã
;

1152 
OpusEncodî
 *
íc
;

1153 
íc
 = (
OpusEncodî
*)
±r
;

1154 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

1155 
±r
 +
	`Æign
(
cou∂ed_size
);

1157 
±r
 +
	`Æign
(
m⁄o_size
);

1158 
	`›us_ícodî_˘l
(
íc
, 
ªque°
, &
øã
);

1159 *
vÆue
 +
øã
;

1163 
OPUS_GET_LSB_DEPTH_REQUEST
:

1164 
OPUS_GET_VBR_REQUEST
:

1165 
OPUS_GET_APPLICATION_REQUEST
:

1166 
OPUS_GET_BANDWIDTH_REQUEST
:

1167 
OPUS_GET_COMPLEXITY_REQUEST
:

1168 
OPUS_GET_PACKET_LOSS_PERC_REQUEST
:

1169 
OPUS_GET_DTX_REQUEST
:

1170 
OPUS_GET_VOICE_RATIO_REQUEST
:

1171 
OPUS_GET_VBR_CONSTRAINT_REQUEST
:

1172 
OPUS_GET_SIGNAL_REQUEST
:

1173 
OPUS_GET_LOOKAHEAD_REQUEST
:

1174 
OPUS_GET_SAMPLE_RATE_REQUEST
:

1175 
OPUS_GET_INBAND_FEC_REQUEST
:

1176 
OPUS_GET_FORCE_CHANNELS_REQUEST
:

1177 
OPUS_GET_PREDICTION_DISABLED_REQUEST
:

1178 
OPUS_GET_PHASE_INVERSION_DISABLED_REQUEST
:

1180 
OpusEncodî
 *
íc
;

1182 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1183 
íc
 = (
OpusEncodî
*)
±r
;

1184 
ªt
 = 
	`›us_ícodî_˘l
(
íc
, 
ªque°
, 
vÆue
);

1187 
OPUS_GET_FINAL_RANGE_REQUEST
:

1189 
s
;

1190 
›us_uöt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_uint32*);

1191 
›us_uöt32
 
tmp
;

1192 i‡(!
vÆue
)

1194 
bad_¨g
;

1196 *
vÆue
=0;

1197 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

1199 
OpusEncodî
 *
íc
;

1200 
íc
 = (
OpusEncodî
*)
±r
;

1201 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

1202 
±r
 +
	`Æign
(
cou∂ed_size
);

1204 
±r
 +
	`Æign
(
m⁄o_size
);

1205 
ªt
 = 
	`›us_ícodî_˘l
(
íc
, 
ªque°
, &
tmp
);

1206 i‡(
ªt
 !
OPUS_OK
) ;

1207 *
vÆue
 ^
tmp
;

1211 
OPUS_SET_LSB_DEPTH_REQUEST
:

1212 
OPUS_SET_COMPLEXITY_REQUEST
:

1213 
OPUS_SET_VBR_REQUEST
:

1214 
OPUS_SET_VBR_CONSTRAINT_REQUEST
:

1215 
OPUS_SET_MAX_BANDWIDTH_REQUEST
:

1216 
OPUS_SET_BANDWIDTH_REQUEST
:

1217 
OPUS_SET_SIGNAL_REQUEST
:

1218 
OPUS_SET_APPLICATION_REQUEST
:

1219 
OPUS_SET_INBAND_FEC_REQUEST
:

1220 
OPUS_SET_PACKET_LOSS_PERC_REQUEST
:

1221 
OPUS_SET_DTX_REQUEST
:

1222 
OPUS_SET_FORCE_MODE_REQUEST
:

1223 
OPUS_SET_FORCE_CHANNELS_REQUEST
:

1224 
OPUS_SET_PREDICTION_DISABLED_REQUEST
:

1225 
OPUS_SET_PHASE_INVERSION_DISABLED_REQUEST
:

1227 
s
;

1229 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1230 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

1232 
OpusEncodî
 *
íc
;

1234 
íc
 = (
OpusEncodî
*)
±r
;

1235 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

1236 
±r
 +
	`Æign
(
cou∂ed_size
);

1238 
±r
 +
	`Æign
(
m⁄o_size
);

1239 
ªt
 = 
	`›us_ícodî_˘l
(
íc
, 
ªque°
, 
vÆue
);

1240 i‡(
ªt
 !
OPUS_OK
)

1245 
OPUS_MULTISTREAM_GET_ENCODER_STATE_REQUEST
:

1247 
s
;

1248 
›us_öt32
 
°ªam_id
;

1249 
OpusEncodî
 **
vÆue
;

1250 
°ªam_id
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

1251 i‡(
°ªam_id
<0 || såóm_id >
°
->
œyout
.
nb_°ªams
)

1252 
bad_¨g
;

1253 
vÆue
 = 
	`va_¨g
(
≠
, 
OpusEncodî
**);

1254 i‡(!
vÆue
)

1256 
bad_¨g
;

1258 
s
=0;s<
°ªam_id
;s++)

1260 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

1261 
±r
 +
	`Æign
(
cou∂ed_size
);

1263 
±r
 +
	`Æign
(
m⁄o_size
);

1265 *
vÆue
 = (
OpusEncodî
*)
±r
;

1268 
OPUS_SET_EXPERT_FRAME_DURATION_REQUEST
:

1270 
›us_öt32
 
vÆue
 = 
	`va_¨g
(
≠
, opus_int32);

1271 
°
->
v¨übÀ_duøti⁄
 = 
vÆue
;

1274 
OPUS_GET_EXPERT_FRAME_DURATION_REQUEST
:

1276 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

1277 i‡(!
vÆue
)

1279 
bad_¨g
;

1281 *
vÆue
 = 
°
->
v¨übÀ_duøti⁄
;

1284 
OPUS_RESET_STATE
:

1286 
s
;

1287 i‡(
°
->
m≠pög_ty≥
 =
MAPPING_TYPE_SURROUND
)

1289 
	`OPUS_CLEAR
(
	`ms_gë_¥ìmph_mem
(
°
), st->
œyout
.
nb_ch™√ls
);

1290 
	`OPUS_CLEAR
(
	`ms_gë_wödow_mem
(
°
), st->
œyout
.
nb_ch™√ls
*120);

1292 
s
=0;s<
°
->
œyout
.
nb_°ªams
;s++)

1294 
OpusEncodî
 *
íc
;

1295 
íc
 = (
OpusEncodî
*)
±r
;

1296 i‡(
s
 < 
°
->
œyout
.
nb_cou∂ed_°ªams
)

1297 
±r
 +
	`Æign
(
cou∂ed_size
);

1299 
±r
 +
	`Æign
(
m⁄o_size
);

1300 
ªt
 = 
	`›us_ícodî_˘l
(
íc
, 
OPUS_RESET_STATE
);

1301 i‡(
ªt
 !
OPUS_OK
)

1307 
ªt
 = 
OPUS_UNIMPLEMENTED
;

1310  
ªt
;

1311 
bad_¨g
:

1312  
OPUS_BAD_ARG
;

1313 
	}
}

1315 
	$›us_mu…i°ªam_ícodî_˘l
(
OpusMSEncodî
 *
°
, 
ªque°
, ...)

1317 
ªt
;

1318 
va_li°
 
≠
;

1319 
	`va_°¨t
(
≠
, 
ªque°
);

1320 
ªt
 = 
	`›us_mu…i°ªam_ícodî_˘l_va_li°
(
°
, 
ªque°
, 
≠
);

1321 
	`va_íd
(
≠
);

1322  
ªt
;

1323 
	}
}

1325 
	$›us_mu…i°ªam_ícodî_de°roy
(
OpusMSEncodî
 *
°
)

1327 
	`›us_‰ì
(
°
);

1328 
	}
}

	@src/opus_private.h

29 #i‚de‡
OPUS_PRIVATE_H


30 
	#OPUS_PRIVATE_H


	)

32 
	~"¨ch.h
"

33 
	~"›us.h
"

34 
	~"˚….h
"

36 
	~<°d¨g.h
>

37 
	~<°ddef.h
>

39 
	sOpusRïackëizî
 {

40 
	mtoc
;

41 
	mnb_‰ames
;

42 c⁄° *
	m‰ames
[48];

43 
›us_öt16
 
	mÀn
[48];

44 
	m‰amesize
;

47 
	sCh™√lLayout
 {

48 
	mnb_ch™√ls
;

49 
	mnb_°ªams
;

50 
	mnb_cou∂ed_°ªams
;

51 
	mm≠pög
[256];

52 } 
	tCh™√lLayout
;

55 
	mMAPPING_TYPE_NONE
,

56 
	mMAPPING_TYPE_SURROUND
,

57 
	mMAPPING_TYPE_AMBISONICS


58 } 
	tM≠pögTy≥
;

60 
	sOpusMSEncodî
 {

61 
Ch™√lLayout
 
	mœyout
;

62 
	m¨ch
;

63 
	ml„_°ªam
;

64 
	m≠∂iˇti⁄
;

65 
	mv¨übÀ_duøti⁄
;

66 
M≠pögTy≥
 
	mm≠pög_ty≥
;

67 
›us_öt32
 
	mbôøã_bps
;

73 
	sOpusMSDecodî
 {

74 
Ch™√lLayout
 
	mœyout
;

78 
›us_mu…i°ªam_ícodî_˘l_va_li°
(
OpusMSEncodî
 *
°
, 
ªque°
,

79 
va_li°
 
≠
);

80 
›us_mu…i°ªam_decodî_˘l_va_li°
(
OpusMSDecodî
 *
°
, 
ªque°
,

81 
va_li°
 
≠
);

83 
vÆid©e_œyout
(c⁄° 
Ch™√lLayout
 *
œyout
);

84 
gë_À·_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
);

85 
gë_right_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
);

86 
gë_m⁄o_ch™√l
(c⁄° 
Ch™√lLayout
 *
œyout
, 
°ªam_id
, 
¥ev
);

88 (*
	t›us_c›y_ch™√l_ö_func
)(

89 
	t›us_vÆ16
 *
	td°
,

90 
	td°_°ride
,

91 c⁄° *
	t§c
,

92 
	t§c_°ride
,

93 
	t§c_ch™√l
,

94 
	t‰ame_size
,

95 *
	tu£r_d©a


98 (*
	t›us_c›y_ch™√l_out_func
)(

99 *
	td°
,

100 
	td°_°ride
,

101 
	td°_ch™√l
,

102 c⁄° 
	t›us_vÆ16
 *
	t§c
,

103 
	t§c_°ride
,

104 
	t‰ame_size
,

105 *
	tu£r_d©a


108 
	#MODE_SILK_ONLY
 1000

	)

109 
	#MODE_HYBRID
 1001

	)

110 
	#MODE_CELT_ONLY
 1002

	)

112 
	#OPUS_SET_VOICE_RATIO_REQUEST
 11018

	)

113 
	#OPUS_GET_VOICE_RATIO_REQUEST
 11019

	)

124 
	#OPUS_SET_VOICE_RATIO
(
x
Ë
OPUS_SET_VOICE_RATIO_REQUEST
, 
	`__›us_check_öt
(x)

	)

129 
	#OPUS_GET_VOICE_RATIO
(
x
Ë
OPUS_GET_VOICE_RATIO_REQUEST
, 
	`__›us_check_öt_±r
(x)

	)

132 
	#OPUS_SET_FORCE_MODE_REQUEST
 11002

	)

133 
	#OPUS_SET_FORCE_MODE
(
x
Ë
OPUS_SET_FORCE_MODE_REQUEST
, 
	`__›us_check_öt
(x)

	)

135 (*
	tdownmix_func
)(c⁄° *, 
	t›us_vÆ32
 *, , , , , );

136 
	`downmix_Êﬂt
(c⁄° *
_x
, 
›us_vÆ32
 *
sub
, 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
);

137 
	`downmix_öt
(c⁄° *
_x
, 
›us_vÆ32
 *
sub
, 
sub‰ame
, 
off£t
, 
c1
, 
c2
, 
C
);

138 
	`is_digôÆ_sûí˚
(c⁄° 
›us_vÆ16
* 
pcm
, 
‰ame_size
, 
ch™√ls
, 
lsb_dïth
);

140 
	`ícode_size
(
size
, *
d©a
);

142 
›us_öt32
 
	`‰ame_size_£À˘
(›us_öt32 
‰ame_size
, 
v¨übÀ_duøti⁄
, opus_öt32 
Fs
);

144 
›us_öt32
 
	`›us_ícode_«tive
(
OpusEncodî
 *
°
, c⁄° 
›us_vÆ16
 *
pcm
, 
‰ame_size
,

145 *
d©a
, 
›us_öt32
 
out_d©a_byãs
, 
lsb_dïth
,

146 c⁄° *
™Æysis_pcm
, 
›us_öt32
 
™Æysis_size
, 
c1
, 
c2
,

147 
™Æysis_ch™√ls
, 
downmix_func
 
downmix
, 
Êﬂt_≠i
);

149 
	`›us_decode_«tive
(
OpusDecodî
 *
°
, c⁄° *
d©a
, 
›us_öt32
 
Àn
,

150 
›us_vÆ16
 *
pcm
, 
‰ame_size
, 
decode_„c
, 
£lf_dñimôed
,

151 
›us_öt32
 *
∑ckë_off£t
, 
so·_˛ù
);

154 
OPUS_INLINE
 
	$Æign
(
i
)

156 
	sfoo
 {
c
; uni⁄ { * 
p
; 
›us_öt32
 
i
; 
›us_vÆ32
 
v
; } 
u
;};

158 
Æignmít
 = 
	`off£tof
(
foo
, 
u
);

162  ((
i
 + 
Æignmít
 - 1) /álignment) *álignment;

163 
	}
}

165 
›us_∑ckë_∑r£_im∂
(c⁄° *
d©a
, 
›us_öt32
 
Àn
,

166 
£lf_dñimôed
, *
out_toc
,

167 c⁄° *
‰ames
[48], 
›us_öt16
 
size
[48],

168 *
∑ylﬂd_off£t
, 
›us_öt32
 *
∑ckë_off£t
);

170 
›us_öt32
 
›us_ª∑ckëizî_out_ønge_im∂
(
OpusRïackëizî
 *
Ω
, 
begö
, 
íd
,

171 *
d©a
, 
›us_öt32
 
maxÀn
, 
£lf_dñimôed
, 
∑d
);

173 
∑d_‰ame
(*
d©a
, 
›us_öt32
 
Àn
, opus_öt32 
√w_Àn
);

175 
	g›us_mu…i°ªam_ícode_«tive


177 
OpusMSEncodî
 *
	g°
,

178 
›us_c›y_ch™√l_ö_func
 
	gc›y_ch™√l_ö
,

179 c⁄° *
	gpcm
,

180 
	g™Æysis_‰ame_size
,

181 *
	gd©a
,

182 
›us_öt32
 
	gmax_d©a_byãs
,

183 
	glsb_dïth
,

184 
downmix_func
 
	gdownmix
,

185 
	gÊﬂt_≠i
,

186 *
	gu£r_d©a


189 
›us_mu…i°ªam_decode_«tive
(

190 
OpusMSDecodî
 *
°
,

191 c⁄° *
d©a
,

192 
›us_öt32
 
Àn
,

193 *
pcm
,

194 
›us_c›y_ch™√l_out_func
 
c›y_ch™√l_out
,

195 
‰ame_size
,

196 
decode_„c
,

197 
so·_˛ù
,

198 *
u£r_d©a


	@src/opus_projection_decoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"m©h›s.h
"

33 
	~"os_suµ‹t.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"›us_deföes.h
"

36 
	~"›us_¥oje˘i⁄.h
"

37 
	~"›us_mu…i°ªam.h
"

38 
	~"m≠pög_m©rix.h
"

39 
	~"°ack_Æloc.h
"

41 
	sOpusProje˘i⁄Decodî


43 
›us_öt32
 
	mdemixög_m©rix_size_ö_byãs
;

47 #i‡!
deföed
(
DISABLE_FLOAT_API
)

48 
	$›us_¥oje˘i⁄_c›y_ch™√l_out_Êﬂt
(

49 *
d°
,

50 
d°_°ride
,

51 
d°_ch™√l
,

52 c⁄° 
›us_vÆ16
 *
§c
,

53 
§c_°ride
,

54 
‰ame_size
,

55 *
u£r_d©a
)

57 *
Êﬂt_d°
;

58 c⁄° 
M≠pögM©rix
 *
m©rix
;

59 
Êﬂt_d°
 = (*)
d°
;

60 
m©rix
 = (c⁄° 
M≠pögM©rix
 *)
u£r_d©a
;

62 i‡(
d°_ch™√l
 == 0)

63 
	`OPUS_CLEAR
(
Êﬂt_d°
, 
‰ame_size
 * 
d°_°ride
);

65 i‡(
§c
 !
NULL
)

66 
	`m≠pög_m©rix_mu…ùly_ch™√l_out_Êﬂt
(
m©rix
, 
§c
, 
d°_ch™√l
,

67 
§c_°ride
, 
Êﬂt_d°
, 
d°_°ride
, 
‰ame_size
);

68 
	}
}

71 
	$›us_¥oje˘i⁄_c›y_ch™√l_out_sh‹t
(

72 *
d°
,

73 
d°_°ride
,

74 
d°_ch™√l
,

75 c⁄° 
›us_vÆ16
 *
§c
,

76 
§c_°ride
,

77 
‰ame_size
,

78 *
u£r_d©a
)

80 
›us_öt16
 *
sh‹t_d°
;

81 c⁄° 
M≠pögM©rix
 *
m©rix
;

82 
sh‹t_d°
 = (
›us_öt16
 *)
d°
;

83 
m©rix
 = (c⁄° 
M≠pögM©rix
 *)
u£r_d©a
;

84 i‡(
d°_ch™√l
 == 0)

85 
	`OPUS_CLEAR
(
sh‹t_d°
, 
‰ame_size
 * 
d°_°ride
);

87 i‡(
§c
 !
NULL
)

88 
	`m≠pög_m©rix_mu…ùly_ch™√l_out_sh‹t
(
m©rix
, 
§c
, 
d°_ch™√l
,

89 
§c_°ride
, 
sh‹t_d°
, 
d°_°ride
, 
‰ame_size
);

90 
	}
}

92 
M≠pögM©rix
 *
	$gë_dec_demixög_m©rix
(
OpusProje˘i⁄Decodî
 *
°
)

95  (
M≠pögM©rix
*)(*)((*)
°
 +

96 
	`Æign
((
OpusProje˘i⁄Decodî
)));

97 
	}
}

99 
OpusMSDecodî
 *
	$gë_mu…i°ªam_decodî
(
OpusProje˘i⁄Decodî
 *
°
)

102  (
OpusMSDecodî
*)(*)((*)
°
 +

103 
	`Æign
((
OpusProje˘i⁄Decodî
) +

104 
°
->
demixög_m©rix_size_ö_byãs
));

105 
	}
}

107 
›us_öt32
 
	$›us_¥oje˘i⁄_decodî_gë_size
(
ch™√ls
, 
°ªams
,

108 
cou∂ed_°ªams
)

110 
›us_öt32
 
m©rix_size
;

111 
›us_öt32
 
decodî_size
;

113 
m©rix_size
 =

114 
	`m≠pög_m©rix_gë_size
(
°ªams
 + 
cou∂ed_°ªams
, 
ch™√ls
);

115 i‡(!
m©rix_size
)

118 
decodî_size
 = 
	`›us_mu…i°ªam_decodî_gë_size
(
°ªams
, 
cou∂ed_°ªams
);

119 i‡(!
decodî_size
)

122  
	`Æign
((
OpusProje˘i⁄Decodî
)Ë+ 
m©rix_size
 + 
decodî_size
;

123 
	}
}

125 
	$›us_¥oje˘i⁄_decodî_öô
(
OpusProje˘i⁄Decodî
 *
°
, 
›us_öt32
 
Fs
,

126 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
,

127 *
demixög_m©rix
, 
›us_öt32
 
demixög_m©rix_size
)

129 
nb_öput_°ªams
;

130 
›us_öt32
 
ex≥˘ed_m©rix_size
;

131 
i
, 
ªt
;

132 
m≠pög
[255];

133 
	`VARDECL
(
›us_öt16
, 
buf
);

134 
ALLOC_STACK
;

137 
nb_öput_°ªams
 = 
°ªams
 + 
cou∂ed_°ªams
;

138 
ex≥˘ed_m©rix_size
 = 
nb_öput_°ªams
 * 
ch™√ls
 * (
›us_öt16
);

139 i‡(
ex≥˘ed_m©rix_size
 !
demixög_m©rix_size
)

141 
RESTORE_STACK
;

142  
OPUS_BAD_ARG
;

146 
	`ALLOC
(
buf
, 
nb_öput_°ªams
 * 
ch™√ls
, 
›us_öt16
);

147 
i
 = 0; i < 
nb_öput_°ªams
 * 
ch™√ls
; i++)

149 
s
 = 
demixög_m©rix
[2*
i
 + 1] << 8 | demixing_matrix[2*i];

150 
s
 = ((s & 0xFFFF) ^ 0x8000) - 0x8000;

151 
buf
[
i
] = (
›us_öt16
)
s
;

155 
°
->
demixög_m©rix_size_ö_byãs
 =

156 
	`m≠pög_m©rix_gë_size
(
ch™√ls
, 
nb_öput_°ªams
);

157 i‡(!
°
->
demixög_m©rix_size_ö_byãs
)

159 
RESTORE_STACK
;

160  
OPUS_BAD_ARG
;

163 
	`m≠pög_m©rix_öô
(
	`gë_dec_demixög_m©rix
(
°
), 
ch™√ls
, 
nb_öput_°ªams
, 0,

164 
buf
, 
demixög_m©rix_size
);

167 
i
 = 0; i < 
ch™√ls
; i++)

168 
m≠pög
[
i
] = i;

170 
ªt
 = 
	`›us_mu…i°ªam_decodî_öô
(

171 
	`gë_mu…i°ªam_decodî
(
°
), 
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
, 
m≠pög
);

172 
RESTORE_STACK
;

173  
ªt
;

174 
	}
}

176 
OpusProje˘i⁄Decodî
 *
	$›us_¥oje˘i⁄_decodî_¸óã
(

177 
›us_öt32
 
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
,

178 *
demixög_m©rix
, 
›us_öt32
 
demixög_m©rix_size
, *
îr‹
)

180 
size
;

181 
ªt
;

182 
OpusProje˘i⁄Decodî
 *
°
;

185 
size
 = 
	`›us_¥oje˘i⁄_decodî_gë_size
(
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
);

186 i‡(!
size
) {

187 i‡(
îr‹
)

188 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

189  
NULL
;

191 
°
 = (
OpusProje˘i⁄Decodî
 *)
	`›us_Æloc
(
size
);

192 i‡(!
°
)

194 i‡(
îr‹
)

195 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

196  
NULL
;

200 
ªt
 = 
	`›us_¥oje˘i⁄_decodî_öô
(
°
, 
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed_°ªams
,

201 
demixög_m©rix
, 
demixög_m©rix_size
);

202 i‡(
ªt
 !
OPUS_OK
)

204 
	`›us_‰ì
(
°
);

205 
°
 = 
NULL
;

207 i‡(
îr‹
)

208 *
îr‹
 = 
ªt
;

209  
°
;

210 
	}
}

212 #ifde‡
FIXED_POINT


213 
	$›us_¥oje˘i⁄_decode
(
OpusProje˘i⁄Decodî
 *
°
, c⁄° *
d©a
,

214 
›us_öt32
 
Àn
, 
›us_öt16
 *
pcm
, 
‰ame_size
,

215 
decode_„c
)

217  
	`›us_mu…i°ªam_decode_«tive
(
	`gë_mu…i°ªam_decodî
(
°
), 
d©a
, 
Àn
,

218 
pcm
, 
›us_¥oje˘i⁄_c›y_ch™√l_out_sh‹t
, 
‰ame_size
, 
decode_„c
, 0,

219 
	`gë_dec_demixög_m©rix
(
°
));

220 
	}
}

222 
	$›us_¥oje˘i⁄_decode
(
OpusProje˘i⁄Decodî
 *
°
, c⁄° *
d©a
,

223 
›us_öt32
 
Àn
, 
›us_öt16
 *
pcm
, 
‰ame_size
,

224 
decode_„c
)

226  
	`›us_mu…i°ªam_decode_«tive
(
	`gë_mu…i°ªam_decodî
(
°
), 
d©a
, 
Àn
,

227 
pcm
, 
›us_¥oje˘i⁄_c›y_ch™√l_out_sh‹t
, 
‰ame_size
, 
decode_„c
, 1,

228 
	`gë_dec_demixög_m©rix
(
°
));

229 
	}
}

232 #i‚de‡
DISABLE_FLOAT_API


233 
	$›us_¥oje˘i⁄_decode_Êﬂt
(
OpusProje˘i⁄Decodî
 *
°
, c⁄° *
d©a
,

234 
›us_öt32
 
Àn
, *
pcm
, 
‰ame_size
, 
decode_„c
)

236  
	`›us_mu…i°ªam_decode_«tive
(
	`gë_mu…i°ªam_decodî
(
°
), 
d©a
, 
Àn
,

237 
pcm
, 
›us_¥oje˘i⁄_c›y_ch™√l_out_Êﬂt
, 
‰ame_size
, 
decode_„c
, 0,

238 
	`gë_dec_demixög_m©rix
(
°
));

239 
	}
}

242 
	$›us_¥oje˘i⁄_decodî_˘l
(
OpusProje˘i⁄Decodî
 *
°
, 
ªque°
, ...)

244 
va_li°
 
≠
;

245 
ªt
 = 
OPUS_OK
;

247 
	`va_°¨t
(
≠
, 
ªque°
);

248 
ªt
 = 
	`›us_mu…i°ªam_decodî_˘l_va_li°
(
	`gë_mu…i°ªam_decodî
(
°
),

249 
ªque°
, 
≠
);

250 
	`va_íd
(
≠
);

251  
ªt
;

252 
	}
}

254 
	$›us_¥oje˘i⁄_decodî_de°roy
(
OpusProje˘i⁄Decodî
 *
°
)

256 
	`›us_‰ì
(
°
);

257 
	}
}

	@src/opus_projection_encoder.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"m©h›s.h
"

33 
	~"os_suµ‹t.h
"

34 
	~"›us_¥iv©e.h
"

35 
	~"›us_deföes.h
"

36 
	~"›us_¥oje˘i⁄.h
"

37 
	~"›us_mu…i°ªam.h
"

38 
	~"°ack_Æloc.h
"

39 
	~"m≠pög_m©rix.h
"

41 
	sOpusProje˘i⁄Encodî


43 
›us_öt32
 
	mmixög_m©rix_size_ö_byãs
;

44 
›us_öt32
 
	mdemixög_m©rix_size_ö_byãs
;

48 #i‡!
deföed
(
DISABLE_FLOAT_API
)

49 
	$›us_¥oje˘i⁄_c›y_ch™√l_ö_Êﬂt
(

50 
›us_vÆ16
 *
d°
,

51 
d°_°ride
,

52 c⁄° *
§c
,

53 
§c_°ride
,

54 
§c_ch™√l
,

55 
‰ame_size
,

56 *
u£r_d©a


59 
	`m≠pög_m©rix_mu…ùly_ch™√l_ö_Êﬂt
((c⁄° 
M≠pögM©rix
*)
u£r_d©a
,

60 (c⁄° *)
§c
, 
§c_°ride
, 
d°
, 
§c_ch™√l
, 
d°_°ride
, 
‰ame_size
);

61 
	}
}

64 
	$›us_¥oje˘i⁄_c›y_ch™√l_ö_sh‹t
(

65 
›us_vÆ16
 *
d°
,

66 
d°_°ride
,

67 c⁄° *
§c
,

68 
§c_°ride
,

69 
§c_ch™√l
,

70 
‰ame_size
,

71 *
u£r_d©a


74 
	`m≠pög_m©rix_mu…ùly_ch™√l_ö_sh‹t
((c⁄° 
M≠pögM©rix
*)
u£r_d©a
,

75 (c⁄° 
›us_öt16
*)
§c
, 
§c_°ride
, 
d°
, 
§c_ch™√l
, 
d°_°ride
, 
‰ame_size
);

76 
	}
}

78 
	$gë_‹dî_∂us_⁄e_‰om_ch™√ls
(
ch™√ls
, *
‹dî_∂us_⁄e
)

80 
‹dî_∂us_⁄e_
;

81 
a˙_ch™√ls
;

82 
n⁄dõgëic_ch™√ls
;

87 i‡(
ch™√ls
 < 1 || channels > 227)

88  
OPUS_BAD_ARG
;

90 
‹dî_∂us_⁄e_
 = 
	`isqπ32
(
ch™√ls
);

91 
a˙_ch™√ls
 = 
‹dî_∂us_⁄e_
 * order_plus_one_;

92 
n⁄dõgëic_ch™√ls
 = 
ch™√ls
 - 
a˙_ch™√ls
;

93 i‡(
n⁄dõgëic_ch™√ls
 != 0 &&Çondiegetic_channels != 2)

94  
OPUS_BAD_ARG
;

96 i‡(
‹dî_∂us_⁄e
)

97 *
‹dî_∂us_⁄e
 = 
‹dî_∂us_⁄e_
;

98  
OPUS_OK
;

99 
	}
}

101 
	$gë_°ªams_‰om_ch™√ls
(
ch™√ls
, 
m≠pög_Ámûy
,

102 *
°ªams
, *
cou∂ed_°ªams
,

103 *
‹dî_∂us_⁄e
)

105 i‡(
m≠pög_Ámûy
 == 3)

107 i‡(
	`gë_‹dî_∂us_⁄e_‰om_ch™√ls
(
ch™√ls
, 
‹dî_∂us_⁄e
Ë!
OPUS_OK
)

108  
OPUS_BAD_ARG
;

109 i‡(
°ªams
)

110 *
°ªams
 = (
ch™√ls
 + 1) / 2;

111 i‡(
cou∂ed_°ªams
)

112 *
cou∂ed_°ªams
 = 
ch™√ls
 / 2;

113  
OPUS_OK
;

115  
OPUS_BAD_ARG
;

116 
	}
}

118 
M≠pögM©rix
 *
	$gë_mixög_m©rix
(
OpusProje˘i⁄Encodî
 *
°
)

121  (
M≠pögM©rix
 *)(*)((*)
°
 +

122 
	`Æign
((
OpusProje˘i⁄Encodî
)));

123 
	}
}

125 
M≠pögM©rix
 *
	$gë_íc_demixög_m©rix
(
OpusProje˘i⁄Encodî
 *
°
)

128  (
M≠pögM©rix
 *)(*)((*)
°
 +

129 
	`Æign
((
OpusProje˘i⁄Encodî
) +

130 
°
->
mixög_m©rix_size_ö_byãs
));

131 
	}
}

133 
OpusMSEncodî
 *
	$gë_mu…i°ªam_ícodî
(
OpusProje˘i⁄Encodî
 *
°
)

136  (
OpusMSEncodî
 *)(*)((*)
°
 +

137 
	`Æign
((
OpusProje˘i⁄Encodî
) +

138 
°
->
mixög_m©rix_size_ö_byãs
 +

139 
°
->
demixög_m©rix_size_ö_byãs
));

140 
	}
}

142 
›us_öt32
 
	$›us_¥oje˘i⁄_ambis⁄ics_ícodî_gë_size
(
ch™√ls
,

143 
m≠pög_Ámûy
)

145 
nb_°ªams
;

146 
nb_cou∂ed_°ªams
;

147 
‹dî_∂us_⁄e
;

148 
mixög_m©rix_rows
, 
mixög_m©rix_cﬁs
;

149 
demixög_m©rix_rows
, 
demixög_m©rix_cﬁs
;

150 
›us_öt32
 
mixög_m©rix_size
, 
demixög_m©rix_size
;

151 
›us_öt32
 
ícodî_size
;

152 
ªt
;

154 
ªt
 = 
	`gë_°ªams_‰om_ch™√ls
(
ch™√ls
, 
m≠pög_Ámûy
, &
nb_°ªams
,

155 &
nb_cou∂ed_°ªams
, &
‹dî_∂us_⁄e
);

156 i‡(
ªt
 !
OPUS_OK
)

159 i‡(
‹dî_∂us_⁄e
 == 2)

161 
mixög_m©rix_rows
 = 
m≠pög_m©rix_fﬂ_mixög
.
rows
;

162 
mixög_m©rix_cﬁs
 = 
m≠pög_m©rix_fﬂ_mixög
.
cﬁs
;

163 
demixög_m©rix_rows
 = 
m≠pög_m©rix_fﬂ_demixög
.
rows
;

164 
demixög_m©rix_cﬁs
 = 
m≠pög_m©rix_fﬂ_demixög
.
cﬁs
;

166 i‡(
‹dî_∂us_⁄e
 == 3)

168 
mixög_m©rix_rows
 = 
m≠pög_m©rix_sﬂ_mixög
.
rows
;

169 
mixög_m©rix_cﬁs
 = 
m≠pög_m©rix_sﬂ_mixög
.
cﬁs
;

170 
demixög_m©rix_rows
 = 
m≠pög_m©rix_sﬂ_demixög
.
rows
;

171 
demixög_m©rix_cﬁs
 = 
m≠pög_m©rix_sﬂ_demixög
.
cﬁs
;

173 i‡(
‹dî_∂us_⁄e
 == 4)

175 
mixög_m©rix_rows
 = 
m≠pög_m©rix_tﬂ_mixög
.
rows
;

176 
mixög_m©rix_cﬁs
 = 
m≠pög_m©rix_tﬂ_mixög
.
cﬁs
;

177 
demixög_m©rix_rows
 = 
m≠pög_m©rix_tﬂ_demixög
.
rows
;

178 
demixög_m©rix_cﬁs
 = 
m≠pög_m©rix_tﬂ_demixög
.
cﬁs
;

183 
mixög_m©rix_size
 =

184 
	`m≠pög_m©rix_gë_size
(
mixög_m©rix_rows
, 
mixög_m©rix_cﬁs
);

185 i‡(!
mixög_m©rix_size
)

188 
demixög_m©rix_size
 =

189 
	`m≠pög_m©rix_gë_size
(
demixög_m©rix_rows
, 
demixög_m©rix_cﬁs
);

190 i‡(!
demixög_m©rix_size
)

193 
ícodî_size
 =

194 
	`›us_mu…i°ªam_ícodî_gë_size
(
nb_°ªams
, 
nb_cou∂ed_°ªams
);

195 i‡(!
ícodî_size
)

198  
	`Æign
((
OpusProje˘i⁄Encodî
)) +

199 
mixög_m©rix_size
 + 
demixög_m©rix_size
 + 
ícodî_size
;

200 
	}
}

202 
	$›us_¥oje˘i⁄_ambis⁄ics_ícodî_öô
(
OpusProje˘i⁄Encodî
 *
°
, 
›us_öt32
 
Fs
,

203 
ch™√ls
, 
m≠pög_Ámûy
,

204 *
°ªams
, *
cou∂ed_°ªams
,

205 
≠∂iˇti⁄
)

207 
M≠pögM©rix
 *
mixög_m©rix
;

208 
M≠pögM©rix
 *
demixög_m©rix
;

209 
OpusMSEncodî
 *
ms_ícodî
;

210 
i
;

211 
ªt
;

212 
‹dî_∂us_⁄e
;

213 
m≠pög
[255];

215 i‡(
°ªams
 =
NULL
 || 
cou∂ed_°ªams
 == NULL) {

216  
OPUS_BAD_ARG
;

219 i‡(
	`gë_°ªams_‰om_ch™√ls
(
ch™√ls
, 
m≠pög_Ámûy
, 
°ªams
,

220 
cou∂ed_°ªams
, &
‹dî_∂us_⁄e
Ë!
OPUS_OK
)

221  
OPUS_BAD_ARG
;

223 i‡(
m≠pög_Ámûy
 == 3)

226 
mixög_m©rix
 = 
	`gë_mixög_m©rix
(
°
);

227 i‡(
‹dî_∂us_⁄e
 == 2)

229 
	`m≠pög_m©rix_öô
(
mixög_m©rix
, 
m≠pög_m©rix_fﬂ_mixög
.
rows
,

230 
m≠pög_m©rix_fﬂ_mixög
.
cﬁs
, m≠pög_m©rix_fﬂ_mixög.
gaö
,

231 
m≠pög_m©rix_fﬂ_mixög_d©a
,

232 (
m≠pög_m©rix_fﬂ_mixög_d©a
));

234 i‡(
‹dî_∂us_⁄e
 == 3)

236 
	`m≠pög_m©rix_öô
(
mixög_m©rix
, 
m≠pög_m©rix_sﬂ_mixög
.
rows
,

237 
m≠pög_m©rix_sﬂ_mixög
.
cﬁs
, m≠pög_m©rix_sﬂ_mixög.
gaö
,

238 
m≠pög_m©rix_sﬂ_mixög_d©a
,

239 (
m≠pög_m©rix_sﬂ_mixög_d©a
));

241 i‡(
‹dî_∂us_⁄e
 == 4)

243 
	`m≠pög_m©rix_öô
(
mixög_m©rix
, 
m≠pög_m©rix_tﬂ_mixög
.
rows
,

244 
m≠pög_m©rix_tﬂ_mixög
.
cﬁs
, m≠pög_m©rix_tﬂ_mixög.
gaö
,

245 
m≠pög_m©rix_tﬂ_mixög_d©a
,

246 (
m≠pög_m©rix_tﬂ_mixög_d©a
));

249  
OPUS_BAD_ARG
;

251 
°
->
mixög_m©rix_size_ö_byãs
 = 
	`m≠pög_m©rix_gë_size
(

252 
mixög_m©rix
->
rows
, mixög_m©rix->
cﬁs
);

253 i‡(!
°
->
mixög_m©rix_size_ö_byãs
)

254  
OPUS_BAD_ARG
;

257 
demixög_m©rix
 = 
	`gë_íc_demixög_m©rix
(
°
);

258 i‡(
‹dî_∂us_⁄e
 == 2)

260 
	`m≠pög_m©rix_öô
(
demixög_m©rix
, 
m≠pög_m©rix_fﬂ_demixög
.
rows
,

261 
m≠pög_m©rix_fﬂ_demixög
.
cﬁs
, m≠pög_m©rix_fﬂ_demixög.
gaö
,

262 
m≠pög_m©rix_fﬂ_demixög_d©a
,

263 (
m≠pög_m©rix_fﬂ_demixög_d©a
));

265 i‡(
‹dî_∂us_⁄e
 == 3)

267 
	`m≠pög_m©rix_öô
(
demixög_m©rix
, 
m≠pög_m©rix_sﬂ_demixög
.
rows
,

268 
m≠pög_m©rix_sﬂ_demixög
.
cﬁs
, m≠pög_m©rix_sﬂ_demixög.
gaö
,

269 
m≠pög_m©rix_sﬂ_demixög_d©a
,

270 (
m≠pög_m©rix_sﬂ_demixög_d©a
));

272 i‡(
‹dî_∂us_⁄e
 == 4)

274 
	`m≠pög_m©rix_öô
(
demixög_m©rix
, 
m≠pög_m©rix_tﬂ_demixög
.
rows
,

275 
m≠pög_m©rix_tﬂ_demixög
.
cﬁs
, m≠pög_m©rix_tﬂ_demixög.
gaö
,

276 
m≠pög_m©rix_tﬂ_demixög_d©a
,

277 (
m≠pög_m©rix_tﬂ_demixög_d©a
));

280  
OPUS_BAD_ARG
;

282 
°
->
demixög_m©rix_size_ö_byãs
 = 
	`m≠pög_m©rix_gë_size
(

283 
demixög_m©rix
->
rows
, demixög_m©rix->
cﬁs
);

284 i‡(!
°
->
demixög_m©rix_size_ö_byãs
)

285  
OPUS_BAD_ARG
;

288  
OPUS_UNIMPLEMENTED
;

291 i‡(*
°ªams
 + *
cou∂ed_°ªams
 > 
mixög_m©rix
->
rows
 ||

292 
ch™√ls
 > 
mixög_m©rix
->
cﬁs
 ||

293 
ch™√ls
 > 
demixög_m©rix
->
rows
 ||

294 *
°ªams
 + *
cou∂ed_°ªams
 > 
demixög_m©rix
->
cﬁs
)

295  
OPUS_BAD_ARG
;

298 
i
 = 0; i < 
ch™√ls
; i++)

299 
m≠pög
[
i
] = i;

302 
ms_ícodî
 = 
	`gë_mu…i°ªam_ícodî
(
°
);

303 
ªt
 = 
	`›us_mu…i°ªam_ícodî_öô
(
ms_ícodî
, 
Fs
, 
ch™√ls
, *
°ªams
,

304 *
cou∂ed_°ªams
, 
m≠pög
, 
≠∂iˇti⁄
);

305  
ªt
;

306 
	}
}

308 
OpusProje˘i⁄Encodî
 *
	$›us_¥oje˘i⁄_ambis⁄ics_ícodî_¸óã
(

309 
›us_öt32
 
Fs
, 
ch™√ls
, 
m≠pög_Ámûy
, *
°ªams
,

310 *
cou∂ed_°ªams
, 
≠∂iˇti⁄
, *
îr‹
)

312 
size
;

313 
ªt
;

314 
OpusProje˘i⁄Encodî
 *
°
;

317 
size
 = 
	`›us_¥oje˘i⁄_ambis⁄ics_ícodî_gë_size
(
ch™√ls
, 
m≠pög_Ámûy
);

318 i‡(!
size
) {

319 i‡(
îr‹
)

320 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

321  
NULL
;

323 
°
 = (
OpusProje˘i⁄Encodî
 *)
	`›us_Æloc
(
size
);

324 i‡(!
°
)

326 i‡(
îr‹
)

327 *
îr‹
 = 
OPUS_ALLOC_FAIL
;

328  
NULL
;

332 
ªt
 = 
	`›us_¥oje˘i⁄_ambis⁄ics_ícodî_öô
(
°
, 
Fs
, 
ch™√ls
,

333 
m≠pög_Ámûy
, 
°ªams
, 
cou∂ed_°ªams
, 
≠∂iˇti⁄
);

334 i‡(
ªt
 !
OPUS_OK
)

336 
	`›us_‰ì
(
°
);

337 
°
 = 
NULL
;

339 i‡(
îr‹
)

340 *
îr‹
 = 
ªt
;

341  
°
;

342 
	}
}

344 
	$›us_¥oje˘i⁄_ícode
(
OpusProje˘i⁄Encodî
 *
°
, c⁄° 
›us_öt16
 *
pcm
,

345 
‰ame_size
, *
d©a
,

346 
›us_öt32
 
max_d©a_byãs
)

348  
	`›us_mu…i°ªam_ícode_«tive
(
	`gë_mu…i°ªam_ícodî
(
°
),

349 
›us_¥oje˘i⁄_c›y_ch™√l_ö_sh‹t
, 
pcm
, 
‰ame_size
, 
d©a
,

350 
max_d©a_byãs
, 16, 
downmix_öt
, 0, 
	`gë_mixög_m©rix
(
°
));

351 
	}
}

353 #i‚de‡
DISABLE_FLOAT_API


354 #ifde‡
FIXED_POINT


355 
	$›us_¥oje˘i⁄_ícode_Êﬂt
(
OpusProje˘i⁄Encodî
 *
°
, c⁄° *
pcm
,

356 
‰ame_size
, *
d©a
,

357 
›us_öt32
 
max_d©a_byãs
)

359  
	`›us_mu…i°ªam_ícode_«tive
(
	`gë_mu…i°ªam_ícodî
(
°
),

360 
›us_¥oje˘i⁄_c›y_ch™√l_ö_Êﬂt
, 
pcm
, 
‰ame_size
, 
d©a
,

361 
max_d©a_byãs
, 16, 
downmix_Êﬂt
, 1, 
	`gë_mixög_m©rix
(
°
));

362 
	}
}

364 
	$›us_¥oje˘i⁄_ícode_Êﬂt
(
OpusProje˘i⁄Encodî
 *
°
, c⁄° *
pcm
,

365 
‰ame_size
, *
d©a
,

366 
›us_öt32
 
max_d©a_byãs
)

368  
	`›us_mu…i°ªam_ícode_«tive
(
	`gë_mu…i°ªam_ícodî
(
°
),

369 
›us_¥oje˘i⁄_c›y_ch™√l_ö_Êﬂt
, 
pcm
, 
‰ame_size
, 
d©a
,

370 
max_d©a_byãs
, 24, 
downmix_Êﬂt
, 1, 
	`gë_mixög_m©rix
(
°
));

371 
	}
}

375 
	$›us_¥oje˘i⁄_ícodî_de°roy
(
OpusProje˘i⁄Encodî
 *
°
)

377 
	`›us_‰ì
(
°
);

378 
	}
}

380 
	$›us_¥oje˘i⁄_ícodî_˘l
(
OpusProje˘i⁄Encodî
 *
°
, 
ªque°
, ...)

382 
va_li°
 
≠
;

383 
M≠pögM©rix
 *
demixög_m©rix
;

384 
OpusMSEncodî
 *
ms_ícodî
;

385 
ªt
 = 
OPUS_OK
;

387 
ms_ícodî
 = 
	`gë_mu…i°ªam_ícodî
(
°
);

388 
demixög_m©rix
 = 
	`gë_íc_demixög_m©rix
(
°
);

390 
	`va_°¨t
(
≠
, 
ªque°
);

391 
ªque°
)

393 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE_REQUEST
:

395 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

396 i‡(!
vÆue
)

398 
bad_¨g
;

400 *
vÆue
 =

401 
ms_ícodî
->
œyout
.
nb_ch™√ls
 * (ms_ícodî->œyout.
nb_°ªams


402 + 
ms_ícodî
->
œyout
.
nb_cou∂ed_°ªams
Ë* (
›us_öt16
);

405 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_GAIN_REQUEST
:

407 
›us_öt32
 *
vÆue
 = 
	`va_¨g
(
≠
, opus_int32*);

408 i‡(!
vÆue
)

410 
bad_¨g
;

412 *
vÆue
 = 
demixög_m©rix
->
gaö
;

415 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_REQUEST
:

417 
i
, 
j
, 
k
, 
l
;

418 
nb_öput_°ªams
;

419 
nb_ouçut_°ªams
;

420 *
exã∫Æ_ch¨
;

421 
›us_öt16
 *
öã∫Æ_sh‹t
;

422 
›us_öt32
 
exã∫Æ_size
;

423 
›us_öt32
 
öã∫Æ_size
;

426 
nb_öput_°ªams
 = 
ms_ícodî
->
œyout
.
nb_°ªams
 +

427 
ms_ícodî
->
œyout
.
nb_cou∂ed_°ªams
;

428 
nb_ouçut_°ªams
 = 
ms_ícodî
->
œyout
.
nb_ch™√ls
;

430 
exã∫Æ_ch¨
 = 
	`va_¨g
(
≠
, *);

431 
exã∫Æ_size
 = 
	`va_¨g
(
≠
, 
›us_öt32
);

432 i‡(!
exã∫Æ_ch¨
)

434 
bad_¨g
;

436 
öã∫Æ_sh‹t
 = 
	`m≠pög_m©rix_gë_d©a
(
demixög_m©rix
);

437 
öã∫Æ_size
 = 
nb_öput_°ªams
 * 
nb_ouçut_°ªams
 * (
›us_öt16
);

438 i‡(
exã∫Æ_size
 !
öã∫Æ_size
)

440 
bad_¨g
;

444 
l
 = 0;

445 
i
 = 0; i < 
nb_öput_°ªams
; i++) {

446 
j
 = 0; j < 
nb_ouçut_°ªams
; j++) {

447 
k
 = 
demixög_m©rix
->
rows
 * 
i
 + 
j
;

448 
exã∫Æ_ch¨
[2*
l
] = ()
öã∫Æ_sh‹t
[
k
];

449 
exã∫Æ_ch¨
[2*
l
+1] = ()(
öã∫Æ_sh‹t
[
k
] >> 8);

450 
l
++;

457 
ªt
 = 
	`›us_mu…i°ªam_ícodî_˘l_va_li°
(
ms_ícodî
, 
ªque°
, 
≠
);

461 
	`va_íd
(
≠
);

462  
ªt
;

464 
bad_¨g
:

465 
	`va_íd
(
≠
);

466  
OPUS_BAD_ARG
;

467 
	}
}

	@src/repacketizer.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us.h
"

33 
	~"›us_¥iv©e.h
"

34 
	~"os_suµ‹t.h
"

37 
	$›us_ª∑ckëizî_gë_size
()

39  (
OpusRïackëizî
);

40 
	}
}

42 
OpusRïackëizî
 *
	$›us_ª∑ckëizî_öô
(
OpusRïackëizî
 *
Ω
)

44 
Ω
->
nb_‰ames
 = 0;

45  
Ω
;

46 
	}
}

48 
OpusRïackëizî
 *
	$›us_ª∑ckëizî_¸óã
()

50 
OpusRïackëizî
 *
Ω
;

51 
Ω
=(
OpusRïackëizî
 *)
	`›us_Æloc
(
	`›us_ª∑ckëizî_gë_size
());

52 if(
Ω
==
NULL
) NULL;

53  
	`›us_ª∑ckëizî_öô
(
Ω
);

54 
	}
}

56 
	$›us_ª∑ckëizî_de°roy
(
OpusRïackëizî
 *
Ω
)

58 
	`›us_‰ì
(
Ω
);

59 
	}
}

61 
	$›us_ª∑ckëizî_ˇt_im∂
(
OpusRïackëizî
 *
Ω
, c⁄° *
d©a
, 
›us_öt32
 
Àn
, 
£lf_dñimôed
)

63 
tmp_toc
;

64 
cuº_nb_‰ames
,
ªt
;

66 i‡(
Àn
<1Ë 
OPUS_INVALID_PACKET
;

67 i‡(
Ω
->
nb_‰ames
 == 0)

69 
Ω
->
toc
 = 
d©a
[0];

70 
Ω
->
‰amesize
 = 
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
d©a
, 8000);

71 } i‡((
Ω
->
toc
&0xFCË!(
d©a
[0]&0xFC))

74  
OPUS_INVALID_PACKET
;

76 
cuº_nb_‰ames
 = 
	`›us_∑ckë_gë_nb_‰ames
(
d©a
, 
Àn
);

77 if(
cuº_nb_‰ames
<1Ë 
OPUS_INVALID_PACKET
;

80 i‡((
cuº_nb_‰ames
+
Ω
->
nb_‰ames
)*Ω->
‰amesize
 > 960)

82  
OPUS_INVALID_PACKET
;

85 
ªt
=
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 
£lf_dñimôed
, &
tmp_toc
, &
Ω
->
‰ames
[Ω->
nb_‰ames
], &Ω->Àn[Ω->nb_‰ames], 
NULL
, NULL);

86 if(
ªt
<1)Ñet;

88 
Ω
->
nb_‰ames
 +
cuº_nb_‰ames
;

89  
OPUS_OK
;

90 
	}
}

92 
	$›us_ª∑ckëizî_ˇt
(
OpusRïackëizî
 *
Ω
, c⁄° *
d©a
, 
›us_öt32
 
Àn
)

94  
	`›us_ª∑ckëizî_ˇt_im∂
(
Ω
, 
d©a
, 
Àn
, 0);

95 
	}
}

97 
	$›us_ª∑ckëizî_gë_nb_‰ames
(
OpusRïackëizî
 *
Ω
)

99  
Ω
->
nb_‰ames
;

100 
	}
}

102 
›us_öt32
 
	$›us_ª∑ckëizî_out_ønge_im∂
(
OpusRïackëizî
 *
Ω
, 
begö
, 
íd
,

103 *
d©a
, 
›us_öt32
 
maxÀn
, 
£lf_dñimôed
, 
∑d
)

105 
i
, 
cou¡
;

106 
›us_öt32
 
tŸ_size
;

107 
›us_öt16
 *
Àn
;

108 c⁄° **
‰ames
;

109 * 
±r
;

111 i‡(
begö
<0 || begö>=
íd
 ||Énd>
Ω
->
nb_‰ames
)

114  
OPUS_BAD_ARG
;

116 
cou¡
 = 
íd
-
begö
;

118 
Àn
 = 
Ω
->Àn+
begö
;

119 
‰ames
 = 
Ω
->‰ames+
begö
;

120 i‡(
£lf_dñimôed
)

121 
tŸ_size
 = 1 + (
Àn
[
cou¡
-1]>=252);

123 
tŸ_size
 = 0;

125 
±r
 = 
d©a
;

126 i‡(
cou¡
==1)

129 
tŸ_size
 +
Àn
[0]+1;

130 i‡(
tŸ_size
 > 
maxÀn
)

131  
OPUS_BUFFER_TOO_SMALL
;

132 *
±r
++ = 
Ω
->
toc
&0xFC;

133 } i‡(
cou¡
==2)

135 i‡(
Àn
[1] ==Üen[0])

138 
tŸ_size
 +2*
Àn
[0]+1;

139 i‡(
tŸ_size
 > 
maxÀn
)

140  
OPUS_BUFFER_TOO_SMALL
;

141 *
±r
++ = (
Ω
->
toc
&0xFC) | 0x1;

144 
tŸ_size
 +
Àn
[0]+len[1]+2+(len[0]>=252);

145 i‡(
tŸ_size
 > 
maxÀn
)

146  
OPUS_BUFFER_TOO_SMALL
;

147 *
±r
++ = (
Ω
->
toc
&0xFC) | 0x2;

148 
±r
 +
	`ícode_size
(
Àn
[0],Ötr);

151 i‡(
cou¡
 > 2 || (
∑d
 && 
tŸ_size
 < 
maxÀn
))

154 
vbr
;

155 
∑d_amou¡
=0;

158 
±r
 = 
d©a
;

159 i‡(
£lf_dñimôed
)

160 
tŸ_size
 = 1 + (
Àn
[
cou¡
-1]>=252);

162 
tŸ_size
 = 0;

163 
vbr
 = 0;

164 
i
=1;i<
cou¡
;i++)

166 i‡(
Àn
[
i
] !=Üen[0])

168 
vbr
=1;

172 i‡(
vbr
)

174 
tŸ_size
 += 2;

175 
i
=0;i<
cou¡
-1;i++)

176 
tŸ_size
 +1 + (
Àn
[
i
]>=252) +Üen[i];

177 
tŸ_size
 +
Àn
[
cou¡
-1];

179 i‡(
tŸ_size
 > 
maxÀn
)

180  
OPUS_BUFFER_TOO_SMALL
;

181 *
±r
++ = (
Ω
->
toc
&0xFC) | 0x3;

182 *
±r
++ = 
cou¡
 | 0x80;

184 
tŸ_size
 +
cou¡
*
Àn
[0]+2;

185 i‡(
tŸ_size
 > 
maxÀn
)

186  
OPUS_BUFFER_TOO_SMALL
;

187 *
±r
++ = (
Ω
->
toc
&0xFC) | 0x3;

188 *
±r
++ = 
cou¡
;

190 
∑d_amou¡
 = 
∑d
 ? (
maxÀn
-
tŸ_size
) : 0;

191 i‡(
∑d_amou¡
 != 0)

193 
nb_255s
;

194 
d©a
[1] |= 0x40;

195 
nb_255s
 = (
∑d_amou¡
-1)/255;

196 
i
=0;i<
nb_255s
;i++)

197 *
±r
++ = 255;

198 *
±r
++ = 
∑d_amou¡
-255*
nb_255s
-1;

199 
tŸ_size
 +
∑d_amou¡
;

201 i‡(
vbr
)

203 
i
=0;i<
cou¡
-1;i++)

204 
±r
 +
	`ícode_size
(
Àn
[
i
],Ötr);

207 i‡(
£lf_dñimôed
) {

208 
sdÀn
 = 
	`ícode_size
(
Àn
[
cou¡
-1], 
±r
);

209 
±r
 +
sdÀn
;

212 
i
=0;i<
cou¡
;i++)

218 
	`OPUS_MOVE
(
±r
, 
‰ames
[
i
], 
Àn
[i]);

219 
±r
 +
Àn
[
i
];

221 i‡(
∑d
)

224 
±r
<
d©a
+
maxÀn
)

225 *
±r
++=0;

227  
tŸ_size
;

228 
	}
}

230 
›us_öt32
 
	$›us_ª∑ckëizî_out_ønge
(
OpusRïackëizî
 *
Ω
, 
begö
, 
íd
, *
d©a
, 
›us_öt32
 
maxÀn
)

232  
	`›us_ª∑ckëizî_out_ønge_im∂
(
Ω
, 
begö
, 
íd
, 
d©a
, 
maxÀn
, 0, 0);

233 
	}
}

235 
›us_öt32
 
	$›us_ª∑ckëizî_out
(
OpusRïackëizî
 *
Ω
, *
d©a
, 
›us_öt32
 
maxÀn
)

237  
	`›us_ª∑ckëizî_out_ønge_im∂
(
Ω
, 0,Ñp->
nb_‰ames
, 
d©a
, 
maxÀn
, 0, 0);

238 
	}
}

240 
	$›us_∑ckë_∑d
(*
d©a
, 
›us_öt32
 
Àn
, opus_öt32 
√w_Àn
)

242 
OpusRïackëizî
 
Ω
;

243 
›us_öt32
 
ªt
;

244 i‡(
Àn
 < 1)

245  
OPUS_BAD_ARG
;

246 i‡(
Àn
==
√w_Àn
)

247  
OPUS_OK
;

248 i‡(
Àn
 > 
√w_Àn
)

249  
OPUS_BAD_ARG
;

250 
	`›us_ª∑ckëizî_öô
(&
Ω
);

252 
	`OPUS_MOVE
(
d©a
+
√w_Àn
-
Àn
, data,Üen);

253 
ªt
 = 
	`›us_ª∑ckëizî_ˇt
(&
Ω
, 
d©a
+
√w_Àn
-
Àn
,Üen);

254 i‡(
ªt
 !
OPUS_OK
)

255  
ªt
;

256 
ªt
 = 
	`›us_ª∑ckëizî_out_ønge_im∂
(&
Ω
, 0,Ñp.
nb_‰ames
, 
d©a
, 
√w_Àn
, 0, 1);

257 i‡(
ªt
 > 0)

258  
OPUS_OK
;

260  
ªt
;

261 
	}
}

263 
›us_öt32
 
	$›us_∑ckë_u≈ad
(*
d©a
, 
›us_öt32
 
Àn
)

265 
OpusRïackëizî
 
Ω
;

266 
›us_öt32
 
ªt
;

267 i‡(
Àn
 < 1)

268  
OPUS_BAD_ARG
;

269 
	`›us_ª∑ckëizî_öô
(&
Ω
);

270 
ªt
 = 
	`›us_ª∑ckëizî_ˇt
(&
Ω
, 
d©a
, 
Àn
);

271 i‡(
ªt
 < 0)

272  
ªt
;

273 
ªt
 = 
	`›us_ª∑ckëizî_out_ønge_im∂
(&
Ω
, 0,Ñp.
nb_‰ames
, 
d©a
, 
Àn
, 0, 0);

274 
	`˚…_as£π
(
ªt
 > 0 &&Ñë <
Àn
);

275  
ªt
;

276 
	}
}

278 
	$›us_mu…i°ªam_∑ckë_∑d
(*
d©a
, 
›us_öt32
 
Àn
, opus_öt32 
√w_Àn
, 
nb_°ªams
)

280 
s
;

281 
cou¡
;

282 
toc
;

283 
›us_öt16
 
size
[48];

284 
›us_öt32
 
∑ckë_off£t
;

285 
›us_öt32
 
amou¡
;

287 i‡(
Àn
 < 1)

288  
OPUS_BAD_ARG
;

289 i‡(
Àn
==
√w_Àn
)

290  
OPUS_OK
;

291 i‡(
Àn
 > 
√w_Àn
)

292  
OPUS_BAD_ARG
;

293 
amou¡
 = 
√w_Àn
 - 
Àn
;

295 
s
=0;s<
nb_°ªams
-1;s++)

297 i‡(
Àn
<=0)

298  
OPUS_INVALID_PACKET
;

299 
cou¡
 = 
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 1, &
toc
, 
NULL
,

300 
size
, 
NULL
, &
∑ckë_off£t
);

301 i‡(
cou¡
<0)

302  
cou¡
;

303 
d©a
 +
∑ckë_off£t
;

304 
Àn
 -
∑ckë_off£t
;

306  
	`›us_∑ckë_∑d
(
d©a
, 
Àn
,Üí+
amou¡
);

307 
	}
}

309 
›us_öt32
 
	$›us_mu…i°ªam_∑ckë_u≈ad
(*
d©a
, 
›us_öt32
 
Àn
, 
nb_°ªams
)

311 
s
;

312 
toc
;

313 
›us_öt16
 
size
[48];

314 
›us_öt32
 
∑ckë_off£t
;

315 
OpusRïackëizî
 
Ω
;

316 *
d°
;

317 
›us_öt32
 
d°_Àn
;

319 i‡(
Àn
 < 1)

320  
OPUS_BAD_ARG
;

321 
d°
 = 
d©a
;

322 
d°_Àn
 = 0;

324 
s
=0;s<
nb_°ªams
;s++)

326 
›us_öt32
 
ªt
;

327 
£lf_dñimôed
 = 
s
!=
nb_°ªams
-1;

328 i‡(
Àn
<=0)

329  
OPUS_INVALID_PACKET
;

330 
	`›us_ª∑ckëizî_öô
(&
Ω
);

331 
ªt
 = 
	`›us_∑ckë_∑r£_im∂
(
d©a
, 
Àn
, 
£lf_dñimôed
, &
toc
, 
NULL
,

332 
size
, 
NULL
, &
∑ckë_off£t
);

333 i‡(
ªt
<0)

334  
ªt
;

335 
ªt
 = 
	`›us_ª∑ckëizî_ˇt_im∂
(&
Ω
, 
d©a
, 
∑ckë_off£t
, 
£lf_dñimôed
);

336 i‡(
ªt
 < 0)

337  
ªt
;

338 
ªt
 = 
	`›us_ª∑ckëizî_out_ønge_im∂
(&
Ω
, 0,Ñp.
nb_‰ames
, 
d°
, 
Àn
, 
£lf_dñimôed
, 0);

339 i‡(
ªt
 < 0)

340  
ªt
;

342 
d°_Àn
 +
ªt
;

343 
d°
 +
ªt
;

344 
d©a
 +
∑ckë_off£t
;

345 
Àn
 -
∑ckë_off£t
;

347  
d°_Àn
;

348 
	}
}

	@src/repacketizer_demo.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~"›us.h
"

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<°rög.h
>

37 
	#MAX_PACKETOUT
 32000

	)

39 
	$ußge
(*
¨gv0
)

41 
	`Ârötf
(
°dîr
, "ußge: %†[›ti⁄s] i≈ut_fûêouçut_fûe\n", 
¨gv0
);

42 
	}
}

44 
	$öt_to_ch¨
(
›us_uöt32
 
i
, 
ch
[4])

46 
ch
[0] = 
i
>>24;

47 
ch
[1] = (
i
>>16)&0xFF;

48 
ch
[2] = (
i
>>8)&0xFF;

49 
ch
[3] = 
i
&0xFF;

50 
	}
}

52 
›us_uöt32
 
	$ch¨_to_öt
(
ch
[4])

54  ((
›us_uöt32
)
ch
[0]<<24) | ((opus_uint32)ch[1]<<16)

55 | ((
›us_uöt32
)
ch
[2]<< 8) | (opus_uint32)ch[3];

56 
	}
}

58 
	$maö
(
¨gc
, *
¨gv
[])

60 
i
, 
eof
=0;

61 
FILE
 *
fö
, *
fout
;

62 
∑ckës
[48][1500];

63 
Àn
[48];

64 
∫g
[48];

65 
OpusRïackëizî
 *
Ω
;

66 
ouçut_∑ckë
[
MAX_PACKETOUT
];

67 
mîge
 = 1, 
•lô
=0;

69 i‡(
¨gc
 < 3)

71 
	`ußge
(
¨gv
[0]);

72  
EXIT_FAILURE
;

74 
i
=1;i<
¨gc
-2;i++)

76 i‡(
	`°rcmp
(
¨gv
[
i
], "-merge")==0)

78 
mîge
 = 
	`©oi
(
¨gv
[
i
+1]);

79 if(
mîge
<1)

81 
	`Ârötf
(
°dîr
, "-mergeÖarameter must beátÜeast 1.\n");

82  
EXIT_FAILURE
;

84 if(
mîge
>48)

86 
	`Ârötf
(
°dîr
, "-mergeÖarameter must beÜessÅhan 48.\n");

87  
EXIT_FAILURE
;

89 
i
++;

90 } i‡(
	`°rcmp
(
¨gv
[
i
], "-split")==0)

91 
•lô
 = 1;

94 
	`Ârötf
(
°dîr
, "Unknow¿›ti⁄: %s\n", 
¨gv
[
i
]);

95 
	`ußge
(
¨gv
[0]);

96  
EXIT_FAILURE
;

99 
fö
 = 
	`f›í
(
¨gv
[
¨gc
-2], "r");

100 if(
fö
==
NULL
)

102 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög i≈uàfûe: %s\n", 
¨gv
[
¨gc
-2]);

103  
EXIT_FAILURE
;

105 
fout
 = 
	`f›í
(
¨gv
[
¨gc
-1], "w");

106 if(
fout
==
NULL
)

108 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög ouçuàfûe: %s\n", 
¨gv
[
¨gc
-1]);

109 
	`f˛o£
(
fö
);

110  
EXIT_FAILURE
;

113 
Ω
 = 
	`›us_ª∑ckëizî_¸óã
();

114 !
eof
)

116 
îr
;

117 
nb_∑ckës
=
mîge
;

118 
	`›us_ª∑ckëizî_öô
(
Ω
);

119 
i
=0;i<
nb_∑ckës
;i++)

121 
ch
[4];

122 
îr
 = 
	`‰ód
(
ch
, 1, 4, 
fö
);

123 
Àn
[
i
] = 
	`ch¨_to_öt
(
ch
);

125 i‡(
Àn
[
i
]>1500 ||Üen[i]<0)

127 i‡(
	`„of
(
fö
))

129 
eof
 = 1;

131 
	`Ârötf
(
°dîr
, "InvalidÖayloadÜength\n");

132 
	`f˛o£
(
fö
);

133 
	`f˛o£
(
fout
);

134  
EXIT_FAILURE
;

138 
îr
 = 
	`‰ód
(
ch
, 1, 4, 
fö
);

139 
∫g
[
i
] = 
	`ch¨_to_öt
(
ch
);

140 
îr
 = 
	`‰ód
(
∑ckës
[
i
], 1, 
Àn
[i], 
fö
);

141 i‡(
	`„of
(
fö
))

143 
eof
 = 1;

146 
îr
 = 
	`›us_ª∑ckëizî_ˇt
(
Ω
, 
∑ckës
[
i
], 
Àn
[i]);

147 i‡(
îr
!=
OPUS_OK
)

149 
	`Ârötf
(
°dîr
, "›us_ª∑ckëizî_ˇt(ËÁûed: %s\n", 
	`›us_°ªº‹
(
îr
));

153 
nb_∑ckës
 = 
i
;

155 i‡(
eof
)

158 i‡(!
•lô
)

160 
îr
 = 
	`›us_ª∑ckëizî_out
(
Ω
, 
ouçut_∑ckë
, 
MAX_PACKETOUT
);

161 i‡(
îr
>0) {

162 
öt_fõld
[4];

163 
	`öt_to_ch¨
(
îr
, 
öt_fõld
);

164 if(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
)!=4){

165 
	`Ârötf
(
°dîr
, "Error writing.\n");

166  
EXIT_FAILURE
;

168 
	`öt_to_ch¨
(
∫g
[
nb_∑ckës
-1], 
öt_fõld
);

169 i‡(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
)!=4) {

170 
	`Ârötf
(
°dîr
, "Error writing.\n");

171  
EXIT_FAILURE
;

173 i‡(
	`fwrôe
(
ouçut_∑ckë
, 1, 
îr
, 
fout
)!=()err) {

174 
	`Ârötf
(
°dîr
, "Error writing.\n");

175  
EXIT_FAILURE
;

179 
	`Ârötf
(
°dîr
, "›us_ª∑ckëizî_out(ËÁûed: %s\n", 
	`›us_°ªº‹
(
îr
));

182 
nb_‰ames
 = 
	`›us_ª∑ckëizî_gë_nb_‰ames
(
Ω
);

183 
i
=0;i<
nb_‰ames
;i++)

185 
îr
 = 
	`›us_ª∑ckëizî_out_ønge
(
Ω
, 
i
, i+1, 
ouçut_∑ckë
, 
MAX_PACKETOUT
);

186 i‡(
îr
>0) {

187 
öt_fõld
[4];

188 
	`öt_to_ch¨
(
îr
, 
öt_fõld
);

189 i‡(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
)!=4) {

190 
	`Ârötf
(
°dîr
, "Error writing.\n");

191  
EXIT_FAILURE
;

193 i‡(
i
==
nb_‰ames
-1)

194 
	`öt_to_ch¨
(
∫g
[
nb_∑ckës
-1], 
öt_fõld
);

196 
	`öt_to_ch¨
(0, 
öt_fõld
);

197 i‡(
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
)!=4) {

198 
	`Ârötf
(
°dîr
, "Error writing.\n");

199  
EXIT_FAILURE
;

201 i‡(
	`fwrôe
(
ouçut_∑ckë
, 1, 
îr
, 
fout
)!=()err) {

202 
	`Ârötf
(
°dîr
, "Error writing.\n");

203  
EXIT_FAILURE
;

207 
	`Ârötf
(
°dîr
, "›us_ª∑ckëizî_out(ËÁûed: %s\n", 
	`›us_°ªº‹
(
îr
));

214 
	`f˛o£
(
fö
);

215 
	`f˛o£
(
fout
);

216  
EXIT_SUCCESS
;

217 
	}
}

	@src/tansig_table.h

3 c⁄° 
	gènsig_èbÀ
[201] = {

	@tests/opus_decode_fuzzer.c

27 #ifde‡
HAVE_CONFIG_H


28 
	~"c⁄fig.h
"

31 
	~<°döt.h
>

32 
	~<°dlib.h
>

33 
	~<°rög.h
>

34 
	~"›us.h
"

35 
	~"›us_ty≥s.h
"

37 
	#MAX_FRAME_SAMP
 5760

	)

38 
	#MAX_PACKET
 1500

	)

41 
	#SETUP_BYTE_COUNT
 8

	)

44 
	mfs
;

45 
	mch™√ls
;

46 } 
	tTocInfo
;

48 
	$P¨£Toc
(c⁄° 
uöt8_t
 *
toc
, 
TocInfo
 *c⁄° 
öfo
) {

49 c⁄° 
ßmp_‰eqs
[5] = {8000, 12000, 16000, 24000, 48000};

50 c⁄° 
b™dwidth
 = 
	`›us_∑ckë_gë_b™dwidth
(
toc
);

52 
öfo
->
fs
 = 
ßmp_‰eqs
[
b™dwidth
 - 
OPUS_BANDWIDTH_NARROWBAND
];

53 
öfo
->
ch™√ls
 = 
	`›us_∑ckë_gë_nb_ch™√ls
(
toc
);

54 
	}
}

62 
	$LLVMFuzzîTe°O√I≈ut
(c⁄° 
uöt8_t
 *
d©a
, 
size_t
 
size
) {

63 
OpusDecodî
 *
dec
;

64 
›us_öt16
 *
pcm
;

65 
uöt8_t
 *
∑ckë
;

66 
TocInfo
 
toc
;

67 
i
, 
îr
;

70 i‡(
size
 < 
SETUP_BYTE_COUNT
 + 1) {

75 
	`P¨£Toc
(&
d©a
[
SETUP_BYTE_COUNT
], &
toc
);

77 
dec
 = 
	`›us_decodî_¸óã
(
toc
.
fs
,Åoc.
ch™√ls
, &
îr
);

78 i‡(
îr
 !
OPUS_OK
 | 
dec
 =
NULL
) {

82 
pcm
 = (
›us_öt16
*Ë
	`mÆloc
((*pcmË* 
MAX_FRAME_SAMP
 * 
toc
.
ch™√ls
);

83 
∑ckë
 = (
uöt8_t
*Ë
	`ˇŒoc
(
MAX_PACKET
, (*packet));

85 
i
 = 0;

87 
Àn
, 
„c
;

89 i‡(
i
 + 
SETUP_BYTE_COUNT
 >
size
) {

93 
Àn
 = (
›us_uöt32
Ë
d©a
[
i
 ] << 24 |

94 (
›us_uöt32
Ë
d©a
[
i
 + 1] << 16 |

95 (
›us_uöt32
Ë
d©a
[
i
 + 2] << 8 |

96 (
›us_uöt32
Ë
d©a
[
i
 + 3];

97 i‡(
Àn
 > 
MAX_PACKET
 ||Üen < 0) {

103 
„c
 = 
d©a
[
i
 + 4] & 1;

106 i‡(
Àn
 == 0) {

107 
‰ame_size
;

108 
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_LAST_PACKET_DURATION
(&
‰ame_size
));

109 (Ë
	`›us_decode
(
dec
, 
NULL
, 
size
, 
pcm
, 
‰ame_size
, 
„c
);

111 i‡(
i
 + 
SETUP_BYTE_COUNT
 + 
Àn
 > 
size
) {

114 
	`mem˝y
(
pcm
, &
d©a
[
i
 + 
SETUP_BYTE_COUNT
], 
Àn
);

115 (Ë
	`›us_decode
(
dec
, 
d©a
, 
size
, 
pcm
, 
MAX_FRAME_SAMP
, 
„c
);

118 
i
 +
SETUP_BYTE_COUNT
 + 
Àn
;

121 
	`›us_decodî_de°roy
(
dec
);

122 
	`‰ì
(
pcm
);

123 
	`‰ì
(
∑ckë
);

126 
	}
}

	@tests/opus_encode_regressions.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<limôs.h
>

35 
	~<°döt.h
>

36 
	~<m©h.h
>

37 
	~<°rög.h
>

38 
	~<as£π.h
>

39 
	~"›us_mu…i°ªam.h
"

40 
	~"›us.h
"

41 
	~"ã°_›us_comm⁄.h
"

44 
	$˚…_ec_öã∫Æ_îr‹
()

46 
OpusMSEncodî
 *
íc
;

47 
îr
;

48 
d©a
[2460];

49 
°ªams
;

50 
cou∂ed_°ªams
;

51 
m≠pög
[1];

53 
íc
 = 
	`›us_mu…i°ªam_suºound_ícodî_¸óã
(16000, 1, 1, &
°ªams
,

54 &
cou∂ed_°ªams
, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, &
îr
);

55 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

56 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

57 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(0));

58 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

59 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

60 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(0));

61 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(0));

62 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

63 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
));

64 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(8));

65 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(0));

66 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(0));

67 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
OPUS_AUTO
));

69 c⁄° 
pcm
[320] =

108 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 320, 
d©a
, 2460);

109 
	`as£π
(
îr
 > 0);

111 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

112 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

113 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

114 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

115 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

116 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

117 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(10));

118 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

119 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

120 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(18));

121 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

122 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(90));

123 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(280130));

125 c⁄° 
pcm
[160] =

146 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 160, 
d©a
, 2460);

147 
	`as£π
(
îr
 > 0);

149 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

150 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

151 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

152 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

153 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

154 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

155 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(10));

156 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

157 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

158 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(18));

159 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

160 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(90));

161 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(280130));

163 c⁄° 
pcm
[160] =

184 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 160, 
d©a
, 2460);

185 
	`as£π
(
îr
 > 0);

187 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

188 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

189 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

190 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

191 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

192 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

193 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(10));

194 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

195 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

196 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(18));

197 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

198 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(90));

199 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(280130));

201 c⁄° 
pcm
[160] =

222 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 160, 
d©a
, 2460);

223 
	`as£π
(
îr
 > 0);

225 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

226 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

227 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

228 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

229 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

230 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

231 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(10));

232 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

233 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

234 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(18));

235 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

236 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(90));

237 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(280130));

239 c⁄° 
pcm
[160] =

258 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 160, 
d©a
, 2460);

259 
	`as£π
(
îr
 > 0);

261 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_VOICE
));

262 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

263 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

264 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

265 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(1));

266 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

267 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(0));

268 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

269 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
));

270 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(12));

271 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(0));

272 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(41));

273 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(21425));

275 c⁄° 
pcm
[40] =

283 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 40, 
d©a
, 2460);

284 
	`as£π
(
îr
 > 0);

287 
	`›us_mu…i°ªam_ícodî_de°roy
(
íc
);

289 
	}
}

291 
	$mscbr_ícode_Áû10
()

293 
OpusMSEncodî
 *
íc
;

294 
îr
;

295 
d©a
[627300];

296 c⁄° 
m≠pög
[255] =

315 
íc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 255, 254, 1, 
m≠pög
,

316 
OPUS_APPLICATION_RESTRICTED_LOWDELAY
, &
îr
);

317 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_VOICE
));

318 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

319 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(0));

320 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(0));

321 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(2));

322 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(1));

323 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

324 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(2));

325 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

326 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
));

327 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(14));

328 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(0));

329 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(57));

330 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(3642675));

332 c⁄° 
pcm
[20*255] =

336 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 20, 
d©a
, 627300);

337 
	`as£π
(
îr
 > 0);

340 
	`›us_mu…i°ªam_ícodî_de°roy
(
íc
);

342 
	}
}

344 
	$mscbr_ícode_Áû
()

346 
OpusMSEncodî
 *
íc
;

347 
îr
;

348 
d©a
[472320];

349 c⁄° 
m≠pög
[192] =

365 
íc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 192, 189, 3, 
m≠pög
,

366 
OPUS_APPLICATION_RESTRICTED_LOWDELAY
, &
îr
);

367 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

368 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

369 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(0));

370 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(0));

371 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
OPUS_AUTO
));

372 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

373 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(0));

374 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(0));

375 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_MEDIUMBAND
));

376 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
));

377 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(8));

378 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(0));

379 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(0));

380 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(15360));

382 c⁄° 
pcm
[20*192] =

386 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 20, 
d©a
, 472320);

387 
	`as£π
(
îr
 > 0);

390 
	`›us_mu…i°ªam_ícodî_de°roy
(
íc
);

392 
	}
}

394 
	$suºound_™Æysis_unöô
()

396 
OpusMSEncodî
 *
íc
;

397 
îr
;

398 
d©a
[7380];

399 
°ªams
;

400 
cou∂ed_°ªams
;

401 
m≠pög
[3];

403 
íc
 = 
	`›us_mu…i°ªam_suºound_ícodî_¸óã
(24000, 3, 1, &
°ªams
,

404 &
cou∂ed_°ªams
, 
m≠pög
, 
OPUS_APPLICATION_AUDIO
, &
îr
);

405 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_VOICE
));

406 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(1));

407 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(1));

408 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(0));

409 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
OPUS_AUTO
));

410 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(0));

411 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(0));

412 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(0));

413 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

414 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

415 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(8));

416 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

417 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(84315));

419 c⁄° 
pcm
[960*3] =

742 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 960, 
d©a
, 7380);

743 
	`as£π
(
îr
 > 0);

745 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

746 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(1));

747 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(0));

748 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

749 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
OPUS_AUTO
));

750 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PHASE_INVERSION_DISABLED
(1));

751 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(1));

752 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(6));

753 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

754 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
));

755 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(9));

756 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

757 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(5));

758 
	`›us_mu…i°ªam_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(775410));

760 c⁄° 
pcm
[1440*3] =

886 
îr
 = 
	`›us_mu…i°ªam_ícode
(
íc
, 
pcm
, 1440, 
d©a
, 7380);

888 
	`as£π
(
îr
 > 0);

890 
	`›us_mu…i°ªam_ícodî_de°roy
(
íc
);

892 
	}
}

894 
	$ec_íc_shrök_as£π
()

896 
OpusEncodî
 *
íc
;

897 
îr
;

898 
d©a_Àn
;

899 
d©a
[2000];

900 c⁄° 
pcm1
[960] = { 5140 };

901 c⁄° 
pcm2
[2880] =

931 c⁄° 
pcm3
[2880] = { 0 };

933 
íc
 = 
	`›us_ícodî_¸óã
(48000, 1, 
OPUS_APPLICATION_AUDIO
, &
îr
);

934 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(10));

935 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(6));

936 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(6000));

937 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm1
, 960, 
d©a
, 2000);

938 
	`as£π
(
d©a_Àn
 > 0);

940 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_VOICE
));

941 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(1));

942 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_SUPERWIDEBAND
));

943 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(1));

944 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(15600));

945 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm2
, 2880, 
d©a
, 122);

946 
	`as£π
(
d©a_Àn
 > 0);

948 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

949 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(27000));

950 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm3
, 2880, 
d©a
, 122);

951 
	`as£π
(
d©a_Àn
 > 0);

953 
	`›us_ícodî_de°roy
(
íc
);

955 
	}
}

957 
	$ec_íc_shrök_as£π2
()

959 
OpusEncodî
 *
íc
;

960 
îr
;

961 
d©a_Àn
;

962 
d©a
[2000];

964 
íc
 = 
	`›us_ícodî_¸óã
(48000, 1, 
OPUS_APPLICATION_AUDIO
, &
îr
);

965 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(6));

966 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_VOICE
));

967 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_BANDWIDTH_FULLBAND
));

968 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(26));

969 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(27000));

971 c⁄° 
pcm
[960] = { 0 };

972 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm
, 960, 
d©a
, 2000);

973 
	`as£π
(
d©a_Àn
 > 0);

975 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
OPUS_SIGNAL_MUSIC
));

977 c⁄° 
pcm
[480] =

982 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm
, 480, 
d©a
, 19);

983 
	`as£π
(
d©a_Àn
 > 0);

985 
	`›us_ícodî_de°roy
(
íc
);

987 
	}
}

989 
	$sûk_gaö_as£π
()

991 
OpusEncodî
 *
íc
;

992 
îr
;

993 
d©a_Àn
;

994 
d©a
[1000];

995 c⁄° 
pcm1
[160] = { 0 };

996 c⁄° 
pcm2
[960] =

1007 
íc
 = 
	`›us_ícodî_¸óã
(8000, 1, 
OPUS_APPLICATION_AUDIO
, &
îr
);

1008 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(3));

1009 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_NARROWBAND
));

1010 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(6000));

1011 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm1
, 160, 
d©a
, 1000);

1012 
	`as£π
(
d©a_Àn
 > 0);

1014 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(0));

1015 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(0));

1016 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
OPUS_BANDWIDTH_MEDIUMBAND
));

1017 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(2867));

1018 
d©a_Àn
 = 
	`›us_ícode
(
íc
, 
pcm2
, 960, 
d©a
, 1000);

1019 
	`as£π
(
d©a_Àn
 > 0);

1021 
	`›us_ícodî_de°roy
(
íc
);

1023 
	}
}

1025 
	$ªgªssi⁄_ã°
()

1027 
	`Ârötf
(
°dîr
, "Running simpleÅests for bugsÅhat have been fixedÖreviously\n");

1028 
	`˚…_ec_öã∫Æ_îr‹
();

1029 
	`mscbr_ícode_Áû10
();

1030 
	`mscbr_ícode_Áû
();

1031 
	`suºound_™Æysis_unöô
();

1032 
	`ec_íc_shrök_as£π
();

1033 
	`ec_íc_shrök_as£π2
();

1034 
	`sûk_gaö_as£π
();

1035 
	}
}

	@tests/test_opus_api.c

44 #ifde‡
HAVE_CONFIG_H


45 
	~"c⁄fig.h
"

48 
	~<°dio.h
>

49 
	~<°dlib.h
>

50 
	~<°döt.h
>

51 
	~<°rög.h
>

52 
	~"¨ch.h
"

53 
	~"›us_mu…i°ªam.h
"

54 
	~"›us.h
"

55 
	~"ã°_›us_comm⁄.h
"

57 #ifde‡
VALGRIND


58 
	~<vÆgröd/memcheck.h
>

59 
	#VG_UNDEF
(
x
,
y
Ë
	`VALGRIND_MAKE_MEM_UNDEFINED
((x),(y))

	)

60 
	#VG_CHECK
(
x
,
y
Ë
	`VALGRIND_CHECK_MEM_IS_DEFINED
((x),(y))

	)

62 
	#VG_UNDEF
(
x
,
y
)

	)

63 
	#VG_CHECK
(
x
,
y
)

	)

66 #i‡
deföed
(
HAVE___MALLOC_HOOK
)

67 
	#MALLOC_FAIL


	)

68 
	~"os_suµ‹t.h
"

69 
	~<mÆloc.h
>

71 c⁄° 
›us_öt32
 
	g›us_≠ps
[3] = {
OPUS_APPLICATION_VOIP
,

72 
OPUS_APPLICATION_AUDIO
,
OPUS_APPLICATION_RESTRICTED_LOWDELAY
};

74 *
mÆloc_hook
(
__©åibuã__
((
unu£d
)Ë
size_t
 
size
,

75 
__©åibuã__
((
unu£d
)Ëc⁄° *
ˇŒî
)

81 
›us_öt32
 *
	gnuŒ_öt_±r
 = (›us_öt32 *)
NULL
;

82 
›us_uöt32
 *
	gnuŒ_uöt_±r
 = (›us_uöt32 *)
NULL
;

84 c⁄° 
›us_öt32
 
	g›us_øãs
[5] = {48000,24000,16000,12000,8000};

86 
›us_öt32
 
	$ã°_dec_≠i
()

88 
›us_uöt32
 
dec_föÆ_ønge
;

89 
OpusDecodî
 *
dec
;

90 
OpusDecodî
 *
dec2
;

91 
›us_öt32
 
i
,
j
,
cfgs
;

92 
∑ckë
[1276];

93 #i‚de‡
DISABLE_FLOAT_API


94 
fbuf
[960*2];

96 
sbuf
[960*2];

97 
c
,
îr
;

99 
cfgs
=0;

101 
	`Ârötf
(
°dout
,"\n Decoder basic APIÅests\n");

102 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

103 
c
=0;c<4;c++)

105 
i
=
	`›us_decodî_gë_size
(
c
);

106 if(((
c
==1||c==2)&&(
i
<=2048||i>1<<16))||((c!=1&&c!=2)&&i!=0))
	`ã°_Áûed
();

107 
	`Ârötf
(
°dout
," opus_decodî_gë_size(%d)=%d ...............%†OK.\n",
c
,
i
,i>0?"":"....");

108 
cfgs
++;

112 
c
=0;c<4;c++)

114 
i
=-7;i<=96000;i++)

116 
fs
;

117 if((
i
==8000||i==12000||i==16000||i==24000||i==48000)&&(
c
==1||c==2));

118 
i
)

120 (-5):
fs
=-8000;;

121 (-6):
fs
=
INT32_MAX
;;

122 (-7):
fs
=
INT32_MIN
;;

123 :
fs
=
i
;

125 
îr
 = 
OPUS_OK
;

126 
	`VG_UNDEF
(&
îr
,(err));

127 
dec
 = 
	`›us_decodî_¸óã
(
fs
, 
c
, &
îr
);

128 if(
îr
!=
OPUS_BAD_ARG
 || 
dec
!=
NULL
)
	`ã°_Áûed
();

129 
cfgs
++;

130 
dec
 = 
	`›us_decodî_¸óã
(
fs
, 
c
, 0);

131 if(
dec
!=
NULL
)
	`ã°_Áûed
();

132 
cfgs
++;

133 
dec
=
	`mÆloc
(
	`›us_decodî_gë_size
(2));

134 if(
dec
==
NULL
)
	`ã°_Áûed
();

135 
îr
 = 
	`›us_decodî_öô
(
dec
,
fs
,
c
);

136 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

137 
cfgs
++;

138 
	`‰ì
(
dec
);

142 
	`VG_UNDEF
(&
îr
,(err));

143 
dec
 = 
	`›us_decodî_¸óã
(48000, 2, &
îr
);

144 if(
îr
!=
OPUS_OK
 || 
dec
==
NULL
)
	`ã°_Áûed
();

145 
	`VG_CHECK
(
dec
,
	`›us_decodî_gë_size
(2));

146 
cfgs
++;

148 
	`Ârötf
(
°dout
," opus_decoder_create() ........................ OK.\n");

149 
	`Ârötf
(
°dout
," opus_decoder_init() .......................... OK.\n");

151 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(
nuŒ_uöt_±r
));

152 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

153 
	`VG_UNDEF
(&
dec_föÆ_ønge
,(dec_final_range));

154 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
));

155 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

156 
	`VG_CHECK
(&
dec_föÆ_ønge
,(dec_final_range));

157 
	`Ârötf
(
°dout
," OPUS_GET_FINAL_RANGE ......................... OK.\n");

158 
cfgs
++;

160 
îr
=
	`›us_decodî_˘l
(
dec
,
OPUS_UNIMPLEMENTED
);

161 if(
îr
!=
OPUS_UNIMPLEMENTED
)
	`ã°_Áûed
();

162 
	`Ârötf
(
°dout
," OPUS_UNIMPLEMENTED ........................... OK.\n");

163 
cfgs
++;

165 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_BANDWIDTH
(
nuŒ_öt_±r
));

166 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

167 
	`VG_UNDEF
(&
i
,(i));

168 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_BANDWIDTH
(&
i
));

169 if(
îr
 !
OPUS_OK
 || 
i
!=0)
	`ã°_Áûed
();

170 
	`Ârötf
(
°dout
," OPUS_GET_BANDWIDTH ........................... OK.\n");

171 
cfgs
++;

173 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_SAMPLE_RATE
(
nuŒ_öt_±r
));

174 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

175 
	`VG_UNDEF
(&
i
,(i));

176 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_SAMPLE_RATE
(&
i
));

177 if(
îr
 !
OPUS_OK
 || 
i
!=48000)
	`ã°_Áûed
();

178 
	`Ârötf
(
°dout
," OPUS_GET_SAMPLE_RATE ......................... OK.\n");

179 
cfgs
++;

182 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(
nuŒ_öt_±r
));

183 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

184 
cfgs
++;

185 
	`VG_UNDEF
(&
i
,(i));

186 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

187 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

188 
cfgs
++;

189 
	`VG_UNDEF
(
∑ckë
,(packet));

190 
∑ckë
[0]=63<<2;packet[1]=packet[2]=0;

191 if(
	`›us_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

192 
cfgs
++;

193 
	`VG_UNDEF
(&
i
,(i));

194 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

195 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

196 
cfgs
++;

197 
∑ckë
[0]=1;

198 if(
	`›us_decode
(
dec
, 
∑ckë
, 1, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

199 
cfgs
++;

200 
	`VG_UNDEF
(&
i
,(i));

201 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

202 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

203 
cfgs
++;

204 
	`Ârötf
(
°dout
," OPUS_GET_PITCH ............................... OK.\n");

206 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_LAST_PACKET_DURATION
(
nuŒ_öt_±r
));

207 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

208 
	`VG_UNDEF
(&
i
,(i));

209 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_LAST_PACKET_DURATION
(&
i
));

210 if(
îr
 !
OPUS_OK
 || 
i
!=960)
	`ã°_Áûed
();

211 
cfgs
++;

212 
	`Ârötf
(
°dout
," OPUS_GET_LAST_PACKET_DURATION ................ OK.\n");

214 
	`VG_UNDEF
(&
i
,(i));

215 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_GAIN
(&
i
));

216 
	`VG_CHECK
(&
i
,(i));

217 if(
îr
 !
OPUS_OK
 || 
i
!=0)
	`ã°_Áûed
();

218 
cfgs
++;

219 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_GAIN
(
nuŒ_öt_±r
));

220 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

221 
cfgs
++;

222 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_SET_GAIN
(-32769));

223 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

224 
cfgs
++;

225 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_SET_GAIN
(32768));

226 if(
îr
 !
OPUS_BAD_ARG
)
	`ã°_Áûed
();

227 
cfgs
++;

228 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_SET_GAIN
(-15));

229 if(
îr
 !
OPUS_OK
)
	`ã°_Áûed
();

230 
cfgs
++;

231 
	`VG_UNDEF
(&
i
,(i));

232 
îr
=
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_GAIN
(&
i
));

233 
	`VG_CHECK
(&
i
,(i));

234 if(
îr
 !
OPUS_OK
 || 
i
!=-15)
	`ã°_Áûed
();

235 
cfgs
++;

236 
	`Ârötf
(
°dout
," OPUS_SET_GAIN ................................ OK.\n");

237 
	`Ârötf
(
°dout
," OPUS_GET_GAIN ................................ OK.\n");

240 
dec2
=
	`mÆloc
(
	`›us_decodî_gë_size
(2));

241 
	`mem˝y
(
dec2
,
dec
,
	`›us_decodî_gë_size
(2));

242 if(
	`›us_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

243 if(
	`memcmp
(
dec2
,
dec
,
	`›us_decodî_gë_size
(2))==0)
	`ã°_Áûed
();

244 
	`‰ì
(
dec2
);

245 
	`Ârötf
(
°dout
," OPUS_RESET_STATE ............................. OK.\n");

246 
cfgs
++;

248 
	`VG_UNDEF
(
∑ckë
,(packet));

249 
∑ckë
[0]=0;

250 if(
	`›us_decodî_gë_nb_ßm∂es
(
dec
,
∑ckë
,1)!=480)
	`ã°_Áûed
();

251 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,1,48000)!=480)
	`ã°_Áûed
();

252 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,1,96000)!=960)
	`ã°_Áûed
();

253 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,1,32000)!=320)
	`ã°_Áûed
();

254 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,1,8000)!=80)
	`ã°_Áûed
();

255 
∑ckë
[0]=3;

256 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,1,24000)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

257 
∑ckë
[0]=(63<<2)|3;

258 
∑ckë
[1]=63;

259 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,0,24000)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

260 if(
	`›us_∑ckë_gë_nb_ßm∂es
(
∑ckë
,2,48000)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

261 if(
	`›us_decodî_gë_nb_ßm∂es
(
dec
,
∑ckë
,2)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

262 
	`Ârötf
(
°dout
," opus_{packet,decoder}_get_nb_samples() ....... OK.\n");

263 
cfgs
+=9;

265 if(
OPUS_BAD_ARG
!=
	`›us_∑ckë_gë_nb_‰ames
(
∑ckë
,0))
	`ã°_Áûed
();

266 
i
=0;i<256;i++) {

267 
l1ªs
[4]={1,2,2,
OPUS_INVALID_PACKET
};

268 
∑ckë
[0]=
i
;

269 if(
l1ªs
[
∑ckë
[0]&3]!=
	`›us_∑ckë_gë_nb_‰ames
’ackë,1))
	`ã°_Áûed
();

270 
cfgs
++;

271 
j
=0;j<256;j++) {

272 
∑ckë
[1]=
j
;

273 if(((
∑ckë
[0]&3)!=3?
l1ªs
[∑ckë[0]&3]:∑ckë[1]&63)!=
	`›us_∑ckë_gë_nb_‰ames
’ackë,2))
	`ã°_Áûed
();

274 
cfgs
++;

277 
	`Ârötf
(
°dout
," opus_packet_get_nb_frames() .................. OK.\n");

279 
i
=0;i<256;i++) {

280 
bw
;

281 
∑ckë
[0]=
i
;

282 
bw
=
∑ckë
[0]>>4;

283 
bw
=
OPUS_BANDWIDTH_NARROWBAND
+(((((bw&7)*9)&(63-(bw&8)))+2+12*((bw&8)!=0))>>4);

284 if(
bw
!=
	`›us_∑ckë_gë_b™dwidth
(
∑ckë
))
	`ã°_Áûed
();

285 
cfgs
++;

287 
	`Ârötf
(
°dout
," opus_packet_get_bandwidth() .................. OK.\n");

289 
i
=0;i<256;i++) {

290 
Â3s
,
øã
;

291 
∑ckë
[0]=
i
;

292 
Â3s
=
∑ckë
[0]>>3;

293 
Â3s
=((((3-(fp3s&3))*13&119)+9)>>2)*((fp3s>13)*(3-((fp3s&3)==3))+1)*25;

294 
øã
=0;rate<5;rate++) {

295 if((
›us_øãs
[
øã
]*3/
Â3s
)!=
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,›us_øãs[øã]))
	`ã°_Áûed
();

296 
cfgs
++;

299 
	`Ârötf
(
°dout
," opus_packet_get_samples_per_frame() .......... OK.\n");

301 
∑ckë
[0]=(63<<2)+3;

302 
∑ckë
[1]=49;

303 
j
=2;j<51;j++)
∑ckë
[j]=0;

304 
	`VG_UNDEF
(
sbuf
,(sbuf));

305 if(
	`›us_decode
(
dec
, 
∑ckë
, 51, 
sbuf
, 960, 0)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

306 
cfgs
++;

307 
∑ckë
[0]=(63<<2);

308 
∑ckë
[1]=packet[2]=0;

309 if(
	`›us_decode
(
dec
, 
∑ckë
, -1, 
sbuf
, 960, 0)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

310 
cfgs
++;

311 if(
	`›us_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 60, 0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

312 
cfgs
++;

313 if(
	`›us_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 480, 0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

314 
cfgs
++;

315 if(
	`›us_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

316 
cfgs
++;

317 
	`Ârötf
(
°dout
," opus_decode() ................................ OK.\n");

318 #i‚de‡
DISABLE_FLOAT_API


319 
	`VG_UNDEF
(
fbuf
,(fbuf));

320 if(
	`›us_decode_Êﬂt
(
dec
, 
∑ckë
, 3, 
fbuf
, 960, 0)!=960)
	`ã°_Áûed
();

321 
cfgs
++;

322 
	`Ârötf
(
°dout
," opus_decode_float() .......................... OK.\n");

327 if(
	`›us_decodî_˘l
(0,
OPUS_RESET_STATE
Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

328 if(
	`›us_decodî_öô
(0,48000,1Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

329 if(
	`›us_decode
(0,
∑ckë
,1,
outbuf
,2880,0Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

330 if(
	`›us_decode_Êﬂt
(0,
∑ckë
,1,0,2880,0Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

331 if(
	`›us_decodî_gë_nb_ßm∂es
(0,
∑ckë
,1Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

332 if(
	`›us_∑ckë_gë_nb_‰ames
(
NULL
,1Ë!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

333 if(
	`›us_∑ckë_gë_b™dwidth
(
NULL
Ë!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

334 if(
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
NULL
,48000)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

336 
	`›us_decodî_de°roy
(
dec
);

337 
cfgs
++;

338 
	`Ârötf
(
°dout
," All decoder interfaceÅestsÖassed\n");

339 
	`Ârötf
(
°dout
," (%6d API invoˇti⁄s)\n",
cfgs
);

340  
cfgs
;

341 
	}
}

343 
›us_öt32
 
	$ã°_msdec_≠i
()

345 
›us_uöt32
 
dec_föÆ_ønge
;

346 
OpusMSDecodî
 *
dec
;

347 
OpusDecodî
 *
°ªamdec
;

348 
›us_öt32
 
i
,
j
,
cfgs
;

349 
∑ckë
[1276];

350 
m≠pög
[256];

351 #i‚de‡
DISABLE_FLOAT_API


352 
fbuf
[960*2];

354 
sbuf
[960*2];

355 
a
,
b
,
c
,
îr
;

357 
m≠pög
[0]=0;

358 
m≠pög
[1]=1;

359 
i
=2;i<256;i++)
	`VG_UNDEF
(&
m≠pög
[i],());

361 
cfgs
=0;

363 
	`Ârötf
(
°dout
,"\n Multistream decoder basic APIÅests\n");

364 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

365 
a
=-1;a<4;a++)

367 
b
=-1;b<4;b++)

369 
i
=
	`›us_mu…i°ªam_decodî_gë_size
(
a
,
b
);

370 if(((
a
>0&&
b
<˜&&b>=0)&&(
i
<=2048||i>((1<<16)*a)))||(◊<1||b>a||b<0)&&i!=0))
	`ã°_Áûed
();

371 
	`Ârötf
(
°dout
," opus_mu…i°ªam_decodî_gë_size(%2d,%2d)=%d %sOK.\n",
a
,
b
,
i
,i>0?"":"... ");

372 
cfgs
++;

377 
c
=1;c<3;c++)

379 
i
=-7;i<=96000;i++)

381 
fs
;

382 if((
i
==8000||i==12000||i==16000||i==24000||i==48000)&&(
c
==1||c==2));

383 
i
)

385 (-5):
fs
=-8000;;

386 (-6):
fs
=
INT32_MAX
;;

387 (-7):
fs
=
INT32_MIN
;;

388 :
fs
=
i
;

390 
îr
 = 
OPUS_OK
;

391 
	`VG_UNDEF
(&
îr
,(err));

392 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(
fs
, 
c
, 1, c-1, 
m≠pög
, &
îr
);

393 if(
îr
!=
OPUS_BAD_ARG
 || 
dec
!=
NULL
)
	`ã°_Áûed
();

394 
cfgs
++;

395 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(
fs
, 
c
, 1, c-1, 
m≠pög
, 0);

396 if(
dec
!=
NULL
)
	`ã°_Áûed
();

397 
cfgs
++;

398 
dec
=
	`mÆloc
(
	`›us_mu…i°ªam_decodî_gë_size
(1,1));

399 if(
dec
==
NULL
)
	`ã°_Áûed
();

400 
îr
 = 
	`›us_mu…i°ªam_decodî_öô
(
dec
,
fs
,
c
,1,c-1, 
m≠pög
);

401 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

402 
cfgs
++;

403 
	`‰ì
(
dec
);

407 
c
=0;c<2;c++)

409 *
ªt_îr
;

410 
ªt_îr
 = 
c
?0:&
îr
;

412 
m≠pög
[0]=0;

413 
m≠pög
[1]=1;

414 
i
=2;i<256;i++)
	`VG_UNDEF
(&
m≠pög
[i],());

416 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

417 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 2, 1, 0, 
m≠pög
, 
ªt_îr
);

418 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

419 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

420 
cfgs
++;

422 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

423 
m≠pög
[0]=mapping[1]=0;

424 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 2, 1, 0, 
m≠pög
, 
ªt_îr
);

425 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

426 if((
ªt_îr
 && *ªt_îr!=
OPUS_OK
Ë|| 
dec
==
NULL
)
	`ã°_Áûed
();

427 
cfgs
++;

428 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

429 
cfgs
++;

431 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

432 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 1, 4, 1, 
m≠pög
, 
ªt_îr
);

433 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

434 if((
ªt_îr
 && *ªt_îr!=
OPUS_OK
Ë|| 
dec
==
NULL
)
	`ã°_Áûed
();

435 
cfgs
++;

437 
îr
 = 
	`›us_mu…i°ªam_decodî_öô
(
dec
,48000, 1, 0, 0, 
m≠pög
);

438 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

439 
cfgs
++;

441 
îr
 = 
	`›us_mu…i°ªam_decodî_öô
(
dec
,48000, 1, 1, -1, 
m≠pög
);

442 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

443 
cfgs
++;

445 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

446 
cfgs
++;

448 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

449 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 2, 1, 1, 
m≠pög
, 
ªt_îr
);

450 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

451 if((
ªt_îr
 && *ªt_îr!=
OPUS_OK
Ë|| 
dec
==
NULL
)
	`ã°_Áûed
();

452 
cfgs
++;

453 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

454 
cfgs
++;

456 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

457 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 255, 255, 1, 
m≠pög
, 
ªt_îr
);

458 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

459 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

460 
cfgs
++;

462 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

463 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, -1, 1, 1, 
m≠pög
, 
ªt_îr
);

464 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

465 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

466 
cfgs
++;

468 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

469 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 0, 1, 1, 
m≠pög
, 
ªt_îr
);

470 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

471 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

472 
cfgs
++;

474 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

475 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 1, -1, 2, 
m≠pög
, 
ªt_îr
);

476 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

477 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

478 
cfgs
++;

480 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

481 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 1, -1, -1, 
m≠pög
, 
ªt_îr
);

482 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

483 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

484 
cfgs
++;

486 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

487 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 256, 255, 1, 
m≠pög
, 
ªt_îr
);

488 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

489 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

490 
cfgs
++;

492 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

493 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 256, 255, 0, 
m≠pög
, 
ªt_îr
);

494 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

495 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

496 
cfgs
++;

498 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

499 
m≠pög
[0]=255;

500 
m≠pög
[1]=1;

501 
m≠pög
[2]=2;

502 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 3, 2, 0, 
m≠pög
, 
ªt_îr
);

503 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

504 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

505 
cfgs
++;

507 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

508 
m≠pög
[0]=0;

509 
m≠pög
[1]=0;

510 
m≠pög
[2]=0;

511 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 3, 2, 1, 
m≠pög
, 
ªt_îr
);

512 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

513 if((
ªt_îr
 && *ªt_îr!=
OPUS_OK
Ë|| 
dec
==
NULL
)
	`ã°_Áûed
();

514 
cfgs
++;

515 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

516 
cfgs
++;

518 
	`VG_UNDEF
(
ªt_îr
,(*ret_err));

519 
m≠pög
[0]=0;

520 
m≠pög
[1]=255;

521 
m≠pög
[2]=1;

522 
m≠pög
[3]=2;

523 
m≠pög
[4]=3;

524 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48001, 5, 4, 1, 
m≠pög
, 
ªt_îr
);

525 if(
ªt_îr
){
	`VG_CHECK
(ret_err,(*ret_err));}

526 if((
ªt_îr
 && *ªt_îr!=
OPUS_BAD_ARG
Ë|| 
dec
!=
NULL
)
	`ã°_Áûed
();

527 
cfgs
++;

530 
	`VG_UNDEF
(&
îr
,(err));

531 
m≠pög
[0]=0;

532 
m≠pög
[1]=255;

533 
m≠pög
[2]=1;

534 
m≠pög
[3]=2;

535 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 4, 2, 1, 
m≠pög
, &
îr
);

536 
	`VG_CHECK
(&
îr
,(err));

537 if(
îr
!=
OPUS_OK
 || 
dec
==
NULL
)
	`ã°_Áûed
();

538 
cfgs
++;

540 
	`Ârötf
(
°dout
," opus_multistream_decoder_create() ............ OK.\n");

541 
	`Ârötf
(
°dout
," opus_multistream_decoder_init() .............. OK.\n");

543 
	`VG_UNDEF
(&
dec_föÆ_ønge
,(dec_final_range));

544 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
));

545 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

546 
	`VG_CHECK
(&
dec_föÆ_ønge
,(dec_final_range));

547 
	`Ârötf
(
°dout
," OPUS_GET_FINAL_RANGE ......................... OK.\n");

548 
cfgs
++;

550 
°ªamdec
=0;

551 
	`VG_UNDEF
(&
°ªamdec
,(streamdec));

552 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(-1,&
°ªamdec
));

553 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

554 
cfgs
++;

555 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(1,&
°ªamdec
));

556 if(
îr
!=
OPUS_OK
||
°ªamdec
==
NULL
)
	`ã°_Áûed
();

557 
	`VG_CHECK
(
°ªamdec
,
	`›us_decodî_gë_size
(1));

558 
cfgs
++;

559 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(2,&
°ªamdec
));

560 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

561 
cfgs
++;

562 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(0,&
°ªamdec
));

563 if(
îr
!=
OPUS_OK
||
°ªamdec
==
NULL
)
	`ã°_Áûed
();

564 
	`VG_CHECK
(
°ªamdec
,
	`›us_decodî_gë_size
(1));

565 
	`Ârötf
(
°dout
," OPUS_MULTISTREAM_GET_DECODER_STATE ........... OK.\n");

566 
cfgs
++;

568 
j
=0;j<2;j++)

570 
OpusDecodî
 *
od
;

571 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
,
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(
j
,&
od
));

572 if(
îr
 !
OPUS_OK
)
	`ã°_Áûed
();

573 
	`VG_UNDEF
(&
i
,(i));

574 
îr
=
	`›us_decodî_˘l
(
od
, 
	`OPUS_GET_GAIN
(&
i
));

575 
	`VG_CHECK
(&
i
,(i));

576 if(
îr
 !
OPUS_OK
 || 
i
!=0)
	`ã°_Áûed
();

577 
cfgs
++;

579 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
,
	`OPUS_SET_GAIN
(15));

580 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

581 
	`Ârötf
(
°dout
," OPUS_SET_GAIN ................................ OK.\n");

582 
j
=0;j<2;j++)

584 
OpusDecodî
 *
od
;

585 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
,
	`OPUS_MULTISTREAM_GET_DECODER_STATE
(
j
,&
od
));

586 if(
îr
 !
OPUS_OK
)
	`ã°_Áûed
();

587 
	`VG_UNDEF
(&
i
,(i));

588 
îr
=
	`›us_decodî_˘l
(
od
, 
	`OPUS_GET_GAIN
(&
i
));

589 
	`VG_CHECK
(&
i
,(i));

590 if(
îr
 !
OPUS_OK
 || 
i
!=15)
	`ã°_Áûed
();

591 
cfgs
++;

593 
	`Ârötf
(
°dout
," OPUS_GET_GAIN ................................ OK.\n");

595 
	`VG_UNDEF
(&
i
,(i));

596 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_BANDWIDTH
(&
i
));

597 if(
îr
 !
OPUS_OK
 || 
i
!=0)
	`ã°_Áûed
();

598 
	`Ârötf
(
°dout
," OPUS_GET_BANDWIDTH ........................... OK.\n");

599 
cfgs
++;

601 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
,
OPUS_UNIMPLEMENTED
);

602 if(
îr
!=
OPUS_UNIMPLEMENTED
)
	`ã°_Áûed
();

603 
	`Ârötf
(
°dout
," OPUS_UNIMPLEMENTED ........................... OK.\n");

604 
cfgs
++;

609 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(
nuŒ_öt_±r
));

610 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

611 
cfgs
++;

612 
	`VG_UNDEF
(&
i
,(i));

613 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

614 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

615 
cfgs
++;

616 
	`VG_UNDEF
(
∑ckë
,(packet));

617 
∑ckë
[0]=63<<2;packet[1]=packet[2]=0;

618 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

619 
cfgs
++;

620 
	`VG_UNDEF
(&
i
,(i));

621 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

622 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

623 
cfgs
++;

624 
∑ckë
[0]=1;

625 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 1, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

626 
cfgs
++;

627 
	`VG_UNDEF
(&
i
,(i));

628 
îr
=
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
	`OPUS_GET_PITCH
(&
i
));

629 if(
îr
 !
OPUS_OK
 || 
i
>0 || i<-1)
	`ã°_Áûed
();

630 
cfgs
++;

631 
	`Ârötf
(
°dout
," OPUS_GET_PITCH ............................... OK.\n");

635 if(
	`›us_mu…i°ªam_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

636 
	`Ârötf
(
°dout
," OPUS_RESET_STATE ............................. OK.\n");

637 
cfgs
++;

639 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

640 
cfgs
++;

641 
	`VG_UNDEF
(&
îr
,(err));

642 
dec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 2, 1, 1, 
m≠pög
, &
îr
);

643 if(
îr
!=
OPUS_OK
 || 
dec
==
NULL
)
	`ã°_Áûed
();

644 
cfgs
++;

646 
∑ckë
[0]=(63<<2)+3;

647 
∑ckë
[1]=49;

648 
j
=2;j<51;j++)
∑ckë
[j]=0;

649 
	`VG_UNDEF
(
sbuf
,(sbuf));

650 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 51, 
sbuf
, 960, 0)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

651 
cfgs
++;

652 
∑ckë
[0]=(63<<2);

653 
∑ckë
[1]=packet[2]=0;

654 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, -1, 
sbuf
, 960, 0)!=
OPUS_BAD_ARG
){
	`¥ötf
("%d\n",›us_mu…i°ªam_decode(dec,Öackë, -1, sbuf, 960, 0));
	`ã°_Áûed
();}

655 
cfgs
++;

656 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, -960, 0)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

657 
cfgs
++;

658 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 60, 0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

659 
cfgs
++;

660 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 480, 0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

661 
cfgs
++;

662 if(
	`›us_mu…i°ªam_decode
(
dec
, 
∑ckë
, 3, 
sbuf
, 960, 0)!=960)
	`ã°_Áûed
();

663 
cfgs
++;

664 
	`Ârötf
(
°dout
," opus_multistream_decode() .................... OK.\n");

665 #i‚de‡
DISABLE_FLOAT_API


666 
	`VG_UNDEF
(
fbuf
,(fbuf));

667 if(
	`›us_mu…i°ªam_decode_Êﬂt
(
dec
, 
∑ckë
, 3, 
fbuf
, 960, 0)!=960)
	`ã°_Áûed
();

668 
cfgs
++;

669 
	`Ârötf
(
°dout
," opus_multistream_decode_float() .............. OK.\n");

674 if(
	`›us_mu…i°ªam_decodî_˘l
(0,
OPUS_RESET_STATE
Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

675 if(
	`›us_mu…i°ªam_decodî_öô
(0,48000,1Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

676 if(
	`›us_mu…i°ªam_decode
(0,
∑ckë
,1,
outbuf
,2880,0Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

677 if(
	`›us_mu…i°ªam_decode_Êﬂt
(0,
∑ckë
,1,0,2880,0Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

678 if(
	`›us_mu…i°ªam_decodî_gë_nb_ßm∂es
(0,
∑ckë
,1Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

680 
	`›us_mu…i°ªam_decodî_de°roy
(
dec
);

681 
cfgs
++;

682 
	`Ârötf
(
°dout
," All multistream decoder interfaceÅestsÖassed\n");

683 
	`Ârötf
(
°dout
," (%6d API invoˇti⁄s)\n",
cfgs
);

684  
cfgs
;

685 
	}
}

687 #ifde‡
VALGRIND


688 
	#UNDEFINE_FOR_PARSE
 
toc
=-1; \

689 
‰ames
[0]=(*)0; \

690 
‰ames
[1]=(*)0; \

691 
∑ylﬂd_off£t
=-1; \

692 
	`VG_UNDEF
(&
toc
,(toc)); \

693 
	`VG_UNDEF
(
‰ames
,(frames));\

694 
	`VG_UNDEF
(&
∑ylﬂd_off£t
,’aylﬂd_off£t));

	)

696 
	#UNDEFINE_FOR_PARSE
 
toc
=-1; \

697 
‰ames
[0]=(*)0; \

698 
‰ames
[1]=(*)0; \

699 
∑ylﬂd_off£t
=-1;

	)

707 
›us_öt32
 
	$ã°_∑r£
()

709 
›us_öt32
 
i
,
j
,
jj
,
sz
;

710 
∑ckë
[1276];

711 
›us_öt32
 
cfgs
,
cfgs_tŸÆ
;

712 
toc
;

713 c⁄° *
‰ames
[48];

714 
size
[48];

715 
∑ylﬂd_off£t
, 
ªt
;

716 
	`Ârötf
(
°dout
,"\n Packet headerÖarsingÅests\n");

717 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

718 
	`mem£t
(
∑ckë
,0,()*1276);

719 
∑ckë
[0]=63<<2;

720 if(
	`›us_∑ckë_∑r£
(
∑ckë
,1,&
toc
,
‰ames
,0,&
∑ylﬂd_off£t
)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

721 
cfgs_tŸÆ
=
cfgs
=1;

723 
i
=0;i<64;i++)

725 
∑ckë
[0]=
i
<<2;

726 
UNDEFINE_FOR_PARSE


727 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,4,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

728 
cfgs
++;

729 if(
ªt
!=1)
	`ã°_Áûed
();

730 if(
size
[0]!=3)
	`ã°_Áûed
();

731 if(
‰ames
[0]!=
∑ckë
+1)
	`ã°_Áûed
();

733 
	`Ârötf
(
°dout
," codê0 (%2d ca£sË............................ OK.\n",
cfgs
);

734 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

737 
i
=0;i<64;i++)

739 
∑ckë
[0]=(
i
<<2)+1;

740 
jj
=0;jj<=1275*2+3;jj++)

742 
UNDEFINE_FOR_PARSE


743 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
jj
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

744 
cfgs
++;

745 if((
jj
&1)==1 && jj<=2551)

749 if(
ªt
!=2)
	`ã°_Áûed
();

750 if(
size
[0]!=size[1] || size[0]!=((
jj
-1)>>1))
	`ã°_Áûed
();

751 if(
‰ames
[0]!=
∑ckë
+1)
	`ã°_Áûed
();

752 if(
‰ames
[1]!=‰ames[0]+
size
[0])
	`ã°_Áûed
();

753 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

754 } if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

757 
	`Ârötf
(
°dout
," codê1 (%6d ca£sË........................ OK.\n",
cfgs
);

758 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

760 
i
=0;i<64;i++)

763 
∑ckë
[0]=(
i
<<2)+2;

764 
UNDEFINE_FOR_PARSE


765 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

766 
cfgs
++;

767 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

768 
∑ckë
[1]=252;

769 
UNDEFINE_FOR_PARSE


770 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

771 
cfgs
++;

772 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

773 
j
=0;j<1275;j++)

775 if(
j
<252)
∑ckë
[1]=j;

776 {
∑ckë
[1]=252+(
j
&3);packet[2]=(j-252)>>2;}

778 
UNDEFINE_FOR_PARSE


779 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
j
+(j<252?2:3)-1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

780 
cfgs
++;

781 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

783 
UNDEFINE_FOR_PARSE


784 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
j
+(j<252?2:3)+1276,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

785 
cfgs
++;

786 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

788 
UNDEFINE_FOR_PARSE


789 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
j
+(j<252?2:3),&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

790 
cfgs
++;

791 if(
ªt
!=2)
	`ã°_Áûed
();

792 if(
size
[0]!=
j
||size[1]!=0)
	`ã°_Áûed
();

793 if(
‰ames
[1]!=‰ames[0]+
size
[0])
	`ã°_Áûed
();

794 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

796 
UNDEFINE_FOR_PARSE


797 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,(
j
<<1)+4,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

798 
cfgs
++;

799 if(
ªt
!=2)
	`ã°_Áûed
();

800 if(
size
[0]!=
j
||size[1]!=(j<<1)+3-j-(j<252?1:2))
	`ã°_Áûed
();

801 if(
‰ames
[1]!=‰ames[0]+
size
[0])
	`ã°_Áûed
();

802 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

805 
	`Ârötf
(
°dout
," codê2 (%6d ca£sË........................ OK.\n",
cfgs
);

806 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

808 
i
=0;i<64;i++)

810 
∑ckë
[0]=(
i
<<2)+3;

812 
UNDEFINE_FOR_PARSE


813 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

814 
cfgs
++;

815 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

817 
	`Ârötf
(
°dout
," codê3 m-åunˇti⁄ (%2d ca£sË............... OK.\n",
cfgs
);

818 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

820 
i
=0;i<64;i++)

823 
∑ckë
[0]=(
i
<<2)+3;

824 
jj
=49;jj<=64;jj++)

826 
∑ckë
[1]=0+(
jj
&63);

827 
UNDEFINE_FOR_PARSE


828 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1275,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

829 
cfgs
++;

830 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

831 
∑ckë
[1]=128+(
jj
&63);

832 
UNDEFINE_FOR_PARSE


833 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1275,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

834 
cfgs
++;

835 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

836 
∑ckë
[1]=64+(
jj
&63);

837 
UNDEFINE_FOR_PARSE


838 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1275,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

839 
cfgs
++;

840 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

841 
∑ckë
[1]=128+64+(
jj
&63);

842 
UNDEFINE_FOR_PARSE


843 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1275,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

844 
cfgs
++;

845 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

848 
	`Ârötf
(
°dout
," codê3 m=0,49-64 (%2d ca£sË................ OK.\n",
cfgs
);

849 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

851 
i
=0;i<64;i++)

853 
∑ckë
[0]=(
i
<<2)+3;

855 
∑ckë
[1]=1;

856 
j
=0;j<1276;j++)

858 
UNDEFINE_FOR_PARSE


859 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
j
+2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

860 
cfgs
++;

861 if(
ªt
!=1)
	`ã°_Áûed
();

862 if(
size
[0]!=
j
)
	`ã°_Áûed
();

863 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

865 
UNDEFINE_FOR_PARSE


866 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1276+2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

867 
cfgs
++;

868 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

870 
	`Ârötf
(
°dout
," codê3 m=1 CBR (%2d ca£sË................. OK.\n",
cfgs
);

871 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

873 
i
=0;i<64;i++)

875 
‰ame_ßmp
;

877 
∑ckë
[0]=(
i
<<2)+3;

878 
‰ame_ßmp
=
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,48000);

879 
j
=2;j<49;j++)

881 
∑ckë
[1]=
j
;

882 
sz
=2;sz<((
j
+2)*1275);sz++)

884 
UNDEFINE_FOR_PARSE


885 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
sz
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

886 
cfgs
++;

888 if(
‰ame_ßmp
*
j
<=5760 && (
sz
-2)%j==0 && (sz-2)/j<1276)

890 if(
ªt
!=
j
)
	`ã°_Áûed
();

891 
jj
=1;jj<
ªt
;jj++)if(
‰ames
[jj]!=‰ames[jj-1]+
size
[jj-1])
	`ã°_Áûed
();

892 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

893 } if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

897 
∑ckë
[1]=5760/
‰ame_ßmp
;

898 
UNDEFINE_FOR_PARSE


899 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,1275*∑ckë[1]+2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

900 
cfgs
++;

901 if(
ªt
!=
∑ckë
[1])
	`ã°_Áûed
();

902 
jj
=0;jj<
ªt
;jj++)if(
size
[jj]!=1275)
	`ã°_Áûed
();

904 
	`Ârötf
(
°dout
," codê3 m=1-48 CBR (%2d ca£sË.......... OK.\n",
cfgs
);

905 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

907 
i
=0;i<64;i++)

909 
‰ame_ßmp
;

911 
∑ckë
[0]=(
i
<<2)+3;

912 
∑ckë
[1]=128+1;

913 
‰ame_ßmp
=
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,48000);

914 
jj
=0;jj<1276;jj++)

916 
UNDEFINE_FOR_PARSE


917 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
jj
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

918 
cfgs
++;

919 if(
ªt
!=1)
	`ã°_Áûed
();

920 if(
size
[0]!=
jj
)
	`ã°_Áûed
();

921 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

923 
UNDEFINE_FOR_PARSE


924 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+1276,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

925 
cfgs
++;

926 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

927 
j
=2;j<49;j++)

929 
∑ckë
[1]=128+
j
;

931 
UNDEFINE_FOR_PARSE


932 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
j
-2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

933 
cfgs
++;

934 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

935 
∑ckë
[2]=252;

936 
∑ckë
[3]=0;

937 
jj
=4;jj<2+
j
;jj++)
∑ckë
[jj]=0;

938 
UNDEFINE_FOR_PARSE


939 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
j
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

940 
cfgs
++;

941 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

943 
jj
=2;jj<2+
j
;jj++)
∑ckë
[jj]=0;

944 
UNDEFINE_FOR_PARSE


945 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
j
-2,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

946 
cfgs
++;

947 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

949 
∑ckë
[2]=252;

950 
∑ckë
[3]=0;

951 
jj
=4;jj<2+
j
;jj++)
∑ckë
[jj]=0;

952 
UNDEFINE_FOR_PARSE


953 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
j
+252-1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

954 
cfgs
++;

955 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

957 
jj
=2;jj<2+
j
;jj++)
∑ckë
[jj]=0;

958 
UNDEFINE_FOR_PARSE


959 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
j
-1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

960 
cfgs
++;

961 if(
‰ame_ßmp
*
j
<=5760){

962 if(
ªt
!=
j
)
	`ã°_Áûed
();

963 
jj
=0;jj<
j
;jj++)if(
size
[jj]!=0)
	`ã°_Áûed
();

964 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

965 } if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

967 
sz
=0;sz<8;sz++)

969 c⁄° 
tsz
[8]={50,201,403,700,1472,5110,20400,61298};

970 
pos
=0;

971 
as
=(
tsz
[
sz
]+
i
-
j
-2)/j;

972 
jj
=0;jj<
j
-1;jj++)

974 if(
as
<252){
∑ckë
[2+
pos
]=as;pos++;}

975 {
∑ckë
[2+
pos
]=252+(
as
&3);packet[3+pos]=(as-252)>>2;pos+=2;}

977 
UNDEFINE_FOR_PARSE


978 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,
tsz
[
sz
]+
i
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

979 
cfgs
++;

980 if(
‰ame_ßmp
*
j
<=5760 && 
as
<1276 && (
tsz
[
sz
]+
i
-2-
pos
-as*(j-1))<1276){

981 if(
ªt
!=
j
)
	`ã°_Áûed
();

982 
jj
=0;jj<
j
-1;jj++)if(
size
[jj]!=
as
)
	`ã°_Áûed
();

983 if(
size
[
j
-1]!=(
tsz
[
sz
]+
i
-2-
pos
-
as
*(j-1)))
	`ã°_Áûed
();

984 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

985 } if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

989 
	`Ârötf
(
°dout
," codê3 m=1-48 VBR (%2d ca£sË............. OK.\n",
cfgs
);

990 
cfgs_tŸÆ
+=
cfgs
;cfgs=0;

992 
i
=0;i<64;i++)

994 
∑ckë
[0]=(
i
<<2)+3;

996 
∑ckë
[1]=128+1+64;

998 
jj
=2;jj<127;jj++)
∑ckë
[jj]=255;

999 
UNDEFINE_FOR_PARSE


1000 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,127,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

1001 
cfgs
++;

1002 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1004 
sz
=0;sz<4;sz++)

1006 c⁄° 
tsz
[4]={0,72,512,1275};

1007 
jj
=
sz
;jj<65025;jj+=11)

1009 
pos
;

1010 
pos
=0;pos<
jj
/254;pos++)
∑ckë
[2+pos]=255;

1011 
∑ckë
[2+
pos
]=
jj
%254;

1012 
pos
++;

1013 if(
sz
==0&&
i
==63)

1016 
UNDEFINE_FOR_PARSE


1017 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
jj
+
pos
-1,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

1018 
cfgs
++;

1019 if(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1021 
UNDEFINE_FOR_PARSE


1022 
ªt
=
	`›us_∑ckë_∑r£
(
∑ckë
,2+
jj
+
tsz
[
sz
]+
i
+
pos
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
);

1023 
cfgs
++;

1024 if(
tsz
[
sz
]+
i
<1276)

1026 if(
ªt
!=1)
	`ã°_Áûed
();

1027 if(
size
[0]!=
tsz
[
sz
]+
i
)
	`ã°_Áûed
();

1028 if((
toc
>>2)!=
i
)
	`ã°_Áûed
();

1029 } i‡(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1033 
	`Ârötf
(
°dout
," codê3Öaddög (%2d ca£sË............... OK.\n",
cfgs
);

1034 
cfgs_tŸÆ
+=
cfgs
;

1035 
	`Ârötf
(
°dout
," opus_packet_parse ............................ OK.\n");

1036 
	`Ârötf
(
°dout
," AllÖacketÖarsingÅestsÖassed\n");

1037 
	`Ârötf
(
°dout
," (%d API invoˇti⁄s)\n",
cfgs_tŸÆ
);

1038  
cfgs_tŸÆ
;

1039 
	}
}

1044 
	#CHECK_SETGET
(
£tˇŒ
,
gëˇŒ
,
badv
,
badv2
,
goodv
,
goodv2
,
sok
,
gok
) \

1045 
i
=(
badv
);\

1046 if(
	`›us_ícodî_˘l
(
íc
,
£tˇŒ
)==
OPUS_OK
)
	`ã°_Áûed
();\

1047 
i
=(
badv2
);\

1048 if(
	`›us_ícodî_˘l
(
íc
,
£tˇŒ
)==
OPUS_OK
)
	`ã°_Áûed
();\

1049 
j
=
i
=(
goodv
);\

1050 if(
	`›us_ícodî_˘l
(
íc
,
£tˇŒ
)!=
OPUS_OK
)
	`ã°_Áûed
();\

1051 
i
=-12345;\

1052 
	`VG_UNDEF
(&
i
,(i)); \

1053 
îr
=
	`›us_ícodî_˘l
(
íc
,
gëˇŒ
);\

1054 if(
îr
!=
OPUS_OK
 || 
i
!=
j
)
	`ã°_Áûed
();\

1055 
j
=
i
=(
goodv2
);\

1056 if(
	`›us_ícodî_˘l
(
íc
,
£tˇŒ
)!=
OPUS_OK
)
	`ã°_Áûed
();\

1057 
	`Ârötf
(
°dout
,
sok
);\

1058 
i
=-12345;\

1059 
	`VG_UNDEF
(&
i
,(i)); \

1060 
îr
=
	`›us_ícodî_˘l
(
íc
,
gëˇŒ
);\

1061 if(
îr
!=
OPUS_OK
 || 
i
!=
j
)
	`ã°_Áûed
();\

1062 
	`Ârötf
(
°dout
,
gok
);\

1063 
cfgs
+=6;

	)

1065 
›us_öt32
 
	$ã°_íc_≠i
()

1067 
›us_uöt32
 
íc_föÆ_ønge
;

1068 
OpusEncodî
 *
íc
;

1069 
›us_öt32
 
i
,
j
;

1070 
∑ckë
[1276];

1071 #i‚de‡
DISABLE_FLOAT_API


1072 
fbuf
[960*2];

1074 
sbuf
[960*2];

1075 
c
,
îr
,
cfgs
;

1077 
cfgs
=0;

1079 
	`Ârötf
(
°dout
,"\n Encoder basic APIÅests\n");

1080 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

1081 
c
=0;c<4;c++)

1083 
i
=
	`›us_ícodî_gë_size
(
c
);

1084 if(((
c
==1||c==2)&&(
i
<=2048||i>1<<17))||((c!=1&&c!=2)&&i!=0))
	`ã°_Áûed
();

1085 
	`Ârötf
(
°dout
," opus_ícodî_gë_size(%d)=%d ...............%†OK.\n",
c
,
i
,i>0?"":"....");

1086 
cfgs
++;

1090 
c
=0;c<4;c++)

1092 
i
=-7;i<=96000;i++)

1094 
fs
;

1095 if((
i
==8000||i==12000||i==16000||i==24000||i==48000)&&(
c
==1||c==2));

1096 
i
)

1098 (-5):
fs
=-8000;;

1099 (-6):
fs
=
INT32_MAX
;;

1100 (-7):
fs
=
INT32_MIN
;;

1101 :
fs
=
i
;

1103 
îr
 = 
OPUS_OK
;

1104 
	`VG_UNDEF
(&
îr
,(err));

1105 
íc
 = 
	`›us_ícodî_¸óã
(
fs
, 
c
, 
OPUS_APPLICATION_VOIP
, &
îr
);

1106 if(
îr
!=
OPUS_BAD_ARG
 || 
íc
!=
NULL
)
	`ã°_Áûed
();

1107 
cfgs
++;

1108 
íc
 = 
	`›us_ícodî_¸óã
(
fs
, 
c
, 
OPUS_APPLICATION_VOIP
, 0);

1109 if(
íc
!=
NULL
)
	`ã°_Áûed
();

1110 
cfgs
++;

1111 
	`›us_ícodî_de°roy
(
íc
);

1112 
íc
=
	`mÆloc
(
	`›us_ícodî_gë_size
(2));

1113 if(
íc
==
NULL
)
	`ã°_Áûed
();

1114 
îr
 = 
	`›us_ícodî_öô
(
íc
, 
fs
, 
c
, 
OPUS_APPLICATION_VOIP
);

1115 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1116 
cfgs
++;

1117 
	`‰ì
(
íc
);

1121 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_AUTO
, 
NULL
);

1122 if(
íc
!=
NULL
)
	`ã°_Áûed
();

1123 
cfgs
++;

1125 
	`VG_UNDEF
(&
îr
,(err));

1126 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_AUTO
, &
îr
);

1127 if(
îr
!=
OPUS_BAD_ARG
 || 
íc
!=
NULL
)
	`ã°_Áûed
();

1128 
cfgs
++;

1130 
	`VG_UNDEF
(&
îr
,(err));

1131 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_APPLICATION_VOIP
, 
NULL
);

1132 if(
íc
==
NULL
)
	`ã°_Áûed
();

1133 
	`›us_ícodî_de°roy
(
íc
);

1134 
cfgs
++;

1136 
	`VG_UNDEF
(&
îr
,(err));

1137 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_APPLICATION_RESTRICTED_LOWDELAY
, &
îr
);

1138 if(
îr
!=
OPUS_OK
 || 
íc
==
NULL
)
	`ã°_Áûed
();

1139 
cfgs
++;

1140 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_LOOKAHEAD
(&
i
));

1141 if(
îr
!=
OPUS_OK
 || 
i
<0 || i>32766)
	`ã°_Áûed
();

1142 
cfgs
++;

1143 
	`›us_ícodî_de°roy
(
íc
);

1145 
	`VG_UNDEF
(&
îr
,(err));

1146 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_APPLICATION_AUDIO
, &
îr
);

1147 if(
îr
!=
OPUS_OK
 || 
íc
==
NULL
)
	`ã°_Áûed
();

1148 
cfgs
++;

1149 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_LOOKAHEAD
(&
i
));

1150 if(
îr
!=
OPUS_OK
 || 
i
<0 || i>32766)
	`ã°_Áûed
();

1151 
	`›us_ícodî_de°roy
(
íc
);

1152 
cfgs
++;

1154 
	`VG_UNDEF
(&
îr
,(err));

1155 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_APPLICATION_VOIP
, &
îr
);

1156 if(
îr
!=
OPUS_OK
 || 
íc
==
NULL
)
	`ã°_Áûed
();

1157 
cfgs
++;

1159 
	`Ârötf
(
°dout
," opus_encoder_create() ........................ OK.\n");

1160 
	`Ârötf
(
°dout
," opus_encoder_init() .......................... OK.\n");

1162 
i
=-12345;

1163 
	`VG_UNDEF
(&
i
,(i));

1164 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_LOOKAHEAD
(&
i
));

1165 if(
îr
!=
OPUS_OK
 || 
i
<0 || i>32766)
	`ã°_Áûed
();

1166 
cfgs
++;

1167 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_LOOKAHEAD
(
nuŒ_öt_±r
));

1168 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1169 
cfgs
++;

1170 
	`Ârötf
(
°dout
," OPUS_GET_LOOKAHEAD ........................... OK.\n");

1172 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_SAMPLE_RATE
(&
i
));

1173 if(
îr
!=
OPUS_OK
 || 
i
!=48000)
	`ã°_Áûed
();

1174 
cfgs
++;

1175 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_SAMPLE_RATE
(
nuŒ_öt_±r
));

1176 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1177 
cfgs
++;

1178 
	`Ârötf
(
°dout
," OPUS_GET_SAMPLE_RATE ......................... OK.\n");

1180 if(
	`›us_ícodî_˘l
(
íc
,
OPUS_UNIMPLEMENTED
)!=OPUS_UNIMPLEMENTED)
	`ã°_Áûed
();

1181 
	`Ârötf
(
°dout
," OPUS_UNIMPLEMENTED ........................... OK.\n");

1182 
cfgs
++;

1184 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_APPLICATION
(
nuŒ_öt_±r
));

1185 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1186 
cfgs
++;

1187 
	`CHECK_SETGET
(
	`OPUS_SET_APPLICATION
(
i
),
	`OPUS_GET_APPLICATION
(&i),-1,
OPUS_AUTO
,

1188 
OPUS_APPLICATION_AUDIO
,
OPUS_APPLICATION_RESTRICTED_LOWDELAY
,

1192 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_BITRATE
(
nuŒ_öt_±r
));

1193 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1194 
cfgs
++;

1195 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BITRATE
(1073741832))!=
OPUS_OK
)
	`ã°_Áûed
();

1196 
cfgs
++;

1197 
	`VG_UNDEF
(&
i
,(i));

1198 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_BITRATE
(&
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1199 if(
i
>700000||i<256000)
	`ã°_Áûed
();

1200 
cfgs
++;

1201 
	`CHECK_SETGET
(
	`OPUS_SET_BITRATE
(
i
),
	`OPUS_GET_BITRATE
(&i),-12345,0,

1206 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_FORCE_CHANNELS
(
nuŒ_öt_±r
));

1207 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1208 
cfgs
++;

1209 
	`CHECK_SETGET
(
	`OPUS_SET_FORCE_CHANNELS
(
i
),
	`OPUS_GET_FORCE_CHANNELS
(&i),-1,3,

1210 1,
OPUS_AUTO
,

1214 
i
=-2;

1215 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))==
OPUS_OK
)
	`ã°_Áûed
();

1216 
cfgs
++;

1217 
i
=
OPUS_BANDWIDTH_FULLBAND
+1;

1218 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))==
OPUS_OK
)
	`ã°_Áûed
();

1219 
cfgs
++;

1220 
i
=
OPUS_BANDWIDTH_NARROWBAND
;

1221 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1222 
cfgs
++;

1223 
i
=
OPUS_BANDWIDTH_FULLBAND
;

1224 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1225 
cfgs
++;

1226 
i
=
OPUS_BANDWIDTH_WIDEBAND
;

1227 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1228 
cfgs
++;

1229 
i
=
OPUS_BANDWIDTH_MEDIUMBAND
;

1230 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1231 
cfgs
++;

1232 
	`Ârötf
(
°dout
," OPUS_SET_BANDWIDTH ........................... OK.\n");

1235 
i
=-12345;

1236 
	`VG_UNDEF
(&
i
,(i));

1237 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_BANDWIDTH
(&
i
));

1238 if(
îr
!=
OPUS_OK
 || (
i
!=
OPUS_BANDWIDTH_NARROWBAND
&&

1239 
i
!=
OPUS_BANDWIDTH_MEDIUMBAND
&&i!=
OPUS_BANDWIDTH_WIDEBAND
&&

1240 
i
!=
OPUS_BANDWIDTH_FULLBAND
&&i!=
OPUS_AUTO
))
	`ã°_Áûed
();

1241 
cfgs
++;

1242 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
))!=
OPUS_OK
)
	`ã°_Áûed
();

1243 
cfgs
++;

1244 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_BANDWIDTH
(
nuŒ_öt_±r
));

1245 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1246 
cfgs
++;

1247 
	`Ârötf
(
°dout
," OPUS_GET_BANDWIDTH ........................... OK.\n");

1249 
i
=-2;

1250 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))==
OPUS_OK
)
	`ã°_Áûed
();

1251 
cfgs
++;

1252 
i
=
OPUS_BANDWIDTH_FULLBAND
+1;

1253 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))==
OPUS_OK
)
	`ã°_Áûed
();

1254 
cfgs
++;

1255 
i
=
OPUS_BANDWIDTH_NARROWBAND
;

1256 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1257 
cfgs
++;

1258 
i
=
OPUS_BANDWIDTH_FULLBAND
;

1259 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1260 
cfgs
++;

1261 
i
=
OPUS_BANDWIDTH_WIDEBAND
;

1262 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1263 
cfgs
++;

1264 
i
=
OPUS_BANDWIDTH_MEDIUMBAND
;

1265 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_MAX_BANDWIDTH
(
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

1266 
cfgs
++;

1267 
	`Ârötf
(
°dout
," OPUS_SET_MAX_BANDWIDTH ....................... OK.\n");

1270 
i
=-12345;

1271 
	`VG_UNDEF
(&
i
,(i));

1272 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_MAX_BANDWIDTH
(&
i
));

1273 if(
îr
!=
OPUS_OK
 || (
i
!=
OPUS_BANDWIDTH_NARROWBAND
&&

1274 
i
!=
OPUS_BANDWIDTH_MEDIUMBAND
&&i!=
OPUS_BANDWIDTH_WIDEBAND
&&

1275 
i
!=
OPUS_BANDWIDTH_FULLBAND
))
	`ã°_Áûed
();

1276 
cfgs
++;

1277 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_MAX_BANDWIDTH
(
nuŒ_öt_±r
));

1278 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1279 
cfgs
++;

1280 
	`Ârötf
(
°dout
," OPUS_GET_MAX_BANDWIDTH ....................... OK.\n");

1282 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_DTX
(
nuŒ_öt_±r
));

1283 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1284 
cfgs
++;

1285 
	`CHECK_SETGET
(
	`OPUS_SET_DTX
(
i
),
	`OPUS_GET_DTX
(&i),-1,2,

1290 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_COMPLEXITY
(
nuŒ_öt_±r
));

1291 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1292 
cfgs
++;

1293 
	`CHECK_SETGET
(
	`OPUS_SET_COMPLEXITY
(
i
),
	`OPUS_GET_COMPLEXITY
(&i),-1,11,

1298 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_INBAND_FEC
(
nuŒ_öt_±r
));

1299 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1300 
cfgs
++;

1301 
	`CHECK_SETGET
(
	`OPUS_SET_INBAND_FEC
(
i
),
	`OPUS_GET_INBAND_FEC
(&i),-1,2,

1306 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_PACKET_LOSS_PERC
(
nuŒ_öt_±r
));

1307 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1308 
cfgs
++;

1309 
	`CHECK_SETGET
(
	`OPUS_SET_PACKET_LOSS_PERC
(
i
),
	`OPUS_GET_PACKET_LOSS_PERC
(&i),-1,101,

1314 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_VBR
(
nuŒ_öt_±r
));

1315 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1316 
cfgs
++;

1317 
	`CHECK_SETGET
(
	`OPUS_SET_VBR
(
i
),
	`OPUS_GET_VBR
(&i),-1,2,

1330 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_VBR_CONSTRAINT
(
nuŒ_öt_±r
));

1331 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1332 
cfgs
++;

1333 
	`CHECK_SETGET
(
	`OPUS_SET_VBR_CONSTRAINT
(
i
),
	`OPUS_GET_VBR_CONSTRAINT
(&i),-1,2,

1338 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_SIGNAL
(
nuŒ_öt_±r
));

1339 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1340 
cfgs
++;

1341 
	`CHECK_SETGET
(
	`OPUS_SET_SIGNAL
(
i
),
	`OPUS_GET_SIGNAL
(&i),-12345,0x7FFFFFFF,

1342 
OPUS_SIGNAL_MUSIC
,
OPUS_AUTO
,

1346 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_LSB_DEPTH
(
nuŒ_öt_±r
));

1347 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1348 
cfgs
++;

1349 
	`CHECK_SETGET
(
	`OPUS_SET_LSB_DEPTH
(
i
),
	`OPUS_GET_LSB_DEPTH
(&i),7,25,16,24,

1353 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_PREDICTION_DISABLED
(&
i
));

1354 if(
i
!=0)
	`ã°_Áûed
();

1355 
cfgs
++;

1356 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_PREDICTION_DISABLED
(
nuŒ_öt_±r
));

1357 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1358 
cfgs
++;

1359 
	`CHECK_SETGET
(
	`OPUS_SET_PREDICTION_DISABLED
(
i
),
	`OPUS_GET_PREDICTION_DISABLED
(&i),-1,2,1,0,

1363 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_EXPERT_FRAME_DURATION
(
nuŒ_öt_±r
));

1364 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1365 
cfgs
++;

1366 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_2_5_MS
));

1367 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1368 
cfgs
++;

1369 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_5_MS
));

1370 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1371 
cfgs
++;

1372 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_10_MS
));

1373 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1374 
cfgs
++;

1375 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_20_MS
));

1376 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1377 
cfgs
++;

1378 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_40_MS
));

1379 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1380 
cfgs
++;

1381 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_60_MS
));

1382 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1383 
cfgs
++;

1384 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_80_MS
));

1385 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1386 
cfgs
++;

1387 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_100_MS
));

1388 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1389 
cfgs
++;

1390 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_SET_EXPERT_FRAME_DURATION
(
OPUS_FRAMESIZE_120_MS
));

1391 if(
îr
!=
OPUS_OK
)
	`ã°_Áûed
();

1392 
cfgs
++;

1393 
	`CHECK_SETGET
(
	`OPUS_SET_EXPERT_FRAME_DURATION
(
i
),
	`OPUS_GET_EXPERT_FRAME_DURATION
(&i),0,-1,

1394 
OPUS_FRAMESIZE_60_MS
,
OPUS_FRAMESIZE_ARG
,

1400 
îr
=
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_FINAL_RANGE
(
nuŒ_uöt_±r
));

1401 if(
îr
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1402 
cfgs
++;

1403 if(
	`›us_ícodî_˘l
(
íc
,
	`OPUS_GET_FINAL_RANGE
(&
íc_föÆ_ønge
))!=
OPUS_OK
)
	`ã°_Áûed
();

1404 
cfgs
++;

1405 
	`Ârötf
(
°dout
," OPUS_GET_FINAL_RANGE ......................... OK.\n");

1408 if(
	`›us_ícodî_˘l
(
íc
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

1409 
cfgs
++;

1410 
	`Ârötf
(
°dout
," OPUS_RESET_STATE ............................. OK.\n");

1412 
	`mem£t
(
sbuf
,0,()*2*960);

1413 
	`VG_UNDEF
(
∑ckë
,(packet));

1414 
i
=
	`›us_ícode
(
íc
, 
sbuf
, 960, 
∑ckë
, (packet));

1415 if(
i
<1 || (i>(
›us_öt32
)(
∑ckë
)))
	`ã°_Áûed
();

1416 
	`VG_CHECK
(
∑ckë
,
i
);

1417 
cfgs
++;

1418 
	`Ârötf
(
°dout
," opus_encode() ................................ OK.\n");

1419 #i‚de‡
DISABLE_FLOAT_API


1420 
	`mem£t
(
fbuf
,0,()*2*960);

1421 
	`VG_UNDEF
(
∑ckë
,(packet));

1422 
i
=
	`›us_ícode_Êﬂt
(
íc
, 
fbuf
, 960, 
∑ckë
, (packet));

1423 if(
i
<1 || (i>(
›us_öt32
)(
∑ckë
)))
	`ã°_Áûed
();

1424 
	`VG_CHECK
(
∑ckë
,
i
);

1425 
cfgs
++;

1426 
	`Ârötf
(
°dout
," opus_encode_float() .......................... OK.\n");

1431 if(
	`›us_ícodî_˘l
(0,
OPUS_RESET_STATE
Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

1432 if(
	`›us_ícodî_öô
(0,48000,1,
OPUS_APPLICATION_VOIP
Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

1433 if(
	`›us_ícode
(0,
sbuf
,960,
∑ckë
,’ackë)Ë!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

1434 if(
	`›us_ícode_Êﬂt
(0,
fbuf
,960,
∑ckë
,’ackë))!=
OPUS_INVALID_STATE
)
	`ã°_Áûed
();

1436 
	`›us_ícodî_de°roy
(
íc
);

1437 
cfgs
++;

1438 
	`Ârötf
(
°dout
," AllÉncoder interfaceÅestsÖassed\n");

1439 
	`Ârötf
(
°dout
," (%d API invoˇti⁄s)\n",
cfgs
);

1440  
cfgs
;

1441 
	}
}

1443 
	#max_out
 (1276*48+48*2+2)

	)

1444 
	$ã°_ª∑ckëizî_≠i
()

1446 
ªt
,
cfgs
,
i
,
j
,
k
;

1447 
OpusRïackëizî
 *
Ω
;

1448 *
∑ckë
;

1449 *
po
;

1450 
cfgs
=0;

1451 
	`Ârötf
(
°dout
,"\n RepacketizerÅests\n");

1452 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

1454 
∑ckë
=
	`mÆloc
(
max_out
);

1455 if(
∑ckë
==
NULL
)
	`ã°_Áûed
();

1456 
	`mem£t
(
∑ckë
,0,
max_out
);

1457 
po
=
	`mÆloc
(
max_out
+256);

1458 if(
po
==
NULL
)
	`ã°_Áûed
();

1460 
i
=
	`›us_ª∑ckëizî_gë_size
();

1461 if(
i
<=0)
	`ã°_Áûed
();

1462 
cfgs
++;

1463 
	`Ârötf
(
°dout
," opus_ª∑ckëizî_gë_size()=%d ............. OK.\n",
i
);

1465 
Ω
=
	`mÆloc
(
i
);

1466 
Ω
=
	`›us_ª∑ckëizî_öô
(rp);

1467 if(
Ω
==
NULL
)
	`ã°_Áûed
();

1468 
cfgs
++;

1469 
	`‰ì
(
Ω
);

1470 
	`Ârötf
(
°dout
," opus_repacketizer_init ....................... OK.\n");

1472 
Ω
=
	`›us_ª∑ckëizî_¸óã
();

1473 if(
Ω
==
NULL
)
	`ã°_Áûed
();

1474 
cfgs
++;

1475 
	`Ârötf
(
°dout
," opus_repacketizer_create ..................... OK.\n");

1477 if(
	`›us_ª∑ckëizî_gë_nb_‰ames
(
Ω
)!=0)
	`ã°_Áûed
();

1478 
cfgs
++;

1479 
	`Ârötf
(
°dout
," opus_repacketizer_get_nb_frames .............. OK.\n");

1482 
	`VG_UNDEF
(
∑ckë
,4);

1483 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,0)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1484 
cfgs
++;

1485 
∑ckë
[0]=1;

1486 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,2)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1487 
cfgs
++;

1488 
∑ckë
[0]=2;

1489 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,1)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1490 
cfgs
++;

1491 
∑ckë
[0]=3;

1492 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,1)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1493 
cfgs
++;

1494 
∑ckë
[0]=2;

1495 
∑ckë
[1]=255;

1496 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,2)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1497 
cfgs
++;

1498 
∑ckë
[0]=2;

1499 
∑ckë
[1]=250;

1500 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,251)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1501 
cfgs
++;

1502 
∑ckë
[0]=3;

1503 
∑ckë
[1]=0;

1504 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,2)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1505 
cfgs
++;

1506 
∑ckë
[1]=49;

1507 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,100)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1508 
cfgs
++;

1509 
∑ckë
[0]=0;

1510 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,3)!=
OPUS_OK
)
	`ã°_Áûed
();

1511 
cfgs
++;

1512 
∑ckë
[0]=1<<2;

1513 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,3)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1514 
cfgs
++;

1517 
	`›us_ª∑ckëizî_öô
(
Ω
);

1518 
j
=0;j<32;j++)

1521 
maxi
;

1522 
∑ckë
[0]=((
j
<<1)+(j&1))<<2;

1523 
maxi
=960/
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,8000);

1524 
i
=1;i<=
maxi
;i++)

1527 
maxp
;

1528 
∑ckë
[0]=((
j
<<1)+(j&1))<<2;

1529 if(
i
>1)
∑ckë
[0]+=i==2?1:3;

1530 
∑ckë
[1]=
i
>2?i:0;

1531 
maxp
=960/(
i
*
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,8000));

1532 
k
=0;k<=(1275+75);k+=3)

1535 
›us_öt32
 
˙t
,
r˙t
;

1536 if(
k
%
i
!=0);

1537 
˙t
=0;˙t<
maxp
+2;cnt++)

1539 if(
˙t
>0)

1541 
ªt
=
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,
k
+(
i
>2?2:1));

1542 if((
˙t
<=
maxp
&&
k
<=(1275*
i
))?
ªt
!=
OPUS_OK
:ªt!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1543 
cfgs
++;

1545 
r˙t
=
k
<=(1275*
i
)?(
˙t
<
maxp
?cnt:maxp):0;

1546 if(
	`›us_ª∑ckëizî_gë_nb_‰ames
(
Ω
)!=
r˙t
*
i
)
	`ã°_Áûed
();

1547 
cfgs
++;

1548 
ªt
=
	`›us_ª∑ckëizî_out_ønge
(
Ω
,0,
r˙t
*
i
,
po
,
max_out
);

1549 if(
r˙t
>0)

1551 
Àn
;

1552 
Àn
=
k
*
r˙t
+(‘˙t*
i
)>2?2:1);

1553 if(
ªt
!=
Àn
)
	`ã°_Áûed
();

1554 if((
r˙t
*
i
)<2&&(
po
[0]&3)!=0)
	`ã°_Áûed
();

1555 if((
r˙t
*
i
)==2&&(
po
[0]&3)!=1)
	`ã°_Áûed
();

1556 if((
r˙t
*
i
)>2&&(((
po
[0]&3)!=3)||’o[1]!Ù˙t*i)))
	`ã°_Áûed
();

1557 
cfgs
++;

1558 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
Àn
)!ˆí)
	`ã°_Áûed
();

1559 
cfgs
++;

1560 if(
	`›us_∑ckë_u≈ad
(
po
,
Àn
)!ˆí)
	`ã°_Áûed
();

1561 
cfgs
++;

1562 if(
	`›us_∑ckë_∑d
(
po
,
Àn
,Àn+1)!=
OPUS_OK
)
	`ã°_Áûed
();

1563 
cfgs
++;

1564 if(
	`›us_∑ckë_∑d
(
po
,
Àn
+1,Àn+256)!=
OPUS_OK
)
	`ã°_Áûed
();

1565 
cfgs
++;

1566 if(
	`›us_∑ckë_u≈ad
(
po
,
Àn
+256)!ˆí)
	`ã°_Áûed
();

1567 
cfgs
++;

1568 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,
Àn
,1)!ˆí)
	`ã°_Áûed
();

1569 
cfgs
++;

1570 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,
Àn
,Àn+1,1)!=
OPUS_OK
)
	`ã°_Áûed
();

1571 
cfgs
++;

1572 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,
Àn
+1,Àn+256,1)!=
OPUS_OK
)
	`ã°_Áûed
();

1573 
cfgs
++;

1574 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,
Àn
+256,1)!ˆí)
	`ã°_Áûed
();

1575 
cfgs
++;

1576 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
Àn
-1)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1577 
cfgs
++;

1578 if(
Àn
>1)

1580 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,1)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1581 
cfgs
++;

1583 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1584 
cfgs
++;

1585 } i‡(
ªt
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1587 
	`›us_ª∑ckëizî_öô
(
Ω
);

1593 
	`›us_ª∑ckëizî_öô
(
Ω
);

1594 
∑ckë
[0]=0;

1595 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,5)!=
OPUS_OK
)
	`ã°_Áûed
();

1596 
cfgs
++;

1597 
∑ckë
[0]+=1;

1598 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,9)!=
OPUS_OK
)
	`ã°_Áûed
();

1599 
cfgs
++;

1600 
i
=
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
max_out
);

1601 if((
i
!=(4+8+2))||((
po
[0]&3)!=3)||(’o[1]&63)!=3)||(’o[1]>>7)!=0))
	`ã°_Áûed
();

1602 
cfgs
++;

1603 
i
=
	`›us_ª∑ckëizî_out_ønge
(
Ω
,0,1,
po
,
max_out
);

1604 if(
i
!=5||(
po
[0]&3)!=0)
	`ã°_Áûed
();

1605 
cfgs
++;

1606 
i
=
	`›us_ª∑ckëizî_out_ønge
(
Ω
,1,2,
po
,
max_out
);

1607 if(
i
!=5||(
po
[0]&3)!=0)
	`ã°_Áûed
();

1608 
cfgs
++;

1611 
	`›us_ª∑ckëizî_öô
(
Ω
);

1612 
∑ckë
[0]=1;

1613 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,9)!=
OPUS_OK
)
	`ã°_Áûed
();

1614 
cfgs
++;

1615 
∑ckë
[0]=0;

1616 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,3)!=
OPUS_OK
)
	`ã°_Áûed
();

1617 
cfgs
++;

1618 
i
=
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
max_out
);

1619 if((
i
!=(2+8+2+2))||((
po
[0]&3)!=3)||(’o[1]&63)!=3)||(’o[1]>>7)!=1))
	`ã°_Áûed
();

1620 
cfgs
++;

1623 
	`›us_ª∑ckëizî_öô
(
Ω
);

1624 
∑ckë
[0]=2;

1625 
∑ckë
[1]=4;

1626 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,8)!=
OPUS_OK
)
	`ã°_Áûed
();

1627 
cfgs
++;

1628 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,8)!=
OPUS_OK
)
	`ã°_Áûed
();

1629 
cfgs
++;

1630 
i
=
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
max_out
);

1631 if((
i
!=(2+1+1+1+4+2+4+2))||((
po
[0]&3)!=3)||(’o[1]&63)!=4)||(’o[1]>>7)!=1))
	`ã°_Áûed
();

1632 
cfgs
++;

1635 
	`›us_ª∑ckëizî_öô
(
Ω
);

1636 
∑ckë
[0]=2;

1637 
∑ckë
[1]=4;

1638 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,10)!=
OPUS_OK
)
	`ã°_Áûed
();

1639 
cfgs
++;

1640 if(
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,10)!=
OPUS_OK
)
	`ã°_Áûed
();

1641 
cfgs
++;

1642 
i
=
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
max_out
);

1643 if((
i
!=(2+4+4+4+4))||((
po
[0]&3)!=3)||(’o[1]&63)!=4)||(’o[1]>>7)!=0))
	`ã°_Áûed
();

1644 
cfgs
++;

1647 
j
=0;j<32;j++)

1650 
maxi
,
sum
,
r˙t
;

1651 
∑ckë
[0]=((
j
<<1)+(j&1))<<2;

1652 
maxi
=960/
	`›us_∑ckë_gë_ßm∂es_≥r_‰ame
(
∑ckë
,8000);

1653 
sum
=0;

1654 
r˙t
=0;

1655 
	`›us_ª∑ckëizî_öô
(
Ω
);

1656 
i
=1;i<=
maxi
+2;i++)

1658 
Àn
;

1659 
ªt
=
	`›us_ª∑ckëizî_ˇt
(
Ω
,
∑ckë
,
i
);

1660 if(
r˙t
<
maxi
)

1662 if(
ªt
!=
OPUS_OK
)
	`ã°_Áûed
();

1663 
r˙t
++;

1664 
sum
+=
i
-1;

1665 } i‡(
ªt
!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1666 
cfgs
++;

1667 
Àn
=
sum
+(
r˙t
<2?1:rcnt<3?2:2+rcnt-1);

1668 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
max_out
)!=
Àn
)
	`ã°_Áûed
();

1669 if(
r˙t
>2&&(
po
[1]&63)!Ù˙t)
	`ã°_Áûed
();

1670 if(
r˙t
==2&&(
po
[0]&3)!=2)
	`ã°_Áûed
();

1671 if(
r˙t
==1&&(
po
[0]&3)!=0)
	`ã°_Áûed
();

1672 
cfgs
++;

1673 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
Àn
)!ˆí)
	`ã°_Áûed
();

1674 
cfgs
++;

1675 if(
	`›us_∑ckë_u≈ad
(
po
,
Àn
)!ˆí)
	`ã°_Áûed
();

1676 
cfgs
++;

1677 if(
	`›us_∑ckë_∑d
(
po
,
Àn
,Àn+1)!=
OPUS_OK
)
	`ã°_Áûed
();

1678 
cfgs
++;

1679 if(
	`›us_∑ckë_∑d
(
po
,
Àn
+1,Àn+256)!=
OPUS_OK
)
	`ã°_Áûed
();

1680 
cfgs
++;

1681 if(
	`›us_∑ckë_u≈ad
(
po
,
Àn
+256)!ˆí)
	`ã°_Áûed
();

1682 
cfgs
++;

1683 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,
Àn
,1)!ˆí)
	`ã°_Áûed
();

1684 
cfgs
++;

1685 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,
Àn
,Àn+1,1)!=
OPUS_OK
)
	`ã°_Áûed
();

1686 
cfgs
++;

1687 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,
Àn
+1,Àn+256,1)!=
OPUS_OK
)
	`ã°_Áûed
();

1688 
cfgs
++;

1689 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,
Àn
+256,1)!ˆí)
	`ã°_Áûed
();

1690 
cfgs
++;

1691 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,
Àn
-1)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1692 
cfgs
++;

1693 if(
Àn
>1)

1695 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,1)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1696 
cfgs
++;

1698 if(
	`›us_ª∑ckëizî_out
(
Ω
,
po
,0)!=
OPUS_BUFFER_TOO_SMALL
)
	`ã°_Áûed
();

1699 
cfgs
++;

1703 
po
[0]='O';

1704 
po
[1]='p';

1705 if(
	`›us_∑ckë_∑d
(
po
,4,4)!=
OPUS_OK
)
	`ã°_Áûed
();

1706 
cfgs
++;

1707 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,4,4,1)!=
OPUS_OK
)
	`ã°_Áûed
();

1708 
cfgs
++;

1709 if(
	`›us_∑ckë_∑d
(
po
,4,5)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1710 
cfgs
++;

1711 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,4,5,1)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1712 
cfgs
++;

1713 if(
	`›us_∑ckë_∑d
(
po
,0,5)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1714 
cfgs
++;

1715 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,0,5,1)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1716 
cfgs
++;

1717 if(
	`›us_∑ckë_u≈ad
(
po
,0)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1718 
cfgs
++;

1719 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,0,1)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1720 
cfgs
++;

1721 if(
	`›us_∑ckë_u≈ad
(
po
,4)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1722 
cfgs
++;

1723 if(
	`›us_mu…i°ªam_∑ckë_u≈ad
(
po
,4,1)!=
OPUS_INVALID_PACKET
)
	`ã°_Áûed
();

1724 
cfgs
++;

1725 
po
[0]=0;

1726 
po
[1]=0;

1727 
po
[2]=0;

1728 if(
	`›us_∑ckë_∑d
(
po
,5,4)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1729 
cfgs
++;

1730 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
po
,5,4,1)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

1731 
cfgs
++;

1733 
	`Ârötf
(
°dout
," opus_repacketizer_cat ........................ OK.\n");

1734 
	`Ârötf
(
°dout
," opus_repacketizer_out ........................ OK.\n");

1735 
	`Ârötf
(
°dout
," opus_repacketizer_out_range .................. OK.\n");

1736 
	`Ârötf
(
°dout
," opus_packet_pad .............................. OK.\n");

1737 
	`Ârötf
(
°dout
," opus_packet_unpad ............................ OK.\n");

1738 
	`Ârötf
(
°dout
," opus_multistream_packet_pad .................. OK.\n");

1739 
	`Ârötf
(
°dout
," opus_multistream_packet_unpad ................ OK.\n");

1741 
	`›us_ª∑ckëizî_de°roy
(
Ω
);

1742 
cfgs
++;

1743 
	`‰ì
(
∑ckë
);

1744 
	`‰ì
(
po
);

1745 
	`Ârötf
(
°dout
," AllÑepacketizerÅestsÖassed\n");

1746 
	`Ârötf
(
°dout
," (%7d API invoˇti⁄s)\n",
cfgs
);

1748  
cfgs
;

1749 
	}
}

1751 #ifde‡
MALLOC_FAIL


1757 #i‡
OPUS_GNUC_PREREQ
(4,6)

1759 #¥agm®
GCC
 
dügno°ic
 
push


1761 #¥agm®
GCC
 
dügno°ic
 
ign‹ed
 "-Wdeprecated-declarations"

1763 *(*
	tmhook
)(
	tsize_t
 
	t__size
, 
	t__c⁄°
 *);

1766 
	$ã°_mÆloc_Áû
()

1768 #ifde‡
MALLOC_FAIL


1769 
OpusDecodî
 *
dec
;

1770 
OpusEncodî
 *
íc
;

1771 
OpusRïackëizî
 *
Ω
;

1772 
m≠pög
[256] = {0,1};

1773 
OpusMSDecodî
 *
msdec
;

1774 
OpusMSEncodî
 *
m£nc
;

1775 
øã
,
c
,
≠p
,
cfgs
,
îr
,
u£îr
;

1776 *
ï
;

1777 
mhook
 
‹ig_mÆloc
;

1778 
cfgs
=0;

1780 
	`Ârötf
(
°dout
,"\n malloc() failureÅests\n");

1781 
	`Ârötf
(
°dout
," ---------------------------------------------------\n");

1782 #ifde‡
MALLOC_FAIL


1783 
‹ig_mÆloc
=
__mÆloc_hook
;

1784 
__mÆloc_hook
=
mÆloc_hook
;

1785 
ï
=(*)
	`›us_Æloc
(());

1786 if(
ï
!=
NULL
)

1788 if(
ï
)
	`‰ì
(ep);

1789 
__mÆloc_hook
=
‹ig_mÆloc
;

1791 
	`Ârötf
(
°dout
," opus_decoder_create() ................... SKIPPED.\n");

1792 
	`Ârötf
(
°dout
," opus_encoder_create() ................... SKIPPED.\n");

1793 
	`Ârötf
(
°dout
," opus_repacketizer_create() .............. SKIPPED.\n");

1794 
	`Ârötf
(
°dout
," opus_multistream_decoder_create() ....... SKIPPED.\n");

1795 
	`Ârötf
(
°dout
," opus_multistream_encoder_create() ....... SKIPPED.\n");

1796 
	`Ârötf
(
°dout
,"(Test only supported with GLIBCánd without valgrind)\n");

1798 #ifde‡
MALLOC_FAIL


1800 
u£îr
=0;useerr<2;useerr++)

1802 
ï
=
u£îr
?&
îr
:0;

1803 
øã
=0;rate<5;rate++)

1805 
c
=1;c<3;c++)

1807 
îr
=1;

1808 if(
u£îr
)

1810 
	`VG_UNDEF
(&
îr
,(err));

1812 
dec
=
	`›us_decodî_¸óã
(
›us_øãs
[
øã
], 
c
, 
ï
);

1813 if(
dec
!=
NULL
||(
u£îr
&&
îr
!=
OPUS_ALLOC_FAIL
))

1815 
__mÆloc_hook
=
‹ig_mÆloc
;

1816 
	`ã°_Áûed
();

1818 
cfgs
++;

1819 
msdec
=
	`›us_mu…i°ªam_decodî_¸óã
(
›us_øãs
[
øã
], 
c
, 1, c-1, 
m≠pög
, 
ï
);

1820 if(
msdec
!=
NULL
||(
u£îr
&&
îr
!=
OPUS_ALLOC_FAIL
))

1822 
__mÆloc_hook
=
‹ig_mÆloc
;

1823 
	`ã°_Áûed
();

1825 
cfgs
++;

1826 
≠p
=0;app<3;app++)

1828 if(
u£îr
)

1830 
	`VG_UNDEF
(&
îr
,(err));

1832 
íc
=
	`›us_ícodî_¸óã
(
›us_øãs
[
øã
], 
c
, 
›us_≠ps
[
≠p
],
ï
);

1833 if(
íc
!=
NULL
||(
u£îr
&&
îr
!=
OPUS_ALLOC_FAIL
))

1835 
__mÆloc_hook
=
‹ig_mÆloc
;

1836 
	`ã°_Áûed
();

1838 
cfgs
++;

1839 
m£nc
=
	`›us_mu…i°ªam_ícodî_¸óã
(
›us_øãs
[
øã
], 
c
, 1, c-1, 
m≠pög
, 
›us_≠ps
[
≠p
],
ï
);

1840 if(
m£nc
!=
NULL
||(
u£îr
&&
îr
!=
OPUS_ALLOC_FAIL
))

1842 
__mÆloc_hook
=
‹ig_mÆloc
;

1843 
	`ã°_Áûed
();

1845 
cfgs
++;

1850 
Ω
=
	`›us_ª∑ckëizî_¸óã
();

1851 if(
Ω
!=
NULL
)

1853 
__mÆloc_hook
=
‹ig_mÆloc
;

1854 
	`ã°_Áûed
();

1856 
cfgs
++;

1857 
__mÆloc_hook
=
‹ig_mÆloc
;

1858 
	`Ârötf
(
°dout
," opus_decoder_create() ........................ OK.\n");

1859 
	`Ârötf
(
°dout
," opus_encoder_create() ........................ OK.\n");

1860 
	`Ârötf
(
°dout
," opus_repacketizer_create() ................... OK.\n");

1861 
	`Ârötf
(
°dout
," opus_multistream_decoder_create() ............ OK.\n");

1862 
	`Ârötf
(
°dout
," opus_multistream_encoder_create() ............ OK.\n");

1863 
	`Ârötf
(
°dout
," All malloc failureÅestsÖassed\n");

1864 
	`Ârötf
(
°dout
," (%2d API invoˇti⁄s)\n",
cfgs
);

1865  
cfgs
;

1867 
	}
}

1869 #ifde‡
MALLOC_FAIL


1870 #i‡
__GNUC_PREREQ
(4,6)

1871 #¥agm®
GCC
 
dügno°ic
 
p›


1875 
	$maö
(
_¨gc
, **
_¨gv
)

1877 
›us_öt32
 
tŸÆ
;

1878 c⁄° * 
ovîsi⁄
;

1879 if(
_¨gc
>1)

1881 
	`Ârötf
(
°dîr
,"Ußge: %s\n",
_¨gv
[0]);

1884 
i£ed
=0;

1886 
ovîsi⁄
=
	`›us_gë_vîsi⁄_°rög
();

1887 if(!
ovîsi⁄
)
	`ã°_Áûed
();

1888 
	`Ârötf
(
°dîr
,"Te°ögÅhê%†API dëîmöi°iˇŒy\n", 
ovîsi⁄
);

1889 if(
	`›us_°ªº‹
(-32768)==
NULL
)
	`ã°_Áûed
();

1890 if(
	`›us_°ªº‹
(32767)==
NULL
)
	`ã°_Áûed
();

1891 if(
	`°æí
(
	`›us_°ªº‹
(0))<1)
	`ã°_Áûed
();

1892 
tŸÆ
=4;

1894 
tŸÆ
+=
	`ã°_dec_≠i
();

1895 
tŸÆ
+=
	`ã°_msdec_≠i
();

1896 
tŸÆ
+=
	`ã°_∑r£
();

1897 
tŸÆ
+=
	`ã°_íc_≠i
();

1898 
tŸÆ
+=
	`ã°_ª∑ckëizî_≠i
();

1899 
tŸÆ
+=
	`ã°_mÆloc_Áû
();

1901 
	`Ârötf
(
°dîr
,"\nAŒ APIÅe°†∑s£d.\nThêlib›u†API wa†övoked %dÅimes.\n",
tŸÆ
);

1904 
	}
}

	@tests/test_opus_common.h

28 
OPUS_INLINE
 
	$deb2_im∂
(*
_t
,**
_p
,
_k
,
_x
,
_y
)

30 
i
;

31 if(
_x
>2){

32 if(
_y
<3)
i
=0;i<_y;i++)*(--*
_p
)=
_t
[i+1];

34 
_t
[
_x
]=_t[_x-
_y
];

35 
	`deb2_im∂
(
_t
,
_p
,
_k
,
_x
+1,
_y
);

36 
i
=
_t
[
_x
-
_y
]+1;i<
_k
;i++){

37 
_t
[
_x
]=
i
;

38 
	`deb2_im∂
(
_t
,
_p
,
_k
,
_x
+1,_x);

41 
	}
}

44 
OPUS_INLINE
 
	$debruijn2
(
_k
, *
_ªs
)

46 *
p
;

47 *
t
;

48 
t
=
	`mÆloc
(()*
_k
*2);

49 
	`mem£t
(
t
,0,()*
_k
*2);

50 
p
=&
_ªs
[
_k
*_k];

51 
	`deb2_im∂
(
t
,&
p
,
_k
,1,1);

52 
	`‰ì
(
t
);

53 
	}
}

56 
›us_uöt32
 
	gRz
, 
	gRw
;

57 
OPUS_INLINE
 
›us_uöt32
 
	$Á°_ønd
()

59 
Rz
=36969*(Rz&65535)+(Rz>>16);

60 
Rw
=18000*(Rw&65535)+(Rw>>16);

61  (
Rz
<<16)+
Rw
;

62 
	}
}

63 
›us_uöt32
 
	gi£ed
;

65 #ifde‡
__GNUC__


66 
__©åibuã__
((
n‹ëu∫
))

67 #ñi‡
deföed
(
_MSC_VER
)

68 
	$__de˛•ec
(
n‹ëu∫
)

70 
OPUS_INLINE
 
	$_ã°_Áûed
(c⁄° *
fûe
, 
löe
)

72 
	`Ârötf
(
°dîr
,"\n ***************************************************\n");

73 
	`Ârötf
(
°dîr
," *** A fatalÉrror was detected. ***\n");

74 
	`Ârötf
(
°dîr
," ***************************************************\n");

75 
	`Ârötf
(
°dîr
,"PleaseÑeportÅhis failureánd include\n");

76 
	`Ârötf
(
°dîr
,"'makêcheck SEED=%u faû†%†©Üöê%d f‹ %s'\n",
i£ed
,
fûe
,
löe
,
	`›us_gë_vîsi⁄_°rög
());

77 
	`Ârötf
(
°dîr
,"andányÑelevant detailsábout your system.\n\n");

78 
	`ab‹t
();

79 
	}
}

80 
	#ã°_Áûed
(Ë
	`_ã°_Áûed
(
__FILE__
, 
__LINE__
);

	)

82 
ªgªssi⁄_ã°
();

	@tests/test_opus_decode.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<limôs.h
>

35 
	~<°döt.h
>

36 
	~<m©h.h
>

37 
	~<°rög.h
>

38 
	~<time.h
>

39 #i‡(!
deföed
 
WIN32
 && !deföed 
_WIN32
Ë|| deföed(
__MINGW32__
)

40 
	~<uni°d.h
>

42 
	~<¥o˚ss.h
>

43 
	#gëpid
 
_gëpid


	)

45 
	~"›us.h
"

46 
	~"ã°_›us_comm⁄.h
"

48 
	#MAX_PACKET
 (1500)

	)

49 
	#MAX_FRAME_SAMP
 (5760)

	)

51 
	$ã°_decodî_code0
(
no_fuzz
)

53 c⁄° 
›us_öt32
 
fsv
[5]={48000,24000,16000,12000,8000};

54 
îr
,
skù
,
∂í
;

55 
out_ßm∂es
,
„c
;

56 
t
;

57 
›us_öt32
 
i
;

58 
OpusDecodî
 *
dec
[5*2];

59 
›us_öt32
 
decsize
;

60 
OpusDecodî
 *
decbak
;

61 
›us_uöt32
 
dec_föÆ_ønge1
,
dec_föÆ_ønge2
,
dec_föÆ_acc
;

62 *
∑ckë
;

63 
modes
[4096];

64 *
outbuf_öt
;

65 *
outbuf
;

67 
dec_föÆ_ønge1
=
dec_föÆ_ønge2
=2;

69 
∑ckë
=
	`mÆloc
(()*
MAX_PACKET
);

70 if(
∑ckë
==
NULL
)
	`ã°_Áûed
();

72 
outbuf_öt
=
	`mÆloc
(()*(
MAX_FRAME_SAMP
+16)*2);

73 
i
=0;i<(
MAX_FRAME_SAMP
+16)*2;i++)
outbuf_öt
[i]=32749;

74 
outbuf
=&
outbuf_öt
[8*2];

76 
	`Ârötf
(
°dout
," Starting %d decoders...\n",5*2);

77 
t
=0;t<5*2;t++)

79 
fs
=
fsv
[
t
>>1];

80 
c
=(
t
&1)+1;

81 
îr
=
OPUS_INTERNAL_ERROR
;

82 
dec
[
t
] = 
	`›us_decodî_¸óã
(
fs
, 
c
, &
îr
);

83 if(
îr
!=
OPUS_OK
 || 
dec
[
t
]==
NULL
)
	`ã°_Áûed
();

84 
	`Ârötf
(
°dout
," opus_decodî_¸óã(%5d,%dËOK. C›y ",
fs
,
c
);

86 
OpusDecodî
 *
dec2
;

88 
dec2
=(
OpusDecodî
 *)
	`mÆloc
(
	`›us_decodî_gë_size
(
c
));

89 if(
dec2
==
NULL
)
	`ã°_Áûed
();

90 
	`mem˝y
(
dec2
,
dec
[
t
],
	`›us_decodî_gë_size
(
c
));

91 
	`mem£t
(
dec
[
t
],255,
	`›us_decodî_gë_size
(
c
));

92 
	`›us_decodî_de°roy
(
dec
[
t
]);

93 
	`¥ötf
("OK.\n");

94 
dec
[
t
]=
dec2
;

98 
decsize
=
	`›us_decodî_gë_size
(1);

99 
decbak
=(
OpusDecodî
 *)
	`mÆloc
(
decsize
);

100 if(
decbak
==
NULL
)
	`ã°_Áûed
();

102 
t
=0;t<5*2;t++)

104 
Á˘‹
=48000/
fsv
[
t
>>1];

105 
„c
=0;fec<2;fec++)

107 
›us_öt32
 
dur
;

109 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 0, 
outbuf
, 120/
Á˘‹
, 
„c
);

110 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

111 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

112 if(
dur
!=120/
Á˘‹
)
	`ã°_Áûed
();

115 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 0, 
outbuf
, 120/
Á˘‹
+2, 
„c
);

116 if(
out_ßm∂es
!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

119 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, -1, 
outbuf
, 120/
Á˘‹
, 
„c
);

120 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

121 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 1, 
outbuf
, 120/
Á˘‹
, 
„c
);

122 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

123 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 10, 
outbuf
, 120/
Á˘‹
, 
„c
);

124 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

125 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 
	`Á°_ønd
(), 
outbuf
, 120/
Á˘‹
, 
„c
);

126 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

127 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

128 if(
dur
!=120/
Á˘‹
)
	`ã°_Áûed
();

131 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 0, 
outbuf
, 120/
Á˘‹
, 
„c
);

132 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

135 
outbuf
[0]=32749;

136 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 0, 
outbuf
, 0, 
„c
);

137 if(
out_ßm∂es
>0)
	`ã°_Áûed
();

138 #i‡!
	`deföed
(
OPUS_BUILD
Ë&& (
	`OPUS_GNUC_PREREQ
(4, 6Ë|| (deföed(
__˛™g_maj‹__
) && __clang_major__ >= 3))

139 #¥agm®
GCC
 
dügno°ic
 
push


140 #¥agm®
GCC
 
dügno°ic
 
ign‹ed
 "-Wnonnull"

142 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 0, 0, 0, 
„c
);

143 #i‡!
	`deföed
(
OPUS_BUILD
Ë&& (
	`OPUS_GNUC_PREREQ
(4, 6Ë|| (deföed(
__˛™g_maj‹__
) && __clang_major__ >= 3))

144 #¥agm®
GCC
 
dügno°ic
 
p›


146 if(
out_ßm∂es
>0)
	`ã°_Áûed
();

147 if(
outbuf
[0]!=32749)
	`ã°_Áûed
();

150 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, -1, 
outbuf
, 
MAX_FRAME_SAMP
, 
„c
);

151 if(
out_ßm∂es
>=0)
	`ã°_Áûed
();

152 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 
INT_MIN
, 
outbuf
, 
MAX_FRAME_SAMP
, 
„c
);

153 if(
out_ßm∂es
>=0)
	`ã°_Áûed
();

154 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, -1, 
outbuf
, -1, 
„c
);

155 if(
out_ßm∂es
>=0)
	`ã°_Áûed
();

158 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 1, 
outbuf
, 
MAX_FRAME_SAMP
, 
„c
?-1:2);

159 if(
out_ßm∂es
>=0)
	`ã°_Áûed
();

162 if(
	`›us_decodî_˘l
(
dec
[
t
], 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

165 
	`Ârötf
(
°dout
," dec[all] initial frame PLC OK.\n");

168 
i
=0;i<64;i++)

170 
›us_öt32
 
dur
;

171 
j
,
ex≥˘ed
[5*2];

172 
∑ckë
[0]=
i
<<2;

173 
∑ckë
[1]=255;

174 
∑ckë
[2]=255;

175 
îr
=
	`›us_∑ckë_gë_nb_ch™√ls
(
∑ckë
);

176 if(
îr
!=(
i
&1)+1)
	`ã°_Áûed
();

178 
t
=0;t<5*2;t++){

179 
ex≥˘ed
[
t
]=
	`›us_decodî_gë_nb_ßm∂es
(
dec
[t],
∑ckë
,1);

180 if(
ex≥˘ed
[
t
]>2880)
	`ã°_Áûed
();

183 
j
=0;j<256;j++)

185 
∑ckë
[1]=
j
;

186 
t
=0;t<5*2;t++)

188 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 3, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

189 if(
out_ßm∂es
!=
ex≥˘ed
[
t
])
	`ã°_Áûed
();

190 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

191 if(
dur
!=
out_ßm∂es
)
	`ã°_Áûed
();

192 
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge1
));

193 if(
t
==0)
dec_föÆ_ønge2
=
dec_föÆ_ønge1
;

194 if(
dec_föÆ_ønge1
!=
dec_föÆ_ønge2
)
	`ã°_Áûed
();

198 
t
=0;t<5*2;t++){

199 
Á˘‹
=48000/
fsv
[
t
>>1];

201 
j
=0;j<6;j++)

203 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 0, 
outbuf
, 
ex≥˘ed
[t], 0);

204 if(
out_ßm∂es
!=
ex≥˘ed
[
t
])
	`ã°_Áûed
();

205 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

206 if(
dur
!=
out_ßm∂es
)
	`ã°_Áûed
();

210 if(
ex≥˘ed
[
t
]!=120/
Á˘‹
)

212 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 0, 0, 
outbuf
, 120/
Á˘‹
, 0);

213 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

214 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

215 if(
dur
!=
out_ßm∂es
)
	`ã°_Áûed
();

217 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 2, 
outbuf
, 
ex≥˘ed
[t]-1, 0);

218 if(
out_ßm∂es
>0)
	`ã°_Áûed
();

221 
	`Ârötf
(
°dout
," dec[all]áll 2-byteÖrefix forÜength 3ánd PLC,áll modes (64) OK.\n");

223 if(
no_fuzz
)

225 
	`Ârötf
(
°dout
," Skipping manyÅests which fuzzÅhe decoderásÑequested.\n");

226 
	`‰ì
(
decbak
);

227 
t
=0;t<5*2;t++)
	`›us_decodî_de°roy
(
dec
[t]);

228 
	`¥ötf
(" Decoders stopped.\n");

230 
îr
=0;

231 
i
=0;i<8*2;i++)
îr
|=
outbuf_öt
[i]!=32749;

232 
i
=
MAX_FRAME_SAMP
*2;i<(MAX_FRAME_SAMP+8)*2;i++)
îr
|=
outbuf
[i]!=32749;

233 if(
îr
)
	`ã°_Áûed
();

235 
	`‰ì
(
outbuf_öt
);

236 
	`‰ì
(
∑ckë
);

243 c⁄° 
cmodes
[4]={16,20,24,28};

244 c⁄° 
›us_uöt32
 
¸es
[4]={116290185,2172123586u,2172123586u,2172123586u};

245 c⁄° 
›us_uöt32
 
Ães
[3]={3285687739u,1481572662,694350475};

246 c⁄° 
lmodes
[3]={0,4,8};

247 
mode
=
	`Á°_ønd
()%4;

249 
∑ckë
[0]=
cmodes
[
mode
]<<3;

250 
dec_föÆ_acc
=0;

251 
t
=
	`Á°_ønd
()%10;

253 
i
=0;i<65536;i++)

255 
Á˘‹
=48000/
fsv
[
t
>>1];

256 
∑ckë
[1]=
i
>>8;

257 
∑ckë
[2]=
i
&255;

258 
∑ckë
[3]=255;

259 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 4, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

260 if(
out_ßm∂es
!=120/
Á˘‹
)
	`ã°_Áûed
();

261 
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge1
));

262 
dec_föÆ_acc
+=
dec_föÆ_ønge1
;

264 if(
dec_föÆ_acc
!=
¸es
[
mode
])
	`ã°_Áûed
();

265 
	`Ârötf
(
°dout
," dec[%3d]áŒ 3-byãÖªfix f‹Üígth 4, modê%2d OK.\n",
t
,
cmodes
[
mode
]);

267 
mode
=
	`Á°_ønd
()%3;

268 
∑ckë
[0]=
lmodes
[
mode
]<<3;

269 
dec_föÆ_acc
=0;

270 
t
=
	`Á°_ønd
()%10;

271 
i
=0;i<65536;i++)

273 
Á˘‹
=48000/
fsv
[
t
>>1];

274 
∑ckë
[1]=
i
>>8;

275 
∑ckë
[2]=
i
&255;

276 
∑ckë
[3]=255;

277 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 4, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

278 if(
out_ßm∂es
!=480/
Á˘‹
)
	`ã°_Áûed
();

279 
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge1
));

280 
dec_föÆ_acc
+=
dec_föÆ_ønge1
;

282 if(
dec_föÆ_acc
!=
Ães
[
mode
])
	`ã°_Áûed
();

283 
	`Ârötf
(
°dout
," dec[%3d]áŒ 3-byãÖªfix f‹Üígth 4, modê%2d OK.\n",
t
,
lmodes
[
mode
]);

286 
skù
=
	`Á°_ønd
()%7;

287 
i
=0;i<64;i++)

289 
j
,
ex≥˘ed
[5*2];

290 
∑ckë
[0]=
i
<<2;

291 
t
=0;t<5*2;t++)
ex≥˘ed
[t]=
	`›us_decodî_gë_nb_ßm∂es
(
dec
[t],
∑ckë
,1);

292 
j
=2+
skù
;j<1275;j+=4)

294 
jj
;

295 
jj
=0;jj<
j
;jj++)
∑ckë
[jj+1]=
	`Á°_ønd
()&255;

296 
t
=0;t<5*2;t++)

298 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 
j
+1, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

299 if(
out_ßm∂es
!=
ex≥˘ed
[
t
])
	`ã°_Áûed
();

300 
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge1
));

301 if(
t
==0)
dec_föÆ_ønge2
=
dec_föÆ_ønge1
;

302 if(
dec_föÆ_ønge1
!=
dec_föÆ_ønge2
)
	`ã°_Áûed
();

306 
	`Ârötf
(
°dout
," dec[Æl]Ñ™domÖackës,áŒ mode†(64),Évîy 8th sizê‰om from %d byã†tÿmaximum OK.\n",2+
skù
);

308 
	`debruijn2
(64,
modes
);

309 
∂í
=(
	`Á°_ønd
()%18+3)*8+
skù
+3;

310 
i
=0;i<4096;i++)

312 
j
,
ex≥˘ed
[5*2];

313 
∑ckë
[0]=
modes
[
i
]<<2;

314 
t
=0;t<5*2;t++)
ex≥˘ed
[t]=
	`›us_decodî_gë_nb_ßm∂es
(
dec
[t],
∑ckë
,
∂í
);

315 
j
=0;j<
∂í
;j++)
∑ckë
[j+1]=(
	`Á°_ønd
()|fast_rand())&255;

316 
	`mem˝y
(
decbak
,
dec
[0],
decsize
);

317 if(
	`›us_decode
(
decbak
, 
∑ckë
, 
∂í
+1, 
outbuf
, 
ex≥˘ed
[0], 1)!Ûx≥˘ed[0])
	`ã°_Áûed
();

318 
	`mem˝y
(
decbak
,
dec
[0],
decsize
);

319 if(
	`›us_decode
(
decbak
, 0, 0, 
outbuf
, 
MAX_FRAME_SAMP
, 1)<20)
	`ã°_Áûed
();

320 
	`mem˝y
(
decbak
,
dec
[0],
decsize
);

321 if(
	`›us_decode
(
decbak
, 0, 0, 
outbuf
, 
MAX_FRAME_SAMP
, 0)<20)
	`ã°_Áûed
();

322 
t
=0;t<5*2;t++)

324 
›us_öt32
 
dur
;

325 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 
∂í
+1, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

326 if(
out_ßm∂es
!=
ex≥˘ed
[
t
])
	`ã°_Áûed
();

327 if(
t
==0)
dec_föÆ_ønge2
=
dec_föÆ_ønge1
;

328 if(
dec_föÆ_ønge1
!=
dec_föÆ_ønge2
)
	`ã°_Áûed
();

329 if(
	`›us_decodî_˘l
(
dec
[
t
], 
	`OPUS_GET_LAST_PACKET_DURATION
(&
dur
))!=
OPUS_OK
)
	`ã°_Áûed
();

330 if(
dur
!=
out_ßm∂es
)
	`ã°_Áûed
();

333 
	`Ârötf
(
°dout
," dec[Æl]Ñ™domÖackës,áŒ modê∑ú†(4096), %d byãs/‰amêOK.\n",
∂í
+1);

335 
∂í
=(
	`Á°_ønd
()%18+3)*8+
skù
+3;

336 
t
=
	`ønd
()&3;

337 
i
=0;i<4096;i++)

339 
cou¡
,
j
,
ex≥˘ed
;

340 
∑ckë
[0]=
modes
[
i
]<<2;

341 
ex≥˘ed
=
	`›us_decodî_gë_nb_ßm∂es
(
dec
[
t
],
∑ckë
,
∂í
);

342 
cou¡
=0;count<10;count++)

344 
j
=0;j<
∂í
;j++)
∑ckë
[j+1]=(
	`Á°_ønd
()|fast_rand())&255;

345 
out_ßm∂es
 = 
	`›us_decode
(
dec
[
t
], 
∑ckë
, 
∂í
+1, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

346 if(
out_ßm∂es
!=
ex≥˘ed
)
	`ã°_Áûed
();

349 
	`Ârötf
(
°dout
," dec[%3d]Ñ™domÖackës,áŒ modê∑ú†(4096)*10, %d byãs/‰amêOK.\n",
t
,
∂í
+1);

352 
tmodes
[1]={25<<2};

353 
›us_uöt32
 
t£eds
[1]={140441};

354 
éí
[1]={157};

355 
›us_öt32
 
åë
[1]={480};

356 
t
=
	`Á°_ønd
()&1;

357 
i
=0;i<1;i++)

359 
j
;

360 
∑ckë
[0]=
tmodes
[
i
];

361 
Rw
=
Rz
=
t£eds
[
i
];

362 
j
=1;j<
éí
[
i
];j++)
∑ckë
[j]=
	`Á°_ønd
()&255;

363 
out_ßm∂es
=
	`›us_decode
(
dec
[
t
], 
∑ckë
, 
éí
[
i
], 
outbuf
, 
MAX_FRAME_SAMP
, 0);

364 if(
out_ßm∂es
!=
åë
[
i
])
	`ã°_Áûed
();

366 
	`Ârötf
(
°dout
," dec[%3d]Öª-£À˘edÑ™domÖackë†OK.\n",
t
);

369 
	`‰ì
(
decbak
);

370 
t
=0;t<5*2;t++)
	`›us_decodî_de°roy
(
dec
[t]);

371 
	`¥ötf
(" Decoders stopped.\n");

373 
îr
=0;

374 
i
=0;i<8*2;i++)
îr
|=
outbuf_öt
[i]!=32749;

375 
i
=
MAX_FRAME_SAMP
*2;i<(MAX_FRAME_SAMP+8)*2;i++)
îr
|=
outbuf
[i]!=32749;

376 if(
îr
)
	`ã°_Áûed
();

378 
	`‰ì
(
outbuf_öt
);

379 
	`‰ì
(
∑ckë
);

381 
	}
}

383 #i‚de‡
DISABLE_FLOAT_API


384 
	$ã°_so·_˛ù
()

386 
i
,
j
;

387 
x
[1024];

388 
s
[8] = {0, 0, 0, 0, 0, 0, 0, 0};

389 
	`Ârötf
(
°dout
," Testing opus_pcm_soft_clip... ");

390 
i
=0;i<1024;i++)

392 
j
=0;j<1024;j++)

394 
x
[
j
]=(j&255)*(1/32.f)-4.f;

396 
	`›us_pcm_so·_˛ù
(&
x
[
i
],1024-i,1,
s
);

397 
j
=
i
;j<1024;j++)

399 if(
x
[
j
]>1.f)
	`ã°_Áûed
();

400 if(
x
[
j
]<-1.f)
	`ã°_Áûed
();

403 
i
=1;i<9;i++)

405 
j
=0;j<1024;j++)

407 
x
[
j
]=(j&255)*(1/32.f)-4.f;

409 
	`›us_pcm_so·_˛ù
(
x
,1024/
i
,i,
s
);

410 
j
=0;j<(1024/
i
)*i;j++)

412 if(
x
[
j
]>1.f)
	`ã°_Áûed
();

413 if(
x
[
j
]<-1.f)
	`ã°_Áûed
();

416 
	`›us_pcm_so·_˛ù
(
x
,0,1,
s
);

417 
	`›us_pcm_so·_˛ù
(
x
,1,0,
s
);

418 
	`›us_pcm_so·_˛ù
(
x
,1,1,0);

419 
	`›us_pcm_so·_˛ù
(
x
,1,-1,
s
);

420 
	`›us_pcm_so·_˛ù
(
x
,-1,1,
s
);

421 
	`›us_pcm_so·_˛ù
(0,1,1,
s
);

422 
	`¥ötf
("OK.\n");

423 
	}
}

426 
	$maö
(
_¨gc
, **
_¨gv
)

428 c⁄° * 
ovîsi⁄
;

429 c⁄° * 
ív_£ed
;

430 
ív_u£d
;

432 if(
_¨gc
>2)

434 
	`Ârötf
(
°dîr
,"Ußge: %†[<£ed>]\n",
_¨gv
[0]);

438 
ív_u£d
=0;

439 
ív_£ed
=
	`gëív
("SEED");

440 if(
_¨gc
>1)
i£ed
=
	`©oi
(
_¨gv
[1]);

441 if(
ív_£ed
)

443 
i£ed
=
	`©oi
(
ív_£ed
);

444 
ív_u£d
=1;

446 
i£ed
=(
›us_uöt32
)
	`time
(
NULL
)^(((›us_uöt32)
	`gëpid
()&65535)<<16);

447 
Rw
=
Rz
=
i£ed
;

449 
ovîsi⁄
=
	`›us_gë_vîsi⁄_°rög
();

450 if(!
ovîsi⁄
)
	`ã°_Áûed
();

451 
	`Ârötf
(
°dîr
,"Te°ög %†decodî. R™dom sìd: %u (%.4X)\n", 
ovîsi⁄
, 
i£ed
, 
	`Á°_ønd
() % 65535);

452 if(
ív_u£d
)
	`Ârötf
(
°dîr
," R™dom sìd së fromÅhêívú⁄míà(SEED=%s).\n", 
ív_£ed
);

457 
	`ã°_decodî_code0
(
	`gëív
("TEST_OPUS_NOFUZZ")!=
NULL
);

458 #i‚de‡
DISABLE_FLOAT_API


459 
	`ã°_so·_˛ù
();

463 
	}
}

	@tests/test_opus_encode.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<limôs.h
>

35 
	~<°döt.h
>

36 
	~<m©h.h
>

37 
	~<°rög.h
>

38 
	~<time.h
>

39 #i‡(!
deföed
 
WIN32
 && !deföed 
_WIN32
Ë|| deföed(
__MINGW32__
)

40 
	~<uni°d.h
>

42 
	~<¥o˚ss.h
>

43 
	#gëpid
 
_gëpid


	)

45 
	~"›us_mu…i°ªam.h
"

46 
	~"›us.h
"

47 
	~"../§c/›us_¥iv©e.h
"

48 
	~"ã°_›us_comm⁄.h
"

50 
	#MAX_PACKET
 (1500)

	)

51 
	#SAMPLES
 (48000*30)

	)

52 
	#SSAMPLES
 (
SAMPLES
/3)

	)

53 
	#MAX_FRAME_SAMP
 (5760)

	)

54 
	#PI
 (3.141592653589793238462643f)

	)

55 
	#RAND_SAMPLE
(
a
Ë◊[
	`Á°_ønd
(Ë% ◊)/◊[0])])

	)

57 
	$gíî©e_music
(*
buf
, 
›us_öt32
 
Àn
)

59 
›us_öt32
 
a1
,
b1
,
a2
,
b2
;

60 
›us_öt32
 
c1
,
c2
,
d1
,
d2
;

61 
›us_öt32
 
i
,
j
;

62 
a1
=
b1
=
a2
=
b2
=0;

63 
c1
=
c2
=
d1
=
d2
=0;

64 
j
=0;

66 
i
=0;i<2880;i++)
buf
[i*2]=buf[i*2+1]=0;

67 
i
=2880;i<
Àn
;i++)

69 
›us_uöt32
 
r
;

70 
›us_öt32
 
v1
,
v2
;

71 
v1
=
v2
=(((
j
*((j>>12)^((j>>10|j>>12)&26&j>>7)))&128)+128)<<15;

72 
r
=
	`Á°_ønd
();
v1
+=r&65535;v1-=r>>16;

73 
r
=
	`Á°_ønd
();
v2
+=r&65535;v2-=r>>16;

74 
b1
=
v1
-
a1
+((b1*61+32)>>6);a1=v1;

75 
b2
=
v2
-
a2
+((b2*61+32)>>6);a2=v2;

76 
c1
=(30*(c1+
b1
+
d1
)+32)>>6;d1=b1;

77 
c2
=(30*(c2+
b2
+
d2
)+32)>>6;d2=b2;

78 
v1
=(
c1
+128)>>8;

79 
v2
=(
c2
+128)>>8;

80 
buf
[
i
*2]=
v1
>32767?32767:(v1<-32768?-32768:v1);

81 
buf
[
i
*2+1]=
v2
>32767?32767:(v2<-32768?-32768:v2);

82 if(
i
%6==0)
j
++;

84 
	}
}

87 
	gßve_˘r
 = 0;

88 
	$öt_to_ch¨
(
›us_uöt32
 
i
, 
ch
[4])

90 
ch
[0] = 
i
>>24;

91 
ch
[1] = (
i
>>16)&0xFF;

92 
ch
[2] = (
i
>>8)&0xFF;

93 
ch
[3] = 
i
&0xFF;

94 
	}
}

96 
OPUS_INLINE
 
	$ßve_∑ckë
(* 
p
, 
Àn
, 
›us_uöt32
 
∫g
)

98 
FILE
 *
fout
;

99 
öt_fõld
[4];

100 
«me
[256];

101 
	`¢¥ötf
(
«me
,255,"ã°_›us_ícode.%Œu.%d.bô",()
i£ed
,
ßve_˘r
);

102 
	`Ârötf
(
°dout
,"wrôög %d byãÖackëÅÿ%s\n",
Àn
,
«me
);

103 
fout
=
	`f›í
(
«me
, "wb+");

104 if(
fout
==
NULL
)
	`ã°_Áûed
();

105 
	`öt_to_ch¨
(
Àn
, 
öt_fõld
);

106 
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
);

107 
	`öt_to_ch¨
(
∫g
, 
öt_fõld
);

108 
	`fwrôe
(
öt_fõld
, 1, 4, 
fout
);

109 
	`fwrôe
(
p
, 1, 
Àn
, 
fout
);

110 
	`f˛o£
(
fout
);

111 
ßve_˘r
++;

112 
	}
}

115 
	$gë_‰ame_size_íum
(
‰ame_size
, 
ßm∂ög_øã
)

117 
‰ame_size_íum
;

119 if(
‰ame_size
==
ßm∂ög_øã
/400)

120 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_2_5_MS
;

121 if(
‰ame_size
==
ßm∂ög_øã
/200)

122 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_5_MS
;

123 if(
‰ame_size
==
ßm∂ög_øã
/100)

124 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_10_MS
;

125 if(
‰ame_size
==
ßm∂ög_øã
/50)

126 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_20_MS
;

127 if(
‰ame_size
==
ßm∂ög_øã
/25)

128 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_40_MS
;

129 if(
‰ame_size
==3*
ßm∂ög_øã
/50)

130 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_60_MS
;

131 if(
‰ame_size
==4*
ßm∂ög_øã
/50)

132 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_80_MS
;

133 if(
‰ame_size
==5*
ßm∂ög_øã
/50)

134 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_100_MS
;

135 if(
‰ame_size
==6*
ßm∂ög_øã
/50)

136 
‰ame_size_íum
 = 
OPUS_FRAMESIZE_120_MS
;

138 
	`ã°_Áûed
();

140  
‰ame_size_íum
;

141 
	}
}

143 
	$ã°_ícode
(
OpusEncodî
 *
íc
, 
ch™√ls
, 
‰ame_size
, 
OpusDecodî
 *
dec
)

145 
ßmp_cou¡
 = 0;

146 
›us_öt16
 *
öbuf
;

147 
∑ckë
[
MAX_PACKET
+257];

148 
Àn
;

149 
›us_öt16
 *
outbuf
;

150 
out_ßm∂es
;

151 
ªt
 = 0;

154 
öbuf
 = (
›us_öt16
*)
	`mÆloc
((*öbuf)*
SSAMPLES
);

155 
	`gíî©e_music
(
öbuf
, 
SSAMPLES
/2);

158 
outbuf
 = (
›us_öt16
*)
	`mÆloc
((*outbuf)*
MAX_FRAME_SAMP
*3);

162 
Àn
 = 
	`›us_ícode
(
íc
, &
öbuf
[
ßmp_cou¡
*
ch™√ls
], 
‰ame_size
, 
∑ckë
, 
MAX_PACKET
);

163 if(
Àn
<0 ||Üí>
MAX_PACKET
) {

164 
	`Ârötf
(
°dîr
,"›us_ícode(Ëªtu∫ed %d\n",
Àn
);

165 
ªt
 = -1;

169 
out_ßm∂es
 = 
	`›us_decode
(
dec
, 
∑ckë
, 
Àn
, 
outbuf
, 
MAX_FRAME_SAMP
, 0);

170 if(
out_ßm∂es
!=
‰ame_size
) {

171 
	`Ârötf
(
°dîr
,"›us_decode(Ëªtu∫ed %d\n",
out_ßm∂es
);

172 
ªt
 = -1;

176 
ßmp_cou¡
 +
‰ame_size
;

177 } 
ßmp_cou¡
 < ((
SSAMPLES
/2)-
MAX_FRAME_SAMP
));

180 
	`‰ì
(
öbuf
);

181 
	`‰ì
(
outbuf
);

182  
ªt
;

183 
	}
}

185 
	$fuzz_ícodî_£âögs
(c⁄° 
num_ícodîs
, c⁄° 
num_£âög_ch™ges
)

187 
OpusEncodî
 *
íc
;

188 
OpusDecodî
 *
dec
;

189 
i
,
j
,
îr
;

192 
ßm∂ög_øãs
[5] = {8000, 12000, 16000, 24000, 48000};

193 
ch™√ls
[2] = {1, 2};

194 
≠∂iˇti⁄s
[3] = {
OPUS_APPLICATION_AUDIO
, 
OPUS_APPLICATION_VOIP
, 
OPUS_APPLICATION_RESTRICTED_LOWDELAY
};

195 
bôøãs
[11] = {6000, 12000, 16000, 24000, 32000, 48000, 64000, 96000, 510000, 
OPUS_AUTO
, 
OPUS_BITRATE_MAX
};

196 
f‹˚_ch™√ls
[4] = {
OPUS_AUTO
, OPUS_AUTO, 1, 2};

197 
u£_vbr
[3] = {0, 1, 1};

198 
vbr_c⁄°øöts
[3] = {0, 1, 1};

199 
com∂exôõs
[11] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

200 
max_b™dwidths
[6] = {
OPUS_BANDWIDTH_NARROWBAND
, 
OPUS_BANDWIDTH_MEDIUMBAND
,

201 
OPUS_BANDWIDTH_WIDEBAND
, 
OPUS_BANDWIDTH_SUPERWIDEBAND
,

202 
OPUS_BANDWIDTH_FULLBAND
, OPUS_BANDWIDTH_FULLBAND};

203 
sig«ls
[4] = {
OPUS_AUTO
, OPUS_AUTO, 
OPUS_SIGNAL_VOICE
, 
OPUS_SIGNAL_MUSIC
};

204 
öb™d_„cs
[3] = {0, 0, 1};

205 
∑ckë_loss_≥rc
[4] = {0, 1, 2, 5};

206 
lsb_dïths
[2] = {8, 24};

207 
¥edi˘i⁄_dißbÀd
[3] = {0, 0, 1};

208 
u£_dtx
[2] = {0, 1};

209 
‰ame_sizes_ms_x2
[9] = {5, 10, 20, 40, 80, 120, 160, 200, 240};

211 
i
=0; i<
num_ícodîs
; i++) {

212 
ßm∂ög_øã
 = 
	`RAND_SAMPLE
(
ßm∂ög_øãs
);

213 
num_ch™√ls
 = 
	`RAND_SAMPLE
(
ch™√ls
);

214 
≠∂iˇti⁄
 = 
	`RAND_SAMPLE
(
≠∂iˇti⁄s
);

216 
dec
 = 
	`›us_decodî_¸óã
(
ßm∂ög_øã
, 
num_ch™√ls
, &
îr
);

217 if(
îr
!=
OPUS_OK
 || 
dec
==
NULL
)
	`ã°_Áûed
();

219 
íc
 = 
	`›us_ícodî_¸óã
(
ßm∂ög_øã
, 
num_ch™√ls
, 
≠∂iˇti⁄
, &
îr
);

220 if(
îr
!=
OPUS_OK
 || 
íc
==
NULL
)
	`ã°_Áûed
();

222 
j
=0; j<
num_£âög_ch™ges
; j++) {

223 
bôøã
 = 
	`RAND_SAMPLE
(
bôøãs
);

224 
f‹˚_ch™√l
 = 
	`RAND_SAMPLE
(
f‹˚_ch™√ls
);

225 
vbr
 = 
	`RAND_SAMPLE
(
u£_vbr
);

226 
vbr_c⁄°øöt
 = 
	`RAND_SAMPLE
(
vbr_c⁄°øöts
);

227 
com∂exôy
 = 
	`RAND_SAMPLE
(
com∂exôõs
);

228 
max_bw
 = 
	`RAND_SAMPLE
(
max_b™dwidths
);

229 
sig
 = 
	`RAND_SAMPLE
(
sig«ls
);

230 
öb™d_„c
 = 
	`RAND_SAMPLE
(
öb™d_„cs
);

231 
pkt_loss
 = 
	`RAND_SAMPLE
(
∑ckë_loss_≥rc
);

232 
lsb_dïth
 = 
	`RAND_SAMPLE
(
lsb_dïths
);

233 
¥ed_dißbÀd
 = 
	`RAND_SAMPLE
(
¥edi˘i⁄_dißbÀd
);

234 
dtx
 = 
	`RAND_SAMPLE
(
u£_dtx
);

235 
‰ame_size_ms_x2
 = 
	`RAND_SAMPLE
(
‰ame_sizes_ms_x2
);

236 
‰ame_size
 = 
‰ame_size_ms_x2
*
ßm∂ög_øã
/2000;

237 
‰ame_size_íum
 = 
	`gë_‰ame_size_íum
(
‰ame_size
, 
ßm∂ög_øã
);

238 
f‹˚_ch™√l
 = 
	`IMIN
(f‹˚_ch™√l, 
num_ch™√ls
);

240 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
bôøã
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

241 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
f‹˚_ch™√l
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

242 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(
vbr
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

243 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
vbr_c⁄°øöt
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

244 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(
com∂exôy
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

245 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_MAX_BANDWIDTH
(
max_bw
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

246 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_SIGNAL
(
sig
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

247 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(
öb™d_„c
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

248 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
(
pkt_loss
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

249 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_LSB_DEPTH
(
lsb_dïth
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

250 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PREDICTION_DISABLED
(
¥ed_dißbÀd
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

251 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(
dtx
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

252 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_EXPERT_FRAME_DURATION
(
‰ame_size_íum
)Ë!
OPUS_OK
Ë
	`ã°_Áûed
();

254 if(
	`ã°_ícode
(
íc
, 
num_ch™√ls
, 
‰ame_size
, 
dec
)) {

255 
	`Ârötf
(
°dîr
,

260 
ßm∂ög_øã
/1000, 
num_ch™√ls
, 
≠∂iˇti⁄
, 
bôøã
,

261 
f‹˚_ch™√l
, 
vbr
, 
vbr_c⁄°øöt
, 
com∂exôy
, 
max_bw
, 
sig
, 
öb™d_„c
,

262 
pkt_loss
, 
lsb_dïth
, 
¥ed_dißbÀd
, 
dtx
, 
‰ame_size_ms_x2
);

263 
	`ã°_Áûed
();

267 
	`›us_ícodî_de°roy
(
íc
);

268 
	`›us_decodî_de°roy
(
dec
);

270 
	}
}

272 
	$run_ã°1
(
no_fuzz
)

274 c⁄° 
fsizes
[6]={960*3,960*2,120,240,480,960};

275 c⁄° *
m°rögs
[3] = {" LP","Hybrid"," MDCT"};

276 
m≠pög
[256] = {0,1,255};

277 
db62
[36];

278 
›us_öt32
 
i
,
j
;

279 
rc
,
îr
;

280 
OpusEncodî
 *
íc
;

281 
OpusMSEncodî
 *
MSíc
;

282 
OpusDecodî
 *
dec
;

283 
OpusMSDecodî
 *
MSdec
;

284 
OpusMSDecodî
 *
MSdec_îr
;

285 
OpusDecodî
 *
dec_îr
[10];

286 *
öbuf
;

287 *
outbuf
;

288 *
out2buf
;

289 
›us_öt32
 
bôøã_bps
;

290 
∑ckë
[
MAX_PACKET
+257];

291 
›us_uöt32
 
íc_föÆ_ønge
;

292 
›us_uöt32
 
dec_föÆ_ønge
;

293 
fswôch
;

294 
fsize
;

295 
cou¡
;

299 
	`Ârötf
(
°dout
," Encode+DecodeÅests.\n");

301 
íc
 = 
	`›us_ícodî_¸óã
(48000, 2, 
OPUS_APPLICATION_VOIP
, &
îr
);

302 if(
îr
 !
OPUS_OK
 || 
íc
==
NULL
)
	`ã°_Áûed
();

304 
i
=0;i<2;i++)

306 *
ªt_îr
;

307 
ªt_îr
 = 
i
?0:&
îr
;

308 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 2, 2, 0, 
m≠pög
, 
OPUS_UNIMPLEMENTED
, 
ªt_îr
);

309 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

311 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 0, 1, 0, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, 
ªt_îr
);

312 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

314 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(44100, 2, 2, 0, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, 
ªt_îr
);

315 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

317 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 2, 2, 3, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, 
ªt_îr
);

318 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

320 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 2, -1, 0, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, 
ªt_îr
);

321 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

323 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 256, 2, 0, 
m≠pög
, 
OPUS_APPLICATION_VOIP
, 
ªt_îr
);

324 if((
ªt_îr
 && *ªt_î∏!
OPUS_BAD_ARG
Ë|| 
MSíc
!=
NULL
)
	`ã°_Áûed
();

327 
MSíc
 = 
	`›us_mu…i°ªam_ícodî_¸óã
(8000, 2, 2, 0, 
m≠pög
, 
OPUS_APPLICATION_AUDIO
, &
îr
);

328 if(
îr
 !
OPUS_OK
 || 
MSíc
==
NULL
)
	`ã°_Áûed
();

331 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_GET_BITRATE
(&
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

332 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_GET_LSB_DEPTH
(&
i
))!=
OPUS_OK
)
	`ã°_Áûed
();

333 if(
i
<16)
	`ã°_Áûed
();

336 
OpusEncodî
 *
tmp_íc
;

337 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_MULTISTREAM_GET_ENCODER_STATE
(1,&
tmp_íc
))!=
OPUS_OK
)
	`ã°_Áûed
();

338 if(
	`›us_ícodî_˘l
(
tmp_íc
, 
	`OPUS_GET_LSB_DEPTH
(&
j
))!=
OPUS_OK
)
	`ã°_Áûed
();

339 if(
i
!=
j
)
	`ã°_Áûed
();

340 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_MULTISTREAM_GET_ENCODER_STATE
(2,&
tmp_íc
))!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

343 
dec
 = 
	`›us_decodî_¸óã
(48000, 2, &
îr
);

344 if(
îr
 !
OPUS_OK
 || 
dec
==
NULL
)
	`ã°_Áûed
();

346 
MSdec
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 2, 2, 0, 
m≠pög
, &
îr
);

347 if(
îr
 !
OPUS_OK
 || 
MSdec
==
NULL
)
	`ã°_Áûed
();

349 
MSdec_îr
 = 
	`›us_mu…i°ªam_decodî_¸óã
(48000, 3, 2, 0, 
m≠pög
, &
îr
);

350 if(
îr
 !
OPUS_OK
 || 
MSdec_îr
==
NULL
)
	`ã°_Áûed
();

352 
dec_îr
[0]=(
OpusDecodî
 *)
	`mÆloc
(
	`›us_decodî_gë_size
(2));

353 
	`mem˝y
(
dec_îr
[0],
dec
,
	`›us_decodî_gë_size
(2));

354 
dec_îr
[1] = 
	`›us_decodî_¸óã
(48000, 1, &
îr
);

355 
dec_îr
[2] = 
	`›us_decodî_¸óã
(24000, 2, &
îr
);

356 
dec_îr
[3] = 
	`›us_decodî_¸óã
(24000, 1, &
îr
);

357 
dec_îr
[4] = 
	`›us_decodî_¸óã
(16000, 2, &
îr
);

358 
dec_îr
[5] = 
	`›us_decodî_¸óã
(16000, 1, &
îr
);

359 
dec_îr
[6] = 
	`›us_decodî_¸óã
(12000, 2, &
îr
);

360 
dec_îr
[7] = 
	`›us_decodî_¸óã
(12000, 1, &
îr
);

361 
dec_îr
[8] = 
	`›us_decodî_¸óã
(8000, 2, &
îr
);

362 
dec_îr
[9] = 
	`›us_decodî_¸óã
(8000, 1, &
îr
);

363 
i
=0;i<10;i++)if(
dec_îr
[i]==
NULL
)
	`ã°_Áûed
();

366 
OpusEncodî
 *
íc˝y
;

368 
íc˝y
=(
OpusEncodî
 *)
	`mÆloc
(
	`›us_ícodî_gë_size
(2));

369 
	`mem˝y
(
íc˝y
,
íc
,
	`›us_ícodî_gë_size
(2));

370 
	`mem£t
(
íc
,255,
	`›us_ícodî_gë_size
(2));

371 
	`›us_ícodî_de°roy
(
íc
);

372 
íc
=
íc˝y
;

375 
öbuf
=(*)
	`mÆloc
(()*
SAMPLES
*2);

376 
outbuf
=(*)
	`mÆloc
(()*
SAMPLES
*2);

377 
out2buf
=(*)
	`mÆloc
(()*
MAX_FRAME_SAMP
*3);

378 if(
öbuf
==
NULL
 || 
outbuf
==NULL || 
out2buf
==NULL)
	`ã°_Áûed
();

380 
	`gíî©e_music
(
öbuf
,
SAMPLES
);

387 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
OPUS_AUTO
))!=
OPUS_OK
)
	`ã°_Áûed
();

388 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_MODE
(-2))!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

389 if(
	`›us_ícode
(
íc
, 
öbuf
, 500, 
∑ckë
, 
MAX_PACKET
)!=
OPUS_BAD_ARG
)
	`ã°_Áûed
();

391 
rc
=0;rc<3;rc++)

393 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR
(
rc
<2))!=
OPUS_OK
)
	`ã°_Áûed
();

394 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
rc
==1))!=
OPUS_OK
)
	`ã°_Áûed
();

395 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
rc
==1))!=
OPUS_OK
)
	`ã°_Áûed
();

396 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(
rc
==0))!=
OPUS_OK
)
	`ã°_Áûed
();

397 
j
=0;j<13;j++)

399 
øã
;

400 
modes
[13]={0,0,0,1,1,1,1,2,2,2,2,2,2};

401 
øãs
[13]={6000,12000,48000,16000,32000,48000,64000,512000,13000,24000,48000,64000,96000};

402 
‰ame
[13]={960*2,960,480,960,960,960,480,960*3,960*3,960,480,240,120};

403 
øã
=
øãs
[
j
]+
	`Á°_ønd
()%rates[j];

404 
cou¡
=
i
=0;

406 
bw
,
Àn
,
out_ßm∂es
,
‰ame_size
;

407 
‰ame_size
=
‰ame
[
j
];

408 if((
	`Á°_ønd
()&255)==0)

410 if(
	`›us_ícodî_˘l
(
íc
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

411 if(
	`›us_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

412 if((
	`Á°_ønd
()&1)!=0)

414 if(
	`›us_decodî_˘l
(
dec_îr
[
	`Á°_ønd
()&1], 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

417 if((
	`Á°_ønd
()&127)==0)

419 if(
	`›us_decodî_˘l
(
dec_îr
[
	`Á°_ønd
()&1], 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

421 if(
	`Á°_ønd
()%10==0){

422 
com∂ex
=
	`Á°_ønd
()%11;

423 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
(
com∂ex
))!=
OPUS_OK
)
	`ã°_Áûed
();

425 if(
	`Á°_ønd
()%50==0)
	`›us_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
);

426 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(
rc
==0))!=
OPUS_OK
)
	`ã°_Áûed
();

427 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_MODE
(
MODE_SILK_ONLY
+
modes
[
j
]))!=
OPUS_OK
)
	`ã°_Áûed
();

428 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(
	`Á°_ønd
()&1))!=
OPUS_OK
)
	`ã°_Áûed
();

429 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
øã
))!=
OPUS_OK
)
	`ã°_Áûed
();

430 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
((
øãs
[
j
]>=64000?2:1)))!=
OPUS_OK
)
	`ã°_Áûed
();

431 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_COMPLEXITY
((
cou¡
>>2)%11))!=
OPUS_OK
)
	`ã°_Áûed
();

432 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_PACKET_LOSS_PERC
((
	`Á°_ønd
()&15)&(Á°_ønd()%15)))!=
OPUS_OK
)
	`ã°_Áûed
();

433 
bw
=
modes
[
j
]==0?
OPUS_BANDWIDTH_NARROWBAND
+(
	`Á°_ønd
()%3):

434 
modes
[
j
]==1?
OPUS_BANDWIDTH_SUPERWIDEBAND
+(
	`Á°_ønd
()&1):

435 
OPUS_BANDWIDTH_NARROWBAND
+(
	`Á°_ønd
()%5);

436 if(
modes
[
j
]==2&&
bw
==
OPUS_BANDWIDTH_MEDIUMBAND
)bw+=3;

437 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BANDWIDTH
(
bw
))!=
OPUS_OK
)
	`ã°_Áûed
();

438 
Àn
 = 
	`›us_ícode
(
íc
, &
öbuf
[
i
<<1], 
‰ame_size
, 
∑ckë
, 
MAX_PACKET
);

439 if(
Àn
<0 ||Üí>
MAX_PACKET
)
	`ã°_Áûed
();

440 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_GET_FINAL_RANGE
(&
íc_föÆ_ønge
))!=
OPUS_OK
)
	`ã°_Áûed
();

441 if((
	`Á°_ønd
()&3)==0)

443 if(
	`›us_∑ckë_∑d
(
∑ckë
,
Àn
,Àn+1)!=
OPUS_OK
)
	`ã°_Áûed
();

444 
Àn
++;

446 if((
	`Á°_ønd
()&7)==0)

448 if(
	`›us_∑ckë_∑d
(
∑ckë
,
Àn
,Àn+256)!=
OPUS_OK
)
	`ã°_Áûed
();

449 
Àn
+=256;

451 if((
	`Á°_ønd
()&3)==0)

453 
Àn
=
	`›us_∑ckë_u≈ad
(
∑ckë
,len);

454 if(
Àn
<1)
	`ã°_Áûed
();

456 
out_ßm∂es
 = 
	`›us_decode
(
dec
, 
∑ckë
, 
Àn
, &
outbuf
[
i
<<1], 
MAX_FRAME_SAMP
, 0);

457 if(
out_ßm∂es
!=
‰ame_size
)
	`ã°_Áûed
();

458 if(
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
))!=
OPUS_OK
)
	`ã°_Áûed
();

459 if(
íc_föÆ_ønge
!=
dec_föÆ_ønge
)
	`ã°_Áûed
();

461 
out_ßm∂es
 = 
	`›us_decode
(
dec_îr
[0], 
∑ckë
, 
Àn
, 
out2buf
, 
‰ame_size
, (
	`Á°_ønd
()&3)!=0);

462 if(
out_ßm∂es
!=
‰ame_size
)
	`ã°_Áûed
();

463 
out_ßm∂es
 = 
	`›us_decode
(
dec_îr
[1], 
∑ckë
, (
	`Á°_ønd
()&3)==0?0:
Àn
, 
out2buf
, 
MAX_FRAME_SAMP
, (fast_rand()&7)!=0);

464 if(
out_ßm∂es
<120)
	`ã°_Áûed
();

465 
i
+=
‰ame_size
;

466 
cou¡
++;

467 }
i
<(
SSAMPLES
-
MAX_FRAME_SAMP
));

468 
	`Ârötf
(
°dout
," Modê%†FBÉncodê%s, %6d bp†OK.\n",
m°rögs
[
modes
[
j
]],
rc
==0?" VBR":rc==1?"CVBR":" CBR",
øã
);

472 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_MODE
(
OPUS_AUTO
))!=
OPUS_OK
)
	`ã°_Áûed
();

473 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_FORCE_CHANNELS
(
OPUS_AUTO
))!=
OPUS_OK
)
	`ã°_Áûed
();

474 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_INBAND_FEC
(0))!=
OPUS_OK
)
	`ã°_Áûed
();

475 if(
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_DTX
(0))!=
OPUS_OK
)
	`ã°_Áûed
();

477 
rc
=0;rc<3;rc++)

479 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_VBR
(
rc
<2))!=
OPUS_OK
)
	`ã°_Áûed
();

480 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
rc
==1))!=
OPUS_OK
)
	`ã°_Áûed
();

481 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_VBR_CONSTRAINT
(
rc
==1))!=
OPUS_OK
)
	`ã°_Áûed
();

482 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_INBAND_FEC
(
rc
==0))!=
OPUS_OK
)
	`ã°_Áûed
();

483 
j
=0;j<16;j++)

485 
øã
;

486 
modes
[16]={0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2};

487 
øãs
[16]={4000,12000,32000,8000,16000,32000,48000,88000,4000,12000,32000,8000,16000,32000,48000,88000};

488 
‰ame
[16]={160*1,160,80,160,160,80,40,20,160*1,160,80,160,160,80,40,20};

489 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_INBAND_FEC
(
rc
==0&&
j
==1))!=
OPUS_OK
)
	`ã°_Áûed
();

490 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_FORCE_MODE
(
MODE_SILK_ONLY
+
modes
[
j
]))!=
OPUS_OK
)
	`ã°_Áûed
();

491 
øã
=
øãs
[
j
]+
	`Á°_ønd
()%rates[j];

492 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_DTX
(
	`Á°_ønd
()&1))!=
OPUS_OK
)
	`ã°_Áûed
();

493 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_BITRATE
(
øã
))!=
OPUS_OK
)
	`ã°_Áûed
();

494 
cou¡
=
i
=0;

496 
Àn
,
out_ßm∂es
,
‰ame_size
,
loss
;

497 
›us_öt32
 
¥ed
;

498 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_GET_PREDICTION_DISABLED
(&
¥ed
))!=
OPUS_OK
)
	`ã°_Áûed
();

499 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_PREDICTION_DISABLED
(()(
	`Á°_ønd
()&15)<(
¥ed
?11:4)))!=
OPUS_OK
)
	`ã°_Áûed
();

500 
‰ame_size
=
‰ame
[
j
];

501 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_COMPLEXITY
((
cou¡
>>2)%11))!=
OPUS_OK
)
	`ã°_Áûed
();

502 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_SET_PACKET_LOSS_PERC
((
	`Á°_ønd
()&15)&(Á°_ønd()%15)))!=
OPUS_OK
)
	`ã°_Áûed
();

503 if((
	`Á°_ønd
()&255)==0)

505 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

506 if(
	`›us_mu…i°ªam_decodî_˘l
(
MSdec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

507 if((
	`Á°_ønd
()&3)!=0)

509 if(
	`›us_mu…i°ªam_decodî_˘l
(
MSdec_îr
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

512 if((
	`Á°_ønd
()&255)==0)

514 if(
	`›us_mu…i°ªam_decodî_˘l
(
MSdec_îr
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

516 
Àn
 = 
	`›us_mu…i°ªam_ícode
(
MSíc
, &
öbuf
[
i
<<1], 
‰ame_size
, 
∑ckë
, 
MAX_PACKET
);

517 if(
Àn
<0 ||Üí>
MAX_PACKET
)
	`ã°_Áûed
();

518 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
	`OPUS_GET_FINAL_RANGE
(&
íc_föÆ_ønge
))!=
OPUS_OK
)
	`ã°_Áûed
();

519 if((
	`Á°_ønd
()&3)==0)

521 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
∑ckë
,
Àn
,Àn+1,2)!=
OPUS_OK
)
	`ã°_Áûed
();

522 
Àn
++;

524 if((
	`Á°_ønd
()&7)==0)

526 if(
	`›us_mu…i°ªam_∑ckë_∑d
(
∑ckë
,
Àn
,Àn+256,2)!=
OPUS_OK
)
	`ã°_Áûed
();

527 
Àn
+=256;

529 if((
	`Á°_ønd
()&3)==0)

531 
Àn
=
	`›us_mu…i°ªam_∑ckë_u≈ad
(
∑ckë
,len,2);

532 if(
Àn
<1)
	`ã°_Áûed
();

534 
out_ßm∂es
 = 
	`›us_mu…i°ªam_decode
(
MSdec
, 
∑ckë
, 
Àn
, 
out2buf
, 
MAX_FRAME_SAMP
, 0);

535 if(
out_ßm∂es
!=
‰ame_size
*6)
	`ã°_Áûed
();

536 if(
	`›us_mu…i°ªam_decodî_˘l
(
MSdec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
))!=
OPUS_OK
)
	`ã°_Áûed
();

537 if(
íc_föÆ_ønge
!=
dec_föÆ_ønge
)
	`ã°_Áûed
();

539 
loss
=(
	`Á°_ønd
()&63)==0;

540 
out_ßm∂es
 = 
	`›us_mu…i°ªam_decode
(
MSdec_îr
, 
∑ckë
, 
loss
?0:
Àn
, 
out2buf
, 
‰ame_size
*6, (
	`Á°_ønd
()&3)!=0);

541 if(
out_ßm∂es
!=(
‰ame_size
*6))
	`ã°_Áûed
();

542 
i
+=
‰ame_size
;

543 
cou¡
++;

544 }
i
<(
SSAMPLES
/12-
MAX_FRAME_SAMP
));

545 
	`Ârötf
(
°dout
," Modê%†NB duÆ-m⁄ÿMSÉncodê%s, %6d bp†OK.\n",
m°rögs
[
modes
[
j
]],
rc
==0?" VBR":rc==1?"CVBR":" CBR",
øã
);

549 
bôøã_bps
=512000;

550 
fsize
=
	`Á°_ønd
()%31;

551 
fswôch
=100;

553 
	`debruijn2
(6,
db62
);

554 
cou¡
=
i
=0;

556 
toc
;

557 c⁄° *
‰ames
[48];

558 
size
[48];

559 
∑ylﬂd_off£t
;

560 
›us_uöt32
 
dec_föÆ_ønge2
;

561 
jj
,
dec2
;

562 
Àn
,
out_ßm∂es
;

563 
‰ame_size
=
fsizes
[
db62
[
fsize
]];

564 
›us_öt32
 
off£t
=
i
%(
SAMPLES
-
MAX_FRAME_SAMP
);

566 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_SET_BITRATE
(
bôøã_bps
));

568 
Àn
 = 
	`›us_ícode
(
íc
, &
öbuf
[
off£t
<<1], 
‰ame_size
, 
∑ckë
, 
MAX_PACKET
);

569 if(
Àn
<0 ||Üí>
MAX_PACKET
)
	`ã°_Áûed
();

570 
cou¡
++;

572 
	`›us_ícodî_˘l
(
íc
, 
	`OPUS_GET_FINAL_RANGE
(&
íc_föÆ_ønge
));

574 
out_ßm∂es
 = 
	`›us_decode
(
dec
, 
∑ckë
, 
Àn
, &
outbuf
[
off£t
<<1], 
MAX_FRAME_SAMP
, 0);

575 if(
out_ßm∂es
!=
‰ame_size
)
	`ã°_Áûed
();

577 
	`›us_decodî_˘l
(
dec
, 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
));

580 if(
dec_föÆ_ønge
!=
íc_föÆ_ønge
)
	`ã°_Áûed
();

585 if(
	`›us_∑ckë_∑r£
(
∑ckë
,
Àn
,&
toc
,
‰ames
,
size
,&
∑ylﬂd_off£t
)<=0)
	`ã°_Áûed
();

586 if((
	`Á°_ønd
()&1023)==0)
Àn
=0;

587 
j
=(
›us_öt32
)(
‰ames
[0]-
∑ckë
);j<
Àn
;j++)
jj
=0;jj<8;jj++Ìackë[j]^=((!
no_fuzz
)&&((
	`Á°_ønd
()&1023)==0))<<jj;

588 
out_ßm∂es
 = 
	`›us_decode
(
dec_îr
[0], 
Àn
>0?
∑ckë
:
NULL
,Üí, 
out2buf
, 
MAX_FRAME_SAMP
, 0);

589 if(
out_ßm∂es
<0||out_ßm∂es>
MAX_FRAME_SAMP
)
	`ã°_Áûed
();

590 if((
Àn
>0&&
out_ßm∂es
!=
‰ame_size
))
	`ã°_Áûed
();

592 
	`›us_decodî_˘l
(
dec_îr
[0], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge
));

595 
dec2
=
	`Á°_ønd
()%9+1;

596 
out_ßm∂es
 = 
	`›us_decode
(
dec_îr
[
dec2
], 
Àn
>0?
∑ckë
:
NULL
,Üí, 
out2buf
, 
MAX_FRAME_SAMP
, 0);

597 if(
out_ßm∂es
<0||out_ßm∂es>
MAX_FRAME_SAMP
)
	`ã°_Áûed
();

599 
	`›us_decodî_˘l
(
dec_îr
[
dec2
], 
	`OPUS_GET_FINAL_RANGE
(&
dec_föÆ_ønge2
));

600 if(
Àn
>0&&
dec_föÆ_ønge
!=
dec_föÆ_ønge2
)
	`ã°_Áûed
();

602 
fswôch
--;

603 if(
fswôch
<1)

605 
√w_size
;

606 
fsize
=(fsize+1)%36;

607 
√w_size
=
fsizes
[
db62
[
fsize
]];

608 if(
√w_size
==960||√w_size==480)
fswôch
=2880/√w_size*(
	`Á°_ønd
()%19+1);

609 
fswôch
=(
	`Á°_ønd
()%(2880/
√w_size
))+1;

611 
bôøã_bps
=((
	`Á°_ønd
()%508000+4000)+bitrate_bps)>>1;

612 
i
+=
‰ame_size
;

613 }
i
<
SAMPLES
*4);

614 
	`Ârötf
(
°dout
," AŒ fømesizê∑ú†swôchögÉncode, %d føme†OK.\n",
cou¡
);

616 if(
	`›us_ícodî_˘l
(
íc
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

617 
	`›us_ícodî_de°roy
(
íc
);

618 if(
	`›us_mu…i°ªam_ícodî_˘l
(
MSíc
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

619 
	`›us_mu…i°ªam_ícodî_de°roy
(
MSíc
);

620 if(
	`›us_decodî_˘l
(
dec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

621 
	`›us_decodî_de°roy
(
dec
);

622 if(
	`›us_mu…i°ªam_decodî_˘l
(
MSdec
, 
OPUS_RESET_STATE
)!=
OPUS_OK
)
	`ã°_Áûed
();

623 
	`›us_mu…i°ªam_decodî_de°roy
(
MSdec
);

624 
	`›us_mu…i°ªam_decodî_de°roy
(
MSdec_îr
);

625 
i
=0;i<10;i++)
	`›us_decodî_de°roy
(
dec_îr
[i]);

626 
	`‰ì
(
öbuf
);

627 
	`‰ì
(
outbuf
);

628 
	`‰ì
(
out2buf
);

630 
	}
}

632 
	$¥öt_ußge
(* 
_¨gv
[])

634 
	`Ârötf
(
°dîr
,"Ußge: %†[<£ed>] [-fuzz <num_ícodîs> <num_£âögs_≥r_ícodî>]\n",
_¨gv
[0]);

635 
	}
}

637 
	$maö
(
_¨gc
, **
_¨gv
)

639 
¨gs
=1;

640 * 
°πﬁ_°r
=
NULL
;

641 c⁄° * 
ovîsi⁄
;

642 c⁄° * 
ív_£ed
;

643 
ív_u£d
;

644 
num_ícodîs_to_fuzz
=5;

645 
num_£âög_ch™ges
=40;

647 
ív_u£d
=0;

648 
ív_£ed
=
	`gëív
("SEED");

649 if(
_¨gc
>1)

650 
i£ed
=
	`°πﬁ
(
_¨gv
[1], &
°πﬁ_°r
, 10);

651 if(
°πﬁ_°r
!=
NULL
 && strtol_str[0]=='\0')

652 
¨gs
++;

653 if(
ív_£ed
) {

654 
i£ed
=
	`©oi
(
ív_£ed
);

655 
ív_u£d
=1;

657 
i£ed
=(
›us_uöt32
)
	`time
(
NULL
)^(((›us_uöt32)
	`gëpid
()&65535)<<16);

658 
Rw
=
Rz
=
i£ed
;

660 
¨gs
<
_¨gc
)

662 if(
	`°rcmp
(
_¨gv
[
¨gs
], "-fuzz")==0 && 
_¨gc
==(args+3)) {

663 
num_ícodîs_to_fuzz
=
	`°πﬁ
(
_¨gv
[
¨gs
+1], &
°πﬁ_°r
, 10);

664 if(
°πﬁ_°r
[0]!='\0' || 
num_ícodîs_to_fuzz
<=0) {

665 
	`¥öt_ußge
(
_¨gv
);

666  
EXIT_FAILURE
;

668 
num_£âög_ch™ges
=
	`°πﬁ
(
_¨gv
[
¨gs
+2], &
°πﬁ_°r
, 10);

669 if(
°πﬁ_°r
[0]!='\0' || 
num_£âög_ch™ges
<=0) {

670 
	`¥öt_ußge
(
_¨gv
);

671  
EXIT_FAILURE
;

673 
¨gs
+=3;

676 
	`¥öt_ußge
(
_¨gv
);

677  
EXIT_FAILURE
;

681 
ovîsi⁄
=
	`›us_gë_vîsi⁄_°rög
();

682 if(!
ovîsi⁄
)
	`ã°_Áûed
();

683 
	`Ârötf
(
°dîr
,"Te°ög %†ícodî. R™dom sìd: %u (%.4X)\n", 
ovîsi⁄
, 
i£ed
, 
	`Á°_ønd
() % 65535);

684 if(
ív_u£d
)
	`Ârötf
(
°dîr
," R™dom sìd së fromÅhêívú⁄míà(SEED=%s).\n", 
ív_£ed
);

686 
	`ªgªssi⁄_ã°
();

691 
	`run_ã°1
(
	`gëív
("TEST_OPUS_NOFUZZ")!=
NULL
);

694 if(
	`gëív
("TEST_OPUS_NOFUZZ")==
NULL
) {

695 
	`Ârötf
(
°dîr
,"Running fuzz_encoder_settings with %dÉncoder(s)ánd %d setting change(s)Éach.\n",

696 
num_ícodîs_to_fuzz
, 
num_£âög_ch™ges
);

697 
	`fuzz_ícodî_£âögs
(
num_ícodîs_to_fuzz
, 
num_£âög_ch™ges
);

700 
	`Ârötf
(
°dîr
,"Tests completed successfully.\n");

703 
	}
}

	@tests/test_opus_padding.c

32 
	~<°dio.h
>

33 
	~<°dlib.h
>

34 
	~<°rög.h
>

35 
	~"›us.h
"

36 
	~"ã°_›us_comm⁄.h
"

38 
	#PACKETSIZE
 16909318

	)

39 
	#CHANNELS
 2

	)

40 
	#FRAMESIZE
 5760

	)

42 
	$ã°_ovîÊow
()

44 
OpusDecodî
 *
decodî
;

45 
ªsu…
;

46 
îr‹
;

48 *
ö
 = 
	`mÆloc
(
PACKETSIZE
);

49 
›us_öt16
 *
out
 = 
	`mÆloc
(
FRAMESIZE
*
CHANNELS
*(*out));

51 
	`Ârötf
(
°dîr
, " Checking forÖadding overflow... ");

52 i‡(!
ö
 || !
out
) {

53 
	`Ârötf
(
°dîr
, "FAIL (out of memory)\n");

56 
ö
[0] = 0xff;

57 
ö
[1] = 0x41;

58 
	`mem£t
(
ö
 + 2, 0xff, 
PACKETSIZE
 - 3);

59 
ö
[
PACKETSIZE
-1] = 0x0b;

61 
decodî
 = 
	`›us_decodî_¸óã
(48000, 
CHANNELS
, &
îr‹
);

62 
ªsu…
 = 
	`›us_decode
(
decodî
, 
ö
, 
PACKETSIZE
, 
out
, 
FRAMESIZE
, 0);

63 
	`›us_decodî_de°roy
(
decodî
);

65 
	`‰ì
(
ö
);

66 
	`‰ì
(
out
);

68 i‡(
ªsu…
 !
OPUS_INVALID_PACKET
) {

69 
	`Ârötf
(
°dîr
, "FAIL!\n");

70 
	`ã°_Áûed
();

73 
	`Ârötf
(
°dîr
, "OK.\n");

76 
	}
}

78 
	$maö
()

80 c⁄° *
ovîsi⁄
;

81 
ã°s
 = 0;;

83 
i£ed
 = 0;

84 
ovîsi⁄
 = 
	`›us_gë_vîsi⁄_°rög
();

85 i‡(!
ovîsi⁄
Ë
	`ã°_Áûed
();

86 
	`Ârötf
(
°dîr
, "Te°ög %†∑ddög.\n", 
ovîsi⁄
);

88 
ã°s
 +
	`ã°_ovîÊow
();

90 
	`Ârötf
(
°dîr
, "AllÖaddingÅestsÖassed.\n");

93 
	}
}

	@tests/test_opus_projection.c

28 #ifde‡
HAVE_CONFIG_H


29 
	~"c⁄fig.h
"

32 
	~<as£π.h
>

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<°döt.h
>

36 
	~<°rög.h
>

37 
	~"Êﬂt_ˇ°.h
"

38 
	~"›us.h
"

39 
	~"ã°_›us_comm⁄.h
"

40 
	~"›us_¥oje˘i⁄.h
"

41 
	~"m©h›s.h
"

42 
	~"../§c/m≠pög_m©rix.h
"

43 
	~"m©h›s.h
"

45 
	#BUFFER_SIZE
 960

	)

46 
	#MAX_DATA_BYTES
 32768

	)

47 
	#MAX_FRAME_SAMPLES
 5760

	)

48 
	#ERROR_TOLERANCE
 1

	)

50 
	#SIMPLE_MATRIX_SIZE
 12

	)

51 
	#SIMPLE_MATRIX_FRAME_SIZE
 10

	)

52 
	#SIMPLE_MATRIX_INPUT_SIZE
 30

	)

53 
	#SIMPLE_MATRIX_OUTPUT_SIZE
 40

	)

55 
	$as£π_is_equÆ
(

56 c⁄° 
›us_vÆ16
 *
a
, c⁄° 
›us_öt16
 *
b
, 
size
, opus_öt16 
tﬁî™˚
)

58 
i
;

59 
i
 = 0; i < 
size
; i++)

61 #ifde‡
FIXED_POINT


62 
›us_öt16
 
vÆ
 = 
a
[
i
];

64 
›us_öt16
 
vÆ
 = 
	`FLOAT2INT16
(
a
[
i
]);

66 i‡(
	`abs
(
vÆ
 - 
b
[
i
]Ë> 
tﬁî™˚
)

70 
	}
}

72 
	$as£π_is_equÆ_sh‹t
(

73 c⁄° 
›us_öt16
 *
a
, c⁄° opus_öt16 *
b
, 
size
, opus_öt16 
tﬁî™˚
)

75 
i
;

76 
i
 = 0; i < 
size
; i++)

77 i‡(
	`abs
(
a
[
i
] - 
b
[i]Ë> 
tﬁî™˚
)

80 
	}
}

82 
	$ã°_sim∂e_m©rix
()

84 c⁄° 
M≠pögM©rix
 
sim∂e_m©rix_∑øms
 = {4, 3, 0};

85 c⁄° 
›us_öt16
 
sim∂e_m©rix_d©a
[
SIMPLE_MATRIX_SIZE
] = {0, 32767, 0, 0, 32767, 0, 0, 0, 0, 0, 0, 32767};

86 c⁄° 
›us_öt16
 
öput_öt16
[
SIMPLE_MATRIX_INPUT_SIZE
] = {

90 c⁄° 
›us_öt16
 
ex≥˘ed_ouçut_öt16
[
SIMPLE_MATRIX_OUTPUT_SIZE
] = {

96 
i
, 
ªt
;

97 
›us_öt32
 
sim∂e_m©rix_size
;

98 
›us_vÆ16
 *
öput_vÆ16
;

99 
›us_vÆ16
 *
ouçut_vÆ16
;

100 
›us_öt16
 *
ouçut_öt16
;

101 
M≠pögM©rix
 *
sim∂e_m©rix
;

104 
öput_vÆ16
 = (
›us_vÆ16
 *)
	`›us_Æloc
((›us_vÆ16Ë* 
SIMPLE_MATRIX_INPUT_SIZE
);

105 
ouçut_öt16
 = (
›us_öt16
 *)
	`›us_Æloc
((›us_öt16Ë* 
SIMPLE_MATRIX_OUTPUT_SIZE
);

106 
ouçut_vÆ16
 = (
›us_vÆ16
 *)
	`›us_Æloc
((›us_vÆ16Ë* 
SIMPLE_MATRIX_OUTPUT_SIZE
);

109 
sim∂e_m©rix_size
 = 
	`m≠pög_m©rix_gë_size
(
sim∂e_m©rix_∑øms
.
rows
,

110 
sim∂e_m©rix_∑øms
.
cﬁs
);

111 i‡(!
sim∂e_m©rix_size
)

112 
	`ã°_Áûed
();

114 
sim∂e_m©rix
 = (
M≠pögM©rix
 *)
	`›us_Æloc
(
sim∂e_m©rix_size
);

115 
	`m≠pög_m©rix_öô
(
sim∂e_m©rix
, 
sim∂e_m©rix_∑øms
.
rows
,

116 
sim∂e_m©rix_∑øms
.
cﬁs
, sim∂e_m©rix_∑øms.
gaö
, 
sim∂e_m©rix_d©a
,

117 (
sim∂e_m©rix_d©a
));

120 
i
 = 0; i < 
SIMPLE_MATRIX_INPUT_SIZE
; i++)

122 #ifde‡
FIXED_POINT


123 
öput_vÆ16
[
i
] = 
öput_öt16
[i];

125 
öput_vÆ16
[
i
] = (1/32768.f)*
öput_öt16
[i];

130 
i
 = 0; i < 
SIMPLE_MATRIX_OUTPUT_SIZE
; i++)

131 
ouçut_vÆ16
[
i
] = 0;

132 
i
 = 0; i < 
sim∂e_m©rix
->
rows
; i++)

134 
	`m≠pög_m©rix_mu…ùly_ch™√l_ö_sh‹t
(
sim∂e_m©rix
,

135 
öput_öt16
, 
sim∂e_m©rix
->
cﬁs
, &
ouçut_vÆ16
[
i
], i,

136 
sim∂e_m©rix
->
rows
, 
SIMPLE_MATRIX_FRAME_SIZE
);

138 
ªt
 = 
	`as£π_is_equÆ
(
ouçut_vÆ16
, 
ex≥˘ed_ouçut_öt16
, 
SIMPLE_MATRIX_OUTPUT_SIZE
, 
ERROR_TOLERANCE
);

139 i‡(
ªt
)

140 
	`ã°_Áûed
();

143 
i
 = 0; i < 
SIMPLE_MATRIX_OUTPUT_SIZE
; i++)

144 
ouçut_öt16
[
i
] = 0;

145 
i
 = 0; i < 
sim∂e_m©rix
->
cﬁs
; i++)

147 
	`m≠pög_m©rix_mu…ùly_ch™√l_out_sh‹t
(
sim∂e_m©rix
,

148 &
öput_vÆ16
[
i
], i, 
sim∂e_m©rix
->
cﬁs
, 
ouçut_öt16
,

149 
sim∂e_m©rix
->
rows
, 
SIMPLE_MATRIX_FRAME_SIZE
);

151 
ªt
 = 
	`as£π_is_equÆ_sh‹t
(
ouçut_öt16
, 
ex≥˘ed_ouçut_öt16
, 
SIMPLE_MATRIX_OUTPUT_SIZE
, 
ERROR_TOLERANCE
);

152 i‡(
ªt
)

153 
	`ã°_Áûed
();

155 #i‡!
	`deföed
(
DISABLE_FLOAT_API
Ë&& !deföed(
FIXED_POINT
)

157 
i
 = 0; i < 
SIMPLE_MATRIX_OUTPUT_SIZE
; i++)

158 
ouçut_vÆ16
[
i
] = 0;

159 
i
 = 0; i < 
sim∂e_m©rix
->
rows
; i++)

161 
	`m≠pög_m©rix_mu…ùly_ch™√l_ö_Êﬂt
(
sim∂e_m©rix
,

162 
öput_vÆ16
, 
sim∂e_m©rix
->
cﬁs
, &
ouçut_vÆ16
[
i
], i,

163 
sim∂e_m©rix
->
rows
, 
SIMPLE_MATRIX_FRAME_SIZE
);

165 
ªt
 = 
	`as£π_is_equÆ
(
ouçut_vÆ16
, 
ex≥˘ed_ouçut_öt16
, 
SIMPLE_MATRIX_OUTPUT_SIZE
, 
ERROR_TOLERANCE
);

166 i‡(
ªt
)

167 
	`ã°_Áûed
();

170 
i
 = 0; i < 
SIMPLE_MATRIX_OUTPUT_SIZE
; i++)

171 
ouçut_vÆ16
[
i
] = 0;

172 
i
 = 0; i < 
sim∂e_m©rix
->
cﬁs
; i++)

174 
	`m≠pög_m©rix_mu…ùly_ch™√l_out_Êﬂt
(
sim∂e_m©rix
,

175 &
öput_vÆ16
[
i
], i, 
sim∂e_m©rix
->
cﬁs
, 
ouçut_vÆ16
,

176 
sim∂e_m©rix
->
rows
, 
SIMPLE_MATRIX_FRAME_SIZE
);

178 
ªt
 = 
	`as£π_is_equÆ
(
ouçut_vÆ16
, 
ex≥˘ed_ouçut_öt16
, 
SIMPLE_MATRIX_OUTPUT_SIZE
, 
ERROR_TOLERANCE
);

179 i‡(
ªt
)

180 
	`ã°_Áûed
();

183 
	`›us_‰ì
(
öput_vÆ16
);

184 
	`›us_‰ì
(
ouçut_öt16
);

185 
	`›us_‰ì
(
ouçut_vÆ16
);

186 
	`›us_‰ì
(
sim∂e_m©rix
);

187 
	}
}

189 
	$ã°_¸óti⁄_¨gumíts
(c⁄° 
ch™√ls
, c⁄° 
m≠pög_Ámûy
)

191 
°ªams
;

192 
cou∂ed_°ªams
;

193 
íc_îr‹
;

194 
dec_îr‹
;

195 
ªt
;

196 
OpusProje˘i⁄Encodî
 *
°_íc
 = 
NULL
;

197 
OpusProje˘i⁄Decodî
 *
°_dec
 = 
NULL
;

199 c⁄° 
›us_öt32
 
Fs
 = 48000;

200 c⁄° 
≠∂iˇti⁄
 = 
OPUS_APPLICATION_AUDIO
;

202 
‹dî_∂us_⁄e
 = ()
	`Êo‹
(
	`sqπ
(()
ch™√ls
));

203 
n⁄dõgëic_ch™√ls
 = 
ch™√ls
 - 
‹dî_∂us_⁄e
 * order_plus_one;

205 
is_ch™√ls_vÆid
 = 0;

206 
is_¥oje˘i⁄_vÆid
 = 0;

208 
°_íc
 = 
	`›us_¥oje˘i⁄_ambis⁄ics_ícodî_¸óã
(
Fs
, 
ch™√ls
,

209 
m≠pög_Ámûy
, &
°ªams
, &
cou∂ed_°ªams
, 
≠∂iˇti⁄
, &
íc_îr‹
);

210 i‡(
°_íc
 !
NULL
)

212 
›us_öt32
 
m©rix_size
;

213 *
m©rix
;

215 
ªt
 = 
	`›us_¥oje˘i⁄_ícodî_˘l
(
°_íc
,

216 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE_REQUEST
, &
m©rix_size
);

217 i‡(
ªt
 !
OPUS_OK
 || !
m©rix_size
)

218 
	`ã°_Áûed
();

220 
m©rix
 = (*)
	`›us_Æloc
(
m©rix_size
);

221 
ªt
 = 
	`›us_¥oje˘i⁄_ícodî_˘l
(
°_íc
,

222 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_REQUEST
, 
m©rix
, 
m©rix_size
);

224 
	`›us_¥oje˘i⁄_ícodî_de°roy
(
°_íc
);

226 
°_dec
 = 
	`›us_¥oje˘i⁄_decodî_¸óã
(
Fs
, 
ch™√ls
, 
°ªams
,

227 
cou∂ed_°ªams
, 
m©rix
, 
m©rix_size
, &
dec_îr‹
);

228 i‡(
°_dec
 !
NULL
)

230 
	`›us_¥oje˘i⁄_decodî_de°roy
(
°_dec
);

232 
	`›us_‰ì
(
m©rix
);

235 
is_ch™√ls_vÆid
 = (
‹dî_∂us_⁄e
 >= 2 && order_plus_one <= 4) &&

236 (
n⁄dõgëic_ch™√ls
 == 0 ||Çondiegetic_channels == 2);

237 
is_¥oje˘i⁄_vÆid
 = (
íc_îr‹
 =
OPUS_OK
 && 
dec_îr‹
 == OPUS_OK);

238 i‡(
is_ch™√ls_vÆid
 ^ 
is_¥oje˘i⁄_vÆid
)

240 
	`Ârötf
(
°dîr
, "Ch™√ls: %d, Famûy: %d\n", 
ch™√ls
, 
m≠pög_Ámûy
);

241 
	`Ârötf
(
°dîr
, "Order+1: %d, Non-diegetic Channels: %d\n",

242 
‹dî_∂us_⁄e
, 
n⁄dõgëic_ch™√ls
);

243 
	`Ârötf
(
°dîr
, "Streams: %d, Coupled Streams: %d\n",

244 
°ªams
, 
cou∂ed_°ªams
);

245 
	`ã°_Áûed
();

247 
	}
}

249 
	$gíî©e_music
(*
buf
, 
›us_öt32
 
Àn
, opus_öt32 
ch™√ls
)

251 
›us_öt32
 
i
,
j
,
k
;

252 
›us_öt32
 *
a
,*
b
,*
c
,*
d
;

253 
a
 = (
›us_öt32
 *)
	`mÆloc
((›us_öt32Ë* 
ch™√ls
);

254 
b
 = (
›us_öt32
 *)
	`mÆloc
((›us_öt32Ë* 
ch™√ls
);

255 
c
 = (
›us_öt32
 *)
	`mÆloc
((›us_öt32Ë* 
ch™√ls
);

256 
d
 = (
›us_öt32
 *)
	`mÆloc
((›us_öt32Ë* 
ch™√ls
);

257 
	`mem£t
(
a
, 0, (
›us_öt32
Ë* 
ch™√ls
);

258 
	`mem£t
(
b
, 0, (
›us_öt32
Ë* 
ch™√ls
);

259 
	`mem£t
(
c
, 0, (
›us_öt32
Ë* 
ch™√ls
);

260 
	`mem£t
(
d
, 0, (
›us_öt32
Ë* 
ch™√ls
);

261 
j
=0;

263 
i
=0;i<
Àn
;i++)

265 
k
=0;k<
ch™√ls
;k++)

267 
›us_uöt32
 
r
;

268 
›us_öt32
 
v
;

269 
v
=(((
j
*((j>>12)^((j>>10|j>>12)&26&j>>7)))&128)+128)<<15;

270 
r
=
	`Á°_ønd
();
v
+=r&65535;v-=r>>16;

271 
b
[
k
]=
v
-
a
[k]+((b[k]*61+32)>>6);a[k]=v;

272 
c
[
k
]=(30*(c[k]+
b
[k]+
d
[k])+32)>>6;d[k]=b[k];

273 
v
=(
c
[
k
]+128)>>8;

274 
buf
[
i
*
ch™√ls
+
k
]=
v
>32767?32767:(v<-32768?-32768:v);

275 if(
i
%6==0)
j
++;

279 
	`‰ì
(
a
);

280 
	`‰ì
(
b
);

281 
	`‰ì
(
c
);

282 
	`‰ì
(
d
);

283 
	}
}

285 
	$ã°_ícode_decode
(
›us_öt32
 
bôøã
, opus_öt32 
ch™√ls
,

286 c⁄° 
m≠pög_Ámûy
)

288 c⁄° 
›us_öt32
 
Fs
 = 48000;

289 c⁄° 
≠∂iˇti⁄
 = 
OPUS_APPLICATION_AUDIO
;

291 
OpusProje˘i⁄Encodî
 *
°_íc
;

292 
OpusProje˘i⁄Decodî
 *
°_dec
;

293 
°ªams
;

294 
cou∂ed
;

295 
îr‹
;

296 *
buf„r_ö
;

297 *
buf„r_out
;

298 
d©a
[
MAX_DATA_BYTES
] = { 0 };

299 
Àn
;

300 
out_ßm∂es
;

301 
›us_öt32
 
m©rix_size
 = 0;

302 *
m©rix
 = 
NULL
;

304 
buf„r_ö
 = (*)
	`mÆloc
((Ë* 
BUFFER_SIZE
 * 
ch™√ls
);

305 
buf„r_out
 = (*)
	`mÆloc
((Ë* 
BUFFER_SIZE
 * 
ch™√ls
);

307 
°_íc
 = 
	`›us_¥oje˘i⁄_ambis⁄ics_ícodî_¸óã
(
Fs
, 
ch™√ls
,

308 
m≠pög_Ámûy
, &
°ªams
, &
cou∂ed
, 
≠∂iˇti⁄
, &
îr‹
);

309 i‡(
îr‹
 !
OPUS_OK
) {

310 
	`Ârötf
(
°dîr
,

312 
ch™√ls
, 
m≠pög_Ámûy
);

313 
	`‰ì
(
buf„r_ö
);

314 
	`‰ì
(
buf„r_out
);

315 
	`ã°_Áûed
();

318 
îr‹
 = 
	`›us_¥oje˘i⁄_ícodî_˘l
(
°_íc
,

319 
	`OPUS_SET_BITRATE
(
bôøã
 * 1000 * (
°ªams
 + 
cou∂ed
)));

320 i‡(
îr‹
 !
OPUS_OK
)

322 
bad_˛ónup
;

325 
îr‹
 = 
	`›us_¥oje˘i⁄_ícodî_˘l
(
°_íc
,

326 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_SIZE_REQUEST
, &
m©rix_size
);

327 i‡(
îr‹
 !
OPUS_OK
 || !
m©rix_size
)

329 
bad_˛ónup
;

332 
m©rix
 = (*)
	`›us_Æloc
(
m©rix_size
);

333 
îr‹
 = 
	`›us_¥oje˘i⁄_ícodî_˘l
(
°_íc
,

334 
OPUS_PROJECTION_GET_DEMIXING_MATRIX_REQUEST
, 
m©rix
, 
m©rix_size
);

336 
°_dec
 = 
	`›us_¥oje˘i⁄_decodî_¸óã
(
Fs
, 
ch™√ls
, 
°ªams
, 
cou∂ed
,

337 
m©rix
, 
m©rix_size
, &
îr‹
);

338 
	`›us_‰ì
(
m©rix
);

340 i‡(
îr‹
 !
OPUS_OK
) {

341 
	`Ârötf
(
°dîr
,

343 "™d %d cou∂ed såóms.\n", 
ch™√ls
, 
°ªams
, 
cou∂ed
);

344 
bad_˛ónup
;

347 
	`gíî©e_music
(
buf„r_ö
, 
BUFFER_SIZE
, 
ch™√ls
);

349 
Àn
 = 
	`›us_¥oje˘i⁄_ícode
(

350 
°_íc
, 
buf„r_ö
, 
BUFFER_SIZE
, 
d©a
, 
MAX_DATA_BYTES
);

351 if(
Àn
<0 ||Üí>
MAX_DATA_BYTES
) {

352 
	`Ârötf
(
°dîr
,"›us_ícode(Ëªtu∫ed %d\n", 
Àn
);

353 
bad_˛ónup
;

356 
out_ßm∂es
 = 
	`›us_¥oje˘i⁄_decode
(

357 
°_dec
, 
d©a
, 
Àn
, 
buf„r_out
, 
MAX_FRAME_SAMPLES
, 0);

358 if(
out_ßm∂es
!=
BUFFER_SIZE
) {

359 
	`Ârötf
(
°dîr
,"›us_decode(Ëªtu∫ed %d\n", 
out_ßm∂es
);

360 
bad_˛ónup
;

363 
	`›us_¥oje˘i⁄_decodî_de°roy
(
°_dec
);

364 
	`›us_¥oje˘i⁄_ícodî_de°roy
(
°_íc
);

365 
	`‰ì
(
buf„r_ö
);

366 
	`‰ì
(
buf„r_out
);

368 
bad_˛ónup
:

369 
	`‰ì
(
buf„r_ö
);

370 
	`‰ì
(
buf„r_out
);

371 
	`ã°_Áûed
();

372 
	}
}

374 
	$maö
(
_¨gc
, **
_¨gv
)

376 
i
;

378 ()
_¨gc
;

379 ()
_¨gv
;

382 
	`ã°_sim∂e_m©rix
();

385 
i
 = 0; i < 255; i++)

386 
	`ã°_¸óti⁄_¨gumíts
(
i
, 3);

389 
	`ã°_ícode_decode
(64 * 18, 18, 3);

391 
	`Ârötf
(
°dîr
, "AllÖrojectionÅestsÖassed.\n");

393 
	}
}

	@
1
.
0
318
7474
celt/_kiss_fft_guts.h
celt/arch.h
celt/arm/arm_celt_map.c
celt/arm/armcpu.c
celt/arm/armcpu.h
celt/arm/celt_fft_ne10.c
celt/arm/celt_mdct_ne10.c
celt/arm/celt_neon_intr.c
celt/arm/celt_pitch_xcorr_arm.s
celt/arm/fft_arm.h
celt/arm/fixed_arm64.h
celt/arm/fixed_armv4.h
celt/arm/fixed_armv5e.h
celt/arm/kiss_fft_armv4.h
celt/arm/kiss_fft_armv5e.h
celt/arm/mdct_arm.h
celt/arm/pitch_arm.h
celt/arm/pitch_neon_intr.c
celt/bands.c
celt/bands.h
celt/celt.c
celt/celt.h
celt/celt_decoder.c
celt/celt_encoder.c
celt/celt_lpc.c
celt/celt_lpc.h
celt/cpu_support.h
celt/cwrs.c
celt/cwrs.h
celt/dump_modes/dump_modes.c
celt/dump_modes/dump_modes_arch.h
celt/dump_modes/dump_modes_arm_ne10.c
celt/ecintrin.h
celt/entcode.c
celt/entcode.h
celt/entdec.c
celt/entdec.h
celt/entenc.c
celt/entenc.h
celt/fixed_c5x.h
celt/fixed_c6x.h
celt/fixed_debug.h
celt/fixed_generic.h
celt/float_cast.h
celt/kiss_fft.c
celt/kiss_fft.h
celt/laplace.c
celt/laplace.h
celt/mathops.c
celt/mathops.h
celt/mdct.c
celt/mdct.h
celt/mfrngcod.h
celt/mips/celt_mipsr1.h
celt/mips/fixed_generic_mipsr1.h
celt/mips/kiss_fft_mipsr1.h
celt/mips/mdct_mipsr1.h
celt/mips/pitch_mipsr1.h
celt/mips/vq_mipsr1.h
celt/modes.c
celt/modes.h
celt/opus_custom_demo.c
celt/os_support.h
celt/pitch.c
celt/pitch.h
celt/quant_bands.c
celt/quant_bands.h
celt/rate.c
celt/rate.h
celt/stack_alloc.h
celt/static_modes_fixed.h
celt/static_modes_fixed_arm_ne10.h
celt/static_modes_float.h
celt/static_modes_float_arm_ne10.h
celt/tests/test_unit_cwrs32.c
celt/tests/test_unit_dft.c
celt/tests/test_unit_entropy.c
celt/tests/test_unit_laplace.c
celt/tests/test_unit_mathops.c
celt/tests/test_unit_mdct.c
celt/tests/test_unit_rotation.c
celt/tests/test_unit_types.c
celt/vq.c
celt/vq.h
celt/x86/celt_lpc_sse.h
celt/x86/celt_lpc_sse4_1.c
celt/x86/pitch_sse.c
celt/x86/pitch_sse.h
celt/x86/pitch_sse2.c
celt/x86/pitch_sse4_1.c
celt/x86/vq_sse.h
celt/x86/vq_sse2.c
celt/x86/x86_celt_map.c
celt/x86/x86cpu.c
celt/x86/x86cpu.h
doc/trivial_example.c
include/opus.h
include/opus_custom.h
include/opus_defines.h
include/opus_multistream.h
include/opus_projection.h
include/opus_types.h
silk/A2NLSF.c
silk/API.h
silk/CNG.c
silk/HP_variable_cutoff.c
silk/Inlines.h
silk/LPC_analysis_filter.c
silk/LPC_fit.c
silk/LPC_inv_pred_gain.c
silk/LP_variable_cutoff.c
silk/MacroCount.h
silk/MacroDebug.h
silk/NLSF2A.c
silk/NLSF_VQ.c
silk/NLSF_VQ_weights_laroia.c
silk/NLSF_decode.c
silk/NLSF_del_dec_quant.c
silk/NLSF_encode.c
silk/NLSF_stabilize.c
silk/NLSF_unpack.c
silk/NSQ.c
silk/NSQ.h
silk/NSQ_del_dec.c
silk/PLC.c
silk/PLC.h
silk/SigProc_FIX.h
silk/VAD.c
silk/VQ_WMat_EC.c
silk/ana_filt_bank_1.c
silk/arm/LPC_inv_pred_gain_arm.h
silk/arm/LPC_inv_pred_gain_neon_intr.c
silk/arm/NSQ_del_dec_arm.h
silk/arm/NSQ_del_dec_neon_intr.c
silk/arm/NSQ_neon.c
silk/arm/NSQ_neon.h
silk/arm/SigProc_FIX_armv4.h
silk/arm/SigProc_FIX_armv5e.h
silk/arm/arm_silk_map.c
silk/arm/biquad_alt_arm.h
silk/arm/biquad_alt_neon_intr.c
silk/arm/macros_arm64.h
silk/arm/macros_armv4.h
silk/arm/macros_armv5e.h
silk/biquad_alt.c
silk/bwexpander.c
silk/bwexpander_32.c
silk/check_control_input.c
silk/code_signs.c
silk/control.h
silk/control_SNR.c
silk/control_audio_bandwidth.c
silk/control_codec.c
silk/debug.c
silk/debug.h
silk/dec_API.c
silk/decode_core.c
silk/decode_frame.c
silk/decode_indices.c
silk/decode_parameters.c
silk/decode_pitch.c
silk/decode_pulses.c
silk/decoder_set_fs.c
silk/define.h
silk/enc_API.c
silk/encode_indices.c
silk/encode_pulses.c
silk/errors.h
silk/fixed/LTP_analysis_filter_FIX.c
silk/fixed/LTP_scale_ctrl_FIX.c
silk/fixed/apply_sine_window_FIX.c
silk/fixed/arm/warped_autocorrelation_FIX_arm.h
silk/fixed/arm/warped_autocorrelation_FIX_neon_intr.c
silk/fixed/autocorr_FIX.c
silk/fixed/burg_modified_FIX.c
silk/fixed/corrMatrix_FIX.c
silk/fixed/encode_frame_FIX.c
silk/fixed/find_LPC_FIX.c
silk/fixed/find_LTP_FIX.c
silk/fixed/find_pitch_lags_FIX.c
silk/fixed/find_pred_coefs_FIX.c
silk/fixed/k2a_FIX.c
silk/fixed/k2a_Q16_FIX.c
silk/fixed/main_FIX.h
silk/fixed/mips/noise_shape_analysis_FIX_mipsr1.h
silk/fixed/mips/prefilter_FIX_mipsr1.h
silk/fixed/mips/warped_autocorrelation_FIX_mipsr1.h
silk/fixed/noise_shape_analysis_FIX.c
silk/fixed/pitch_analysis_core_FIX.c
silk/fixed/process_gains_FIX.c
silk/fixed/regularize_correlations_FIX.c
silk/fixed/residual_energy16_FIX.c
silk/fixed/residual_energy_FIX.c
silk/fixed/schur64_FIX.c
silk/fixed/schur_FIX.c
silk/fixed/structs_FIX.h
silk/fixed/vector_ops_FIX.c
silk/fixed/warped_autocorrelation_FIX.c
silk/fixed/x86/burg_modified_FIX_sse4_1.c
silk/fixed/x86/prefilter_FIX_sse.c
silk/fixed/x86/vector_ops_FIX_sse4_1.c
silk/float/LPC_analysis_filter_FLP.c
silk/float/LPC_inv_pred_gain_FLP.c
silk/float/LTP_analysis_filter_FLP.c
silk/float/LTP_scale_ctrl_FLP.c
silk/float/SigProc_FLP.h
silk/float/apply_sine_window_FLP.c
silk/float/autocorrelation_FLP.c
silk/float/burg_modified_FLP.c
silk/float/bwexpander_FLP.c
silk/float/corrMatrix_FLP.c
silk/float/encode_frame_FLP.c
silk/float/energy_FLP.c
silk/float/find_LPC_FLP.c
silk/float/find_LTP_FLP.c
silk/float/find_pitch_lags_FLP.c
silk/float/find_pred_coefs_FLP.c
silk/float/inner_product_FLP.c
silk/float/k2a_FLP.c
silk/float/main_FLP.h
silk/float/noise_shape_analysis_FLP.c
silk/float/pitch_analysis_core_FLP.c
silk/float/process_gains_FLP.c
silk/float/regularize_correlations_FLP.c
silk/float/residual_energy_FLP.c
silk/float/scale_copy_vector_FLP.c
silk/float/scale_vector_FLP.c
silk/float/schur_FLP.c
silk/float/sort_FLP.c
silk/float/structs_FLP.h
silk/float/warped_autocorrelation_FLP.c
silk/float/wrappers_FLP.c
silk/gain_quant.c
silk/init_decoder.c
silk/init_encoder.c
silk/inner_prod_aligned.c
silk/interpolate.c
silk/lin2log.c
silk/log2lin.c
silk/macros.h
silk/main.h
silk/mips/NSQ_del_dec_mipsr1.h
silk/mips/macros_mipsr1.h
silk/mips/sigproc_fix_mipsr1.h
silk/pitch_est_defines.h
silk/pitch_est_tables.c
silk/process_NLSFs.c
silk/quant_LTP_gains.c
silk/resampler.c
silk/resampler_down2.c
silk/resampler_down2_3.c
silk/resampler_private.h
silk/resampler_private_AR2.c
silk/resampler_private_IIR_FIR.c
silk/resampler_private_down_FIR.c
silk/resampler_private_up2_HQ.c
silk/resampler_rom.c
silk/resampler_rom.h
silk/resampler_structs.h
silk/shell_coder.c
silk/sigm_Q15.c
silk/sort.c
silk/stereo_LR_to_MS.c
silk/stereo_MS_to_LR.c
silk/stereo_decode_pred.c
silk/stereo_encode_pred.c
silk/stereo_find_predictor.c
silk/stereo_quant_pred.c
silk/structs.h
silk/sum_sqr_shift.c
silk/table_LSF_cos.c
silk/tables.h
silk/tables_LTP.c
silk/tables_NLSF_CB_NB_MB.c
silk/tables_NLSF_CB_WB.c
silk/tables_gain.c
silk/tables_other.c
silk/tables_pitch_lag.c
silk/tables_pulses_per_block.c
silk/tests/test_unit_LPC_inv_pred_gain.c
silk/tuning_parameters.h
silk/typedef.h
silk/x86/NSQ_del_dec_sse4_1.c
silk/x86/NSQ_sse4_1.c
silk/x86/SigProc_FIX_sse.h
silk/x86/VAD_sse4_1.c
silk/x86/VQ_WMat_EC_sse4_1.c
silk/x86/main_sse.h
silk/x86/x86_silk_map.c
src/analysis.c
src/analysis.h
src/mapping_matrix.c
src/mapping_matrix.h
src/mlp.c
src/mlp.h
src/mlp_data.c
src/opus.c
src/opus_compare.c
src/opus_decoder.c
src/opus_demo.c
src/opus_encoder.c
src/opus_multistream.c
src/opus_multistream_decoder.c
src/opus_multistream_encoder.c
src/opus_private.h
src/opus_projection_decoder.c
src/opus_projection_encoder.c
src/repacketizer.c
src/repacketizer_demo.c
src/tansig_table.h
tests/opus_decode_fuzzer.c
tests/opus_encode_regressions.c
tests/test_opus_api.c
tests/test_opus_common.h
tests/test_opus_decode.c
tests/test_opus_encode.c
tests/test_opus_padding.c
tests/test_opus_projection.c
